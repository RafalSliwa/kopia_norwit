{"mappings":"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","sources":["<anon>","src-js/index.js","src-js/editor/article-editor.js","src-js/editor/plugins/blockcode/blockcode.js","src-js/editor/plugins/buttonlink/buttonlink.js","src-js/editor/plugins/carousel/carousel.js","src-js/editor/plugins/clips/clips.js","src-js/editor/plugins/counter/counter.js","src-js/editor/plugins/definedlinks/definedlinks.js","src-js/editor/plugins/filelink/filelink.js","src-js/editor/plugins/fontsize/fontsize.js","src-js/editor/plugins/fontfamily/fontfamily.js","src-js/editor/plugins/fontcolor/fontcolor.js","src-js/editor/plugins/handle/handle.js","src-js/editor/plugins/icons/icons.js","src-js/editor/plugins/imageposition/imageposition.js","src-js/editor/plugins/imageresize/imageresize.js","src-js/editor/plugins/inlineformat/inlineformat.js","src-js/editor/plugins/makebutton/makebutton.js","src-js/editor/plugins/math/math.js","src-js/editor/plugins/print/print.js","src-js/editor/plugins/removeformat/removeformat.js","src-js/editor/plugins/reorder/reorder.js","src-js/editor/plugins/selector/selector.js","src-js/editor/plugins/slideshow/slideshow.js","src-js/editor/plugins/specialchars/specialchars.js","src-js/editor/plugins/style/style.js","src-js/editor/plugins/tags/tags.js","src-js/editor/plugins/textdirection/textdirection.js","src-js/editor/plugins/underline/underline.js","src-js/editor/plugins/variable/variable.js","src-js/init.js","src-js/plugin-icons.js","src-js/block-link.js","src-js/product-block.js","src-js/my-fontcolor.js"],"sourcesContent":["(() => {\n\nvar $f9c0764c59596a86$exports = {};\n/*\n    Article Editor JS\n    Version 2.4.10\n    Updated: February 1, 2024\n\n    http://imperavi.com/article/\n\n    Copyright (c) 2009-2024, Imperavi Ltd.\n    License: http://imperavi.com/article/license/\n*/ if (typeof $f9c0764c59596a86$var$CodeMirror === \"undefined\") var $f9c0764c59596a86$var$CodeMirror;\n(function() {\n    // Version 2.0\n    var Ajax = {};\n    Ajax.settings = {};\n    Ajax.post = function(options) {\n        return new AjaxRequest(\"post\", options);\n    };\n    Ajax.get = function(options) {\n        return new AjaxRequest(\"get\", options);\n    };\n    Ajax.request = function(method, options) {\n        return new AjaxRequest(method, options);\n    };\n    var AjaxRequest = function(method, options) {\n        var defaults = {\n            method: method,\n            url: \"\",\n            before: function() {},\n            success: function() {},\n            error: function() {},\n            data: false,\n            async: true,\n            headers: {}\n        };\n        this.p = this.extend(defaults, options);\n        this.p = this.extend(this.p, Ajax.settings);\n        this.p.method = this.p.method.toUpperCase();\n        this.prepareData();\n        this.xhr = new XMLHttpRequest();\n        this.xhr.open(this.p.method, this.p.url, this.p.async);\n        this.setHeaders();\n        var before = typeof this.p.before === \"function\" ? this.p.before(this.xhr) : true;\n        if (before !== false) this.send();\n    };\n    AjaxRequest.prototype = {\n        extend: function(obj1, obj2) {\n            if (obj2) Object.keys(obj2).forEach(function(key) {\n                obj1[key] = obj2[key];\n            });\n            return obj1;\n        },\n        prepareData: function() {\n            if ([\n                \"POST\",\n                \"PUT\"\n            ].indexOf(this.p.method) !== -1 && !this.isFormData()) this.p.headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\n            if (typeof this.p.data === \"object\" && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n            if (this.p.method === \"GET\") {\n                var sign = this.p.url.search(/\\?/) !== -1 ? \"&\" : \"?\";\n                this.p.url = this.p.data ? this.p.url + sign + this.p.data : this.p.url;\n            }\n        },\n        setHeaders: function() {\n            this.xhr.setRequestHeader(\"X-Requested-With\", this.p.headers[\"X-Requested-With\"] || \"XMLHttpRequest\");\n            Object.keys(this.p.headers).forEach((function(key) {\n                this.xhr.setRequestHeader(key, this.p.headers[key]);\n            }).bind(this));\n        },\n        isFormData: function() {\n            return typeof window.FormData !== \"undefined\" && this.p.data instanceof window.FormData;\n        },\n        isComplete: function() {\n            return !(this.xhr.status < 200 || this.xhr.status >= 300 && this.xhr.status !== 304);\n        },\n        send: function() {\n            if (this.p.async) {\n                this.xhr.onload = this.loaded.bind(this);\n                this.xhr.send(this.p.data);\n            } else {\n                this.xhr.send(this.p.data);\n                this.loaded.call(this);\n            }\n        },\n        loaded: function() {\n            var response;\n            if (this.isComplete()) {\n                response = this.parseResponse();\n                if (typeof this.p.success === \"function\") this.p.success(response, this.xhr);\n            } else {\n                response = this.parseResponse();\n                if (typeof this.p.error === \"function\") this.p.error(response, this.xhr, this.xhr.status);\n            }\n        },\n        parseResponse: function() {\n            var response = this.xhr.response;\n            var json = this.parseJson(response);\n            return json ? json : response;\n        },\n        parseJson: function(str) {\n            try {\n                var o = JSON.parse(str);\n                if (o && typeof o === \"object\") return o;\n            } catch (e) {\n                return false;\n            }\n            return false;\n        },\n        toParams: function(obj) {\n            return Object.keys(obj).map(function(k) {\n                return encodeURIComponent(k) + \"=\" + encodeURIComponent(obj[k]);\n            }).join(\"&\");\n        }\n    };\n    // Version 2.0\n    var DomCache = [\n        0\n    ];\n    var DomExpando = \"data\" + new Date().getTime();\n    var Dom = function(selector, context) {\n        return this.parse(selector, context);\n    };\n    Dom.ready = function(fn) {\n        document.addEventListener(\"DOMContentLoaded\", fn);\n    };\n    Dom.prototype = {\n        get length () {\n            return this.nodes.length;\n        },\n        parse: function(s, c) {\n            var n;\n            var rehtml = /^\\s*<(\\w+|!)[^>]*>/;\n            if (!s) n = [];\n            else if (s instanceof Dom) {\n                this.nodes = s.nodes;\n                return s;\n            } else if (rehtml.test(s)) n = this.create(s);\n            else if (typeof s !== \"string\") {\n                if (s.nodeType && s.nodeType === 11) n = s.childNodes;\n                else n = s.nodeType || this._isWindowNode(s) ? [\n                    s\n                ] : s;\n            } else n = this._query(s, c);\n            this.nodes = this._slice(n);\n        },\n        create: function(html) {\n            if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html)) return [\n                document.createElement(RegExp.$1)\n            ];\n            var elmns = [];\n            var c = document.createElement(\"div\");\n            c.innerHTML = html;\n            for(var i = 0, l = c.childNodes.length; i < l; i++)elmns.push(c.childNodes[i]);\n            return elmns;\n        },\n        // dataset/dataget\n        dataset: function(key, value) {\n            return this.each(function($node) {\n                DomCache[this.dataindex($node.get())][key] = value;\n            });\n        },\n        dataget: function(key) {\n            return DomCache[this.dataindex(this.get())][key];\n        },\n        dataindex: function(el) {\n            var index = el[DomExpando];\n            var nextIndex = DomCache.length;\n            if (!index) {\n                index = nextIndex;\n                if (el) el[DomExpando] = nextIndex;\n                DomCache[index] = {};\n            }\n            return index;\n        },\n        // add\n        add: function(n) {\n            this.nodes = this.nodes.concat(this._array(n));\n            return this;\n        },\n        // get\n        get: function(index) {\n            return this.nodes[index || 0] || false;\n        },\n        getAll: function() {\n            return this.nodes;\n        },\n        eq: function(index) {\n            return new Dom(this.nodes[index]);\n        },\n        first: function() {\n            return new Dom(this.nodes[0]);\n        },\n        last: function() {\n            return new Dom(this.nodes[this.nodes.length - 1]);\n        },\n        contents: function() {\n            return this.get().childNodes;\n        },\n        // loop\n        each: function(fn) {\n            var len = this.nodes.length;\n            for(var i = 0; i < len; i++)fn.call(this, new Dom(this.nodes[i]), i);\n            return this;\n        },\n        // traversing\n        is: function(s) {\n            return this.filter(s).length > 0;\n        },\n        filter: function(s) {\n            var fn;\n            if (s === undefined) return this;\n            else if (typeof s === \"function\") fn = function(node) {\n                return s(new Dom(node));\n            };\n            else fn = function(node) {\n                if (s && s.nodeType || s instanceof Node) return s === node;\n                else {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return node.nodeType === 1 ? node.matches(s || \"*\") : false;\n                }\n            };\n            return new Dom(this.nodes.filter.call(this.nodes, fn));\n        },\n        not: function(filter) {\n            return this.filter(function(node) {\n                return !new Dom(node).is(filter || true);\n            });\n        },\n        find: function(s) {\n            var n = [];\n            this.each(function($n) {\n                var node = $n.get();\n                var ns = this._query(s, node);\n                for(var i = 0; i < ns.length; i++)n.push(ns[i]);\n            });\n            return new Dom(n);\n        },\n        children: function(s) {\n            var n = [];\n            this.each(function($n) {\n                var node = $n.get();\n                if (node.children) {\n                    var ns = node.children;\n                    for(var i = 0; i < ns.length; i++)n.push(ns[i]);\n                }\n            });\n            return new Dom(n).filter(s);\n        },\n        parent: function(s) {\n            var node = this.get();\n            var p = node.parentNode ? node.parentNode : false;\n            return p ? new Dom(p).filter(s) : new Dom();\n        },\n        parents: function(s, c) {\n            c = this._context(c);\n            var n = [];\n            this.each(function($n) {\n                var node = $n.get();\n                var p = node.parentNode;\n                while(p && p !== c){\n                    if (s) {\n                        if (new Dom(p).is(s)) n.push(p);\n                    } else n.push(p);\n                    p = p.parentNode;\n                }\n            });\n            return new Dom(n);\n        },\n        closest: function(s, c) {\n            c = this._context(c);\n            var n = [];\n            var isNode = s && s.nodeType;\n            this.each(function($n) {\n                var node = $n.get();\n                do {\n                    if (node && (isNode && node === s || new Dom(node).is(s))) return n.push(node);\n                }while ((node = node.parentNode) && node !== c);\n            });\n            return new Dom(n);\n        },\n        next: function(s) {\n            return this._sibling(s, \"nextSibling\");\n        },\n        nextElement: function(s) {\n            return this._sibling(s, \"nextElementSibling\");\n        },\n        prev: function(s) {\n            return this._sibling(s, \"previousSibling\");\n        },\n        prevElement: function(s) {\n            return this._sibling(s, \"previousElementSibling\");\n        },\n        // css\n        css: function(name, value) {\n            if (value === undefined && typeof name !== \"object\") {\n                var node = this.get();\n                if (name === \"width\" || name === \"height\") return node.style ? this._getHeightOrWidth(name) + \"px\" : undefined;\n                else return node.style ? getComputedStyle(node, null)[name] : undefined;\n            }\n            // set\n            return this.each(function($n) {\n                var node = $n.get();\n                var o = {};\n                if (typeof name === \"object\") o = name;\n                else o[name] = value;\n                for(var key in o)if (node.style) node.style[key] = o[key];\n            });\n        },\n        // attr\n        attr: function(name, value, data) {\n            data = data ? \"data-\" : \"\";\n            if (typeof value === \"undefined\" && typeof name !== \"object\") {\n                var node = this.get();\n                if (node && node.nodeType !== 3) return name === \"checked\" ? node.checked : this._boolean(node.getAttribute(data + name));\n                else return;\n            }\n            // set\n            return this.each(function($n) {\n                var node = $n.get();\n                var o = {};\n                if (typeof name === \"object\") o = name;\n                else o[name] = value;\n                for(var key in o)if (node.nodeType !== 3) {\n                    if (key === \"checked\") node.checked = o[key];\n                    else node.setAttribute(data + key, o[key]);\n                }\n            });\n        },\n        data: function(name, value) {\n            if (name === undefined || name === true) {\n                var reDataAttr = /^data-(.+)$/;\n                var attrs = this.get().attributes;\n                var data = {};\n                var replacer = function(g) {\n                    return g[1].toUpperCase();\n                };\n                for(var key in attrs)if (attrs[key] && reDataAttr.test(attrs[key].nodeName)) {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    if (name !== true) dataName = dataName.replace(/-([a-z])/g, replacer);\n                    if (val.search(/^{/) !== -1) val = this._object(val);\n                    else val = this._number(val) ? parseFloat(val) : this._boolean(val);\n                    data[dataName] = val;\n                }\n                return data;\n            }\n            return this.attr(name, value, true);\n        },\n        val: function(value) {\n            if (value === undefined) {\n                var el = this.get();\n                if (el.type && el.type === \"checkbox\") return el.checked;\n                else return el.value;\n            }\n            return this.each(function($n) {\n                var el = $n.get();\n                if (el.type && el.type === \"checkbox\") el.checked = value;\n                else el.value = value;\n            });\n        },\n        removeAttr: function(value) {\n            return this.each(function($n) {\n                var node = $n.get();\n                var fn = function(name) {\n                    if (node.nodeType !== 3) node.removeAttribute(name);\n                };\n                value.split(\" \").forEach(fn);\n            });\n        },\n        // class\n        addClass: function(value) {\n            return this._eachClass(value, \"add\");\n        },\n        removeClass: function(value) {\n            return this._eachClass(value, \"remove\");\n        },\n        toggleClass: function(value) {\n            return this._eachClass(value, \"toggle\");\n        },\n        hasClass: function(value) {\n            var node = this.get();\n            if (value) {\n                var classes = value.split(\" \");\n                return node.classList ? node.matches(\".\" + classes.join(\".\")) : false;\n            } else return false;\n        },\n        // html & text\n        empty: function() {\n            return this.each(function($n) {\n                $n.get().innerHTML = \"\";\n            });\n        },\n        html: function(html) {\n            return html === undefined ? this.get().innerHTML || \"\" : this.empty().append(html);\n        },\n        text: function(text) {\n            return text === undefined ? this.get().textContent || \"\" : this.each(function($n) {\n                $n.get().textContent = text;\n            });\n        },\n        // manipulation\n        after: function(html) {\n            return this._inject(html, function(frag, node) {\n                if (typeof frag === \"string\") node.insertAdjacentHTML(\"afterend\", frag);\n                else {\n                    if (node.parentNode !== null) for(var i = frag instanceof Node ? [\n                        frag\n                    ] : this._array(frag).reverse(), s = 0; s < i.length; s++)node.parentNode.insertBefore(i[s], node.nextSibling);\n                }\n                return node;\n            });\n        },\n        before: function(html) {\n            return this._inject(html, function(frag, node) {\n                if (typeof frag === \"string\") node.insertAdjacentHTML(\"beforebegin\", frag);\n                else {\n                    var elms = frag instanceof Node ? [\n                        frag\n                    ] : this._array(frag);\n                    for(var i = 0; i < elms.length; i++)node.parentNode.insertBefore(elms[i], node);\n                }\n                return node;\n            });\n        },\n        append: function(html) {\n            return this._inject(html, function(frag, node) {\n                if (typeof frag === \"string\" || typeof frag === \"number\") node.insertAdjacentHTML(\"beforeend\", frag);\n                else {\n                    var elms = frag instanceof Node ? [\n                        frag\n                    ] : this._array(frag);\n                    for(var i = 0; i < elms.length; i++)node.appendChild(elms[i]);\n                }\n                return node;\n            });\n        },\n        prepend: function(html) {\n            return this._inject(html, function(frag, node) {\n                if (typeof frag === \"string\" || typeof frag === \"number\") node.insertAdjacentHTML(\"afterbegin\", frag);\n                else {\n                    var elms = frag instanceof Node ? [\n                        frag\n                    ] : this._array(frag).reverse();\n                    for(var i = 0; i < elms.length; i++)node.insertBefore(elms[i], node.firstChild);\n                }\n                return node;\n            });\n        },\n        wrap: function(html) {\n            return this._inject(html, function(frag, node) {\n                var wrapper = typeof frag === \"string\" || typeof frag === \"number\" ? this.create(frag)[0] : frag instanceof Node ? frag : this._array(frag)[0];\n                if (node.parentNode) node.parentNode.insertBefore(wrapper, node);\n                wrapper.appendChild(node);\n                return wrapper;\n            });\n        },\n        unwrap: function() {\n            return this.each(function($n) {\n                var node = $n.get();\n                var docFrag = document.createDocumentFragment();\n                while(node.firstChild){\n                    var child = node.removeChild(node.firstChild);\n                    docFrag.appendChild(child);\n                }\n                node.parentNode.replaceChild(docFrag, node);\n            });\n        },\n        replaceWith: function(html) {\n            return this._inject(html, function(frag, node) {\n                var docFrag = document.createDocumentFragment();\n                var elms = typeof frag === \"string\" || typeof frag === \"number\" ? this.create(frag) : frag instanceof Node ? [\n                    frag\n                ] : this._array(frag);\n                for(var i = 0; i < elms.length; i++)docFrag.appendChild(elms[i]);\n                var result = docFrag.childNodes[0];\n                if (node.parentNode) node.parentNode.replaceChild(docFrag, node);\n                return result;\n            });\n        },\n        remove: function() {\n            return this.each(function($n) {\n                var node = $n.get();\n                if (node.parentNode) node.parentNode.removeChild(node);\n            });\n        },\n        clone: function(events) {\n            var n = [];\n            this.each(function($n) {\n                var node = $n.get();\n                var copy = this._clone(node);\n                if (events) copy = this._cloneEvents(node, copy);\n                n.push(copy);\n            });\n            return new Dom(n);\n        },\n        // show/hide\n        show: function() {\n            return this.each((function($n) {\n                var node = $n.get();\n                if (!node.style || !this._hasDisplayNone(node)) return;\n                var target = node.getAttribute(\"domTargetShow\");\n                node.style.display = target ? target : \"block\";\n                node.removeAttribute(\"domTargetShow\");\n            }).bind(this));\n        },\n        hide: function() {\n            return this.each(function($n) {\n                var node = $n.get();\n                if (!node.style || this._hasDisplayNone(node)) return;\n                var display = node.style.display;\n                if (display !== \"block\") node.setAttribute(\"domTargetShow\", display);\n                node.style.display = \"none\";\n            });\n        },\n        // dimensions\n        scrollTop: function(value) {\n            var node = this.get();\n            var isWindow = this._isWindowNode(node);\n            var isDocument = node.nodeType === 9;\n            var el = isDocument ? node.scrollingElement || node.body.parentNode || node.body || node.documentElement : node;\n            if (typeof value !== \"undefined\") {\n                value = parseInt(value);\n                if (isWindow) node.scrollTo(0, value);\n                else el.scrollTop = value;\n                return;\n            }\n            return isWindow ? node.pageYOffset : el.scrollTop;\n        },\n        offset: function() {\n            return this._getPos(\"offset\");\n        },\n        position: function() {\n            return this._getPos(\"position\");\n        },\n        width: function(value) {\n            return value !== undefined ? this.css(\"width\", parseInt(value) + \"px\") : this._getSize(\"width\", \"Width\");\n        },\n        height: function(value) {\n            return value !== undefined ? this.css(\"height\", parseInt(value) + \"px\") : this._getSize(\"height\", \"Height\");\n        },\n        outerWidth: function() {\n            return this._getSize(\"width\", \"Width\", \"outer\");\n        },\n        outerHeight: function() {\n            return this._getSize(\"height\", \"Height\", \"outer\");\n        },\n        innerWidth: function() {\n            return this._getSize(\"width\", \"Width\", \"inner\");\n        },\n        innerHeight: function() {\n            return this._getSize(\"height\", \"Height\", \"inner\");\n        },\n        // events\n        click: function() {\n            return this._trigger(\"click\");\n        },\n        focus: function() {\n            return this._trigger(\"focus\");\n        },\n        blur: function() {\n            return this._trigger(\"blur\");\n        },\n        on: function(names, handler, one) {\n            return this.each(function($n) {\n                var node = $n.get();\n                var events = names.split(\" \");\n                for(var i = 0; i < events.length; i++){\n                    var event = this._getEventName(events[i]);\n                    var namespace = this._getEventNamespace(events[i]);\n                    handler = one ? this._getOneHandler(handler, names) : handler;\n                    node.addEventListener(event, handler);\n                    node._e = node._e || {};\n                    node._e[namespace] = node._e[namespace] || {};\n                    node._e[namespace][event] = node._e[namespace][event] || [];\n                    node._e[namespace][event].push(handler);\n                }\n            });\n        },\n        one: function(events, handler) {\n            return this.on(events, handler, true);\n        },\n        off: function(names, handler) {\n            var testEvent = function(name, key, event) {\n                return name === event;\n            };\n            var testNamespace = function(name, key, event, namespace) {\n                return key === namespace;\n            };\n            var testEventNamespace = function(name, key, event, namespace) {\n                return name === event && key === namespace;\n            };\n            var testPositive = function() {\n                return true;\n            };\n            if (names === undefined) // all\n            return this.each(function($n) {\n                this._offEvent($n.get(), false, false, handler, testPositive);\n            });\n            return this.each(function($n) {\n                var node = $n.get();\n                var events = names.split(\" \");\n                for(var i = 0; i < events.length; i++){\n                    var event = this._getEventName(events[i]);\n                    var namespace = this._getEventNamespace(events[i]);\n                    // 1) event without namespace\n                    if (namespace === \"_events\") this._offEvent(node, event, namespace, handler, testEvent);\n                    else if (!event && namespace !== \"_events\") this._offEvent(node, event, namespace, handler, testNamespace);\n                    else this._offEvent(node, event, namespace, handler, testEventNamespace);\n                }\n            });\n        },\n        // form\n        serialize: function(asObject) {\n            var obj = {};\n            var elms = this.get().elements;\n            for(var i = 0; i < elms.length; i++){\n                var el = elms[i];\n                if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n                if (!el.name || el.disabled || el.type === \"file\") continue;\n                if (el.type === \"select-multiple\") for(var z = 0; z < el.options.length; z++){\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n                obj[el.name] = this._number(el.value) ? parseFloat(el.value) : this._boolean(el.value);\n            }\n            return asObject ? obj : this._params(obj);\n        },\n        // animation\n        scroll: function() {\n            this.get().scrollIntoView({\n                behavior: \"smooth\"\n            });\n        },\n        fadeIn: function(speed, fn) {\n            var anim = this._anim(speed, fn, 500);\n            return this.each(function($n) {\n                $n.css({\n                    \"display\": \"block\",\n                    \"opacity\": 0,\n                    \"animation\": \"fadeIn \" + anim.speed + \"s ease-in-out\"\n                }).removeClass(\"hidden\");\n                $n.one(\"animationend\", function() {\n                    $n.css({\n                        \"opacity\": \"\",\n                        \"animation\": \"\"\n                    });\n                    if (anim.fn) anim.fn($n);\n                });\n            });\n        },\n        fadeOut: function(speed, fn) {\n            var anim = this._anim(speed, fn, 300);\n            return this.each(function($n) {\n                $n.css({\n                    \"opacity\": 1,\n                    \"animation\": \"fadeOut \" + anim.speed + \"s ease-in-out\"\n                });\n                $n.one(\"animationend\", function() {\n                    $n.css({\n                        \"display\": \"none\",\n                        \"opacity\": \"\",\n                        \"animation\": \"\"\n                    });\n                    if (anim.fn) anim.fn($n);\n                });\n            });\n        },\n        slideUp: function(speed, fn) {\n            var anim = this._anim(speed, fn, 300);\n            return this.each(function($n) {\n                $n.height($n.height());\n                $n.css({\n                    \"overflow\": \"hidden\",\n                    \"animation\": \"slideUp \" + anim.speed + \"s ease-out\"\n                });\n                $n.one(\"animationend\", function() {\n                    $n.css({\n                        \"display\": \"none\",\n                        \"height\": \"\",\n                        \"animation\": \"\"\n                    });\n                    if (anim.fn) anim.fn($n);\n                });\n            });\n        },\n        slideDown: function(speed, fn) {\n            var anim = this._anim(speed, fn, 400);\n            return this.each(function($n) {\n                $n.height($n.height());\n                $n.css({\n                    \"display\": \"block\",\n                    \"overflow\": \"hidden\",\n                    \"animation\": \"slideDown \" + anim.speed + \"s ease-in-out\"\n                }).removeClass(\"hidden\");\n                $n.one(\"animationend\", function() {\n                    $n.css({\n                        \"overflow\": \"\",\n                        \"height\": \"\",\n                        \"animation\": \"\"\n                    });\n                    if (anim.fn) anim.fn($n);\n                });\n            });\n        },\n        // private\n        _queryContext: function(s, c) {\n            c = this._context(c);\n            return c.nodeType !== 3 && typeof c.querySelectorAll === \"function\" ? c.querySelectorAll(s) : [];\n        },\n        _query: function(s, c) {\n            var d = document;\n            if (c) return this._queryContext(s, c);\n            else if (/^[.#]?[\\w-]*$/.test(s)) {\n                if (s[0] === \"#\") {\n                    var el = d.getElementById(s.slice(1));\n                    return el ? [\n                        el\n                    ] : [];\n                }\n                if (s[0] === \".\") return d.getElementsByClassName(s.slice(1));\n                return d.getElementsByTagName(s);\n            }\n            return d.querySelectorAll(s);\n        },\n        _context: function(c) {\n            return !c ? document : typeof c === \"string\" ? document.querySelector(c) : c;\n        },\n        _sibling: function(s, method) {\n            var isNode = s && s.nodeType;\n            var sibling;\n            this.each(function($n) {\n                var node = $n.get();\n                do {\n                    node = node[method];\n                    if (node && (isNode && node === s || new Dom(node).is(s))) {\n                        sibling = node;\n                        return;\n                    }\n                }while (node);\n            });\n            return new Dom(sibling);\n        },\n        _slice: function(o) {\n            return !o || o.length === 0 ? [] : o.length ? [].slice.call(o.nodes || o) : [\n                o\n            ];\n        },\n        _array: function(o) {\n            if (o === undefined) return [];\n            else if (o instanceof NodeList) {\n                var arr = [];\n                for(var i = 0; i < o.length; i++)arr[i] = o[i];\n                return arr;\n            }\n            return o instanceof Dom ? o.nodes : o;\n        },\n        _object: function(str) {\n            var jsonStr = str.replace(/(\\w+:)|(\\w+ :)/g, function(matchedStr) {\n                return '\"' + matchedStr.substring(0, matchedStr.length - 1) + '\":';\n            });\n            return JSON.parse(jsonStr);\n        },\n        _params: function(obj) {\n            var params = \"\";\n            Object.keys(obj).forEach((function(key) {\n                params += \"&\" + this._encodeUri(key) + \"=\" + this._encodeUri(obj[key]);\n            }).bind(this));\n            return params.replace(/^&/, \"\");\n        },\n        _boolean: function(str) {\n            if (str === \"true\") return true;\n            else if (str === \"false\") return false;\n            return str;\n        },\n        _number: function(str) {\n            return !isNaN(str) && !isNaN(parseFloat(str));\n        },\n        _inject: function(html, fn) {\n            var len = this.nodes.length;\n            var nodes = [];\n            while(len--){\n                var res = typeof html === \"function\" ? html.call(this, this.nodes[len]) : html;\n                var el = len === 0 ? res : this._clone(res);\n                var node = fn.call(this, el, this.nodes[len]);\n                if (node) {\n                    if (node.dom) nodes.push(node.get());\n                    else nodes.push(node);\n                }\n            }\n            return new Dom(nodes);\n        },\n        _clone: function(node) {\n            if (typeof node === \"undefined\") return;\n            if (typeof node === \"string\") return node;\n            else if (node instanceof Node || node.nodeType) return node.cloneNode(true);\n            else if (\"length\" in node) return [].map.call(this._array(node), function(el) {\n                return el.cloneNode(true);\n            });\n        },\n        _cloneEvents: function(node, copy) {\n            var events = node._e;\n            if (events) {\n                copy._e = events;\n                for(var name in events._events){\n                    if (events._events.hasOwnProperty(name)) for(var i = 0; i < events._events[name].length; i++)copy.addEventListener(name, events._events[name][i]);\n                }\n            }\n            return copy;\n        },\n        _trigger: function(name) {\n            var node = this.get();\n            if (node && node.nodeType !== 3) node[name]();\n            return this;\n        },\n        _encodeUri: function(str) {\n            return encodeURIComponent(str).replace(/!/g, \"%21\").replace(/'/g, \"%27\").replace(/\\(/g, \"%28\").replace(/\\)/g, \"%29\").replace(/\\*/g, \"%2A\").replace(/%20/g, \"+\");\n        },\n        _getSize: function(name, cname) {\n            var el = this.get();\n            var value = 0;\n            if (el.nodeType === 3) value = 0;\n            else if (el.nodeType === 9) value = this._getDocSize(el, cname);\n            else if (this._isWindowNode(el)) value = window[\"inner\" + cname];\n            else value = this._getHeightOrWidth(name);\n            return Math.round(value);\n        },\n        _getDocSize: function(node, type) {\n            var body = node.body, html = node.documentElement;\n            return Math.max(body[\"scroll\" + type], body[\"offset\" + type], html[\"client\" + type], html[\"scroll\" + type], html[\"offset\" + type]);\n        },\n        _getPos: function(type) {\n            var node = this.get();\n            var dim = {\n                top: 0,\n                left: 0\n            };\n            if (node.nodeType === 3 || this._isWindowNode(node) || node.nodeType === 9) return dim;\n            else if (type === \"position\") return {\n                top: node.offsetTop,\n                left: node.offsetLeft\n            };\n            else if (type === \"offset\") {\n                var rect = node.getBoundingClientRect();\n                var doc = node.ownerDocument;\n                var docElem = doc.documentElement;\n                var win = doc.defaultView;\n                return {\n                    top: rect.top + win.pageYOffset - docElem.clientTop,\n                    left: rect.left + win.pageXOffset - docElem.clientLeft\n                };\n            }\n            return dim;\n        },\n        _getHeightOrWidth: function(name, type) {\n            var cname = name.charAt(0).toUpperCase() + name.slice(1);\n            var mode = type ? type : \"offset\";\n            var result = 0;\n            var el = this.get();\n            var style = getComputedStyle(el, null);\n            var $targets = this.parents().filter(function($n) {\n                var node = $n.get();\n                return node.nodeType === 1 && getComputedStyle(node, null).display === \"none\" ? node : false;\n            });\n            if (style.display === \"none\") $targets.add(el);\n            if ($targets.length !== 0) {\n                var fixStyle = \"visibility: hidden !important; display: block !important;\";\n                var tmp = [];\n                $targets.each(function($n) {\n                    var thisStyle = $n.attr(\"style\");\n                    if (thisStyle !== null) tmp.push(thisStyle);\n                    $n.attr(\"style\", thisStyle !== null ? thisStyle + \";\" + fixStyle : fixStyle);\n                });\n                result = el[mode + cname];\n                $targets.each(function($n, i) {\n                    if (tmp[i] === undefined) $n.removeAttr(\"style\");\n                    else $n.attr(\"style\", tmp[i]);\n                });\n            } else result = el[mode + cname];\n            return result;\n        },\n        _eachClass: function(value, type) {\n            return this.each(function($n) {\n                if (value) {\n                    var node = $n.get();\n                    var fn = function(name) {\n                        if (node.classList) node.classList[type](name);\n                    };\n                    value.split(\" \").forEach(fn);\n                }\n            });\n        },\n        _getOneHandler: function(handler, events) {\n            var self = this;\n            return function() {\n                handler.apply(this, arguments);\n                self.off(events);\n            };\n        },\n        _getEventNamespace: function(event) {\n            var arr = event.split(\".\");\n            var namespace = arr[1] ? arr[1] : \"_events\";\n            return arr[2] ? namespace + arr[2] : namespace;\n        },\n        _getEventName: function(event) {\n            return event.split(\".\")[0];\n        },\n        _offEvent: function(node, event, namespace, handler, condition) {\n            for(var key in node._e)if (node._e.hasOwnProperty(key)) {\n                for(var name in node._e[key])if (condition(name, key, event, namespace)) {\n                    var handlers = node._e[key][name];\n                    for(var i = 0; i < handlers.length; i++){\n                        if (typeof handler !== \"undefined\" && handlers[i].toString() !== handler.toString()) continue;\n                        node.removeEventListener(name, handlers[i]);\n                        node._e[key][name].splice(i, 1);\n                        if (node._e[key][name].length === 0) delete node._e[key][name];\n                        if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                    }\n                }\n            }\n        },\n        _hasDisplayNone: function(el) {\n            return el.style.display === \"none\" || (el.currentStyle ? el.currentStyle.display : getComputedStyle(el, null).display) === \"none\";\n        },\n        _anim: function(speed, fn, speedDef) {\n            if (typeof speed === \"function\") {\n                fn = speed;\n                speed = speedDef;\n            } else speed = speed || speedDef;\n            return {\n                fn: fn,\n                speed: speed / 1000\n            };\n        },\n        _isWindowNode: function(node) {\n            return node === window || node.parent && node.parent === window;\n        }\n    };\n    // Unique ID\n    var arx_uuid = 0;\n    // Init\n    var ArticleEditor = function(selector, settings) {\n        return ArticleEditorInit(selector, settings);\n    };\n    // Class\n    var ArticleEditorInit = function(selector, settings) {\n        var $elms = $ARX.dom(selector);\n        var instance;\n        $elms.each(function($el) {\n            instance = $el.dataget($ARX.namespace);\n            if (!instance) {\n                // Initialization\n                instance = new App($el, settings, arx_uuid);\n                $el.dataset($ARX.namespace, instance);\n                $ARX.instances[arx_uuid] = instance;\n                arx_uuid++;\n            }\n        });\n        return instance;\n    };\n    var $ARX = ArticleEditor;\n    // Dom & Ajax\n    $ARX.dom = function(selector, context) {\n        return new Dom(selector, context);\n    };\n    $ARX.ajax = Ajax;\n    // Globals\n    $ARX.instances = [];\n    $ARX.namespace = \"article-editor\";\n    $ARX.prefix = \"arx\";\n    $ARX.version = \"2.4.10\";\n    $ARX.settings = {};\n    $ARX.lang = {};\n    $ARX._mixins = {};\n    $ARX._repository = {};\n    $ARX._subscribe = {};\n    $ARX.keycodes = {\n        BACKSPACE: 8,\n        DELETE: 46,\n        UP: 38,\n        DOWN: 40,\n        ENTER: 13,\n        SPACE: 32,\n        ESC: 27,\n        TAB: 9,\n        CTRL: 17,\n        META: 91,\n        SHIFT: 16,\n        ALT: 18,\n        RIGHT: 39,\n        LEFT: 37\n    };\n    // Add\n    $ARX.add = function(type, name, obj) {\n        // translations\n        if (obj.translations) $ARX.lang = $ARX.extend(true, $ARX.lang, obj.translations);\n        // defaults\n        if (obj.defaults) {\n            var localopts = {};\n            localopts[name] = obj.defaults;\n            $ARX.opts = $ARX.extend(true, $ARX.opts, localopts);\n        }\n        // extend parser\n        if (obj.parser) {\n            var opt = {};\n            opt[obj.type] = obj.parser;\n            $ARX.opts.parser = $ARX.extend({}, true, $ARX.opts.parser, opt);\n        }\n        // extend nested\n        if (obj.nested) $ARX.opts.nested.push(obj.type);\n        if (type === \"mixin\") $ARX._mixins[name] = obj;\n        else {\n            // subscribe\n            if (obj.subscribe) {\n                for(var key in obj.subscribe)if (obj.subscribe.hasOwnProperty(key)) {\n                    var arr = key.split(\",\");\n                    for(var i = 0; i < arr.length; i++){\n                        var ns = arr[i].trim();\n                        if (typeof $ARX._subscribe[ns] === \"undefined\") $ARX._subscribe[ns] = [];\n                        $ARX._subscribe[ns].push({\n                            module: name,\n                            func: obj.subscribe[key]\n                        });\n                    }\n                }\n            }\n            // prototype\n            var F = function() {};\n            F.prototype = obj;\n            // mixins\n            if (obj.mixins) for(var z = 0; z < obj.mixins.length; z++)$ARX.inherit(F, $ARX._mixins[obj.mixins[z]]);\n            $ARX._repository[name] = {\n                type: type,\n                proto: F,\n                obj: obj\n            };\n        }\n    };\n    // Extend\n    $ARX.extend = function() {\n        var extended = {};\n        var deep = false;\n        var i = 0;\n        var length = arguments.length;\n        if (Object.prototype.toString.call(arguments[0]) === \"[object Boolean]\") {\n            deep = arguments[0];\n            i++;\n        }\n        var merge = function(obj) {\n            for(var prop in obj)if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n                if (deep && Object.prototype.toString.call(obj[prop]) === \"[object Object]\") extended[prop] = $ARX.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        };\n        for(; i < length; i++){\n            var obj = arguments[i];\n            merge(obj);\n        }\n        return extended;\n    };\n    // Error\n    $ARX.error = function(exception) {\n        throw exception;\n    };\n    // Inherit\n    $ARX.inherit = function(current, parent) {\n        var F = function() {};\n        F.prototype = parent;\n        var f = new F();\n        for(var prop in current.prototype)if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n        current.prototype = f;\n        current.prototype.super = parent;\n        return current;\n    };\n    // Lang\n    $ARX.addLang = function(lang, obj) {\n        if (typeof $ARX.lang[lang] === \"undefined\") $ARX.lang[lang] = {};\n        $ARX.lang[lang] = $ARX.extend(true, $ARX.lang[lang], obj);\n    };\n    ArticleEditor.opts = {\n        plugins: [],\n        content: false,\n        placeholder: false,\n        css: false,\n        custom: {\n            css: false,\n            js: false\n        },\n        editor: {\n            classname: \"entry\",\n            disabled: false,\n            focus: false,\n            sync: true,\n            drop: true,\n            lang: \"en\",\n            add: \"top\",\n            addbar: false,\n            https: false,\n            padding: true,\n            markup: \"paragraph\",\n            mobile: 400,\n            enterKey: true,\n            scrollTarget: window,\n            direction: \"ltr\",\n            spellcheck: true,\n            grammarly: true,\n            notranslate: false,\n            reloadmarker: true,\n            minHeight: \"100px\",\n            maxHeight: false,\n            doctype: \"<!doctype html>\",\n            csscache: false\n        },\n        selection: {\n            multiple: true\n        },\n        control: true,\n        source: true,\n        image: {\n            states: true,\n            upload: false,\n            url: true,\n            select: false,\n            selectMethod: \"get\",\n            name: \"file\",\n            data: false,\n            drop: true,\n            multiple: true,\n            clipboard: true,\n            types: [\n                \"image/*\"\n            ],\n            tag: \"figure\",\n            newtab: false,\n            link: true,\n            width: false\n        },\n        classes: false,\n        codemirrorSrc: false,\n        codemirror: false,\n        state: {\n            limit: 100\n        },\n        path: {\n            title: \"## editor.title ##\",\n            sticky: true,\n            stickyMinHeight: 200,\n            stickyTopOffset: 0 // number\n        },\n        autosave: {\n            url: false,\n            name: false,\n            data: false,\n            method: \"post\"\n        },\n        paste: {\n            clean: true,\n            autoparse: true,\n            paragraphize: true,\n            plaintext: false,\n            linkTarget: false,\n            images: true,\n            links: true,\n            keepStyle: [],\n            keepClass: [],\n            keepAttrs: [\n                \"td\",\n                \"th\"\n            ],\n            formTags: [\n                \"form\",\n                \"input\",\n                \"button\",\n                \"select\",\n                \"textarea\",\n                \"legend\",\n                \"fieldset\"\n            ],\n            blockTags: [\n                \"pre\",\n                \"div\",\n                \"h1\",\n                \"h2\",\n                \"h3\",\n                \"h4\",\n                \"h5\",\n                \"h6\",\n                \"table\",\n                \"tbody\",\n                \"thead\",\n                \"tfoot\",\n                \"th\",\n                \"tr\",\n                \"td\",\n                \"ul\",\n                \"ol\",\n                \"li\",\n                \"blockquote\",\n                \"p\",\n                \"hr\",\n                \"figure\",\n                \"iframe\",\n                \"figcaption\",\n                \"address\",\n                \"section\",\n                \"header\",\n                \"footer\",\n                \"aside\",\n                \"article\",\n                \"audio\",\n                \"source\"\n            ],\n            inlineTags: [\n                \"a\",\n                \"svg\",\n                \"img\",\n                \"br\",\n                \"strong\",\n                \"ins\",\n                \"code\",\n                \"del\",\n                \"span\",\n                \"samp\",\n                \"kbd\",\n                \"sup\",\n                \"sub\",\n                \"mark\",\n                \"var\",\n                \"cite\",\n                \"small\",\n                \"b\",\n                \"u\",\n                \"em\",\n                \"i\",\n                \"abbr\"\n            ]\n        },\n        clean: {\n            comments: false,\n            enter: true,\n            enterinline: false\n        },\n        tab: {\n            key: true,\n            spaces: false // true or number of spaces\n        },\n        topbar: {\n            undoredo: false,\n            shortcuts: true\n        },\n        toolbar: {\n            hide: [],\n            sticky: true,\n            stickyMinHeight: 200,\n            stickyTopOffset: 0 // number\n        },\n        buttons: {\n            editor: [\n                \"add\",\n                \"template\",\n                \"mobile\",\n                \"html\"\n            ],\n            topbar: [\n                \"undo\",\n                \"redo\",\n                \"shortcut\"\n            ],\n            toolbar: false,\n            tags: {\n                \"b\": [\n                    \"bold\"\n                ],\n                \"strong\": [\n                    \"bold\"\n                ],\n                \"i\": [\n                    \"italic\"\n                ],\n                \"em\": [\n                    \"italic\"\n                ],\n                \"del\": [\n                    \"deleted\"\n                ],\n                \"u\": [\n                    \"underline\"\n                ],\n                \"a\": [\n                    \"link\"\n                ]\n            },\n            types: false,\n            icons: false,\n            hidden: {}\n        },\n        card: {\n            classname: \"card\",\n            template: '<div class=\"card\"><div class=\"card-head\"><h3>Card title</h3></div><div class=\"card-body\"><p>Card body</p></div></div>'\n        },\n        text: {\n            classname: \"arx-text\"\n        },\n        noneditable: {\n            classname: \"noneditable\"\n        },\n        embed: {\n            responsive: \"embed-responsive\",\n            script: true,\n            checkbox: false\n        },\n        code: {\n            template: \"<pre></pre>\",\n            spaces: 4 // or false\n        },\n        line: true,\n        layer: {\n            template: \"<div></div>\"\n        },\n        table: {\n            template: \"<table><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>\"\n        },\n        quote: {\n            template: \"<blockquote><p>Quote...</p><p><cite>Author Attribution</cite></p></blockquote>\"\n        },\n        snippets: false,\n        templates: false,\n        grid: {\n            classname: \"grid\",\n            classes: \"\",\n            overlay: true,\n            offset: {\n                left: 0,\n                right: 0\n            },\n            columns: 12,\n            gutter: \"1.25rem\",\n            patterns: {\n                \"6|6\": \"column column-6|column column-6\",\n                \"4|4|4\": \"column column-4|column column-4|column column-4\",\n                \"3|3|3|3\": \"column column-3|column column-3|column column-3|column column-3\",\n                \"2|2|2|2|2|2\": \"column column-2|column column-2|column column-2|column column-2|column column-2|column column-2\",\n                \"3|6|3\": \"column column-3|column column-6|column column-3\",\n                \"2|8|2\": \"column column-2|column column-8|column column-2\",\n                \"5|7\": \"column column-5|column column-7\",\n                \"7|5\": \"column column-7|column column-5\",\n                \"4|8\": \"column column-4|column column-8\",\n                \"8|4\": \"column column-8|column column-4\",\n                \"3|9\": \"column column-3|column column-9\",\n                \"9|3\": \"column column-9|column column-3\",\n                \"2|10\": \"column column-2|column column-10\",\n                \"10|2\": \"column column-10|column column-2\",\n                \"12\": \"column column-12\"\n            }\n        },\n        link: {\n            size: 30,\n            nofollow: false,\n            target: false\n        },\n        addbar: [\n            \"paragraph\",\n            \"image\",\n            \"embed\",\n            \"line\",\n            \"table\",\n            \"snippet\",\n            \"quote\",\n            \"code\",\n            \"grid\",\n            \"layer\"\n        ],\n        addbarAdd: [],\n        addbarHide: [],\n        format: [\n            \"p\",\n            \"h1\",\n            \"h2\",\n            \"h3\",\n            \"ul\",\n            \"ol\"\n        ],\n        formatAdd: false,\n        outset: {\n            none: \"none\",\n            left: \"outset-left\",\n            both: \"outset-both\",\n            right: \"outset-right\"\n        },\n        align: {\n            left: \"align-left\",\n            center: \"align-center\",\n            right: \"align-right\",\n            justify: \"align-justify\"\n        },\n        valign: {\n            none: \"none\",\n            top: \"valign-top\",\n            middle: \"valign-middle\",\n            bottom: \"valign-bottom\"\n        },\n        shortcutsRemove: false,\n        shortcutsBase: {\n            \"meta+z\": \"## shortcuts.meta-z ##\",\n            \"meta+shift+z\": \"## shortcuts.meta-shift-z ##\",\n            \"meta+a\": \"## shortcuts.meta-a ##\",\n            \"meta+shift+a\": \"## shortcuts.meta-shift-a ##\",\n            \"meta+click\": \"## shortcuts.meta-click ##\"\n        },\n        shortcuts: {\n            \"ctrl+shift+d, meta+shift+d\": {\n                title: \"## shortcuts.meta-shift-d ##\",\n                name: \"meta+shift+d\",\n                command: \"block.duplicate\"\n            },\n            \"ctrl+shift+up, meta+shift+up\": {\n                title: \"## shortcuts.meta-shift-up ##\",\n                name: \"meta+shift+&uarr;\",\n                command: \"block.moveUp\"\n            },\n            \"ctrl+shift+down, meta+shift+down\": {\n                title: \"## shortcuts.meta-shift-down ##\",\n                name: \"meta+shift+&darr;\",\n                command: \"block.moveDown\"\n            },\n            \"ctrl+shift+m, meta+shift+m\": {\n                title: \"## shortcuts.meta-shift-m ##\",\n                name: \"meta+shift+m\",\n                command: \"inline.removeFormat\"\n            },\n            \"ctrl+b, meta+b\": {\n                title: \"## shortcuts.meta-b ##\",\n                name: \"meta+b\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"ctrl+i, meta+i\": {\n                title: \"## shortcuts.meta-i ##\",\n                name: \"meta+i\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"ctrl+u, meta+u\": {\n                title: \"## shortcuts.meta-u ##\",\n                name: \"meta+u\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"u\"\n                }\n            },\n            \"ctrl+h, meta+h\": {\n                title: \"## shortcuts.meta-h ##\",\n                name: \"meta+h\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"sup\"\n                }\n            },\n            \"ctrl+l, meta+l\": {\n                title: \"## shortcuts.meta-l ##\",\n                name: \"meta+l\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"sub\"\n                }\n            },\n            \"ctrl+alt+0, meta+alt+0\": {\n                title: \"## shortcuts.meta-alt-0 ##\",\n                name: \"meta+alt+0\",\n                command: \"block.format\",\n                params: {\n                    tag: \"p\"\n                }\n            },\n            \"ctrl+alt+1, meta+alt+1\": {\n                title: \"## shortcuts.meta-alt-1 ##\",\n                name: \"meta+alt+1\",\n                command: \"block.format\",\n                params: {\n                    tag: \"h1\"\n                }\n            },\n            \"ctrl+alt+2, meta+alt+2\": {\n                title: \"## shortcuts.meta-alt-2 ##\",\n                name: \"meta+alt+2\",\n                command: \"block.format\",\n                params: {\n                    tag: \"h2\"\n                }\n            },\n            \"ctrl+alt+3, meta+alt+3\": {\n                title: \"## shortcuts.meta-alt-3 ##\",\n                name: \"meta+alt+3\",\n                command: \"block.format\",\n                params: {\n                    tag: \"h3\"\n                }\n            },\n            \"ctrl+alt+4, meta+alt+4\": {\n                title: \"## shortcuts.meta-alt-4 ##\",\n                name: \"meta+alt+4\",\n                command: \"block.format\",\n                params: {\n                    tag: \"h4\"\n                }\n            },\n            \"ctrl+alt+5, meta+alt+5\": {\n                title: \"## shortcuts.meta-alt-5 ##\",\n                name: \"meta+alt+5\",\n                command: \"block.format\",\n                params: {\n                    tag: \"h5\"\n                }\n            },\n            \"ctrl+alt+6, meta+alt+6\": {\n                title: \"## shortcuts.meta-alt-6 ##\",\n                name: \"meta+alt+6\",\n                command: \"block.format\",\n                params: {\n                    tag: \"h6\"\n                }\n            },\n            \"ctrl+shift+7, meta+shift+7\": {\n                title: \"## shortcuts.meta-shift-7 ##\",\n                name: \"meta+shift+7\",\n                command: \"block.format\",\n                params: {\n                    tag: \"ol\"\n                }\n            },\n            \"ctrl+shift+8, meta+shift+8\": {\n                title: \"## shortcuts.meta-shift-8 ##\",\n                name: \"meta+shift+8\",\n                command: \"block.format\",\n                params: {\n                    tag: \"ul\"\n                }\n            },\n            \"ctrl+], meta+]\": {\n                title: \"## shortcuts.meta-indent ##\",\n                name: \"meta+]\",\n                command: \"list.indent\"\n            },\n            \"ctrl+[, meta+[\": {\n                title: \"## shortcuts.meta-outdent ##\",\n                name: \"meta+[\",\n                command: \"list.outdent\"\n            },\n            \"ctrl+k, meta+k\": {\n                title: \"## shortcuts.meta-k ##\",\n                name: \"meta+k\",\n                command: \"link.format\"\n            }\n        },\n        // private\n        disableMode: false,\n        markerChar: \"\\uFEFF\",\n        containers: {\n            main: [\n                \"bars\",\n                \"editor\",\n                \"source\",\n                \"statusbar\"\n            ],\n            bars: [\n                \"pathbar\",\n                \"toolbar\"\n            ]\n        },\n        tags: {\n            denied: [\n                \"font\",\n                \"html\",\n                \"head\",\n                \"link\",\n                \"title\",\n                \"body\",\n                \"meta\",\n                \"applet\",\n                \"marquee\"\n            ],\n            incode: [\n                \"!DOCTYPE\",\n                \"!doctype\",\n                \"html\",\n                \"head\",\n                \"link\",\n                \"title\",\n                \"body\",\n                \"meta\",\n                \"textarea\",\n                \"style\"\n            ],\n            form: [\n                \"form\",\n                \"input\",\n                \"button\",\n                \"select\",\n                \"textarea\",\n                \"legend\",\n                \"fieldset\"\n            ],\n            inline: [\n                \"a\",\n                \"svg\",\n                \"span\",\n                \"strong\",\n                \"strike\",\n                \"b\",\n                \"u\",\n                \"em\",\n                \"i\",\n                \"code\",\n                \"del\",\n                \"ins\",\n                \"samp\",\n                \"kbd\",\n                \"sup\",\n                \"sub\",\n                \"mark\",\n                \"var\",\n                \"cite\",\n                \"small\",\n                \"abbr\"\n            ],\n            block: [\n                \"pre\",\n                \"hr\",\n                \"ul\",\n                \"ol\",\n                \"li\",\n                \"p\",\n                \"h1\",\n                \"h2\",\n                \"h3\",\n                \"h4\",\n                \"h5\",\n                \"h6\",\n                \"dl\",\n                \"dt\",\n                \"dd\",\n                \"div\",\n                \"table\",\n                \"tbody\",\n                \"thead\",\n                \"tfoot\",\n                \"tr\",\n                \"th\",\n                \"td\",\n                \"blockquote\",\n                \"output\",\n                \"figcaption\",\n                \"figure\",\n                \"address\",\n                \"main\",\n                \"section\",\n                \"header\",\n                \"footer\",\n                \"aside\",\n                \"article\",\n                \"iframe\",\n                \"audio\",\n                \"source\"\n            ],\n            parser: [\n                \"pre\",\n                \"hr\",\n                \"ul\",\n                \"ol\",\n                \"dl\",\n                \"p\",\n                \"h1\",\n                \"h2\",\n                \"h3\",\n                \"h4\",\n                \"h5\",\n                \"h6\",\n                \"div\",\n                \"table\",\n                \"address\",\n                \"blockquote\",\n                \"figure\",\n                \"main\",\n                \"section\",\n                \"header\",\n                \"footer\",\n                \"aside\",\n                \"article\",\n                \"iframe\"\n            ]\n        },\n        bsmodal: false,\n        regex: {\n            youtube: /^https?\\:\\/\\/(?:www\\.youtube(?:\\-nocookie)?\\.com\\/|m\\.youtube\\.com\\/|youtube\\.com\\/)?(?:ytscreeningroom\\?vi?=|youtu\\.be\\/|vi?\\/|user\\/.+\\/u\\/\\w{1,2}\\/|embed\\/|watch\\?(?:.*\\&)?vi?=|\\&vi?=|\\?(?:.*\\&)?vi?=)([^#\\&\\?\\n\\/<>\"']*)/gi,\n            vimeo: /(http|https)?:\\/\\/(?:www.|player.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^\\/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:\\/[a-zA-Z0-9_-]+)?/gi,\n            imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n            url: /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z\\u00F0-\\u02AF0-9()!@:%_+.~#?&//=]*)/gi,\n            aurl1: /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim,\n            aurl2: /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim\n        },\n        addbarExtend: {},\n        buttonsObj: {\n            \"undo\": {\n                title: \"## buttons.undo ##\",\n                command: \"state.undo\"\n            },\n            \"redo\": {\n                title: \"## buttons.redo ##\",\n                command: \"state.redo\"\n            },\n            \"shortcut\": {\n                title: \"## buttons.shortcuts ##\",\n                observer: \"shortcut.observe\",\n                command: \"shortcut.popup\"\n            },\n            \"template\": {\n                title: \"## buttons.templates ##\",\n                command: \"template.popup\",\n                observer: \"template.observe\"\n            },\n            \"mobile\": {\n                title: \"## buttons.mobile-view ##\",\n                command: \"editor.toggleView\"\n            },\n            \"html\": {\n                title: \"## buttons.html ##\",\n                command: \"source.toggle\"\n            },\n            \"paragraph\": {\n                title: \"## blocks.paragraph ##\",\n                command: \"block.add\"\n            },\n            \"image\": {\n                title: \"## blocks.image ##\",\n                command: \"image.popup\",\n                observer: \"image.observe\"\n            },\n            \"embed\": {\n                title: \"## blocks.embed ##\",\n                command: \"embed.popup\",\n                observer: \"embed.observe\"\n            },\n            \"line\": {\n                title: \"## blocks.line ##\",\n                command: \"block.add\",\n                observer: \"block.observe\"\n            },\n            \"table\": {\n                title: \"## blocks.table ##\",\n                command: \"table.add\",\n                observer: \"table.observe\"\n            },\n            \"snippet\": {\n                title: \"## blocks.snippet ##\",\n                command: \"snippet.popup\",\n                observer: \"snippet.observe\"\n            },\n            \"quote\": {\n                title: \"## blocks.quote ##\",\n                command: \"block.add\",\n                observer: \"block.observe\"\n            },\n            \"text\": {\n                title: \"## blocks.text ##\",\n                command: \"block.add\"\n            },\n            \"code\": {\n                title: \"## blocks.code ##\",\n                command: \"block.add\",\n                observer: \"block.observe\"\n            },\n            \"grid\": {\n                title: \"## blocks.grid ##\",\n                command: \"grid.popup\",\n                observer: \"grid.observe\"\n            },\n            \"layer\": {\n                title: \"## blocks.layer ##\",\n                command: \"block.add\",\n                observer: \"block.observe\"\n            },\n            \"card\": {\n                title: \"## blocks.card ##\",\n                command: \"block.add\"\n            },\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            }\n        },\n        nested: [],\n        parser: {},\n        parserTags: [],\n        formatObj: {\n            p: {\n                title: \"## blocks.paragraph ##\",\n                type: \"paragraph\",\n                shortcut: \"Ctrl+Alt+0\"\n            },\n            div: {\n                title: \"## blocks.text ##\",\n                type: \"text\"\n            },\n            h1: {\n                title: '<span style=\"font-size: 20px; font-weight: bold;\">## headings.h1 ##</span>',\n                type: \"heading\",\n                shortcut: \"Ctrl+Alt+1\"\n            },\n            h2: {\n                title: '<span style=\"font-size: 16px; font-weight: bold;\">## headings.h2 ##</span>',\n                type: \"heading\",\n                shortcut: \"Ctrl+Alt+2\"\n            },\n            h3: {\n                title: '<span style=\"font-weight: bold;\">## headings.h3 ##</span>',\n                type: \"heading\",\n                shortcut: \"Ctrl+Alt+3\"\n            },\n            h4: {\n                title: '<span style=\"font-weight: bold;\">## headings.h4 ##</span>',\n                type: \"heading\",\n                shortcut: \"Ctrl+Alt+4\"\n            },\n            h5: {\n                title: '<span style=\"font-weight: bold;\">## headings.h5 ##</span>',\n                type: \"heading\",\n                shortcut: \"Ctrl+Alt+5\"\n            },\n            h6: {\n                title: '<span style=\"font-weight: bold;\">## headings.h6 ##</span>',\n                type: \"heading\",\n                shortcut: \"Ctrl+Alt+6\"\n            },\n            ol: {\n                title: \"1. ## list.ordered-list ##\",\n                type: \"list\",\n                shortcut: \"Ctrl+Shift+7\"\n            },\n            ul: {\n                title: \"&bull; ## list.unordered-list ##\",\n                type: \"list\",\n                shortcut: \"Ctrl+Shift+8\"\n            },\n            dl: {\n                title: \"## blocks.dlist ##\",\n                type: \"dlist\"\n            },\n            address: {\n                title: \"<em>## blocks.address ##</em>\",\n                type: \"address\"\n            }\n        }\n    };\n    ArticleEditor.lang.en = {\n        \"accessibility\": {\n            \"help-label\": \"Rich text editor\"\n        },\n        \"editor\": {\n            \"title\": \"Article\",\n            \"multiple\": \"Multiple\"\n        },\n        \"placeholders\": {\n            \"figcaption\": \"Type caption (optional)\",\n            \"text\": \"Type something...\",\n            \"code\": \"Edit to add code...\",\n            \"layer\": \"Press enter to add a new text...\"\n        },\n        \"popup\": {\n            \"link\": \"Link\",\n            \"add\": \"Add\",\n            \"grid\": \"Grid\",\n            \"back\": \"Back\",\n            \"image\": \"Image\",\n            \"snippets\": \"Snippets\",\n            \"add-image\": \"Add Image\"\n        },\n        \"shortcuts\": {\n            \"meta-a\": \"Select text in the block\",\n            \"meta-shift-a\": \"Select all blocks\",\n            \"meta-click\": \"Select multiple blocks\",\n            \"meta-z\": \"Undo\",\n            \"meta-shift-z\": \"Redo\",\n            \"meta-shift-m\": \"Remove inline format\",\n            \"meta-b\": \"Bold\",\n            \"meta-i\": \"Italic\",\n            \"meta-u\": \"Underline\",\n            \"meta-h\": \"Superscript\",\n            \"meta-l\": \"Subscript\",\n            \"meta-k\": \"Link\",\n            \"meta-alt-0\": \"Normal text\",\n            \"meta-alt-1\": \"Heading 1\",\n            \"meta-alt-2\": \"Heading 2\",\n            \"meta-alt-3\": \"Heading 3\",\n            \"meta-alt-4\": \"Heading 4\",\n            \"meta-alt-5\": \"Heading 5\",\n            \"meta-alt-6\": \"Heading 6\",\n            \"meta-shift-7\": \"Ordered List\",\n            \"meta-shift-8\": \"Unordered List\",\n            \"meta-indent\": \"Indent\",\n            \"meta-outdent\": \"Outdent\",\n            \"meta-shift-backspace\": \"Delete block\",\n            \"meta-shift-d\": \"Duplicate block\",\n            \"meta-shift-up\": \"Move line up\",\n            \"meta-shift-down\": \"Move line down\"\n        },\n        \"headings\": {\n            \"h1\": \"Heading 1\",\n            \"h2\": \"Heading 2\",\n            \"h3\": \"Heading 3\",\n            \"h4\": \"Heading 4\",\n            \"h5\": \"Heading 5\",\n            \"h6\": \"Heading 6\"\n        },\n        \"inline\": {\n            \"bold\": \"Bold\",\n            \"italic\": \"Italic\",\n            \"deleted\": \"Deleted\"\n        },\n        \"list\": {\n            \"unordered-list\": \"Unordered List\",\n            \"ordered-list\": \"Ordered List\",\n            \"indent\": \"Indent\",\n            \"outdent\": \"Outdent\"\n        },\n        \"link\": {\n            \"link\": \"Link\",\n            \"edit-link\": \"Edit link\",\n            \"unlink\": \"Unlink\",\n            \"link-in-new-tab\": \"Open link in new tab\",\n            \"save\": \"Save\",\n            \"insert\": \"Insert\",\n            \"cancel\": \"Cancel\",\n            \"text\": \"Text\",\n            \"url\": \"URL\"\n        },\n        \"table\": {\n            \"width\": \"Width\",\n            \"nowrap\": \"Nowrap\",\n            \"save\": \"Save\",\n            \"cancel\": \"Cancel\",\n            \"table-cell\": \"Table Cell\",\n            \"add-head\": \"Add head\",\n            \"remove-head\": \"Remove head\",\n            \"add-row-below\": \"Add row below\",\n            \"add-row-above\": \"Add row above\",\n            \"remove-row\": \"Remove row\",\n            \"add-column-after\": \"Add column after\",\n            \"add-column-before\": \"Add column before\",\n            \"remove-column\": \"Remove column\"\n        },\n        \"image\": {\n            \"or\": \"or\",\n            \"alt-text\": \"Alt Text\",\n            \"save\": \"Save\",\n            \"link\": \"Link\",\n            \"width\": \"Width\",\n            \"delete\": \"Delete\",\n            \"cancel\": \"Cancel\",\n            \"insert\": \"Insert\",\n            \"caption\": \"Caption\",\n            \"link-in-new-tab\": \"Open link in new tab\",\n            \"url-placeholder\": \"Paste url of image...\",\n            \"upload-new-placeholder\": \"Drag to upload a new image<br>or click to select\"\n        },\n        \"code\": {\n            \"code\": \"Code\",\n            \"insert\": \"Insert\",\n            \"save\": \"Save\",\n            \"cancel\": \"Cancel\"\n        },\n        \"embed\": {\n            \"embed\": \"Embed\",\n            \"caption\": \"Caption\",\n            \"insert\": \"Insert\",\n            \"save\": \"Save\",\n            \"cancel\": \"Cancel\",\n            \"description\": \"Paste any embed/html code or enter the url (vimeo or youtube video only)\",\n            \"responsive-video\": \"Responsive video\"\n        },\n        \"upload\": {\n            \"placeholder\": \"Drag to upload <br>or click to select\"\n        },\n        \"templates\": {\n            \"templates\": \"Templates\"\n        },\n        \"snippets\": {\n            \"snippets\": \"Snippets\"\n        },\n        \"form\": {\n            \"link\": \"Link\",\n            \"url\": \"Url\",\n            \"text\": \"Text\",\n            \"name\": \"Name\",\n            \"alt-text\": \"Alt Text\",\n            \"image\": \"Image\",\n            \"upload\": \"Upload\",\n            \"alignment\": \"Alignment\",\n            \"outset\": \"Outset\",\n            \"valign\": \"Valign\"\n        },\n        \"buttons\": {\n            \"mobile-view\": \"Mobile View\",\n            \"cancel\": \"Cancel\",\n            \"insert\": \"Insert\",\n            \"unlink\": \"Unlink\",\n            \"save\": \"Save\",\n            \"add\": \"Add\",\n            \"transform-to-text\": \"Transform to text\",\n            \"align\": \"Alignment\",\n            \"valign\": \"Valign\",\n            \"outset\": \"Outset\",\n            \"indent\": \"Indent\",\n            \"outdent\": \"Outdent\",\n            \"head\": \"Head\",\n            \"row\": \"Row\",\n            \"cell\": \"Cell\",\n            \"html\": \"HTML\",\n            \"templates\": \"Templates\",\n            \"shortcuts\": \"Keyboard Shortcuts\",\n            \"format\": \"Format\",\n            \"bold\": \"Bold\",\n            \"italic\": \"Italic\",\n            \"deleted\": \"Deleted\",\n            \"underline\": \"Underline\",\n            \"table\": \"Table\",\n            \"link\": \"Link\",\n            \"undo\": \"Undo\",\n            \"redo\": \"Redo\",\n            \"style\": \"Style\",\n            \"config\": \"Config\",\n            \"settings\": \"Settings\",\n            \"text\": \"Text\",\n            \"embed\": \"Embed\",\n            \"grid\": \"Grid\",\n            \"image\": \"Image\",\n            \"list\": \"List\",\n            \"delete\": \"Delete\",\n            \"duplicate\": \"Duplicate\",\n            \"sort\": \"Sort\",\n            \"edit\": \"Edit\",\n            \"inline\": \"Inline\"\n        },\n        \"blocks\": {\n            \"noneditable\": \"Noneditable\",\n            \"paragraph\": \"Paragraph\",\n            \"heading\": \"Heading\",\n            \"image\": \"Image\",\n            \"figcaption\": \"Figcaption\",\n            \"embed\": \"Embed\",\n            \"line\": \"Line\",\n            \"code\": \"Code\",\n            \"quote\": \"Quote\",\n            \"quoteitem\": \"Paragraph\",\n            \"snippet\": \"Snippet\",\n            \"column\": \"Column\",\n            \"grid\": \"Grid\",\n            \"list\": \"List\",\n            \"table\": \"Table\",\n            \"layer\": \"Layer\",\n            \"row\": \"Row\",\n            \"text\": \"Text\",\n            \"cell\": \"Cell\",\n            \"dlist\": \"Definition List\",\n            \"address\": \"Address\",\n            \"form\": \"Form\",\n            \"card\": \"Card\"\n        }\n    };\n    var App = function($element, settings, uuid) {\n        // environment\n        var maps = [\n            \"keycodes\",\n            \"prefix\",\n            \"dom\",\n            \"ajax\",\n            \"_repository\",\n            \"_subscribe\"\n        ];\n        for(var i = 0; i < maps.length; i++)this[maps[i]] = $ARX[maps[i]];\n        this.uuid = uuid;\n        this.$win = this.dom(window);\n        this.$doc = this.dom(document);\n        this.$body = this.dom(\"body\");\n        this.$element = $element;\n        this.app = this;\n        // initial\n        this.initialSettings = settings;\n        // starter\n        this._initer = [\n            \"setting\",\n            \"lang\"\n        ];\n        this._priority = [\n            \"container\",\n            \"editor\",\n            \"accessibility\",\n            \"state\"\n        ];\n        this._plugins = [];\n        // started\n        this.started = false;\n        // start\n        this.start();\n    };\n    App.prototype = {\n        // start\n        start: function(settings) {\n            if (!this.isTextarea()) return;\n            if (this.isStarted()) return;\n            if (settings) this.initialSettings = settings;\n            // core\n            this._initCore();\n            this._plugins = this.setting.get(\"plugins\");\n            // starting\n            this.broadcast(\"app.before.start\");\n            // init\n            this._initModules();\n            this._initPlugins();\n            // start\n            this._startPriority();\n            this._startModules();\n            this._startPlugins();\n            this.started = true;\n            // started\n            this.broadcast(\"app.start\");\n            // call load methods\n            this._loadModulesAndPlugins();\n            // disable mode\n            if (this.opts.disableMode !== false) this.disable();\n        },\n        isStarted: function() {\n            return this.started;\n        },\n        isTextarea: function() {\n            return this.$element.get().tagName === \"TEXTAREA\";\n        },\n        // stop\n        stop: function() {\n            if (this.isStopped()) return;\n            // stopping\n            this.broadcast(\"app.before.stop\");\n            this._stopPlugins();\n            this._stopPriority();\n            this._stopModules();\n            this.started = false;\n            // stopped\n            this.broadcast(\"app.stop\");\n        },\n        isStopped: function() {\n            return !this.started;\n        },\n        // destroy\n        destroy: function() {\n            clearTimeout(this.app.sync.typingTimer);\n            this.stop();\n            this.broadcast(\"app.destroy\");\n            this.$element.dataset($ARX.namespace, false);\n            var index = $ARX.instances.indexOf(this.uuid);\n            if (index > -1) $ARX.instances.splice(index, 1);\n        },\n        // disable / enable\n        disable: function() {\n            this.block.unset();\n            this.blocks.unset();\n            this.selection.removeAllRanges();\n            if (this.source.is()) this.source.close();\n            this.popup.close(false);\n            this.toolbar.disableSticky();\n            this.toolbar.disable();\n            this.path.disable();\n            this.topbar.disable();\n            this.editor.getOverlay().addClass(this.prefix + \"-editor-disabled\");\n            this.opts.disableMode = true;\n        },\n        enable: function() {\n            this.toolbar.enableSticky();\n            this.toolbar.enable();\n            this.path.enable();\n            this.topbar.enable();\n            this.editor.getOverlay().removeClass(this.prefix + \"-editor-disabled\");\n            this.opts.disableMode = false;\n        },\n        // broadcast\n        broadcast: function(name, params) {\n            var event = params instanceof App.Event ? params : new App.Event(name, params);\n            if (typeof this._subscribe[name] !== \"undefined\") {\n                var events = this._subscribe[name];\n                for(var i = 0; i < events.length; i++){\n                    var instance = this[events[i].module];\n                    if (instance) events[i].func.call(instance, event);\n                }\n            }\n            // callbacks\n            var callbacks = this.setting.has(\"subscribe\") ? this.setting.get(\"subscribe\") : {};\n            if (typeof callbacks[name] === \"function\") callbacks[name].call(this, event);\n            return event;\n        },\n        broadcastParams: function(name, params) {\n            var event = this.broadcast(name, params);\n            return event.getAll();\n        },\n        broadcastHtml: function(name, html) {\n            var event = this.broadcast(name, {\n                html: html\n            });\n            return event.get(\"html\");\n        },\n        // create\n        create: function(name) {\n            if (typeof this._repository[name] === \"undefined\") $ARX.error('The class \"' + name + '\" does not exist.');\n            var args = [].slice.call(arguments, 1);\n            var instance = new this._repository[name].proto();\n            // extend\n            instance._name = name;\n            instance.app = this;\n            var maps = [\n                \"uuid\",\n                \"prefix\",\n                \"dom\",\n                \"ajax\"\n            ];\n            for(var i = 0; i < maps.length; i++)instance[maps[i]] = this[maps[i]];\n            // lang & settings\n            if (this.lang) instance.lang = this.lang;\n            if (this.opts) instance.opts = this.opts;\n            // init\n            var result;\n            if (instance.init) result = instance.init.apply(instance, args);\n            return result ? result : instance;\n        },\n        // api\n        api: function(name) {\n            var args = [].slice.call(arguments, 1);\n            var namespaces = name.split(\".\");\n            var func = namespaces.pop();\n            var context = this;\n            for(var i = 0; i < namespaces.length; i++)context = context[namespaces[i]];\n            if (context && typeof context[func] === \"function\") return context[func].apply(context, args);\n        },\n        // init\n        _initCore: function() {\n            for(var i = 0; i < this._initer.length; i++)this[this._initer[i]] = this.create(this._initer[i]);\n            // opts\n            if (this.setting) this.opts = this.setting.dump();\n        },\n        _initModules: function() {\n            for(var key in this._repository)if (this._repository[key].type === \"module\" && this._initer.indexOf(key) === -1) this[key] = this.create(key);\n        },\n        _initPlugins: function() {\n            var plugins = this.setting.get(\"plugins\");\n            for(var key in this._repository)if (this._repository[key].type === \"plugin\" && plugins.indexOf(key) !== -1) this[key] = this.create(key);\n        },\n        // start\n        _startPriority: function() {\n            for(var i = 0; i < this._priority.length; i++)this._call(this[this._priority[i]], \"start\");\n        },\n        _startModules: function() {\n            this._iterate(\"module\", \"start\");\n        },\n        _startPlugins: function() {\n            this._iterate(\"plugin\", \"start\");\n        },\n        // stop\n        _stopPriority: function() {\n            var priority = this._priority.slice().reverse();\n            for(var i = 0; i < priority.length; i++)this._call(this[priority[i]], \"stop\");\n        },\n        _stopModules: function() {\n            this._iterate(\"module\", \"stop\");\n        },\n        _stopPlugins: function() {\n            this._iterate(\"plugin\", \"stop\");\n        },\n        // load\n        _loadModulesAndPlugins: function() {\n            this._iterate(\"module\", \"load\");\n            this._iterate(\"plugin\", \"load\");\n        },\n        // iterate\n        _iterate: function(type, method) {\n            for(var key in this._repository)if (this._repository.hasOwnProperty(key)) {\n                var isIn = type === \"module\" ? method === \"load\" || this._priority.indexOf(key) === -1 : this._plugins.indexOf(key) !== -1;\n                if (this._repository[key].type === type && isIn) this._call(this[key], method);\n            }\n        },\n        // call\n        _call: function(instance, method) {\n            if (typeof instance[method] === \"function\") instance[method].apply(instance);\n        }\n    };\n    App.Event = function(name, params) {\n        // local\n        this.name = name;\n        this.params = typeof params === \"undefined\" ? {} : params;\n        this.stopped = false;\n    };\n    App.Event.prototype = {\n        is: function(name) {\n            if (Array.isArray(name)) for(var i = 0; i < name.length; i++){\n                if (this.params[name[i]]) return true;\n            }\n            else return this.get(name);\n        },\n        has: function(name) {\n            return typeof this.params[name] !== \"undefined\";\n        },\n        getAll: function() {\n            return this.params;\n        },\n        get: function(name) {\n            return this.params[name];\n        },\n        set: function(name, value) {\n            this.params[name] = value;\n        },\n        stop: function() {\n            this.stopped = true;\n        },\n        isStopped: function() {\n            return this.stopped;\n        }\n    };\n    ArticleEditor.add(\"mixin\", \"block\", {\n        defaults: {\n            id: {\n                getter: \"getId\",\n                setter: \"setId\"\n            },\n            html: {\n                getter: \"getHtml\",\n                setter: \"setHtml\"\n            },\n            align: {\n                getter: \"getAlign\",\n                setter: \"setAlign\"\n            },\n            valign: {\n                getter: \"getValign\",\n                setter: \"setValign\"\n            },\n            outset: {\n                getter: \"getOutset\",\n                setter: \"setOutset\"\n            }\n        },\n        init: function(source, params) {\n            this.$block = source ? this.dom(source) : this.create(params);\n            // build & render\n            this._build(params);\n            this._buildData();\n            this._render();\n        },\n        // is\n        isType: function(type) {\n            var types = Array.isArray(type) ? type : [\n                type\n            ];\n            return types.indexOf(this.type) !== -1;\n        },\n        isBlock: function() {\n            return true;\n        },\n        isAllowedButton: function(name, obj) {\n            // type\n            var type = this.getType();\n            // hidden\n            if (typeof this.opts.buttons.hidden[type] !== \"undefined\") {\n                var val = this.opts.buttons.hidden[type];\n                if (Array.isArray(val) && val.indexOf(name) !== -1) return false;\n            }\n            // all\n            if (typeof obj.blocks === \"undefined\") return true;\n            var blocks = obj.blocks;\n            // except\n            if (blocks.except && blocks.except.indexOf(type) !== -1) return false;\n            // array of elements\n            if (Array.isArray(blocks.types) && blocks.types.indexOf(type) !== -1) return true;\n            if (blocks.all) {\n                // editable\n                if (blocks.all === true || blocks.all === \"all\") return true;\n                else if (blocks.all === \"editable\" && this.isEditable()) return true;\n                else if (blocks.all === \"first-level\" && this.isFirstLevel()) return true;\n                else if (blocks.all === \"noneditable\" && !this.isEditable()) return true;\n            }\n            return false;\n        },\n        isFirstLevel: function() {\n            return this.$block.attr(\"data-\" + this.prefix + \"-first-level\");\n        },\n        isSecondLevel: function() {\n            return [\n                \"quoteitem\",\n                \"row\",\n                \"cell\"\n            ].indexOf(this.type) !== -1;\n        },\n        isEditable: function() {\n            return typeof this.editable !== \"undefined\" && this.editable === true;\n        },\n        isInlineBlock: function() {\n            return typeof this.inline !== \"undefined\";\n        },\n        isAllSelected: function() {\n            if (this.isEditable()) return this.app.selection.isAll(this.$block);\n            else return true;\n        },\n        isEmpty: function() {\n            if (this.isEmptiable()) {\n                if (this.$block.hasClass(this.prefix + \"-empty-layer\")) return true;\n                else {\n                    var html = this.$block.html();\n                    html = html.trim();\n                    html = this._cleanEmpty(html);\n                    return html === \"\";\n                }\n            } else if (this.isEditable()) return this._isEmpty();\n        },\n        isEmptiable: function() {\n            return typeof this.emptiable !== \"undefined\";\n        },\n        isCaretStart: function() {\n            if (this.getType() === \"code\") return this.app.caret.is(this.$block, \"start\", false, false);\n            else if (this.getType() === \"list\") {\n                // check if the item is the first\n                var current = this.app.selection.getCurrent();\n                var $item = this.dom(current).closest(\"li\");\n                var $prev = $item.prev();\n                if ($prev.length === 0) return this.app.caret.is(this.$block, \"start\");\n                else return false;\n            } else if (this.isEditable()) return this.app.caret.is(this.$block, \"start\");\n            return true;\n        },\n        isCaretEnd: function() {\n            if (this.getType() === \"code\") return this.app.caret.is(this.$block, \"end\", false, false);\n            else if (this.getType() === \"address\") return this.app.caret.is(this.$block, \"end\", false, true, false);\n            else if (this.isEditable()) return this.app.caret.is(this.$block, \"end\");\n            return true;\n        },\n        // get\n        getData: function(name) {\n            var data = {};\n            Object.keys(this.data).forEach((function(key) {\n                data[key] = this[this.data[key].getter].apply(this);\n            }).bind(this));\n            return name ? data[name] : data;\n        },\n        getType: function() {\n            return this.type;\n        },\n        getTag: function() {\n            return this.$block ? this.$block.get().tagName.toLowerCase() : false;\n        },\n        getTitle: function() {\n            var type = this.getType();\n            var titles = this.lang.get(\"blocks\");\n            var title = this.$block.attr(\"data-title\");\n            return typeof titles[type] !== \"undefined\" ? titles[type] : title;\n        },\n        getOffset: function() {\n            var offset = this.app.editor.getFrame().offset();\n            var elOffset = this.$block.offset();\n            return {\n                top: offset.top + elOffset.top,\n                left: offset.left + elOffset.left\n            };\n        },\n        getBlock: function() {\n            return this.$block;\n        },\n        getHtml: function() {\n            return this.$block.html();\n        },\n        getPlainText: function() {\n            var html = this.$block.html();\n            return this.app.content.getTextFromHtml(html, {\n                nl: true\n            });\n        },\n        getOuterHtml: function() {\n            return this.$block.get().outerHTML;\n        },\n        getParent: function(type) {\n            type = type ? \"=\" + type : \"\";\n            var $el = this.$block.parent().closest(\"[data-\" + this.prefix + \"-type\" + type + \"]\");\n            if ($el.length !== 0) return $el.dataget(\"instance\");\n            return false;\n        },\n        getNext: function(type) {\n            type = type ? \"=\" + type : \"\";\n            var $el = this.$block.nextElement();\n            if ($el.length !== 0 && $el.is(\"[data-\" + this.prefix + \"-type\" + type + \"]\")) return $el.dataget(\"instance\");\n            return false;\n        },\n        getPrev: function(type) {\n            type = type ? \"=\" + type : \"\";\n            var $el = this.$block.prevElement();\n            if ($el.length !== 0 && $el.is(\"[data-\" + this.prefix + \"-type\" + type + \"]\")) return $el.dataget(\"instance\");\n            return false;\n        },\n        getChildFirst: function(type) {\n            type = type ? \"=\" + type : \"\";\n            var $el = this.$block.find(\"[data-\" + this.prefix + \"-type\" + type + \"]\").first();\n            if ($el.length !== 0) return $el.dataget(\"instance\");\n            return false;\n        },\n        getChildLast: function(type) {\n            type = type ? \"=\" + type : \"\";\n            var $el = this.$block.find(\"[data-\" + this.prefix + \"-type\" + type + \"]\").last();\n            if ($el.length !== 0) return $el.dataget(\"instance\");\n            return false;\n        },\n        getId: function() {\n            return this.$block.attr(\"id\");\n        },\n        getAlign: function() {\n            var obj = this.opts.align;\n            if (!obj) return false;\n            var value = \"left\";\n            for(var key in obj)if (this.$block.hasClass(obj[key])) value = key;\n            return value;\n        },\n        getValign: function() {\n            var obj = this.opts.valign;\n            if (!obj) return false;\n            var value = \"none\";\n            for(var key in obj)if (this.$block.hasClass(obj[key])) value = key;\n            return value;\n        },\n        getOutset: function() {\n            var obj = this.opts.outset;\n            if (!obj) return false;\n            var value = \"none\";\n            for(var key in obj)if (this.$block.hasClass(obj[key])) value = key;\n            return value;\n        },\n        getCaption: function() {\n            var $caption = this.$block.find(\"figcaption\");\n            return $caption.length !== 0 ? $caption.html().trim() : \"\";\n        },\n        // set\n        setData: function(data) {\n            for(var key in data){\n                if (!this.data[key]) continue;\n                this[this.data[key].setter].call(this, data[key]);\n            }\n        },\n        setEmpty: function() {\n            this.$block.html(\"\");\n            if (this.isEmptiable()) this._addEmptyButton(this.$block);\n        },\n        setSelectAll: function() {\n            if (this.isEditable()) this.app.selection.select(this.$block);\n        },\n        setHtml: function(html) {\n            this.$block.html(html);\n            if (html !== \"\") this._buildInstancesInside(this.$block);\n        },\n        setId: function(value) {\n            if (value === \"\") this.$block.removeAttr(\"id\");\n            else this.$block.attr(\"id\", value);\n        },\n        setAlign: function(value) {\n            this._removeObjClasses(this.opts.align);\n            this.$block.addClass(this.opts.align[value]);\n        },\n        setValign: function(value) {\n            this._removeObjClasses(this.opts.valign);\n            if (value !== \"none\") this.$block.addClass(this.opts.valign[value]);\n        },\n        setOutset: function(value) {\n            this._removeObjClasses(this.opts.outset);\n            if (value !== \"none\") this.$block.addClass(this.opts.outset[value]);\n            // ui\n            this.app.control.updatePosition();\n        },\n        setCaption: function(value) {\n            if (value === \"\") this.$block.find(\"figcaption\").remove();\n            else {\n                var $caption = this.$block.find(\"figcaption\");\n                if ($caption.length === 0) {\n                    $caption = this.dom(\"<figcaption>\");\n                    $caption.attr(\"data-placeholder\", this.lang.get(\"placeholders.figcaption\"));\n                    this.$block.append($caption);\n                    // create\n                    this.app.create(\"block.figcaption\", $caption);\n                }\n                $caption.html(value);\n            }\n        },\n        setClassFromObj: function(obj, key) {\n            this._removeObjClasses(obj);\n            var value = obj[key];\n            if (value !== \"none\" || value !== false) this.$block.addClass(value);\n        },\n        // has\n        hasClass: function(value) {\n            value = typeof value === \"string\" ? [\n                value\n            ] : value;\n            for(var i = 0; i < value.length; i++){\n                if (this.$block.hasClass(value[i])) return value[i];\n            }\n            return false;\n        },\n        // remove\n        remove: function(broadcast) {\n            var parent = this.getParent();\n            var type = this.getType();\n            this.$block.remove();\n            // emptiable\n            if (parent && parent.isEmptiable() && parent.isEmpty()) parent.setEmpty();\n            // broadcast\n            if (broadcast) this.app.broadcast(\"block.remove\", {\n                type: type,\n                parent: parent\n            });\n        },\n        // duplicate\n        duplicate: function(empty) {\n            var type = this.getType();\n            var $clone = this.$block.clone();\n            $clone.removeClass(this.prefix + \"-block-focus \" + this.prefix + \"-block-multiple-hover\");\n            if (empty) $clone.html(\"\");\n            return this.app.create(\"block.\" + type, $clone);\n        },\n        duplicateEmpty: function() {\n            return this.duplicate(true);\n        },\n        // insert\n        insertEmpty: function(params) {\n            params = params || {};\n            params.instance = this.app.block.create();\n            return this.insert(params);\n        },\n        insert: function(params) {\n            var defs = {\n                instance: false,\n                position: false,\n                caret: false,\n                remove: true,\n                type: \"input\"\n            };\n            // params\n            var p = $ARX.extend({}, defs, params);\n            var $block = p.instance.getBlock();\n            // delete selection\n            if (this.isEditable()) this.app.selection.deleteContents();\n            // list to list\n            if (p.instance.getType() === \"list\" && this.getType() === \"list\") {\n                if (p.type === \"duplicate\") {\n                    p.position = p.position || \"after\";\n                    this.$block[p.position]($block);\n                    // set caret\n                    if (p.caret) this.app.block.set(p.instance, p.caret);\n                } else this.app.insertion.insertListToList($block, this.$block, p.caret);\n            } else {\n                // variable to variable\n                if (p.instance.isInlineBlock() && this.isInlineBlock()) {\n                    this.$block.after($block);\n                    this.$block.remove();\n                } else if (p.instance.isInlineBlock() && this.isEditable()) this.app.insertion.insertNode(p.instance.getBlock(), false, true);\n                else if (this.isEditable() && this.getType() !== \"card\") {\n                    // detect position\n                    p.position = this.app.insertion.detectPosition(this.$block, p.position);\n                    // insert\n                    if (p.position === \"split\") this.app.element.split(this.$block).before($block);\n                    else {\n                        this.$block[p.position]($block);\n                        // remove\n                        if (p.remove && this.isEmpty()) this.$block.remove();\n                    }\n                } else {\n                    p.position = p.position || \"after\";\n                    this.$block[p.position]($block);\n                }\n                // rebuild\n                this.app.editor.build();\n                // set caret\n                if (p.caret) this.app.block.set(p.instance, p.caret);\n                // observe\n                this.app.toolbar.observe();\n                // broadcast\n                this.app.broadcast(\"block.add\", {\n                    instance: p.instance,\n                    type: p.type\n                });\n                return p.instance;\n            }\n        },\n        // append\n        appendNext: function() {\n            var next = this.getNext();\n            // next empty\n            if (next.isEmpty()) {\n                next.remove();\n                return;\n            } else if (this.isEmpty()) {\n                this.remove();\n                this.app.block.set(next, \"start\");\n                return;\n            }\n            // not empty\n            var html = next.getHtml();\n            var type = this.getType();\n            var nextType = next.getType();\n            var insert = true;\n            var remove = true;\n            // code\n            if (type === \"code\" && nextType !== \"code\") html = next.getPlainText();\n            // next type\n            if (nextType === \"dlist\") {\n                if (type === \"dlist\") {\n                    // append as nodes\n                    var nodes = next.getBlock().children();\n                    this.$block.append(nodes);\n                    insert = false;\n                } else // insert with br\n                html = next.getPlainText(true);\n            } else if (nextType === \"list\") {\n                if (type === \"list\") {\n                    var $items = next.getBlock().children();\n                    this.$block.append($items);\n                    insert = false;\n                    remove = true;\n                } else {\n                    html = this._appendListHtml(next.getBlock(), html);\n                    remove = next.isEmpty();\n                }\n            }\n            // append\n            if (insert) {\n                // set caret after inline\n                var inline = this.app.selection.getTopInline();\n                if (inline) this.app.caret.set(inline, \"after\");\n                // insert\n                this.app.insertion.insertHtml(html, \"start\");\n                this._buildInstancesInside(this.$block);\n            }\n            // remove\n            if (remove) next.remove();\n        },\n        appendToPrev: function() {\n            var prev = this.getPrev();\n            // current empty\n            if (this.isEmpty()) {\n                this.remove();\n                this.app.block.set(prev, \"end\");\n                return;\n            } else if (prev.isEmpty()) {\n                prev.remove();\n                this.app.control.updatePosition();\n                return;\n            }\n            // not empty\n            var prevType = prev.getType();\n            var html = this.getHtml();\n            var type = this.getType();\n            var insert = true;\n            var remove = true;\n            // code\n            if (type !== \"code\" && prevType === \"code\") html = this.getPlainText();\n            // current type\n            if (type === \"dlist\") {\n                if (prevType === \"dlist\") {\n                    // append as nodes\n                    var nodes = this.getBlock().children();\n                    this.app.block.set(prev, \"end\");\n                    prev.getBlock().append(nodes);\n                    insert = false;\n                } else // insert with br\n                html = this.getPlainText(true);\n            } else if (type === \"list\") {\n                if (prevType === \"list\") {\n                    var $items = this.getBlock().children();\n                    this.app.block.set(prev, \"end\");\n                    prev.getBlock().append($items);\n                    insert = false;\n                    remove = true;\n                } else {\n                    html = this._appendListHtml(this.getBlock(), html);\n                    remove = this.isEmpty();\n                }\n            }\n            // append\n            if (insert) {\n                // set\n                this.app.block.set(prev, \"end\");\n                // set caret after inline\n                var inline = this.app.selection.getTopInline();\n                if (inline) this.app.caret.set(inline, \"after\");\n                // insert\n                this.app.insertion.insertHtml(html, \"start\");\n                this._buildInstancesInside(prev.getBlock());\n            }\n            // remove\n            if (remove) this.remove();\n        },\n        append: function(instance, set) {\n            if (this.isEmptiable() && this.isEmpty()) {\n                this.$block.html(\"\");\n                this.$block.removeClass(this.prefix + \"-empty-layer\");\n            }\n            this.$block.append(instance.getBlock());\n            if (set !== false) this.app.block.set(instance);\n            // broadcast\n            this.app.broadcast(\"block.add\", {\n                instance: instance\n            });\n        },\n        // change\n        change: function(newInstance, broadcast) {\n            var $newBlock = newInstance.getBlock();\n            this.$block.after($newBlock);\n            this.$block.remove();\n            // rebuild\n            this.app.editor.build();\n            this.app.toolbar.observe();\n            // set\n            this.app.block.set(newInstance);\n            // broadcast\n            if (broadcast !== false) this.app.broadcast(\"block.change\", {\n                instance: newInstance\n            });\n        },\n        // move\n        moveUp: function() {\n            var target = this.getPrev();\n            if (!target) return;\n            this._move(target, \"before\");\n        },\n        moveDown: function(direction) {\n            var target = this.getNext();\n            if (!target) return;\n            this._move(target, \"after\");\n        },\n        // private\n        _appendListHtml: function($target, html) {\n            var $item = $target.find(\"li\").first();\n            html = $item.html().trim();\n            html = html.replace(/<\\/li>/gi, \"</li><br>\");\n            html = html.replace(/<(ul|ol)/gi, \"<br><$1\");\n            html = this.app.content.removeTags(html, [\n                \"ul\",\n                \"ol\",\n                \"li\"\n            ]);\n            html = html.trim();\n            html = html.replace(/<br\\s?\\/?>$/gi, \"\");\n            $item.remove();\n            return html;\n        },\n        _move: function(target, func) {\n            // save selection\n            if (this.isEditable()) this.app.selection.save(this.$block);\n            // move\n            var $targetBlock = target.getBlock();\n            $targetBlock[func](this.$block, true);\n            // set force\n            this.app.block.set(this.$block, false, true);\n            // restore selection\n            if (this.isEditable()) this.app.selection.restore(this.$block);\n        },\n        _build: function(params) {\n            // build empty\n            if (this.isEmptiable() && this.isEmpty()) this._addEmptyButton(this.$block);\n            // build\n            if (this.build) this.build(params);\n            // instances inside\n            this._buildInstancesInside(this.$block);\n        },\n        _buildData: function() {\n            if (!this.data) this.data = {};\n            this.data = $ARX.extend({}, true, this.defaults, this.data);\n        },\n        _buildInstancesInside: function($block) {\n            $block.find(\"[data-\" + this.prefix + \"-type]\").each(this._buildInstanceInside.bind(this));\n        },\n        _buildInstanceInside: function($node) {\n            var instance = $node.dataget(\"instance\");\n            if (!instance) {\n                var type = $node.attr(\"data-\" + this.prefix + \"-type\");\n                this.app.create(\"block.\" + type, $node);\n            }\n        },\n        _buildItems: function(selector, type) {\n            var $items = this.$block.find(selector);\n            if ($items.length !== 0) $items.each((function($node) {\n                this.app.create(\"block.\" + type, $node);\n            }).bind(this));\n        },\n        _buildCaption: function() {\n            if (this.getTag() !== \"figure\") return;\n            this.$block.find(\"figcaption\").attr(\"data-placeholder\", this.lang.get(\"placeholders.figcaption\"));\n        },\n        _isEmpty: function() {\n            var html = this.$block.text();\n            html = this._cleanEmpty(html);\n            return html === \"\";\n        },\n        _getNameByTag: function() {\n            var tag = this.getTag();\n            var name = this.app.utils.capitalize(tag);\n            return name;\n        },\n        _render: function() {\n            this._renderEdit();\n            this._renderDraggable();\n            this._renderEditable();\n        },\n        _renderDraggable: function() {\n            if (typeof this.draggable !== \"undefined\" && this.draggable === false) {\n                this.$block.on(\"dragstart\", function(e) {\n                    e.preventDefault();\n                    return false;\n                });\n                this.$block.find(\"img\").on(\"dragstart\", function(e) {\n                    e.preventDefault();\n                    return false;\n                });\n            }\n        },\n        _renderEditable: function() {\n            if (this.isEditable()) this.$block.attr(\"contenteditable\", true);\n            else if (typeof this.editable !== \"undefined\" && this.editable === false) this.$block.attr(\"contenteditable\", false);\n            if (this.isEditable() && !this.opts.editor.grammarly) this.$block.attr(\"data-gramm_editor\", false);\n        },\n        _renderEdit: function() {\n            this.$block.dataset(\"instance\", this);\n            this.$block.attr(\"data-\" + this.prefix + \"-type\", this.getType());\n        },\n        _cleanEmpty: function(html) {\n            html = this.app.utils.removeInvisibleChars(html);\n            html = html.search(/^<br\\s?\\/?>$/) !== -1 ? \"\" : html;\n            html = html.replace(/\\n/g, \"\");\n            return html;\n        },\n        _removeObjClasses: function(obj) {\n            var classes = this._buildObjClasses(obj);\n            this.$block.removeClass(classes.join(\" \"));\n            this.app.element.removeEmptyAttrs(this.$block, [\n                \"class\"\n            ]);\n        },\n        _buildObjClasses: function(obj) {\n            var classes = [];\n            for(var key in obj)if (obj[key]) classes.push(obj[key]);\n            return classes;\n        },\n        _addEmptyButton: function($el) {\n            if ($el.hasClass(this.prefix + \"-empty-layer\")) return;\n            $el.addClass(this.prefix + \"-empty-layer\");\n            var $plus = this.dom(\"<span>\").addClass(this.prefix + \"-plus-button\");\n            // button\n            this.app.create(\"button\", {\n                name: \"plus\",\n                element: $plus\n            }, {\n                command: \"addbar.popup\"\n            });\n            // append\n            $el.append($plus);\n        }\n    });\n    ArticleEditor.add(\"mixin\", \"tool\", {\n        init: function(name, obj, popup, data) {\n            this.name = name;\n            this.setter = popup.get(\"setter\");\n            this.popup = popup;\n            this.data = data;\n            this.obj = this._observe(obj);\n            if (this.obj) this._build();\n        },\n        getElement: function() {\n            return this.$tool;\n        },\n        getInput: function() {\n            return this.$input;\n        },\n        getValue: function() {\n            var value = this.$input.val();\n            return value.trim();\n        },\n        setValue: function(value) {\n            this.$input.val(value);\n        },\n        setFocus: function() {\n            this.$input.focus();\n        },\n        trigger: function(value) {\n            this.setValue(value);\n            if (this.setter) this.app.api(this.setter, this.popup);\n        },\n        // private\n        _build: function() {\n            this._buildTool();\n            this._buildLabel();\n            this._buildInputElement();\n            this._buildInput();\n            this._buildEvent();\n            // props\n            if (this._has(\"placeholder\")) this.$input.attr(\"placeholder\", this.lang.parse(this.obj.placeholder));\n            if (this._has(\"width\")) this.$input.css(\"width\", this.obj.width);\n            if (this._has(\"classname\")) this.$input.addClass(this.obj.classname);\n        },\n        _buildInputElement: function() {\n            this.$input = this.dom(\"<\" + this._getInputParam(\"tag\") + \">\").addClass(this.prefix + this._getInputParam(\"classname\"));\n            this.$input.attr({\n                \"name\": this.name,\n                \"type\": this._getInputParam(\"type\"),\n                \"data-type\": this.type\n            });\n            this.$input.dataset(\"instance\", this);\n        },\n        _buildInput: function() {\n            return;\n        },\n        _buildEvent: function() {\n            var types = [\n                \"segment\"\n            ];\n            if (types.indexOf(this.type) === -1 && this.setter) {\n                var events = this.type === \"checkbox\" || this.type === \"select\" ? \"change\" : \"keydown blur\";\n                events = this.type === \"number\" ? events + \" change\" : events;\n                this.$input.on(events, this._catchSetter.bind(this));\n            }\n        },\n        _buildTool: function() {\n            this.$tool = this.dom(\"<div>\").addClass(this.prefix + \"-form-item\").dataset(\"instance\", this);\n        },\n        _buildLabel: function() {\n            if (this.type !== \"checkbox\" && this._has(\"label\")) {\n                this.$label = this.dom(\"<label>\").addClass(this.prefix + \"-form-label\").html(this.lang.parse(this.obj.label));\n                this.$tool.append(this.$label);\n            }\n        },\n        _getInputParam: function(name) {\n            return this.input && typeof this.input[name] !== \"undefined\" ? this.input[name] : \"\";\n        },\n        _get: function(name) {\n            return this.obj[name];\n        },\n        _has: function(name) {\n            return Object.prototype.hasOwnProperty.call(this.obj, name);\n        },\n        _observe: function(obj) {\n            if (Object.prototype.hasOwnProperty.call(obj, \"observer\")) obj = this.app.api(obj.observer, obj, this.name);\n            return obj;\n        },\n        _catchSetter: function(e) {\n            if (e.type === \"keydown\" && e.which !== 13) return;\n            if (e.type === \"keydown\") e.preventDefault();\n            // call setter\n            this.app.api(this.setter, this.popup);\n        }\n    });\n    ArticleEditor.add(\"module\", \"lang\", {\n        init: function() {\n            this.langKey = this.app.setting.get(\"editor.lang\");\n            this.vars = this._build();\n        },\n        get: function(name) {\n            var value = this._get(name, this.vars);\n            if (typeof value === \"undefined\" && this.langKey !== \"en\") value = this._get(name, $ARX.lang.en);\n            return typeof value === \"undefined\" ? \"\" : value;\n        },\n        parse: function(str) {\n            if (typeof str !== \"string\") return str;\n            var matches = str.match(/## (.*?) ##/g);\n            if (matches) for(var i = 0; i < matches.length; i++){\n                var key = matches[i].replace(/^##\\s/g, \"\").replace(/\\s##$/g, \"\");\n                str = str.replace(matches[i], this.get(key));\n            }\n            return str;\n        },\n        // private\n        _get: function(name, vars) {\n            var value;\n            var arr = name.split(\".\");\n            if (arr.length === 1) value = vars[name];\n            else value = typeof vars[arr[0]] !== \"undefined\" ? vars[arr[0]][arr[1]] : undefined;\n            return value;\n        },\n        _build: function() {\n            var vars = $ARX.lang.en;\n            if (this.langKey !== \"en\") vars = $ARX.lang[this.langKey] !== \"undefined\" ? $ARX.lang[this.langKey] : vars;\n            return vars;\n        }\n    });\n    ArticleEditor.add(\"module\", \"setting\", {\n        init: function() {\n            this.opts = this._build();\n        },\n        dump: function() {\n            return this.opts;\n        },\n        has: function(name) {\n            var value;\n            var arr = name.split(\".\");\n            if (arr.length === 1) value = typeof this.opts[name] !== \"undefined\";\n            else value = typeof this.opts[arr[0]] !== \"undefined\" && typeof this.opts[arr[1]] !== \"undefined\";\n            return value;\n        },\n        set: function(section, name, value) {\n            if (typeof this.opts[section] === \"undefined\") this.opts[section] = {};\n            if (typeof value === \"undefined\") this.opts[section] = name;\n            else this.opts[section][name] = value;\n        },\n        get: function(name) {\n            var value;\n            var arr = name.split(\".\");\n            if (arr.length === 1) value = this.opts[name];\n            else value = typeof this.opts[arr[0]] !== \"undefined\" ? this.opts[arr[0]][arr[1]] : undefined;\n            return value;\n        },\n        // private\n        _build: function() {\n            var opts = $ARX.extend(true, {}, $ARX.opts, this.app.initialSettings);\n            opts = $ARX.extend(true, opts, $ARX.settings);\n            return opts;\n        }\n    });\n    ArticleEditor.add(\"module\", \"container\", {\n        init: function() {\n            this.blurclass = this.prefix + \"-in-blur\";\n            this.focusclass = this.prefix + \"-in-focus\";\n        },\n        start: function() {\n            this._buildMain();\n            this._buildContainers(this.$main, this.opts.containers.main);\n            this._buildBSModal();\n        },\n        stop: function() {\n            this.$main.remove();\n        },\n        get: function(name) {\n            return this[\"$\" + name];\n        },\n        setFocus: function() {\n            this.$main.removeClass(this.blurclass).addClass(this.focusclass);\n        },\n        setBlur: function() {\n            this.$main.removeClass(this.focusclass).addClass(this.blurclass);\n        },\n        isFocus: function() {\n            return this.$main.hasClass(this.focusclass);\n        },\n        // private\n        _buildMain: function() {\n            this.$main = this.dom(\"<div>\").attr(this.prefix + \"-uuid\", this.uuid);\n            this.$main.addClass(this.prefix + \"-container \" + this.prefix + \"-container-\" + this.uuid);\n            // place\n            this.app.$element.after(this.$main);\n        },\n        _buildContainers: function($target, containers) {\n            for(var i = 0; i < containers.length; i++){\n                var name = containers[i];\n                var elName = \"$\" + name;\n                // create\n                this[elName] = this._createContainer(name);\n                // nested\n                if (typeof this.opts.containers[name] !== \"undefined\") this._buildContainers(this[elName], this.opts.containers[name]);\n                // append\n                $target.append(this[elName]);\n            }\n        },\n        _buildBSModal: function() {\n            this.opts.bsmodal = this.$main.closest(\".modal-dialog\").length !== 0;\n        },\n        _createContainer: function(name) {\n            return this.dom(\"<div>\").addClass(this.prefix + \"-\" + name + \"-container\");\n        }\n    });\n    ArticleEditor.add(\"module\", \"accessibility\", {\n        start: function() {\n            this._buildRole();\n            this._buildLabel();\n        },\n        _buildRole: function() {\n            this.app.editor.getEditor().attr({\n                \"aria-labelledby\": this.prefix + \"-voice\",\n                \"role\": \"presentation\"\n            });\n        },\n        _buildLabel: function() {\n            var html = this.lang.get(\"accessibility.help-label\");\n            var $label = this._createLabel(html);\n            // append\n            this.app.container.get(\"main\").prepend($label);\n        },\n        _createLabel: function(html) {\n            var $label = this.dom(\"<span />\").addClass(this.prefix + \"-voice-label\");\n            $label.attr({\n                \"id\": this.prefix + \"-voice-\" + this.uuid,\n                \"aria-hidden\": false\n            });\n            $label.html(html);\n            return $label;\n        }\n    });\n    ArticleEditor.add(\"module\", \"utils\", {\n        // mobile\n        isMobile: function() {\n            return \"ontouchstart\" in document.documentElement;\n        },\n        // invisible chars\n        createInvisibleChar: function() {\n            return document.createTextNode(this.opts.markerChar);\n        },\n        searchInvisibleChars: function(str) {\n            return str.search(/^\\uFEFF$/g);\n        },\n        removeInvisibleChars: function(str) {\n            return str.replace(/\\uFEFF/g, \"\");\n        },\n        // wrapper\n        wrap: function(html, func) {\n            var $w = this.dom(\"<div>\").html(html);\n            func($w);\n            html = $w.html();\n            $w.remove();\n            return html;\n        },\n        // arrays\n        extendArray: function(arr, extend) {\n            arr = arr.concat(arr);\n            if (extend) for(var i = 0; i < extend.length; i++)arr.push(extend[i]);\n            return arr;\n        },\n        removeFromArrayByValue: function(arr, val) {\n            val = Array.isArray(val) ? val : [\n                val\n            ];\n            var index;\n            for(var i = 0; i < val.length; i++){\n                index = arr.indexOf(val[i]);\n                if (index > -1) arr.splice(index, 1);\n            }\n            return arr;\n        },\n        sumOfArray: function(arr) {\n            return arr.reduce(function(a, b) {\n                return parseInt(a) + parseInt(b);\n            }, 0);\n        },\n        // object\n        getObjectIndex: function(obj, key) {\n            return Object.keys(obj).indexOf(key);\n        },\n        insertToObject: function(key, value, obj, pos) {\n            return Object.keys(obj).reduce(function(ac, a, i) {\n                if (i === pos) ac[key] = value;\n                ac[a] = obj[a];\n                return ac;\n            }, {});\n        },\n        // random\n        getRandomId: function() {\n            var id = \"\";\n            var possible = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n            for(var i = 0; i < 12; i++)id += possible.charAt(Math.floor(Math.random() * possible.length));\n            return id;\n        },\n        // escape\n        escapeRegExp: function(s) {\n            return s.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\n        },\n        // string\n        capitalize: function(str) {\n            str = str.toLowerCase();\n            return str.charAt(0).toUpperCase() + str.slice(1);\n        },\n        // data\n        extendData: function(data, obj) {\n            for(var key in obj)if (key === \"elements\") data = this._extendDataElements(data, obj[key]);\n            else data = this._setData(data, key, obj[key]);\n            return data;\n        },\n        _extendDataElements: function(data, value) {\n            this.dom(value).each((function($node) {\n                if ($node.get().tagName === \"FORM\") {\n                    var serializedData = $node.serialize(true);\n                    Object.keys(serializedData).forEach((function(key) {\n                        data = this._setData(data, key, serializedData[key]);\n                    }).bind(this));\n                } else {\n                    var name = $node.attr(\"name\") ? $node.attr(\"name\") : $node.attr(\"id\");\n                    data = this._setData(data, name, $node.val());\n                }\n            }).bind(this));\n            return data;\n        },\n        _setData: function(data, name, value) {\n            if (data instanceof FormData) data.append(name, value);\n            else data[name] = value;\n            return data;\n        },\n        // css\n        cssToObject: function(str) {\n            let regex = /([\\w-]*)\\s*:\\s*([^;]*)/g, match, props = {};\n            do {\n                match = regex.exec(str);\n                if (match != null) props[match[1]] = this._normalizeValue(match[1], match[2].trim());\n            }while (match);\n            return props;\n        },\n        _normalizeValue: function(key, val) {\n            val = typeof val === \"string\" ? val.replace(/'/g, '\"') : val;\n            val = val.trim().replace(/;$/, \"\");\n            if (key.search(/color|background/) !== -1) {\n                val = this.convertRgb2hex(val);\n                val = val.toLowerCase();\n            }\n            if (key.search(/family/) !== -1) val = val.replace(/\"/g, \"\");\n            return val;\n        },\n        // color\n        getInvertedColor: function(hex) {\n            hex = hex === \"\" || hex === null || typeof hex === \"undefined\" ? \"#ffffff\" : hex;\n            hex = this.normalizeColor(hex);\n            hex = this._removeHexDiese(hex);\n            var r = parseInt(hex.slice(0, 2), 16), g = parseInt(hex.slice(2, 4), 16), b = parseInt(hex.slice(4, 6), 16);\n            return r * 0.299 + g * 0.587 + b * 0.114 > 186 ? \"black\" : \"white\";\n        },\n        normalizeColor: function(color) {\n            color = color ? this.convertRgb2hex(color) : color;\n            color = color ? this.convertShorthex2long(color) : color;\n            return color;\n        },\n        convertRgb2hex: function(color) {\n            if (color.search(/^rgb/i) === -1) return color;\n            var arr = color.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n            return arr && arr.length === 4 ? \"#\" + (\"0\" + parseInt(arr[1], 10).toString(16)).slice(-2) + (\"0\" + parseInt(arr[2], 10).toString(16)).slice(-2) + (\"0\" + parseInt(arr[3], 10).toString(16)).slice(-2) : \"\";\n        },\n        convertShorthex2long: function(hex) {\n            hex = this._removeHexDiese(hex);\n            return hex.length === 3 ? \"#\" + hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2] : \"#\" + hex;\n        },\n        replaceRgbToHex: function(html) {\n            return html.replace(/rgb\\((.*?)\\)/g, function(match, capture) {\n                let a = capture.split(\",\");\n                let b = a.map(function(x) {\n                    x = parseInt(x).toString(16);\n                    return x.length === 1 ? \"0\" + x : x;\n                });\n                return \"#\" + b.join(\"\");\n            });\n        }\n    });\n    ArticleEditor.add(\"module\", \"paragraphizer\", {\n        init: function() {\n            this.remStart = \"#####replace\";\n            this.remEnd = \"#####\";\n            var extendTags = [\n                \"form\",\n                \"audio\",\n                \"figcaption\",\n                \"object\",\n                \"style\",\n                \"script\",\n                \"iframe\",\n                \"select\",\n                \"input\",\n                \"textarea\",\n                \"button\",\n                \"option\",\n                \"map\",\n                \"area\",\n                \"math\",\n                \"fieldset\",\n                \"legend\",\n                \"hgroup\",\n                \"nav\",\n                \"details\",\n                \"menu\",\n                \"summary\"\n            ];\n            this.tags = this.opts.tags.parser.concat(extendTags);\n        },\n        paragraphize: function(html) {\n            // build markup tag\n            var tag = \"p\";\n            var stored = [];\n            var storedComments = [];\n            // store\n            html = this._storeTags(html, stored);\n            html = this.app.content.storeComments(html, storedComments);\n            // trim\n            html = html.trim();\n            html = this._trimLinks(html);\n            // replace new lines\n            html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)$/g, \"\");\n            html = html.replace(/xparagraphmarkerz$/g, \"\");\n            html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)/g, \"\\n\");\n            html = html.replace(/xparagraphmarkerz/g, \"\\n\");\n            html = html.replace(/[\\n]+/g, \"\\n\");\n            // wrap to tag\n            var str = \"\";\n            var arr = html.split(\"\\n\");\n            for(var i = 0; i < arr.length; i++)str += \"<\" + tag + \">\" + arr[i].trim() + \"</\" + tag + \">\\n\";\n            // trim new line at the end\n            html = str.replace(/\\n$/, \"\");\n            // clean\n            html = html.replace(new RegExp(\"<\" + tag + \">\\\\s+#####\", \"gi\"), \"#####\");\n            html = html.replace(new RegExp(\"<\" + tag + \">#####\", \"gi\"), \"#####\");\n            html = html.replace(new RegExp(\"#####</\" + tag + \">\", \"gi\"), \"#####\");\n            // restore\n            html = this._restoreTags(html, stored);\n            html = this.app.content.restoreComments(html, storedComments);\n            // clean empty\n            html = html.replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\\s\\n]*<\\/\\1>/gi, \"<$1$2></$1>\");\n            html = html.replace(/<p(.*?)><\\/?br\\s?\\/?><\\/p>/gi, \"<p$1></p>\");\n            html = html.replace(/<div(.*?)><\\/?br\\s?\\/?><\\/div>/gi, \"<div$1></div>\");\n            html = html.replace(/<\\/?br\\s?\\/?><\\/div>/gi, \"</div>\");\n            html = html.replace(/<\\/?br\\s?\\/?><\\/li>/gi, \"</li>\");\n            return html;\n        },\n        // private\n        _storeTags: function(html, stored) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(this.tags.join(\", \")).each((function($node, i) {\n                    this._replaceTag($node, i, stored);\n                }).bind(this));\n            }).bind(this));\n        },\n        _restoreTags: function(html, stored) {\n            for(var i = 0; i < stored.length; i++){\n                var str = stored[i].replace(/\\$/gi, \"&#36;\");\n                html = html.replace(this.remStart + i + this.remEnd, str);\n            }\n            return html;\n        },\n        _replaceTag: function($node, i, stored) {\n            var node = $node.get();\n            var replacement = document.createTextNode(this.remStart + i + this.remEnd + \"xparagraphmarkerz\");\n            stored.push(node.outerHTML);\n            node.parentNode.replaceChild(replacement, node);\n        },\n        _trimLinks: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"a\").each(this._trimLink.bind(this));\n            }).bind(this));\n        },\n        _trimLink: function($node) {\n            $node.html($node.html().trim());\n        }\n    });\n    ArticleEditor.add(\"module\", \"element\", {\n        // is\n        is: function(el, type, extend) {\n            var res = false;\n            var node = type === \"text\" ? el : this._getNode(el);\n            if (type === \"inline\") res = this._isElement(node) && this._isInlineTag(node.tagName, extend);\n            else if (type === \"blocks\") res = this._isElement(node) && node.hasAttribute(\"data-\" + this.prefix + \"-type\");\n            else if (type === \"blocks-first\") res = this._isElement(node) && node.hasAttribute(\"data-\" + this.prefix + \"-first-level\");\n            else if (type === \"block\") res = this._isElement(node) && this._isBlockTag(node.tagName, extend);\n            else if (type === \"element\") res = this._isElement(node);\n            else if (type === \"text\") res = typeof node === \"string\" && !/^\\s*<(\\w+|!)[^>]*>/.test(node) ? true : this.isTextNode(node);\n            else if (type === \"list\") res = this._isElement(node) && [\n                \"ul\",\n                \"ol\"\n            ].indexOf(node.tagName.toLowerCase()) !== -1;\n            else if (type === \"heading\") res = this._isElement(node) && [\n                \"h1\",\n                \"h2\",\n                \"h3\",\n                \"h4\",\n                \"h5\",\n                \"h6\"\n            ].indexOf(node.tagName.toLowerCase()) !== -1;\n            return res;\n        },\n        isEmptyOrImageInline: function(el) {\n            var node = this.dom(el).get();\n            if (!node || node.nodeType === 3) return false;\n            var tag = node.tagName.toLowerCase();\n            var tags = [\n                \"svg\",\n                \"img\"\n            ];\n            var noeditattr = node.getAttribute(\"contenteditable\") === \"false\";\n            var isInline = this.is(node, \"inline\");\n            if (isInline && this.isEmpty(node) || isInline && noeditattr || tags.indexOf(tag) !== -1) return true;\n            return false;\n        },\n        isEmpty: function(el) {\n            var node = this._getNode(el);\n            if (node) return node.nodeType === 3 ? node.textContent.trim().replace(/\\n/, \"\") === \"\" : node.innerHTML === \"\";\n            return false;\n        },\n        isTag: function(el, tag) {\n            return this._getNode(el).tagName.toLowerCase() === tag;\n        },\n        isTextNode: function(el) {\n            var node = this._getNode(el);\n            return node && node.nodeType && node.nodeType === 3;\n        },\n        isVisible: function(el) {\n            var node = this._getNode(el);\n            return !!(node.offsetWidth || node.offsetHeight || node.getClientRects().length);\n        },\n        isScrollVisible: function(el) {\n            var $scrollTarget = this.app.scroll.getTarget();\n            var $el = this.dom(el);\n            var docViewTop = $scrollTarget.scrollTop();\n            var docViewBottom = docViewTop + $scrollTarget.height();\n            var elemTop = $el.offset().top;\n            return elemTop <= docViewBottom;\n        },\n        // get\n        getFirstLevel: function(el) {\n            return this.dom(el).closest(\"[data-\" + this.prefix + \"-first-level]\");\n        },\n        getDataBlock: function(el) {\n            return this.dom(el).closest(\"[data-\" + this.prefix + \"-type]\");\n        },\n        getType: function(el) {\n            return this.dom(el).attr(\"data-\" + this.prefix + \"-type\");\n        },\n        getAllInlines: function(inline) {\n            var inlines = [];\n            var node = inline;\n            while(node){\n                if (this.is(node, \"inline\")) inlines.push(node);\n                node = node.parentNode;\n            }\n            return inlines;\n        },\n        getClosest: function(el, types) {\n            return this.dom(el).closest(this.getTypesSelector(types));\n        },\n        getParents: function(el, types) {\n            return this.dom(el).parents(this.getTypesSelector(types));\n        },\n        getChildren: function(el, types) {\n            return this.dom(el).find(this.getTypesSelector(types));\n        },\n        getTypesSelector: function(types) {\n            return \"[data-\" + this.prefix + \"-type=\" + types.join(\"],[data-\" + this.prefix + \"-type=\") + \"]\";\n        },\n        // has\n        hasClass: function(el, value) {\n            value = typeof value === \"string\" ? [\n                value\n            ] : value;\n            var $el = this.dom(el);\n            var count = value.length;\n            var z = 0;\n            for(var i = 0; i < count; i++)if ($el.hasClass(value[i])) z++;\n            return count === z;\n        },\n        // scroll\n        scrollTo: function($el, tolerance) {\n            if (!this.isScrollVisible($el)) {\n                tolerance = tolerance || 60;\n                var offset = $el.offset();\n                var $target = this.app.scroll.getTarget();\n                var value = offset.top - tolerance;\n                $target.scrollTop(value);\n                setTimeout(function() {\n                    $target.scrollTop(value);\n                }, 1);\n            }\n        },\n        // replace\n        replaceToTag: function(el, tag, keepchildnodes) {\n            return this.dom(el).replaceWith((function(node) {\n                var $el = this.dom(\"<\" + tag + \">\");\n                if (!keepchildnodes) $el.append(node.innerHTML);\n                if (node.attributes) {\n                    var attrs = node.attributes;\n                    for(var i = 0; i < attrs.length; i++)$el.attr(attrs[i].nodeName, attrs[i].value);\n                }\n                if (keepchildnodes) while(node.childNodes.length > 0)$el.append(this.dom(node.firstChild));\n                return $el;\n            }).bind(this));\n        },\n        // compare\n        compareStyle: function(el, obj) {\n            let len = Object.keys(obj).length, $el = this.dom(el), css = this.app.utils.cssToObject($el.attr(\"style\")), cssSize = Object.keys(css).length, size = 0;\n            if (cssSize !== len) return false;\n            else {\n                for (let [key, val] of Object.entries(css))if (obj[key]) {\n                    let value = obj[key];\n                    value = this._normalizeValue(key, value);\n                    val = this._normalizeValue(key, val);\n                    if (value === val) size++;\n                }\n            }\n            return cssSize === size;\n        },\n        // has\n        hasAttrs: function(el, obj) {\n            let len = Object.keys(obj).length, $el = this.dom(el), size = 0;\n            for (let [key, val] of Object.entries(obj)){\n                let value = $el.attr(key);\n                if (value === val) size++;\n            }\n            return len === size;\n        },\n        hasStyle: function(el, obj) {\n            if (!obj) return false;\n            let $el = this.dom(el), len = Object.keys(obj).length, size = 0;\n            for (let [key, val] of Object.entries(obj)){\n                let value = $el.css(key);\n                value = this._normalizeValue(key, value);\n                val = this._normalizeValue(key, val);\n                if (value === val) size++;\n            }\n            return len === size;\n        },\n        // split\n        split: function(el) {\n            var $el = this.dom(el);\n            el = $el.get();\n            var tag = el.tagName.toLowerCase();\n            var fragment = this.app.content.extractHtmlFromCaret(el);\n            if (fragment.nodeType && fragment.nodeType === 11) fragment = this.dom(fragment.childNodes);\n            var $secondPart = this.dom(\"<\" + tag + \" />\");\n            $secondPart = this.cloneAttrs(el, $secondPart);\n            $secondPart.append(fragment);\n            $el.after($secondPart);\n            var $last = $el.children().last();\n            if (this.is($last, \"inline\")) {\n                var html = $last.html();\n                html = this.app.utils.removeInvisibleChars(html);\n                if (html === \"\") $last.remove();\n            }\n            var type = this.getType($secondPart);\n            if (type) this.app.create(\"block.\" + type, $secondPart, true);\n            if ($el.html() === \"\") $el.remove();\n            return $secondPart;\n        },\n        // clone\n        cloneEmpty: function(el) {\n            var $el = this.dom(el);\n            var tag = $el.get().tagName.toLowerCase();\n            var $clone = this.dom(\"<\" + tag + \">\");\n            return $clone;\n        },\n        cloneAttrs: function(elFrom, elTo) {\n            var $elTo = this.dom(elTo);\n            var attrs = this._getNode(elFrom).attributes;\n            var len = attrs.length;\n            while(len--){\n                var attr = attrs[len];\n                $elTo.attr(attr.name, attr.value);\n            }\n            return $elTo;\n        },\n        // attrs\n        getAttrs: function(el) {\n            var node = this._getNode(el);\n            var attr = {};\n            if (node.attributes != null && node.attributes.length) for(var i = 0; i < node.attributes.length; i++){\n                var val = node.attributes[i].nodeValue;\n                val = this._isNumber(val) ? parseFloat(val) : this._getBooleanFromStr(val);\n                attr[node.attributes[i].nodeName] = val;\n            }\n            return attr;\n        },\n        removeEmptyAttrs: function(el, attrs) {\n            var $el = this.dom(el);\n            var name = attrs.join(\" \");\n            var res = false;\n            if (typeof $el.attr(name) === \"undefined\" || $el.attr(name) === null) res = true;\n            else if ($el.attr(name) === \"\") {\n                $el.removeAttr(name);\n                res = true;\n            }\n            return res;\n        },\n        // blocks\n        getBlocks: function(el, parsertags, extendtags) {\n            var node = this._getNode(el);\n            var nodes = node.childNodes;\n            var finalNodes = [];\n            var tags = parsertags || this.opts.tags.parser;\n            if (extendtags) tags = this.app.utils.extendArray(tags, extendtags);\n            for(var i = 0; i < nodes.length; i++)if (nodes[i].nodeType === 1 && tags.indexOf(nodes[i].tagName.toLowerCase()) !== -1) finalNodes.push(nodes[i]);\n            return finalNodes;\n        },\n        hasBlocks: function(el) {\n            return this.getBlocks(el).length !== 0;\n        },\n        // siblings\n        hasTextSiblings: function(el) {\n            var node = this._getNode(el);\n            var hasPrev = node.previousSibling && node.previousSibling.nodeType === 3 && !this.isEmpty(node.previousSibling);\n            var hasNext = node.nextSibling && node.nextSibling.nodeType === 3 && !this.isEmpty(node.nextSibling);\n            return hasPrev || hasNext;\n        },\n        // private\n        _getNode: function(el) {\n            return this.dom(el).get();\n        },\n        _getBooleanFromStr: function(str) {\n            if (str === \"true\") return true;\n            else if (str === \"false\") return false;\n            return str;\n        },\n        _isBlockTag: function(tag, extend) {\n            var arr = this.app.utils.extendArray(this.opts.tags.block, extend);\n            return arr.indexOf(tag.toLowerCase()) !== -1;\n        },\n        _isInlineTag: function(tag, extend) {\n            var arr = this.app.utils.extendArray(this.opts.tags.inline, extend);\n            return arr.indexOf(tag.toLowerCase()) !== -1;\n        },\n        _isElement: function(node) {\n            return node && node.nodeType && node.nodeType === 1;\n        },\n        _isTag: function(tag) {\n            return tag !== undefined && tag;\n        },\n        _isNumber: function(str) {\n            return !isNaN(str) && !isNaN(parseFloat(str));\n        },\n        _normalizeValue: function(key, val) {\n            val = typeof val === \"string\" ? val.replace(/'/g, '\"') : val;\n            val = val.trim().replace(/;$/, \"\");\n            if (key.search(/color|background/) !== -1) {\n                val = this.app.utils.convertRgb2hex(val);\n                val = val.toLowerCase();\n            }\n            if (key.search(/family/) !== -1) val = val.replace(/\"/g, \"\");\n            return val;\n        }\n    });\n    ArticleEditor.add(\"module\", \"scroll\", {\n        init: function() {\n            this.scrolltop = false;\n        },\n        save: function() {\n            this.scrolltop = this.getTarget().scrollTop();\n        },\n        restore: function() {\n            if (this.scrolltop !== false) {\n                this.getTarget().scrollTop(this.scrolltop);\n                this.scrolltop = false;\n            }\n        },\n        isTarget: function() {\n            return this.opts.editor.scrollTarget !== window;\n        },\n        getTarget: function() {\n            return this.dom(this.opts.editor.scrollTarget);\n        }\n    });\n    ArticleEditor.add(\"module\", \"button\", {\n        init: function(name, obj, $container, type) {\n            // build\n            if (typeof name === \"object\") {\n                this.name = name.name;\n                this.obj = obj;\n                this._buildFromElement(name.element);\n            } else if (name) {\n                this.type = type || false;\n                this.name = name;\n                var res = this._observe(obj);\n                this.obj = typeof res === \"undefined\" ? obj : res;\n                if (this.obj) this._build(name, $container);\n            }\n        },\n        setColor: function(stack, data) {\n            var name = stack.getName();\n            if (name === \"background\" || name === \"text-color\") {\n                var key = name === \"background\" ? \"background-color\" : \"color\";\n                this.setBackground(data[key]);\n            }\n        },\n        isButton: function() {\n            return true;\n        },\n        isAddbar: function() {\n            return this._has(\"addbar\");\n        },\n        isControl: function() {\n            return this._has(\"control\");\n        },\n        getName: function() {\n            return this.name;\n        },\n        getTitle: function() {\n            return this.title;\n        },\n        getParams: function() {\n            return this._has(\"params\") ? this.obj.params : false;\n        },\n        getOffset: function() {\n            return this.$button.offset();\n        },\n        getDimension: function() {\n            return {\n                width: this.$button.width(),\n                height: this.$button.height()\n            };\n        },\n        getElement: function() {\n            return this.$button;\n        },\n        setBackground: function(color) {\n            this._background(\"add\", color);\n        },\n        resetBackground: function() {\n            this._background(\"remove\", \"\");\n        },\n        // private\n        _has: function(name) {\n            return Object.prototype.hasOwnProperty.call(this.obj, name);\n        },\n        _observe: function(obj) {\n            if (Object.prototype.hasOwnProperty.call(obj, \"observer\")) obj = this.app.api(obj.observer, obj, this.name);\n            return obj;\n        },\n        _background: function(type, color) {\n            var func = type === \"remove\" ? \"removeClass\" : \"addClass\";\n            this.$icon[func](this.prefix + \"-button-icon-color\").css({\n                \"background-color\": color,\n                \"color\": color !== \"\" ? this.app.color.invert(color) : \"\"\n            });\n        },\n        _buildFromElement: function(element) {\n            this.$button = this.dom(element);\n            this.$button.addClass(this.prefix + \"-button-target\");\n            this._buildData();\n        },\n        _build: function(name, $container) {\n            this._buildTitle();\n            this._buildElement();\n            this._buildIcon();\n            this._buildData($container);\n        },\n        _buildData: function($container) {\n            // data\n            this.$button.attr({\n                \"tabindex\": \"-1\",\n                \"data-name\": this.name,\n                \"data-command\": this.obj.command || false\n            });\n            this.$button.dataset(\"instance\", this);\n            // func\n            var func = this._has(\"command\") ? \"_catch\" : \"_stop\";\n            // events\n            this.$button.on(\"click.\" + this.prefix + \"-button\", this[func].bind(this));\n            this.$button.on(\"dragstart.\" + this.prefix + \"-button\", function(e) {\n                e.preventDefault();\n                return;\n            });\n            if ($container) {\n                this._buildTooltip();\n                this._buildBackground();\n                this._buildPosition($container);\n            }\n        },\n        _buildTitle: function() {\n            this.title = typeof this.obj.title !== \"undefined\" ? this.lang.parse(this.obj.title) : \"\";\n        },\n        _buildElement: function() {\n            this.$button = this.dom('<a href=\"#\"></a>');\n            this.$button.addClass(this.prefix + \"-button \" + this.prefix + \"-button-target\");\n            if (this.type) this.$button.addClass(this.prefix + \"-button-\" + this.type);\n            if (this._has(\"classname\")) this.$button.addClass(this.obj.classname);\n        },\n        _buildIcon: function() {\n            var isIcon = this._has(\"icon\");\n            var span = '<span class=\"' + this.prefix + \"-icon-\" + this.name + '\"></span>';\n            this.$icon = this._buildIconElement();\n            if (isIcon && this.obj.icon !== true) {\n                if (this.obj.icon.search(/</) !== -1) span = this.obj.icon;\n                else span = '<span class=\"' + this.prefix + \"-icon-\" + this.obj.icon + '\"></span>';\n            }\n            // buttons.icons\n            if (this.opts.buttons.icons && typeof this.opts.buttons.icons[this.name] !== \"undefined\") span = this.opts.buttons.icons[this.name];\n            this.$icon.append(span);\n            this.$button.append(this.$icon);\n        },\n        _buildIconElement: function() {\n            return this.dom(\"<span>\").addClass(this.prefix + \"-button-icon\");\n        },\n        _buildTooltip: function() {\n            if (this.type === \"toolbar\" || this.type === \"context\" && this.opts.tooltip.context) this.app.tooltip.build(this.$button, this.title);\n        },\n        _buildBackground: function() {\n            if (this._has(\"background\")) this.setBackground(this.obj.background);\n        },\n        _buildPosition: function($container) {\n            if (this._has(\"position\")) {\n                var pos = this.obj.position;\n                if (pos === \"first\") $container.prepend(this.$button);\n                else if (typeof pos === \"object\") {\n                    var type = Object.prototype.hasOwnProperty.call(pos, \"after\") ? \"after\" : \"before\";\n                    var name = pos[type];\n                    var $el = this._findPositionElement(name, $container);\n                    if ($el) $el[type](this.$button);\n                    else $container.append(this.$button);\n                }\n            } else $container.append(this.$button);\n        },\n        _findPositionElement: function(name, $container) {\n            var $el;\n            if (Array.isArray(name)) for(var i = 0; i < name.length; i++){\n                $el = $container.find(\"[data-name=\" + name[i] + \"]\");\n                if ($el.length !== 0) break;\n            }\n            else $el = $container.find(\"[data-name=\" + name + \"]\");\n            return $el.length !== 0 ? $el : 0;\n        },\n        _stop: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n        },\n        _catch: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var $btn = this.dom(e.target).closest(\".\" + this.prefix + \"-button-target\");\n            if ($btn.hasClass(\"disable\")) return;\n            // editor focus\n            this.app.editor.setFocus();\n            var command = $btn.attr(\"data-command\");\n            var name = $btn.attr(\"data-name\");\n            var instance = $btn.dataget(\"instance\");\n            // command\n            this.app.api(command, this.getParams(), instance, name, e);\n            this.app.tooltip.close();\n        }\n    });\n    ArticleEditor.add(\"module\", \"tooltip\", {\n        init: function() {\n            this.classname = this.prefix + \"-tooltip\";\n            this.eventname = this.prefix + \"-button-\" + this.uuid;\n        },\n        stop: function() {\n            this.close();\n        },\n        build: function($btn, title) {\n            title = this._cleanTitle(title);\n            if (title) {\n                $btn.attr(\"data-tooltip\", title);\n                $btn.on(\"mouseover.\" + this.eventname, this.open.bind(this));\n                $btn.on(\"mouseout.\" + this.eventname, this.close.bind(this));\n            }\n        },\n        open: function(e) {\n            var $btn = this._getButton(e);\n            if (this.app.popup.isOpen() || $btn.hasClass(\"disable\")) return;\n            // create\n            this.$tooltip = this._create($btn);\n            // position\n            this._setPosition($btn);\n            this._fixBSModal();\n            // append\n            this.app.$body.append(this.$tooltip);\n        },\n        close: function() {\n            this.app.$body.find(\".\" + this.classname).remove();\n        },\n        // private\n        _create: function($btn) {\n            return this.dom(\"<span>\").addClass(this.classname).html($btn.attr(\"data-tooltip\"));\n        },\n        _cleanTitle: function(title) {\n            return title ? title.replace(/(<([^>]+)>)/gi, \"\") : false;\n        },\n        _setPosition: function($btn) {\n            var offset = $btn.offset();\n            var height = $btn.height();\n            this.$tooltip.css({\n                top: offset.top + height + \"px\",\n                left: offset.left + \"px\"\n            });\n        },\n        _fixBSModal: function() {\n            if (this.opts.bsmodal) this.$tooltip.css(\"z-index\", 1060);\n        },\n        _getButton: function(e) {\n            return this.dom(e.target).closest(\".\" + this.prefix + \"-button-target\");\n        }\n    });\n    ArticleEditor.add(\"module\", \"fragment\", {\n        build: function(node) {\n            return this.is(node) ? node : this.create(node);\n        },\n        insert: function(fragment) {\n            var sel = this.app.selection.get();\n            if (!sel.range) return;\n            if (sel.collapsed) {\n                var start = sel.range.startContainer;\n                if (start.nodeType !== 3 && start.tagName === \"BR\") start.parentNode.removeChild(start);\n            } else sel.range.deleteContents();\n            if (fragment.frag) sel.range.insertNode(fragment.frag);\n            else sel.range.insertNode(fragment);\n        },\n        createContainer: function(html) {\n            var $div = this.dom(\"<div>\");\n            if (typeof html === \"string\") $div.html(html);\n            else $div.append(this.dom(html).clone(true));\n            return $div.get();\n        },\n        create: function(html) {\n            var el = typeof html === \"string\" ? this.createContainer(html) : html;\n            var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n            var nodes = [];\n            var i = 0;\n            while(node = el.firstChild){\n                i++;\n                var n = frag.appendChild(node);\n                if (i === 1) firstNode = n;\n                nodes.push(n);\n                lastNode = n;\n            }\n            return {\n                frag: frag,\n                first: firstNode,\n                last: lastNode,\n                nodes: nodes\n            };\n        },\n        is: function(obj) {\n            return typeof obj === \"object\" && obj.frag;\n        }\n    });\n    ArticleEditor.add(\"module\", \"clipboard\", {\n        getContent: function(clipboard) {\n            var type = this.isPlainText(clipboard) ? \"text/plain\" : \"text/html\";\n            var html = clipboard.getData(type);\n            // html\n            return type === \"text/plain\" ? this.app.content.escapeHtml(html) : html;\n        },\n        setContent: function(e, html, text) {\n            var clipboard = e.clipboardData;\n            // unparse\n            html = this.app.parser.unparse(html);\n            html = '<meta type=\"' + this.prefix + '-editor\"/>' + html;\n            // text\n            text = text || this.app.content.getTextFromHtml(html, {\n                nl: true\n            });\n            // set\n            clipboard.setData(\"text/html\", html);\n            clipboard.setData(\"text/plain\", text);\n        },\n        isPlainText: function(clipboard) {\n            var text = clipboard.getData(\"text/plain\");\n            var html = clipboard.getData(\"text/html\");\n            if (html && html.trim() !== \"\") return false;\n            else return text !== null;\n        }\n    });\n    ArticleEditor.add(\"module\", \"codemirror\", {\n        init: function() {\n            this.cm = false;\n        },\n        create: function(params) {\n            if (!this.is()) return;\n            var opts = typeof this.opts.codemirror === \"object\" ? this.opts.codemirror : {};\n            var instance = this.opts.codemirrorSrc ? this.opts.codemirrorSrc : $f9c0764c59596a86$var$CodeMirror;\n            this.cm = instance.fromTextArea(this.dom(params.el).get(), opts);\n            if (params.height) this.cm.setSize(null, params.height);\n            if (params.focus) this.cm.focus();\n            return this.cm;\n        },\n        destroy: function() {\n            if (this.cm) {\n                this.cm.toTextArea();\n                this.cm = false;\n            }\n        },\n        is: function() {\n            return this.opts.codemirror;\n        },\n        val: function(html) {\n            if (this.is() && this.cm) html = this.cm.getValue();\n            return html;\n        }\n    });\n    ArticleEditor.add(\"class\", \"upload\", {\n        defaults: {\n            type: \"image\",\n            box: false,\n            url: false,\n            cover: true,\n            name: \"file\",\n            data: false,\n            multiple: true,\n            placeholder: false,\n            hidden: true,\n            target: false,\n            success: false,\n            error: false,\n            remove: false,\n            trigger: false,\n            input: false\n        },\n        init: function($el, params, trigger) {\n            this.eventname = this.prefix + \"-upload\";\n            if ($el) this._build($el, params, trigger);\n        },\n        send: function(e, files, params, trigger) {\n            this.p = this._buildParams(params, trigger);\n            this._send(e, files);\n        },\n        complete: function(response, e) {\n            this._complete(response, e);\n        },\n        // api\n        setImage: function(url) {\n            if (this.p.input) return;\n            if (this.$image) this.$image.remove();\n            if (this.$remove) this.$remove.remove();\n            if (url === \"\") this.$placeholder.show();\n            else {\n                this.$placeholder.hide();\n                this._buildImage(url);\n                if (this.p.remove) this._buildRemove();\n            }\n        },\n        // build\n        _build: function($el, params, trigger) {\n            this.p = this._buildParams(params, trigger);\n            this.$element = this.dom($el);\n            var tag = this.$element.get().tagName;\n            if (tag === \"INPUT\") this._buildByInput();\n            else this._buildByBox();\n        },\n        _buildImage: function(url) {\n            this.$image = this.dom(\"<img>\");\n            this.$image.attr(\"src\", url);\n            this.$box.append(this.$image);\n            if (this.p.input === false) {\n                this.$box.off(\"click.\" + this.eventname);\n                this.$image.on(\"click.\" + this.eventname, this._click.bind(this));\n            }\n        },\n        _buildRemove: function() {\n            this.$remove = this.dom(\"<span>\");\n            this.$remove.addClass(this.prefix + \"-upload-remove\");\n            this.$remove.on(\"click\", this._removeImage.bind(this));\n            this.$box.append(this.$remove);\n        },\n        _buildParams: function(params, trigger) {\n            params = $ARX.extend(true, this.defaults, params);\n            if (trigger) params.trigger = trigger;\n            return params;\n        },\n        _buildByInput: function() {\n            this.$input = this.$element;\n            // box\n            if (this.p.box) {\n                this._buildBox();\n                this._buildPlaceholder();\n            } else this.p.input = true;\n            this._buildAccept();\n            this._buildMultiple();\n            this._buildEvents();\n        },\n        _buildByBox: function() {\n            this._buildInput();\n            this._buildAccept();\n            this._buildMultiple();\n            this._buildBox();\n            this._buildPlaceholder();\n            this._buildEvents();\n        },\n        _buildBox: function() {\n            this.$box = this.dom(\"<div>\").addClass(this.prefix + \"-form-upload-box\");\n            this.$element.before(this.$box);\n            // cover\n            if (this.p.cover === false) this.$box.addClass(this.prefix + \"-form-upload-cover-off\");\n            // hide\n            if (this.p.hidden) this.$element.hide();\n        },\n        _buildPlaceholder: function() {\n            if (!this.p.placeholder) return;\n            this.$placeholder = this.dom(\"<span>\").addClass(this.prefix + \"-form-upload-placeholder\");\n            this.$placeholder.html(this.p.placeholder);\n            this.$box.append(this.$placeholder);\n        },\n        _buildInput: function() {\n            this.$input = this.dom(\"<input>\");\n            this.$input.attr(\"type\", \"file\");\n            this.$input.attr(\"name\", this._getUploadParam());\n            this.$input.hide();\n            this.$element.before(this.$input);\n        },\n        _buildAccept: function() {\n            if (this.p.type !== \"image\") return;\n            var types = this.opts.image.types.join(\",\");\n            this.$input.attr(\"accept\", types);\n        },\n        _buildMultiple: function() {\n            if (this.p.type !== \"image\") return;\n            if (this.p.multiple) this.$input.attr(\"multiple\", \"multiple\");\n            else this.$input.removeAttr(\"multiple\");\n        },\n        _buildEvents: function() {\n            this.$input.on(\"change.\" + this.eventname + \"-\" + this.uuid, this._change.bind(this));\n            if (this.p.input === false) {\n                this.$box.on(\"click.\" + this.eventname, this._click.bind(this));\n                this.$box.on(\"drop.\" + this.eventname, this._drop.bind(this));\n                this.$box.on(\"dragover.\" + this.eventname, this._dragover.bind(this));\n                this.$box.on(\"dragleave.\" + this.eventname, this._dragleave.bind(this));\n            }\n        },\n        _buildData: function(name, files, data) {\n            if (this.p.multiple === \"single\") data.append(name, files[0]);\n            else if (this.p.multiple) for(var i = 0; i < files.length; i++)data.append(name + \"[]\", files[i]);\n            else data.append(name + \"[]\", files[0]);\n            return data;\n        },\n        // remove\n        _removeImage: function(e) {\n            if (e) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n            if (this.$image) this.$image.remove();\n            if (this.$remove) this.$remove.remove();\n            this.$placeholder.show();\n            if (this.p.input === false) this.$box.on(\"click.\" + this.eventname, this._click.bind(this));\n            if (e) this.app.api(this.p.remove, e);\n        },\n        // get\n        _getUploadParam: function() {\n            return this.p.name;\n        },\n        // events\n        _click: function(e) {\n            e.preventDefault();\n            this.$input.click();\n        },\n        _change: function(e) {\n            this._send(e, this.$input.get().files);\n        },\n        _drop: function(e) {\n            e.preventDefault();\n            this._send(e);\n        },\n        _dragover: function(e) {\n            e.preventDefault();\n            this._setStatus(\"hover\");\n            return false;\n        },\n        _dragleave: function(e) {\n            e.preventDefault();\n            this._removeStatus();\n            return false;\n        },\n        // set\n        _setStatus: function(status) {\n            if (this.p.input || !this.p.box) return;\n            this._removeStatus();\n            this.$box.addClass(this.prefix + \"-form-upload-\" + status);\n        },\n        // remove\n        _removeStatus: function() {\n            if (this.p.input || !this.p.box) return;\n            var status = [\n                \"hover\",\n                \"error\"\n            ];\n            for(var i = 0; i < status.length; i++)this.$box.removeClass(this.prefix + \"-form-upload-\" + status[i]);\n        },\n        // send\n        _send: function(e, files) {\n            files = files || e.dataTransfer.files;\n            var data = new FormData();\n            var name = this._getUploadParam();\n            data = this._buildData(name, files, data);\n            data = this.app.utils.extendData(data, this.p.data);\n            // send data\n            this._sendData(e, files, data);\n        },\n        _sendData: function(e, files, data) {\n            if (typeof this.p.url === \"function\") this.p.url.call(this.app, this, {\n                data: data,\n                files: files,\n                e: e\n            });\n            else {\n                this.app.progress.show();\n                this.ajax.post({\n                    url: this.p.url,\n                    data: data,\n                    before: (function(xhr) {\n                        var event = this.app.broadcast(\"upload.before.send\", {\n                            xhr: xhr,\n                            data: data,\n                            files: files,\n                            e: e\n                        });\n                        if (event.isStopped()) {\n                            this.app.progress.hide();\n                            return false;\n                        }\n                    }).bind(this),\n                    success: (function(response) {\n                        this._complete(response, e);\n                    }).bind(this),\n                    error: (function(response) {\n                        this._complete(response, e);\n                    }).bind(this)\n                });\n            }\n        },\n        // complete\n        _complete: function(response, e) {\n            if (response && response.error) {\n                this._setStatus(\"error\");\n                if (this.p.error) {\n                    this.app.broadcast(\"upload.error\", {\n                        response: response\n                    });\n                    this.app.api(this.p.error, response, e);\n                }\n            } else {\n                this._removeStatus();\n                this._trigger(response);\n                if (this.p.success) {\n                    this.app.broadcast(\"upload.complete\", {\n                        response: response\n                    });\n                    this.app.api(this.p.success, response, e);\n                }\n            }\n            setTimeout((function() {\n                this.app.progress.hide();\n            }).bind(this), 500);\n        },\n        _trigger: function(response) {\n            if (this.p.trigger) {\n                if (response && response.url) {\n                    var instance = this.p.trigger.instance;\n                    var method = this.p.trigger.method;\n                    instance[method].call(instance, response.url);\n                }\n            }\n        }\n    });\n    ArticleEditor.add(\"module\", \"progress\", {\n        stop: function() {\n            this.hide();\n        },\n        show: function() {\n            this.hide();\n            this.$progress = this.dom(\"<div>\").addClass(this.prefix + \"-editor-progress\");\n            this.$progress.attr(\"id\", this.prefix + \"-progress\");\n            this.$progressBar = this.dom(\"<span>\");\n            this.$progress.append(this.$progressBar);\n            this.app.$body.append(this.$progress);\n        },\n        hide: function() {\n            this.app.$body.find(\"#\" + this.prefix + \"-progress\").remove();\n        }\n    });\n    ArticleEditor.add(\"module\", \"autosave\", {\n        send: function() {\n            if (this.opts.autosave.url) this._sending();\n        },\n        // private\n        _getName: function() {\n            var name;\n            if (this.opts.autosave.name) name = this.opts.autosave.name;\n            else {\n                name = this.app.$element.attr(\"name\");\n                name = !name ? \"content\" + this.uuid : name;\n            }\n            return name;\n        },\n        _sending: function() {\n            var name = this._getName();\n            var data = {};\n            data[name] = this.app.$element.val();\n            data = this.app.utils.extendData(data, this.opts.autosave.data);\n            this.ajax.request(this.opts.autosave.method, {\n                url: this.opts.autosave.url,\n                data: data,\n                before: (function(xhr) {\n                    var event = this.app.broadcast(\"autosave.before.send\", {\n                        xhr: xhr,\n                        name: name,\n                        data: data\n                    });\n                    if (event.isStopped()) return false;\n                }).bind(this),\n                success: (function(response) {\n                    this._complete(response, name, data);\n                }).bind(this)\n            });\n        },\n        _complete: function(response, name, data) {\n            var callback = response && response.error ? \"autosave.error\" : \"autosave.send\";\n            this.app.broadcast(callback, {\n                name: name,\n                data: data,\n                response: response\n            });\n        }\n    });\n    ArticleEditor.add(\"module\", \"statusbar\", {\n        init: function() {\n            this.classname = this.prefix + \"-statusbar\";\n        },\n        start: function() {\n            this._build();\n        },\n        add: function(name, html) {\n            return this.update(name, html);\n        },\n        update: function(name, html) {\n            var $item = this.get(name);\n            if ($item.length === 0) $item = this._buildItem(name);\n            return $item.html(html);\n        },\n        get: function(name) {\n            var s = name ? \"[data-name=\" + name + \"]\" : \"[data-name]\";\n            return this.$statusbar.find(s);\n        },\n        remove: function(name) {\n            this.get(name).remove();\n        },\n        clear: function() {\n            this.$statusbar.html(\"\");\n        },\n        // private\n        _build: function() {\n            this.$statusbar = this.dom(\"<div>\").attr(\"dir\", this.opts.editor.direction);\n            this.$statusbar.addClass(this.classname + \" \" + this.classname + \"-\" + this.uuid);\n            this.app.container.get(\"statusbar\").append(this.$statusbar);\n        },\n        _buildItem: function(name) {\n            var $item = this.dom(\"<span>\").addClass(this.classname + \"-item\");\n            $item.attr(\"data-name\", name);\n            // append\n            this.$statusbar.append($item);\n            return $item;\n        }\n    });\n    ArticleEditor.add(\"module\", \"shortcut\", {\n        init: function() {\n            // remove\n            if (this.opts.shortcutsRemove) {\n                var keys = this.opts.shortcutsRemove;\n                for(var i = 0; i < keys.length; i++)this.remove(keys[i]);\n            }\n            // local\n            this.shortcuts = this.opts.shortcuts;\n            // based on https://github.com/jeresig/jquery.hotkeys\n            this.hotkeys = {\n                8: \"backspace\",\n                9: \"tab\",\n                10: \"return\",\n                13: \"return\",\n                16: \"shift\",\n                17: \"ctrl\",\n                18: \"alt\",\n                19: \"pause\",\n                20: \"capslock\",\n                27: \"esc\",\n                32: \"space\",\n                33: \"pageup\",\n                34: \"pagedown\",\n                35: \"end\",\n                36: \"home\",\n                37: \"left\",\n                38: \"up\",\n                39: \"right\",\n                40: \"down\",\n                45: \"insert\",\n                46: \"del\",\n                59: \";\",\n                61: \"=\",\n                96: \"0\",\n                97: \"1\",\n                98: \"2\",\n                99: \"3\",\n                100: \"4\",\n                101: \"5\",\n                102: \"6\",\n                103: \"7\",\n                104: \"8\",\n                105: \"9\",\n                106: \"*\",\n                107: \"+\",\n                109: \"-\",\n                110: \".\",\n                111: \"/\",\n                112: \"f1\",\n                113: \"f2\",\n                114: \"f3\",\n                115: \"f4\",\n                116: \"f5\",\n                117: \"f6\",\n                118: \"f7\",\n                119: \"f8\",\n                120: \"f9\",\n                121: \"f10\",\n                122: \"f11\",\n                123: \"f12\",\n                144: \"numlock\",\n                145: \"scroll\",\n                173: \"-\",\n                186: \";\",\n                187: \"=\",\n                188: \",\",\n                189: \"-\",\n                190: \".\",\n                191: \"/\",\n                192: \"`\",\n                219: \"[\",\n                220: \"\\\\\",\n                221: \"]\",\n                222: \"'\"\n            };\n            this.hotkeysShiftNums = {\n                \"`\": \"~\",\n                \"1\": \"!\",\n                \"2\": \"@\",\n                \"3\": \"#\",\n                \"4\": \"$\",\n                \"5\": \"%\",\n                \"6\": \"^\",\n                \"7\": \"&\",\n                \"8\": \"*\",\n                \"9\": \"(\",\n                \"0\": \")\",\n                \"-\": \"_\",\n                \"=\": \"+\",\n                \";\": \": \",\n                \"'\": '\"',\n                \",\": \"<\",\n                \".\": \">\",\n                \"/\": \"?\",\n                \"\\\\\": \"|\"\n            };\n        },\n        add: function(keys, obj) {\n            this.shortcuts[keys] = obj;\n        },\n        remove: function(keys) {\n            this.opts.shortcutsBase = this._remove(keys, this.opts.shortcutsBase);\n            this.opts.shortcuts = this._remove(keys, this.opts.shortcuts);\n        },\n        popup: function(params, button) {\n            var meta = /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) ? \"<b>&#8984;</b>\" : \"ctrl\";\n            var items = {};\n            var z = 0;\n            // items\n            z = this._buildPopupItems(items, z, this.opts.shortcutsBase, meta, \"base\");\n            this._buildPopupItems(items, z, this.opts.shortcuts, meta);\n            // create\n            this.app.popup.create(\"shortcuts\", {\n                width: \"360px\",\n                items: items\n            });\n            // open\n            this.app.popup.open({\n                button: button\n            });\n        },\n        handle: function(e) {\n            this.triggered = false;\n            // disable browser's hot keys for bold and italic if shortcuts off\n            if (this.shortcuts === false) {\n                if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) e.preventDefault();\n                return true;\n            }\n            // build\n            if (e.ctrlKey || e.metaKey || e.shoftKey || e.altKey) {\n                for(var key in this.shortcuts)if (this.shortcuts.hasOwnProperty(key)) this._build(e, key, this.shortcuts[key]);\n            }\n            return this.triggered;\n        },\n        // private\n        _buildPopupItems: function(items, z, shortcuts, meta, type) {\n            for(var key in shortcuts)if (shortcuts.hasOwnProperty(key)) {\n                var $item = this.dom(\"<div>\").addClass(this.prefix + \"-popup-shortcut-item\");\n                var title = type === \"base\" ? shortcuts[key] : shortcuts[key].title;\n                var $title = this.dom(\"<span>\").addClass(this.prefix + \"-popup-shortcut-title\").html(this.lang.parse(title));\n                var $kbd = this.dom(\"<span>\").addClass(this.prefix + \"-popup-shortcut-kbd\");\n                var name = type === \"base\" ? key.replace(\"meta\", meta) : shortcuts[key].name.replace(\"meta\", meta);\n                var arr = name.split(\"+\");\n                for(var i = 0; i < arr.length; i++)arr[i] = \"<span>\" + arr[i] + \"</span>\";\n                $kbd.html(arr.join(\"+\"));\n                $item.append($title);\n                $item.append($kbd);\n                items[z] = {\n                    html: $item\n                };\n                z++;\n            }\n            return z;\n        },\n        _build: function(e, str, obj) {\n            var keys = str.split(\",\");\n            var len = keys.length;\n            for(var i = 0; i < len; i++)if (typeof keys[i] === \"string\" && !Object.prototype.hasOwnProperty.call(obj, \"trigger\")) this._handler(e, keys[i].trim(), obj);\n        },\n        _handler: function(e, keys, obj) {\n            keys = keys.toLowerCase().split(\" \");\n            var special = this.hotkeys[e.keyCode];\n            var character = e.which !== 91 ? String.fromCharCode(e.which).toLowerCase() : false;\n            var modif = \"\", possible = {};\n            var cmdKeys = [\n                \"meta\",\n                \"ctrl\",\n                \"alt\",\n                \"shift\"\n            ];\n            for(var i = 0; i < cmdKeys.length; i++){\n                var specialKey = cmdKeys[i];\n                if (e[specialKey + \"Key\"] && special !== specialKey) modif += specialKey + \"+\";\n            }\n            // right cmd\n            if (e.keyCode === 93) modif += \"meta+\";\n            if (special) possible[modif + special] = true;\n            if (character) {\n                possible[modif + character] = true;\n                possible[modif + this.hotkeysShiftNums[character]] = true;\n                // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n                if (modif === \"shift+\") possible[this.hotkeysShiftNums[character]] = true;\n            }\n            var len = keys.length;\n            for(var z = 0; z < len; z++)if (possible[keys[z]]) {\n                e.preventDefault();\n                this.triggered = true;\n                this.app.api(obj.command, obj.params, e);\n                return;\n            }\n        },\n        _remove: function(keys, obj) {\n            return Object.keys(obj).reduce(function(object, key) {\n                if (key !== keys) object[key] = obj[key];\n                return object;\n            }, {});\n        }\n    });\n    ArticleEditor.add(\"module\", \"offset\", {\n        get: function(el) {\n            el = this._getEl(el);\n            var sel = this.app.editor.getWinNode().getSelection();\n            var offset = false;\n            if (sel && sel.rangeCount > 0) {\n                var range = sel.getRangeAt(0);\n                if (el.contains(sel.anchorNode)) {\n                    var cloned = range.cloneRange();\n                    cloned.selectNodeContents(el);\n                    cloned.setEnd(range.startContainer, range.startOffset);\n                    var start = cloned.toString().length;\n                    offset = {\n                        start: start,\n                        end: start + range.toString().length\n                    };\n                }\n            }\n            return offset;\n        },\n        set: function(el, offset) {\n            if (offset === false) offset = {\n                start: 0,\n                end: 0\n            };\n            el = this._getEl(el);\n            var charIndex = 0, range = this.app.editor.getDocNode().createRange();\n            var nodeStack = [\n                el\n            ], node, foundStart = false, stop = false;\n            range.setStart(el, 0);\n            range.collapse(true);\n            while(!stop && (node = nodeStack.pop()))if (node.nodeType === 3) {\n                var nextCharIndex = charIndex + node.length;\n                if (!foundStart && offset.start >= charIndex && offset.start <= nextCharIndex) {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex) {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n                charIndex = nextCharIndex;\n            } else {\n                var i = node.childNodes.length;\n                while(i--)nodeStack.push(node.childNodes[i]);\n            }\n            this.app.selection.setRange(range);\n        },\n        // private\n        _getEl: function(el) {\n            return !el ? this.app.editor.getLayout().get() : this.dom(el).get();\n        }\n    });\n    ArticleEditor.add(\"module\", \"marker\", {\n        build: function(pos) {\n            var $marker = this.dom(\"<span>\").attr(\"id\", \"selection-marker-\" + pos);\n            $marker.addClass(this.prefix + \"-selection-marker\");\n            $marker.html(this.opts.markerChar);\n            return $marker.get();\n        },\n        insert: function() {\n            this.remove();\n            var sel = this.app.selection.get();\n            var both = !sel.collapsed;\n            if (!sel.range) return;\n            var start = this.build(\"start\");\n            var end = this.build(\"end\");\n            var cloned = sel.range.cloneRange();\n            if (both) {\n                cloned.collapse(false);\n                cloned.insertNode(end);\n            }\n            cloned.setStart(sel.range.startContainer, sel.range.startOffset);\n            cloned.collapse(true);\n            cloned.insertNode(start);\n            sel.range.setStartAfter(start);\n            if (both) sel.range.setEndBefore(end);\n            this.app.selection.setRange(sel.range);\n        },\n        restore: function() {\n            var start = this.find(\"start\");\n            var end = this.find(\"end\");\n            var sel = this.app.selection.get();\n            var range = sel.range ? sel.range : this.app.editor.getDocNode().createRange();\n            if (start) {\n                var prev = end ? end.previousSibling : false;\n                var next = start.nextSibling;\n                next = next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, \"\") === \"\" ? false : next;\n                if (!end) {\n                    if (next) {\n                        range.selectNodeContents(next);\n                        range.collapse(true);\n                    } else this._restoreInject(range, start);\n                } else if (next && next.id === \"selection-marker-end\") this._restoreInject(range, start);\n                else {\n                    if (prev && next) {\n                        range.selectNodeContents(prev);\n                        range.collapse(false);\n                        range.setStart(next, 0);\n                    } else if (prev && !next) {\n                        range.selectNodeContents(prev);\n                        range.collapse(false);\n                        range.setStartAfter(start);\n                    } else {\n                        range.setStartAfter(start);\n                        range.setEndBefore(end);\n                    }\n                }\n                this.app.selection.setRange(range);\n                var fix = start && end ? 2 : 1;\n                var offset = this.app.offset.get();\n                offset = {\n                    start: offset.start - fix,\n                    end: offset.end - fix\n                };\n                if (start) start.parentNode.removeChild(start);\n                if (end) end.parentNode.removeChild(end);\n                this.app.editor.setWinFocus();\n                this.app.offset.set(false, offset);\n            }\n        },\n        find: function(pos) {\n            var $editor = this.app.editor.getLayout();\n            var $marker = $editor.find(\"#selection-marker-\" + pos);\n            return $marker.length !== 0 ? $marker.get() : false;\n        },\n        remove: function() {\n            var start = this.find(\"start\");\n            var end = this.find(\"end\");\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n        },\n        // private\n        _restoreInject: function(range, start) {\n            var textNode = this.app.utils.createInvisibleChar();\n            this.dom(start).after(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n        }\n    });\n    ArticleEditor.add(\"module\", \"state\", {\n        init: function() {\n            this.started = false;\n            this.storage = false;\n            this.state = false;\n            this.passed = true;\n            this.undoStorage = [];\n            this.redoStorage = [];\n        },\n        load: function() {\n            this.clear();\n            this.trigger(true);\n        },\n        stop: function() {\n            this.clear();\n        },\n        clear: function() {\n            this.storage = false;\n            this.state = false;\n            this.passed = true;\n            this.undoStorage = [];\n            this.redoStorage = [];\n        },\n        get: function() {\n            return this.undoStorage;\n        },\n        add: function(e) {\n            if (e && (e.ctrlKey || e.metaKey || this._isUndo(e) || this._isRedo(e)) || !this.app.observer.trigger) return;\n            // state\n            this.state = this._createState();\n            if (this.started === false) {\n                this._setState(this.state, 0);\n                this.started = true;\n            }\n        },\n        trigger: function(start) {\n            if (!this.passed) return;\n            // storage\n            var storage = this._createState();\n            // storage\n            if (this.state) storage = this.state;\n            else if (!this.state && !start) {\n                storage = this.storage;\n                this.started = true;\n            }\n            this._addState(storage);\n            // previous state\n            this.storage = this._createState();\n            this.state = false;\n        },\n        listen: function(e) {\n            // undo\n            if (this._isUndo(e)) {\n                e.preventDefault();\n                this.undo();\n                return true;\n            } else if (this._isRedo(e)) {\n                e.preventDefault();\n                this.redo();\n                return true;\n            }\n            this.passed = true;\n        },\n        undo: function() {\n            if (!this._hasUndo()) return;\n            this.passed = false;\n            var state = this._getUndo();\n            this._setRedo();\n            var $parsed = this.app.parser.parse(state[0]);\n            this.app.editor.getLayout().html($parsed.children());\n            this._rebuild(state, \"undo\");\n            var instance = this.app.block.get();\n            var el = instance && instance.isEditable() ? instance.getBlock() : false;\n            this.app.offset.set(el, state[1]);\n        },\n        redo: function() {\n            if (!this._hasRedo()) return;\n            this.passed = false;\n            var state = this.redoStorage.pop();\n            this._addState({\n                html: state[0],\n                offset: state[1]\n            });\n            var $parsed = this.app.parser.parse(state[0]);\n            this.app.editor.getLayout().html($parsed.children());\n            this._rebuild(state, \"redo\");\n            var instance = this.app.block.get();\n            var el = instance && instance.isEditable() ? instance.getBlock() : false;\n            this.app.offset.set(el, state[1]);\n        },\n        // private\n        _rebuild: function(state, type) {\n            this.app.editor.build();\n            this.app.editor.getLayout().find(\".\" + this.prefix + \"-block-state\").each((function($node) {\n                this.app.block.set($node);\n            }).bind(this));\n            this.app.broadcast(\"state.\" + type, {\n                html: state[0],\n                offset: state[1]\n            });\n        },\n        _isUndo: function(e) {\n            var key = e.which;\n            var ctrl = e.ctrlKey || e.metaKey;\n            return ctrl && key === 90 && !e.shiftKey && !e.altKey;\n        },\n        _isRedo: function(e) {\n            var key = e.which;\n            var ctrl = e.ctrlKey || e.metaKey;\n            return ctrl && (key === 90 && e.shiftKey || key === 89 && !e.shiftKey) && !e.altKey;\n        },\n        _hasUndo: function() {\n            return this.undoStorage.length !== 0;\n        },\n        _hasRedo: function() {\n            return this.redoStorage.length !== 0;\n        },\n        _getUndo: function() {\n            return this.undoStorage.length === 1 ? this.undoStorage[0] : this.undoStorage.pop();\n        },\n        _createState: function() {\n            var html = this.app.editor.getLayout().html();\n            html = this.app.utils.wrap(html, (function($w) {\n                $w.find(\".\" + this.prefix + \"-block-focus\").addClass(this.prefix + \"-block-state\");\n            }).bind(this));\n            var instance = this.app.block.get();\n            var el = instance && instance.isEditable() ? instance.getBlock() : false;\n            var unparsed = this.app.parser.unparse(html, true);\n            var offset = this.app.offset.get(el);\n            return {\n                html: unparsed,\n                offset: offset\n            };\n        },\n        _setState: function(state, pos) {\n            this.undoStorage[pos] = [\n                state.html,\n                state.offset\n            ];\n        },\n        _addState: function(state) {\n            var last = this.undoStorage[this.undoStorage.length - 1];\n            if (typeof last === \"undefined\" || last[0] !== state.html) {\n                this.undoStorage.push([\n                    state.html,\n                    state.offset\n                ]);\n                this._removeOverStorage();\n            } else last[1] = state.offset;\n        },\n        _setRedo: function() {\n            var state = this._createState();\n            this.redoStorage.push([\n                state.html,\n                state.offset\n            ]);\n            this.redoStorage = this.redoStorage.slice(0, this.opts.state.limit);\n        },\n        _removeOverStorage: function() {\n            if (this.undoStorage.length > this.opts.state.limit) this.undoStorage = this.undoStorage.slice(0, this.undoStorage.length - this.opts.state.limit);\n        }\n    });\n    ArticleEditor.add(\"module\", \"sync\", {\n        build: function() {\n            this.syncedHtml = this.app.$element.val();\n        },\n        trigger: function() {\n            if (!this.opts.editor.sync) return;\n            if (this.typingTimer) clearTimeout(this.typingTimer);\n            this.typingTimer = setTimeout((function() {\n                var html = this._getHtml();\n                if (this.is(html)) this._sync(html);\n            }).bind(this), 300);\n        },\n        invoke: function() {\n            var html = this._getHtml();\n            this.syncedHtml = html;\n            this._sync(html);\n        },\n        is: function(html) {\n            var sync = false;\n            if (this.syncedHtml !== html) {\n                this.syncedHtml = html;\n                sync = true;\n            }\n            return sync;\n        },\n        // private\n        _getHtml: function() {\n            var html = this.app.editor.getLayout().html();\n            return this.app.parser.unparse(html);\n        },\n        _sync: function(html) {\n            var event = this.app.broadcast(\"editor.before.change\", {\n                html: html\n            });\n            if (!event.isStopped()) {\n                this.app.$element.val(event.get(\"html\"));\n                this.app.autosave.send();\n                this.app.state.trigger();\n                this.app.broadcast(\"editor.change\", event);\n            }\n        }\n    });\n    ArticleEditor.add(\"module\", \"placeholder\", {\n        start: function() {\n            this.placeholder = false;\n            this.$layout = this.app.editor.getLayout();\n            // build\n            this._build();\n        },\n        handleClick: function(e) {\n            if (this.dom(e.target).hasClass(this.prefix + \"-placeholder\")) {\n                e.preventDefault();\n                e.stopPropagation();\n                this.app.editor.setFocus(\"start\");\n            }\n        },\n        trigger: function() {\n            if (this.placeholder && this.app.editor.isEmpty(true)) this.show();\n            else this.hide();\n        },\n        toggle: function() {\n            if (this.observerTimer) clearTimeout(this.observerTimer);\n            this.observerTimer = setTimeout(this.trigger.bind(this), 10);\n        },\n        show: function() {\n            this.$layout.addClass(this.prefix + \"-placeholder\");\n        },\n        hide: function() {\n            this.$layout.removeClass(this.prefix + \"-placeholder\");\n        },\n        change: function(value) {\n            this.opts.placeholder = value;\n            this._rebuild();\n            if (this.app.editor.isEmpty(true)) this.app.editor.setEmpty();\n        },\n        // private\n        _build: function() {\n            this._rebuild();\n            this.toggle();\n        },\n        _rebuild: function() {\n            var o = this.opts.placeholder;\n            var p = this.app.$element.attr(\"placeholder\");\n            var is = o !== false || p;\n            if (!is) return;\n            this.$layout.attr(\"placeholder\", o !== false ? o : p);\n            this.placeholder = true;\n        }\n    });\n    ArticleEditor.add(\"module\", \"list\", {\n        indent: function() {\n            var sel = this.app.selection.get();\n            var item = this.app.selection.getBlock();\n            var $item = this.dom(item);\n            var $prev = $item.prevElement();\n            var prev = $prev.get();\n            var isIndent = sel.collapsed && item && prev && prev.tagName === \"LI\";\n            this.app.selection.save(item);\n            if (isIndent) {\n                $prev = this.dom(prev);\n                var $prevChild = $prev.children(\"ul, ol\");\n                var $list = $item.closest(\"ul, ol\");\n                if ($prevChild.length !== 0) $prevChild.append($item);\n                else {\n                    var listTag = $list.get().tagName.toLowerCase();\n                    var $newList = this.dom(\"<\" + listTag + \">\");\n                    $newList.append($item);\n                    $prev.append($newList);\n                }\n            }\n            this.app.selection.restore();\n            return isIndent;\n        },\n        outdent: function() {\n            var sel = this.app.selection.get();\n            var item = this.app.selection.getBlock();\n            var $item = this.dom(item);\n            var isOutdent = false;\n            if (sel.collapsed && item) {\n                var $listItem = $item.parent();\n                var $liItem = $listItem.closest(\"li\");\n                var $prev = $item.prevElement();\n                var $next = $item.nextElement();\n                var prev = $prev.get();\n                var next = $next.get();\n                var nextItems, $newList;\n                var isTop = prev === false;\n                var isMiddle = prev !== false && next !== false;\n                this.app.selection.save(item);\n                // out\n                if ($liItem.length !== 0) {\n                    if (isMiddle) {\n                        nextItems = this._getAllNext($item.get());\n                        $newList = this.dom(\"<\" + $listItem.get().tagName.toLowerCase() + \">\");\n                        for(var i = 0; i < nextItems.length; i++)$newList.append(nextItems[i]);\n                        $liItem.after($item);\n                        $item.append($newList);\n                    } else {\n                        $liItem.after($item);\n                        if ($listItem.children().length === 0) $listItem.remove();\n                        else if (isTop) $item.append($listItem);\n                    }\n                    isOutdent = true;\n                }\n                this.app.selection.restore();\n            }\n            return isOutdent;\n        },\n        // private\n        _getAllNext: function(next) {\n            var nodes = [];\n            while(next){\n                var $next = this.dom(next).nextElement();\n                next = $next.get();\n                if (next) nodes.push(next);\n                else return nodes;\n            }\n            return nodes;\n        }\n    });\n    ArticleEditor.add(\"module\", \"cleaner\", {\n        cleanHtml: function(html) {\n            html = this.app.broadcastHtml(\"editor.before.clean\", html);\n            // local\n            var stored = {};\n            var storedIndex = 0;\n            var exceptedTags = this.opts.paste.blockTags.concat(this.opts.paste.inlineTags).concat(this.opts.paste.formTags);\n            // gdocs & word\n            var isPages = this._isPages(html);\n            var isMsWord = this._isHtmlMsWord(html);\n            var isEditor = this._isEditor(html);\n            // store\n            html = this.app.content.store(html, \"embed\", stored, storedIndex);\n            // remove doctype tag\n            html = this.app.content.removeDoctype(html);\n            // remove denied tags\n            html = this.app.content.removeTags(html, this.opts.tags.denied);\n            html = html.trim();\n            // remove comments\n            html = this.app.content.removeComments(html);\n            // remove style & script tag\n            html = this.app.content.removeTagsWithContent(html, [\n                \"script\",\n                \"style\"\n            ]);\n            // clean pages\n            html = isPages ? this._cleanPages(html) : html;\n            // clean gdocs\n            html = isMsWord ? html : this._cleanGDocs(html);\n            // encode php code\n            html = this._encodePhp(html);\n            // remove tags\n            html = this.app.content.removeTagsExcept(html, exceptedTags);\n            // clean ms word\n            html = isMsWord ? this._cleanMsWord(html) : html;\n            var restored = false;\n            // paste event clean embed figure/frame\n            if (!isEditor && this.app.event.pasteEvent) {\n                html = this.app.content.restore(html, \"embed\", stored);\n                restored = true;\n            }\n            // remove class && attrs if the pasting is not from the editor\n            if (!isEditor) {\n                var filterClass = this.opts.paste.keepClass.length !== 0 ? this.opts.paste.keepClass.join(\",\") : \"\";\n                var filterAttrs = this.opts.paste.keepAttrs.length !== 0 ? this.opts.paste.keepAttrs.join(\",\") : \"\";\n                html = this.app.utils.wrap(html, function($w) {\n                    var $elms = $w.find(\"*\");\n                    $elms.not(filterClass).removeAttr(\"class\");\n                    $elms.not(filterAttrs).each(function($node) {\n                        var node = $node.get();\n                        var attrs = node.attributes;\n                        for(var i = attrs.length - 1; i >= 0; i--){\n                            var name = attrs[i].name;\n                            if (name === \"class\" || name === \"dir\" || name.search(/^data-/) !== -1) continue;\n                            if (node.tagName === \"IMG\" && (name === \"src\" || name === \"alt\")) continue;\n                            if (node.tagName === \"A\" && (name === \"href\" || name === \"target\")) continue;\n                            node.removeAttribute(name);\n                        }\n                    });\n                });\n            }\n            // restore\n            if (!restored) html = this.app.content.restore(html, \"embed\", stored);\n            // work with style\n            if (isEditor) // cache styles for block and inline tags and img\n            html = this.app.content.cacheStyle(html);\n            else // remove style\n            html = this.app.content.removeStyleAttr(html);\n            // remove empty inline\n            html = this.app.content.removeEmptyInlines(html);\n            // clean empty\n            html = html.replace(/<figure[^>]*><\\/figure>/gi, \"\");\n            html = html.replace(/<p>&nbsp;<\\/p>/gi, \"<p></p>\");\n            html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, \"<p></p>\");\n            // gmail list paste\n            html = html.replace(/^<li/gi, \"<ul><li\");\n            html = html.replace(/<\\/li>$/gi, \"</li></ul>\");\n            if (isMsWord || isPages) {\n                html = html.replace(/<p><\\/p>/gi, \"\");\n                html = html.replace(/<p>\\s<\\/p>/gi, \"\");\n            }\n            html = this.app.utils.wrap(html, (function($w) {\n                // clean apple space\n                $w.find(\".Apple-converted-space\").unwrap();\n                // tidy lists\n                // place ul/ol into li\n                $w.find(\"ul, ol\").each(this._placeListToItem.bind(this));\n                // remove p in li\n                $w.find(\"li p\").unwrap();\n            }).bind(this));\n            // broadcast\n            return this.app.broadcastHtml(\"editor.clean\", html);\n        },\n        // private\n        _encodePhp: function(html) {\n            html = html.replace(\"<?php\", \"&lt;?php\");\n            html = html.replace(\"<?\", \"&lt;?\");\n            html = html.replace(\"?>\", \"?&gt;\");\n            return html;\n        },\n        _isEditor: function(html) {\n            return html.match(new RegExp('meta\\\\stype=\"' + this.prefix + '-editor\"', \"i\"));\n        },\n        _isHtmlMsWord: function(html) {\n            return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n        },\n        _isPages: function(html) {\n            return html.match(/name=\"Generator\"\\scontent=\"Cocoa\\sHTML\\sWriter\"/i);\n        },\n        _placeListToItem: function($node) {\n            var node = $node.get();\n            var prev = node.previousSibling;\n            if (prev && prev.tagName === \"LI\") {\n                var $li = this.dom(prev);\n                $li.find(\"p\").unwrap();\n                $li.append(node);\n            }\n        },\n        _cleanPages: function(html) {\n            html = html.replace(/\\sclass=\"s[0-9]\"/gi, \"\");\n            html = html.replace(/\\sclass=\"p[0-9]\"/gi, \"\");\n            return html;\n        },\n        _cleanGDocs: function(html) {\n            if (html.search(/docs-internal-guid/i) !== -1) {\n                html = this.app.utils.wrap(html, function($w) {\n                    var $elms = $w.find(\"h1, h2, h3, h4, h5, h6\");\n                    $elms.each(function($node) {\n                        $node.find(\"span\").unwrap();\n                    });\n                });\n                html = html.replace(/ dir=\"[^>]*\"/gi, \"\");\n            }\n            html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n            html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n            html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?(bold|600|700)|font-weight:\\s?(bold|600|700);\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, \"<b><i>$4</i></b>\");\n            html = html.replace(/<span[^>]*font-style:\\s?italic[^>]*>([\\w\\W]*?)<\\/span>/gi, \"<i>$1</i>\");\n            html = html.replace(/<span[^>]*font-weight:\\s?(bold|600|700)[^>]*>([\\w\\W]*?)<\\/span>/gi, \"<b>$2</b>\");\n            return html;\n        },\n        _cleanMsWord: function(html) {\n            // comments\n            html = html.replace(/<!--[\\s\\S]+?-->/gi, \"\");\n            html = html.trim();\n            html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|meta|link|style|\\w:\\w+)(?=[\\s/>]))[^>]*>/gi, \"\");\n            html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n            html = html.replace(/&nbsp;/gi, \" \");\n            html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n                return spaces.length > 0 ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length / 2)).split(\"\").join(\"\\xa0\") : \"\";\n            });\n            html = this.app.utils.wrap(html, (function($w) {\n                // build lists\n                $w.find(\"p\").each(function($node) {\n                    var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec($node.attr(\"style\"));\n                    if (matches) $node.attr(\"data-listLevel\", parseInt(matches[1], 10));\n                });\n                // parse Lists\n                this._parseWordLists($w);\n                $w.find(\"[align]\").removeAttr(\"align\");\n                $w.find(\"[name]\").removeAttr(\"name\");\n                $w.find(\"span\").each(function($node) {\n                    var str = $node.attr(\"style\");\n                    var matches = /mso-list:Ignore/.exec(str);\n                    if (matches) $node.remove();\n                    else $node.unwrap();\n                });\n                $w.find(\"[style]\").removeAttr(\"style\");\n                $w.find(\"[class^='Mso']\").removeAttr(\"class\");\n                $w.find(\"a\").filter(function($node) {\n                    return !$node.attr(\"href\");\n                }).unwrap();\n            }).bind(this));\n            html = html.replace(/<p><img(.*?)>/gi, \"<p><img$1></p><p>\");\n            html = html.replace(/<p[^>]*><\\/p>/gi, \"\");\n            html = html.replace(/<li>/gi, \"<li>\");\n            html = html.trim();\n            // remove spaces between\n            html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, \"/$1>\\n<$2\");\n            var result = \"\";\n            var lines = html.split(/\\n/);\n            for(var i = 0; i < lines.length; i++){\n                var space = lines[i] !== \"\" && lines[i].search(/>$/) === -1 ? \" \" : \"\\n\";\n                result += lines[i] + space;\n            }\n            result = result.trim();\n            return result;\n        },\n        _parseWordLists: function($w) {\n            var lastLevel = 0;\n            var $item = null;\n            var $list = null;\n            var $listChild = null;\n            $w.find(\"p\").each((function($node) {\n                var level = $node.attr(\"data-listLevel\");\n                if (level === null && $node.hasClass(\"MsoListParagraphCxSpMiddle\")) level = 1;\n                if (level !== null) {\n                    var txt = $node.text();\n                    var listTag = /^\\s*\\w+\\./.test(txt) ? \"<ol></ol>\" : \"<ul></ul>\";\n                    // new parent list\n                    if ($node.hasClass(\"MsoListParagraphCxSpFirst\") || $node.hasClass(\"MsoNormal\")) {\n                        $list = this.dom(listTag);\n                        $node.before($list);\n                    } else if (level > lastLevel && lastLevel !== 0) {\n                        $listChild = this.dom(listTag);\n                        $item.append($listChild);\n                        $list = $listChild;\n                    }\n                    // level up\n                    if (level < lastLevel) {\n                        var len = lastLevel - level + 1;\n                        for(var i = 0; i < len; i++)$list = $list.parent();\n                    }\n                    // create item\n                    $node.find(\"span\").first().unwrap();\n                    $item = this.dom(\"<li>\" + $node.html().trim() + \"</li>\");\n                    if ($list === null) {\n                        $node.before(listTag);\n                        $list = $node.prev();\n                    }\n                    // append\n                    $list.append($item);\n                    $node.remove();\n                    lastLevel = level;\n                } else {\n                    $list = null;\n                    lastLevel = 0;\n                }\n            }).bind(this));\n        }\n    });\n    ArticleEditor.add(\"module\", \"tidy\", {\n        init: function() {},\n        parse: function(code) {\n            code = this.app.content.encodeAttrSings(code);\n            // clean setup\n            var ownLine = [\n                \"li\"\n            ];\n            var contOwnLine = [\n                \"li\"\n            ];\n            var newLevel = [\n                \"p\",\n                \"ul\",\n                \"ol\",\n                \"li\",\n                \"div\",\n                \"h1\",\n                \"h2\",\n                \"h3\",\n                \"h4\",\n                \"h5\",\n                \"h6\",\n                \"blockquote\",\n                \"figure\",\n                \"figcaption\",\n                \"table\",\n                \"thead\",\n                \"tbody\",\n                \"tfoot\",\n                \"tr\",\n                \"td\",\n                \"th\",\n                \"dl\",\n                \"dt\",\n                \"dd\"\n            ];\n            this.lineBefore = new RegExp(\"^<(/?\" + ownLine.join(\"|/?\") + \"|\" + contOwnLine.join(\"|\") + \")[ >]\");\n            this.lineAfter = new RegExp(\"^<(/?\" + ownLine.join(\"|/?\") + \"|/\" + contOwnLine.join(\"|/\") + \")[ >]\");\n            this.newLevel = new RegExp(\"^</?(\" + newLevel.join(\"|\") + \")[ >]\");\n            var i = 0, codeLength = code.length, point = 0, start = null, end = null, tag = \"\", out = \"\", cont = \"\";\n            this.cleanlevel = 0;\n            for(; i < codeLength; i++){\n                point = i;\n                // if no more tags, copy and exit\n                if (-1 === code.substr(i).indexOf(\"<\")) {\n                    out += code.substr(i);\n                    return this.finish(out);\n                }\n                // copy verbatim until a tag\n                while(point < codeLength && code.charAt(point) !== \"<\")point++;\n                if (i !== point) {\n                    cont = code.substr(i, point - i);\n                    if (!cont.match(/^\\s{2,}$/g)) {\n                        if (\"\\n\" === out.charAt(out.length - 1)) out += this.getTabs();\n                        else if (\"\\n\" === cont.charAt(0)) {\n                            out += \"\\n\" + this.getTabs();\n                            cont = cont.replace(/^\\s+/, \"\");\n                        }\n                        out += cont;\n                    }\n                //if (cont.match(/\\n/)) out += '\\n' + this.getTabs();\n                }\n                start = point;\n                // find the end of the tag\n                while(point < codeLength && \">\" !== code.charAt(point))point++;\n                tag = code.substr(start, point - start);\n                i = point;\n                var t;\n                if (\"!--\" === tag.substr(1, 3)) {\n                    if (!tag.match(/--$/)) {\n                        while(\"-->\" !== code.substr(point, 3))point++;\n                        point += 2;\n                        tag = code.substr(start, point - start);\n                        i = point;\n                    }\n                    if (\"\\n\" !== out.charAt(out.length - 1)) out += \"\\n\";\n                    out += this.getTabs();\n                    out += tag + \">\\n\";\n                } else if (\"!\" === tag[1]) out = this.placeTag(tag + \">\", out);\n                else if (\"?\" === tag[1]) out += tag + \">\\n\";\n                else if (t === tag.match(/^<(script|style|pre)/i)) {\n                    t[1] = t[1].toLowerCase();\n                    tag = this.cleanTag(tag);\n                    out = this.placeTag(tag, out);\n                    end = String(code.substr(i + 1)).toLowerCase().indexOf(\"</\" + t[1]);\n                    if (end) {\n                        cont = code.substr(i + 1, end);\n                        i += end;\n                        out += cont;\n                    }\n                } else {\n                    tag = this.cleanTag(tag);\n                    out = this.placeTag(tag, out);\n                }\n            }\n            return this.finish(out);\n        },\n        getTabs: function() {\n            var s = \"\";\n            for(var j = 0; j < this.cleanlevel; j++)s += \"    \";\n            return s;\n        },\n        finish: function(code) {\n            code = code.replace(/\\n\\s*\\n/g, \"\\n\");\n            code = code.replace(/^[\\s\\n]*/, \"\");\n            code = code.replace(/[\\s\\n]*$/, \"\");\n            code = code.replace(/<li(.*?)>[\\s\\n]*/gi, \"<li$1>\");\n            code = code.replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\\s\\n]*<\\/\\1>/gi, \"<$1$2></$1>\");\n            code = code.replace(/[\\s\\n]*<\\/li>/gi, \"</li>\");\n            code = code.replace(/<script(.*?)>\\n<\\/script>/gi, \"<script$1></script>\");\n            code = this.app.content.decodeAttrSings(code);\n            this.cleanlevel = 0;\n            return code;\n        },\n        cleanTag: function(tag) {\n            var tagout = \"\";\n            tag = tag.replace(/\\n/g, \" \");\n            tag = tag.replace(/\\s{2,}/g, \" \");\n            tag = tag.replace(/^\\s+|\\s+$/g, \" \");\n            var suffix = \"\";\n            if (tag.match(/\\/$/)) {\n                suffix = \"/\";\n                tag = tag.replace(/\\/+$/, \"\");\n            }\n            var m;\n            while(m = /\\s*([^= ]+)(?:=((['\"']).*?\\3|[^ ]+))?/.exec(tag)){\n                if (m[2]) tagout += m[1].toLowerCase() + \"=\" + m[2];\n                else if (m[1]) tagout += m[1].toLowerCase();\n                tagout += \" \";\n                tag = tag.substr(m[0].length);\n            }\n            return tagout.replace(/\\s*$/, \"\") + suffix + \">\";\n        },\n        placeTag: function(tag, out) {\n            var nl = tag.match(this.newLevel);\n            if (tag.match(this.lineBefore) || nl) {\n                out = out.replace(/\\s*$/, \"\");\n                out += \"\\n\";\n            }\n            if (nl && \"/\" === tag.charAt(1)) this.cleanlevel--;\n            if (\"\\n\" === out.charAt(out.length - 1)) out += this.getTabs();\n            if (nl && \"/\" !== tag.charAt(1)) this.cleanlevel++;\n            out += tag;\n            if (tag.match(this.lineAfter) || tag.match(this.newLevel)) {\n                out = out.replace(/ *$/, \"\");\n                out += \"\\n\";\n            }\n            return out;\n        }\n    });\n    ArticleEditor.add(\"module\", \"source\", {\n        start: function() {\n            this.eventname = this.prefix + \"-source-events\";\n            this._build();\n        },\n        toggle: function() {\n            if (this.is()) this.close();\n            else this.open();\n        },\n        is: function() {\n            return this.app.container.get(\"source\").css(\"display\") !== \"none\";\n        },\n        open: function() {\n            this.app.broadcast(\"source.before.open\");\n            var html = this.app.editor.getContent();\n            html = this.app.tidy.parse(html);\n            var height = this.app.container.get(\"editor\").height();\n            this.$source.height(height);\n            this.$source.val(html);\n            this.$source.on(\"focus.\" + this.eventname, this._handleFocus.bind(this));\n            this.$source.on(\"input.\" + this.eventname, this._handleChanges.bind(this));\n            this.$source.on(\"keydown.\" + this.eventname, this.app.input.handleTextareaTab.bind(this));\n            this.app.editor.unselectAll();\n            this.app.container.get(\"editor\").hide();\n            this.app.container.get(\"source\").show();\n            // codemirror\n            var codemirror = this.app.codemirror.create({\n                el: this.$source,\n                height: height,\n                focus: true\n            });\n            if (codemirror) {\n                codemirror.on(\"change\", this._handleChanges.bind(this));\n                codemirror.on(\"focus\", this._handleFocus.bind(this));\n            }\n            // ui\n            this.app.editor.disableUI();\n            this.app.toolbar.setToggled(\"html\");\n            // broadcast\n            this.app.broadcast(\"source.open\");\n        },\n        close: function() {\n            this.app.broadcast(\"source.before.close\");\n            var html = this.getContent();\n            this.app.codemirror.destroy();\n            this.$source.off(\".\" + this.eventname);\n            this.app.container.get(\"source\").hide();\n            this.app.container.get(\"editor\").show();\n            // set code\n            this.app.editor.setContent({\n                html: html,\n                caret: \"start\"\n            });\n            // ui\n            this.app.editor.enableUI();\n            this.app.toolbar.unsetToggled(\"html\");\n            // broadcast\n            this.app.broadcast(\"source.close\");\n        },\n        update: function(html) {\n            var func = this.app.editor.isTextarea() ? \"val\" : \"html\";\n            this.app.$element[func](html);\n        },\n        getContent: function() {\n            var html = this.$source.val();\n            html = this.app.codemirror.val(html);\n            return html;\n        },\n        // private\n        _build: function() {\n            if (!this.opts.source) return;\n            this.$source = this.dom(\"<textarea>\").addClass(this.prefix + \"-source\");\n            this.$source.attr(\"data-gramm_editor\", false);\n            this.app.container.get(\"source\").append(this.$source);\n        },\n        _handleFocus: function() {\n            this.app.editor.setFocus();\n        },\n        _handleChanges: function(e) {\n            var html = this.getContent();\n            this.update(html);\n            this.app.broadcast(\"source.change\", {\n                e: e\n            });\n        }\n    });\n    ArticleEditor.add(\"module\", \"content\", {\n        init: function() {\n            this._selectors = {\n                code: [\n                    \"pre\",\n                    \"code\"\n                ],\n                embed: [\n                    \"figure\"\n                ],\n                noneditable: [\n                    \".\" + this.opts.noneditable.classname\n                ],\n                images: [\n                    \"img\"\n                ],\n                links: [\n                    \"a\"\n                ]\n            };\n        },\n        // paragraphize\n        paragraphize: function(html) {\n            return this.app.paragraphizer.paragraphize(html);\n        },\n        // encode\n        encodeEntities: function(str) {\n            return this.decodeEntities(str).replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\");\n        },\n        encodeCode: function(html) {\n            html = this.encodeAttrSings(html);\n            // replace all tags\n            html = html.replace(/<\\s/gi, \"&lt; \");\n            html = html.replace(/<([^>]+)</gi, \"&lt;$1<\");\n            html = html.replace(/<(.*?)>/gi, \"xtagstartz$1xtagendz\");\n            // revert pre / code\n            html = html.replace(/xtagstartzpre(.*?)xtagendz/g, \"<pre$1>\");\n            html = html.replace(/xtagstartzcode(.*?)xtagendz/g, \"<code$1>\");\n            html = html.replace(/xtagstartz\\/codextagendz/g, \"</code>\");\n            html = html.replace(/xtagstartz\\/prextagendz/g, \"</pre>\");\n            // encode\n            html = this._encodeCode(html);\n            // revert all tags\n            html = html.replace(/xtagstartz([\\w\\W]*?)xtagendz/g, \"<$1>\");\n            html = html.replace(/xtagstartz\\/(.*?)xtagendz/g, \"</$1>\");\n            html = this.decodeAttrSings(html);\n            return html;\n        },\n        encodeAttrSings: function(html) {\n            var matches = html.match(/=\"(.*?)\"/g);\n            if (matches !== null) for(var i = 0; i < matches.length; i++){\n                if (matches[i].search(/^\"</) !== -1 || matches[i].search(/>\"$/) !== -1) continue;\n                var str = matches[i].replace(\">\", \"xmoresignz\");\n                str = str.replace(\"<\", \"xlesssignz\");\n                html = html.replace(matches[i], str);\n            }\n            return html;\n        },\n        // decode\n        decodeAttrSings: function(html) {\n            html = html.replace(/xmoresignz/gi, \">\");\n            html = html.replace(/xlesssignz/gi, \"<\");\n            return html;\n        },\n        decodeEntities: function(str) {\n            return String(str).replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").replace(/&quot;/g, '\"').replace(/&amp;/g, \"&\");\n        },\n        decodeHref: function(html) {\n            var pattern = '(href=\".*?)(&amp;)(.*?\">)';\n            var matches = html.match(new RegExp(pattern, \"g\"));\n            if (matches !== null) for(var i = 0; i < matches.length; i++)html = html.replace(matches[i], matches[i].replace(/&amp;/g, \"&\"));\n            return html;\n        },\n        // sanitize\n        sanitize: function(html) {\n            html = this.app.utils.wrap(html, (function($w) {\n                $w.find(\"[src]\").each(this._sanitizeSrc);\n                $w.find(\"a\").each(this._sanitizeHref);\n                $w.find(\"a,b,i,strong,em,svg,img,details,audio\").each(this._sanitizeEvents);\n            }).bind(this));\n            return html;\n        },\n        // escape\n        escapeHtml: function(str) {\n            return str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n        },\n        // store / restore\n        store: function(html, name, stored, storedIndex) {\n            var selectors = this._selectors[name];\n            for(var i = 0; i < selectors.length; i++){\n                var matched = this._getElementsFromHtml(html, selectors[i]);\n                html = this._store(html, name, matched, stored, storedIndex);\n            }\n            return html;\n        },\n        restore: function(html, name, stored) {\n            if (typeof stored[name] === \"undefined\") return html;\n            for(var i = 0; i < stored[name].length; i++)html = html.replace(\"####_\" + name + i + \"_####\", stored[name][i]);\n            return html;\n        },\n        storeComments: function(html, storedComments) {\n            var comments = html.match(new RegExp(\"<!--([\\\\w\\\\W]*?)-->\", \"gi\"));\n            if (comments === null) return html;\n            for(var i = 0; i < comments.length; i++){\n                html = html.replace(comments[i], \"#####xstarthtmlcommentzz\" + i + \"xendhtmlcommentzz#####\");\n                storedComments.push(comments[i]);\n            }\n            return html;\n        },\n        restoreComments: function(html, storedComments) {\n            for(var i = 0; i < storedComments.length; i++){\n                var str = storedComments[i].replace(/\\$/gi, \"&#36;\");\n                html = html.replace(\"#####xstarthtmlcommentzz\" + i + \"xendhtmlcommentzz#####\", str);\n            }\n            return html;\n        },\n        // cache / recache\n        cacheStyle: function(html) {\n            var selector = this.opts.tags.block.join(\",\") + \",img,\" + this.opts.tags.inline.join(\",\");\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(selector).each(this._cacheStyle.bind(this));\n            }).bind(this));\n        },\n        recacheStyle: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"[data-\" + this.prefix + \"-style-cache]\").each(this._recacheStyle.bind(this));\n            }).bind(this));\n        },\n        cacheElementStyle: function($el) {\n            let name = \"data-\" + this.prefix + \"-style-cache\", style = $el.attr(\"style\");\n            if (style) {\n                style = style.replace(/\"/g, \"\");\n                $el.attr(name, style);\n            } else if (!style || style === \"\") $el.removeAttr(name);\n        },\n        recacheElementStyle: function($el) {\n            let name = \"data-\" + this.prefix + \"-style-cache\", style = $el.attr(name);\n            $el.attr(\"style\", style).removeAttr(name);\n        },\n        // fix\n        fixListMargin: function($block) {\n            var ml = parseInt($block.css(\"margin-left\"));\n            if (ml !== 0) {\n                var pl = parseInt($block.css(\"padding-left\"));\n                $block.css({\n                    \"margin-left\": 0,\n                    \"padding-left\": pl + ml + \"px\"\n                });\n                $block.attr(this.prefix + \"-list-left\", ml);\n            }\n        },\n        unfixListMargin: function($block) {\n            if ($block.attr(this.prefix + \"-list-left\")) {\n                $block.css({\n                    \"padding-left\": \"\",\n                    \"margin-left\": \"\"\n                });\n                $block.removeAttr(this.prefix + \"-list-left\");\n            }\n        },\n        // add\n        addNofollow: function(html) {\n            if (!this.opts.link.nofollow) return html;\n            return this.app.utils.wrap(html, function($w) {\n                $w.find(\"a\").attr(\"rel\", \"nofollow\");\n            });\n        },\n        addHttps: function(html) {\n            if (!this.opts.editor.https) return html;\n            html = html.replace('href=\"http://', 'href=\"https://');\n            html = html.replace('src=\"http://', 'src=\"https://');\n            html = html.replace('srcset=\"http://', 'srcset=\"https://');\n            return html;\n        },\n        addSpaceToBlocks: function(html) {\n            return html.replace(/<\\/(div|li|dt|dd|td|p|H[1-6])>\\n?/gi, \"</$1> \");\n        },\n        addBrToBlocks: function(html) {\n            return html.replace(/<\\/(div|li|dt|dd|td|p|H[1-6])>\\n?/gi, \"</$1><br>\");\n        },\n        addPredefinedTagClass: function($node) {\n            var tag = $node.get().tagName.toLowerCase();\n            var classes = typeof this.opts.classes.tags !== \"undefined\" ? this.opts.classes.tags : this.opts.classes;\n            if (typeof classes[tag] !== \"undefined\") $node.addClass(classes[tag]);\n        },\n        addPredefinedBlockClass: function($node) {\n            var type = $node.attr(\"data-\" + this.prefix + \"-type\");\n            var classes = this.opts.classes.blocks;\n            if (typeof classes[type] !== \"undefined\") $node.addClass(classes[type]);\n        },\n        // get\n        getPredefinedBlocks: function() {\n            var blocks = [];\n            Object.keys(this.opts.classes.blocks).forEach(function(key) {\n                blocks.push(key);\n            });\n            return blocks;\n        },\n        getPredefinedTags: function() {\n            var tags = [];\n            var classes = typeof this.opts.classes.tags !== \"undefined\" ? this.opts.classes.tags : this.opts.classes;\n            Object.keys(classes).forEach(function(key) {\n                tags.push(key);\n            });\n            return tags;\n        },\n        getText: function(n) {\n            var rv = \"\";\n            if (n.nodeType === 3) rv = n.nodeValue;\n            else {\n                for(var i = 0; i < n.childNodes.length; i++)rv += this.getText(n.childNodes[i]);\n                var d = n.nodeType === 1 ? getComputedStyle(n).getPropertyValue(\"display\") : \"\";\n                if (d.match(/^block/) || d.match(/list/) || n.tagName === \"BR\" || n.tagName === \"HR\") rv += \"\\n\";\n            }\n            return rv;\n        },\n        getTextFromHtml: function(html, params) {\n            var stored = {};\n            var storedIndex = 0;\n            var defaults = {\n                br: false,\n                nl: false,\n                trimlines: true,\n                images: false,\n                links: false\n            };\n            params = $ARX.extend({}, defaults, params);\n            html = this.store(html, \"code\", stored, storedIndex);\n            html = params.links ? this.store(html, \"links\", stored, storedIndex) : html;\n            html = params.images ? this.store(html, \"images\", stored, storedIndex) : html;\n            html = html.replace(/<(ul|ol)>\\s+<li>/gi, \"<$1><li>\");\n            html = html.replace(/<li[^>]*>\\n/gi, \"<li$1>\");\n            html = html.replace(/<p[^>]*>(\\s+|)<\\/p>/gi, \"xemptyz\");\n            html = html.replace(/<!--[\\s\\S]*?-->/gi, \"\");\n            html = html.replace(/<style[\\s\\S]*?style>/gi, \"\");\n            html = html.replace(/<script[\\s\\S]*?script>/gi, \"\");\n            html = html.replace(/<\\/(div|li|dt|dd|td|p|H[1-6])>\\n?/gi, \"</$1>\\n\");\n            html = html.replace(/&(lt|gt);/gi, \"x$1z\");\n            var $tmp = this.dom(\"<div>\").html(html);\n            html = this.getText($tmp.get());\n            // trim lines\n            if (params.trimlines) {\n                var str = \"\";\n                var arr = html.split(\"\\n\");\n                for(var i = 0; i < arr.length; i++)str += arr[i].trim() + \"\\n\";\n                html = str;\n            }\n            html = html.replace(/[\\n]+/g, \"\\n\");\n            html = html.replace(\"xemptyz\", \"\\n\");\n            html = html.replace(/x(lt|gt)z/gi, \"&$1;\");\n            // keep newlines\n            if (params.br) {\n                html = html.replace(/\\n/g, \"<br>\\n\");\n                html = html.replace(/<br\\s?\\/?>\\n?$/gi, \"\");\n            } else html = params.nl ? html : html.replace(/\\n/gi, \" \");\n            html = this.restore(html, \"code\", stored);\n            html = params.links ? this.restore(html, \"links\", stored) : html;\n            html = params.images ? this.restore(html, \"images\", stored) : html;\n            html = html.replace(/<pre[^>]*>/g, \"\");\n            html = html.replace(/<code[^>]*>/g, \"\");\n            html = html.replace(/<\\/pre>\\n?/g, \"\");\n            html = html.replace(/<\\/code>/g, \"\");\n            if (!params.images) {\n                html = html.replace(/<img[\\s\\S]*?>/gi, \"\");\n                html = html.replace(/<a[^>]*>(\\s+|)<\\/a>/gi, \"\");\n            }\n            return html.trim();\n        },\n        // extract\n        extractHtmlFromCaret: function(el) {\n            var node = this.dom(el).get();\n            var range = this.app.selection.getRange();\n            if (range) {\n                var cloned = range.cloneRange();\n                cloned.selectNodeContents(node);\n                cloned.setStart(range.endContainer, range.endOffset);\n                return cloned.extractContents();\n            }\n        },\n        // is\n        isEmptyHtml: function(html, emptyparagraph) {\n            html = html.trim();\n            html = this.app.utils.removeInvisibleChars(html);\n            html = html.replace(/^&nbsp;$/gi, \"1\");\n            html = html.replace(/&nbsp;/gi, \"\");\n            html = html.replace(/<\\/?br\\s?\\/?>/g, \"\");\n            html = html.replace(/\\s/g, \"\");\n            html = html.replace(/^<p>\\s\\S<\\/p>$/i, \"\");\n            html = html.replace(/<hr(.*?[^>])>$/i, \"hr\");\n            html = html.replace(/<iframe(.*?[^>])>$/i, \"iframe\");\n            html = html.replace(/<source(.*?[^>])>$/i, \"source\");\n            // remove comments\n            html = this.removeComments(html);\n            // remove empty tags\n            html = emptyparagraph ? html.replace(/<p[^>]*><\\/p>/gi, \"\") : html;\n            html = html.replace(/<[^/>]><\\/[^>]+>/gi, \"\");\n            html = html.replace(/<[^/>]><\\/[^>]+>/gi, \"\");\n            // trim\n            html = html.trim();\n            return html === \"\";\n        },\n        isLine: function(html) {\n            var element = document.createElement(\"div\");\n            element.innerHTML = html;\n            return this.dom(element).find(this.opts.tags.block.join(\",\") + \",img\").length === 0;\n        },\n        // remove\n        removeDoctype: function(html) {\n            return html.replace(new RegExp(\"<!doctype[^>]*>\", \"gi\"), \"\");\n        },\n        removeComments: function(html) {\n            return html.replace(/<!--[\\s\\S]*?-->\\n?/g, \"\");\n        },\n        removeTags: function(input, denied) {\n            var re = denied ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n            var replacer = !denied ? \"\" : function($0, $1) {\n                return denied.indexOf($1.toLowerCase()) === -1 ? $0 : \"\";\n            };\n            return input.replace(re, replacer);\n        },\n        removeTagsExcept: function(input, except) {\n            if (except === undefined) return input.replace(/(<([^>]+)>)/gi, \"\");\n            var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n            return input.replace(tags, function($0, $1) {\n                return except.indexOf($1.toLowerCase()) === -1 ? \"\" : $0;\n            });\n        },\n        removeTagsWithContent: function(html, tags) {\n            return this.app.utils.wrap(html, function($w) {\n                $w.find(tags.join(\",\")).remove();\n            });\n        },\n        removeMarkers: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\".\" + this.prefix + \"-plus-button\").remove();\n                $w.find(\".\" + this.prefix + \"pastemarker\").removeClass(this.prefix + \"pastemarker\");\n                $w.find(\".\" + this.prefix + \"pasteitems\").removeClass(this.prefix + \"pasteitems\");\n                $w.find(\".\" + this.prefix + \"-selection-marker\").remove();\n            }).bind(this));\n        },\n        removeEmptySpans: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"span\").each(this._removeEmptySpan.bind(this));\n            }).bind(this));\n        },\n        removeEmptyInlines: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(this.opts.tags.inline.join(\",\")).each(this._removeEmptyTag.bind(this));\n            }).bind(this));\n        },\n        removeEmptyAttrs: function(html, attrs) {\n            return this.app.utils.wrap(html, function($w) {\n                for(var i = 0; i < attrs.length; i++)$w.find(\"[\" + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n            });\n        },\n        removeBlockTags: function(html, tags, except) {\n            var blocks = this.opts.tags.block.concat();\n            // except\n            if (except) blocks = this.app.utils.removeFromArrayByValue(blocks, except);\n            // extend\n            if (tags) tags = tags ? this.app.utils.extendArray(blocks, tags) : blocks;\n            return this.removeTags(html, tags);\n        },\n        removeBlockTagsInside: function(html, tags) {\n            this.blockListTags = this.app.utils.removeFromArrayByValue(this.opts.tags.block.concat(), [\n                \"ul\",\n                \"ol\",\n                \"li\"\n            ]);\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(tags.join(\",\")).each(this._removeBlockTagsInside.bind(this));\n            }).bind(this));\n        },\n        removeInlineStyles: function(html) {\n            var inlines = this.app.utils.removeFromArrayByValue(this.opts.tags.inline, \"a\");\n            return this.app.utils.wrap(html, function($w) {\n                $w.find(inlines.join(\",\")).removeAttr(\"style\");\n            });\n        },\n        removeStyleAttr: function(html, filter) {\n            filter = filter || \"\";\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"*\").not(\"[data-\" + this.prefix + \"-style-cache]\" + filter).removeAttr(\"style\");\n            }).bind(this));\n        },\n        // private\n        _cacheStyle: function($el) {\n            var name = \"data-\" + this.prefix + \"-style-cache\";\n            var style = $el.attr(\"style\");\n            if (style) {\n                style = style.replace(/\"/g, \"\");\n                $el.attr(name, style);\n            } else if (!style || style === \"\") $el.removeAttr(name);\n        },\n        _recacheStyle: function($el) {\n            var name = \"data-\" + this.prefix + \"-style-cache\";\n            var style = $el.attr(name);\n            $el.attr(\"style\", style).removeAttr(name);\n        },\n        // clean\n        _cleanEmpty: function(html) {\n            html = html.trim();\n            html = this.app.utils.removeInvisibleChars(html);\n            html = html.replace(/<\\/?br\\s?\\/?>/g, \"\");\n            html = html.replace(/\\s/g, \"\");\n            return html;\n        },\n        // remove\n        _removeEmptySpan: function($node) {\n            if ($node.get().attributes.length === 0) $node.unwrap();\n        },\n        _removeEmptyTag: function($node) {\n            var html = $node.html().trim();\n            if ($node.get().attributes.length === 0 && html === \"\") $node.unwrap();\n        },\n        _removeBlockTagsInside: function($node) {\n            var tags = $node.get().tagName === \"LI\" ? this.blockListTags : this.opts.tags.block;\n            $node.find(tags.join(\",\")).append(\"<br>\").unwrap();\n        },\n        // store\n        _store: function(html, name, matched, stored, storedIndex) {\n            if (!matched) return html;\n            if (typeof stored[name] === \"undefined\") stored[name] = [];\n            for(var i = 0; i < matched.length; i++){\n                stored[name][storedIndex] = matched[i];\n                html = html.replace(matched[i], \"####_\" + name + storedIndex + \"_####\");\n                storedIndex++;\n            }\n            return html;\n        },\n        // get\n        _getElementsFromHtml: function(html, selector) {\n            var matched = [];\n            var $div = this.dom(\"<div>\").html(html);\n            $div.find(selector).each(function($node) {\n                matched.push($node.get().outerHTML);\n            });\n            return matched;\n        },\n        // sanitize\n        _sanitizeSrc: function($node) {\n            var node = $node.get();\n            var src = node.getAttribute(\"src\");\n            if (src.search(/^javascript:/i) !== -1 || node.tagName !== \"IMG\" && src.search(/^data:/i) !== -1) node.setAttribute(\"src\", \"\");\n        },\n        _sanitizeHref: function($node) {\n            var node = $node.get();\n            var str = node.getAttribute(\"href\");\n            if (str && str.search(/^javascript:/i) !== -1) node.setAttribute(\"href\", \"\");\n        },\n        _sanitizeEvents: function($node) {\n            $node.removeAttr(\"onload onerror ontoggle onwheel onmouseover oncopy\");\n        },\n        // encode\n        _encodeCode: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"pre code, pre, code\").each(this._encodeNode.bind(this));\n            }).bind(this));\n        },\n        _encodeNode: function($node) {\n            var node = $node.get();\n            var first = node.firstChild;\n            var html = node.innerHTML;\n            if (node.tagName === \"PRE\" && first && first.tagName === \"CODE\") return;\n            html = html.replace(/xtagstartz/g, \"<\");\n            html = html.replace(/xtagendz/g, \">\");\n            var encoded = this.decodeEntities(html);\n            node.textContent = this._encodeNodeHtml(encoded);\n        },\n        _encodeNodeHtml: function(html) {\n            html = html.replace(/&nbsp;/g, \" \").replace(/<br\\s?\\/?>/g, \"\\n\");\n            html = this.opts.code.spaces ? html.replace(/\\t/g, new Array(this.opts.code.spaces + 1).join(\" \")) : html;\n            return html;\n        }\n    });\n    ArticleEditor.add(\"module\", \"autoparse\", {\n        parse: function(html) {\n            if (!this.opts.paste.autoparse) return html;\n            var instance = this.app.block.get();\n            var storedComments = [];\n            // store comments\n            html = this.app.content.storeComments(html, storedComments);\n            // remove doctype tag\n            html = this.app.content.removeDoctype(html);\n            var tags = [\n                \"figure\",\n                \"html\",\n                \"form\",\n                \"pre\",\n                \"div\",\n                \"span\",\n                \"video\",\n                \"object\",\n                \"iframe\",\n                \"code\",\n                \"a\",\n                \"img\",\n                \"link\",\n                \"script\"\n            ];\n            var singleTags = [\n                \"div\",\n                \"img\",\n                \"html\",\n                \"span\"\n            ];\n            var stored = [];\n            var z = 0;\n            var i;\n            // store tags\n            for(i = 0; i < tags.length; i++){\n                var reTags = singleTags.indexOf(tags[i]) !== -1 ? \"<\" + tags[i] + \"[^>]*>\" : \"<\" + tags[i] + \"[^>]*>([\\\\w\\\\W]*?)</\" + tags[i] + \">\";\n                var matched = html.match(new RegExp(reTags, \"gi\"));\n                if (matched !== null) for(var y = 0; y < matched.length; y++){\n                    html = html.replace(matched[y], \"#####replaceparse\" + z + \"#####\");\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n            // links\n            html = html.replace(\"&amp;\", \"&\");\n            if ((html.match(this.opts.regex.aurl1) || html.match(this.opts.regex.aurl2)) && !html.match(this.opts.regex.imageurl)) html = this._formatLinks(html);\n            // images\n            if (html.match(this.opts.regex.imageurl)) {\n                var imagesMatches = html.match(this.opts.regex.imageurl);\n                for(i = 0; i < imagesMatches.length; i++)html = html.replace(imagesMatches[i], this._splitBlock(instance, '<img src=\"' + imagesMatches[i] + '\">'));\n            }\n            // restore\n            html = this._restoreReplaced(stored, html);\n            html = this.app.content.restoreComments(html, storedComments);\n            // repeat for nested tags\n            html = this._restoreReplaced(stored, html);\n            return html;\n        },\n        // private\n        _splitBlock: function(instance, str) {\n            return instance ? str = \"\\n\" + str + \"\\n\" : str;\n        },\n        _formatLinks: function(content) {\n            var target = this.opts.paste.linkTarget !== false ? ' target=\"' + this.opts.paste.linkTarget + '\"' : \"\";\n            var protocol = this.opts.editor.https ? \"https\" : \"http\";\n            var self = this;\n            content = content.replace(this.opts.regex.aurl1, function(url) {\n                return '<a href=\"' + url + '\"' + target + \">\" + self._subLinkText(url) + \"</a>\";\n            });\n            content = content.replace(this.opts.regex.aurl2, function(match, before, url) {\n                return before + '<a href=\"' + protocol + \"://\" + url + '\"' + target + \">\" + self._subLinkText(url) + \"</a>\";\n            });\n            return content;\n        },\n        _subLinkText: function(text) {\n            text = text.length > this.opts.link.size ? text.substring(0, this.opts.link.size) + \"...\" : text;\n            text = text.search(\"%\") === -1 ? decodeURIComponent(text) : text;\n            return text;\n        },\n        _restoreReplaced: function(stored, html) {\n            for(var i = 0; i < stored.length; i++)html = html.replace(\"#####replaceparse\" + i + \"#####\", stored[i]);\n            return html;\n        }\n    });\n    ArticleEditor.add(\"module\", \"caret\", {\n        set: function(el, type) {\n            var node = this.dom(el).get();\n            var range = this.app.editor.getDocNode().createRange();\n            var map = {\n                \"start\": \"_setStart\",\n                \"end\": \"_setEnd\",\n                \"before\": \"_setBefore\",\n                \"after\": \"_setAfter\"\n            };\n            if (!node || !this._isInPage(node)) return;\n            // focus\n            this.app.editor.setWinFocus();\n            // non editable inline node\n            if (this._isInline(node) && this._isNon(node)) {\n                if (type === \"start\") type = \"before\";\n                else if (type === \"end\") type = \"after\";\n            }\n            // set\n            this[map[type]](range, node);\n            this.app.selection.setRange(range);\n        },\n        is: function(el, type, removeblocks, trimmed, br) {\n            var node = this.dom(el).get();\n            var sel = this.app.editor.getWinNode().getSelection();\n            var result = false;\n            if (!node || !sel.isCollapsed) return result;\n            var position = this._getPosition(node, trimmed, br);\n            var size = this._getSize(node, removeblocks, trimmed);\n            if (type === \"end\") result = position === size;\n            else if (type === \"start\") result = position === 0;\n            return result;\n        },\n        // private\n        _setStart: function(range, node) {\n            range.setStart(node, 0);\n            range.collapse(true);\n            // block node has first inline\n            var inline = this._getInlineInside(node);\n            if (inline) range = this._setStartInline(range, inline);\n            // inline node\n            if (this._isInline(node)) this._insertInvisibleNode(range);\n        },\n        _setStartInline: function(range, inline) {\n            var inlines = this.app.element.getAllInlines(inline);\n            var node = inlines[0];\n            range.selectNodeContents(node);\n            range.collapse(true);\n        },\n        _setEnd: function(range, node) {\n            // block node has last inline\n            var last = node.nodeType === 1 ? node.lastChild : false;\n            var lastInline = last && this._isInline(last);\n            if (lastInline) node = last;\n            range.selectNodeContents(node);\n            range.collapse(false);\n        },\n        _setBefore: function(range, node) {\n            range.setStartBefore(node);\n            range.collapse(true);\n            // inline node\n            if (this._isInline(node)) this._insertInvisibleNode(range, node);\n        },\n        _setAfter: function(range, node) {\n            range.setStartAfter(node);\n            range.collapse(true);\n            // inline node\n            var tag = node.nodeType !== 3 ? node.tagName.toLowerCase() : false;\n            if (this._isInline(node) || tag === \"br\" || tag === \"svg\") this._insertInvisibleNode(range);\n        },\n        _insertInvisibleNode: function(range, before) {\n            var textNode = this.app.utils.createInvisibleChar();\n            if (before) before.parentNode.insertBefore(textNode, before);\n            else range.insertNode(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n            return textNode;\n        },\n        _getInlineInside: function(node) {\n            var inline = node.firstChild;\n            if (this._isInline(inline)) {\n                var inside = inline.firstChild;\n                while(inside){\n                    if (this._isInline(inside)) return inside;\n                    inside = inside.firstChild;\n                }\n                return inline;\n            }\n        },\n        _getSize: function(node, removeblocks, trimmed) {\n            var str;\n            var isTextNode = node.nodeType === 3;\n            if (removeblocks && removeblocks.length !== 0) {\n                var $node = this.dom(node);\n                var $cloned = $node.clone();\n                $cloned.find(removeblocks.join(\",\")).remove();\n                str = $cloned.html().trim();\n            } else {\n                str = isTextNode ? node.textContent : node.innerHTML;\n                str = isTextNode || trimmed === false ? str : str.trim();\n            }\n            return this._trimmed(str, isTextNode, trimmed).length;\n        },\n        _getPosition: function(node, trimmed, br) {\n            var range = this.app.editor.getWinNode().getSelection().getRangeAt(0);\n            var caretRange = range.cloneRange();\n            var tmp = document.createElement(\"div\");\n            var isTextNode = node.nodeType === 3;\n            caretRange.selectNodeContents(node);\n            caretRange.setEnd(range.endContainer, range.endOffset);\n            tmp.appendChild(caretRange.cloneContents());\n            var str = isTextNode || trimmed === false ? tmp.innerHTML : tmp.innerHTML.trim();\n            var brEnd = str.search(/<\\/?br\\s?\\/?>$/g) !== -1 ? 1 : 0;\n            if (br === false) brEnd = 0;\n            str = this._trimmed(str, isTextNode, trimmed);\n            return str.length + brEnd;\n        },\n        _trimmed: function(str, isTextNode, trimmed) {\n            if (trimmed === false) {\n                str = str.replace(/\\n$/g, \"\");\n                return str;\n            }\n            str = this.app.utils.removeInvisibleChars(str);\n            str = str.replace(/<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi, \"\");\n            str = str.replace(/\\s+/g, \" \");\n            if (str !== \"\" && !isTextNode) str = str.replace(/\\s$/, \"\");\n            return str;\n        },\n        _isInline: function(node) {\n            return this.app.element.is(node, \"inline\");\n        },\n        _isInPage: function(node) {\n            var isIn = false;\n            var doc = this.app.editor.getDocNode();\n            if (node && node.nodeType) isIn = node === doc.body ? false : doc.body.contains(node);\n            return isIn;\n        },\n        _isNon: function(node) {\n            return node.getAttribute(\"contenteditable\") === \"false\";\n        }\n    });\n    ArticleEditor.add(\"module\", \"selection\", {\n        init: function() {\n            this.savedSelection = false;\n            this.savedMarker = false;\n            this.savedPosition = false;\n            this.savedRange = false;\n        },\n        // get\n        get: function() {\n            var sel = this._getSelection();\n            var range = this._getRange(sel);\n            var current = this._getCurrent(sel);\n            return {\n                selection: sel,\n                range: range,\n                collapsed: this._getCollapsed(sel, range),\n                current: current,\n                parent: this._getParent(current)\n            };\n        },\n        getRange: function() {\n            return this._getRange(this.get().selection);\n        },\n        getNodes: function(data) {\n            var sel = this.get();\n            var isInline = data && (data.type && data.type === \"inline\" || data.tags && data.tags.indexOf(\"a\") !== -1);\n            var func = isInline ? \"_getAllRangeNodes\" : \"_getRangeNodes\";\n            var nodes = [];\n            if (this.app.editor.isAllSelected()) nodes = this.app.editor.getLayout().children().getAll();\n            else nodes = sel.selection && sel.range ? this[func](sel.range) : nodes;\n            return nodes.length > 0 ? this._filterNodes(nodes, sel.range, isInline, data) : nodes;\n        },\n        getCurrent: function() {\n            var sel = this._getSelection();\n            return this._getCurrent(sel);\n        },\n        getParent: function() {\n            var current = this.getCurrent();\n            return this._getParent(current);\n        },\n        getElement: function(el) {\n            return this._getElement(el, \"element\");\n        },\n        getInline: function(el) {\n            return this._getElement(el, \"inline\");\n        },\n        getTopInline: function(el) {\n            var node = el ? this.dom(el).get() : this.getCurrent();\n            var inlines = [];\n            while(node){\n                if (this._getElement(node, \"inline\")) inlines.push(node);\n                else break;\n                node = node.parentNode;\n            }\n            return inlines[inlines.length - 1];\n        },\n        getDataBlock: function(el) {\n            var sel = this._getSelection();\n            var node = el || this._getCurrent(sel);\n            if (node) {\n                node = this.dom(node).get();\n                while(node){\n                    if (node.nodeType === 1 && node.getAttribute(\"data-\" + this.prefix + \"-type\")) return this.dom(node);\n                    node = node.parentNode;\n                }\n            }\n            return this.dom();\n        },\n        getBlock: function(el) {\n            return this._getElement(el, \"block\");\n        },\n        getText: function(type, num) {\n            var sel = this.get();\n            var text = false;\n            if (!sel.selection) return false;\n            if (type && sel.range) {\n                num = typeof num === \"undefined\" ? 1 : num;\n                var el = this.app.editor.getLayout().get();\n                var cloned = sel.range.cloneRange();\n                if (type === \"before\") {\n                    cloned.collapse(true);\n                    cloned.setStart(el, 0);\n                    text = cloned.toString().slice(-num);\n                } else if (type === \"after\") {\n                    cloned.selectNodeContents(el);\n                    cloned.setStart(sel.range.endContainer, sel.range.endOffset);\n                    text = cloned.toString().slice(0, num);\n                }\n            } else text = sel.selection ? sel.selection.toString() : \"\";\n            return text;\n        },\n        getHtml: function() {\n            var html = \"\";\n            var sel = this.get();\n            if (sel.selection) {\n                var cloned = sel.range.cloneContents();\n                var div = document.createElement(\"div\");\n                div.appendChild(cloned);\n                html = div.innerHTML;\n                html = html.replace(/<p><\\/p>$/i, \"\");\n            }\n            return html;\n        },\n        getPosition: function(type) {\n            var range = this.getRange();\n            var pos = {\n                top: 0,\n                left: 0,\n                width: 0,\n                height: 0\n            };\n            if (this.app.editor.getWinNode().getSelection && range.getBoundingClientRect) {\n                range = range.cloneRange();\n                if (type == \"end\") range.setStart(range.endContainer, range.endOffset);\n                else {\n                    var offset = range.startOffset - 1;\n                    range.setStart(range.startContainer, offset < 0 ? 0 : offset);\n                }\n                var rect = range.getBoundingClientRect();\n                pos = {\n                    top: rect.top,\n                    bottom: rect.bottom,\n                    left: rect.left,\n                    width: rect.right - rect.left,\n                    height: rect.bottom - rect.top\n                };\n            }\n            return pos;\n        },\n        // set\n        set: function(sel, range) {\n            if (sel) {\n                sel.removeAllRanges();\n                sel.addRange(range);\n            }\n        },\n        setRange: function(range) {\n            this.set(this.app.editor.getWinNode().getSelection(), range);\n        },\n        // is\n        is: function(el) {\n            if (typeof el !== \"undefined\") {\n                var node = this.dom(el).get();\n                var nodes = this.getNodes();\n                for(var i = 0; i < nodes.length; i++){\n                    if (nodes[i] === node) return true;\n                }\n            } else return this.get().selection;\n            return false;\n        },\n        isCollapsed: function() {\n            var sel = this.get();\n            return this._getCollapsed(sel.selection, sel.range);\n        },\n        isIn: function(el) {\n            var node = this.dom(el).get();\n            var current = this.getCurrent();\n            return current && node ? node.contains(current) : false;\n        },\n        isAll: function(el) {\n            var isEditor = !el;\n            var node = el ? this.dom(el).get() : this.app.editor.getLayout().get();\n            var selection = this.app.editor.getWinNode().getSelection();\n            var range = this._getRange(selection);\n            var isNode = isEditor ? true : this.is(node);\n            if (selection.isCollapsed) return false;\n            if (isNode) return typeof node.textContent !== \"undefined\" && node.textContent.trim().length === range.toString().trim().length;\n            else return false;\n        },\n        // select\n        select: function(el) {\n            var node = el ? this.dom(el).get() : this.app.editor.getLayout().get();\n            var range = this.app.editor.getDocNode().createRange();\n            range.selectNodeContents(node);\n            this.setRange(range);\n        },\n        // remove\n        removeAllRanges: function() {\n            var sel = this._getSelection();\n            if (sel) sel.removeAllRanges();\n        },\n        // delete\n        deleteContents: function() {\n            var range = this.getRange();\n            if (!this.isCollapsed() && range) range.deleteContents();\n        },\n        // collapse\n        collapse: function(type) {\n            type = type || \"start\";\n            var sel = this.get();\n            if (sel.selection && !sel.collapsed) {\n                if (type === \"start\") sel.selection.collapseToStart();\n                else sel.selection.collapseToEnd();\n            }\n        },\n        // save & restore\n        save: function(el) {\n            if (!el) {\n                var instance = this.app.block.get();\n                if (instance) el = instance.getBlock();\n                else el = this.app.editor.getLayout();\n            }\n            this.savedSelection = {\n                el: el,\n                offset: this.app.offset.get(el)\n            };\n        },\n        restore: function(set) {\n            if (this.savedMarker) return;\n            if (!this.savedSelection) return;\n            // focus\n            this.app.editor.setWinFocus();\n            var el = this.savedSelection.el;\n            var instance = this.dom(el).dataget(\"instance\");\n            if (instance && set !== false) this.app.block.set(el);\n            if (el) {\n                el.focus();\n                this.app.offset.set(el, this.savedSelection.offset);\n            }\n            this.savedSelection = false;\n        },\n        saveMarker: function() {\n            this.savedMarker = true;\n            this.app.marker.insert();\n        },\n        restoreMarker: function() {\n            this.app.marker.restore();\n            this.savedMarker = false;\n            this.savedSelection = false;\n        },\n        // private\n        _getSelection: function() {\n            return this.app.editor.getSelection();\n        },\n        _getRange: function(selection) {\n            return selection ? selection.rangeCount > 0 ? selection.getRangeAt(0) : false : false;\n        },\n        _getCurrent: function(selection) {\n            return selection ? selection.anchorNode : false;\n        },\n        _getParent: function(current) {\n            return current ? current.parentNode : false;\n        },\n        _getElement: function(el, type) {\n            var sel = this._getSelection();\n            if (sel) {\n                var node = el || this._getCurrent(sel);\n                node = this.dom(node).get();\n                while(node){\n                    if (this.app.element.is(node, type)) return node;\n                    node = node.parentNode;\n                }\n            }\n            return false;\n        },\n        _getCollapsed: function(selection, range) {\n            var collapsed = false;\n            if (selection && selection.isCollapsed) collapsed = true;\n            else if (range && range.toString().length === 0) collapsed = true;\n            return collapsed;\n        },\n        _getNextNode: function(node) {\n            if (node.firstChild) return node.firstChild;\n            while(node){\n                if (node.nextSibling) return node.nextSibling;\n                node = node.parentNode;\n            }\n        },\n        _getRangeNodes: function(range, all) {\n            var start = range.startContainer.childNodes[range.startOffset] || range.startContainer;\n            var end = range.endContainer.childNodes[range.endOffset] || range.endContainer;\n            var commonAncestor = range.commonAncestorContainer;\n            var nodes = [];\n            var node;\n            if (all) {\n                if (!this.app.editor.isLayout(start)) nodes.push(start);\n                for(node = start.parentNode; node; node = node.parentNode){\n                    if (this.app.editor.isLayout(node)) break;\n                    nodes.push(node);\n                    if (node === commonAncestor) break;\n                }\n                nodes.reverse();\n                for(node = start; node; node = this._getNextNode(node)){\n                    if (node.nodeType !== 3 && this.dom(node.parentNode).closest(commonAncestor).length === 0) break;\n                    nodes.push(node);\n                    if (node === end) break;\n                }\n            } else {\n                // push first element\n                if (start.nodeType === 3) nodes.push(this.getBlock(start));\n                for(node = start; node; node = this._getNextNode(node)){\n                    if (node === commonAncestor) break;\n                    if (node.nodeType !== 3 && this.dom(node.parentNode).closest(commonAncestor).length === 0) break;\n                    nodes.push(node);\n                    if (node === end) break;\n                }\n            }\n            return nodes;\n        },\n        _getAllRangeNodes: function(range) {\n            return this._getRangeNodes(range, true);\n        },\n        _filterNodes: function(nodes, range, isInline, data) {\n            var selected = this.getText();\n            selected = selected ? selected.replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\") : \"\";\n            var finalNodes = [];\n            for(var i = 0; i < nodes.length; i++){\n                var push = true;\n                if (this.app.editor.isLayout(nodes[i])) push = false;\n                if (data) {\n                    push = data.types ? this._filterByTypes(push, data, nodes[i]) : push;\n                    push = data.selected ? this._filterBySelected(push, data, nodes[i], range, selected) : push;\n                    push = data.type ? this._filterByType(push, data, nodes[i], isInline) : push;\n                    push = data.tags ? this._filterByTags(push, data, nodes[i]) : push;\n                }\n                if (push) finalNodes.push(nodes[i]);\n            }\n            // filter blocks\n            var blocks = [];\n            if (data && (data.type === \"blocks\" || data.type === \"blocks-first\")) {\n                for(var z = 0; z < finalNodes.length; z++){\n                    var node;\n                    if (data.type === \"blocks-first\") node = !this.app.element.is(finalNodes[z], \"blocks-first\") ? this.app.element.getFirstLevel(finalNodes[z]).get() : finalNodes[z];\n                    else if (data.type === \"blocks\") node = !this.app.element.is(finalNodes[z], \"blocks\") ? this.app.element.getDataBlock(finalNodes[z]).get() : finalNodes[z];\n                    if (!this._isInNodesArray(blocks, node)) blocks.push(node);\n                }\n                finalNodes = blocks;\n            }\n            return finalNodes;\n        },\n        _filterByTypes: function(push, data, node) {\n            var type;\n            if (data.types === true) {\n                type = this.app.element.getType(node);\n                if (!type) push = false;\n            } else {\n                type = this.app.element.getType(node);\n                if (data.types.indexOf(type) === -1) push = false;\n            }\n            return push;\n        },\n        _filterByType: function(push, data, node, isInline) {\n            var type = data.type;\n            if (type === \"blocks\" || type === \"blocks-first\") type = \"block\";\n            if (isInline) {\n                if (data.links) {\n                    if (!this.app.element.is(node, type)) push = false;\n                } else if (node.nodeType === 1 && node.tagName === \"A\" || !this.app.element.is(node, type)) push = false;\n            } else if (!this.app.element.is(node, type)) push = false;\n            return push;\n        },\n        _filterByTags: function(push, data, node) {\n            var isTagName = typeof node.tagName !== \"undefined\";\n            if (!isTagName) push = false;\n            else if (isTagName && data.tags.indexOf(node.tagName.toLowerCase()) === -1) push = false;\n            return push;\n        },\n        _filterBySelected: function(push, data, node, range, selected) {\n            if (data.selected === true && !this._containsNodeText(range, node)) push = false;\n            else if (data.selected === \"inside\") {\n                if (node.nodeType === 1 && node.tagName === \"A\") push = true;\n                else if (!this._isTextSelected(node, selected)) push = false;\n            }\n            return push;\n        },\n        _isTextSelected: function(node, selected) {\n            var text = node.nodeType !== 9 ? this.app.utils.removeInvisibleChars(node.textContent) : \"\";\n            return selected === text || text.search(selected) !== -1 || selected.search(new RegExp(\"^\" + this.app.utils.escapeRegExp(text) + \"$\")) !== -1;\n        },\n        _isBackwards: function() {\n            var backwards = false;\n            var sel = this.get();\n            if (sel && !sel.collapsed) {\n                var range = this.app.editor.getDocNode().createRange();\n                range.setStart(sel.selection.anchorNode, sel.selection.anchorOffset);\n                range.setEnd(sel.selection.focusNode, sel.selection.focusOffset);\n                backwards = range.collapsed;\n                range.detach();\n            }\n            return backwards;\n        },\n        _containsNodeText: function(range, node) {\n            var treeWalker = this.app.editor.getDocNode().createTreeWalker(node, NodeFilter.SHOW_TEXT, {\n                acceptNode: function(node) {\n                    return NodeFilter.FILTER_ACCEPT;\n                }\n            }, false);\n            var first, last, textNode;\n            while(textNode = treeWalker.nextNode()){\n                if (!first) first = textNode;\n                last = textNode;\n            }\n            var nodeRange = range.cloneRange();\n            if (first) {\n                nodeRange.setStart(first, 0);\n                nodeRange.setEnd(last, last.length);\n            } else nodeRange.selectNodeContents(node);\n            return range.compareBoundaryPoints(Range.START_TO_START, nodeRange) < 1 && range.compareBoundaryPoints(Range.END_TO_END, nodeRange) > -1;\n        },\n        _isInNodesArray: function(nodes, node) {\n            return nodes.indexOf(node) !== -1;\n        }\n    });\n    ArticleEditor.add(\"module\", \"inline\", {\n        set (params) {\n            let $nodes = this.dom([]);\n            // close\n            this.app.popup.close();\n            // params\n            this.params = params || {};\n            // normalize style\n            if (this.params.style) {\n                let obj = {};\n                for (let [key, val] of Object.entries(this.params.style)){\n                    let str = key.replace(/([A-Z])/g, \" $1\");\n                    str = str.split(\" \").join(\"-\").toLowerCase();\n                    obj[str] = val;\n                }\n                this.params.style = obj;\n            }\n            if (!this.app.selection.getRange()) return;\n            if (this.app.selection.isCollapsed()) $nodes = this._formatCollapsed();\n            else $nodes = this._formatUncollapsed();\n            this.app.broadcast(\"inline.set\", {\n                $nodes: $nodes\n            });\n            this.app.sync.trigger();\n            this.app.editor.observeUI();\n            if (this.app.context) this.app.context.updatePosition();\n            return $nodes;\n        },\n        remove (params) {\n            let inlines = this.app.selection.getNodes({\n                type: \"inline\"\n            }), inline = this.app.selection.getTopInline();\n            // make split\n            if (this.app.selection.isCollapsed() && inline) {\n                let tag = inline.tagName.toLowerCase(), $target = this._insertSplit(inline, tag);\n                this.app.caret.set($target, \"before\");\n                return;\n            }\n            // remove\n            this.app.selection.save();\n            if (params.style) {\n                let arr = Array.isArray(params.style) ? params.style : [\n                    params.style\n                ];\n                for(let i = 0; i < inlines.length; i++){\n                    let $el = this.dom(inlines[i]);\n                    $el.removeAttr(\"data-\" + this.prefix + \"-style-cache\");\n                    for(let z = 0; z < arr.length; z++)$el.css(arr[z], \"\");\n                    if ($el.attr(\"style\") === \"\") $el.removeAttr(\"style\");\n                    this.app.content.cacheElementStyle($el);\n                }\n            } else if (params.classname) for(let i = 0; i < inlines.length; i++){\n                let $el = this.dom(inlines[i]);\n                $el.removeClass(params.classname);\n                if ($el.attr(\"class\") === \"\") $el.removeAttr(\"class\");\n            }\n            this.app.selection.restore();\n            if (this.app.context) this.app.context.updatePosition();\n        },\n        removeFormat () {\n            this.app.popup.close();\n            // instance\n            let instance = this.app.block.get(), $block, nodes, i = 0, $node;\n            if (!instance) return;\n            // save selection\n            $block = instance.getBlock();\n            this.app.selection.save($block);\n            nodes = this.app.selection.getNodes({\n                type: \"inline\"\n            });\n            for(i; i < nodes.length; i++){\n                $node = this.dom(nodes[i]);\n                if (!$node.attr(\"data\" + this.prefix + \"-type\")) $node.unwrap();\n            }\n            // restore selection\n            this.app.selection.restore();\n            this.app.editor.observeUI();\n            if (this.app.context) this.app.context.updatePosition();\n        },\n        _formatCollapsed () {\n            let node, inline = this.app.selection.getInline(), $inline = this.dom(inline), tags = this._getTags(), hasSameTag = this._isSameTag(inline, tags), point = this.params && this.params.caret ? this.params.caret : false;\n            // save\n            this.app.selection.save();\n            // 1) not inline\n            if (!inline) {\n                node = this._insertInline(this.params.tag, point);\n                node = this._setParams(node);\n            } else if (inline && this.app.utils.isEmptyHtml(inline.innerHTML)) {\n                // 2.1) has same tag\n                if (hasSameTag) {\n                    // 2.2.1) params\n                    if (this._isParams()) {\n                        // all the same\n                        if (this._hasAllSameParams(inline)) {\n                            this.app.caret.set(inline, point ? point : \"after\");\n                            $inline.remove();\n                        } else if (this._hasSameClassname(inline)) {\n                            this.app.selection.restore();\n                            node = this._setStyle(inline);\n                        } else if (this._hasSameStyle(inline)) {\n                            this.app.selection.restore();\n                            node = this._setClassname(inline);\n                        } else {\n                            this.app.selection.restore();\n                            node = this._setParams(inline);\n                        }\n                    } else {\n                        this.app.caret.set(inline, point ? point : \"after\");\n                        $inline.remove();\n                    }\n                } else {\n                    node = this._insertInline(this.params.tag, point);\n                    node = this._setParams(node);\n                }\n            } else if (inline) {\n                // 3.1) has same tag\n                if (hasSameTag) {\n                    // 3.1.1) params\n                    if (this._isParams()) {\n                        // all the same\n                        if (this._hasAllSameParams(inline)) this._makeSplit(inline, point);\n                        else if (this._hasSameClassname(inline)) {\n                            node = this._insertInline(this.params.tag, point);\n                            node = this._setStyle(node);\n                        } else if (this._hasSameStyle(inline)) {\n                            node = this._insertInline(this.params.tag, point);\n                            node = this._setClassname(node);\n                        } else {\n                            node = this._insertInline(this.params.tag, point);\n                            node = this._setParams(node);\n                        }\n                    } else this._makeSplit(inline, point);\n                } else {\n                    node = this._insertInline(this.params.tag, point);\n                    node = this._setParams(node);\n                }\n            }\n            return this.dom(node);\n        },\n        _formatUncollapsed () {\n            let $nodes = false, selectedAll = this.app.editor.isAllSelected(), $blocks = this.dom(this.app.selection.getNodes({\n                type: \"blocks\",\n                partial: true\n            }));\n            let inlines = this.app.selection.getNodes({\n                type: \"inline\"\n            });\n            // convert tags\n            this.app.selection.save();\n            this._convertTags($blocks, inlines);\n            this.app.selection.restore();\n            // convert strike\n            this.app.selection.save();\n            this._convertToStrike(inlines);\n            this.app.selection.restore();\n            // apply strike\n            this.app.editor.getDocNode().execCommand(\"strikethrough\");\n            // revert strike\n            this.app.selection.save();\n            $nodes = this._revertToInlines($blocks);\n            this.app.selection.restore();\n            // clean up\n            this._clearEmptyStyle();\n            // apply params\n            this.app.selection.save();\n            $nodes.each(this._applyParams.bind(this));\n            this.app.selection.restore();\n            // normalize\n            $blocks.each(function($node) {\n                $node.get().normalize();\n            });\n            // revert tags\n            this.app.selection.save();\n            this._revertTags($blocks);\n            this.app.selection.restore();\n            // caret\n            if (this.params.caret) {\n                let $last = $nodes.last();\n                this.app.caret.set($last, this.params.caret);\n            }\n            // all selected\n            if (selectedAll) this.app.editor.selectAll();\n            return $nodes;\n        },\n        // params\n        _isParams () {\n            return this.params.style || this.params.classname;\n        },\n        _applyParams ($node) {\n            let tag = $node.get().tagName.toLowerCase(), tags = this._getTags(), $parent = $node.parent(), hasSameTag = $parent.length !== 0 ? this._isSameTag($parent.get(), tags) : false;\n            if (hasSameTag && $parent.text() === $node.text()) // parent has same params keys\n            {\n                if (this.params.style) {\n                    let obj = this.params.style, parentObj = this.app.utils.cssToObject($parent.attr(\"style\")), len = Object.keys(obj).length, size = 0;\n                    for (let key of Object.keys(obj))if (parentObj[key]) size++;\n                    if (size === len) $parent.unwrap();\n                    else {\n                        $node.unwrap();\n                        this._applyParamsToNode($parent, tag);\n                    }\n                }\n            }\n            this._applyParamsToNode($node, tag);\n        },\n        _applyParamsToNode ($node, tag) {\n            $node.removeAttr(\"data-\" + this.prefix + \"-style-cache\");\n            if ($node.attr(\"class\") === \"\") $node.removeAttr(\"class\");\n            if ($node.get().attributes.length === 0) {\n                if (this._isParams() && this.params.tag === \"span\") {\n                    this._setParams($node);\n                    this._clearSpanInside($node);\n                } else if (tag === \"span\") $node.unwrap();\n            } else if (this._isParams()) {\n                this._setParams($node);\n                this._clearSpanInside($node);\n            }\n        },\n        _setParams (el) {\n            el = this._setClassname(el);\n            el = this._setStyle(el);\n            return el;\n        },\n        _setClassname (el) {\n            let $node = this.dom(el);\n            if (this.params.classname) {\n                // remove group classes\n                if (this.params.group) {\n                    let optName = \"inlineGroups.\" + this.params.group;\n                    let classes = this.opts.is(optName) ? this.opts.get(optName) : false;\n                    if (classes) $node.removeClass(classes.join(\" \"));\n                } else $node.removeAttr(\"class\");\n                // add class\n                $node.addClass(this.params.classname);\n            }\n            return $node.get();\n        },\n        _setStyle (el) {\n            let $node = this.dom(el);\n            if (this.params.style) {\n                $node.css(this.params.style);\n                this.app.content.cacheElementStyle($node);\n            }\n            return $node.get();\n        },\n        _hasAllSameParams (el) {\n            return this._hasSameClassname(el) && this._hasSameStyle(el);\n        },\n        _hasSameClassname (el) {\n            let $el = this.dom(el);\n            if (this.params.classname) return $el.hasClass(this.params.classname);\n            return true;\n        },\n        _hasSameStyle (el) {\n            let $el = this.dom(el);\n            if (this.params.style) return this.app.element.compareStyle($el, this.params.style);\n            return true;\n        },\n        // insert\n        _makeSplit (inline, point) {\n            let caret = this.app.create(\"caret\"), isEnd = caret.is(inline, \"end\"), target = inline;\n            if (isEnd) point = \"after\";\n            else target = this._insertSplit(inline);\n            caret.set(target, point ? point : \"before\");\n        },\n        _insertSplit (inline, tag) {\n            let $inline = this.dom(inline), extractedContent = this.app.content.extractHtmlFromCaret(inline), $secondPart = this.dom(\"<\" + (tag || this.params.tag) + \" />\"), div = document.createElement(\"div\");\n            div.appendChild(extractedContent);\n            $secondPart = this.app.element.cloneAttrs(inline, $secondPart);\n            $secondPart.append(div.innerHTML);\n            $inline.after($secondPart);\n            return $secondPart;\n        },\n        _insertInline (tag, point) {\n            let insertion = this.app.create(\"insertion\");\n            return insertion.insertNode(document.createElement(tag), point ? point : \"start\");\n        },\n        // tag\n        _isSameTag (inline, tags) {\n            return inline && tags.indexOf(inline.tagName.toLowerCase()) !== -1;\n        },\n        _getTags () {\n            let tags = [\n                this.params.tag\n            ];\n            if (this.params.tag === \"b\" || this.params.tag === \"strong\") tags = [\n                \"b\",\n                \"strong\"\n            ];\n            else if (this.params.tag === \"i\" || this.params.tag === \"em\") tags = [\n                \"i\",\n                \"em\"\n            ];\n            return tags;\n        },\n        // convert\n        _convertToStrike (inlines) {\n            let selected = this.app.selection.getText().replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\"), tags = this._getTags(), inline, $inline, tag, hasSameArgs, convertable = false;\n            for(let i = 0; i < inlines.length; i++){\n                inline = inlines[i];\n                $inline = this.dom(inline);\n                tag = inlines[i].tagName.toLowerCase();\n                hasSameArgs = this._hasAllSameParams(inline);\n                if (tags.indexOf(tag) !== -1) {\n                    if (this.params.tag === \"span\" && this._isFullySelected(inline, selected)) {\n                        $inline.addClass(\"rx-inline-convertable\");\n                        $inline.removeAttr(\"data-\" + this.prefix + \"-style-cache\");\n                    } else if (hasSameArgs && this.params.tag !== \"a\") this._replaceToStrike($inline);\n                    else if (this.params.tag === \"span\") {\n                        if (this.params.style && this._hasSameStyle($inline)) convertable = true;\n                        if (this.params.classname && this._hasSameClassname($inline)) convertable = true;\n                        if (convertable) {\n                            $inline.addClass(\"rx-inline-convertable\");\n                            $inline.removeAttr(\"data-\" + this.prefix + \"-style-cache\");\n                        } else $inline.addClass(\"rx-inline-unconvertable\");\n                    } else if (!hasSameArgs) {\n                        $inline.addClass(\"rx-inline-convertable\");\n                        $inline.removeAttr(\"data-\" + this.prefix + \"-style-cache\");\n                    }\n                }\n            }\n        },\n        _convertInlineBlocks ($blocks) {\n            $blocks.find(\"[data-\" + this.prefix + \"-inline]\").each(function($node) {\n                if ($node.attr(\"contenteditable\") === true) $node.addClass(\"rx-inlineblock-editable\").attr(\"contenteditable\", false);\n            });\n        },\n        _convertTag (tag, $blocks) {\n            if (this.params.tag !== tag) $blocks.find(tag).each((function($node) {\n                let $el = this.app.element.replaceToTag($node, \"span\");\n                $el.addClass(\"rx-convertable-\" + tag);\n            }).bind(this));\n            else if (this.params.tag === \"del\") $blocks.find(tag).each((function($node) {\n                this.app.element.replaceToTag($node, \"strike\");\n            }).bind(this));\n        },\n        _convertTags ($blocks, inlines) {\n            this._convertTag(\"del\", $blocks);\n            this._convertTag(\"u\", $blocks);\n            this._convertInlineBlocks($blocks);\n        },\n        _replaceToStrike ($el) {\n            $el.replaceWith((function() {\n                return this.dom(\"<strike>\").append($el.contents());\n            }).bind(this));\n        },\n        _revertInlineBlocks ($blocks) {\n            $blocks.find(\".rx-inlineblock-editable\").removeClass(\"rx-inlineblock-editable\").attr(\"contenteditable\", true);\n        },\n        _revertTag (tag, $blocks) {\n            $blocks.find(\"span.rx-convertable-\" + tag).each((function(node) {\n                let $el = this.app.element.replaceToTag(node, tag);\n                $el.removeAttr(\"class\");\n            }).bind(this));\n        },\n        _revertTags ($blocks) {\n            this._revertTag(\"u\", $blocks);\n            this._revertTag(\"del\", $blocks);\n            this._revertInlineBlocks($blocks);\n        },\n        _revertToInlines ($blocks) {\n            let $el, $nodes = this.dom([]);\n            if (this.params.tag !== \"u\") $blocks.find(\"u\").unwrap();\n            // styled\n            $blocks.each(function($node) {\n                $node.find(\"*\").each(function(node) {\n                    if (node.get().style.textDecorationLine) {\n                        node.css(\"text-decoration-line\", \"\");\n                        node.wrap(\"<u>\");\n                        if (node.attr(\"style\") === \"\") node.removeAttr(\"style\");\n                    }\n                });\n            });\n            // span convertable\n            $blocks.find(\".rx-inline-convertable\").each((function($node) {\n                $node.find(\"strike\").each(function($strike) {\n                    if ($node.text() === $strike.text()) $strike.unwrap();\n                });\n                $node.removeClass(\"rx-inline-convertable\");\n                this.app.element.removeEmptyAttrs($node, [\n                    \"class\"\n                ]);\n                if (this._hasAllSameParams($node)) $node.unwrap();\n                else $nodes.add($node);\n            }).bind(this));\n            // span unconvertable\n            $blocks.find(\"span.rx-inline-unconvertable\").each((function($node) {\n                $node.removeClass(\"rx-inline-unconvertable\");\n                this.app.element.removeEmptyAttrs($node, [\n                    \"class\"\n                ]);\n            }).bind(this));\n            // strike\n            $blocks.find(\"strike\").each((function($node) {\n                $node = this.app.element.replaceToTag($node, this.params.tag);\n                $nodes.add($node);\n            }).bind(this));\n            return $nodes;\n        },\n        _clearEmptyStyle () {\n            let inlines = this.app.selection.getNodes({\n                type: \"inline\"\n            }), i = 0, max = inlines.length, childNodes, z = 0;\n            for(i; i < max; i++){\n                this._clearEmptyStyleAttr(inlines[i]);\n                childNodes = inlines[i].childNodes;\n                if (childNodes) for(z; z < childNodes.length; z++)this._clearEmptyStyleAttr(childNodes[z]);\n            }\n        },\n        _clearEmptyStyleAttr (node) {\n            if (node.nodeType !== 3 && node.getAttribute(\"style\") === \"\") node.removeAttribute(\"style\");\n        },\n        _clearSpanInside ($node) {\n            $node.find(\"span\").each((function($el) {\n                if (this.params.classname) $el.removeAttr(\"class\");\n                if (this.params.styles) for (let key of Object.keys(this.params.styles))$el.css(key, \"\");\n                if ($el.attr(\"class\") === \"\") $el.removeAttr(\"class\");\n                if ($el.attr(\"style\") === \"\") $el.removeAttr(\"style\");\n                if ($el.get().attributes.length === 0) $el.unwrap();\n            }).bind(this));\n        },\n        _isFullySelected (node, selected) {\n            let text = this.app.utils.removeInvisibleChars(node.textContent);\n            return selected === text || selected.search(new RegExp(\"^\" + this.app.utils.escapeRegExp(text) + \"$\")) !== -1;\n        }\n    });\n    ArticleEditor.add(\"module\", \"popup\", {\n        init: function() {\n            this.stack = false;\n            this.stacks = [];\n            this.name = false;\n            this.supername = false;\n            this.autoclose = true;\n            this.control = false;\n            this.saved = false;\n        },\n        start: function() {\n            this._build();\n            this._buildDepth();\n        },\n        stop: function() {\n            this._stopEvents();\n            this._stop();\n        },\n        stopStack: function() {\n            this._stopEvents();\n            this.app.toolbar.unsetToggled();\n            this.$popup.removeAttr(\"data-\" + this.prefix + \"-popup-name\");\n            this.$popup.removeClass(\"open\");\n        },\n        // is\n        isOpen: function(name) {\n            var opened = this.$popup.hasClass(\"open\");\n            if (name) return this._getName() === name && opened;\n            return opened;\n        },\n        // create\n        create: function(name, params) {\n            if (this.isOpen(name)) return this.stack;\n            this._reset();\n            this.name = name;\n            this.supername = name;\n            this.stack = this._createStack(name, params);\n            return this.stack;\n        },\n        // add\n        add: function(name, params) {\n            return this._createStack(name, params, true);\n        },\n        // set\n        setStack: function(stack) {\n            this.stack = stack;\n            this.name = stack.getName();\n        },\n        setData: function(data) {\n            this.stack.setData(data);\n        },\n        setFocus: function(name) {\n            this.stack.setFocus(name);\n        },\n        setWidth: function(width) {\n            this.stack.setWidth(width);\n        },\n        // get\n        getName: function() {\n            return this.name;\n        },\n        getElement: function() {\n            return this.$popup;\n        },\n        getButton: function() {\n            return this.button;\n        },\n        getStack: function(name) {\n            return name ? this.stacks[name] : this.stack;\n        },\n        getBody: function() {\n            return this.stack.getBody();\n        },\n        getItems: function() {\n            return this.stack.getItems();\n        },\n        getFooter: function() {\n            return this.stack.getFooter();\n        },\n        getFooterPrimary: function() {\n            return this.stack.getFooterPrimary();\n        },\n        getTool: function(name) {\n            return this.stack.getTool(name);\n        },\n        getInput: function(name) {\n            return this.stack.getInput(name);\n        },\n        getFormItem: function(name) {\n            return this.stack.getFormItem(name);\n        },\n        getData: function(name) {\n            return this.stack.getData(name);\n        },\n        // open\n        open: function(params) {\n            // all popups are closed\n            if (!this.isOpen()) {\n                this.saved = false;\n                this._open(params);\n            } else if (this.isOpen(this.supername)) {\n                this.saved = true;\n                this.close(false);\n            } else {\n                this.saved = true;\n                this.close(false);\n                this._open(params, false);\n            }\n        },\n        openStack: function(name) {\n            var stack = this.getStack(name);\n            var params = {};\n            if (this.stack && this.stack.isCollapsed()) {\n                params = {\n                    collapse: true\n                };\n                this.removeStack(this.stack);\n            }\n            // open\n            stack.open(params);\n        },\n        // close\n        close: function(e, name) {\n            if (this.autoclose === false) {\n                if (e === true) ;\n                else if (!name) return;\n            }\n            if (!this.isOpen()) return;\n            if (e && this._isPopupTarget(e)) return;\n            // close\n            this._stopEvents();\n            this._resetToolbarToggledButton();\n            // selection\n            if (e !== false && this.saved === false) {\n                this.app.scroll.save();\n                this.app.selection.restore();\n                this.app.scroll.restore();\n            }\n            this.$popup.hide();\n            this._closed();\n        },\n        closeStacks: function() {\n            for(var key in this.stacks)if (typeof this.stacks[key] === \"object\") this.stacks[key].close();\n        },\n        // remove\n        removeStack: function(stack) {\n            var name = stack.getName();\n            // object\n            delete this.stacks[name];\n            // layer\n            this.$popup.find(\"[data-\" + this.prefix + \"-stack-name=\" + name + \"]\").remove();\n        },\n        // update\n        updatePosition: function(e) {\n            this._buildPosition(e);\n            this._buildHeight();\n        },\n        // resize\n        resize: function() {\n            var data = this.$popup.attr(\"data-width\");\n            var width = this.app.editor.getWidth();\n            if (data !== \"100%\") {\n                var w = parseInt(data);\n                if (w < width) return;\n            }\n            this.$popup.css(\"width\", width + \"px\");\n        },\n        // =private\n        // build\n        _build: function() {\n            this.$popup = this.dom(\"<div>\").addClass(this.prefix + \"-popup \" + this.prefix + \"-popup-\" + this.uuid);\n            this.$popup.hide();\n            this.$popup.attr(\"dir\", this.opts.editor.direction);\n            // append\n            this.app.$body.append(this.$popup);\n        },\n        _buildDepth: function() {\n            if (this.opts.bsmodal) this.$popup.css(\"z-index\", 1061);\n        },\n        _buildButton: function(params) {\n            if (!params) return;\n            this.button = Object.prototype.hasOwnProperty.call(params, \"button\") ? params.button : false;\n        },\n        _buildControl: function(params) {\n            if (!params) return;\n            this.control = Object.prototype.hasOwnProperty.call(params, \"control\") ? params.control : false;\n        },\n        _buildName: function() {\n            this.$popup.attr(\"data-\" + this.prefix + \"-popup-name\", this.name);\n            this.$popup.addClass(this.prefix + \"-popup-\" + this.name);\n        },\n        _buildHeader: function() {\n            this.header = this.app.create(\"popup.header\", this);\n        },\n        _buildHeight: function() {\n            var targetHeight, top;\n            var $target = this.app.scroll.getTarget();\n            var tolerance = 10;\n            var offset = this.$popup.offset();\n            if (this.app.scroll.isTarget()) {\n                top = offset.top - $target.offset().top;\n                targetHeight = $target.height() - parseInt($target.css(\"border-bottom-width\"));\n            } else {\n                top = offset.top - $target.scrollTop();\n                targetHeight = $target.height();\n            }\n            var cropHeight = targetHeight - top - tolerance;\n            this.$popup.css(\"max-height\", cropHeight + \"px\");\n        },\n        _buildPosition: function() {\n            var topFix = 1;\n            var pos;\n            // control\n            if (this._isButton() && this.button.isControl() || this._isControl()) pos = this._buildPositionControl();\n            else if (this._isButton()) pos = this._buildPositionButton();\n            else pos = this._buildPositionModal();\n            // set\n            this.$popup.css({\n                top: pos.top - topFix + \"px\",\n                left: pos.left + \"px\"\n            });\n        },\n        _buildPositionButton: function() {\n            var editorRect = this.app.editor.getRect();\n            var offset = this.button.getOffset();\n            var dim = this.button.getDimension();\n            var popupWidth = this.$popup.width();\n            var popupHeight = this.$popup.height();\n            var pos = {};\n            if (this._isToolbarButton() || this._isTopbarButton()) {\n                pos = {\n                    top: offset.top + dim.height,\n                    left: offset.left\n                };\n                // out of the right edge\n                if (pos.left + popupWidth > editorRect.right) pos.left = offset.left + dim.width - popupWidth;\n            } else {\n                pos = {\n                    top: offset.top + editorRect.top + dim.height,\n                    left: offset.left + editorRect.left + dim.width / 2 - popupWidth / 2\n                };\n                // out of the right edge\n                if (pos.left + popupWidth > editorRect.right) pos.left = editorRect.left + editorRect.width - popupWidth;\n                // out of the bottom edge\n                if (pos.top + popupHeight > this.app.$doc.height()) pos.top = pos.top - popupHeight - dim.height;\n            }\n            // out of the left edge\n            if (pos.left < editorRect.left || pos.left < 0) pos.left = editorRect.left;\n            return pos;\n        },\n        _buildPositionControl: function() {\n            var instance = this.app.block.get();\n            if (instance.isSecondLevel()) instance = instance.getFirstLevel();\n            var $block = instance.getBlock();\n            var offset = $block.offset();\n            // set\n            return {\n                top: offset.top,\n                left: offset.left\n            };\n        },\n        _buildPositionModal: function() {\n            var offset, top, left;\n            if (!this.opts.toolbar) {\n                var instance = this.app.block.get();\n                if (instance.isSecondLevel()) instance = instance.getFirstLevel();\n                var $block = instance.getBlock();\n                offset = $block.offset();\n                top = offset.top;\n                left = offset.left;\n            } else {\n                var $container = this.app.container.get(\"toolbar\");\n                var height = $container.height();\n                offset = $container.offset();\n                top = offset.top + height;\n                left = offset.left;\n            }\n            return {\n                top: top,\n                left: left\n            };\n        },\n        // get\n        _getName: function() {\n            return this.$popup.attr(\"data-\" + this.prefix + \"-popup-name\");\n        },\n        // set\n        _setToolbarToggledButton: function() {\n            this.app.toolbar.unsetToggled();\n            if (!this._isToolbarButton()) return;\n            var name = this.button.getName();\n            this.app.toolbar.setToggled(name);\n        },\n        // create\n        _createStack: function(name, params, collapse) {\n            if (Object.prototype.hasOwnProperty.call(params, \"collapse\") && params.collapse === false) collapse = false;\n            if (Object.prototype.hasOwnProperty.call(params, \"autoclose\")) this.autoclose = params.autoclose;\n            var stack = this.app.create(\"popup.stack\", name, params, collapse, this);\n            this.stacks[name] = stack;\n            return stack;\n        },\n        // open\n        _open: function(params, animation) {\n            this._buildButton(params);\n            this._buildControl(params);\n            this._buildName();\n            this._buildHeader();\n            // broadcast\n            var event = this.app.broadcast(\"popup.before.open\");\n            if (event.isStopped()) {\n                this.stopStack();\n                return;\n            }\n            // set & start\n            this._setToolbarToggledButton();\n            this._startEvents();\n            // selection (all popups are closed)\n            if (animation !== false && this.app.editor.isPopupSelection()) this.app.selection.save();\n            // find active\n            this.stack = this._findActiveStack();\n            // open stack\n            this.stack.open(params, false, false);\n            // build position\n            this._buildPosition();\n            // show\n            if (animation === false) {\n                this.$popup.show();\n                this._opened();\n            } else this.$popup.fadeIn(100, this._opened.bind(this));\n        },\n        _opened: function() {\n            this._buildHeight();\n            this.$popup.addClass(\"open\");\n            // broadcast\n            this.app.broadcast(\"popup.open\");\n            this.stack.renderFocus();\n        },\n        // closed\n        _closed: function() {\n            var attrname = \"data-\" + this.prefix + \"-popup-name\";\n            var name = this.$popup.attr(attrname);\n            this.$popup.removeAttr(attrname);\n            this.$popup.removeClass(\"open \" + this.prefix + \"-popup-\" + name);\n            this.saved = false;\n            // broadcast\n            this.app.broadcast(\"popup.close\");\n        },\n        // is\n        _isPopupTarget: function(e) {\n            return this.dom(e.target).closest(\".\" + this.prefix + \"-popup\").length !== 0;\n        },\n        _isButton: function() {\n            return this.button;\n        },\n        _isControl: function() {\n            return this.control;\n        },\n        _isToolbarButton: function() {\n            return this.button && (this.button.type === \"toolbar\" || this.button.type === \"context\");\n        },\n        _isTopbarButton: function() {\n            return this.button && this.button.type === \"topbar\";\n        },\n        // find\n        _findActiveStack: function() {\n            for(var key in this.stacks)if (typeof this.stacks[key] === \"object\" && this.stacks[key].isActive()) this.stack = this.stacks[key];\n            return this.stack;\n        },\n        // reset\n        _reset: function() {\n            this.button = false;\n            this.control = false;\n            this.autoclose = true;\n            this.stack = false;\n            this.stacks = [];\n            this.$popup.html(\"\");\n            this.$popup.removeClass(\"has-footer has-items has-form\");\n        },\n        _resetToolbarToggledButton: function() {\n            if (!this.button) return;\n            var name = this.button.getName();\n            this.app.toolbar.unsetToggled(name);\n        },\n        // start\n        _startEvents: function() {\n            var eventname = this.prefix + \"-popup\";\n            this.app.scroll.getTarget().on(\"resize.\" + eventname, this.updatePosition.bind(this));\n            this.app.scroll.getTarget().on(\"scroll.\" + eventname, this._buildPosition.bind(this));\n        },\n        // stop\n        _stopEvents: function() {\n            this.app.scroll.getTarget().off(\".\" + this.prefix + \"-popup\");\n        },\n        _stop: function() {\n            if (this.$popup) this.$popup.remove();\n        }\n    });\n    ArticleEditor.add(\"class\", \"popup.item\", {\n        defaults: {\n            container: false,\n            title: false,\n            html: false,\n            toggle: true,\n            active: false,\n            divider: false,\n            remover: false,\n            classname: false,\n            params: false,\n            instance: false,\n            observer: false,\n            command: false\n        },\n        init: function(popup, name, params) {\n            this.popup = popup;\n            this.name = name;\n            this.params = this._buildParams(params);\n            this._build();\n            this._buildContainer();\n            this._buildIcon();\n            this._buildTitle();\n            this._buildImage();\n            this._buildShortcut();\n            this._buildActive();\n            this._buildHidden();\n            this._buildDivider();\n            this._buildCommand();\n            this._buildRemover();\n        },\n        // get\n        getPopup: function() {\n            return this.popup;\n        },\n        getName: function() {\n            return this.name;\n        },\n        getParams: function() {\n            return this.params.params;\n        },\n        getElement: function() {\n            return this.$item;\n        },\n        getInstance: function() {\n            return this.params.instance;\n        },\n        // is\n        isControl: function() {\n            return this.params.control;\n        },\n        // private\n        _build: function() {\n            this.$item = this.params.html ? this.dom(this.params.html) : this.dom(\"<div>\");\n            this.$item.addClass(this.prefix + \"-popup-item \" + this.prefix + \"-popup-stack-item\");\n            this.$item.attr({\n                \"data-name\": this.name\n            });\n        },\n        _buildContainer: function() {\n            if (this.params.container) this.$item.addClass(this.prefix + \"-popup-item-container\");\n        },\n        _buildTitle: function() {\n            if (this.params.title) {\n                this.$title = this.dom(\"<span>\").addClass(this.prefix + \"-popup-item-title\");\n                this.$title.html(this.lang.parse(this.params.title));\n                this.$item.append(this.$title);\n            }\n        },\n        _buildImage: function() {\n            if (this.params.image) {\n                this.$image = this.dom(\"<span>\").addClass(this.prefix + \"-popup-item-image\");\n                this.$image.html(this.params.image);\n                this.$item.append(this.$image);\n            }\n        },\n        _buildIcon: function() {\n            if (this.params.icon) {\n                this.$icon = this.dom(\"<span>\").addClass(this.prefix + \"-popup-item-icon\");\n                // html icon\n                if (this.opts.buttons.icons && typeof this.opts.buttons.icons[this.name] !== \"undefined\") this.$icon.html(this.opts.buttons.icons[this.name]);\n                else if (this.params.icon === true) this.$icon.addClass(this.prefix + \"-icon-\" + this.name);\n                else if (this.params.icon.search(/</) !== -1) this.$icon.html(this.params.icon);\n                else this.$icon.addClass(this.prefix + \"-icon-\" + this.params.icon);\n                this.$item.append(this.$icon);\n            }\n        },\n        _buildShortcut: function() {\n            if (this.params.shortcut) {\n                var meta = /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) ? \"<b>&#8984;</b>\" : \"ctrl\";\n                meta = this.params.shortcut.replace(\"Ctrl\", meta);\n                this.$shortcut = this.dom(\"<span>\").addClass(this.prefix + \"-popup-item-shortcut\");\n                this.$shortcut.html(meta);\n                this.$item.append(this.$shortcut);\n            }\n        },\n        _buildParams: function(params) {\n            return $ARX.extend({}, true, this.defaults, params);\n        },\n        _buildActive: function() {\n            if (this.params.active) this.$item.addClass(\"active\");\n        },\n        _buildHidden: function() {\n            if (this.params.hidden) this.$item.addClass(this.prefix + \"-popup-item-hidden\");\n        },\n        _buildDivider: function() {\n            if (this.params.divider) this.$item.addClass(this.prefix + \"-popup-item-divider-\" + this.params.divider);\n        },\n        _buildCommand: function() {\n            if (this.params.command) {\n                this.$item.on(\"click.\" + this.prefix + \"-popup-item-\" + this.uuid, this._catch.bind(this));\n                this.$item.attr(\"data-command\", this.params.command);\n            }\n        },\n        _buildRemover: function() {\n            if (!this.params.title) return;\n            if (this.params.remover) {\n                var $trash = this.dom(\"<span>\").addClass(this.prefix + \"-popup-item-trash \" + this.prefix + \"-icon-trash\");\n                $trash.attr(\"data-command\", this.params.remover);\n                $trash.on(\"click.\" + this.prefix + \"-popup-item-\" + this.uuid, this._catchRemover.bind(this));\n                this.$item.append($trash);\n            }\n        },\n        _catchRemover: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var $item = this.dom(e.target).closest(\".\" + this.prefix + \"-popup-stack-item\");\n            var $trash = this.dom(e.target).closest(\".\" + this.prefix + \"-popup-item-trash\");\n            var command = $trash.attr(\"data-command\");\n            var name = $item.attr(\"data-name\");\n            this.app.api(command, this, name);\n            $item.fadeOut(200, function($node) {\n                $node.remove();\n            });\n        },\n        _catch: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var $item = this.dom(e.target).closest(\".\" + this.prefix + \"-popup-stack-item\");\n            var name = $item.attr(\"data-name\");\n            var command = $item.attr(\"data-command\");\n            this.popup.$items.find(\".\" + this.prefix + \"-popup-stack-item\").removeClass(\"active\");\n            if (this.params.toggle) $item.addClass(\"active\");\n            // command\n            this.app.api(command, this.getParams(), this, name, e);\n        }\n    });\n    ArticleEditor.add(\"class\", \"popup.stack\", {\n        defaults: {\n            active: false,\n            title: false,\n            type: false,\n            width: false,\n            setter: false,\n            getter: false,\n            builder: false,\n            observer: false,\n            instance: false,\n            collapse: false,\n            form: false,\n            items: false,\n            html: false,\n            focus: false,\n            footer: false\n        },\n        init: function(name, params, collapse, popup) {\n            this.defaultWidth = \"240px\";\n            this.popup = popup;\n            this.name = name;\n            this.tools = {};\n            this.data = false;\n            this.items = false;\n            this.formitems = false;\n            this.params = $ARX.extend({}, true, this.defaults, params);\n            if (collapse) this.params.collapse = true;\n            // build\n            this._build();\n            this._observe();\n        },\n        // set\n        set: function(name, value) {\n            this.params[name] = value;\n        },\n        setData: function(data) {\n            this.data = data;\n        },\n        setFocus: function(name) {\n            if (typeof this.tools[name] !== \"undefined\") this.tools[name].setFocus();\n        },\n        setWidth: function(width) {\n            var $popup = this.app.popup.getElement();\n            $popup.attr(\"data-width\", width);\n            if (width === \"100%\") width = this.app.editor.getWidth() + \"px\";\n            $popup.css(\"width\", width);\n            this.app.$win.on(\"resize.\" + this.prefix + \"-popup-\" + this.uuid, this.popup.resize.bind(this.popup));\n            this.popup.resize();\n        },\n        setItemsData: function(items) {\n            this.items = items;\n        },\n        // get\n        get: function(name) {\n            return this.params[name];\n        },\n        getElement: function() {\n            return this.$stack;\n        },\n        getName: function() {\n            return this.name;\n        },\n        getBody: function() {\n            return this.$body;\n        },\n        getInstance: function() {\n            return this.get(\"instance\");\n        },\n        getItemsData: function() {\n            return this.items;\n        },\n        getItems: function() {\n            return this.$items;\n        },\n        getFooter: function() {\n            return this.$footer;\n        },\n        getFooterPrimary: function() {\n            return this.$footer.find(\".\" + this.prefix + \"-form-button-primary\");\n        },\n        getTool: function(name) {\n            return typeof this.tools[name] !== \"undefined\" ? this.tools[name] : false;\n        },\n        getInput: function(name) {\n            var tool = this.getTool(name);\n            return tool ? tool.getInput() : this.dom();\n        },\n        getFormItem: function(name) {\n            var tool = this.getTool(name);\n            return tool ? tool.getInput().closest(\".\" + this.prefix + \"-form-item\") : this.dom();\n        },\n        getData: function(name) {\n            var data;\n            if (name) {\n                if (typeof this.tools[name] !== \"undefined\") data = this.tools[name].getValue();\n            } else {\n                data = {};\n                Object.keys(this.tools).forEach((function(key) {\n                    data[key] = this.tools[key].getValue();\n                }).bind(this));\n            }\n            return data;\n        },\n        // has\n        hasForm: function() {\n            return this.formitems;\n        },\n        hasFooter: function() {\n            return this.footerbuttons !== 0;\n        },\n        hasItems: function() {\n            return this.items !== false;\n        },\n        // is\n        isCollapsed: function() {\n            return this.get(\"collapse\");\n        },\n        isActive: function() {\n            return this.get(\"active\");\n        },\n        // open\n        open: function(params, focus, direct) {\n            // input focus\n            if (params && params.focus) this.set(\"focus\", params.focus);\n            // close stacks\n            this.popup.closeStacks();\n            // set\n            this.app.popup.setStack(this);\n            // broadcast\n            if (direct !== false) {\n                var event = this.app.broadcast(\"popup.before.open\");\n                if (event.isStopped()) {\n                    this.popup.stopStack();\n                    return;\n                }\n            }\n            // render\n            if (params && params.collapse) {\n                this._buildItems();\n                this._renderItems();\n            } else this.render();\n            // header\n            this.popup.header.render(this.popup.stacks);\n            this.popup.header.setActive(this);\n            // show\n            this.$stack.show();\n            this._renderWidth();\n            this.popup._buildPosition();\n            if (focus !== false) this.renderFocus();\n            // broadcast\n            if (direct !== false) this.app.broadcast(\"popup.open\");\n        },\n        // close\n        close: function() {\n            this.$stack.hide();\n        },\n        collapse: function() {\n            var prev = this._getPrev();\n            if (this.isCollapsed()) this.popup.removeStack(this);\n            // open\n            prev.open({\n                collapse: true\n            });\n        },\n        // render\n        render: function() {\n            this._renderType();\n            if (this.params.html) this._renderHtml();\n            else this._renderItems();\n            this._renderForm();\n            this._renderFooter();\n            this._renderEnv();\n        },\n        renderFocus: function() {\n            if (this.get(\"focus\")) this.setFocus(this.get(\"focus\"));\n        },\n        // =private\n        // observe\n        _observe: function() {\n            if (this.params.observer) this.app.api(this.params.observer, this);\n        },\n        // get\n        _getPrev: function() {\n            var prev;\n            for(var key in this.popup.stacks)if (this.popup.stacks.hasOwnProperty(key)) {\n                if (key === this.name) return prev;\n                prev = this.popup.stacks[key];\n            }\n        },\n        // build\n        _build: function() {\n            this._buildElement();\n            this._buildBody();\n            this._buildFooter();\n            this._buildParams();\n        },\n        _buildElement: function() {\n            this.$stack = this.dom(\"<div>\").addClass(this.prefix + \"-popup-stack \" + this.prefix + \"-popup-stack-\" + this.name);\n            this.$stack.hide();\n            this.$stack.attr(\"data-\" + this.prefix + \"-stack-name\", this.name);\n            // append\n            this.popup.getElement().append(this.$stack);\n        },\n        _buildBody: function() {\n            this.$body = this.dom(\"<div>\").addClass(this.prefix + \"-popup-body\");\n            this.$stack.append(this.$body);\n        },\n        _buildFooter: function() {\n            this.$footer = this.dom(\"<div>\").addClass(this.prefix + \"-popup-footer\");\n            this.$stack.append(this.$footer);\n        },\n        _buildParams: function() {\n            this.params.width = this.params.width ? this.params.width : this.defaultWidth;\n            this.params.setter = this.params.setter ? this.params.setter : false;\n            this.params.getter = this.params.getter ? this.params.getter : false;\n            this.data = this.params.getter ? this.app.api(this.params.getter, this) : false;\n            this._buildItems();\n        },\n        _buildItems: function() {\n            // items\n            if (this.params.builder) this.items = this.app.api(this.params.builder, this);\n            else if (this.params.items) this.items = this.params.items;\n        },\n        // render\n        _renderWidth: function() {\n            this.setWidth(this.get(\"width\"));\n        },\n        _renderType: function() {\n            this.$stack.removeClass(this.prefix + \"-popup-type-grid\");\n            var type = this.get(\"type\");\n            if (type) this.$stack.addClass(this.prefix + \"-popup-type-\" + type);\n        },\n        _renderHtml: function() {\n            if (this.$items) this.$items.html(\"\");\n            else {\n                this.$items = this.dom(\"<div>\").addClass(this.prefix + \"-popup-html\");\n                this.$body.append(this.$items);\n            }\n            this.$items.append(this.params.html);\n        },\n        _renderItems: function() {\n            if (!this.items) return;\n            if (this.$items) this.$items.html(\"\");\n            else {\n                this.$items = this.dom(\"<div>\").addClass(this.prefix + \"-popup-items\");\n                this.$body.append(this.$items);\n            }\n            // build items\n            for(var name in this.items)if (this.items.hasOwnProperty(name)) {\n                if (Object.prototype.hasOwnProperty.call(this.items[name], \"observer\") && this.items[name].observer) {\n                    var res = this.app.api(this.items[name].observer, this.items[name], name, this);\n                    if (typeof res !== \"undefined\") this.items[name] = res;\n                }\n                if (this.items[name] === false) continue;\n                var item = this.app.create(\"popup.item\", this, name, this.items[name]);\n                var $item = item.getElement();\n                this._renderItemPosition(this.$items, $item, this.items[name]);\n            }\n        },\n        _renderItemPosition: function($container, $item, params) {\n            if (params.position) {\n                var pos = params.position;\n                if (pos === \"first\") $container.prepend($item);\n                else if (typeof pos === \"object\") {\n                    var type = Object.prototype.hasOwnProperty.call(pos, \"after\") ? \"after\" : \"before\";\n                    var name = pos[type];\n                    var $el = this._findPositionElement(name, $container);\n                    if ($el) $el[type]($item);\n                    else $container.append($item);\n                }\n            } else $container.append($item);\n        },\n        _renderEnv: function() {\n            var $popup = this.popup.getElement();\n            $popup.removeClass(\"has-footer has-items has-form\");\n            if (this.hasForm()) $popup.addClass(\"has-form\");\n            if (this.hasFooter()) $popup.addClass(\"has-footer\");\n            if (this.hasItems()) $popup.addClass(\"has-items\");\n        },\n        _renderForm: function() {\n            this.formitems = this.get(\"form\");\n            if (!this.formitems) return;\n            // build form element\n            if (this.$form) this.$form.html(\"\");\n            else {\n                this.$form = this.dom(\"<form>\").addClass(this.prefix + \"-popup-form\");\n                this.$body.append(this.$form);\n            }\n            this._renderTools();\n            this._renderData();\n            // enter events\n            this.$form.find(\"input[type=text],input[type=url],input[type=email]\").on(\"keydown.\" + this.prefix + \"-popup\", (function(e) {\n                if (e.which === 13) {\n                    e.preventDefault();\n                    return false;\n                }\n            }).bind(this));\n        },\n        _renderTools: function() {\n            Object.keys(this.formitems).forEach((function(key) {\n                this._renderTool(key, this.formitems[key]);\n            }).bind(this));\n        },\n        _renderTool: function(name, obj) {\n            var tool = this.app.create(\"tool.\" + obj.type, name, obj, this, this.data);\n            var $tool = tool.getElement();\n            if ($tool) {\n                this.tools[name] = tool;\n                this.$form.append($tool);\n            }\n        },\n        _renderData: function() {\n            if (!this.data) return;\n            for(var name in this.data)if (typeof this.tools[name] !== \"undefined\") this.tools[name].setValue(this.data[name]);\n        },\n        _renderFooter: function() {\n            this.footerbuttons = 0;\n            var buttons = this.get(\"footer\");\n            if (!buttons) return;\n            this.$footer.html(\"\");\n            // buttons\n            for(var key in buttons)if (buttons.hasOwnProperty(key)) {\n                if (buttons[key] === false) continue;\n                var button = this.app.create(\"popup.button\", key, this, buttons[key]);\n                this.$footer.append(button.getElement());\n                this.footerbuttons++;\n            }\n        },\n        // find\n        _findPositionElement: function(name, $container) {\n            var $el;\n            if (Array.isArray(name)) for(var i = 0; i < name.length; i++){\n                $el = $container.find(\"[data-name=\" + name[i] + \"]\");\n                if ($el.length !== 0) break;\n            }\n            else $el = $container.find(\"[data-name=\" + name + \"]\");\n            return $el.length !== 0 ? $el : 0;\n        }\n    });\n    ArticleEditor.add(\"class\", \"popup.header\", {\n        init: function(popup) {\n            this.popup = popup;\n            // build\n            this._build();\n        },\n        setActive: function(stack) {\n            this.$headerbox.find(\".\" + this.prefix + \"-popup-header-item\").removeClass(\"active\");\n            this.$headerbox.find(\"[data-\" + this.prefix + \"-name=\" + stack.getName() + \"]\").addClass(\"active\");\n        },\n        render: function(stacks) {\n            this._reset();\n            var len = this._buildItems(stacks);\n            if (len > 0) this._buildClose();\n        },\n        // private\n        _build: function() {\n            this.$header = this.dom(\"<div>\").addClass(this.prefix + \"-popup-header\");\n            this.$headerbox = this.dom(\"<div>\").addClass(this.prefix + \"-popup-header-box\");\n            this.$header.append(this.$headerbox);\n            this.popup.getElement().prepend(this.$header);\n        },\n        _buildClose: function() {\n            var $close = this.dom(\"<span>\").addClass(this.prefix + \"-popup-close\");\n            $close.one(\"click\", this._catchClose.bind(this));\n            this.$header.append($close);\n        },\n        _buildItems: function(stacks) {\n            var len = Object.keys(stacks).length;\n            var count = 0;\n            var z = 0;\n            for(var key in stacks)if (stacks.hasOwnProperty(key)) {\n                if (typeof stacks[key] !== \"object\") continue;\n                z++;\n                var title = stacks[key].get(\"title\");\n                if (title) {\n                    count++;\n                    this._buildItem(stacks[key], title, len);\n                } else if (z === 1 && len > 1) {\n                    count++;\n                    this._buildItem(stacks[key], \"## popup.back ##\", len);\n                }\n            }\n            return count;\n        },\n        _buildItem: function(stack, title, len) {\n            var isLink = len > 1;\n            var $item = isLink ? this.dom(\"<a>\").attr(\"href\", \"#\") : this.dom(\"<span>\");\n            if (isLink) {\n                $item.dataset(\"stack\", stack);\n                $item.addClass(this.prefix + \"-popup-header-item-link\");\n                $item.on(\"click\", this._catchStack.bind(this));\n            }\n            $item.attr(\"data-\" + this.prefix + \"-name\", stack.getName());\n            $item.addClass(this.prefix + \"-popup-header-item\");\n            $item.html(this.lang.parse(title));\n            this.$headerbox.append($item);\n        },\n        _reset: function() {\n            this.$headerbox.html(\"\");\n            this.$header.find(\".\" + this.prefix + \"-popup-close\").remove();\n        },\n        _catchStack: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var $item = this.dom(e.target);\n            var stack = $item.dataget(\"stack\");\n            var current = this.app.popup.getStack();\n            // remove collapsable\n            if (current.isCollapsed()) this.app.popup.removeStack(current);\n            // open\n            stack.open();\n        },\n        _catchClose: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.popup.close();\n        }\n    });\n    ArticleEditor.add(\"class\", \"popup.button\", {\n        init: function(name, popup, obj) {\n            this.name = name;\n            this.obj = obj;\n            this.popup = popup;\n            this.$button = this.dom(\"<button>\").addClass(this.prefix + \"-form-button\");\n            this.$button.attr(\"data-name\", this.name);\n            this.$button.html(this.lang.parse(this.obj.title));\n            this.$button.dataset(\"instance\", this);\n            if (this._has(\"type\")) this.$button.addClass(this.prefix + \"-form-button-\" + this.obj.type);\n            if (this._has(\"classname\")) this.$button.addClass(this.obj.classname);\n            if (this._has(\"fullwidth\")) this.$button.addClass(this.prefix + \"-form-button-fullwidth\");\n            if (this._has(\"right\")) this.$button.addClass(this.prefix + \"-form-button-push-right\");\n            // event\n            this.$button.on(\"click.\" + this.prefix + \"-popup-button\" + this.uuid, this._catch.bind(this));\n        },\n        getName: function() {\n            return this.name;\n        },\n        getElement: function() {\n            return this.$button;\n        },\n        invokeCommand: function() {\n            this._invoke();\n        },\n        // private\n        _has: function(name) {\n            return Object.prototype.hasOwnProperty.call(this.obj, name);\n        },\n        _catch: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (this._has(\"command\")) this._invoke(e);\n            else if (this._has(\"close\")) this.app.popup.close();\n        },\n        _invoke: function(e) {\n            this.app.api(this.obj.command, this.popup, this.name, e);\n        }\n    });\n    ArticleEditor.add(\"module\", \"editor\", {\n        init: function() {\n            this.mobileMode = false;\n            this.customButtons = {};\n        },\n        start: function() {\n            this._buildFrame();\n            this._buildDisabled();\n            this._buildBlurClass();\n            this._buildOptions();\n            this._buildMultiple();\n            this._buildParserTags();\n            this._buildStartHtml();\n            this._buildLayout();\n            this._buildContent();\n        },\n        stop: function() {\n            this.$editor = false;\n            this.customButtons = {};\n            this.app.$element.show();\n        },\n        build: function() {\n            this.app.embed.build();\n            this.app.blocks.build();\n            this.app.image.observeStates();\n            this.app.parser.buildPredefinedClasses();\n            // broadcast\n            this.app.broadcast(\"editor.build\");\n        },\n        // insert\n        insertContent: function(params) {\n            this.app.insertion.insertContent(params);\n        },\n        // set\n        setContent: function(params) {\n            this.app.insertion.setContent(params);\n        },\n        setEmpty: function() {\n            this.app.insertion.setContent({\n                html: \"\"\n            });\n        },\n        setWinFocus: function() {\n            this.getWin().focus();\n        },\n        setFocus: function(caret) {\n            if (this.opts.disableMode) return;\n            if (caret) this._setFocusCaret(caret);\n            else this._setFocusEvent();\n        },\n        setBlur: function() {\n            if (this.opts.disableMode || !this.isFocus()) return;\n            if (!this.$editor.get) return;\n            this.app.container.setBlur();\n            if (!this.app.source.is()) {\n                this._enableToolbarButtons();\n                this.app.block.unset();\n                this.app.blocks.unset();\n            }\n            this.app.selection.removeAllRanges();\n            // ui\n            if (!this.app.source.is() && !this.isMobileView()) {\n                this.app.path.build();\n                this.app.toolbar.build();\n                this.app.control.close();\n            }\n            this.app.popup.close(false);\n            // broadcast\n            this.app.broadcast(\"editor.blur\");\n        },\n        // select\n        selectAll: function(type) {\n            if (this.isAllSelected()) return;\n            this._setSelectAllClass();\n            this.app.blocks.unset();\n            this.app.blocks.setFirstLevel();\n            this.app.selection.removeAllRanges();\n            // ui\n            this.app.path.build();\n            this.app.toolbar.build();\n            this.app.control.close();\n        },\n        // unselect\n        unselectAll: function() {\n            if (!this.isAllSelected()) return;\n            this.unsetSelectAllClass();\n            this.app.block.unset();\n            this.app.blocks.unset();\n        },\n        // unset\n        unsetSelectAllClass: function() {\n            this.$editor.removeClass(this.prefix + \"-select-all\");\n        },\n        // add\n        addButton: function(name, obj) {\n            this.customButtons[name] = obj;\n        },\n        // get\n        getButtons: function() {\n            var buttons = this.getButtonsFromArr(this.opts.buttons.editor);\n            var res = {};\n            for(var name in buttons)if (buttons.hasOwnProperty(name)) {\n                if (name === \"html\" && !this.opts.source) continue;\n                if (name === \"templates\" && !this.opts.templates.json) continue;\n                res[name] = buttons[name];\n            }\n            // custom buttons\n            res = $ARX.extend(true, {}, res, this.customButtons);\n            return res;\n        },\n        getContent: function(tidy) {\n            var html = \"\";\n            if (this.app.source.is()) html = this.app.source.getContent();\n            else {\n                html = this._getContent();\n                html = tidy ? this.app.tidy.parse(html) : html;\n            }\n            // decode href\n            html = this.app.content.decodeHref(html);\n            return html;\n        },\n        getWidth: function() {\n            var $editor = this.getEditor();\n            var padLeft = parseInt($editor.css(\"padding-left\"));\n            var padRight = parseInt($editor.css(\"padding-right\"));\n            return $editor.width() - padLeft - padRight;\n        },\n        getRect: function() {\n            return this.getFrameRect();\n        },\n        getFrameRect: function() {\n            var offset = this.$editor.offset();\n            var width = this.$editor.width();\n            var height = this.$editor.height();\n            var top = Math.round(offset.top);\n            var left = Math.round(offset.left);\n            return {\n                top: top,\n                left: left,\n                bottom: top + height,\n                right: left + width,\n                width: width,\n                height: height\n            };\n        },\n        getSelection: function() {\n            var sel = this.getWinNode().getSelection();\n            return sel.rangeCount > 0 ? sel : false;\n        },\n        getEditor: function() {\n            return this.getFrame();\n        },\n        getFrame: function() {\n            return this.$editor ? this.$editor : this.dom();\n        },\n        getLayout: function() {\n            return this.$layout;\n        },\n        getOverlay: function() {\n            return this.$overlay;\n        },\n        getHead: function() {\n            return this.getDoc().find(\"head\");\n        },\n        getBody: function() {\n            return this.$editor ? this.getDoc().find(\"body\") : this.dom();\n        },\n        getDoc: function() {\n            return this.dom(this.getDocNode());\n        },\n        getDocNode: function() {\n            return this.$editor === false ? null : this.$editor.get().contentWindow.document;\n        },\n        getWin: function() {\n            return this.dom(this.getWinNode());\n        },\n        getWinNode: function() {\n            return this.$editor.get().contentWindow;\n        },\n        getButtonsFromArr: function(arr) {\n            var buttons = {};\n            if (!Array.isArray(arr) && typeof arr === \"object\") return arr;\n            else if (arr) {\n                var obj = $ARX.extend(true, {}, this.opts.buttonsObj);\n                for(var i = 0; i < arr.length; i++){\n                    var name = arr[i];\n                    if (typeof obj[name] !== \"undefined\") buttons[name] = obj[name];\n                }\n            }\n            return buttons;\n        },\n        // adjust\n        adjustHeight: function() {\n            if (!this.$editor || this.app.isStopped()) return;\n            setTimeout((function() {\n                this.$editor.height(this.getBody().height());\n            }).bind(this), 1);\n        },\n        // toggle\n        toggleView: function(button) {\n            if (this.mobileMode) {\n                this.$editor.css(\"width\", \"\");\n                this.enableUI();\n                this.app.toolbar.unsetToggled(\"mobile\");\n                this.app.event.run();\n                this.app.blocks.runEditableBlocks();\n                this.app.observer.build();\n                this.mobileMode = false;\n            } else {\n                this.$editor.css(\"width\", this.opts.editor.mobile + \"px\");\n                this.disableUI();\n                this.app.toolbar.setToggled(\"mobile\");\n                this.app.popup.close();\n                this.app.control.close();\n                this.app.event.pause();\n                this.app.blocks.pauseEditableBlocks();\n                this.app.observer.stop();\n                this.mobileMode = true;\n            }\n            this.adjustHeight();\n        },\n        // ui\n        observeUI: function() {\n            this.app.toolbar.observe();\n        },\n        enableUI: function() {\n            this.app.path.enable();\n            this.app.topbar.enable();\n            this.app.toolbar.enable();\n            this.app.toolbar.enableSticky();\n        },\n        disableUI: function() {\n            this.app.path.disable();\n            this.app.topbar.disable();\n            this.app.toolbar.disable();\n            this.app.toolbar.disableSticky();\n        },\n        // is\n        isEditor: function(el) {\n            return this.isLayout(el);\n        },\n        isLayout: function(el) {\n            return this.dom(el).get() === this.$layout.get();\n        },\n        isTextarea: function() {\n            return this.opts.content === false;\n        },\n        isAllSelected: function() {\n            return this.$editor.hasClass(this.prefix + \"-select-all\");\n        },\n        isFocus: function() {\n            return this.app.container.isFocus();\n        },\n        isEmpty: function(emptyparagraph) {\n            var blocks = this.app.blocks.getFirstLevel();\n            if (blocks.length > 1) return false;\n            else return this.app.content.isEmptyHtml(this.$layout.html(), emptyparagraph);\n        },\n        isMobileView: function() {\n            return this.mobileMode;\n        },\n        isPopupSelection: function() {\n            return true;\n        },\n        isBlocksSelection: function() {\n            return false;\n        },\n        // build\n        _buildFrame: function() {\n            this.app.$element.hide();\n            this.$editor = this.dom(\"<iframe>\").addClass(this.prefix + \"-editor-frame\");\n            // append\n            this.app.container.get(\"editor\").append(this.$editor);\n            // overlay\n            this.$overlay = this.dom(\"<div>\").addClass(this.prefix + \"-editor-overlay\");\n            this.app.container.get(\"editor\").append(this.$overlay);\n        },\n        _buildDisabled: function() {\n            this.opts.disableMode = this.opts.editor.disabled || this.app.$element.attr(\"disabled\") !== null;\n        },\n        _buildBlurClass: function() {\n            this.app.container.get(\"main\").addClass(this.prefix + \"-in-blur\");\n        },\n        _buildMultiple: function() {\n            if (this.opts.selection.multiple === false) this.app.shortcut.remove(\"meta+click\");\n        },\n        _buildOptions: function() {\n            var $e = this.$editor;\n            var o = this.opts.editor;\n            // 2.3.0 legacy\n            var p = this.opts.paste;\n            if (Object.prototype.hasOwnProperty.call(p, \"autolink\")) p.autoparse = p.autolink;\n            $e.attr(\"dir\", o.direction);\n            $e.attr(\"scrolling\", \"no\");\n            $e.css(\"visibility\", \"hidden\");\n            if (o.minHeight) $e.css(\"min-height\", o.minHeight);\n            if (o.maxHeight) {\n                $e.css(\"max-height\", o.maxHeight);\n                $e.attr(\"scrolling\", \"yes\");\n            }\n            if (o.notranslate) $e.addClass(\"notranslate\");\n            if (!o.spellcheck) $e.attr(\"spellcheck\", false);\n        },\n        _buildStartHtml: function() {\n            var doctype = this._createDoctype();\n            var scripts = this._createScripts();\n            var layout = '<div class=\"' + this.opts.editor.classname + '\"></div>';\n            var code = doctype + \"<html><head></head><body>\" + layout + scripts + \"</body></html>\";\n            // write code\n            this._writeCode(code);\n        },\n        _buildLayout: function() {\n            var $body = this.getBody();\n            var classes = this.opts.editor.classname.split(\" \").join(\".\");\n            this.$layout = $body.find(\".\" + classes).first();\n            this.$layout.attr(\"dir\", this.opts.editor.direction);\n            if (this.opts.editor.padding === false) this.$layout.css(\"padding\", 0);\n            // body height\n            $body.css(\"height\", \"auto\");\n        },\n        _buildContent: function() {\n            var content = this._getContentValue();\n            content = this.app.broadcastHtml(\"editor.before.load\", content);\n            // set parsed\n            var $parsed = this.app.parser.parse(content, true, true);\n            this.$layout.html($parsed.get().childNodes);\n            // set unparsed\n            var unparsed = this.app.parser.unparse(this.$layout.html());\n            this.app.$element.val(unparsed);\n            // load\n            this._load();\n        },\n        _buildVisibility: function() {\n            this.$editor.css(\"visibility\", \"visible\");\n        },\n        _buildEditorCss: function() {\n            if (!this.opts.css) return;\n            var css;\n            if (Array.isArray(this.opts.css)) css = this.opts.css;\n            else css = [\n                this.opts.css + \"arx-frame.min.css\",\n                this.opts.css + \"arx-content.min.css\"\n            ];\n            for(var i = 0; i < css.length; i++)this._buildCssLink(css[i]);\n        },\n        _buildCustomCss: function() {\n            if (!this.opts.custom.css) return;\n            for(var i = 0; i < this.opts.custom.css.length; i++)this._buildCssLink(this.opts.custom.css[i]);\n        },\n        _buildCssLink: function(href) {\n            var obj = typeof href === \"object\" ? href : {\n                href: href\n            };\n            var isMark = typeof href === \"string\" ? href.search(/\\?/g) : href.href.search(/\\?/g);\n            var mark = isMark === -1 ? \"?\" : \"&\";\n            var tstamp = this.opts.editor.csscache ? \"\" : mark + new Date().getTime();\n            obj.href = obj.href + tstamp;\n            // link tag\n            var $css = this.dom(\"<link>\").attr({\n                \"class\": this.prefix + \"-css\",\n                \"rel\": \"stylesheet\"\n            });\n            $css.attr(obj);\n            // append\n            this.getHead().append($css);\n        },\n        _buildGridCssVar: function() {\n            if (!this.opts.grid) return;\n            var style = this.getDocNode().documentElement.style;\n            style.setProperty(\"--\" + this.prefix + \"-grid-columns\", this.opts.grid.columns);\n            style.setProperty(\"--\" + this.prefix + \"-grid-gutter\", this.opts.grid.gutter);\n            style.setProperty(\"--\" + this.prefix + \"-grid-offset-left\", this.opts.grid.offset.left);\n            style.setProperty(\"--\" + this.prefix + \"-grid-offset-right\", this.opts.grid.offset.right);\n            // patterns opts\n            if (this.app.initialSettings.grid && this.app.initialSettings.grid.patterns) this.opts.grid.patterns = this.app.initialSettings.grid.patterns;\n        },\n        _buildParserTags: function() {\n            var parser = this.opts.parser;\n            for(var key in parser)// add tag\n            if (parser[key].parse && parser[key].tag) {\n                var tag = parser[key].tag;\n                if (typeof this.opts.parserTags[tag] === \"undefined\") this.opts.parserTags[tag] = [];\n                this.opts.parserTags[tag].push(parser[key].parse);\n            }\n        },\n        _buildDraggable: function() {\n            var $items = this.app.$body.find(\"[data-\" + this.prefix + \"-drop-id]\");\n            $items.each((function($node) {\n                $node.attr(\"draggable\", true);\n                $node.on(\"dragstart\", (function(e) {\n                    var $target = this.dom(e.target);\n                    var id = $target.attr(\"data-\" + this.prefix + \"-drop-id\");\n                    e.dataTransfer.setData(\"item\", id);\n                }).bind(this));\n            }).bind(this));\n        },\n        // load\n        _load: function() {\n            try {\n                this._loadImages();\n                this._loaded();\n            } catch (e) {\n                $ARX.error(e);\n            }\n        },\n        _loaded: function() {\n            this.app.sync.build();\n            this.app.event.build();\n            this.app.embed.build();\n            this.app.blocks.build();\n            this.app.image.observeStates();\n            this._buildVisibility();\n            this._buildEditorCss();\n            this._buildCustomCss();\n            this._buildGridCssVar();\n            this._buildDraggable();\n            // adjust on resize\n            this.getWin().on(\"resize.\" + this.prefix + \"-editor-frame\", this.adjustHeight.bind(this));\n            // broadcast\n            this.app.broadcast(\"editor.load\");\n            // adjust height & build observer\n            this.adjustHeight();\n            setTimeout((function() {\n                if (this.app.isStopped()) return;\n                this.adjustHeight();\n                this._setFocusOnStart();\n                this.app.observer.build();\n                this.app.broadcast(\"editor.ready\");\n            }).bind(this), 500);\n            setTimeout(this.adjustHeight.bind(this), 3000);\n        },\n        _loadedImage: function() {\n            this.imageslen--;\n        },\n        _loadImages: function() {\n            var $doc = this.getDoc();\n            var $images = $doc.find(\"img\");\n            this.imageslen = $images.length;\n            $images.each(this._loadImage.bind(this));\n            var timerImg = setInterval((function() {\n                if (this.imageslen === 0) {\n                    this.adjustHeight();\n                    clearInterval(timerImg);\n                    return;\n                }\n            }).bind(this), 50);\n        },\n        _loadImage: function($img) {\n            var img = $img.get();\n            if (this.opts.editor.images) {\n                var arr = img.src.split(\"/\");\n                var last = arr[arr.length - 1];\n                img.src = this.opts.editor.images + last;\n            }\n            $img.one(\"load\", this._loadedImage.bind(this));\n        },\n        // set\n        _setFocusOnStart: function() {\n            if (!this.opts.editor.focus) return;\n            this.setFocus();\n            this.setFocus(this.opts.editor.focus);\n        },\n        _setSelectAllClass: function() {\n            this.$editor.addClass(this.prefix + \"-select-all\");\n        },\n        _setFocusCaret: function(caret) {\n            caret = this._getCaretPosition(caret);\n            var target = this._getFocusTarget(caret);\n            this.app.block.set(target, caret);\n        },\n        _setFocusEvent: function() {\n            if (this.isFocus()) return;\n            for(var i = 0; i < $ARX.instances.length; i++)if ($ARX.instances[i] !== this.app) $ARX.instances[i].editor.setBlur();\n            this.app.container.setFocus();\n            // broadcast\n            this.app.broadcast(\"editor.focus\");\n        },\n        // get\n        _getCaretPosition: function(caret) {\n            return caret === true ? \"start\" : caret;\n        },\n        _getFocusTarget: function(caret) {\n            return caret === \"start\" ? this.app.blocks.getFirst() : this.app.blocks.getLast();\n        },\n        _getContent: function() {\n            var html = this.$layout.html();\n            html = this.app.parser.unparse(html);\n            return html;\n        },\n        _getContentValue: function() {\n            return this.opts.content ? this.opts.content : this.app.$element.val();\n        },\n        // enable\n        _enableToolbarButtons: function() {\n            if (this.app.source.is() || this.isMobileView()) return;\n            this.app.toolbar.enable();\n        },\n        // write\n        _writeCode: function(html) {\n            var doc = this.getDocNode();\n            doc.open();\n            doc.write(html);\n            doc.close();\n        },\n        // create\n        _createDoctype: function() {\n            return this.opts.editor.doctype + \"\\n\";\n        },\n        _createScripts: function() {\n            if (!this.opts.custom.js) return \"\";\n            var str = \"\";\n            var scripts = this.opts.custom.js;\n            for(var i = 0; i < scripts.length; i++){\n                var obj = typeof scripts[i] === \"object\" ? scripts[i] : {\n                    src: scripts[i]\n                };\n                obj.src = obj.src + \"?\" + new Date().getTime();\n                // script tag\n                var $el = this.dom(\"<script>\").addClass(this.prefix + \"-js\").attr(obj);\n                // all scripts str\n                str = str + $el.get().outerHTML;\n            }\n            return str;\n        }\n    });\n    ArticleEditor.add(\"module\", \"observer\", {\n        init: function() {\n            this.observer = false;\n            this.trigger = true;\n        },\n        build: function() {\n            if (window.MutationObserver) {\n                var el = this.app.editor.getLayout().get();\n                this.observer = this._build(el);\n                this.observer.observe(el, {\n                    attributes: true,\n                    subtree: true,\n                    childList: true,\n                    characterData: true,\n                    characterDataOldValue: true\n                });\n            }\n        },\n        stop: function() {\n            if (this.observer) this.observer.disconnect();\n            this.trigger = true;\n        },\n        // private\n        _build: function(el) {\n            var self = this;\n            return new MutationObserver(function(mutations) {\n                self._observe(mutations[mutations.length - 1], el);\n            });\n        },\n        _observe: function(mutation, el) {\n            if (mutation.type === \"attributes\" && mutation.target === el) return;\n            // sync\n            if (this.trigger) {\n                this.app.editor.adjustHeight();\n                this.app.broadcast(\"observer.change\");\n                this.app.placeholder.toggle();\n                this.app.sync.trigger();\n            }\n        }\n    });\n    ArticleEditor.add(\"module\", \"parser\", {\n        build: function(html) {\n            this.$layout = this.dom(\"<div>\");\n            this.$layout.html(html);\n            this.$layout.find(\"[data-\" + this.prefix + \"-type]\").each(this._build.bind(this));\n            return this.$layout;\n        },\n        buildElement: function($el) {\n            $el.find(\"[data-\" + this.prefix + \"-type]\").each(this._build.bind(this));\n        },\n        buildPredefinedClasses: function($el) {\n            if (!this.opts.classes) return;\n            $el = $el || this.app.editor.getLayout();\n            var content = this.app.content;\n            var findTags = true;\n            var findBlocks = false;\n            if (typeof this.opts.classes.blocks !== \"undefined\") {\n                findBlocks = true;\n                if (typeof this.opts.classes.tags === \"undefined\") findTags = false;\n            }\n            if (findTags) $el.find(content.getPredefinedTags().join(\",\")).each(content.addPredefinedTagClass.bind(this));\n            if (findBlocks) {\n                var types = content.getPredefinedBlocks();\n                var datatype = \"data-\" + this.prefix + \"-type\";\n                var selector = \"[\" + datatype + \"=\" + types.join(\"],[\" + datatype + \"=\") + \"]\";\n                $el.find(selector).each(content.addPredefinedBlockClass.bind(this));\n            }\n        },\n        // parse\n        parse: function(html, build, start) {\n            // parse\n            html = html.trim();\n            html = this.app.broadcastHtml(\"editor.before.parse\", html);\n            // check empty\n            if (this.app.content.isEmptyHtml(html)) html = this.app.block.createHtml();\n            else {\n                html = this._clean(html, start);\n                html = this._parse(html);\n            }\n            // broadcast\n            html = this.app.broadcastHtml(\"editor.parse\", html);\n            // build\n            return build !== false ? this.build(html) : html;\n        },\n        parseLine: function(html, build) {\n            if (html === \" \") html = \"&nbsp;\";\n            else {\n                // broadcast\n                html = this.app.broadcastHtml(\"editor.before.parse\", html);\n                // convert newlines to br\n                html = html.replace(/\\r?\\n/g, \"<br>\");\n                html = this.app.content.encodeCode(html);\n                html = this.app.content.sanitize(html);\n                html = this.app.content.removeEmptySpans(html);\n                html = this.app.content.addHttps(html);\n                // broadcast\n                html = this.app.broadcastHtml(\"editor.parse\", html);\n            }\n            // build\n            return build !== false ? this.build(html) : html;\n        },\n        // unparse\n        unparse: function(html, state) {\n            var stored = {};\n            var storedIndex = 0;\n            html = html.trim();\n            html = this.app.broadcastHtml(\"editor.before.unparse\", html);\n            // empty\n            if (this.app.content.isEmptyHtml(html)) return \"\";\n            // revert\n            html = this._revertForms(html);\n            html = this._revertFrames(html);\n            // store\n            html = this.app.content.store(html, \"noneditable\", stored, storedIndex);\n            html = this.app.content.store(html, \"embed\", stored, storedIndex);\n            // link nofollow\n            html = this.app.content.addNofollow(html);\n            // remove selection markers\n            html = this.app.content.removeMarkers(html);\n            html = this.app.utils.removeInvisibleChars(html);\n            // restore data style cache\n            html = this.app.content.recacheStyle(html);\n            // restore\n            html = this.app.content.restore(html, \"noneditable\", stored);\n            html = this.app.content.restore(html, \"embed\", stored);\n            // remove empty attrs\n            html = this.app.content.removeEmptyAttrs(html, [\n                \"style\",\n                \"class\",\n                \"rel\",\n                \"alt\",\n                \"title\"\n            ]);\n            // unparse\n            html = this._unparseAllTags(html);\n            html = this._unparseDataType(html, state);\n            // remove empty attrs again\n            html = this.app.content.removeEmptyAttrs(html, [\n                \"style\",\n                \"class\",\n                \"rel\",\n                \"alt\",\n                \"title\"\n            ]);\n            // replace quot\n            html = html.replace(/&quot;(.*?)&quot;/gi, \"'$1'\");\n            html = this.app.utils.replaceRgbToHex(html);\n            // add predefined classes\n            if (this.opts.classes) html = this.app.utils.wrap(html, this.buildPredefinedClasses.bind(this));\n            if (html === \"<p></p>\") html = \"\";\n            // tidy\n            //html = this.app.content.tidy.html(html);\n            // broadcast\n            return this.app.broadcastHtml(\"editor.unparse\", html);\n        },\n        // private\n        _build: function($node) {\n            var type = $node.attr(\"data-\" + this.prefix + \"-type\");\n            this.app.create(\"block.\" + type, $node);\n        },\n        _clean: function(html, start) {\n            var stored = {};\n            var storedIndex = 0;\n            var storedComments = [];\n            // store comments\n            html = this.app.content.storeComments(html, storedComments);\n            // fix &curren; entity in the links\n            html = html.replace(/t/gi, \"&current\");\n            // encode\n            if (start && this.app.editor.isTextarea()) html = this.app.content.encodeCode(html);\n            // sanitize\n            html = this.app.content.sanitize(html);\n            // convert\n            html = this._convertFrames(html);\n            html = this._convertForms(html);\n            // store\n            html = this.app.content.store(html, \"noneditable\", stored, storedIndex);\n            html = this.app.content.store(html, \"embed\", stored, storedIndex);\n            // remove denied tags\n            html = this.app.content.removeTags(html, this.opts.tags.denied);\n            // remove doctype tag\n            html = this.app.content.removeDoctype(html);\n            // remove style & script tag\n            html = this.app.content.removeTagsWithContent(html, [\n                \"script\",\n                \"style\"\n            ]);\n            // remove empty spans\n            html = this.app.content.removeEmptySpans(html);\n            // add https for links and images\n            html = this.app.content.addHttps(html);\n            // remove block tags in\n            html = this.app.content.removeBlockTagsInside(html, [\n                \"th\",\n                \"td\",\n                \"li\",\n                \"dt\",\n                \"dd\",\n                \"address\"\n            ]);\n            // cache styles for block and inline tags and img\n            html = this.app.content.cacheStyle(html);\n            // restore\n            html = this.app.content.restore(html, \"noneditable\", stored);\n            html = this.app.content.restore(html, \"embed\", stored);\n            // restore comments\n            html = this.app.content.restoreComments(html, storedComments);\n            // remove comments\n            if (this.opts.clean.comments) html = this.app.content.removeComments(html);\n            // empty or paragraphize\n            if (this.app.content.isEmptyHtml(html)) html = this.app.block.createHtml();\n            else html = this.app.content.paragraphize(html);\n            return html;\n        },\n        _parse: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                var nodes = this.app.element.getBlocks($w);\n                for(var i = 0; i < nodes.length; i++)this._parseHtml(nodes[i]);\n                // predefined classes\n                this.buildPredefinedClasses($w);\n            }).bind(this));\n        },\n        _parseHtml: function(el) {\n            var tag = el.tagName.toLowerCase();\n            var $el = this.dom(el);\n            var type;\n            // check custom\n            var parser = this.opts.parserTags;\n            if (parser[tag]) for(var i = 0; i < parser[tag].length; i++){\n                type = parser[tag][i].call(this.app, $el);\n                if (type) break;\n            }\n            if (!type) type = this._parseType($el, tag);\n            // set\n            if (type) {\n                $el.attr(\"data-\" + this.prefix + \"-type\", type);\n                // check image tag\n                if (type === \"image\") {\n                    if (tag !== this.opts.image.tag) $el = this.app.element.replaceToTag($el, this.opts.image.tag, true);\n                }\n                // nested\n                if (this.opts.nested.indexOf(type) !== -1) this._parseNested($el);\n            }\n        },\n        _parseType: function($el, tag) {\n            var type;\n            if ($el.attr(\"data-\" + this.prefix + \"-type\")) type = $el.attr(\"data-\" + this.prefix + \"-type\");\n            else if (this._isNoneditable($el)) type = \"noneditable\";\n            else type = this._parseTypeByTag($el, tag);\n            return type;\n        },\n        _parseNested: function($el) {\n            var nodes = this.app.element.getBlocks($el);\n            for(var i = 0; i < nodes.length; i++)this._parseHtml(nodes[i]);\n        },\n        _parseTypeByTag: function($el, tag) {\n            var type;\n            switch(tag){\n                case \"p\":\n                    type = \"paragraph\";\n                    if (this._isImageBlock($el, \"p\")) type = \"image\";\n                    break;\n                case \"figure\":\n                    type = \"embed\";\n                    if (this._isImageBlock($el, \"figure\")) type = \"image\";\n                    else if (this._hasChild($el, \"pre\")) type = \"code\";\n                    else if (this._hasChild($el, \"blockquote\")) type = \"quote\";\n                    break;\n                case \"div\":\n                    type = \"layer\";\n                    if ($el.attr(\"data-\" + this.prefix + \"-type\")) type = false;\n                    else if (this._isGridBlock($el)) type = \"grid\";\n                    else if (this._isColumnBlock($el)) type = \"column\";\n                    else if (this._isTextBlock($el)) type = \"text\";\n                    else if (this._isCardBlock($el)) type = \"card\";\n                    else if (this._isImageBlock($el, \"div\")) type = \"image\";\n                    break;\n                case \"h1\":\n                case \"h2\":\n                case \"h3\":\n                case \"h4\":\n                case \"h5\":\n                case \"h6\":\n                    type = \"heading\";\n                    break;\n                case \"blockquote\":\n                    type = \"quote\";\n                    break;\n                case \"table\":\n                    type = \"table\";\n                    break;\n                case \"pre\":\n                    type = \"code\";\n                    break;\n                case \"hr\":\n                    type = \"line\";\n                    break;\n                case \"dl\":\n                    type = \"dlist\";\n                    break;\n                case \"address\":\n                    type = \"address\";\n                    break;\n                case \"ul\":\n                case \"ol\":\n                    type = \"list\";\n                    break;\n                case \"main\":\n                case \"section\":\n                case \"header\":\n                case \"footer\":\n                case \"aside\":\n                case \"article\":\n                    type = \"layer\";\n                    break;\n                default:\n                    break;\n            }\n            return type;\n        },\n        // is\n        _isNoneditable: function($el) {\n            return $el.hasClass(this.opts.noneditable.classname);\n        },\n        _isColumnBlock: function($el) {\n            if (!this.opts.grid) return;\n            var $parent = $el.parent();\n            if ($parent.length !== 0 && $parent.attr(\"data-\" + this.prefix + \"-type\") === \"grid\") return true;\n        },\n        _isGridBlock: function($el) {\n            if (!this.opts.grid) return;\n            return $el.hasClass(this.opts.grid.classname);\n        },\n        _isTextBlock: function($el) {\n            return this.opts.text && $el.hasClass(this.opts.text.classname);\n        },\n        _isCardBlock: function($el) {\n            return this.opts.card && $el.hasClass(this.opts.card.classname);\n        },\n        _isImageBlock: function($el, tag) {\n            var $img = $el.find(\"img\");\n            if ($img.length === 0) return;\n            if (tag === \"div\" && $img.closest(\"figure\").length !== 0) return;\n            var $target = $img;\n            var $parent = $img.parent();\n            var parentTag = $parent.length !== 0 ? $parent.get().tagName : false;\n            if (parentTag && (parentTag === \"A\" || parentTag === \"SPAN\")) $target = $parent;\n            else if (parentTag && $parent.get() !== $el.get()) return;\n            if ($target.prevElement().length !== 0) return;\n            if (tag !== \"figure\" && $target.nextElement().length !== 0) return;\n            return true;\n        },\n        // has\n        _hasChild: function($el, tag) {\n            if (tag === \"pre\") {\n                var $pre = $el.find(\"pre\");\n                if ($pre.length !== 0) return true;\n            } else if (tag === \"blockquote\") {\n                var $quote = $el.find(\"blockquote\");\n                var $script = $el.find(\"script\");\n                if ($script.length === 0 && $quote.length !== 0) return true;\n            }\n        },\n        // get\n        _getPredefinedTags: function() {\n            var tags = [];\n            Object.keys(this.opts.classes).forEach(function(key) {\n                tags.push(key);\n            });\n            return tags;\n        },\n        // add\n        _addPredefinedClass: function($node) {\n            var tag = $node.get().tagName.toLowerCase();\n            if (typeof this.opts.classes[tag] !== \"undefined\") $node.addClass(this.opts.classes[tag]);\n        },\n        // unparse\n        _unparseAllTags: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"*\").removeAttr(\"contenteditable data-gramm_editor\");\n                // remove images states\n                if (!this.opts.image.states) $w.find(\"img\").removeAttr(\"data-image\");\n            }).bind(this));\n        },\n        _unparseDataType: function(html, state) {\n            return this.app.utils.wrap(html, (function($w) {\n                var $elms = $w.find(\"[data-\" + this.prefix + \"-type]\");\n                if (state !== true) $elms.removeClass(this.prefix + \"-block-state\");\n                $elms.removeAttr(\"data-\" + this.prefix + \"-first-level data-\" + this.prefix + \"-parsed\");\n                $elms.removeClass(this.prefix + \"-block-focus \" + this.prefix + \"-block-multiple-focus \" + this.prefix + \"-block-multiple-hover \" + this.prefix + \"-editable-pause\");\n                $elms.removeClass(this.prefix + \"-empty-layer\");\n                $elms.each(this._unparseByType.bind(this));\n                $elms.removeAttr(\"data-\" + this.prefix + \"-type\");\n                $w.find(\"figcaption\").removeAttr(\"data-\" + this.prefix + \"-type data-placeholder\").each(this.app.content._removeEmptyTag.bind(this));\n            }).bind(this));\n        },\n        _unparseByType: function($node) {\n            var type = $node.attr(\"data-\" + this.prefix + \"-type\");\n            if (type === \"list\") this.app.content.unfixListMargin($node);\n            if (this.opts.parser[type] && this.opts.parser[type].unparse) this.opts.parser[type].unparse.call(this.app, $node);\n        },\n        // convert\n        _convertFrames: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"iframe\").each(this._convertFrame.bind(this));\n            }).bind(this));\n        },\n        _convertForms: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\"form\").each(this._convertForm.bind(this));\n            }).bind(this));\n        },\n        _convertFrame: function($node) {\n            if ($node.closest(\"figure\").length === 0) {\n                $node.wrap(\"<figure>\");\n                $node.parent().addClass(this.prefix + \"-figure-iframe\");\n            }\n        },\n        _convertForm: function($node) {\n            var $el = this.app.element.replaceToTag($node, \"figure\");\n            $el.addClass(this.prefix + \"-figure-form\");\n            $el.attr(\"data-\" + this.prefix + \"-type\", \"form\");\n        },\n        // revert\n        _revertFrames: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\".\" + this.prefix + \"-figure-iframe\").each(this._revertFrame.bind(this));\n            }).bind(this));\n        },\n        _revertForms: function(html) {\n            return this.app.utils.wrap(html, (function($w) {\n                $w.find(\".\" + this.prefix + \"-figure-form\").each(this._revertForm.bind(this));\n            }).bind(this));\n        },\n        _revertFrame: function($node) {\n            var $figcaption = $node.find(\"figcaption\");\n            if ($figcaption.length !== 0) $node.removeClass(this.prefix + \"-figure-iframe\");\n            else $node.unwrap();\n        },\n        _revertForm: function($node) {\n            var $el = this.app.element.replaceToTag($node, \"form\");\n            $el.removeClass(this.prefix + \"-figure-form\");\n        }\n    });\n    ArticleEditor.add(\"module\", \"blocks\", {\n        build: function() {\n            this._buildFirstLevel();\n        },\n        is: function() {\n            return this.getSelected().length > 1;\n        },\n        set: function($block) {\n            $block = $block.closest(\"[data-\" + this.prefix + \"-first-level]\");\n            // unset not first level\n            this.unsetNotFirstLevel();\n            // set focus class\n            this._setFocus($block);\n            setTimeout((function() {\n                this.app.selection.removeAllRanges();\n            }).bind(this), 0);\n            // ui\n            this.app.path.build();\n            this.app.toolbar.build();\n            this.app.control.close();\n            // check all or one selected\n            this._checkSelected();\n        },\n        setFirstLevel: function() {\n            this.app.blocks.getFirstLevel().addClass(this.prefix + \"-block-focus\");\n        },\n        unset: function() {\n            this.getBlocks().removeClass(this.prefix + \"-block-focus \" + this.prefix + \"-block-multiple-hover\");\n        },\n        unsetNotFirstLevel: function() {\n            this.getBlocks().not(\"[data-\" + this.prefix + \"-first-level]\").removeClass(this.prefix + \"-block-focus\");\n        },\n        unsetHover: function() {\n            this.getBlocks().removeClass(this.prefix + \"-block-multiple-hover\");\n        },\n        getBlocks: function() {\n            return this.app.editor.getLayout().find(\"[data-\" + this.prefix + \"-type]\");\n        },\n        getFirstLevel: function() {\n            return this.app.editor.getLayout().find(\"[data-\" + this.prefix + \"-first-level]\");\n        },\n        getEditableBlocks: function() {\n            return this.app.editor.getLayout().find(\"[contenteditable=true]\");\n        },\n        getSelected: function() {\n            return this.app.editor.getLayout().find(\".\" + this.prefix + \"-block-focus\");\n        },\n        getSelectedBlocks: function() {\n            return this.getSelectedBlocks();\n        },\n        getFirst: function() {\n            return this.getBlocks().first().dataget(\"instance\");\n        },\n        getFirstSelected: function() {\n            return this.getSelected().first().dataget(\"instance\");\n        },\n        getLast: function() {\n            return this.getBlocks().last().dataget(\"instance\");\n        },\n        getLastSelected: function() {\n            return this.getSelected().last().dataget(\"instance\");\n        },\n        pauseEditableBlocks: function() {\n            this.getEditableBlocks().attr(\"contenteditable\", false).addClass(this.prefix + \"-editable-pause\");\n        },\n        runEditableBlocks: function() {\n            var $blocks = this.app.editor.getLayout().find(\".\" + this.prefix + \"-editable-pause\");\n            $blocks.attr(\"contenteditable\", true).removeClass(this.prefix + \"-editable-pause\");\n        },\n        removeSelected: function(traverse) {\n            var last = this.getLastSelected();\n            var next;\n            if (traverse !== false && last) next = last.getNext();\n            // remove\n            this.getSelected().each(this._removeSelectedBlock.bind(this));\n            // traverse\n            if (next) this.app.block.set(next, \"start\");\n        },\n        // private\n        _buildFirstLevel: function() {\n            var name = \"data-\" + this.prefix + \"-first-level\";\n            var $layout = this.app.editor.getLayout();\n            $layout.find(\"[\" + name + \"]\").removeAttr(name);\n            $layout.children(\"[data-\" + this.prefix + \"-type]\").attr(name, true);\n        },\n        _checkSelected: function() {\n            var $all = this.getFirstLevel();\n            var $selected = this.getSelected();\n            if ($selected.length === 0) {\n                this.unsetHover();\n                this.app.block.unset();\n            } else if ($selected.length === 1) {\n                this.unsetHover();\n                this.app.block.set($selected.eq(0), false, true);\n            } else if ($all.length === $selected.length) {\n                this.unsetHover();\n                this.app.editor.selectAll();\n            } else this.app.editor.unsetSelectAllClass();\n        },\n        _setFocus: function($block) {\n            var func = $block.hasClass(this.prefix + \"-block-focus\") ? \"removeClass\" : \"addClass\";\n            $block[func](this.prefix + \"-block-focus\");\n            $block.removeClass(this.prefix + \"-block-multiple-hover\");\n        },\n        _removeSelectedBlock: function($node) {\n            var instance = $node.dataget(\"instance\");\n            instance.remove({\n                traverse: false\n            });\n        }\n    });\n    ArticleEditor.add(\"module\", \"block\", {\n        init: function() {\n            this.instance = false;\n            this.$block = false;\n        },\n        create: function(html) {\n            var instance = this.app.create(\"block.\" + this.opts.editor.markup);\n            if (html) instance.getBlock().html(html);\n            return instance;\n        },\n        createHtml: function(html) {\n            return this.create(html).getOuterHtml();\n        },\n        is: function($el) {\n            return $el ? this._isBlockActive($el) : this.get();\n        },\n        isType: function(type) {\n            if (!this.is()) return;\n            return this.get().isType(type);\n        },\n        isParent: function(type) {\n            if (!this.is()) return;\n            var types = Array.isArray(type) ? type : [\n                type\n            ];\n            var $block = this.get().getBlock();\n            var $blocks = this.app.element.getParents($block, types);\n            return $blocks.length !== 0;\n        },\n        get: function() {\n            return this.instance;\n        },\n        set: function(el, caret, force) {\n            // is instance\n            if (el.isBlock) el = el.getBlock();\n            // check if active\n            if (force !== true && this._isBlockActive(el)) return;\n            // unset\n            this.unset();\n            // set\n            this.instance = this._getInstance(el);\n            this.$block = this.instance.getBlock();\n            this.$block.addClass(this.prefix + \"-block-focus\");\n            // caret\n            this._setCaret(caret);\n            // ui\n            this.app.path.build();\n            this.app.toolbar.build();\n            this.app.control.build();\n            // broadcast\n            this.app.broadcast(\"block.set\");\n        },\n        unset: function() {\n            if (!this.instance) return;\n            this.instance = false;\n            this.$block = false;\n            // unset\n            this.app.blocks.unset();\n            this.app.editor.unsetSelectAllClass();\n            // ui\n            this.app.path.build();\n            this.app.toolbar.build();\n            this.app.control.close();\n            // broadcast\n            this.app.broadcast(\"block.unset\");\n        },\n        duplicate: function() {\n            if (!this._isAction()) return;\n            var instance = this.get();\n            var clone = instance.duplicate();\n            var newInstance = instance.insert({\n                instance: clone,\n                position: \"after\",\n                caret: \"start\",\n                type: \"duplicate\"\n            });\n            this.app.broadcast(\"block.duplicate\", {\n                instance: newInstance\n            });\n            return newInstance;\n        },\n        moveUp: function() {\n            if (!this._isAction()) return;\n            this.get().moveUp();\n        },\n        moveDown: function() {\n            if (!this._isAction()) return;\n            this.get().moveDown();\n        },\n        change: function(instance) {\n            if (!this.is()) return;\n            var current = this.get();\n            var $block = current.getBlock();\n            var $newBlock = instance.getBlock();\n            $block.after($newBlock);\n            $block.remove();\n            // rebuild\n            this.app.parser.buildElement($newBlock);\n            this.app.editor.build();\n            // set\n            this.set(instance);\n            // broadcast\n            this.app.broadcast(\"block.change\", {\n                instance: instance\n            });\n        },\n        add: function(params) {\n            this.app.popup.close();\n            var current = this.get();\n            if (params.type && params.type === \"image\" && current && current.getType() === \"cell\") current = current.getParent(\"table\");\n            var remove = false;\n            var position = false;\n            // create\n            var newInstance = params.instance ? params.instance : this.app.create(\"block.\" + params.name, params.source);\n            // all selected\n            if (this.app.editor.isAllSelected()) {\n                current = this.create();\n                this.app.editor.unsetSelectAllClass();\n                this.app.editor.getLayout().html(\"\").append(current.getBlock());\n                position = \"after\";\n                remove = true;\n            } else if (this.app.blocks.is()) {\n                current = this.app.blocks.getLastSelected();\n                position = \"after\";\n            } else if (!current) {\n                if (this.opts.editor.add === \"top\") {\n                    current = this.app.blocks.getFirst();\n                    position = \"before\";\n                } else {\n                    current = this.app.blocks.getLast();\n                    position = \"after\";\n                }\n            } else if (current.isInlineBlock()) {\n                if (newInstance.getType() !== \"variable\") {\n                    var parent = current.getParent();\n                    this.app.caret.set(current.getBlock(), \"after\");\n                    this.app.block.set(parent);\n                    current = this.get();\n                }\n            } else if (current.isEmptiable() && current.isEmpty()) {\n                var $block = current.getBlock();\n                $block.removeClass(this.prefix + \"-empty-layer\");\n                $block.html(\"\");\n                position = \"append\";\n            }\n            // position\n            position = params.position ? params.position : position;\n            var currentremove = true;\n            if (current) {\n                var type = current.getType();\n                var types = [\n                    \"paragraph\",\n                    \"text\",\n                    \"heading\"\n                ];\n                // adding new paragraph without removing current empty\n                if (params.name === \"paragraph\" && types.indexOf(type) !== -1) currentremove = false;\n            }\n            // insert\n            current.insert({\n                instance: newInstance,\n                position: position,\n                caret: params.caret ? params.caret : \"end\",\n                remove: currentremove,\n                type: \"add\"\n            });\n            if (remove) current.remove();\n            return newInstance;\n        },\n        format: function(params) {\n            this.app.format.set(params);\n        },\n        remove: function(params) {\n            var instance = this.get();\n            if (!instance) return;\n            var type = instance.getType();\n            var parent = instance.getParent();\n            var isTraverse = params && typeof params.traverse !== \"undefined\" && params.traverse === false ? false : true;\n            if (isTraverse) {\n                var next = instance.getNext();\n                var prev = instance.getPrev();\n                instance.remove();\n                if (next) this.app.block.set(next, \"start\");\n                else if (prev) this.app.block.set(prev, \"end\");\n                else this.unset();\n            } else {\n                this.unset();\n                instance.remove();\n            }\n            // broadcast image\n            if (type === \"image\") this.app.broadcast(\"image.remove\", {\n                url: instance.getSrc(),\n                id: instance.getId()\n            });\n            // broadcast\n            this.app.broadcast(\"block.remove\", {\n                type: type,\n                parent: parent\n            });\n            // check empty\n            if (this.app.editor.isEmpty()) this.app.editor.setEmpty();\n        },\n        observe: function(obj, name) {\n            var types = [\n                \"line\",\n                \"quote\",\n                \"layer\",\n                \"code\"\n            ];\n            if (types.indexOf(name) !== -1 && !this.opts[name]) return false;\n            // align / valign / outset\n            if (name === \"alignment\" && !this.opts.align) return false;\n            if (name === \"valign\" && !this.opts.valign) return false;\n            if (name === \"outset\" && !this.opts.outset) return false;\n        },\n        observeCard: function(obj, name) {\n            if (name === \"image\") {\n                var instance = this.get();\n                if (!instance.hasImage()) return false;\n            }\n        },\n        popup: function(params, button, name) {\n            // alignment\n            var form;\n            if (name === \"alignment\") form = this._buildSegments(\"align\", \"alignment\");\n            else if (name === \"valign\") form = this._buildSegments(\"valign\");\n            else if (name === \"outset\") form = this._buildSegments(\"outset\");\n            // popup\n            this.app.popup.create(name, {\n                setter: \"block.setData\",\n                getter: \"block.getData\",\n                form: form\n            });\n            this.app.popup.open({\n                button: button\n            });\n        },\n        css: function(name, value) {\n            if (!this.is()) return;\n            var $el = this.get().getBlock();\n            $el.css(name, value);\n            // save\n            name = \"data-\" + this.prefix + \"-style-cache\";\n            var style = $el.attr(\"style\");\n            if (style) {\n                style = style.replace(/\"/g, \"\");\n                $el.attr(name, style);\n            }\n        },\n        // data\n        getData: function() {\n            if (!this.is()) return;\n            var instance = this.get();\n            return instance.getData();\n        },\n        setData: function(stack) {\n            if (!this.is()) return;\n            var data = stack.getData();\n            var instance = this.get();\n            instance.setData(data);\n        },\n        // private\n        _isBlockActive: function(el) {\n            if (this.app.blocks.is()) return false;\n            return this.instance && this.dom(el).get() === this.$block.get();\n        },\n        _isAction: function() {\n            return !this.app.blocks.is() && this.is();\n        },\n        _buildSegments: function(name, title) {\n            var form = {};\n            var segments = {};\n            var obj = this.opts[name];\n            for(var key in obj){\n                if (!obj[key]) continue;\n                segments[key] = {\n                    name: obj[key],\n                    prefix: name\n                };\n            }\n            title = title || name;\n            form[name] = {\n                type: \"segment\",\n                label: \"## form.\" + title + \" ##\",\n                segments: segments\n            };\n            return form;\n        },\n        _appendToEmptyBlock: function(instance) {\n            var emptyBlock = this.app.block.create();\n            emptyBlock.append(instance);\n            return emptyBlock.getBlock();\n        },\n        _getInstance: function(el) {\n            return this.dom(el).dataget(\"instance\");\n        },\n        _setCaret: function(caret) {\n            if (this.instance.isEditable()) {\n                if (caret) {\n                    var $target = this.$block;\n                    if (this.instance.getType() === \"list\" && (caret === \"start\" || caret === \"end\")) $target = caret === \"start\" ? this.$block.find(\"li\").first() : this.$block.find(\"li\").last();\n                    this.app.caret.set($target, caret);\n                }\n            } else {\n                this.app.scroll.save();\n                this.app.editor.getWin().focus();\n                this.$block.focus();\n                setTimeout((function() {\n                    this.app.selection.removeAllRanges();\n                }).bind(this), 0);\n                this.app.scroll.restore();\n            }\n        }\n    });\n    ArticleEditor.add(\"module\", \"event\", {\n        init: function() {\n            // local\n            this.dragoverEvent = false;\n            this.imageDrag = false;\n            this.pressedCmd = false;\n            this.isPopupMouseUp = false;\n            this.isBlockMouseUp = false;\n            this.pasteEvent = false;\n            // events\n            this.events = {\n                frame: [\n                    \"click\",\n                    \"contextmenu\",\n                    \"touchstart\",\n                    \"mouseover\",\n                    \"mouseup\",\n                    \"mousedown\",\n                    \"keydown\",\n                    \"keyup\",\n                    \"paste\",\n                    \"copy\",\n                    \"cut\",\n                    \"drop\",\n                    \"dragstart\",\n                    \"dragover\",\n                    \"dragleave\"\n                ],\n                doc: [\n                    \"keydown\",\n                    \"mousedown\",\n                    \"click\"\n                ],\n                win: [\n                    \"focus\"\n                ],\n                editor: [\n                    \"click\"\n                ]\n            };\n        },\n        run: function() {\n            this._runEvents();\n        },\n        pause: function() {\n            this._pauseEvents();\n        },\n        build: function() {\n            this._buildTargets();\n            this._buildPreventLinks();\n            this._buildEvents();\n        },\n        stop: function() {\n            var eventname = this.prefix + \"-events\";\n            this.$body.off(\".\" + eventname);\n            this.$win.off(\".\" + eventname);\n            this.app.$doc.off(\".\" + eventname);\n        },\n        // on\n        onmouseover: function(e) {\n            // multiple hover\n            this._buildHover(e);\n            // broadcast\n            this.app.broadcast(\"editor.mouseover\", {\n                e: e\n            });\n        },\n        oncontextmenu: function(e) {\n            if (this.pressedCmd) {\n                e.preventDefault();\n                var $block = this._getBlock(e);\n                this.app.blocks.set($block);\n            }\n        },\n        onclick: function(e) {\n            this.app.broadcast(\"editor.click\", {\n                e: e\n            });\n            if (this._isEditorClick(e) && !this.isBlockMouseUp) this._setByClick(e);\n        },\n        onmouseup: function(e) {\n            // state\n            this.app.state.add(e);\n            // broadcast\n            this.app.broadcast(\"editor.mouseup\", {\n                e: e\n            });\n            // ui\n            this.app.toolbar.observe();\n        },\n        onmousedown: function(e) {\n            if (this.app.popup.isOpen()) this.app.popup.close();\n            this._setBlock(e);\n            this._setCaretInline(e);\n            this.app.placeholder.handleClick(e);\n            if (this._isEditorClick(e)) {\n                this.isBlockMouseUp = false;\n                return;\n            } else this.isBlockMouseUp = true;\n            // state\n            this.app.state.add(e);\n            // broadcast\n            this.app.broadcast(\"editor.mousedown\", {\n                e: e\n            });\n        },\n        ontouchstart: function(e) {\n            // state\n            this.app.state.add(e);\n        },\n        onkeydown: function(e) {\n            // broadcast\n            var event = this.app.broadcast(\"editor.keydown\", this._buildEventKeysObj(e));\n            if (event.isStopped()) return e.preventDefault();\n            // enter key\n            if (this.opts.editor.enterKey === false && e.which === 13) {\n                e.preventDefault();\n                return;\n            }\n            // listen undo & redo\n            if (this.app.state.listen(e)) {\n                this.pressedCmd = false;\n                return;\n            }\n            this.pressedCmd = this._isCmdPressed(e);\n            // esc\n            if (this._isEsc(e)) {\n                this.app.block.unset();\n                this.app.selection.removeAllRanges();\n            }\n            // handle shortcut\n            if (this.app.shortcut.handle(e)) {\n                this.pressedCmd = false;\n                return;\n            }\n            // release keydown\n            this.app.input.handle(event);\n        },\n        onkeyup: function(e) {\n            // broadcast\n            var event = this.app.broadcast(\"editor.keyup\", this._buildEventKeysObj(e));\n            if (event.isStopped()) return e.preventDefault();\n            // catch tab\n            var key = e.which;\n            if (key === this.app.keycodes.TAB && !this.app.block.is()) {\n                if (e.target && e.target.tagName === \"BODY\") {\n                    var $first = this.app.blocks.getFirst();\n                    this.app.editor.setFocus();\n                    this.app.block.set($first);\n                } else this._setBlock(e);\n            }\n            this.pressedCmd = false;\n            this.app.blocks.unsetHover();\n            // ui\n            this.app.toolbar.observe();\n        },\n        onpaste: function(e) {\n            this._paste(e);\n        },\n        oncopy: function(e) {\n            this._copy(e);\n        },\n        oncut: function(e) {\n            this._cut(e);\n        },\n        ondrop: function(e) {\n            if (!this.opts.editor.drop) return e.preventDefault();\n            // broadcast\n            var event = this.app.broadcast(\"editor.drop\", {\n                e: e\n            });\n            if (event.isStopped()) return e.preventDefault();\n            // drop\n            var html;\n            var dt = e.dataTransfer;\n            var item = dt.getData(\"item\");\n            if (item !== \"\") {\n                e.preventDefault();\n                if (this.opts.draggable && typeof this.opts.draggable[item] !== \"undefined\") html = this.opts.draggable[item];\n                else {\n                    html = this.dom(\"[data-\" + this.prefix + \"-drop-item=\" + item + \"]\").html();\n                    html = html.trim();\n                }\n                // drop\n                if (html) {\n                    var position = \"after\";\n                    var $over = this.app.editor.getBody().find(\".\" + this.prefix + \"-draggable-over\");\n                    if ($over.length !== 0) position = \"append\";\n                    this._drop(e, html, position, false);\n                }\n            } else if (this.opts.image && this.opts.image.upload && dt.files !== null && dt.files.length > 0) {\n                e.preventDefault();\n                this.app.image.drop(e, dt);\n            } else {\n                html = dt.getData(\"text/html\");\n                html = html.trim() === \"\" ? dt.getData(\"Text\") : html;\n                // drop\n                var dropped = this._drop(e, html);\n                if (this.imageDrag && dropped.instances.length !== 0) {\n                    var instance = dropped.instances[0];\n                    instance.change(this.imageDrag, false);\n                }\n            }\n            this._removeDragPlaceholder();\n            this.imageDrag = false;\n            this.app.observer.trigger = true;\n        },\n        ondragstart: function(e) {\n            var $block = this._getBlock(e.target);\n            if ($block.length !== 0 && this.app.element.getType($block) === \"image\") this.imageDrag = $block.dataget(\"instance\");\n            // broadcast\n            this.app.broadcast(\"editor.dragstart\", {\n                e: e\n            });\n        },\n        ondragover: function(e) {\n            e.preventDefault();\n            this.dragoverEvent = true;\n            this.app.observer.trigger = false;\n            this._removeDragPlaceholder();\n            // data\n            var types = e.dataTransfer.types;\n            if (types.indexOf(\"item\") !== -1) {\n                var $block = this._getBlock(e.target);\n                if ($block.length !== 0) {\n                    var instance = $block.dataget(\"instance\");\n                    if (instance.getType(\"layer\") && instance.isEmpty()) $block.addClass(this.prefix + \"-draggable-over\");\n                    else {\n                        var $pl = this.dom(\"<div>\").addClass(this.prefix + \"-draggable-placeholder\");\n                        $block.after($pl);\n                    }\n                }\n            }\n            // broadcast\n            this.app.broadcast(\"editor.dragover\", {\n                e: e\n            });\n        },\n        ondragleave: function(e) {\n            e.preventDefault();\n            this.dragoverEvent = false;\n            this._removeDragPlaceholder();\n            this.app.observer.trigger = true;\n            // broadcast\n            this.app.broadcast(\"editor.dragleave\", {\n                e: e\n            });\n        },\n        // on editor (frame doc)\n        oneditorclick: function(e) {\n            if (e.target.tagName === \"HTML\") this._setByClick(e);\n        },\n        // on win\n        onwinfocus: function(e) {\n            if (this._isRemoveRanges()) {\n                setTimeout((function() {\n                    this.app.selection.removeAllRanges();\n                }).bind(this), 0);\n                return;\n            }\n        },\n        // on doc\n        ondockeydown: function(e) {\n            if (this.app.popup.isOpen()) {\n                if (this._isEnter(e)) {\n                    var stack = this.app.popup.getStack();\n                    if (stack.hasForm() !== false && e.target.tagName !== \"TEXTAREA\") {\n                        e.preventDefault();\n                        var $btn = stack.getFooterPrimary();\n                        $btn.dataget(\"instance\").invokeCommand();\n                        return;\n                    }\n                }\n                if (this._isEsc(e)) this.app.popup.close(false);\n            }\n        },\n        ondocmousedown: function(e) {\n            this.isPopupMouseUp = this.dom(e.target).closest(\".\" + this.prefix + \"-popup-\" + this.uuid).length !== 0;\n        },\n        ondocclick: function(e) {\n            if (!this._isOutsideEditor(e)) return;\n            if (this.app.popup.isOpen()) {\n                if (this.isPopupMouseUp === false) this.app.popup.close(false);\n            } else this.app.editor.setBlur();\n            this.pressedCmd = false;\n        },\n        // private\n        _buildPreventLinks: function() {\n            var eventname = this.prefix + \"-prevent-events\";\n            this.$body.on(\"click.\" + eventname + \" dblclick.\" + eventname, this._preventLinks.bind(this));\n        },\n        _buildTargets: function() {\n            this.$body = this.app.editor.getBody();\n            this.$win = this.app.editor.getWin();\n        },\n        _buildEventKeysObj: function(e) {\n            var key = e.which;\n            var arrowKeys = [\n                this.app.keycodes.UP,\n                this.app.keycodes.DOWN,\n                this.app.keycodes.LEFT,\n                this.app.keycodes.RIGHT\n            ];\n            var isAlphaKeys = !e.ctrlKey && !e.metaKey && (key >= 48 && key <= 57 || key >= 65 && key <= 90);\n            var k = this.app.keycodes;\n            return {\n                \"e\": e,\n                \"key\": key,\n                \"ctrl\": e.ctrlKey || e.metaKey,\n                \"shift\": e.shiftKey,\n                \"alt\": e.altKey,\n                \"select\": (e.ctrlKey || e.metaKey) && !e.altKey && key === 65,\n                \"enter\": key === k.ENTER,\n                \"space\": key === k.SPACE,\n                \"esc\": key === k.ESC,\n                \"tab\": key === k.TAB && !e.shiftKey && !e.altKey && !e.ctrlKey && !e.metaKey,\n                \"delete\": key === k.DELETE,\n                \"backspace\": key === k.BACKSPACE,\n                \"alpha\": isAlphaKeys,\n                \"arrow\": arrowKeys.indexOf(key) !== -1,\n                \"left\": key === k.LEFT,\n                \"right\": key === k.RIGHT,\n                \"up\": key === k.UP,\n                \"down\": key === k.DOWN,\n                \"left-right\": key === k.LEFT || key === k.RIGHT,\n                \"up-left\": key === k.UP || key === k.LEFT,\n                \"down-right\": key === k.DOWN || key === k.RIGHT\n            };\n        },\n        _buildEvents: function() {\n            var eventname = this.prefix + \"-events\";\n            this._buildTargetEvents(this.$body, this.events.frame, eventname, \"\");\n            this._buildTargetEvents(this.$win, this.events.win, eventname, \"win\");\n            this._buildTargetEvents(this.app.$doc, this.events.doc, eventname, \"doc\");\n            this._buildTargetEvents(this.app.editor.getDoc(), this.events.editor, eventname, \"editor\");\n        },\n        _buildTargetEvents: function($target, events, eventname, type) {\n            for(var i = 0; i < events.length; i++)$target.on(events[i] + \".\" + eventname, this[\"on\" + type + events[i]].bind(this));\n        },\n        _buildHover: function(e) {\n            var instance = this.app.block.get();\n            // check pressed & instance\n            if (!this.pressedCmd || !instance) return;\n            var $block = this.dom(e.target).closest(\"[data-\" + this.prefix + \"-first-level]\");\n            if ($block.length === 0) return;\n            // unset\n            this.app.blocks.unsetHover();\n            // build hover\n            if (!$block.hasClass(this.prefix + \"-block-focus\")) $block.addClass(this.prefix + \"-block-multiple-hover\");\n        },\n        _runEvents: function() {\n            var eventname = this.prefix + \"-events\";\n            this._buildTargetEvents(this.$body, this.events.frame, eventname, \"\");\n            this._buildTargetEvents(this.$win, this.events.win, eventname, \"win\");\n        },\n        _pauseEvents: function() {\n            var eventname = this.prefix + \"-events\";\n            if (this.$body) {\n                this.$body.off(\".\" + eventname);\n                this.$win.off(\".\" + eventname);\n            }\n        },\n        _getBlock: function(target) {\n            return this.dom(target).closest(\"[data-\" + this.prefix + \"-type]\");\n        },\n        _setByClick: function(e) {\n            var blocks = this.app.blocks.getFirstLevel();\n            var coords = [];\n            blocks.each(function($node) {\n                var rect = $node.get().getBoundingClientRect();\n                coords.push([\n                    rect.x,\n                    rect.y,\n                    rect.y + rect.height\n                ]);\n            });\n            var distances = [];\n            var heightIndex = false;\n            coords.forEach(function(coord, index) {\n                var y = parseInt(e.clientY);\n                var x = parseInt(e.clientX);\n                if (coord[1] < y && y < coord[2]) {\n                    heightIndex = index;\n                    return;\n                }\n                var distance = Math.hypot(coord[0] - x, coord[1] - y);\n                distances.push(parseInt(distance));\n            });\n            var closestIndex = heightIndex !== false ? heightIndex : distances.indexOf(Math.min.apply(Math, distances));\n            var $block = blocks.eq(closestIndex);\n            this.app.block.set($block.dataget(\"instance\"), \"start\");\n            this.app.editor.setFocus();\n        },\n        _setCaretInline: function(e) {\n            var instance = this.app.block.get();\n            var code = false;\n            if (instance && instance.isEditable()) {\n                // svg or img\n                if (this.app.element.isEmptyOrImageInline(e.target)) this.app.caret.set(e.target, \"after\");\n                else if (this.app.selection.isCollapsed() && e.target.tagName === \"CODE\") {\n                    code = true;\n                    setTimeout((function() {\n                        var current = this.app.selection.getElement();\n                        if (current && code && current.tagName !== \"CODE\") {\n                            this.app.caret.set(e.target, \"start\");\n                            code = false;\n                        }\n                    }).bind(this), 1);\n                }\n            }\n        },\n        _setBlock: function(e) {\n            // set focus event\n            this.app.editor.setFocus();\n            var $block = e ? this._getBlock(e.target) : this.app.selection.getDataBlock();\n            if ($block.length === 0) return;\n            // prevent contenteditable false focus\n            if ($block.attr(\"contenteditable\") === false) e.preventDefault();\n            // multiple\n            if (this.pressedCmd) {\n                if (e) e.preventDefault();\n                this.app.blocks.set($block);\n            } else this.app.block.set($block);\n        },\n        _isRemoveRanges: function() {\n            var instance = this.app.block.get();\n            return this.app.blocks.is() || instance && instance.isInlineBlock();\n        },\n        _isEsc: function(e) {\n            return e.which === this.app.keycodes.ESC;\n        },\n        _isEnter: function(e) {\n            return e.which === this.app.keycodes.ENTER;\n        },\n        _isEditorClick: function(e) {\n            if (this.app.editor.isEditor(e.target)) {\n                e.preventDefault();\n                return true;\n            }\n        },\n        _isOutsideEditor: function(e) {\n            var $target = this.dom(e.target);\n            var targets = [\n                \"-container-\",\n                \"-popup-\",\n                \"-control-\"\n            ];\n            return $target.closest(\".\" + this.prefix + targets.join(this.uuid + \",.\" + this.prefix) + this.uuid).length === 0;\n        },\n        _isCmdPressed: function(e) {\n            return this.opts.selection.multiple ? (e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey : false;\n        },\n        _isLinkClick: function(e) {\n            return this.dom(e.target).closest(\"a\").length !== 0;\n        },\n        _removeDragPlaceholder: function() {\n            var $body = this.app.editor.getBody();\n            $body.find(\".\" + this.prefix + \"-draggable-placeholder\").remove();\n            $body.find(\".\" + this.prefix + \"-draggable-over\").removeClass(this.prefix + \"-draggable-over\");\n        },\n        _preventLinks: function(e) {\n            if (this._isLinkClick(e)) e.preventDefault();\n        },\n        _drop: function(e, html, position, cleanDrop) {\n            var target = this.app.element.getDataBlock(e.target);\n            target = target.length === 0 ? this.app.blocks.getFirst() : target;\n            // set target\n            this.app.block.set(target);\n            // drop point\n            if (!position) this.app.insertion.insertPoint(e);\n            var clean = true;\n            var parse = true;\n            var instance = this.app.block.get();\n            var isAll = this.app.editor.isAllSelected();\n            if (instance && instance.getType() === \"code\" && !isAll) {\n                clean = false;\n                parse = false;\n                html = this.app.content.getTextFromHtml(html, {\n                    nl: true,\n                    trimlines: false\n                });\n            }\n            if (cleanDrop === false) clean = false;\n            // empty\n            if (html === \"\") return;\n            // autoparse\n            html = clean ? this.app.autoparse.parse(html) : html;\n            // insert\n            return this.app.insertion.insertContent({\n                html: html,\n                clean: clean,\n                parse: parse,\n                position: position\n            });\n        },\n        _paste: function(e) {\n            e.preventDefault();\n            var clipboard = e.clipboardData;\n            // image\n            if (this.app.image.insertFromClipboard(clipboard)) return;\n            // html / text\n            var url = clipboard.getData(\"URL\");\n            var html = this.app.clipboard.getContent(clipboard);\n            // broadcast\n            this.pasteEvent = true;\n            var event = this.app.broadcast(\"editor.before.paste\", {\n                e: e,\n                html: html\n            });\n            if (event.isStopped()) {\n                this.pasteEvent = false;\n                return;\n            }\n            html = event.get(\"html\");\n            // get safari anchor links\n            html = !url || url === \"\" ? html : url;\n            // clean\n            var instance = this.app.block.get();\n            var clean = true;\n            var parse = true;\n            var isAll = this.app.editor.isAllSelected();\n            if (this.opts.paste.plaintext) {\n                clean = false;\n                parse = false;\n                html = this.app.content.getTextFromHtml(html, {\n                    br: true\n                });\n            } else if (instance && instance.getType() === \"code\" && !isAll) {\n                clean = false;\n                parse = false;\n                html = this.app.content.getTextFromHtml(html, {\n                    nl: true,\n                    trimlines: false\n                });\n            } else if (!this.opts.paste.clean) clean = false;\n            html = this.opts.paste.links ? html : this.app.content.removeTags(html, [\n                \"a\"\n            ]);\n            html = this.opts.paste.images ? html : this.app.content.removeTags(html, [\n                \"img\"\n            ]);\n            // empty\n            if (html === \"\") {\n                this.pasteEvent = false;\n                return;\n            }\n            // local images\n            var rtf = clipboard.getData(\"text/rtf\");\n            var images;\n            if (rtf) {\n                images = this._findLocalImages(html);\n                html = this._replaceLocalImages(html, images, this._extractImagesFromRtf(rtf));\n            }\n            // autoparse\n            html = clean ? this.app.autoparse.parse(html) : html;\n            // insert\n            var inserted = this.app.insertion.insertContent({\n                html: html,\n                clean: clean,\n                parse: parse\n            });\n            // upload inserted base64 or blob\n            if (this.opts.image.upload) this.app.image.parseInserted(inserted);\n            // placeholder\n            this.app.placeholder.toggle();\n            // broadcast\n            this.app.broadcast(\"editor.paste\", inserted);\n            this.pasteEvent = false;\n        },\n        _copy: function(e) {\n            this._action(e, \"copy\");\n        },\n        _cut: function(e) {\n            this._action(e, \"cut\");\n        },\n        _action: function(e, name) {\n            var instance = this.app.block.get();\n            var isMultiple = this.app.blocks.is();\n            var html = false;\n            var obj = {\n                html: false,\n                remove: \"content\"\n            };\n            // do nothing\n            if (!isMultiple && !instance) return;\n            if (!isMultiple && instance && instance.isEditable() && this.app.selection.isCollapsed()) return;\n            // stop event\n            e.preventDefault();\n            // select all\n            if (this.app.editor.isAllSelected()) obj = {\n                html: this.app.editor.getLayout().html(),\n                remove: \"all\"\n            };\n            else if (isMultiple) obj = {\n                html: this._copyFromMultiple(name),\n                remove: \"blocks\"\n            };\n            else if (instance && instance.isEditable()) obj = this._copyFromEditable(name, instance);\n            else if (instance) obj = this._copyFromNonEditable(name, instance);\n            // broadcast\n            var event = this.app.broadcast(\"editor.before.\" + name, {\n                e: e,\n                html: obj.html\n            });\n            if (event.isStopped()) return;\n            // delete content\n            if (name === \"cut\") this._cutDeleteContent(obj);\n            html = event.get(\"html\");\n            // set to clipboard\n            html = this.app.clipboard.setContent(e, html);\n            // broadcast\n            this.app.broadcastHtml(\"editor.\" + name, html);\n        },\n        // copy\n        _cutDeleteContent: function(obj) {\n            if (obj.remove === \"instance\") {\n                obj.instance.remove(true);\n                this.app.control.close();\n            } else if (obj.remove === \"all\") this.app.editor.setEmpty();\n            else if (obj.remove === \"blocks\") this.app.blocks.removeSelected(false);\n            else if (obj.remove === \"row\") obj.instance.getBlock().find(\"td, th\").html(\"\");\n            else if (obj.remove === \"noneditable\") {\n                var type = obj.instance.getType();\n                var parentInstance = obj.instance.getParent(\"layer\");\n                if (type === \"column\") obj.instance.setEmpty();\n                else {\n                    obj.instance.remove(true);\n                    this.app.control.close();\n                }\n                if (type === \"layer\" && parentInstance && parentInstance.isEmpty()) parentInstance.setEmpty();\n            } else if (obj.remove !== false) this.app.selection.deleteContents();\n        },\n        _copyFromMultiple: function(name) {\n            var $blocks = this.app.blocks.getSelected();\n            var $tmp = this.dom(\"<div>\");\n            $blocks.each(function($node) {\n                $tmp.append($node.clone());\n            });\n            return $tmp.html();\n        },\n        _copyFromEditable: function(name, instance) {\n            var type = instance.getType();\n            var html = this.app.selection.getHtml();\n            var remove = \"content\";\n            if (type === \"figcaption\" || type === \"cell\") remove = \"content\";\n            else if (instance.isAllSelected()) {\n                html = instance.getOuterHtml();\n                remove = \"instance\";\n            } else if (type === \"dlist\") // wrap to dlist\n            {\n                if (html.search(/<dl/gi) === -1) html = \"<dl>\" + html + \"</dl>\";\n            } else if (type === \"list\") {\n                var tag = instance.getTag();\n                // contains li\n                if (html.search(/<li/gi) !== -1) {\n                    // does not have li at start\n                    if (html.search(/^<li/g) === -1) html = \"<li>\" + html + \"</li>\";\n                    // wrap to list\n                    html = \"<\" + tag + \">\" + html + \"</\" + tag + \">\";\n                }\n            }\n            return {\n                html: html,\n                remove: remove,\n                instance: instance\n            };\n        },\n        _copyFromNonEditable: function(name, instance) {\n            var $block = instance.getBlock();\n            var type = instance.getType();\n            var html = \"\";\n            var remove = \"noneditable\";\n            // column\n            if (type === \"column\") html = $block.html();\n            else if (type === \"row\") {\n                // wrap to table\n                html = instance.getOuterHtml();\n                html = \"<table>\" + html + \"</table>\";\n                remove = \"row\";\n            } else html = instance.getOuterHtml();\n            return {\n                html: html,\n                remove: remove,\n                instance: instance\n            };\n        },\n        // local images\n        _findLocalImages: function(html) {\n            var images = [];\n            this.app.utils.wrap(html, function($w) {\n                $w.find(\"img\").each(function($node) {\n                    if ($node.attr(\"src\").search(/^file:\\/\\//) !== -1) images.push($node.attr(\"src\"));\n                });\n            });\n            return images;\n        },\n        _extractImagesFromRtf: function(rtf) {\n            if (!rtf) return [];\n            var reHeader = /{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?({\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s}]*?/;\n            var reImage = new RegExp(\"(?:(\" + reHeader.source + \"))([\\\\da-fA-F\\\\s]+)\\\\}\", \"g\");\n            var images = rtf.match(reImage);\n            if (!images) return [];\n            var res = [];\n            for(var i = 0; i < images.length; i++){\n                var type = false;\n                if (images[i].indexOf(\"\\\\pngblip\") !== -1) type = \"image/png\";\n                else if (images[i].indexOf(\"\\\\jpegblip\") !== -1) type = \"image/jpeg\";\n                if (type) res.push({\n                    hex: images[i].replace(reHeader, \"\").replace(/[^\\da-fA-F]/g, \"\"),\n                    type: type\n                });\n            }\n            return res;\n        },\n        _convertHexToBase64: function(str) {\n            return btoa(str.match(/\\w{2}/g).map(function(char) {\n                return String.fromCharCode(parseInt(char, 16));\n            }).join(\"\"));\n        },\n        _replaceLocalImages: function(html, images, sources) {\n            if (images.length === sources.length) for(var i = 0; i < images.length; i++){\n                var src = \"data:\" + sources[i].type + \";base64,\" + this._convertHexToBase64(sources[i].hex);\n                html = html.replace(new RegExp('src=\"' + images[i] + '\"', \"g\"), 'src=\"' + src + '\"');\n            }\n            return html;\n        }\n    });\n    ArticleEditor.add(\"module\", \"input\", {\n        handle: function(event) {\n            var e = event.get(\"e\");\n            var key = event.get(\"key\");\n            if (this._doSelectAll(e, event)) return;\n            // events\n            if (event.is(\"enter\") && event.is(\"shift\")) this.handleShiftEnter(e, key, event);\n            else if (event.is(\"enter\")) this.handleEnter(e, key, event);\n            else if (event.is(\"space\") && event.is(\"shift\")) this.handleShiftSpace(e, key, event);\n            else if (event.is(\"space\")) this.handleSpace(e, key, event);\n            else if (event.is(\"tab\") && this.opts.tab.key) this.handleTab(e, key, event);\n            else if (event.is(\"arrow\")) {\n                if (event.is([\n                    \"shift\",\n                    \"alt\",\n                    \"ctrl\"\n                ])) return;\n                this.handleArrow(e, key, event);\n            } else if (event.is([\n                \"delete\",\n                \"backspace\"\n            ])) this.handleDelete(e, key, event);\n        },\n        // handle\n        handleDelete: function(e, key, event) {\n            var instance = this.app.block.get();\n            var isBackspace = event.is(\"backspace\");\n            var isDelete = event.is(\"delete\");\n            if (this.app.blocks.is()) {\n                e.preventDefault();\n                this.app.blocks.removeSelected();\n                return;\n            }\n            // trim invisible char\n            if (instance && instance.isEditable() && this._trimInvisibleChar(e, event.is(\"backspace\") ? \"left\" : \"right\", isDelete)) return;\n            // inline\n            var inline = this.app.selection.getInline();\n            if (inline && inline.innerHTML.length === 1) {\n                e.preventDefault();\n                inline.innerHTML = \"\";\n                return;\n            }\n            // handle block\n            if (instance.handleDelete && instance.handleDelete(e, key, event)) return;\n            // instance\n            var next = instance.getNext();\n            var prev = instance.getPrev();\n            // like variable\n            if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var $block = instance.getBlock();\n                var parent = instance.getParent();\n                this.app.caret.set($block, \"after\");\n                instance.remove(true);\n                this.app.block.set(parent);\n            } else if (!instance.isEditable()) {\n                e.preventDefault();\n                instance.remove(true);\n                if (next) this.app.block.set(next, \"start\");\n                else if (prev) this.app.block.set(prev, \"end\");\n                else if (this.app.editor.isEmpty()) this.app.editor.setEmpty();\n                else this.app.block.unset();\n            } else if (instance.isEditable()) {\n                var type = instance.getType();\n                // all block selected\n                if (instance.isAllSelected()) {\n                    e.preventDefault();\n                    if (type === \"card\") this.app.block.remove();\n                    else instance.setEmpty();\n                    return;\n                }\n                // delete & end\n                if (isDelete && next && instance.isCaretEnd()) {\n                    e.preventDefault();\n                    if (next.getType() === \"card\" || !next.isEditable()) this.app.block.set(next);\n                    else {\n                        if (type === \"card\") return;\n                        else instance.appendNext();\n                    }\n                } else if (isBackspace && prev && instance.isCaretStart()) {\n                    e.preventDefault();\n                    if (prev.getType() === \"card\" || !prev.isEditable()) {\n                        this.app.block.set(prev);\n                        // remove\n                        if (instance.isEmpty()) instance.remove(true);\n                    } else {\n                        if (type === \"card\" || type === \"cell\") return;\n                        else instance.appendToPrev();\n                    }\n                }\n            }\n        },\n        handleArrow: function(e, key, event) {\n            var instance = this.app.block.get();\n            // multiple\n            if (this.app.blocks.is()) return;\n            // editable & inline code or like variable\n            if (instance.isEditable()) {\n                var current = this.app.selection.getCurrent();\n                var inline = this.app.selection.getTopInline();\n                // inline code\n                if (event.is(\"right\") && inline && inline.tagName === \"CODE\") {\n                    var inlineEnd = this.app.caret.is(inline, \"end\");\n                    var blockEnd = this.app.caret.is(instance.getBlock(), \"end\");\n                    if (inlineEnd && blockEnd) {\n                        e.preventDefault();\n                        this.app.caret.set(inline, \"after\");\n                        return;\n                    }\n                }\n                // variable\n                if (inline && this._catchInlineBlock(e, event, inline)) return;\n                else if (current && this._catchInlineBlock(e, event, current)) return;\n            }\n            // trim invisible char\n            if (instance.isEditable() && this._trimInvisibleChar(e, event.is(\"left\") ? \"left\" : \"right\")) return;\n            // handle block\n            if (instance.handleArrow && instance.handleArrow(e, key, event)) return;\n            // like variable\n            if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var $block = instance.getBlock();\n                var parent = instance.getParent();\n                var caret = event.is(\"up-left\") ? \"before\" : \"after\";\n                this.app.caret.set($block, caret);\n                this.app.block.set(parent);\n            } else this._doArrow(e, event, instance);\n        },\n        handleTab: function(e, key, event) {\n            var instance = this.app.block.get();\n            // multiple\n            if (this.app.blocks.is()) {\n                e.preventDefault();\n                return;\n            }\n            // handle block tab\n            if (instance.handleTab && instance.handleTab(e, key, event)) return;\n            // tab as spaces\n            if (this.opts.tab.spaces && instance.isEditable()) {\n                e.preventDefault();\n                var num = this.opts.tab.spaces;\n                var node = document.createTextNode(Array(num + 1).join(\"\\xa0\"));\n                this.app.insertion.insertNode(node, \"end\");\n                return;\n            } else if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var $block = instance.getBlock();\n                var parent = instance.getParent();\n                this.app.caret.set($block, \"after\");\n                this.app.block.set(parent);\n            } else {\n                e.preventDefault();\n                var next = instance.getNext();\n                if (next) this.app.block.set(next, \"start\");\n            }\n        },\n        handleShiftSpace: function(e, key, event) {\n            var instance = this.app.block.get();\n            // multiple\n            if (this.app.blocks.is()) return;\n            // instance\n            var $block = instance.getBlock();\n            // editable\n            if (instance.isEditable()) {\n                // selected all\n                if (instance.isAllSelected()) {\n                    instance.setEmpty();\n                    return;\n                } else if (instance.getType() !== \"code\") {\n                    e.preventDefault();\n                    this.app.insertion.insertHtml(\"&nbsp;\", \"end\");\n                }\n            } else if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var parent = instance.getParent();\n                this.app.caret.set($block, \"after\");\n                instance.remove(true);\n                this.app.block.set(parent);\n                this.app.insertion.insertHtml(\"&nbsp;\", \"end\");\n            } else if (instance.isEmptiable() && instance.isEmpty()) {\n                e.preventDefault();\n                $block.removeClass(this.prefix + \"-empty-layer\");\n                $block.html(\"\");\n                instance.insertEmpty({\n                    position: \"append\",\n                    caret: \"start\"\n                });\n            }\n        },\n        handleSpace: function(e, key, event) {\n            var instance = this.app.block.get();\n            // multiple\n            if (this.app.blocks.is()) {\n                e.preventDefault();\n                var last = this.app.blocks.getLastSelected();\n                last.insertEmpty({\n                    position: \"after\",\n                    caret: \"start\"\n                });\n                this.app.blocks.removeSelected(false);\n                return;\n            }\n            // instance\n            var $block = instance.getBlock();\n            var type = instance.getType();\n            // handle block space\n            if (instance.handleSpace && instance.handleSpace(e, key, event)) return;\n            // do nothing\n            if (type === \"row\") {\n                e.preventDefault();\n                return;\n            } else if (instance.isEditable() && instance.isAllSelected()) {\n                instance.setEmpty();\n                return;\n            } else if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var parent = instance.getParent();\n                this.app.caret.set($block, \"after\");\n                instance.remove(true);\n                this.app.block.set(parent);\n                this.app.insertion.insertHtml(\"&nbsp;\", \"end\");\n            } else if (instance.isEmptiable() && instance.isEmpty()) {\n                e.preventDefault();\n                $block.removeClass(this.prefix + \"-empty-layer\");\n                $block.html(\"\");\n                instance.insertEmpty({\n                    position: \"append\",\n                    caret: \"start\"\n                });\n            } else if (!instance.isEditable()) {\n                e.preventDefault();\n                instance.insertEmpty({\n                    position: \"after\",\n                    caret: \"start\"\n                });\n                instance.remove(true);\n                this.app.control.updatePosition();\n            }\n        },\n        handleShiftEnter: function(e, key, event) {\n            var instance = this.app.block.get();\n            var type = instance.getType();\n            var $block = instance.getBlock();\n            if (this.app.blocks.is() || type === \"row\") e.preventDefault();\n            else if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var parent = instance.getParent();\n                this.app.caret.set($block, \"after\");\n                instance.remove(true);\n                this.app.block.set(parent);\n                this.app.insertion.insertBreakline();\n            } else if (instance.isEditable()) {\n                e.preventDefault();\n                this.app.insertion.insertBreakline();\n            } else {\n                e.preventDefault();\n                var position = \"after\";\n                if (instance.isEmptiable() && instance.isEmpty()) {\n                    position = \"append\";\n                    $block.removeClass(this.prefix + \"-empty-layer\");\n                    $block.html(\"\");\n                }\n                instance.insertEmpty({\n                    position: position,\n                    caret: \"start\"\n                });\n            }\n        },\n        handleEnter: function(e, key, event) {\n            var instance = this.app.block.get();\n            // blocks\n            if (this.app.blocks.is()) {\n                e.preventDefault();\n                var last = this.app.blocks.getLastSelected();\n                last.insertEmpty({\n                    position: \"after\",\n                    caret: \"start\"\n                });\n                return;\n            }\n            // instance\n            var $block = instance.getBlock();\n            // editable\n            if (instance.isEditable()) {\n                // all block selected\n                if (instance.isAllSelected()) {\n                    e.preventDefault();\n                    instance.setEmpty();\n                    return;\n                } else if (!this.app.selection.isCollapsed()) {\n                    e.preventDefault();\n                    if (instance.getType() === \"code\") this.app.insertion.insertNewline();\n                    else this.app.insertion.insertBreakline();\n                    return;\n                }\n            }\n            // like variable\n            if (instance.isInlineBlock()) {\n                e.preventDefault();\n                var parent = instance.getParent();\n                this.app.caret.set($block, \"after\");\n                instance.remove(true);\n                this.app.block.set(parent);\n            } else if (instance.isEmptiable() && instance.isEmpty()) {\n                e.preventDefault();\n                $block.removeClass(this.prefix + \"-empty-layer\");\n                $block.html(\"\");\n                instance.insertEmpty({\n                    position: \"append\",\n                    caret: \"start\"\n                });\n            } else if (!instance.isEditable()) {\n                e.preventDefault();\n                instance.insertEmpty({\n                    position: \"after\",\n                    caret: \"start\"\n                });\n            }\n            // handle block enter\n            if (instance.handleEnter) instance.handleEnter(e, key, event);\n            // ui\n            this.app.control.updatePosition();\n        },\n        handleTextareaTab: function(e) {\n            if (e.keyCode !== 9) return true;\n            e.preventDefault();\n            var el = e.target;\n            var val = el.value;\n            var start = el.selectionStart;\n            el.value = val.substring(0, start) + \"    \" + val.substring(el.selectionEnd);\n            el.selectionStart = el.selectionEnd = start + 4;\n        },\n        // private\n        _isNextBlock: function(event, node) {\n            return event.is(\"right\") && this.app.caret.is(node, \"end\") && this.app.element.getType(node.nextSibling);\n        },\n        _isPrevBlock: function(event, node) {\n            return event.is(\"left\") && this.app.caret.is(node, \"start\") && this.app.element.getType(node.previousSibling);\n        },\n        _isSiblingInlineBlock: function(e, node) {\n            var $el = this.dom(node);\n            var instance = $el.dataget(\"instance\");\n            if (instance && instance.isInlineBlock()) {\n                e.preventDefault();\n                this.app.block.set(instance);\n                return true;\n            }\n        },\n        _isInvisibleChar: function(direction) {\n            var sel = this.app.selection.get();\n            var text = this.app.selection.getText(direction);\n            return sel.current && sel.current.nodeType === 3 && this.app.utils.searchInvisibleChars(text) === 0;\n        },\n        _catchInlineBlock: function(e, event, node) {\n            if (event.is(\"left\") && node.nodeType === 3) {\n                var str = node.textContent;\n                var isChar = this.app.utils.searchInvisibleChars(str) !== -1;\n                if (isChar) {\n                    var charnode = node;\n                    if (this._isSiblingInlineBlock(e, node.previousSibling)) {\n                        charnode.parentNode.removeChild(charnode);\n                        return true;\n                    }\n                }\n            }\n            if (this._isPrevBlock(event, node)) {\n                if (this._isSiblingInlineBlock(e, node.previousSibling)) return true;\n            } else if (this._isNextBlock(event, node)) {\n                if (this._isSiblingInlineBlock(e, node.nextSibling)) return true;\n            }\n        },\n        _trimInvisibleChar: function(e, pointer, remove) {\n            var direction = pointer === \"left\" ? \"before\" : \"after\";\n            var sel = this.app.selection.get();\n            var isChar = this._isInvisibleChar(direction);\n            var el;\n            if (isChar && pointer === \"left\") {\n                el = sel.current;\n                var data = this.app.offset.get();\n                this.dom(el).replaceWith(el.textContent.replace(/\\uFEFF/g, \"\"));\n                this.app.offset.set(false, {\n                    start: data.start - 1,\n                    end: data.end - 1\n                });\n            } else if (isChar && remove && sel.current && sel.current.nextSibling) {\n                el = sel.current.nextSibling;\n                this.dom(el).replaceWith(el.textContent.replace(/\\uFEFF/g, \"\"));\n            } else if (isChar && pointer === \"right\") {\n                e.preventDefault();\n                el = sel.current;\n                var data = this.app.offset.get();\n                this.app.offset.set(false, {\n                    start: data.start + 1,\n                    end: data.end + 1\n                });\n                return true;\n            }\n        },\n        _doSelectAll: function(e, event) {\n            var instance = this.app.block.get();\n            // if select all & action key - make empty\n            if (this._isAllSelected(event)) {\n                this._setEditorEmpty(e, event);\n                return true;\n            }\n            // select all\n            if (event.is(\"select\")) {\n                e.preventDefault();\n                if (!this.app.blocks.is() && instance) {\n                    if (instance.isAllSelected() || instance.isEmpty()) this.app.editor.selectAll();\n                    else instance.setSelectAll();\n                } else this.app.editor.selectAll();\n                return true;\n            }\n        },\n        _doArrow: function(e, event, instance) {\n            var target, caret;\n            var type = instance.getType();\n            var types = [\n                \"code\",\n                \"line\",\n                \"image\",\n                \"embed\",\n                \"layer\",\n                \"grid\"\n            ];\n            if (event.is(\"up-left\") && instance.isCaretStart()) {\n                caret = \"end\";\n                target = instance.getPrev();\n                // insert before\n                if (!target && types.indexOf(type) !== -1) {\n                    this.app.insertion.insertEmptyBlock({\n                        position: \"before\",\n                        caret: \"start\"\n                    });\n                    return;\n                }\n            } else if (event.is(\"down-right\") && instance.isCaretEnd()) {\n                caret = \"start\";\n                target = instance.getNext();\n                // insert after\n                if (!target && types.indexOf(type) !== -1) {\n                    this.app.insertion.insertEmptyBlock({\n                        position: \"after\",\n                        caret: \"start\"\n                    });\n                    return;\n                }\n            }\n            // set next or prev\n            if (target) {\n                e.preventDefault();\n                this.app.block.set(target, caret);\n            }\n        },\n        _isAllSelected: function(event) {\n            return this.app.editor.isAllSelected() && event.is([\n                \"enter\",\n                \"delete\",\n                \"backspace\",\n                \"alpha\",\n                \"space\"\n            ]);\n        },\n        _setEditorEmpty: function(e, event) {\n            if (!event.is([\n                \"alpha\",\n                \"space\"\n            ])) e.preventDefault();\n            this.app.editor.setEmpty();\n        }\n    });\n    ArticleEditor.add(\"module\", \"toolbar\", {\n        init: function() {\n            this.eventname = this.prefix + \"-toolbar\";\n            this.activeClass = \"active\";\n            this.toggledClass = \"toggled\";\n            this.disableClass = \"disable\";\n            this.customButtons = {};\n            this.aTags = {};\n            this.aTypes = {};\n        },\n        start: function() {\n            if (this.opts.toolbar) this.sticky = this.opts.toolbar;\n            else if (this.opts.path && this.opts.path.sticky) this.sticky = this.opts.path;\n            if (this._isToolbar()) {\n                this.$container = this.app.container.get(\"toolbar\");\n                this._build();\n            }\n            this._buildSticky();\n        },\n        load: function() {\n            this._buildActiveButtons();\n            if (this._isToolbar()) {\n                this.$toolbar.html(\"\");\n                this._buildButtons();\n            }\n        },\n        stop: function() {\n            if (!this._isToolbar()) return;\n            this.$toolbar.remove();\n            this.customButtons = {};\n            this.editorButtons = {};\n        },\n        build: function() {\n            if (!this._isToolbar()) return;\n            this.$toolbar.html(\"\");\n            this._buildButtons();\n        },\n        observe: function() {\n            if (!this._isToolbar()) return;\n            this.unsetActive();\n            if (this.app.blocks.is() || this.app.editor.isAllSelected()) return;\n            if (!this._isObserveButtons()) return;\n            var instance = this.app.block.get();\n            var type = instance ? instance.getType() : false;\n            var tag = instance ? instance.getTag() : false;\n            var inlines = this.app.selection.getNodes({\n                type: \"inline\",\n                selected: \"inside\",\n                links: true\n            });\n            var tags = this._getObservedTags(tag, inlines);\n            var buttons = [];\n            var keys;\n            // tags\n            for(var i = 0; i < tags.length; i++){\n                keys = this.aTags[tags[i]];\n                if (keys) buttons = buttons.concat(keys);\n            }\n            // types\n            if (type) {\n                keys = this.aTypes[type];\n                if (keys) buttons = buttons.concat(keys);\n            }\n            // set active\n            this._setActiveKeys(buttons);\n        },\n        // public\n        getElement: function() {\n            return this.$toolbar;\n        },\n        get: function(name) {\n            return this._findButton(name);\n        },\n        add: function(name, obj) {\n            this.customButtons[name] = obj;\n        },\n        setActive: function(name) {\n            if (!this._isToolbar()) return;\n            this._findButtons().removeClass(this.activeClass);\n            this._findButton(name).removeClass(this.disableClass).addClass(this.activeClass);\n        },\n        setToggled: function(name) {\n            if (!this._isToolbar()) return;\n            this._findButtons().removeClass(this.toggledClass);\n            this._findButton(name).removeClass(this.disableClass).addClass(this.toggledClass);\n        },\n        unsetActive: function(name) {\n            if (!this._isToolbar()) return;\n            var $elms = name ? this._findButton(name) : this._findButtons();\n            $elms.removeClass(this.activeClass);\n        },\n        unsetToggled: function(name) {\n            if (!this._isToolbar()) return;\n            var $elms = name ? this._findButton(name) : this._findButtons();\n            $elms.removeClass(this.toggledClass);\n        },\n        enable: function() {\n            if (!this._isToolbar()) return;\n            this._findButtons().removeClass(this.disableClass);\n        },\n        disable: function(except) {\n            if (!this._isToolbar()) return;\n            this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass);\n        },\n        disableSticky: function() {\n            if (!this._isToolbar()) return;\n            var $container = this.app.container.get(\"bars\");\n            $container.removeClass(this.prefix + \"-bars-sticky\");\n            $container.css(\"top\", \"\");\n        },\n        enableSticky: function() {\n            if (!this._isToolbar()) return;\n            if (this.opts.toolbar.sticky) {\n                var $container = this.app.container.get(\"bars\");\n                $container.addClass(this.prefix + \"-bars-sticky\");\n                $container.css(\"top\", this.opts.toolbar.stickyTopOffset + \"px\");\n            }\n        },\n        isSticky: function() {\n            var $container = this.app.container.get(\"bars\");\n            var $main = this.app.container.get(\"main\");\n            var mainTop = $main.offset().top + parseInt($main.css(\"border-top-width\"));\n            var containerTop = $container.offset().top;\n            return containerTop > mainTop || containerTop < mainTop;\n        },\n        // private\n        _build: function() {\n            this.$toolbar = this.dom(\"<div>\").addClass(this.prefix + \"-toolbar\");\n            this.$container.append(this.$toolbar);\n            this.app.container.get(\"bars\").addClass(\"has-toolbar\");\n        },\n        _buildSticky: function() {\n            if (this.sticky) {\n                var $container = this.app.container.get(\"bars\");\n                $container.addClass(this.prefix + \"-bars-sticky\");\n                $container.css(\"top\", this.sticky.stickyTopOffset + \"px\");\n                var $scrollTarget = this.app.scroll.getTarget();\n                $scrollTarget.on(\"scroll.\" + this.prefix + \"-toolbar\", this._observeSticky.bind(this));\n            }\n        },\n        _buildActiveButtons: function() {\n            this.aTags = this.opts.buttons.tags ? this.opts.buttons.tags : {};\n            this.aTypes = this.opts.buttons.types ? this.opts.buttons.types : {};\n            var btns = this.customButtons;\n            Object.keys(btns).forEach((function(key) {\n                var active = btns[key].active;\n                if (active) {\n                    this._buildActiveButton(key, active.tags, this.aTags);\n                    this._buildActiveButton(key, active.types, this.aTypes);\n                }\n            }).bind(this));\n        },\n        _buildActiveButton: function(key, arr, obj) {\n            if (!arr) return;\n            for(var i = 0; i < arr.length; i++){\n                var item = arr[i];\n                if (obj[item]) obj[item].push(key);\n                else obj[item] = [\n                    key\n                ];\n            }\n        },\n        _buildButtons: function() {\n            var instance = this._getCurrentInstance();\n            var buttons = instance ? this.app.editor.getButtonsFromArr(instance.toolbar) : this.app.editor.getButtons();\n            // create button\n            this._createButtons(buttons, instance);\n            // create custom (plugin)\n            if (instance) this._createButtons(this.customButtons, instance);\n        },\n        _createButtons: function(buttons, instance) {\n            for(var name in buttons)if (buttons.hasOwnProperty(name)) {\n                if (instance && !instance.isAllowedButton(name, buttons[name])) continue;\n                if (this._isHidden(name)) continue;\n                if (name === \"add\" && this.opts.addbar === false) continue;\n                if (name === \"format\" && this.opts.format === false) continue;\n                this.app.create(\"button\", name, buttons[name], this.$toolbar, \"toolbar\");\n            }\n        },\n        _observeSticky: function() {\n            if (this.app.source.is()) {\n                this.app.container.get(\"bars\").css(\"top\", 0);\n                return;\n            }\n            var $scrollTarget = this.app.scroll.getTarget();\n            var paddingTop = this.app.scroll.isTarget() ? parseInt($scrollTarget.css(\"padding-top\")) : 0;\n            var $container = this.app.container.get(\"bars\");\n            $container.css(\"top\", 0 - paddingTop + this.sticky.stickyTopOffset + \"px\");\n            if (this.isSticky()) this.app.broadcast(\"toolbar.sticky\");\n            else this.app.broadcast(\"toolbar.static\");\n        },\n        _findButtons: function() {\n            return this.$toolbar.find(\".\" + this.prefix + \"-button-toolbar\");\n        },\n        _findButton: function(name) {\n            return this.$toolbar.find(\"[data-name=\" + name + \"]\");\n        },\n        _isHidden: function(name) {\n            return this.opts.toolbar.hide.indexOf(name) !== -1;\n        },\n        _isToolbar: function() {\n            return this.opts.toolbar;\n        },\n        _isObserveButtons: function() {\n            if (!this.opts.buttons.tags && !this.opts.buttons.types) return false;\n            return true;\n        },\n        _setActiveKeys: function(keys) {\n            for(var i = 0; i < keys.length; i++)this._findButton(keys[i]).addClass(this.activeClass);\n        },\n        _getCurrentInstance: function() {\n            var instance = this.app.block.is() ? this.app.block.get() : false;\n            return this.app.blocks.is() ? false : instance;\n        },\n        _getObservedTags: function(tag, inlines) {\n            var tags = [];\n            if (tag) tags.push(tag);\n            if (inlines.length > 0) for(var i = 0; i < inlines.length; i++)tags.push(inlines[i].tagName.toLowerCase());\n            return tags;\n        }\n    });\n    ArticleEditor.add(\"module\", \"path\", {\n        init: function() {\n            this.activeClass = \"active\";\n            this.disableClass = \"disable\";\n            this.pathItemClass = this.prefix + \"-path-item\";\n        },\n        start: function() {\n            if (!this.opts.path) return;\n            this.$container = this.app.container.get(\"pathbar\");\n            this._build();\n            this._buildRoot();\n            this._buildActive();\n        },\n        build: function() {\n            if (!this.opts.path) return;\n            this._clear();\n            this._buildRoot();\n            if (this.app.blocks.is()) this._buildMultipleItem();\n            else {\n                this._buildItems();\n                this._buildActive();\n            }\n        },\n        disable: function() {\n            if (!this.opts.path) return;\n            this._getAll().addClass(this.disableClass);\n        },\n        enable: function() {\n            if (!this.opts.path) return;\n            this._getAll().removeClass(this.disableClass);\n        },\n        // private\n        _clear: function() {\n            this.$path.find(\".\" + this.pathItemClass).off(\".\" + this.prefix + \"-path-\" + this.uuid);\n            this.$path.html(\"\");\n        },\n        _getAll: function() {\n            return this.$path.find(\".\" + this.pathItemClass);\n        },\n        _selectItem: function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n            var $item = this.dom(e.target).closest(\".\" + this.pathItemClass);\n            if ($item.hasClass(this.disableClass)) return;\n            var instance = $item.dataget(\"instance\");\n            if (instance) {\n                this.app.popup.close();\n                this.app.block.set(instance, \"start\");\n            } else {\n                this._clear();\n                this._buildRoot();\n                this._buildActive();\n                this.app.block.unset();\n            }\n        },\n        _createItem: function() {\n            return this.dom('<a href=\"#\"></a>').attr(\"tabindex\", \"-1\").addClass(this.pathItemClass);\n        },\n        _build: function() {\n            this.$path = this.dom(\"<div>\").addClass(this.prefix + \"-path\");\n            this.$container.append(this.$path);\n        },\n        _buildRoot: function() {\n            this._buildItem(false, this.lang.parse(this.opts.path.title));\n        },\n        _buildActive: function() {\n            this.$path.find(\"a\").removeClass(this.activeClass).last().addClass(this.activeClass);\n        },\n        _buildItems: function() {\n            var current = this.app.block.get();\n            if (!current) return;\n            // parents\n            var $parents = current.getBlock().parents(\"[data-\" + this.prefix + \"-type]\");\n            $parents.nodes.reverse();\n            $parents.each(this._buildParentItem.bind(this));\n            // current\n            this._buildItem(current);\n        },\n        _buildParentItem: function($el) {\n            var instance = $el.dataget(\"instance\");\n            this._buildItem(instance);\n        },\n        _buildMultipleItem: function() {\n            var $item = this._createItem();\n            $item.addClass(this.activeClass);\n            this._buildTitle($item, this.lang.get(\"editor.multiple\"));\n            this.$path.append($item);\n        },\n        _buildItem: function(instance, root) {\n            var $item = this._createItem();\n            $item.dataset(\"instance\", instance);\n            $item.on(\"click.\" + this.prefix + \"-path-\" + this.uuid, this._selectItem.bind(this));\n            this._buildTitle($item, root || instance.getTitle());\n            this.$path.append($item);\n        },\n        _buildTitle: function($item, title) {\n            var $title = this.dom(\"<span>\").html(title);\n            $item.append($title);\n        }\n    });\n    ArticleEditor.add(\"module\", \"topbar\", {\n        init: function() {\n            this.activeClass = \"active\";\n            this.toggledClass = \"disable\";\n            this.disableClass = \"disable\";\n            this.customButtons = {};\n        },\n        start: function() {\n            if (!this._isTopbar()) return;\n            this._build();\n        },\n        load: function() {\n            this._buildButtons();\n        },\n        get: function(name) {\n            return this._findButton(name);\n        },\n        add: function(name, obj) {\n            this.customButtons[name] = obj;\n        },\n        setToggled: function(name) {\n            if (!this._isTopbar()) return;\n            this._findButtons().removeClass(this.toggledClass);\n            this._findButton(name).addClass(this.toggledClass);\n        },\n        unsetToggled: function(name) {\n            if (!this._isTopbar()) return;\n            var $elms = name ? this._findButton(name) : this._findButtons();\n            $elms.removeClass(this.toggledClass);\n        },\n        enable: function() {\n            if (!this._isTopbar()) return;\n            this._findButtons().removeClass(this.disableClass);\n        },\n        disable: function() {\n            if (!this._isTopbar()) return;\n            var $btns = this._findButtons();\n            $btns.removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass);\n        },\n        // private\n        _isTopbar: function() {\n            return this.opts.path;\n        },\n        _build: function() {\n            this.$topbar = this.dom(\"<div>\").addClass(this.prefix + \"-topbar\");\n            this.app.container.get(\"pathbar\").append(this.$topbar);\n        },\n        _buildButtons: function() {\n            var buttons = this.app.editor.getButtonsFromArr(this.opts.buttons.topbar);\n            for(var name in buttons)if (buttons.hasOwnProperty(name)) {\n                if (name === \"undo\" && !this.opts.topbar.undoredo) continue;\n                if (name === \"redo\" && !this.opts.topbar.undoredo) continue;\n                if (name === \"shortcut\" && !this.opts.topbar.shortcuts) continue;\n                this.app.create(\"button\", name, buttons[name], this.$topbar, \"topbar\");\n            }\n        },\n        _findButtons: function() {\n            return this.$topbar.find(\".\" + this.prefix + \"-button-topbar\");\n        },\n        _findButton: function(name) {\n            return this.$topbar.find(\"[data-name=\" + name + \"]\");\n        }\n    });\n    ArticleEditor.add(\"module\", \"control\", {\n        init: function() {\n            this.instance = false;\n            this.customButtons = {};\n            this.eventName = this.prefix + \"-control\";\n        },\n        start: function() {\n            if (!this.opts.control) return;\n            this._build();\n        },\n        stop: function() {\n            if (this.opts.control) this.$control.remove();\n            this.instance = false;\n            this.customButtons = {};\n        },\n        isOpen: function() {\n            return this.$control.css(\"display\") !== \"none\";\n        },\n        getElement: function() {\n            return this.$control;\n        },\n        get: function(name) {\n            return this._findButton(name);\n        },\n        add: function(name, obj) {\n            this.customButtons[name] = obj;\n        },\n        remove: function(name) {\n            this._findButton(name).remove();\n        },\n        build: function() {\n            if (!this.opts.control) return;\n            var instance = this.app.block.get();\n            if (!instance) this.close();\n            else this.open(instance);\n        },\n        open: function(instance) {\n            if (!this.opts.control) return;\n            this.$control.html(\"\");\n            this.instance = instance;\n            var len = this._buildButtons();\n            if (len > 0) {\n                var $scrollTarget = this.app.scroll.getTarget();\n                this.updatePosition();\n                $scrollTarget.on(\"resize.\" + this.eventName, this.updatePosition.bind(this));\n                $scrollTarget.on(\"scroll.\" + this.eventName, this.updatePosition.bind(this));\n                this.app.editor.getWin().on(\"scroll.\" + this.eventName, this.updatePosition.bind(this));\n                this.instance.getBlock().on(\"keyup.\" + this.eventName, this.updatePosition.bind(this));\n            } else this.close();\n        },\n        close: function() {\n            if (!this.opts.control) return;\n            this.$control.hide();\n            if (this.instance) {\n                var $block = this.instance.getBlock();\n                this.app.content.unfixListMargin($block);\n                $block.off(\".\" + this.eventName);\n            }\n            this.app.scroll.getTarget().off(\".\" + this.eventName);\n            this.app.editor.getDoc().off(\".\" + this.eventName);\n            this.instance = false;\n        },\n        updatePosition: function() {\n            if (!this.opts.control) return;\n            if (!this.instance) {\n                this.close();\n                return;\n            }\n            if (this.instance.getType() === \"list\") {\n                var $block = this.instance.getBlock();\n                this.app.content.fixListMargin($block);\n            }\n            var isEditable = this.instance.isEditable();\n            var offset = this.instance.getOffset();\n            var width = this.$control.width();\n            var scrollTop = this.app.editor.getWin().scrollTop();\n            var topOutlineFix = isEditable ? 4 : 2;\n            var leftOutlineFix = isEditable ? 6 : 4;\n            var top = offset.top - topOutlineFix - scrollTop;\n            var left = offset.left - width - leftOutlineFix;\n            var $container = this.app.container.get(\"toolbar\");\n            var toolbarBottom = $container.offset().top + $container.height() - topOutlineFix;\n            var frameRect = this.app.editor.getFrameRect();\n            if (top < toolbarBottom || frameRect.bottom < top) this.$control.hide();\n            else this.$control.show();\n            // scroll target bottom hide\n            if (this.app.scroll.isTarget()) {\n                var $target = this.app.scroll.getTarget();\n                var targetBottom = $target.offset().top + $target.height();\n                var bottom = top + this.$control.height();\n                if (bottom > targetBottom) this.$control.hide();\n            }\n            // left out of edge\n            if (!isEditable && left + width / 2 < frameRect.left) {\n                left = frameRect.left + 3;\n                top = top + 6;\n            }\n            // position\n            this.$control.css({\n                top: top + \"px\",\n                left: left + \"px\"\n            });\n        },\n        // private\n        _buildButtons: function() {\n            var buttons = this.app.editor.getButtonsFromArr(this.instance.control);\n            var count = 0;\n            if (buttons !== false) {\n                count = this._createButtons(buttons, count);\n                count = this._createButtons(this.customButtons, count);\n            }\n            return count;\n        },\n        _build: function() {\n            this.$control = this.dom(\"<div>\").addClass(this.prefix + \"-control \" + this.prefix + \"-control-\" + this.uuid).hide();\n            // bs modal\n            if (this.opts.bsmodal) this.$control.css(\"z-index\", 1060);\n            this.app.$body.append(this.$control);\n        },\n        _createButtons: function(buttons, count) {\n            for(var name in buttons){\n                if (!this.instance.isAllowedButton(name, buttons[name])) continue;\n                this.app.create(\"button\", name, buttons[name], this.$control, \"control\");\n                count++;\n            }\n            return count;\n        },\n        _findButton: function(name) {\n            return this.$control.find(\"[data-name=\" + name + \"]\");\n        }\n    });\n    ArticleEditor.add(\"module\", \"insertion\", {\n        init: function() {\n            this._clear();\n        },\n        start: function() {\n            this.win = this.app.editor.getWinNode();\n            this.doc = this.app.editor.getDocNode();\n        },\n        // get\n        getFirstInserted: function() {\n            return this.inserted.instances[0];\n        },\n        getLastInserted: function() {\n            var len = this.inserted.instances.length;\n            var last = this.inserted.instances[len - 1];\n            if (last && last.isInlineBlock()) last = last.getParent();\n            return last;\n        },\n        getInserted: function() {\n            return this.inserted;\n        },\n        // set\n        setContent: function(params) {\n            this._insert(params, \"set\");\n            var inserted = this.getInserted();\n            this.inserted = false;\n            return inserted;\n        },\n        // insert\n        insertContent: function(params) {\n            this._insert(params, \"insert\");\n            var inserted = this.getInserted();\n            this.inserted = false;\n            return inserted;\n        },\n        insertEmptyBlock: function(params) {\n            if (!params) params = {};\n            params.html = this.app.block.createHtml();\n            this._insert(params, \"insert\");\n            var inserted = this.getInserted();\n            this.inserted = false;\n            // broadcast\n            this.app.broadcast(\"block.add\", {\n                instance: inserted.instances[0],\n                type: \"input\"\n            });\n            return inserted;\n        },\n        insertNewline: function(caret, doublenode) {\n            var str = doublenode ? \"\\n\\n\" : \"\\n\";\n            return this._insertFragment({\n                node: document.createTextNode(str)\n            }, caret ? caret : \"after\");\n        },\n        insertPoint: function(e) {\n            var range;\n            var marker = this.app.utils.createInvisibleChar();\n            var doc = this.app.editor.getDocNode();\n            var x = e.clientX, y = e.clientY;\n            if (doc.caretPositionFromPoint) {\n                var pos = doc.caretPositionFromPoint(x, y);\n                var sel = doc.getSelection();\n                range = sel.getRangeAt(0);\n                range.setStart(pos.offsetNode, pos.offset);\n                range.collapse(true);\n                range.insertNode(marker);\n            } else if (doc.caretRangeFromPoint) {\n                range = doc.caretRangeFromPoint(x, y);\n                range.insertNode(marker);\n            }\n            this.app.caret.set(marker, \"after\");\n        },\n        insertBreakline: function(caret) {\n            // split inline\n            var inlines = this.app.selection.getNodes({\n                type: \"inline\"\n            });\n            if (this.app.selection.isCollapsed() && inlines.length !== 0) return this._splitInline(inlines, document.createElement(\"br\"));\n            return this._insertFragment({\n                node: document.createElement(\"br\")\n            }, caret ? caret : \"after\");\n        },\n        insertNode: function(node, caret, splitinline) {\n            if (splitinline) {\n                var inlines = this.app.selection.getNodes({\n                    type: \"inline\"\n                });\n                if (inlines.length !== 0) return this._splitInline(inlines, node);\n            }\n            return this._insertFragment({\n                node: this.dom(node).get()\n            }, caret);\n        },\n        insertHtml: function(html, caret) {\n            return this._insertFragment({\n                html: html\n            }, caret);\n        },\n        insertText: function(text, caret) {\n            var instance = this.app.block.get();\n            if (instance && !instance.isEditable() || this.app.blocks.is()) {\n                this.insertContent({\n                    html: text,\n                    caret: caret\n                });\n                return;\n            }\n            var sel = this.win.getSelection();\n            var node;\n            if (sel.getRangeAt && sel.rangeCount) {\n                text = this.app.content.getTextFromHtml(text, {\n                    nl: true\n                });\n                node = document.createTextNode(text);\n                var range = sel.getRangeAt(0);\n                range.deleteContents();\n                range.insertNode(node);\n                caret = caret || \"end\";\n                this.app.caret.set(node, caret);\n            }\n            return node;\n        },\n        insertListToList: function($list, $target, caret) {\n            // add paste marker\n            var $items = $list.find(\"li\");\n            var $last = $items.last();\n            $items.addClass(this.prefix + \"-pasteitems\");\n            $last.addClass(this.prefix + \"-pastemarker\");\n            // build nodes\n            var $nodes = $list.children();\n            // current li item\n            var $item = this.dom(this.app.selection.getBlock());\n            // caret position\n            var isStart = this.app.caret.is($target, \"start\");\n            var isEnd = this.app.caret.is($target, \"end\");\n            var isStartItem = this.app.caret.is($item, \"start\");\n            var isEndItem = this.app.caret.is($item, \"end\", [\n                \"ul\",\n                \"ol\"\n            ]);\n            var isEmptyItem = this.app.content.isEmptyHtml($item.html());\n            // start\n            if (isStart) {\n                if (isEmptyItem) $item.remove();\n                $target.prepend($nodes);\n            } else if (isEnd) {\n                if (isEmptyItem) $item.remove();\n                $target.append($nodes);\n            } else {\n                // item empty\n                if (isEmptyItem) {\n                    $item.after($nodes);\n                    $item.remove();\n                } else if (isStartItem) $item.before($nodes);\n                else if (isEndItem) {\n                    var $childList = $item.find(\"ul, ol\");\n                    if ($childList.length !== 0) $childList.prepend($nodes);\n                    else $item.after($nodes);\n                } else this.app.element.split($item).before($nodes);\n            }\n            // set caret\n            var pastemarker = this.prefix + \"-pastemarker\";\n            var pasteitems = this.prefix + \"-pasteitems\";\n            if (caret) {\n                $last = this.app.editor.getLayout().find(\".\" + pastemarker).removeClass(pastemarker);\n                this.app.caret.set($last, \"end\");\n            }\n            return this.app.editor.getLayout().find(\".\" + pasteitems).removeClass(pasteitems);\n        },\n        // detect\n        detectPosition: function($target, position) {\n            if (position) return position;\n            // caret position\n            var isStart = this.app.caret.is($target, \"start\");\n            var isEnd = this.app.caret.is($target, \"end\");\n            // end\n            if (isEnd) position = \"after\";\n            else if (isStart) position = \"before\";\n            else position = \"split\";\n            return position;\n        },\n        // private\n        // insert\n        _insert: function(params, type) {\n            this.html = params.html;\n            // broadcast before\n            this.html = this.app.broadcastHtml(\"editor.before.insert\", this.html);\n            // params\n            this.isParse = typeof params.parse === \"undefined\" ? true : params.parse;\n            this.isClean = typeof params.clean === \"undefined\" ? false : params.clean;\n            this.isCaret = typeof params.caret === \"undefined\" ? true : params.caret;\n            this.isPosition = typeof params.position === \"undefined\" ? false : params.position;\n            // type\n            if (type === \"set\" || this.app.editor.isAllSelected()) // set\n            this._setContent();\n            else // insert\n            this._insertContent();\n            // broadcast\n            this.app.broadcast(\"editor.insert\", this.inserted);\n        },\n        _insertContent: function() {\n            var current = this.app.block.get();\n            var position = false;\n            var remove = false;\n            var nodes, $block;\n            // check\n            this._checkEmpty();\n            this._checkLine();\n            // blocks\n            if (this.app.blocks.is()) {\n                // insert to blocks\n                if (this.isEmpty) return;\n                else if (this.isLine) this.html = this.app.block.createHtml(this.html);\n                // parse & clean\n                this._clean();\n                this._parse();\n                this._parseBuild();\n                // nodes\n                nodes = this._buildParsedNodes();\n                // insert\n                var last = this.app.blocks.getLastSelected();\n                var $last = last.getBlock();\n                $last.after(nodes);\n                // remove\n                this.app.blocks.removeSelected(false);\n            } else if (!current || this.isPosition) {\n                // insert to blocks\n                if (this.isEmpty) return;\n                else if (this.isLine) this.html = this.app.block.createHtml(this.html);\n                // parse & clean\n                this._clean();\n                this._parse();\n                this._parseBuild();\n                // nodes\n                nodes = this._buildParsedNodes();\n                var positions = [\n                    \"after\",\n                    \"before\",\n                    \"append\"\n                ];\n                var emptyLayer = false;\n                if (this.isPosition === \"top\" || !this.isPosition && this.opts.editor.add === \"top\") {\n                    current = this.app.blocks.getFirst();\n                    position = \"before\";\n                } else if (current && positions.indexOf(this.isPosition) !== -1) {\n                    position = this.isPosition;\n                    emptyLayer = current.getType(\"layer\") && current.isEmpty();\n                } else {\n                    current = this.app.blocks.getLast();\n                    position = \"after\";\n                }\n                $block = current.getBlock();\n                if (emptyLayer) {\n                    $block.removeClass(this.prefix + \"-empty-layer\");\n                    $block.html(\"\");\n                }\n                $block[position](nodes);\n            } else if (this._isListToList(current)) {\n                // delete selection\n                this.app.selection.deleteContents();\n                // parse & clean\n                this._clean();\n                this._parse();\n                this._parseBuild();\n                // insert\n                $block = current.getBlock();\n                var $list = this.$parsed.children().first();\n                this.$nodes = this.insertListToList($list, $block, \"end\");\n                this.isCaret = false;\n            } else if (current) {\n                // like variable\n                if (current.isInlineBlock()) {\n                    var parent = current.getParent();\n                    this.app.caret.set(current.getBlock(), \"after\");\n                    current.remove();\n                    this.app.block.set(parent);\n                    current = parent;\n                }\n                // editable\n                if (current.isEditable()) {\n                    if (this.isEmpty) return;\n                    // parse & clean\n                    this._clean();\n                    this._cleanSpecial();\n                    if (this.isLine) this._parseLine();\n                    else this._parse();\n                    this._parseBuild();\n                    if (current.isEmpty()) {\n                        remove = true;\n                        position = \"after\";\n                    } else // delete selection\n                    this.app.selection.deleteContents();\n                    // nodes\n                    nodes = this._buildParsedNodes();\n                    $block = current.getBlock();\n                    // insert\n                    this._insertToEditable(current, $block, nodes, position, remove);\n                } else {\n                    // set position\n                    position = \"after\";\n                    // check\n                    if (this.isEmpty) return;\n                    else if (this.isLine) this.html = this.app.block.createHtml(this.html);\n                    // parse & clean\n                    this._clean();\n                    if (this.isLine) this._parseLine();\n                    else this._parse();\n                    this._parseBuild();\n                    // nodes\n                    nodes = this._buildParsedNodes();\n                    $block = current.getBlock();\n                    // emptiable empty\n                    if (current.isEmptiable() && current.isEmpty()) {\n                        $block.removeClass(this.prefix + \"-empty-layer\");\n                        $block.html(\"\");\n                        position = \"append\";\n                    }\n                    // insert\n                    $block[position](nodes);\n                }\n            } else return;\n            // inserted\n            this._buildInserted();\n            this._buildEditor();\n            this._buildCaret();\n        },\n        _insertToEditable: function(current, $block, nodes, position, remove) {\n            if (this.isLine) {\n                this.$nodes = this._insertFragment({\n                    fragment: this.$parsed.get()\n                }, \"end\");\n                this.isCaret = false;\n            } else {\n                // detect position\n                if (this.app.content.isEmptyHtml($block.html())) {\n                    position = \"after\";\n                    remove = true;\n                } else position = this.detectPosition($block, position);\n                // insert\n                if (position === \"split\") this.app.element.split($block).before(nodes);\n                else $block[position](nodes);\n                // remove\n                if (remove) current.remove();\n            }\n        },\n        _insertFragment: function(obj, caret) {\n            var fragment;\n            if (obj.html || obj.fragment) {\n                fragment = this.app.fragment.build(obj.html || obj.fragment);\n                this.app.fragment.insert(fragment);\n            } else this.app.fragment.insert(obj.node);\n            if (caret) {\n                var target = obj.node ? obj.node : caret === \"start\" ? fragment.first : fragment.last;\n                this.app.caret.set(target, caret);\n            }\n            if (obj.node) return this.dom(obj.node);\n            else return this.dom(fragment.nodes);\n        },\n        // set\n        _setContent: function() {\n            // check\n            this._checkEmpty();\n            this._checkLine();\n            // set to editor\n            if (this.isEmpty) this.html = this.app.block.createHtml();\n            else if (this.isLine) this.html = this.app.block.createHtml(this.html);\n            // parse & clean\n            this._clean();\n            this._parse();\n            this._parseBuild();\n            // nodes\n            var nodes = this._buildParsedNodes();\n            // set\n            this.app.editor.unsetSelectAllClass();\n            this.app.editor.getLayout().html(\"\").append(nodes);\n            // broadcast empty\n            if (this.isEmpty) this.app.broadcast(\"editor.empty\");\n            // inserted\n            this._buildInserted();\n            this._buildEditor();\n            this._buildCaret();\n        },\n        // split\n        _splitInline: function(inlines, node) {\n            var $part = this.app.element.split(inlines[0]);\n            $part.before(node);\n            if ($part.html() === \"\") $part.remove();\n            return this.dom(node);\n        },\n        // build\n        _buildEditor: function() {\n            this.app.placeholder.trigger();\n            this.app.editor.build();\n            this.app.editor.setFocus();\n        },\n        _buildCaret: function() {\n            if (!this.isCaret) return;\n            var instance, caret = \"end\";\n            if (this.isCaret === \"start\") {\n                instance = this.getFirstInserted();\n                caret = \"start\";\n            } else instance = this.getLastInserted();\n            // set\n            setTimeout((function() {\n                if (instance) this.app.block.set(instance, caret);\n                // ui\n                this.app.toolbar.observe();\n            }).bind(this), 0);\n        },\n        _buildInserted: function() {\n            this.inserted = {\n                $nodes: this.$nodes,\n                instances: []\n            };\n            this.inserted.$nodes.each(this._buildInstance.bind(this));\n        },\n        _buildInstance: function($node) {\n            var instance = $node.dataget(\"instance\");\n            if (instance) this.inserted.instances.push(instance);\n            var $nodes = $node.find(\"[data-\" + this.prefix + \"-type]\");\n            if ($nodes.length !== 0) $nodes.each(this._buildInstance.bind(this));\n        },\n        _buildParsedNodes: function() {\n            return this.$parsed.get().childNodes;\n        },\n        // clear\n        _clear: function() {\n            this.html = false;\n            this.isLine = false;\n            this.isEmpty = false;\n            this.isSplit = false;\n            this.isClean = false;\n            this.isParse = true;\n            this.isCaret = true;\n            this.isPosition = false;\n        },\n        // clean\n        _clean: function() {\n            if (this.isClean) this.html = this.app.cleaner.cleanHtml(this.html);\n        },\n        _cleanSpecial: function(type) {\n            var clean, extend, except;\n            if ([\n                \"cell\",\n                \"address\",\n                \"figcaption\",\n                \"quoteitem\"\n            ].indexOf(type) !== -1) clean = true;\n            else if (type === \"dlist\") {\n                clean = true;\n                except = [\n                    \"dt\",\n                    \"dd\"\n                ];\n            } else if (type === \"list\") {\n                clean = true;\n                except = [\n                    \"ul\",\n                    \"ol\",\n                    \"li\"\n                ];\n            }\n            if (clean) {\n                this.isLine = true;\n                this.html = this.app.content.addBrToBlocks(this.html);\n                this.html = this.app.content.removeBlockTags(this.html, extend, except);\n                this.html = this.html.replace(/<br\\s?\\/?>\\n?$/gi, \"\");\n            }\n        },\n        // parse\n        _parse: function() {\n            if (this.isParse) this.html = this.app.parser.parse(this.html, false);\n        },\n        _parseLine: function() {\n            if (this.isParse) this.html = this.app.parser.parseLine(this.html, false);\n        },\n        _parseBuild: function() {\n            this.$parsed = this.app.parser.build(this.html);\n            this.$nodes = this.$parsed.children();\n        },\n        // check\n        _checkEmpty: function() {\n            this.isEmpty = this.app.content.isEmptyHtml(this.html);\n        },\n        _checkLine: function() {\n            this.isLine = this.app.content.isLine(this.html);\n        },\n        // is\n        _isListToList: function(instance) {\n            var $target = instance.getBlock();\n            var type = $target.attr(\"data-\" + this.prefix + \"-type\");\n            var $list = this.dom(\"<div>\").html(this.html);\n            $list.find(\"meta\").remove();\n            // unwrap b fixes google docs\n            $list.find(\"b\").unwrap();\n            $list = $list.children().first();\n            return type === \"list\" && $list.length !== 0 && [\n                \"ul\",\n                \"ol\"\n            ].indexOf($list.get().tagName.toLowerCase()) !== -1;\n        }\n    });\n    ArticleEditor.add(\"module\", \"addbar\", {\n        init: function() {\n            this.customButtons = {};\n        },\n        popup: function(params, button) {\n            // create\n            this.app.popup.create(\"addbar\", {\n                width: \"476px\",\n                items: this.buildItems()\n            });\n            // show the popup at the top always\n            if (this.opts.editor.addbar === \"top\") button = false;\n            // open\n            this.app.popup.open({\n                button: button\n            });\n        },\n        buildItems: function() {\n            var items = {};\n            var obj = $ARX.extend(true, this.opts.buttonsObj);\n            var arr = this.opts.addbar.concat(this.opts.addbarAdd);\n            if (this.opts.addbarAdd.length !== 0 && this.opts.addbarAdd.indexOf(\"text\") !== -1) {\n                var tin = arr.indexOf(\"text\");\n                var pin = arr.indexOf(\"paragraph\");\n                var to = pin !== -1 ? pin + 1 : 0;\n                // move text block button\n                arr.splice(to, 0, arr.splice(tin, 1)[0]);\n            }\n            for(var i = 0; i < arr.length; i++){\n                var name = arr[i];\n                if (this.opts.addbarHide.indexOf(name) !== -1) continue;\n                items[name] = obj[name];\n            }\n            var customItems = $ARX.extend(true, this.customButtons);\n            var instance = this.app.block.get();\n            // build custom\n            Object.keys(customItems).forEach(function(key) {\n                items[key] = customItems[key];\n            });\n            // build all\n            Object.keys(items).forEach((function(key) {\n                this._buildItem(instance, items, items[key], key);\n            }).bind(this));\n            return items;\n        },\n        add: function(name, obj) {\n            this.customButtons[name] = obj;\n        },\n        // private\n        _buildItem: function(instance, items, item, key) {\n            // allowed buttons\n            if (item.blocks && !instance || instance && item.blocks && !instance.isAllowedButton(key, item)) {\n                items[key] = false;\n                return;\n            }\n            items[key] = {\n                container: true,\n                addbar: true,\n                title: item.title,\n                icon: item.icon || key,\n                command: item.command,\n                observer: item.observer || false,\n                params: {\n                    name: key\n                }\n            };\n        }\n    });\n    ArticleEditor.add(\"module\", \"format\", {\n        popup: function(params, button) {\n            var instance = this.app.block.get();\n            var $block = instance ? instance.getBlock() : false;\n            var tag = instance.getTag();\n            var tags = this.opts.format;\n            // build items\n            var items = {};\n            for(var i = 0; i < tags.length; i++){\n                var key = tags[i];\n                items[key] = {\n                    title: this.opts.formatObj[key].title,\n                    params: {\n                        tag: key\n                    },\n                    command: \"block.format\",\n                    shortcut: this.opts.formatObj[key].shortcut\n                };\n            }\n            // build format add\n            if (this.opts.formatAdd) {\n                var obj = this.opts.formatAdd;\n                Object.keys(obj).forEach(function(name) {\n                    items[name] = {\n                        title: obj[name].title,\n                        params: obj[name].params,\n                        command: \"block.format\"\n                    };\n                });\n            }\n            // active item\n            var active = this._isActiveFormat($block, tag, items);\n            if (active) items[active].active = true;\n            this.app.popup.create(\"format\", {\n                width: \"300px\",\n                items: items\n            });\n            this.app.popup.open({\n                button: button\n            });\n        },\n        set: function(params) {\n            // popup\n            if (this.app.popup.isOpen()) this.app.popup.close();\n            // blocks\n            if (this.app.blocks.is()) return;\n            var $items, $block;\n            var instance = this.app.block.get();\n            var isEmpty = instance.isEmpty();\n            var caret = isEmpty ? \"start\" : false;\n            var format = {\n                type: this.opts.formatObj[params.tag].type,\n                tag: params.tag,\n                classname: params.classname || false\n            };\n            // current params\n            this.tag = instance.getTag();\n            this.type = instance.getType();\n            this.$block = instance.getBlock();\n            // selection\n            if (!isEmpty) this.app.selection.saveMarker();\n            // check same\n            if (this._isSameTag(format)) format = this._checkSameFormat(this.$block, format);\n            // format\n            if (format) {\n                if (this._isListToText(format, \"list\")) $block = this._formatListToText(format);\n                else if (this._isListToText(format, \"dlist\")) $items = this._formatListToText(format, true);\n                else if (this._isTextToList(format, \"list\")) this._formatTextToList(format, false, caret);\n                else if (this._isTextToList(format, \"dlist\")) this._formatTextToList(format, true, caret);\n                else this._replaceTo(instance, format, caret);\n            }\n            // restore\n            if (!isEmpty) this.app.selection.restoreMarker();\n            if ($items) {\n                this.app.editor.build();\n                this.app.block.set($items.last(), caret);\n            }\n            if ($block) {\n                this.app.editor.build();\n                this.app.block.set($block, caret);\n            }\n            // broadcast\n            instance = this.app.block.get();\n            this.app.broadcast(\"block.format\", {\n                instance: instance\n            });\n        },\n        // private\n        _isSameTag: function(format) {\n            return this.tag === format.tag && this.type === format.type;\n        },\n        _checkSameFormat: function($el, format) {\n            var hasClass = this.app.element.hasClass($el, format.classname);\n            return !format.classname || hasClass ? this._buildDefaultFormat() : format;\n        },\n        _buildDefaultFormat: function() {\n            var type = this.opts.editor.markup;\n            var tag = type === \"paragraph\" ? \"p\" : \"div\";\n            return {\n                type: type,\n                tag: tag\n            };\n        },\n        _formatListToText: function(format, dlist) {\n            var $items = dlist ? this._getDlistItems() : this._getListItems();\n            $items = this._createItems($items, format);\n            this.$block.remove();\n            return $items;\n        },\n        _formatTextToList: function(format, dlist, caret) {\n            var newInstance = this.app.create(\"block.\" + format.type, \"<\" + format.tag + \">\");\n            var $newBlock = newInstance.getBlock();\n            if (dlist && this.type === \"list\") {\n                var z = 0;\n                this._getListItems().each((function($node) {\n                    var tag = z === 0 ? \"dt\" : \"dd\";\n                    var $item = this.dom(\"<\" + tag + \">\").html($node.html());\n                    z = tag === \"dt\" ? 1 : 0;\n                    $newBlock.append($item);\n                }).bind(this));\n            } else if (!dlist && this.type === \"dlist\") this._getDlistItems().each((function($node) {\n                var $item = this.dom(\"<li>\").html($node.html());\n                $newBlock.append($item);\n            }).bind(this));\n            else {\n                var tag = dlist ? \"<dt>\" : \"<li>\";\n                var $item = this.dom(tag).html(this.$block.html());\n                $newBlock.append($item);\n            }\n            // parse instance\n            this.app.create(\"block.\" + format.type, $newBlock);\n            this.$block.after($newBlock);\n            this.$block.remove();\n            // style & class\n            this._setStyleAndClass($newBlock, format);\n            // set\n            this.app.editor.build();\n            this.app.block.set($newBlock, caret);\n        },\n        _replaceTo: function(instance, format, caret) {\n            var $block = instance.getBlock();\n            var $newBlock = this._replaceToBlock($block, format);\n            // set\n            this.app.editor.build();\n            this.app.block.set($newBlock, caret);\n        },\n        _replaceToBlock: function($block, format) {\n            var $newBlock = this.app.element.replaceToTag($block, format.tag);\n            // style & class\n            this._setStyleAndClass($newBlock, format);\n            // new instance\n            return this.app.create(\"block.\" + format.type, $newBlock);\n        },\n        _createItems: function($items, format) {\n            var $block;\n            $items.each((function($node) {\n                var $item = this.dom(\"<\" + format.tag + \">\");\n                $item.html($node.html());\n                $node.remove();\n                $block = this.app.create(\"block.\" + format.type, $item);\n                this.$block.before($item);\n                // style & class\n                this._setStyleAndClass($item, format);\n            }).bind(this));\n            return $block;\n        },\n        _isListToText: function(format, type) {\n            return this.type === type && [\n                \"heading\",\n                \"address\",\n                \"paragraph\",\n                \"text\"\n            ].indexOf(format.type) !== -1;\n        },\n        _isTextToList: function(format, type) {\n            var checkType = type === \"list\" ? \"dlist\" : \"list\";\n            return format.type === type && [\n                \"heading\",\n                \"address\",\n                \"paragraph\",\n                \"text\",\n                checkType\n            ].indexOf(this.type) !== -1;\n        },\n        _isActiveFormat: function($el, tag, items) {\n            if (!$el) return;\n            var name;\n            for(var key in items)if (items.hasOwnProperty(key)) {\n                var classname = items[key].params.classname || false;\n                var paramstag = items[key].params.tag;\n                if (tag === paramstag) {\n                    if (!classname) name = key;\n                    else if (classname && this.app.element.hasClass($el, classname)) name = key;\n                }\n            }\n            return name;\n        },\n        _setStyleAndClass: function($el, format) {\n            // add classname\n            if (format.classname) {\n                // clean classes & styles\n                $el.removeAttr(\"style class data-\" + this.prefix + \"-style-cache\");\n                $el.addClass(format.classname);\n            }\n        },\n        _getListItems: function() {\n            var $items = this.$block.find(\"li\");\n            $items.find(\"ul, ol\").each(function($node) {\n                $node.parent().after($node);\n            });\n            $items.find(\"ul, ol\").unwrap();\n            return $items;\n        },\n        _getDlistItems: function() {\n            return this.$block.find(\"dt, dd\");\n        }\n    });\n    ArticleEditor.add(\"module\", \"link\", {\n        popups: {\n            format: {\n                items: {\n                    format: {\n                        title: \"## link.link ##\",\n                        command: \"link.format\",\n                        shortcut: \"Ctrl+k\"\n                    },\n                    unlink: {\n                        title: \"## link.unlink ##\",\n                        command: \"link.unlink\"\n                    }\n                }\n            },\n            change: {\n                items: {\n                    edit: {\n                        title: \"## link.edit-link ##\",\n                        command: \"link.edit\",\n                        shortcut: \"Ctrl+k\"\n                    },\n                    unlink: {\n                        title: \"## link.unlink ##\",\n                        command: \"link.unlink\"\n                    }\n                }\n            },\n            create: {\n                title: \"## popup.link ##\",\n                width: \"600px\",\n                form: {\n                    text: {\n                        type: \"input\",\n                        label: \"## link.text ##\"\n                    },\n                    url: {\n                        type: \"input\",\n                        label: \"## link.url ##\"\n                    },\n                    target: {\n                        type: \"checkbox\",\n                        text: \"## link.link-in-new-tab ##\"\n                    }\n                },\n                footer: {\n                    insert: {\n                        title: \"## link.insert ##\",\n                        command: \"link.insert\",\n                        type: \"primary\"\n                    },\n                    cancel: {\n                        title: \"## link.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            },\n            edit: {\n                title: \"## popup.link ##\",\n                width: \"600px\",\n                form: {\n                    text: {\n                        type: \"input\",\n                        label: \"## link.text ##\"\n                    },\n                    url: {\n                        type: \"input\",\n                        label: \"## link.url ##\"\n                    },\n                    target: {\n                        type: \"checkbox\",\n                        text: \"## link.link-in-new-tab ##\"\n                    }\n                },\n                footer: {\n                    save: {\n                        title: \"## link.save ##\",\n                        command: \"link.save\",\n                        type: \"primary\"\n                    },\n                    cancel: {\n                        title: \"## link.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            }\n        },\n        popup: function(params, button) {\n            // get link\n            var $link = this.getLink();\n            var popup = $link.length === 0 ? \"format\" : \"change\";\n            this.app.popup.create(\"link\", this.popups[popup]);\n            this.app.popup.open({\n                button: button\n            });\n        },\n        format: function(params) {\n            // selection\n            var text = this.app.selection.getText();\n            // popup\n            var stack = this.app.popup.create(\"link-create\", this.popups.create);\n            var data = {\n                text: text,\n                target: this.opts.link.target\n            };\n            // set data\n            stack.setData(data);\n            // open\n            this.app.popup.open({\n                focus: text ? \"url\" : \"text\"\n            });\n        },\n        edit: function() {\n            // get link\n            var $link = this.getLink();\n            var stack = this.app.popup.create(\"link-edit\", this.popups.edit);\n            // set\n            var data = {\n                text: $link.text(),\n                url: $link.attr(\"href\"),\n                target: $link.attr(\"target\") || this.opts.link.target\n            };\n            // clean\n            data = this._encodeUrl(data);\n            // set data\n            stack.setData(data);\n            // open\n            this.app.popup.open({\n                focus: \"url\"\n            });\n        },\n        insert: function(stack) {\n            this.app.popup.close();\n            var nodes = this.app.inline.set({\n                tag: \"a\",\n                caret: \"after\"\n            });\n            var $link = this.dom(nodes);\n            // data\n            this._save(stack, $link, \"add\");\n        },\n        save: function(stack) {\n            this.app.popup.close();\n            var $link = this.getLink();\n            // data\n            this._save(stack, $link, \"change\");\n        },\n        unlink: function() {\n            this.app.popup.close();\n            var links = this.app.selection.getNodes({\n                tags: [\n                    \"a\"\n                ]\n            });\n            if (links.length === 0) return;\n            // unlink\n            for(var i = 0; i < links.length; i++){\n                var $link = this.dom(links[i]);\n                this.app.broadcast(\"link.remove\", {\n                    url: $link.attr(\"href\"),\n                    text: $link.text()\n                });\n                $link.unwrap();\n            }\n            // ui\n            this.app.toolbar.observe();\n        },\n        getLink: function() {\n            var links = this.app.selection.getNodes({\n                tags: [\n                    \"a\"\n                ]\n            });\n            var $link = links.length !== 0 ? this.dom(links[0]) : this.dom([]);\n            return $link;\n        },\n        // private\n        _save: function(stack, $link, type) {\n            var data = stack.getData();\n            data = this._cleanUrl(data);\n            data = this._encodeUrl(data);\n            if (data.url === \"\") return;\n            data = this._setUrl($link, data);\n            if ($link.length === 1) data = this._setText($link, data);\n            data = this._setTarget($link, data);\n            data.element = $link;\n            this.app.broadcast(\"link.\" + type, data);\n        },\n        _cleanUrl: function(data) {\n            data.url = this.app.content.escapeHtml(data.url);\n            data.url = data.url.search(/^javascript:/i) !== -1 ? \"\" : data.url;\n            return data;\n        },\n        _encodeUrl: function(data) {\n            data.url = data.url ? data.url.replace(/&amp;/g, \"&\") : \"\";\n            return data;\n        },\n        _setUrl: function($link, data) {\n            $link.attr(\"href\", data.url);\n            return data;\n        },\n        _setText: function($link, data) {\n            data.text = data.text === \"\" ? data.url : data.text;\n            $link.text(data.text);\n            return data;\n        },\n        _setTarget: function($link, data) {\n            if (data.target) $link.attr(\"target\", \"_blank\");\n            else $link.removeAttr(\"target\");\n            return data;\n        }\n    });\n    ArticleEditor.add(\"module\", \"embed\", {\n        popups: {\n            add: {\n                title: \"## embed.embed ##\",\n                width: \"100%\",\n                form: {\n                    embed: {\n                        type: \"textarea\",\n                        label: \"## embed.description ##\",\n                        rows: 6\n                    },\n                    caption: {\n                        type: \"input\",\n                        label: \"## embed.caption ##\"\n                    },\n                    responsive: {\n                        type: \"checkbox\",\n                        text: \"## embed.responsive-video ##\"\n                    }\n                },\n                footer: {\n                    insert: {\n                        title: \"## buttons.insert ##\",\n                        command: \"embed.insert\",\n                        type: \"primary\"\n                    },\n                    cancel: {\n                        title: \"## buttons.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            },\n            edit: {\n                title: \"## embed.embed ##\",\n                width: \"100%\",\n                form: {\n                    embed: {\n                        type: \"textarea\",\n                        label: \"## embed.description ##\",\n                        rows: 6\n                    },\n                    caption: {\n                        type: \"input\",\n                        label: \"## embed.caption ##\"\n                    },\n                    responsive: {\n                        type: \"checkbox\",\n                        text: \"## embed.responsive-video ##\"\n                    }\n                },\n                footer: {\n                    save: {\n                        title: \"## buttons.save ##\",\n                        command: \"embed.save\",\n                        type: \"primary\"\n                    },\n                    cancel: {\n                        title: \"## buttons.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            }\n        },\n        build: function(scripts) {\n            if (scripts) this._callScripts(scripts);\n            else this._findScripts();\n        },\n        observe: function(obj, name, stack) {\n            if (!this.opts.embed) return false;\n            var instance = this.app.block.get();\n            if (stack && stack.getName() === \"addbar\") obj.command = \"embed.popup\";\n            else if (instance && instance.getType() === \"embed\") obj.command = \"embed.edit\";\n            return obj;\n        },\n        popup: function() {\n            var stack = this.app.popup.add(\"embed\", this.popups.add);\n            stack.open({\n                focus: \"embed\"\n            });\n            // checkbox\n            if (this.opts.embed.checkbox) stack.getInput(\"responsive\").attr(\"checked\", true);\n            // codemirror\n            this._buildCodemirror(stack);\n        },\n        edit: function(params, button) {\n            var instance = this.app.block.get();\n            var data = {\n                embed: instance.getEmbedCode(),\n                caption: instance.getCaption(),\n                responsive: instance.isResponsive()\n            };\n            // popup & data\n            var stack = this.app.popup.create(\"embed\", this.popups.edit);\n            stack.setData(data);\n            // open\n            this.app.popup.open({\n                button: button,\n                focus: \"embed\"\n            });\n            // codemirror\n            this._buildCodemirror(stack);\n        },\n        insert: function(stack) {\n            this.app.popup.close();\n            // data\n            var data = stack.getData();\n            var code = this._getEmbedCode(data);\n            if (code === \"\") return;\n            // create\n            var instance = this._createInstance(data, code);\n            this.app.block.add({\n                instance: instance\n            });\n        },\n        save: function(stack) {\n            this.app.popup.close();\n            // data\n            var current = this.app.block.get();\n            var data = stack.getData();\n            var code = this._getEmbedCode(data);\n            if (code === \"\") {\n                this.app.block.remove();\n                return;\n            }\n            // create\n            var instance = this._createInstance(data, code, current);\n            // change\n            if (this._isNeedToChange(data, instance, current)) this.app.block.change(instance);\n        },\n        // private\n        _buildCodemirror: function(stack) {\n            var $input = stack.getInput(\"embed\");\n            this.app.codemirror.create({\n                el: $input,\n                height: \"200px\",\n                focus: true\n            });\n            this.app.popup.updatePosition();\n        },\n        _findScripts: function() {\n            var scripts = this.app.editor.getLayout().find(\"[data-\" + this.prefix + \"-type=embed]\").find(\"script\").getAll();\n            this.build.call(this, scripts);\n        },\n        _callScripts: function(scripts) {\n            for(var i = 0; i < scripts.length; i++)if (scripts[i].src !== \"\") {\n                var src = scripts[i].src;\n                this.app.editor.getDoc().find('head script[src=\"' + src + '\"]').remove();\n                var $script = this.dom(\"<script>\").attr({\n                    \"src\": src,\n                    \"async\": true,\n                    \"defer\": \"true\"\n                });\n                $script.on(\"load\", (function() {\n                    if (src.search(\"instagram\") !== -1) {\n                        var win = this.app.editor.getWinNode();\n                        if (win.instgrm) win.instgrm.Embeds.process();\n                    }\n                    this.build(scripts.slice(i + 1));\n                }).bind(this));\n                var head = this.app.editor.getDocNode().getElementsByTagName(\"head\")[0];\n                if (head) head.appendChild($script.get());\n            }\n        },\n        _getEmbedCode: function(data) {\n            var code = data.embed.trim();\n            code = this.app.codemirror.val(code);\n            code = this._removeScript(code);\n            code = this.app.content.sanitize(code);\n            code = !this._isHtmlString(code) && code !== \"\" ? this._parseUrl(code) : code;\n            return code;\n        },\n        _removeScript: function(code) {\n            if (!this.opts.embed.script) code = this.app.content.removeTagsWithContent(code, [\n                \"script\"\n            ]);\n            return code;\n        },\n        _createInstance: function(data, code, current) {\n            var $figure;\n            if (current) {\n                var figure = current.duplicateEmpty();\n                $figure = figure.getBlock();\n                $figure.html(code);\n            } else $figure = this._isFigure(code) ? code : \"<figure>\" + code + \"</figure>\";\n            var instance = this.app.create(\"block.embed\", $figure);\n            // caption\n            instance.setCaption(data.caption);\n            // responsive\n            if (data.responsive) instance.addResponsive();\n            return instance;\n        },\n        _parseUrl: function(str) {\n            var iframeStart = '<iframe width=\"560\" height=\"315\" src=\"';\n            var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n            var parsed;\n            if (str.match(this.opts.regex.youtube)) {\n                var yturl = \"//www.youtube.com\";\n                if (str.search(\"youtube-nocookie.com\") !== -1) yturl = \"//www.youtube-nocookie.com\";\n                parsed = str.replace(this.opts.regex.youtube, yturl + \"/embed/$1\");\n                return iframeStart + parsed + iframeEnd;\n            } else if (str.match(this.opts.regex.vimeo)) {\n                parsed = str.replace(this.opts.regex.vimeo, \"//player.vimeo.com/video/$2\");\n                return iframeStart + parsed + iframeEnd;\n            }\n            return str;\n        },\n        _isNeedToChange: function(data, instance, current) {\n            if (current.getEmbedCode() !== instance.getEmbedCode()) return true;\n            if (data.responsive !== current.isResponsive()) return true;\n            if (data.caption !== current.getCaption()) return true;\n        },\n        _isHtmlString: function(str) {\n            return /^\\s*<(\\w+|!)[^>]*>/.test(str);\n        },\n        _isFigure: function(str) {\n            return /^<figure/.test(str);\n        }\n    });\n    ArticleEditor.add(\"module\", \"grid\", {\n        popup: function() {\n            // create\n            var stack = this.app.popup.add(\"grid\", {\n                title: \"## popup.grid ##\",\n                width: \"320px\",\n                items: this.buildItems()\n            });\n            stack.open();\n        },\n        observe: function() {\n            if (!this.opts.grid) return false;\n        },\n        buildItems: function() {\n            var items = {};\n            var z = 0;\n            for(var pattern in this.opts.grid.patterns)if (this.opts.grid.patterns.hasOwnProperty(pattern)) {\n                z++;\n                var $item = this._createPattern(pattern);\n                items[\"column\" + z] = {\n                    html: $item,\n                    command: \"grid.add\",\n                    params: {\n                        pattern: pattern,\n                        columns: this.opts.grid.patterns[pattern]\n                    }\n                };\n            }\n            return items;\n        },\n        add: function(params) {\n            this.app.popup.close();\n            var pattern = params.columns === \"\";\n            var columns = pattern ? params.pattern.split(\"|\") : params.columns.split(\"|\");\n            var $grid = this.dom(\"<div>\").addClass(this.opts.grid.classname);\n            if (this.opts.grid.classes !== \"\") $grid.addClass(this.opts.grid.classes);\n            for(var i = 0; i < columns.length; i++){\n                var column = this.app.create(\"block.column\");\n                var $column = column.getBlock();\n                if (!pattern) $column.addClass(columns[i]);\n                $grid.append($column);\n            }\n            // add\n            var instance = this.app.block.add({\n                name: \"grid\",\n                source: $grid,\n                caret: false\n            });\n            // set\n            this.app.block.set(instance);\n        },\n        // private\n        _createPattern: function(pattern) {\n            var $item = this.dom(\"<div>\").addClass(this.prefix + \"-popup-grid-box\");\n            var columns = pattern.split(\"|\");\n            var sum = this.app.utils.sumOfArray(columns);\n            var unit = 100 / sum;\n            for(var i = 0; i < columns.length; i++){\n                var $column = this.dom(\"<span>\");\n                $column.addClass(this.prefix + \"-popup-grid-column\");\n                $column.css(\"width\", columns[i] * unit + \"%\");\n                $item.append($column);\n            }\n            return $item;\n        }\n    });\n    ArticleEditor.add(\"module\", \"image\", {\n        popups: {\n            add: {\n                title: \"## popup.add-image ##\",\n                width: \"100%\"\n            },\n            edit: {\n                title: \"## popup.image ##\",\n                width: \"100%\",\n                getter: \"block.getData\",\n                form: {\n                    width: {\n                        type: \"input\",\n                        width: \"100px\",\n                        label: \"## image.width ##\",\n                        observer: \"image.observeImageWidth\"\n                    },\n                    alt: {\n                        type: \"input\",\n                        label: \"## image.alt-text ##\"\n                    },\n                    caption: {\n                        type: \"input\",\n                        label: \"## image.caption ##\",\n                        observer: \"image.observeImageCaption\"\n                    },\n                    link: {\n                        type: \"input\",\n                        label: \"## image.link ##\",\n                        observer: \"image.observeImageLink\"\n                    },\n                    target: {\n                        type: \"checkbox\",\n                        text: \"## image.link-in-new-tab ##\",\n                        observer: \"image.observeImageLink\"\n                    }\n                },\n                footer: {\n                    \"save\": {\n                        title: \"## image.save ##\",\n                        command: \"image.save\",\n                        type: \"primary\"\n                    },\n                    \"cancel\": {\n                        title: \"## image.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            },\n            editcard: {\n                title: \"## popup.image ##\",\n                width: \"100%\",\n                getter: \"block.getData\",\n                setter: \"block.setData\",\n                form: {\n                    alt: {\n                        type: \"input\",\n                        label: \"## image.alt-text ##\"\n                    }\n                },\n                footer: {\n                    \"save\": {\n                        title: \"## image.save ##\",\n                        command: \"image.save\",\n                        type: \"primary\"\n                    },\n                    \"cancel\": {\n                        title: \"## image.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            }\n        },\n        init: function() {\n            this.dataStates = [];\n        },\n        popup: function() {\n            var stack = this.app.popup.add(\"image\", this.popups.add);\n            var $body = stack.getBody();\n            this._createImageByUrl($body);\n            this._createOrSection($body);\n            this._createUploadBox($body);\n            this._createSelectBox($body);\n            // open\n            stack.open();\n        },\n        edit: function(params, button) {\n            this._edit(\"edit\", button);\n        },\n        editCard: function(params, button) {\n            this._edit(\"editcard\", button);\n        },\n        observe: function(obj, name, stack) {\n            if (!this.opts.image) return false;\n            var instance = this.app.block.get();\n            if (stack && stack.getName() === \"addbar\") obj.command = \"image.popup\";\n            else if (instance && instance.getType() === \"image\") obj.command = \"image.edit\";\n            return obj;\n        },\n        observeStates: function() {\n            this._findImages().each(this._addImageState.bind(this));\n        },\n        observeImageLink: function(obj) {\n            return this.opts.image.link ? obj : false;\n        },\n        observeImageCaption: function(obj) {\n            var instance = this.app.block.get();\n            if (instance && instance.getTag() === \"figure\") return obj;\n            else return false;\n        },\n        observeImageWidth: function(obj) {\n            return this.opts.image.width ? obj : false;\n        },\n        parseInserted: function(inserted) {\n            var files = [];\n            var params = {\n                url: this.opts.image.upload,\n                name: this.opts.image.name,\n                data: this.opts.image.data,\n                multiple: true,\n                success: \"image.insertFromInserted\",\n                error: \"image.error\"\n            };\n            this.pasteInsertedImages = [];\n            this.resolved = [];\n            var fetchImages = 0;\n            for(var i = 0; i < inserted.instances.length; i++){\n                var instance = inserted.instances[i];\n                var type = instance.getType();\n                if (type === \"image\") {\n                    var src = instance.getSrc();\n                    if (src.search(/^data:/i) !== -1) {\n                        var blob = this._dataURLtoFile(src, \"image\" + i);\n                        files.push(blob);\n                        this.pasteInsertedImages.push(instance);\n                    } else if (src.search(/^blob:/i) !== -1) {\n                        fetchImages++;\n                        this.pasteInsertedImages.push(instance);\n                        var self = this;\n                        function sendFile(src, i) {\n                            var xhr = new XMLHttpRequest();\n                            xhr.open(\"GET\", src, true);\n                            xhr.responseType = \"blob\";\n                            xhr.onload = function(e) {\n                                if (xhr.status == 200) {\n                                    var blob = xhr.response;\n                                    var file = new File([\n                                        blob\n                                    ], \"image\" + i, {\n                                        type: \"image/png\"\n                                    });\n                                    self.resolved.push(file);\n                                }\n                            };\n                            xhr.send();\n                        }\n                        sendFile(src, i);\n                    }\n                }\n            }\n            if (fetchImages !== 0) var interval = setInterval((function() {\n                if (this.resolved.length === fetchImages) {\n                    clearInterval(interval);\n                    var upload = this.app.create(\"upload\");\n                    upload.send(false, this.resolved, params);\n                }\n            }).bind(this), 100);\n            if (files.length !== 0) {\n                var upload = this.app.create(\"upload\");\n                upload.send(false, files, params);\n            }\n        },\n        paste: function(blob, e) {\n            var params = {\n                url: this.opts.image.upload,\n                name: this.opts.image.name,\n                data: this.opts.image.data,\n                multiple: false,\n                success: \"image.insertFromBlob\",\n                error: \"image.error\"\n            };\n            // upload\n            var upload = this.app.create(\"upload\");\n            upload.send(e, [\n                blob\n            ], params);\n        },\n        drop: function(e, dt) {\n            var files = [];\n            for(var i = 0; i < dt.files.length; i++){\n                var file = dt.files[i] || dt.items[i].getAsFile();\n                if (file) files.push(file);\n            }\n            var params = {\n                url: this.opts.image.upload,\n                name: this.opts.image.name,\n                data: this.opts.image.data,\n                multiple: this.opts.image.multiple,\n                success: \"image.insertByDrop\",\n                error: \"image.error\"\n            };\n            if (files.length > 0) {\n                var $block = this.dom(e.target).closest(\"[data-\" + this.prefix + \"-type]\");\n                if ($block.length !== 0) this.app.block.set($block);\n                // upload\n                var upload = this.app.create(\"upload\");\n                upload.send(e, files, params);\n            }\n        },\n        insertFromClipboard: function(clipboard) {\n            var text = clipboard.getData(\"text/plain\") || clipboard.getData(\"text/html\");\n            text = text.trim();\n            if (text !== \"\") return;\n            var items = clipboard.items;\n            var blob = null;\n            for(var i = 0; i < items.length; i++)if (items[i].type.indexOf(\"image\") === 0) blob = items[i].getAsFile();\n            if (blob !== null) {\n                this.paste(blob);\n                return true;\n            }\n        },\n        insertFromBlob: function(response) {\n            this.insert(response);\n        },\n        insertByDrop: function(response, e) {\n            if (this.app.block.is()) {\n                var instance = this.app.block.get();\n                var target = e.target;\n                var type = instance.getType();\n                var isChange = type === \"card\" && target && target.tagName === \"IMG\" && instance.hasImage() || type === \"image\";\n                if (isChange) {\n                    this.change(response);\n                    return;\n                } else if (e && type !== \"card\" && instance.isEditable()) this.app.insertion.insertPoint(e);\n            }\n            this.insert(response);\n        },\n        insertByUpload: function(response) {\n            this.insert(response);\n        },\n        insertByUrl: function(e) {\n            e.preventDefault();\n            var str = this.$urlinput.val();\n            if (str.trim() === \"\") return;\n            var response = {\n                file: {\n                    url: str,\n                    id: this.app.utils.getRandomId()\n                }\n            };\n            // insert\n            this.insert(response);\n        },\n        insertFromSelect: function(e) {\n            e.preventDefault();\n            var $target = this.dom(e.target);\n            var obj = {\n                url: $target.attr(\"data-url\")\n            };\n            var attrs = [\n                \"id\",\n                \"alt\",\n                \"caption\",\n                \"link\",\n                \"width\",\n                \"height\"\n            ];\n            for(var i = 0; i < attrs.length; i++){\n                var val = $target.attr(\"data-\" + attrs[i]);\n                if (val !== null) obj[attrs[i]] = val;\n            }\n            // insert\n            this.insert({\n                file: obj\n            }, true);\n        },\n        insertFromInserted: function(response) {\n            var z = 0;\n            for(var key in response)if (response.hasOwnProperty(key)) {\n                this.pasteInsertedImages[z].setImage(response[key]);\n                z++;\n            }\n        },\n        changeClone: function(response) {\n            for(var key in response)if (response.hasOwnProperty(key)) {\n                this.$imageclone.attr(\"src\", response[key].url);\n                break;\n            }\n            this.change(response, false);\n        },\n        change: function(response, closepopup) {\n            if (closepopup !== false) this.app.popup.close();\n            var instance = this.app.block.get();\n            for(var key in response)if (response.hasOwnProperty(key)) {\n                instance.setImage(response[key]);\n                // broadcast\n                this.app.broadcast(\"image.change\", response[key]);\n                this.app.broadcast(\"image.upload\", {\n                    instance: instance,\n                    data: response[key]\n                });\n                return;\n            }\n        },\n        save: function(stack) {\n            this.app.popup.close();\n            this.app.block.setData(stack);\n        },\n        insert: function(response, select) {\n            // popup close\n            this.app.popup.close();\n            // insert\n            this.imageslen = 0;\n            this.imagescount = 0;\n            // tag\n            var tag = this.opts.image.tag;\n            // loop\n            for(var key in response)if (response.hasOwnProperty(key)) {\n                var $source = this.dom(\"<\" + tag + \">\");\n                var $image = this._createImageFromResponseItem(response[key]);\n                $source.append($image);\n                var instance = this.app.create(\"block.image\", $source);\n                this.app.block.add({\n                    instance: instance,\n                    type: \"image\"\n                });\n                // caption\n                if (Object.prototype.hasOwnProperty.call(response[key], \"caption\")) {\n                    var $caption = this.dom(\"<figcaption>\").html(response[key].caption);\n                    instance.$block.append($caption);\n                    this.app.create(\"block.figcaption\", $caption);\n                }\n                // broadcast\n                var eventType = select ? \"select\" : \"upload\";\n                this.app.broadcast(\"image.\" + eventType, {\n                    instance: instance,\n                    data: response[key]\n                });\n                this.$last = instance.getBlock();\n                this.imageslen++;\n            }\n        },\n        error: function(response) {\n            this.app.broadcast(\"image.upload.error\", {\n                response: response\n            });\n        },\n        getStates: function() {\n            var $images = this._findImages();\n            // check status\n            for(var key in this.dataStates)if (this.dataStates.hasOwnProperty(key)) {\n                var data = this.dataStates[key];\n                var status = $images.is('[data-image=\"' + data.id + '\"]');\n                this._setImageState(data.id, status);\n            }\n            return this.dataStates;\n        },\n        createUploadBox: function(upload, $body) {\n            if (!upload) return;\n            var $upload = this.dom(\"<div>\");\n            $body.append($upload);\n            return $upload;\n        },\n        createSelectBox: function(select, $body, callback) {\n            if (!select) return;\n            // images box\n            this.$selectbox = this._createImagesBox($body);\n            if (typeof select === \"object\") this._parseList(select, callback);\n            else {\n                var getdata = this.opts.editor.reloadmarker ? {\n                    d: new Date().getTime()\n                } : {};\n                this.ajax.request(this.opts.image.selectMethod, {\n                    url: select,\n                    data: getdata,\n                    success: (function(data) {\n                        this._parseList(data, callback);\n                    }).bind(this)\n                });\n            }\n        },\n        // private\n        _edit: function(type, button) {\n            this.app.popup.create(\"image-edit\", this.popups[type]);\n            this._buildEditUpload();\n            this.app.popup.open({\n                button: button\n            });\n        },\n        _findImages: function() {\n            return this.app.editor.getLayout().find(\"[data-image]\");\n        },\n        _addImageState: function($node) {\n            var id = $node.attr(\"data-image\");\n            this.dataStates[id] = {\n                type: \"image\",\n                status: true,\n                url: $node.attr(\"src\"),\n                $img: $node,\n                $el: $node,\n                id: id\n            };\n        },\n        _setImageState: function(url, status) {\n            this.dataStates[url].status = status;\n        },\n        _checkImageLoad: function() {\n            this.imagescount++;\n            if (this.imagescount === this.imageslen) {\n                this.app.block.unset();\n                this.app.block.set(this.$last);\n                this.app.editor.adjustHeight();\n            }\n        },\n        _buildEditUpload: function() {\n            if (!this.opts.image.upload) return;\n            var instance = this.app.block.get();\n            // stack\n            var stack = this.app.popup.getStack();\n            var $body = stack.getBody();\n            // form item\n            var $item = this._createFormItem();\n            $item.addClass(this.prefix + \"-form-item-edit-image-box\");\n            // image\n            this.$imageclone = instance.getImage().clone();\n            this.$imageclone.removeAttr(\"width height style\");\n            var $imageitem = this.dom(\"<div>\").addClass(this.prefix + \"-form-item-image\");\n            $imageitem.append(this.$imageclone);\n            $item.append($imageitem);\n            // upload item\n            this.$upload = this.dom(\"<div>\");\n            $item.append(this.$upload);\n            // append to popup\n            $body.prepend($item);\n            // build upload\n            this._buildUpload(this.$upload, \"image.changeClone\");\n        },\n        _buildUpload: function($item, callback) {\n            if (!this.opts.image.upload) return;\n            var params = {\n                box: true,\n                placeholder: this.lang.get(\"image.upload-new-placeholder\"),\n                url: this.opts.image.upload,\n                name: this.opts.image.name,\n                data: this.opts.image.data,\n                multiple: this.opts.image.multiple,\n                success: callback,\n                error: \"image.error\"\n            };\n            this.app.create(\"upload\", $item, params);\n        },\n        _createSelectBox: function($body) {\n            this.createSelectBox(this.opts.image.select, $body, \"image.insertFromSelect\");\n        },\n        _createUploadBox: function($body) {\n            this.$upload = this.createUploadBox(this.opts.image.upload, $body);\n            this._buildUpload(this.$upload, \"image.insertByUpload\");\n        },\n        _createImageFromResponseItem: function(item) {\n            var $image = this.dom(\"<img>\").attr(\"src\", item.url).one(\"load\", this._checkImageLoad.bind(this));\n            var $item = $image;\n            var attrs = [\n                \"id\",\n                \"alt\",\n                \"width\",\n                \"height\"\n            ];\n            for(var i = 0; i < attrs.length; i++)if (Object.prototype.hasOwnProperty.call(item, attrs[i])) $item.attr(attrs[i], item[attrs[i]]);\n            // srcset & data-image\n            if (Object.prototype.hasOwnProperty.call(item, \"id\")) $item.attr(\"data-image\", item.id);\n            if (Object.prototype.hasOwnProperty.call(item, \"2x\")) $item.attr(\"srcset\", item[\"2x\"] + \" 2x\");\n            // link\n            if (Object.prototype.hasOwnProperty.call(item, \"link\")) {\n                var $link = this.dom(\"<a>\");\n                $link.attr(\"href\", item.link);\n                $image.wrap($link);\n                $item = $link;\n            }\n            return $item;\n        },\n        _createImagesBox: function($body) {\n            var $box = this.dom(\"<div>\").addClass(this.prefix + \"-popup-images-box\");\n            $body.append($box);\n            return $box;\n        },\n        _createOrSection: function($body) {\n            if (this.opts.image.url && (this.opts.image.upload || this.opts.image.select)) {\n                var $section = this.dom(\"<div>\").addClass(this.prefix + \"-popup-image-section-or\");\n                $section.html(this.lang.get(\"image.or\"));\n                $body.append($section);\n            }\n        },\n        _createImageByUrl: function($body) {\n            if (!this.opts.image.url) return;\n            var $item = this._createFormItem();\n            this.$urlinput = this._createUrlInput();\n            this.$urlbutton = this._createUrlButton();\n            $item.append(this.$urlinput);\n            $item.append(this.$urlbutton);\n            $body.append($item);\n        },\n        _createFormItem: function() {\n            return this.dom(\"<div>\").addClass(this.prefix + \"-form-container-flex\");\n        },\n        _createUrlInput: function() {\n            var $input = this.dom(\"<input>\").addClass(this.prefix + \"-form-input\");\n            $input.attr(\"placeholder\", this.lang.get(\"image.url-placeholder\"));\n            return $input;\n        },\n        _createUrlButton: function() {\n            var $button = this.dom(\"<button>\").addClass(this.prefix + \"-form-button \" + this.prefix + \"-form-button-primary\");\n            $button.html(this.lang.get(\"image.insert\"));\n            $button.one(\"click\", this.insertByUrl.bind(this));\n            return $button;\n        },\n        _parseList: function(data, callback) {\n            for(var key in data)if (data.hasOwnProperty(key)) {\n                var obj = data[key];\n                if (typeof obj !== \"object\") continue;\n                var $img = this.dom(\"<img>\");\n                var url = obj.thumb ? obj.thumb : obj.url;\n                $img.addClass(this.prefix + \"-popup-event\");\n                $img.attr(\"src\", url);\n                $img.attr(\"data-url\", obj.url);\n                $img.attr(\"data-callback\", callback);\n                var attrs = [\n                    \"id\",\n                    \"alt\",\n                    \"caption\",\n                    \"link\",\n                    \"width\",\n                    \"height\"\n                ];\n                for(var i = 0; i < attrs.length; i++)if (Object.prototype.hasOwnProperty.call(obj, attrs[i])) $img.attr(\"data-\" + attrs[i], obj[attrs[i]]);\n                $img.on(\"click.\" + this.prefix + \"-popup-event-\" + this.uuid, (function(e) {\n                    var $target = this.dom(e.target);\n                    var callback = $target.attr(\"data-callback\");\n                    this.app.api(callback, e);\n                }).bind(this));\n                this.$selectbox.append($img);\n            }\n        },\n        _dataURLtoFile: function(dataurl, filename) {\n            var arr = dataurl.split(\",\"), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n            while(n--)u8arr[n] = bstr.charCodeAt(n);\n            return new File([\n                u8arr\n            ], filename, {\n                type: mime\n            });\n        }\n    });\n    ArticleEditor.add(\"module\", \"table\", {\n        popups: {\n            cell: {\n                title: \"## table.table-cell ##\",\n                width: \"300px\",\n                form: {\n                    width: {\n                        type: \"input\",\n                        label: \"## table.width ##\"\n                    },\n                    nowrap: {\n                        type: \"checkbox\",\n                        text: \"## table.nowrap ##\"\n                    }\n                },\n                footer: {\n                    insert: {\n                        title: \"## table.save ##\",\n                        command: \"table.save\",\n                        type: \"primary\"\n                    },\n                    cancel: {\n                        title: \"## table.cancel ##\",\n                        command: \"popup.close\"\n                    }\n                }\n            }\n        },\n        items: {\n            table: {\n                addhead: {\n                    title: \"## table.add-head ##\",\n                    command: \"table.addHead\"\n                },\n                removehead: {\n                    title: \"## table.remove-head ##\",\n                    command: \"table.removeHead\"\n                }\n            },\n            row: {\n                addrowbelow: {\n                    title: \"## table.add-row-below ##\",\n                    command: \"table.addRowBelow\"\n                },\n                addrowabove: {\n                    title: \"## table.add-row-above ##\",\n                    command: \"table.addRowAbove\"\n                },\n                removerow: {\n                    title: \"## table.remove-row ##\",\n                    command: \"table.removeRow\"\n                }\n            },\n            cell: {\n                addcolumnafter: {\n                    title: \"## table.add-column-after ##\",\n                    command: \"table.addColumnAfter\"\n                },\n                addcolumnbefore: {\n                    title: \"## table.add-column-before ##\",\n                    command: \"table.addColumnBefore\"\n                },\n                addrowbelow: {\n                    title: \"## table.add-row-below ##\",\n                    command: \"table.addRowBelow\"\n                },\n                addrowabove: {\n                    title: \"## table.add-row-above ##\",\n                    command: \"table.addRowAbove\"\n                },\n                removecolumn: {\n                    title: \"## table.remove-column ##\",\n                    command: \"table.removeColumn\"\n                },\n                removerow: {\n                    title: \"## table.remove-row ##\",\n                    command: \"table.removeRow\"\n                }\n            }\n        },\n        add: function() {\n            // add\n            var instance = this.app.block.add({\n                name: \"table\",\n                source: this.opts.table.template,\n                caret: false\n            });\n            // focus\n            var cell = instance.getFirstCell();\n            if (cell) this.app.block.set(cell, \"start\");\n        },\n        observe: function(obj, name, stack) {\n            if (!this.opts.table) return false;\n            var instance = this.app.block.get();\n            if (stack && stack.getName() === \"addbar\") obj.command = \"table.add\";\n            else if (instance && instance.isType([\n                \"table\",\n                \"row\",\n                \"cell\"\n            ])) obj.command = \"table.popup\";\n            return obj;\n        },\n        popup: function(params, button) {\n            var instance = this.app.block.get();\n            var type = instance.getType();\n            this.app.popup.create(\"table\", {\n                items: this.items[type]\n            });\n            // open\n            this.app.popup.open({\n                button: button\n            });\n        },\n        addHead: function() {\n            this.removeHead();\n            var instance = this.app.block.get();\n            var $block = instance.getBlock();\n            var columns = $block.find(\"tr\").first().children(\"td, th\").length;\n            var $head = this.dom(\"<thead>\");\n            var $row = this._buildRow(columns, \"<th>\");\n            $head.append($row);\n            $block.prepend($head);\n            // set\n            this.app.block.set($row.children(\"td, th\").first(), \"start\");\n        },\n        addRowBelow: function() {\n            this._addRow(\"below\");\n        },\n        addRowAbove: function() {\n            this._addRow(\"above\");\n        },\n        addColumnBefore: function() {\n            this._addColumn(\"before\");\n        },\n        addColumnAfter: function() {\n            this._addColumn(\"after\");\n        },\n        removeHead: function() {\n            this.app.popup.close();\n            var instance = this.app.block.get();\n            var $block = instance.getBlock();\n            var $head = $block.find(\"thead\");\n            if ($head.length !== 0) $head.remove();\n        },\n        removeRow: function() {\n            this.app.popup.close();\n            this.app.control.close();\n            var instance = this.app.block.get();\n            if (instance.getType() === \"cell\") instance = instance.getParent([\n                \"row\"\n            ]);\n            instance.remove(true);\n        },\n        removeColumn: function() {\n            this.app.popup.close();\n            this.app.control.close();\n            var instance = this.app.block.get();\n            var $block = instance.getBlock();\n            var $table = $block.closest(\"table\");\n            var $row = $block.closest(\"tr\");\n            var index = 0;\n            $row.find(\"td, th\").each(function($node, i) {\n                if ($node.get() === $block.get()) index = i;\n            });\n            $table.find(\"tr\").each((function($node) {\n                var cell = $node.find(\"td, th\").get(index);\n                var $cell = this.dom(cell);\n                $cell.remove();\n            }).bind(this));\n        },\n        cellSetting: function(params, button) {\n            var instance = this.app.block.get();\n            var popup = this.app.popup.create(\"cell\", this.popups.cell);\n            // data\n            popup.setData({\n                width: instance.getWidth(),\n                nowrap: instance.getNowrap()\n            });\n            // open\n            this.app.popup.open({\n                button: button,\n                focus: \"width\"\n            });\n        },\n        save: function(stack) {\n            // popup close\n            this.app.popup.close();\n            // data\n            var data = stack.getData();\n            var instance = this.app.block.get();\n            if (data.width !== \"\") instance.setWidth(data.width);\n            instance.setNowrap(data.nowrap);\n        },\n        // private\n        _addColumn: function(name) {\n            this.app.popup.close();\n            var instance = this.app.block.get();\n            var $block = instance.getBlock();\n            var $table = $block.closest(\"table\");\n            var $row = $block.closest(\"tr\");\n            var index = 0;\n            $row.find(\"td, th\").each(function($node, i) {\n                if ($node.get() === $block.get()) index = i;\n            });\n            var rowIndex = 0;\n            $table.find(\"tr\").each(function($node, i) {\n                if ($node.get() === $row.get()) rowIndex = i;\n            });\n            var $newCell;\n            $table.find(\"tr\").each((function($node, i) {\n                var cell = $node.find(\"td, th\").get(index);\n                var $cell = this.dom(cell);\n                var $td = $cell.clone();\n                $td.html(\"\");\n                // create instance\n                this.app.create(\"block.cell\", $td);\n                if (rowIndex === i) $newCell = $td;\n                // after / before\n                $cell[name]($td);\n            }).bind(this));\n            // set focus\n            if ($newCell) this.app.block.set($newCell, \"start\");\n        },\n        _addRow: function(name) {\n            this.app.popup.close();\n            var position = name === \"below\" ? \"after\" : \"before\";\n            var instance = this.app.block.get();\n            var $block = instance.getBlock();\n            var $row = $block.closest(\"tr\");\n            var $head = $block.closest(\"thead\");\n            var columns = $row.children(\"td, th\").length;\n            var $newRow = this._buildRow(columns, \"<td>\");\n            if ($head.length !== 0) $head.after($newRow);\n            else $row[position]($newRow);\n            // set focus\n            this.app.block.set($newRow.find(\"td, th\").first(), \"start\");\n        },\n        _buildRow: function(columns, tag) {\n            var $row = this.dom(\"<tr>\");\n            // create instance\n            this.app.create(\"block.row\", $row);\n            for(var i = 0; i < columns; i++){\n                var $cell = this.dom(tag);\n                // create instance\n                this.app.create(\"block.cell\", $cell);\n                // append\n                $row.append($cell);\n            }\n            return $row;\n        }\n    });\n    ArticleEditor.add(\"module\", \"snippet\", {\n        popups: {\n            base: {\n                title: \"## popup.snippets ##\",\n                width: \"100%\"\n            }\n        },\n        init: function() {\n            this.json = {};\n        },\n        observe: function() {\n            if (!this.opts.snippets) return false;\n        },\n        popup: function() {\n            var stack = this.app.popup.add(\"snippets\", this.popups.base);\n            // data\n            var $body = stack.getBody();\n            // json url\n            if (typeof this.opts.snippets === \"string\") {\n                var getdata = this.opts.editor.reloadmarker ? {\n                    d: new Date().getTime()\n                } : {};\n                this.ajax.get({\n                    url: this.opts.snippets,\n                    data: getdata,\n                    success: (function(data) {\n                        this._buildPopup(data, $body);\n                    }).bind(this)\n                });\n            } else this._buildPopup(this.opts.snippets, $body);\n            // open\n            stack.open();\n        },\n        insert: function(e) {\n            var $trigger = this.dom(e.target).closest(\".\" + this.prefix + \"-snippet-container\");\n            var key = $trigger.attr(\"data-snippet-key\");\n            if (Object.prototype.hasOwnProperty.call(this.json, key)) {\n                this.app.popup.close();\n                var html = this.json[key].html;\n                this.app.editor.insertContent({\n                    html: html,\n                    caret: \"start\"\n                });\n            }\n        },\n        // private\n        _buildPopup: function(data, $body) {\n            this.json = data;\n            if (typeof data === \"string\") this.json = JSON.parse(data);\n            Object.keys(this.json).forEach((function(key) {\n                var $container = this._buildPreviewContainer($body, key);\n                // preview\n                this._buildPreview($container, key);\n                this._buildPreviewName($container, key);\n            }).bind(this));\n        },\n        _buildPreviewContainer: function($body, key) {\n            var $div = this.dom(\"<div>\").addClass(this.prefix + \"-snippet-container\");\n            $div.attr(\"data-snippet-key\", key);\n            $div.one(\"click\", this.insert.bind(this));\n            // append\n            $body.append($div);\n            return $div;\n        },\n        _buildPreview: function($container, key) {\n            var $div = this.dom(\"<div>\");\n            if (Object.prototype.hasOwnProperty.call(this.json[key], \"image\")) {\n                $div.addClass(this.prefix + \"-snippet-image\");\n                var $img = this.dom(\"<img>\").attr(\"src\", this.json[key].image);\n                $div.html($img);\n            } else {\n                $div.addClass(this.prefix + \"-snippet-preview\");\n                $div.html(this.json[key].html);\n            }\n            $container.append($div);\n        },\n        _buildPreviewName: function($container, key) {\n            if (!Object.prototype.hasOwnProperty.call(this.json[key], \"name\")) return;\n            var $span = this.dom(\"<div>\").addClass(this.prefix + \"-snippet-name\");\n            $span.text(this.json[key].name);\n            $container.append($span);\n        }\n    });\n    ArticleEditor.add(\"module\", \"template\", {\n        popups: {\n            base: {\n                title: \"## templates.templates ##\",\n                width: \"100%\"\n            }\n        },\n        init: function() {\n            this.json = {};\n        },\n        observe: function() {\n            if (!this.opts.templates) return false;\n        },\n        popup: function(params, button) {\n            // json url\n            if (typeof this.opts.templates === \"string\") {\n                var getdata = this.opts.editor.reloadmarker ? {\n                    d: new Date().getTime()\n                } : {};\n                this.ajax.get({\n                    url: this.opts.templates,\n                    data: getdata,\n                    success: (function(data) {\n                        this._buildPopup(button, data);\n                    }).bind(this)\n                });\n            } else this._buildPopup(button, this.opts.templates);\n        },\n        insert: function(e) {\n            var $trigger = this.dom(e.target).closest(\".\" + this.prefix + \"-template-container\");\n            var key = $trigger.attr(\"data-template-key\");\n            if (Object.prototype.hasOwnProperty.call(this.json, key)) {\n                this.app.popup.close();\n                var html = this.json[key].html;\n                this.app.editor.setContent({\n                    html: html,\n                    caret: false\n                });\n            }\n        },\n        // private\n        _buildPopup: function(button, data) {\n            // popup\n            var popup = this.app.popup.create(\"templates\", this.popups.base);\n            var $body = popup.getBody();\n            // json\n            this.json = typeof data === \"string\" ? JSON.parse(data) : data;\n            // items\n            Object.keys(this.json).forEach((function(key) {\n                var $container = this._buildPreviewContainer($body, key);\n                // preview\n                this._buildPreview($container, key);\n                this._buildPreviewName($container, key);\n            }).bind(this));\n            // open\n            this.app.popup.open({\n                button: button\n            });\n        },\n        _buildPreviewContainer: function($body, key) {\n            var $div = this.dom(\"<div>\").addClass(this.prefix + \"-template-container\");\n            $div.attr(\"data-template-key\", key);\n            $div.one(\"click\", this.insert.bind(this));\n            // append\n            $body.append($div);\n            return $div;\n        },\n        _buildPreview: function($container, key) {\n            var $div = this.dom(\"<div>\");\n            if (Object.prototype.hasOwnProperty.call(this.json[key], \"image\")) {\n                $div.addClass(this.prefix + \"-template-image\");\n                var $img = this.dom(\"<img>\").attr(\"src\", this.json[key].image);\n                $div.html($img);\n            } else {\n                $div.addClass(this.prefix + \"-template-preview\");\n                $div.html(this.json[key].html);\n            }\n            $container.append($div);\n        },\n        _buildPreviewName: function($container, key) {\n            if (!Object.prototype.hasOwnProperty.call(this.json[key], \"name\")) return;\n            var $span = this.dom(\"<div>\").addClass(this.prefix + \"-template-name\");\n            $span.text(this.json[key].name);\n            $container.append($span);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.checkbox\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"checkbox\",\n        input: {\n            tag: \"input\",\n            type: \"checkbox\",\n            classname: \"-form-checkbox\"\n        },\n        getValue: function() {\n            return this.$input.val();\n        },\n        // private\n        _buildInput: function() {\n            this.$box = this.dom(\"<label>\").addClass(this.prefix + \"-form-checkbox-item\");\n            this.$box.append(this.$input);\n            // checkbox text\n            if (this._has(\"text\")) {\n                var $span = this.dom(\"<span>\").html(this.lang.parse(this.obj.text));\n                this.$box.append($span);\n            }\n            this.$tool.append(this.$box);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.input\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"input\",\n        input: {\n            tag: \"input\",\n            type: \"text\",\n            classname: \"-form-input\"\n        },\n        // private\n        _buildInput: function() {\n            this.$tool.append(this.$input);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.number\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"number\",\n        input: {\n            tag: \"input\",\n            type: \"number\",\n            classname: \"-form-input\"\n        },\n        // private\n        _buildInput: function() {\n            this.$input.attr(\"min\", 0).css(\"max-width\", \"65px\");\n            this.$tool.append(this.$input);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.segment\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"segment\",\n        input: {\n            tag: \"input\",\n            type: \"hidden\",\n            classname: \"-form-input\"\n        },\n        setValue: function(value) {\n            this.$segment.find(\".\" + this.prefix + \"-form-segment-item\").removeClass(\"active\");\n            this.$segment.find(\"[data-segment=\" + value + \"]\").addClass(\"active\");\n            this.$input.val(value);\n        },\n        // private\n        _buildInput: function() {\n            this.$segment = this.dom(\"<div>\").addClass(this.prefix + \"-form-segment\");\n            var segments = this.obj.segments;\n            for(var name in segments)if (segments.hasOwnProperty(name)) {\n                var $segment = this.dom(\"<span>\").addClass(this.prefix + \"-form-segment-item\");\n                $segment.attr(\"data-segment\", name).on(\"click\", this._catchSegment.bind(this));\n                if (Object.prototype.hasOwnProperty.call(segments[name], \"icon\")) $segment.html(segments[name].icon);\n                else $segment.addClass(this.prefix + \"-icon-\" + segments[name].prefix + \"-\" + name);\n                this.$segment.append($segment);\n            }\n            this.$segment.append(this.$input);\n            this.$tool.append(this.$segment);\n        },\n        _catchSegment: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var $item = this.dom(e.target).closest(\".\" + this.prefix + \"-form-segment-item\");\n            var value = $item.attr(\"data-segment\");\n            this.$segment.find(\".\" + this.prefix + \"-form-segment-item\").removeClass(\"active\");\n            $item.addClass(\"active\");\n            this.$input.val(value);\n            // call setter\n            this.app.api(this.setter, this.popup);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.select\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"select\",\n        input: {\n            tag: \"select\",\n            classname: \"-form-select\"\n        },\n        // private\n        _buildInput: function() {\n            for(var value in this.obj.options)if (this.obj.options.hasOwnProperty(value)) {\n                var $option = this.dom(\"<option>\");\n                $option.val(value);\n                $option.html(this.lang.parse(this.obj.options[value]));\n                this.$input.append($option);\n            }\n            this.$tool.append(this.$input);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.textarea\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"textarea\",\n        input: {\n            tag: \"textarea\",\n            classname: \"-form-textarea\"\n        },\n        setFocus: function() {\n            this.$input.focus();\n            this.$input.get().setSelectionRange(0, 0);\n            this.$input.scrollTop(0);\n        },\n        // private\n        _buildInput: function() {\n            if (this._has(\"rows\")) this.$input.attr(\"rows\", this._get(\"rows\"));\n            this.$input.attr(\"data-gramm_editor\", false);\n            this.$tool.append(this.$input);\n        }\n    });\n    ArticleEditor.add(\"class\", \"tool.upload\", {\n        mixins: [\n            \"tool\"\n        ],\n        type: \"upload\",\n        input: {\n            tag: \"input\",\n            type: \"hidden\",\n            classname: \"-form-input\"\n        },\n        setValue: function(value) {\n            value = value ? value : \"\";\n            if (this.upload) this.upload.setImage(value);\n            this.$input.val(value);\n        },\n        // private\n        _buildInput: function() {\n            // input\n            this.$tool.append(this.$input);\n            this._buildUpload();\n        },\n        _buildUpload: function() {\n            this.$upload = this.dom(\"<input>\").attr(\"type\", \"file\");\n            this.$tool.append(this.$upload);\n            // tool trigger method\n            var trigger = {};\n            if (this._has(\"trigger\") && this._get(\"trigger\")) trigger = {\n                instance: this,\n                method: \"trigger\"\n            };\n            // create upload\n            this.upload = this.app.create(\"upload\", this.$upload, this.obj.upload, trigger);\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.paragraph\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"paragraph\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"format\": {\n                title: \"## buttons.format ##\",\n                command: \"format.popup\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<p>\");\n        },\n        // handle\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            // empty or end\n            if (this.isEmpty() || this.isCaretEnd()) {\n                var clone = this.app.block.create();\n                // clone paragraph styles\n                if (!this.opts.clean.enter) {\n                    clone = this.duplicateEmpty();\n                    // remove id attr\n                    clone.getBlock().removeAttr(\"id\");\n                }\n                if (!this.opts.clean.enterinline) {\n                    // clone inline\n                    var inline = this.app.selection.getInline();\n                    if (inline) {\n                        var cloned;\n                        var inlines = this.app.element.getAllInlines(inline);\n                        for(var i = 0; i < inlines.length; i++){\n                            if (inlines[i].tagName === \"A\") continue;\n                            if (i === 0) {\n                                cloned = inlines[i].cloneNode();\n                                cloned.removeAttribute(\"id\");\n                                cloned.innerHTML = \"\";\n                            } else {\n                                var clonedInline = inlines[i].cloneNode();\n                                clonedInline.removeAttribute(\"id\");\n                                clonedInline.innerHTML = \"\";\n                                cloned.appendChild(clonedInline);\n                            }\n                        }\n                        if (cloned) clone = this.app.block.create(cloned.outerHTML);\n                    }\n                }\n                // fix editor body height (paragraph margin)\n                if (clone.isEmpty()) clone.getBlock().html(this.app.utils.createInvisibleChar());\n                this.insert({\n                    instance: clone,\n                    position: \"after\",\n                    caret: \"start\",\n                    remove: false\n                });\n            } else if (this.isCaretStart()) this.insert({\n                instance: this.duplicateEmpty(),\n                position: \"before\"\n            });\n            else {\n                var $block = this.getBlock();\n                var $part = this.app.element.split($block);\n                this.app.block.set($part, \"start\");\n            }\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.text\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"text\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"format\": {\n                title: \"## buttons.format ##\",\n                command: \"format.popup\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<div>\").addClass(this.opts.text.classname);\n        },\n        // handle\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            this.app.insertion.insertBreakline();\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.address\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"address\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"format\": {\n                title: \"## buttons.format ##\",\n                command: \"format.popup\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<address>\");\n        },\n        // handle\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            // empty or end  check address exit\n            if (this.isEmpty() || this.isCaretEnd()) {\n                var $block = this.getBlock();\n                var $nodes = $block.children();\n                var len = $nodes.length;\n                var $last = $nodes.eq(len - 1);\n                var $lastPrev = $nodes.eq(len - 2);\n                var html = $block.html().trim();\n                html = this.app.utils.removeInvisibleChars(html);\n                if (html.search(/<br\\s?\\/?>$/) !== -1) {\n                    // remove empty\n                    $lastPrev.remove();\n                    $last.remove();\n                    // insert\n                    this.insertEmpty({\n                        position: \"after\",\n                        caret: \"start\"\n                    });\n                    return;\n                }\n            }\n            // insert br\n            this.app.insertion.insertBreakline();\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.cell\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"cell\",\n        editable: true,\n        toolbar: {\n            \"table\": {\n                title: \"## blocks.table ##\",\n                command: \"table.add\",\n                observer: \"table.observe\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            },\n            \"tune\": {\n                command: \"table.cellSetting\",\n                title: \"## buttons.settings ##\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<td>\");\n        },\n        getNextCell: function() {\n            var cell = this.getNext();\n            if (!cell) {\n                var row = this.getParent(\"row\");\n                if (row) {\n                    var nextRow = row.getNextRow();\n                    if (nextRow) cell = nextRow.getChildFirst(\"cell\");\n                }\n            }\n            return cell;\n        },\n        getPrevCell: function() {\n            var cell = this.getPrev();\n            if (!cell) {\n                var row = this.getParent(\"row\");\n                if (row) {\n                    var prevRow = row.getPrevRow();\n                    if (prevRow) cell = prevRow.getChildLast(\"cell\");\n                }\n            }\n            return cell;\n        },\n        getWidth: function() {\n            var value = this.$block.attr(\"width\");\n            return value ? value : \"\";\n        },\n        getNowrap: function() {\n            var value = this.$block.css(\"white-space\");\n            return value === \"nowrap\";\n        },\n        setWidth: function(value) {\n            this._eachCell(function($cell) {\n                if (value === \"\") $cell.removeAttr(\"width\");\n                else {\n                    value = value.search(\"%\") !== -1 ? value : value.replace(\"px\", \"\");\n                    $cell.attr(\"width\", value);\n                }\n            });\n        },\n        setNowrap: function(value) {\n            this._eachCell(function($cell) {\n                value = value ? \"nowrap\" : \"\";\n                $cell.css(\"white-space\", value);\n            });\n        },\n        // handle\n        handleArrow: function(e, key, event) {\n            var parentInstance;\n            if (event.is(\"up-left\") && this.isCaretStart()) {\n                e.preventDefault();\n                var prev = this.getPrevCell();\n                if (prev) this.app.block.set(prev, \"end\");\n                else {\n                    parentInstance = this.getParent(\"table\");\n                    this.app.block.set(parentInstance);\n                }\n                return true;\n            } else if (event.is(\"down-right\") && this.isCaretEnd()) {\n                e.preventDefault();\n                var next = this.getNextCell();\n                if (next) this.app.block.set(next, \"start\");\n                else {\n                    parentInstance = this.getParent(\"table\");\n                    this.app.block.set(parentInstance);\n                }\n                return true;\n            }\n        },\n        handleTab: function(e, key, event) {\n            e.preventDefault();\n            var next = this.getNextCell();\n            if (next) this.app.block.set(next, \"start\");\n            else {\n                var parentInstance = this.getParent(\"table\");\n                this.app.block.set(parentInstance);\n            }\n            return true;\n        },\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            this.app.insertion.insertBreakline();\n            return true;\n        },\n        // private\n        _eachCell: function(func) {\n            var index = 0;\n            var $table = this.$block.closest(\"table\");\n            // index\n            this.$block.closest(\"tr\").find(\"td, th\").each((function($node, i) {\n                if ($node.get() === this.$block.get()) index = i;\n            }).bind(this));\n            $table.find(\"tr\").each((function($node) {\n                var cell = $node.find(\"td, th\").get(index);\n                var $cell = this.dom(cell);\n                func($cell);\n            //content.cacheBlocksStyle($cell);\n            }).bind(this));\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.code\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"code\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(this.opts.code.template);\n        },\n        build: function() {\n            this._buildCaption();\n            this._buildItems(\"figcaption\", \"figcaption\");\n        },\n        // handle\n        handleArrow: function(e, key, event) {\n            if (event.is(\"down-right\") && this.isCaretEnd()) {\n                var next = this.getNext();\n                if (next) {\n                    this.app.block.set(next, \"start\");\n                    return true;\n                } else {\n                    this.app.insertion.insertEmptyBlock({\n                        position: \"after\",\n                        caret: \"start\"\n                    });\n                    return true;\n                }\n            }\n        },\n        handleTab: function(e, key, event) {\n            e.preventDefault();\n            var num = this.opts.code.spaces;\n            var node = document.createTextNode(Array(num + 1).join(\" \"));\n            this.app.insertion.insertNode(node, \"end\");\n            return true;\n        },\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            var last = this.$block.html().search(/\\n$/);\n            if (this.isCaretEnd() && last === -1) this.app.insertion.insertNewline(\"after\", true);\n            else this.app.insertion.insertNewline();\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.column\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"column\",\n        nested: true,\n        emptiable: true,\n        toolbar: {\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<div>\");\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.dlist\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"dlist\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"format\": {\n                title: \"## buttons.format ##\",\n                command: \"format.popup\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<dl>\");\n        },\n        getPlainText: function(keepbr) {\n            var html = \"\";\n            var $items = this.$block.find(\"dt, dd\");\n            var len = $items.length;\n            $items.each(function($node, i) {\n                var br = keepbr ? \"<br>\" : \"\";\n                if (i === len) br = \"\";\n                html += $node.html() + br;\n            });\n            return html;\n        },\n        setEmpty: function() {\n            this.$block.html(\"\");\n            var $item = this.dom(\"<dt>\");\n            this.$block.append($item);\n            this.app.caret.set($item, \"start\");\n        },\n        isEmpty: function() {\n            var html = this.$block.html();\n            html = this._cleanEmpty(html);\n            var $items = this.$block.find(\"dt, dd\");\n            if ($items.length === 0) {\n                html = html.trim();\n                return html === \"\";\n            } else if ($items.length === 1) {\n                html = $items.eq(0).html();\n                html = this._cleanEmpty(html);\n                return html === \"\";\n            }\n            return false;\n        },\n        // handle\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            // empty or end\n            if (this.isEmpty() || this.isCaretEnd()) {\n                var currentItem = this.app.selection.getBlock();\n                var $currentItem = this.dom(currentItem);\n                var tag = currentItem.tagName.toLowerCase();\n                var isItemEmpty = this.app.content.isEmptyHtml(currentItem.innerHTML);\n                if (tag === \"dt\" && isItemEmpty) {\n                    // remove empty\n                    $currentItem.remove();\n                    // insert\n                    this.insertEmpty({\n                        position: \"after\",\n                        caret: \"start\"\n                    });\n                    return true;\n                }\n                // insert dt or dd\n                var $newItem;\n                if (tag === \"dt\") $newItem = this.dom(\"<dd>\");\n                else $newItem = this.dom(\"<dt>\");\n                this.dom(currentItem).after($newItem);\n                this.app.caret.set($newItem, \"start\");\n            } else if (this.isCaretStart()) return true;\n            else this.app.insertion.insertBreakline();\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.embed\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"embed\",\n        parser: {\n            unparse: function($node) {\n                var code = decodeURI($node.attr(\"data-embed-code\"));\n                var classes = this.opts.embed.responsive.split(\" \").join(\".\");\n                var $responsive = $node.find(\".\" + classes);\n                var $el = $node.find(\"figcaption\");\n                var $figcaption;\n                if ($el.length !== 0) {\n                    $figcaption = $el.clone();\n                    $el.remove();\n                }\n                if ($responsive.length === 0) $node.html(code);\n                else $responsive.html(code);\n                if ($figcaption) $node.append($figcaption);\n                $node.removeAttr(\"data-embed-code data-arx-type\");\n                if ($node.get().attributes.length === 0 && $node.find(\"figcaption\").length === 0 && $node.find(\"div\").length === 0) $node.unwrap();\n            }\n        },\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"outset\": {\n                title: \"## buttons.outset ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"embed\": {\n                title: \"## blocks.embed ##\",\n                command: \"embed.popup\",\n                observer: \"embed.observe\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<figure>\");\n        },\n        build: function() {\n            this._buildCaption();\n            this._buildItems(\"figcaption\", \"figcaption\");\n            this._buildEmbedCode();\n        },\n        addResponsive: function() {\n            var $responsive = this.dom(\"<div>\").addClass(this.opts.embed.responsive);\n            var $figcaption = this.$block.find(\"figcaption\");\n            var $cloneFigcaption = $figcaption.clone();\n            var html = this.getEmbedCode();\n            $figcaption.remove();\n            $responsive.html(html);\n            this.$block.html(\"\").append($responsive);\n            if ($cloneFigcaption.length !== 0) {\n                this.app.create(\"block.figcaption\", $cloneFigcaption);\n                this.$block.append($cloneFigcaption);\n            }\n            this._buildEmbedCode();\n        },\n        removeResponsive: function() {\n            this.$block.find(this._getEmbedClass()).unwrap();\n        },\n        getEmbedCode: function() {\n            return decodeURI(this.$block.attr(\"data-embed-code\"));\n        },\n        isResponsive: function() {\n            return this.$block.find(this._getEmbedClass()).length !== 0;\n        },\n        // private\n        _buildEmbedCode: function() {\n            var $clone = this.$block.clone();\n            $clone.find(this._getEmbedClass()).unwrap();\n            $clone.find(\"figcaption\").remove();\n            var code = $clone.html().trim();\n            this.$block.attr(\"data-embed-code\", encodeURI(code));\n        },\n        _getEmbedClass: function() {\n            return \".\" + this.opts.embed.responsive.replace(/ +/g, \".\");\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.figcaption\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"figcaption\",\n        editable: true,\n        toolbar: {\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<figcaption>\");\n        },\n        getFigure: function() {\n            return this.$block.closest(\"figure\").dataget(\"instance\");\n        },\n        // handle\n        handleArrow: function(e, key, event) {\n            if (event.is(\"up-left\") && this.isCaretStart() || event.is(\"down-right\") && this.isCaretEnd()) {\n                e.preventDefault();\n                var parentInstance = this.getFigure();\n                this.app.block.set(parentInstance);\n                return true;\n            }\n        },\n        handleTab: function(e, key, event) {\n            e.preventDefault();\n            var parentInstance = this.getFigure();\n            this.app.block.set(parentInstance);\n            return true;\n        },\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            // empty or end\n            if (this.isEmpty() || this.isCaretEnd() || this.isCaretStart()) return true;\n            else this.app.insertion.insertBreakline();\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.grid\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"grid\",\n        nested: true,\n        parser: {\n            unparse: function($node) {\n                $node.removeClass(this.prefix + \"-grid-overlay\");\n            }\n        },\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"valign\": {\n                title: \"## buttons.valign ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            var $block = this.dom(\"<div>\").addClass(this.opts.grid.classname);\n            if (this.opts.grid.classes !== \"\") $block.addClass(this.opts.grid.classes);\n            return $block;\n        },\n        build: function() {\n            this._buildOverlay();\n        },\n        // privae\n        _buildOverlay: function() {\n            if (this.opts.grid && this.opts.grid.overlay) this.$block.addClass(this.prefix + \"-grid-overlay\");\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.heading\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"heading\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"format\": {\n                title: \"## buttons.format ##\",\n                command: \"format.popup\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<h2>\");\n        },\n        getTitle: function() {\n            var titles = this.lang.get(\"headings\");\n            var tag = this.getTag();\n            var title = this.$block.attr(\"data-title\");\n            return typeof titles[tag] !== \"undefined\" ? titles[tag] : title;\n        },\n        // handle\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            // empty or end\n            if (this.isEmpty() || this.isCaretEnd()) this.insertEmpty({\n                position: \"after\",\n                caret: \"start\",\n                remove: false\n            });\n            else if (this.isCaretStart()) this.insert({\n                instance: this.duplicateEmpty(),\n                position: \"before\"\n            });\n            else {\n                var $block = this.getBlock();\n                var $part = this.app.element.split($block);\n                this.app.block.set($part, \"start\");\n            }\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.image\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"image\",\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"outset\": {\n                title: \"## buttons.outset ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"image\": {\n                title: \"## blocks.image ##\",\n                command: \"image.popup\",\n                observer: \"image.observe\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<\" + this.opts.image.tag + \">\");\n        },\n        build: function() {\n            this._buildCaption();\n            this._buildItems(\"figcaption\", \"figcaption\");\n            this.data = {\n                \"alt\": {\n                    getter: \"getAlt\",\n                    setter: \"setAlt\"\n                },\n                \"width\": {\n                    getter: \"getWidth\",\n                    setter: \"setWidth\"\n                },\n                \"link\": {\n                    getter: \"getLinkUrl\",\n                    setter: \"setLinkUrl\"\n                },\n                \"target\": {\n                    getter: \"getTarget\",\n                    setter: \"setTarget\"\n                },\n                \"caption\": {\n                    getter: \"getCaption\",\n                    setter: \"setCaption\"\n                }\n            };\n        },\n        getImage: function() {\n            return this.$block.find(\"img\").eq(0);\n        },\n        getSrc: function() {\n            var $img = this.getImage();\n            return $img.attr(\"src\");\n        },\n        getId: function() {\n            var $img = this.getImage();\n            return $img.attr(\"data-image\");\n        },\n        getLink: function() {\n            var $link = this.getImage().parent();\n            $link = $link.get().tagName !== \"A\" ? false : $link;\n            return $link;\n        },\n        getWidth: function() {\n            var $img = this.getImage();\n            var width = $img.css(\"width\");\n            var value = $img.attr(\"width\");\n            if (value && value.search(/%/) !== -1) width = value;\n            return width;\n        },\n        getAlt: function() {\n            var $img = this.getImage();\n            var alt = $img.attr(\"alt\");\n            return alt ? alt : \"\";\n        },\n        getLinkUrl: function() {\n            var $link = this.getLink();\n            return $link ? $link.attr(\"href\") : \"\";\n        },\n        getTarget: function() {\n            var $link = this.getLink();\n            return $link ? $link.attr(\"target\") : this.opts.image.newtab;\n        },\n        setWidth: function(value) {\n            var $img = this.getImage();\n            value = value.trim();\n            if (value === \"\") $img.removeAttr(\"width\");\n            else {\n                var percent = value.search(/%/) !== -1;\n                var width = percent ? value : parseInt(value);\n                var ratio = $img.width() / $img.height();\n                if (percent) {\n                    $img.removeAttr(\"height\");\n                    $img.attr({\n                        \"width\": width\n                    });\n                } else {\n                    var height = Math.round(width / ratio);\n                    $img.attr({\n                        \"width\": width,\n                        \"height\": height\n                    });\n                }\n            }\n            $img.css({\n                \"width\": value,\n                \"max-width\": value\n            });\n            // broadcast\n            this.app.broadcast(\"image.width\", {\n                image: $img,\n                width: value\n            });\n        },\n        setAlt: function(value) {\n            var $img = this.getImage();\n            value = value.replace(/\"/g, \"'\");\n            $img.attr(\"alt\", value);\n        },\n        setTarget: function(value) {\n            var $link = this.getLink();\n            if (!$link) return;\n            if (value) $link.attr(\"target\", \"_blank\");\n            else $link.removeAttr(\"target\");\n        },\n        setLinkUrl: function(value) {\n            var $link = this.getLink();\n            if ($link) {\n                if (value !== \"\") $link.attr(\"href\", value);\n                else {\n                    this.removeLink();\n                    // broadcast\n                    this.app.broadcast(\"image.unlink\", {\n                        instance: this\n                    });\n                    return;\n                }\n            } else if (!$link) {\n                if (value !== \"\") {\n                    var $img = this.getImage();\n                    $link = this.dom(\"<a>\");\n                    $img.wrap($link);\n                    $link.attr(\"href\", value);\n                } else return;\n            }\n            // broadcast\n            this.app.broadcast(\"image.link\", {\n                instance: this,\n                link: $link\n            });\n        },\n        setImage: function(data) {\n            var $img = this.getImage();\n            $img.attr(\"src\", data.url);\n            if (Object.prototype.hasOwnProperty.call(data, \"id\")) $img.attr(\"data-image\", data.id);\n            if (Object.prototype.hasOwnProperty.call(data, \"2x\")) $img.attr(\"srcset\", data[\"2x\"] + \" 2x\");\n            $img.one(\"load\", this.app.editor.adjustHeight.bind(this.app.editor));\n        },\n        removeLink: function() {\n            var $link = this.getLink();\n            if ($link) $link.unwrap();\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.layer\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"layer\",\n        nested: true,\n        emptiable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(this.opts.layer.template);\n        },\n        getTitle: function() {\n            var title = this.$block.attr(\"data-title\");\n            return title || this._getNameByTag();\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.line\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"line\",\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<hr>\");\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.list\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"list\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"format\": {\n                title: \"## buttons.format ##\",\n                command: \"format.popup\"\n            },\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"outdent\": {\n                title: \"## buttons.outdent ##\",\n                command: \"list.outdent\"\n            },\n            \"indent\": {\n                title: \"## buttons.indent ##\",\n                command: \"list.indent\"\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<ul>\");\n        },\n        unparse: function($el) {\n            this.app.content.unfixListMargin($el);\n        },\n        setEmpty: function() {\n            this.$block.html(\"\");\n            var $item = this.dom(\"<li>\");\n            this.$block.append($item);\n            this.app.caret.set($item, \"start\");\n        },\n        isEmpty: function() {\n            var html = this.$block.html();\n            html = this._cleanEmpty(html);\n            var $items = this.$block.find(\"li\");\n            if ($items.length === 0) {\n                html = html.trim();\n                return html === \"\";\n            } else if ($items.length === 1) {\n                html = $items.eq(0).html();\n                html = this._cleanEmpty(html);\n                return html === \"\";\n            }\n            return false;\n        },\n        // handle\n        handleTab: function(e, key, event) {\n            var currentItem = this.app.selection.getBlock();\n            var isItemStart = this.app.caret.is(currentItem, \"start\");\n            if (this.isCaretStart() || this.isCaretEnd()) {\n                var next = this.getNext();\n                if (next) {\n                    e.preventDefault();\n                    this.app.block.set(next, \"start\");\n                    return true;\n                }\n            } else {\n                if (this.opts.tab.spaces && !isItemStart) return;\n                e.preventDefault();\n                this.app.list.indent();\n                return true;\n            }\n        },\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            var $newItem, $currentItem, currentItem, isItemEmpty;\n            // empty or end\n            if (this.isEmpty() || this.isCaretEnd()) {\n                currentItem = this.app.selection.getBlock();\n                $currentItem = this.dom(currentItem);\n                isItemEmpty = this.app.content.isEmptyHtml(currentItem.innerHTML);\n                // list exit\n                if (isItemEmpty) {\n                    // remove empty\n                    $currentItem.remove();\n                    // insert\n                    this.insertEmpty({\n                        position: \"after\",\n                        caret: \"start\"\n                    });\n                    return true;\n                }\n                // insert li\n                $newItem = this.dom(\"<li>\");\n                this.app.element.cloneAttrs(currentItem, $newItem);\n                this.dom(currentItem).after($newItem);\n                this.app.caret.set($newItem, \"start\");\n            } else if (this.isCaretStart()) {\n                $newItem = this.dom(\"<li>\");\n                currentItem = this.app.selection.getBlock();\n                this.app.element.cloneAttrs(currentItem, $newItem);\n                this.dom(currentItem).before($newItem);\n            } else {\n                currentItem = this.app.selection.getBlock();\n                $currentItem = this.dom(currentItem);\n                isItemEmpty = this.app.content.isEmptyHtml(currentItem.innerHTML);\n                var isItemStart = this.app.caret.is(currentItem, \"start\");\n                var isItemEnd = this.app.caret.is(currentItem, \"end\", [\n                    \"ul\",\n                    \"ol\"\n                ]);\n                $newItem = this.dom(\"<li>\");\n                this.app.element.cloneAttrs(currentItem, $newItem);\n                // empty\n                if (isItemEmpty) {\n                    $currentItem.after($newItem);\n                    this.app.caret.set($newItem, \"start\");\n                } else if (isItemStart) $currentItem.before($newItem);\n                else if (isItemEnd) {\n                    var $listInside = $currentItem.find(\"ul, ol\").first();\n                    if ($listInside.length !== 0) {\n                        $newItem.append(this.app.utils.createInvisibleChar());\n                        $newItem.append($listInside);\n                        $currentItem.after($newItem);\n                    } else $currentItem.after($newItem);\n                    this.app.caret.set($newItem, \"start\");\n                } else {\n                    var $part = this.app.element.split(currentItem);\n                    $newItem = $part;\n                    this.app.caret.set($part, \"start\");\n                }\n            }\n            // event\n            this.app.broadcast(\"list.item\", {\n                element: $newItem\n            });\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.noneditable\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"noneditable\",\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<div>\").addClass(this.opts.noneditable.classname);\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.quote\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"quote\",\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(this.opts.quote.template);\n        },\n        build: function() {\n            this._buildCaption();\n            this._buildItems(\"p\", \"quoteitem\");\n            this._buildItems(\"figcaption\", \"figcaption\");\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.quoteitem\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"quoteitem\",\n        editable: true,\n        toolbar: {\n            \"alignment\": {\n                title: \"## buttons.align ##\",\n                command: \"block.popup\",\n                observer: \"block.observe\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<p>\");\n        },\n        getBlockquote: function() {\n            return this.$block.closest(\"blockquote\");\n        },\n        // handle\n        handleArrow: function(e, key, event) {\n            var $blockquote = this.getBlockquote();\n            if ($blockquote.length === 0) return;\n            var isStart = this.app.caret.is($blockquote, \"start\");\n            var isEnd = this.app.caret.is($blockquote, \"end\");\n            if (event.is(\"up-left\") && isStart || event.is(\"down-right\") && isEnd) {\n                e.preventDefault();\n                var parentInstance = this.getParent(\"quote\");\n                this.app.block.set(parentInstance);\n                return true;\n            }\n        },\n        handleTab: function(e, key, event) {\n            e.preventDefault();\n            var next = this.getNext();\n            if (next) {\n                this.app.block.set(next, \"start\");\n                return true;\n            } else {\n                var quote = this.getParent(\"quote\");\n                this.app.block.set(quote);\n                return true;\n            }\n        },\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            // prepare new instance\n            var newInstance = this.app.create(\"block.quoteitem\");\n            // empty or end\n            if (this.isEmpty() || this.isCaretEnd()) this.insert({\n                instance: newInstance,\n                position: \"after\",\n                caret: \"start\"\n            });\n            else if (this.isCaretStart()) this.insert({\n                instance: newInstance,\n                position: \"before\"\n            });\n            else {\n                var $block = this.getBlock();\n                var $part = this.app.element.split($block);\n                this.app.block.set($part, \"start\");\n            }\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.row\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"row\",\n        toolbar: {\n            \"table\": {\n                title: \"## blocks.table ##\",\n                command: \"table.add\",\n                observer: \"table.observe\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<tr>\");\n        },\n        getNextRow: function() {\n            var row = this.getNext();\n            var $parent = this.$block.parent();\n            if (!row && $parent.get().tagName !== \"TABLE\") row = $parent.nextElement().find(\"tr\").first().dataget(\"instance\");\n            return row;\n        },\n        getPrevRow: function() {\n            var row = this.getPrev();\n            var $parent = this.$block.parent();\n            if (!row && $parent.get().tagName !== \"TABLE\") row = $parent.prevElement().find(\"tr\").last().dataget(\"instance\");\n            return row;\n        },\n        // handle\n        handleDelete: function(e, key, event) {\n            e.preventDefault();\n            return true;\n        },\n        handleArrow: function(e, key, event) {\n            e.preventDefault();\n            if (event.is(\"up-left\")) {\n                var parentInstance = this.getParent(\"table\");\n                this.app.block.set(parentInstance);\n            } else {\n                var cellInstance = this.getChildFirst(\"cell\");\n                this.app.block.set(cellInstance, \"start\");\n            }\n            return true;\n        },\n        handleTab: function(e, key, event) {\n            e.preventDefault();\n            var next = this.getNextRow();\n            if (next) this.app.block.set(next);\n            else {\n                var parentInstance = this.getParent(\"table\");\n                this.app.block.set(parentInstance);\n            }\n            return true;\n        },\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            return true;\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.table\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"table\",\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"table\": {\n                title: \"## blocks.table ##\",\n                command: \"table.add\",\n                observer: \"table.observe\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(this.opts.table.template);\n        },\n        build: function() {\n            this._buildItems(\"tr\", \"row\");\n            this._buildItems(\"td, th\", \"cell\");\n        },\n        getFirstCell: function() {\n            var $cell = this.$block.find(\"th, td\").first();\n            if ($cell.length !== 0) return $cell.dataget(\"instance\");\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.variable\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"variable\",\n        editable: false,\n        inline: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        create: function() {\n            return this.dom(\"<span>\").addClass(this.opts.variable.classname);\n        },\n        build: function() {\n            this.$block.addClass(this.opts.variable.classname);\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.form\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"form\",\n        create: function() {\n            return this.dom(\"<form>\");\n        },\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            }\n        },\n        control: {\n            trash: {\n                command: \"block.remove\",\n                title: \"## buttons.delete ##\"\n            },\n            duplicate: {\n                command: \"block.duplicate\",\n                title: \"## buttons.duplicate ##\"\n            }\n        }\n    });\n    ArticleEditor.add(\"block\", \"block.card\", {\n        mixins: [\n            \"block\"\n        ],\n        type: \"card\",\n        editable: true,\n        toolbar: {\n            \"add\": {\n                title: \"## buttons.add ##\",\n                command: \"addbar.popup\"\n            },\n            \"bold\": {\n                title: \"## buttons.bold ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"b\"\n                }\n            },\n            \"italic\": {\n                title: \"## buttons.italic ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"i\"\n                }\n            },\n            \"deleted\": {\n                title: \"## buttons.deleted ##\",\n                command: \"inline.set\",\n                params: {\n                    tag: \"del\"\n                }\n            },\n            \"link\": {\n                title: \"## buttons.link ##\",\n                command: \"link.popup\"\n            },\n            \"image\": {\n                title: \"## buttons.settings ##\",\n                command: \"image.editCard\",\n                observer: \"block.observeCard\"\n            }\n        },\n        control: {\n            \"trash\": {\n                title: \"## buttons.delete ##\",\n                command: \"block.remove\"\n            },\n            \"duplicate\": {\n                title: \"## buttons.duplicate ##\",\n                command: \"block.duplicate\"\n            }\n        },\n        create: function() {\n            return this.dom(this.opts.card.template);\n        },\n        build: function() {\n            this.data = {\n                \"alt\": {\n                    getter: \"getAlt\",\n                    setter: \"setAlt\"\n                }\n            };\n        },\n        hasImage: function() {\n            return this.$block.find(\"img\").length !== 0;\n        },\n        getImage: function() {\n            return this.$block.find(\"img\").eq(0);\n        },\n        getAlt: function() {\n            var $img = this.getImage();\n            var alt = $img.attr(\"alt\");\n            return alt ? alt : \"\";\n        },\n        setAlt: function(value) {\n            var $img = this.getImage();\n            $img.attr(\"alt\", value);\n        },\n        setImage: function(data) {\n            var $img = this.getImage();\n            $img.attr(\"src\", data.url);\n            if (Object.prototype.hasOwnProperty.call(data, \"id\")) $img.attr(\"data-image\", data.id);\n            $img.one(\"load\", this.app.editor.adjustHeight.bind(this.app.editor));\n        },\n        // handle\n        handleEnter: function(e, key, event) {\n            e.preventDefault();\n            this.app.insertion.insertBreakline();\n            return true;\n        }\n    });\n    window.ArticleEditor = ArticleEditor;\n    // Data attribute load\n    window.addEventListener(\"load\", function() {\n        ArticleEditor(\"[data-article-editor]\");\n    });\n    // Export for webpack\n    if (0, $f9c0764c59596a86$exports) {\n        $f9c0764c59596a86$exports = ArticleEditor;\n        $f9c0764c59596a86$exports.ArticleEditor = ArticleEditor;\n    }\n})();\n\n\nArticleEditor.add(\"plugin\", \"blockcode\", {\n    translations: {\n        en: {\n            \"blockcode\": {\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\",\n                \"edit-code\": \"Edit Code\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10.6128994 3.20970461.0942074.08318861 4 4c.3604839.36048396.3882135.92771502.0831886 1.32000622l-.0831886.09420734-4 4.00000002c-.3905243.3905243-1.02368929.3905243-1.41421358 0-.36048396-.360484-.3882135-.927715-.08318861-1.3200062l.08318861-.0942074 3.29210678-3.2928932-3.29210678-3.29289322c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734c.36048396-.36048396.92771498-.3882135 1.32000618-.08318861zm-3.90579262.08318861c.36048396.36048396.3882135.92771502.08318861 1.32000622l-.08318861.09420734-3.29210678 3.29289322 3.29210678 3.2928932c.36048396.360484.3882135.927715.08318861 1.3200062l-.08318861.0942074c-.36048396.3604839-.92771502.3882135-1.32000622.0831886l-.09420734-.0831886-4-4.00000002c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734 4-4c.39052429-.39052429 1.02368927-.39052429 1.41421356 0z\"/></svg>',\n        popup: {\n            width: \"100%\",\n            title: \"## blockcode.edit-code ##\",\n            form: {\n                \"code\": {\n                    type: \"textarea\",\n                    rows: \"8\"\n                }\n            },\n            footer: {\n                save: {\n                    title: \"## blockcode.save ##\",\n                    command: \"blockcode.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## blockcode.cancel ##\",\n                    close: true\n                }\n            }\n        }\n    },\n    init: function() {\n        this.offset = false;\n    },\n    start: function() {\n        this.app.control.add(\"blockcode\", {\n            icon: this.opts.blockcode.icon,\n            command: \"blockcode.edit\",\n            title: \"## blockcode.edit-code ##\",\n            blocks: {\n                all: true,\n                except: [\n                    \"variable\"\n                ]\n            }\n        });\n    },\n    edit: function() {\n        var current = this.app.block.get();\n        var code = current.getOuterHtml();\n        code = this.app.parser.unparse(code);\n        if (current.isEditable()) this.offset = this.app.offset.get(current.getBlock());\n        // create\n        var stack = this.app.popup.create(\"code\", this.opts.blockcode.popup);\n        stack.setData({\n            code: code\n        });\n        // open\n        this.app.popup.open({\n            focus: \"code\"\n        });\n        // hadnle & codemirror\n        this._buildInputHandle(stack);\n        this._buildCodemirror(stack);\n    },\n    save: function(stack) {\n        this.app.popup.close();\n        var current = this.app.block.get();\n        var code = this._getCode(stack);\n        if (code === \"\") return;\n        // create\n        code = this.app.parser.parse(code, false);\n        var $source = this.dom(code);\n        var instance = this.app.create(\"block.\" + current.getType(), $source);\n        // change\n        this.app.block.change(instance);\n        // set editable focus\n        if (this.offset && instance.isEditable()) this.app.offset.set(instance.getBlock(), this.offset);\n        // clear offset\n        this.offset = false;\n    },\n    // private\n    _getCode: function(stack) {\n        var data = stack.getData();\n        var code = data.code.trim();\n        code = this.app.codemirror.val(code);\n        return code;\n    },\n    _buildInputHandle: function(stack) {\n        var $input = stack.getInput(\"code\");\n        $input.on(\"keydown\", this.app.input.handleTextareaTab.bind(this));\n    },\n    _buildCodemirror: function(stack) {\n        var $input = stack.getInput(\"code\");\n        this.app.codemirror.create({\n            el: $input,\n            height: \"200px\",\n            focus: true\n        });\n        this.app.popup.updatePosition();\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"buttonlink\", {\n    translations: {\n        en: {\n            \"buttonlink\": {\n                \"button\": \"Button\"\n            }\n        }\n    },\n    defaults: {\n        classname: false\n    },\n    subscribe: {\n        \"popup.before.open\": function() {\n            if (this.opts.buttonlink.classname === false) return;\n            var stack = this.app.popup.getStack();\n            var name = stack.getName();\n            if (name === \"link\") this._build(stack);\n        }\n    },\n    make: function() {\n        this.app.popup.close();\n        var $link = this.app.link.getLink();\n        $link.addClass(this.opts.buttonlink.classname);\n    },\n    unmake: function() {\n        this.app.popup.close();\n        var $link = this.app.link.getLink();\n        $link.removeClass(this.opts.buttonlink.classname);\n    },\n    // private\n    _build: function(stack) {\n        var $link = this.app.link.getLink();\n        if ($link.length === 0) return;\n        var items = stack.getItemsData();\n        var item = {\n            title: \"## buttonlink.button ##\",\n            command: \"buttonlink.make\"\n        };\n        var index = this.app.utils.getObjectIndex(items, \"unlink\");\n        if (this._hasClass($link)) item = {\n            title: \"## buttonlink.button ##\",\n            command: \"buttonlink.unmake\",\n            active: true\n        };\n        items = this.app.utils.insertToObject(\"buttonlink\", item, items, index);\n        stack.setItemsData(items);\n    },\n    _hasClass: function($link) {\n        var arr = this.opts.buttonlink.classname.split(\" \");\n        var count = 0;\n        for(var i = 0; i < arr.length; i++)if ($link.hasClass(arr[i])) count++;\n        return count === arr.length;\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"carousel\", {\n    translations: {\n        en: {\n            \"carousel\": {\n                \"carousel\": \"Carousel\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\",\n                \"insert\": \"Insert\"\n            }\n        }\n    },\n    defaults: {\n        upload: false,\n        select: false,\n        name: \"file\",\n        data: false,\n        multiple: true\n    },\n    popups: {\n        add: {\n            title: \"## carousel.carousel ##\",\n            width: \"100%\",\n            footer: {\n                insert: {\n                    title: \"## carousel.insert ##\",\n                    command: \"carousel.insert\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## carousel.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        },\n        edit: {\n            title: \"## carousel.carousel ##\",\n            width: \"100%\",\n            footer: {\n                save: {\n                    title: \"## carousel.save ##\",\n                    command: \"carousel.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## carousel.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        }\n    },\n    start: function() {\n        this.app.addbar.add(\"carousel\", {\n            title: \"## carousel.carousel ##\",\n            icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z\"/></svg>',\n            command: \"carousel.popup\"\n        });\n    },\n    popup: function() {\n        // create\n        var stack = this.app.popup.add(\"slideshow\", this.popups.add);\n        // body\n        var $body = stack.getBody();\n        // box\n        this.$box = this.dom(\"<div>\").addClass(this.prefix + \"-slideshow-items\");\n        $body.append(this.$box);\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.carousel.upload, $body);\n        // select box\n        this.app.image.createSelectBox(this.opts.carousel.select, $body, \"carousel.insertFromSelect\");\n        // open\n        stack.open();\n        // build upload\n        this._buildUpload(this.$upload, \"carousel.insertByUpload\");\n    },\n    edit: function(params, button) {\n        // create\n        var stack = this.app.popup.create(\"slideshow\", this.popups.edit);\n        // body\n        var $body = stack.getBody();\n        // data\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        var $elms = $block.find(\"img\");\n        // box\n        this.$box = this.dom(\"<div>\").addClass(this.prefix + \"-slideshow-items\");\n        $body.append(this.$box);\n        // items\n        $elms.each((function($node) {\n            this._buildBoxItem($node.attr(\"src\"));\n        }).bind(this));\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.carousel.upload, $body);\n        // select box\n        this.app.image.createSelectBox(this.opts.carousel.select, $body, \"carousel.insertFromSelect\");\n        // open\n        this.app.popup.open({\n            button: button\n        });\n        // build upload\n        this._buildUpload(this.$upload, \"carousel.insertByUpload\");\n    },\n    insertByUpload: function(response) {\n        for(var key in response)this._buildBoxItem(response[key].url);\n    },\n    insertFromSelect: function(e) {\n        e.preventDefault();\n        var $target = this.dom(e.target);\n        this._buildBoxItem($target.attr(\"data-url\"));\n    },\n    insert: function() {\n        // instance\n        var instance = this.app.create(\"block.bs-carousel\");\n        this.app.block.add({\n            instance: instance\n        });\n        // save\n        this.save();\n    },\n    save: function() {\n        var current = this.app.block.get();\n        var $elms = this.$box.find(\"img\");\n        if ($elms.length === 0) {\n            current.remove();\n            this.app.popup.close();\n            return;\n        }\n        var $block = current.getBlock();\n        var $inner = $block.find(\".carousel-inner\");\n        // indicators\n        var $indicators = $block.find(\".carousel-indicators\");\n        var blockId = current.getId();\n        // clear\n        $indicators.html(\"\");\n        $inner.html(\"\");\n        $elms.each((function($node, i) {\n            var src = $node.attr(\"src\");\n            var $item = this.dom(\"<div>\").addClass(\"carousel-item\");\n            var $img = this.dom(\"<img>\").addClass(\"d-block w-100\").attr(\"src\", src);\n            var $indicator = this.dom(\"<li>\").attr({\n                \"data-slide-to\": i,\n                \"data-target\": \"#\" + blockId\n            });\n            $item.append($img);\n            $inner.append($item);\n            $indicators.append($indicator);\n        }).bind(this));\n        $inner.find(\".carousel-item\").first().addClass(\"active\");\n        $indicators.find(\"li\").first().addClass(\"active\");\n        // close popup\n        this.app.popup.close();\n    },\n    // private\n    _removeItem: function(e) {\n        var $target = this.dom(e.target).closest(\".\" + this.prefix + \"-slideshow-item\");\n        $target.fadeOut((function($node) {\n            $node.remove();\n        }).bind(this));\n    },\n    _buildBoxItem: function(src) {\n        var $item = this.dom(\"<span>\").addClass(this.prefix + \"-slideshow-item\");\n        var $remover = this.dom(\"<span>\").addClass(this.prefix + \"-upload-remove\");\n        var $img = this.dom(\"<img>\").attr(\"src\", src);\n        $remover.one(\"click\", this._removeItem.bind(this));\n        $item.append($img);\n        $item.append($remover);\n        this.$box.append($item);\n    },\n    _buildUpload: function($item, callback) {\n        if (!this.opts.carousel.upload) return;\n        var params = {\n            box: true,\n            placeholder: this.lang.get(\"image.upload-new-placeholder\"),\n            url: this.opts.carousel.upload,\n            name: this.opts.carousel.name,\n            data: this.opts.carousel.data,\n            multiple: this.opts.carousel.multiple,\n            success: callback,\n            error: \"image.error\"\n        };\n        this.app.create(\"upload\", $item, params);\n    }\n});\n\n\n\nArticleEditor.add(\"plugin\", \"clips\", {\n    translations: {\n        en: {\n            \"clips\": {\n                \"clips\": \"Clips\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12.1666667 1c1.0193924 0 1.8333333.83777495 1.8333333 1.85714286v10.28571424c0 1.0193679-.8139409 1.8571429-1.8333333 1.8571429h-8.33333337c-1.01868744 0-1.83333333-.8379215-1.83333333-1.8571429v-10.28571424c0-1.01922137.81464589-1.85714286 1.83333333-1.85714286zm-.1666667 2h-8v10h8zm-2 7c.5522847 0 1 .4477153 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-4c-.55228475 0-1-.4477153-1-1 0-.5128358.38604019-.9355072.88337887-.9932723l.11662113-.0067277zm0-3c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773zm0-3c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/></svg>',\n        items: false\n    },\n    start: function() {\n        if (!this.opts.clips.items) return;\n        this.app.toolbar.add(\"clips\", {\n            title: \"## clips.clips ##\",\n            icon: this.opts.clips.icon,\n            command: \"clips.popup\",\n            blocks: {\n                all: \"editable\"\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        for(var key in this.opts.clips.items)items[key] = {\n            title: this.opts.clips.items[key].title,\n            command: \"clips.insert\"\n        };\n        this.app.popup.create(\"clips\", {\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    insert: function(params, item, name) {\n        this.app.popup.close();\n        var html = this.opts.clips.items[name].html;\n        this.app.editor.insertContent({\n            html: html\n        });\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"counter\", {\n    translations: {\n        en: {\n            \"counter\": {\n                \"words\": \"words\",\n                \"chars\": \"chars\"\n            }\n        }\n    },\n    subscribe: {\n        \"editor.change\": function() {\n            this._count();\n        }\n    },\n    start: function() {\n        this._count();\n    },\n    // private\n    _count: function() {\n        var words = 0, characters = 0, spaces = 0;\n        var html = this.app.$element.val();\n        html = this._clean(html);\n        if (html !== \"\") {\n            var arrWords = html.split(/\\s+/);\n            var arrSpaces = html.match(/\\s/g);\n            words = arrWords ? arrWords.length : 0;\n            spaces = arrSpaces ? arrSpaces.length : 0;\n            characters = html.replace(/\\s+/g, \" \").length;\n        }\n        var data = {\n            words: words,\n            characters: characters,\n            spaces: spaces\n        };\n        // broadcast\n        this.app.broadcast(\"counter.count\", data);\n        // statusbar\n        this.app.statusbar.add(\"words\", this.lang.get(\"counter.words\") + \": \" + data.words);\n        this.app.statusbar.add(\"chars\", this.lang.get(\"counter.chars\") + \": \" + data.characters);\n    },\n    _clean: function(html) {\n        html = html.replace(/<\\/(.*?)>/gi, \" \");\n        html = html.replace(/<(.*?)>/gi, \"\");\n        html = html.replace(/\\t/gi, \"\");\n        html = html.replace(/\\n|\\r/gi, \" \");\n        html = html.replace(/&nbsp;/g, \"1\");\n        html = html.trim();\n        html = this.app.utils.removeInvisibleChars(html);\n        return html;\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"definedlinks\", {\n    defaults: {\n        items: false\n    },\n    subscribe: {\n        \"popup.open\": function() {\n            if (this.opts.definedlinks.items === false) return;\n            var stack = this.app.popup.getStack();\n            var name = stack.getName();\n            var names = [\n                \"link-create\",\n                \"link-edit\"\n            ];\n            if (names.indexOf(name) !== -1) this._build(stack);\n        }\n    },\n    // private\n    _build: function(stack) {\n        this.stack = stack;\n        var $item = stack.getFormItem(\"text\");\n        var $box = this.dom(\"<div>\").addClass(this.prefix + \"-form-item\");\n        // select\n        this.$select = this._create();\n        $box.append(this.$select);\n        $item.before($box);\n    },\n    _change: function(e) {\n        var key = this.dom(e.target).val();\n        var data = this.opts.definedlinks.items[key];\n        var $text = this.stack.getInput(\"text\");\n        var $url = this.stack.getInput(\"url\");\n        var name = data.name;\n        var url = data.url;\n        if (data.url === false) {\n            url = \"\";\n            name = \"\";\n        }\n        $text.val(name);\n        $url.val(url);\n    },\n    _create: function() {\n        var items = this.opts.definedlinks.items;\n        var $select = this.dom(\"<select>\").addClass(this.prefix + \"-form-select\");\n        $select.on(\"change\", this._change.bind(this));\n        for(var i = 0; i < items.length; i++){\n            var data = items[i];\n            var $option = this.dom(\"<option>\");\n            $option.val(i);\n            $option.html(data.name);\n            $select.append($option);\n        }\n        return $select;\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"filelink\", {\n    translations: {\n        en: {\n            \"filelink\": {\n                \"file\": \"File\",\n                \"upload\": \"Upload\",\n                \"title\": \"Title\",\n                \"choose\": \"Choose\",\n                \"placeholder\": \"Drag to upload a file<br>or click to select\"\n            }\n        }\n    },\n    defaults: {\n        states: true,\n        classname: false,\n        upload: false,\n        select: false,\n        name: \"file\",\n        data: false,\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m14 9c.5128358 0 .9355072.38604019.9932723.88337887l.0067277.11662113v3.2c0 .9600523-.7638671 1.7205052-1.7068479 1.7941504l-.150295.0058496h-10.28571424c-.96021508 0-1.77209294-.7124503-1.85088019-1.6501425l-.00626267-.1498575v-3.2c0-.55228475.44771525-1 1-1 .51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v3h10v-3c0-.51283584.3860402-.93550716.8833789-.99327227zm-6-8c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6h1.5c.1573787 0 .3055728.07409708.4.2.1656854.2209139.1209139.53431458-.1.7l-2.5 1.875c-.17777778.1333333-.42222222.1333333-.6 0l-2.5-1.875c-.12590292-.09442719-.2-.24262135-.2-.4 0-.27614237.22385763-.5.5-.5h1.5v-6c0-.55228475.44771525-1 1-1z\"/></svg>'\n    },\n    subscribe: {\n        \"editor.load, editor.build\": function() {\n            this.observeStates();\n        }\n    },\n    popups: {\n        create: {\n            title: \"## filelink.upload ##\",\n            width: \"400px\",\n            form: {\n                title: {\n                    type: \"input\",\n                    label: \"## filelink.title ##\"\n                },\n                file: {}\n            }\n        },\n        choose: {\n            collapse: false,\n            title: \"## filelink.choose ##\",\n            width: \"400px\"\n        }\n    },\n    init: function() {\n        this.dataStates = [];\n    },\n    start: function() {\n        if (!this._is()) return;\n        this.app.toolbar.add(\"file\", {\n            title: \"## filelink.file ##\",\n            icon: this.opts.filelink.icon,\n            command: \"filelink.popup\",\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            },\n            position: {\n                after: \"link\"\n            }\n        });\n    },\n    popup: function(params, button) {\n        // create\n        var choosetype = \"create\";\n        if (this.opts.filelink.upload) {\n            choosetype = \"add\";\n            var text = this.app.selection.getText();\n            var popup = this.app.popup.create(\"file\", this._buildPopupUpload(this.popups.create));\n            popup.setData({\n                title: text\n            });\n        }\n        // select\n        if (this.opts.filelink.select) {\n            var spopup = this.app.popup[choosetype](\"file-select\", this.popups.choose);\n            this.$sbox = spopup.getBody();\n            if (typeof this.opts.filelink.select === \"string\") this.ajax.get({\n                url: this.opts.filelink.select,\n                success: this._parseList.bind(this)\n            });\n            else this._parseList.apply(this, [\n                this.opts.filelink.select\n            ]);\n        }\n        // open\n        this.app.popup.open({\n            button: button\n        });\n    },\n    insertByUpload: function(response) {\n        // popup close\n        this.app.popup.close();\n        // data\n        var data = this.app.popup.getData();\n        // insert\n        this._insert(response, data.title);\n    },\n    insertBySelect: function(e) {\n        e.preventDefault();\n        // popup close\n        this.app.popup.close();\n        // selection\n        var text = this.app.selection.getText();\n        var $el = this.dom(e.target).closest(\".\" + this.prefix + \"-popup-list-item\");\n        var data = JSON.parse(decodeURI($el.attr(\"data-params\")));\n        this._insert({\n            file: data\n        }, text, true);\n    },\n    error: function(response) {\n        this.app.broadcast(\"file.upload.error\", {\n            response: response\n        });\n    },\n    observeStates: function() {\n        this._findFiles().each(this._addFileState.bind(this));\n    },\n    getStates: function() {\n        var $files = this._findFiles();\n        // check status\n        for(var key in this.dataStates){\n            var data = this.dataStates[key];\n            var status = $files.is('[data-file=\"' + data.id + '\"]');\n            this._setFileState(data.id, status);\n        }\n        return this.dataStates;\n    },\n    // private\n    _is: function() {\n        return this.opts.filelink.upload || this.opts.filelink.select;\n    },\n    _insert: function(response, title, select) {\n        // loop\n        for(var key in response){\n            // create file link\n            var $file = this._createFileAndStore(response[key], title);\n            // broadcast\n            var eventType = select ? \"select\" : \"upload\";\n            this.app.broadcast(\"file.\" + eventType, {\n                response: response,\n                $el: $file\n            });\n            break;\n        }\n    },\n    _buildPopupUpload: function(obj) {\n        obj.form.file = {\n            type: \"upload\",\n            upload: {\n                type: \"file\",\n                box: true,\n                placeholder: this.lang.get(\"filelink.placeholder\"),\n                url: this.opts.filelink.upload,\n                name: this.opts.filelink.name,\n                data: this.opts.filelink.data,\n                multiple: false,\n                success: \"filelink.insertByUpload\",\n                error: \"filelink.error\"\n            }\n        };\n        return obj;\n    },\n    _findFiles: function() {\n        return this.app.editor.getLayout().find(\"[data-file]\");\n    },\n    _addFileState: function($node) {\n        var id = $node.attr(\"data-file\");\n        this.dataStates[id] = {\n            type: \"file\",\n            status: true,\n            url: $node.attr(\"src\"),\n            $el: $node,\n            id: id\n        };\n    },\n    _setFileState: function(url, status) {\n        this.dataStates[url].status = status;\n    },\n    _parseList: function(data) {\n        var $ul = this.dom(\"<ul>\");\n        $ul.addClass(this.prefix + \"-popup-list\");\n        for(var key in data){\n            var obj = data[key];\n            if (typeof obj !== \"object\") continue;\n            var $li = this.dom(\"<li>\");\n            var $item = this.dom(\"<span>\");\n            $li.append($item);\n            // file item\n            $item.addClass(this.prefix + \"-popup-list-item\");\n            $item.attr(\"data-params\", encodeURI(JSON.stringify(obj)));\n            $item.text(obj.title || obj.name);\n            // file name\n            var $name = this.dom(\"<span>\");\n            $name.addClass(this.prefix + \"-popup-list-aside\");\n            $name.text(obj.name);\n            $li.append($name);\n            // file size\n            var $size = this.dom(\"<span>\");\n            $size.addClass(this.prefix + \"-popup-list-aside\");\n            $size.text(\"(\" + obj.size + \")\");\n            $li.append($size);\n            // event\n            $li.on(\"click\", this.insertBySelect.bind(this));\n            // append\n            $ul.append($li);\n        }\n        this.$sbox.append($ul);\n    },\n    _createFileAndStore: function(item, title) {\n        var nodes = this.app.inline.set({\n            tag: \"a\",\n            caret: \"after\"\n        });\n        var $file = this.dom(nodes);\n        $file.attr(\"href\", item.url);\n        $file.attr(\"data-file\", item.id ? item.id : this.app.utils.getRandomId());\n        $file.attr(\"data-name\", item.name);\n        // classname\n        if (this.opts.filelink.classname) $file.addClass(this.opts.filelink.classname);\n        // title\n        title = title && title !== \"\" ? title : this._truncateUrl(item.name);\n        $file.html(title);\n        return $file;\n    },\n    _truncateUrl: function(url) {\n        return url.search(/^http/) !== -1 && url.length > 20 ? url.substring(0, 20) + \"...\" : url;\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"fontsize\", {\n    translations: {\n        \"en\": {\n            \"fontsize\": {\n                \"title\": \"Text size\",\n                \"remove\": \"Remove text size\"\n            }\n        }\n    },\n    init () {\n        this.sizes = this.opts.fontsize ? this.opts.fontsize : [\n            \"10px\",\n            \"11px\",\n            \"12px\",\n            \"14px\",\n            \"16px\",\n            \"18px\",\n            \"20px\",\n            \"24px\",\n            \"28px\",\n            \"30px\"\n        ];\n    },\n    start () {\n        let button = {\n            title: \"## fontsize.title ##\",\n            icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M1.33667 3.33336C1.33667 2.87496 1.70827 2.50336 2.16667 2.50336H10.8333C11.2917 2.50336 11.6633 2.87496 11.6633 3.33336V4.66669C11.6633 5.12509 11.2917 5.49669 10.8333 5.49669C10.3749 5.49669 10.0033 5.12509 10.0033 4.66669V4.16336H7.66334V11.8367H8.16667C8.62507 11.8367 8.99667 12.2083 8.99667 12.6667C8.99667 13.1251 8.62507 13.4967 8.16667 13.4967H5.5C5.04161 13.4967 4.67 13.1251 4.67 12.6667C4.67 12.2083 5.04161 11.8367 5.5 11.8367H6.00334V4.16336H2.99667V4.66669C2.99667 5.12509 2.62507 5.49669 2.16667 5.49669C1.70827 5.49669 1.33667 5.12509 1.33667 4.66669V3.33336ZM9.33667 8.00002C9.33667 7.54163 9.70827 7.17002 10.1667 7.17002H14.1667C14.6251 7.17002 14.9967 7.54163 14.9967 8.00002V8.66669C14.9967 9.12509 14.6251 9.49669 14.1667 9.49669C13.7642 9.49669 13.4286 9.2102 13.3527 8.83002H12.9967V11.8528C13.3768 11.9286 13.6633 12.2642 13.6633 12.6667C13.6633 13.1251 13.2917 13.4967 12.8333 13.4967H11.5C11.0416 13.4967 10.67 13.1251 10.67 12.6667C10.67 12.2642 10.9565 11.9286 11.3367 11.8528V8.83002H10.9806C10.9047 9.2102 10.5692 9.49669 10.1667 9.49669C9.70827 9.49669 9.33667 9.12509 9.33667 8.66669V8.00002Z\"/></svg>',\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            },\n            command: \"fontsize.popup\"\n        };\n        this.app.toolbar.add(\"fontsize\", button);\n    },\n    popup (e, button) {\n        let buttons = {};\n        for(let i = 0; i < this.sizes.length; i++){\n            let size = this.sizes[i];\n            let params = {\n                tag: \"span\",\n                style: {\n                    \"font-size\": size\n                }\n            };\n            let obj = {\n                title: size,\n                command: \"inline.set\",\n                params: params\n            };\n            buttons[i] = obj;\n        }\n        // remove font family\n        buttons[\"remove\"] = {\n            title: \"## fontsize.remove ##\",\n            divider: \"top\",\n            command: \"fontsize.remove\"\n        };\n        this.app.popup.create(\"fontsize\", {\n            //width: '300px',\n            items: buttons\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    remove () {\n        this.app.popup.close();\n        let obj = {\n            style: \"font-size\"\n        };\n        this.app.inline.remove(obj);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"fontfamily\", {\n    translations: {\n        \"en\": {\n            \"fontfamily\": {\n                \"title\": \"Font\",\n                \"remove\": \"Remove font family\"\n            }\n        }\n    },\n    init () {\n        this.fonts = this.opts.fontfamily ? this.opts.fontfamily : [\n            \"Arial\",\n            \"Helvetica\",\n            \"Georgia\",\n            \"Times New Roman\",\n            \"Monospace\"\n        ];\n    },\n    start () {\n        let button = {\n            title: \"## fontfamily.title ##\",\n            icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.05618 2.37524C7.17767 2.05129 7.48736 1.83667 7.83334 1.83667H9.16667C9.49643 1.83667 9.79491 2.03188 9.92708 2.33399L14.3762 12.5033H14.5C14.9584 12.5033 15.33 12.8749 15.33 13.3333C15.33 13.7917 14.9584 14.1633 14.5 14.1633H13.8524C13.8399 14.1636 13.8275 14.1636 13.8152 14.1633H11.1855C11.1732 14.1636 11.1609 14.1636 11.1486 14.1633H9.83334C9.37494 14.1633 9.00334 13.7917 9.00334 13.3333C9.00334 12.8749 9.37494 12.5033 9.83334 12.5033H9.91398L9.20556 10.83H5.65853L5.03103 12.5033H5.16667C5.62507 12.5033 5.99667 12.8749 5.99667 13.3333C5.99667 13.7917 5.62507 14.1633 5.16667 14.1633H3.85246C3.83966 14.1636 3.82682 14.1636 3.81397 14.1633H3.16667C2.70827 14.1633 2.33667 13.7917 2.33667 13.3333C2.33667 12.8749 2.70827 12.5033 3.16667 12.5033H3.25815L7.05618 2.37524ZM6.28103 9.17H8.50278L7.32462 6.38709L6.28103 9.17ZM8.17134 4.12916L11.7166 12.5033H12.5643L8.62384 3.49667H8.40853L8.17134 4.12916Z\"/></svg>',\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            },\n            command: \"fontfamily.popup\"\n        };\n        this.app.toolbar.add(\"fontfamily\", button);\n    },\n    popup (e, button) {\n        let buttons = {};\n        for(let i = 0; i < this.fonts.length; i++){\n            let font = this.fonts[i];\n            let obj = {\n                title: font.replace(/'/g, \"\"),\n                command: \"inline.set\",\n                params: {\n                    tag: \"span\",\n                    style: {\n                        \"font-family\": font\n                    }\n                }\n            };\n            buttons[i] = obj;\n        }\n        // remove font family\n        buttons[\"remove\"] = {\n            title: \"## fontfamily.remove ##\",\n            divider: \"top\",\n            command: \"fontfamily.remove\"\n        };\n        this.app.popup.create(\"fontfamily\", {\n            //width: '300px',\n            items: buttons\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    remove () {\n        this.app.popup.close();\n        this.app.inline.remove({\n            style: \"font-family\"\n        });\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"fontcolor\", {\n    translations: {\n        \"en\": {\n            \"fontcolor\": {\n                \"title\": \"Text color\",\n                \"remove\": \"Remove color\",\n                \"text\": \"Text\",\n                \"background\": \"Background\"\n            }\n        }\n    },\n    init () {\n        let colors = {\n            gray: [\n                \"#212529\",\n                \"#343a40\",\n                \"#495057\",\n                \"#868e96\",\n                \"#adb5bd\",\n                \"#ced4da\",\n                \"#dee2e6\",\n                \"#e9ecef\",\n                \"#f1f3f5\",\n                \"#f8f9fa\"\n            ],\n            red: [\n                \"#c92a2a\",\n                \"#e03131\",\n                \"#f03e3e\",\n                \"#fa5252\",\n                \"#ff6b6b\",\n                \"#ff8787\",\n                \"#ffa8a8\",\n                \"#ffc9c9\",\n                \"#ffe3e3\",\n                \"#fff5f5\"\n            ],\n            pink: [\n                \"#a61e4d\",\n                \"#c2255c\",\n                \"#d6336c\",\n                \"#e64980\",\n                \"#f06595\",\n                \"#f783ac\",\n                \"#faa2c1\",\n                \"#fcc2d7\",\n                \"#ffdeeb\",\n                \"#fff0f6\"\n            ],\n            grape: [\n                \"#862e9c\",\n                \"#9c36b5\",\n                \"#ae3ec9\",\n                \"#be4bdb\",\n                \"#cc5de8\",\n                \"#da77f2\",\n                \"#e599f7\",\n                \"#eebefa\",\n                \"#f3d9fa\",\n                \"#f8f0fc\"\n            ],\n            violet: [\n                \"#5f3dc4\",\n                \"#6741d9\",\n                \"#7048e8\",\n                \"#7950f2\",\n                \"#845ef7\",\n                \"#9775fa\",\n                \"#b197fc\",\n                \"#d0bfff\",\n                \"#e5dbff\",\n                \"#f3f0ff\"\n            ],\n            indigo: [\n                \"#364fc7\",\n                \"#3b5bdb\",\n                \"#4263eb\",\n                \"#4c6ef5\",\n                \"#5c7cfa\",\n                \"#748ffc\",\n                \"#91a7ff\",\n                \"#bac8ff\",\n                \"#dbe4ff\",\n                \"#edf2ff\"\n            ],\n            blue: [\n                \"#1864ab\",\n                \"#1971c2\",\n                \"#1c7ed6\",\n                \"#228be6\",\n                \"#339af0\",\n                \"#4dabf7\",\n                \"#74c0fc\",\n                \"#a5d8ff\",\n                \"#d0ebff\",\n                \"#e7f5ff\"\n            ],\n            cyan: [\n                \"#0b7285\",\n                \"#0c8599\",\n                \"#1098ad\",\n                \"#15aabf\",\n                \"#22b8cf\",\n                \"#3bc9db\",\n                \"#66d9e8\",\n                \"#99e9f2\",\n                \"#c5f6fa\",\n                \"#e3fafc\"\n            ],\n            teal: [\n                \"#087f5b\",\n                \"#099268\",\n                \"#0ca678\",\n                \"#12b886\",\n                \"#20c997\",\n                \"#38d9a9\",\n                \"#63e6be\",\n                \"#96f2d7\",\n                \"#c3fae8\",\n                \"#e6fcf5\"\n            ],\n            green: [\n                \"#2b8a3e\",\n                \"#2f9e44\",\n                \"#37b24d\",\n                \"#40c057\",\n                \"#51cf66\",\n                \"#69db7c\",\n                \"#8ce99a\",\n                \"#b2f2bb\",\n                \"#d3f9d8\",\n                \"#ebfbee\"\n            ],\n            lime: [\n                \"#5c940d\",\n                \"#66a80f\",\n                \"#74b816\",\n                \"#82c91e\",\n                \"#94d82d\",\n                \"#a9e34b\",\n                \"#c0eb75\",\n                \"#d8f5a2\",\n                \"#e9fac8\",\n                \"#f4fce3\"\n            ],\n            yellow: [\n                \"#e67700\",\n                \"#f08c00\",\n                \"#f59f00\",\n                \"#fab005\",\n                \"#fcc419\",\n                \"#ffd43b\",\n                \"#ffe066\",\n                \"#ffec99\",\n                \"#fff3bf\",\n                \"#fff9db\"\n            ],\n            orange: [\n                \"#d9480f\",\n                \"#e8590c\",\n                \"#f76707\",\n                \"#fd7e14\",\n                \"#ff922b\",\n                \"#ffa94d\",\n                \"#ffc078\",\n                \"#ffd8a8\",\n                \"#ffe8cc\",\n                \"#fff4e6\"\n            ]\n        };\n        this.colors = this.opts.fontcolor ? this.opts.fontcolor : colors;\n    },\n    start () {\n        let button = {\n            title: \"## fontcolor.title ##\",\n            color: true,\n            icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.50002 4.16336C8.18972 4.16336 7.89213 4.28662 7.67271 4.50604C7.45329 4.72546 7.33002 5.02305 7.33002 5.33336V6.50336H9.67002V5.33336C9.67002 5.02305 9.54676 4.72546 9.32734 4.50604C9.10792 4.28662 8.81033 4.16336 8.50002 4.16336ZM11.33 5.33336C11.33 4.58279 11.0319 3.86297 10.5011 3.33224C9.97041 2.80152 9.25059 2.50336 8.50002 2.50336C7.74946 2.50336 7.02964 2.80152 6.49891 3.33224C5.96818 3.86297 5.67002 4.58279 5.67002 5.33336V10C5.67002 10.4584 6.04163 10.83 6.50002 10.83C6.95842 10.83 7.33002 10.4584 7.33002 10V8.16336H9.67002V10C9.67002 10.4584 10.0416 10.83 10.5 10.83C10.9584 10.83 11.33 10.4584 11.33 10V5.33336ZM3.00336 12.6667C3.00336 12.2083 3.37496 11.8367 3.83336 11.8367H13.1667C13.6251 11.8367 13.9967 12.2083 13.9967 12.6667C13.9967 13.1251 13.6251 13.4967 13.1667 13.4967H3.83336C3.37496 13.4967 3.00336 13.1251 3.00336 12.6667Z\"/></svg>',\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            },\n            command: \"fontcolor.popup\"\n        };\n        this.app.toolbar.add(\"fontcolor\", button);\n    },\n    popup (e, button) {\n        let inlines = this.app.selection.getNodes({\n            type: \"inline\"\n        });\n        this.currentColor = false;\n        this.currentBackgroundColor = false;\n        if (inlines) {\n            let $inline = this.dom(inlines[0]);\n            let style = this.app.utils.cssToObject($inline.attr(\"style\"));\n            this.currentColor = style.color ? style.color : this.currentColor;\n            this.currentBackgroundColor = style.background ? style.background : this.currentBackgroundColor;\n        }\n        let $dropdown = this.dom('<div class=\"' + this.prefix + '-dropdown-cells\">');\n        this.$selector = this._buildSelector();\n        this.$selectorText = this._buildSelectorItem(\"text\", this.lang.get(\"fontcolor.text\"));\n        this.$selectorText.addClass(\"active\");\n        this.$selectorBack = this._buildSelectorItem(\"back\", this.lang.get(\"fontcolor.background\"));\n        this.$selector.append(this.$selectorText);\n        this.$selector.append(this.$selectorBack);\n        this.$pickerText = this._buildPicker(\"textcolor\");\n        this.$pickerBack = this._buildPicker(\"backcolor\");\n        let width = Object.keys(this.colors).length * 20;\n        $dropdown.append(this.$selector);\n        $dropdown.append(this.$pickerText);\n        $dropdown.append(this.$pickerBack);\n        $dropdown.width(width);\n        this._buildSelectorEvents();\n        this.app.popup.create(\"fontcolor\", {\n            width: width + \"px\",\n            html: $dropdown\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    // =private\n    _remove (type) {\n        this.app.popup.close();\n        let obj = type === \"color\" ? {\n            style: \"color\"\n        } : {\n            style: \"background\"\n        };\n        this.app.inline.remove(obj);\n    },\n    _buildSelector () {\n        let $selector = this.dom(\"<div>\");\n        $selector.addClass(this.prefix + \"-dropdown-selector\");\n        return $selector;\n    },\n    _buildSelectorItem (name, title) {\n        let $item = this.dom(\"<span>\");\n        $item.attr(\"rel\", name).html(title);\n        $item.addClass(this.prefix + \"-dropdown-not-close\");\n        return $item;\n    },\n    _buildSelectorEvents () {\n        this.$selectorText.on(\"click\", (function(e) {\n            e.preventDefault();\n            this.$selector.find(\"span\").removeClass(\"active\");\n            this.$pickerBack.hide();\n            this.$pickerText.show();\n            this.$selectorText.addClass(\"active\");\n        }).bind(this));\n        this.$selectorBack.on(\"click\", (function(e) {\n            e.preventDefault();\n            this.$selector.find(\"span\").removeClass(\"active\");\n            this.$pickerText.hide();\n            this.$pickerBack.show();\n            this.$selectorBack.addClass(\"active\");\n        }).bind(this));\n    },\n    _buildPicker (name) {\n        var $box = this.dom('<div class=\"' + this.prefix + \"-dropdown-box-\" + name + '\">');\n        var $colorBox = this.dom('<div class=\"' + this.prefix + '-form-colors-box\">');\n        var rule = name == \"backcolor\" ? \"background\" : \"color\";\n        var len = this.colors.length;\n        var self = this;\n        for (let [key, item] of Object.entries(this.colors)){\n            var $div = this.dom('<div class=\"' + this.prefix + '-form-colors\">');\n            for(var i = 0; i < item.length; i++){\n                var color = item[i];\n                var $swatch = this.dom('<a href=\"#\">');\n                $swatch.attr({\n                    \"rel\": color,\n                    \"data-rule\": rule\n                });\n                $swatch.css({\n                    \"background-color\": color,\n                    \"font-size\": 0,\n                    \"width\": \"20px\",\n                    \"height\": \"20px\"\n                });\n                $swatch.on(\"click\", (function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    var $el = this.dom(e.target);\n                    let color = $el.attr(\"rel\");\n                    let style = $el.data(\"rule\") === \"color\" ? {\n                        \"color\": color\n                    } : {\n                        \"background\": color\n                    };\n                    let params = {\n                        tag: \"span\",\n                        style: style\n                    };\n                    this.app.event.trigger = false;\n                    this.app.inline.set(params);\n                    setTimeout((function() {\n                        this.app.event.trigger = true;\n                    }).bind(this), 100);\n                }).bind(this));\n                if (rule === \"color\" && this.currentColor === color) $swatch.addClass(\"active\");\n                if (rule === \"background\" && this.currentBackgroundColor === color) $swatch.addClass(\"active\");\n                $div.append($swatch);\n            }\n            $colorBox.append($div);\n        }\n        $box.append($colorBox);\n        var $el = this.dom(\"<div>\").addClass(this.prefix + \"-dropdown-remove-item\");\n        var $link = this.dom(\"<a>\");\n        $link.attr({\n            \"href\": \"#\"\n        });\n        $link.html(this.lang.get(\"fontcolor.remove\"));\n        $link.on(\"click\", function(e) {\n            e.preventDefault();\n            self._remove(rule);\n        });\n        $el.append($link);\n        $box.append($el);\n        if (name == \"backcolor\") $box.hide();\n        return $box;\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"handle\", {\n    translations: {\n        en: {\n            \"handle\": {\n                \"handle\": \"Handle\"\n            }\n        }\n    },\n    defaults: {\n        url: false,\n        start: 1,\n        trigger: \"@\"\n    },\n    subscribe: {\n        \"editor.keydown\": function(event) {\n            this._listen(event);\n        },\n        \"editor.keyup\": function(event) {\n            if (this.opts.handle.url === false) return;\n            this._handle(event);\n        }\n    },\n    start: function() {\n        this.handleLen = this.opts.handle.start;\n    },\n    stop: function() {\n        this._hide();\n    },\n    // private\n    _handle: function(event) {\n        var e = event.get(\"e\");\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var arrows = [\n            37,\n            38,\n            39,\n            40\n        ];\n        var ks = this.app.keycodes;\n        if (key === ks.ESC) {\n            this.app.selection.restore();\n            return;\n        }\n        if (key === ks.DELETE || key === ks.SPACE || key === ks.SHIFT || ctrl || arrows.indexOf(key) !== -1) return;\n        if (key === ks.BACKSPACE) {\n            this.handleLen = this.handleLen - 2;\n            if (this.handleLen <= this.opts.handle.start) this._hide();\n        }\n        this._emit();\n    },\n    _listen: function(event) {\n        var e = event.get(\"e\");\n        var key = e.which;\n        var ks = this.app.keycodes;\n        // listen enter\n        if (this._isShown() && key === ks.ENTER) {\n            var $item = this._getActiveItem();\n            if ($item.length === 0) {\n                this._hideForce();\n                return;\n            } else {\n                e.preventDefault();\n                event.stop();\n                this._replace(e, $item);\n                return;\n            }\n        }\n        // listen down / up\n        if (this._isShown() && (key === 40 || key === 38)) {\n            e.preventDefault();\n            event.stop();\n            var $item = this._getActiveItem();\n            if ($item.length === 0) {\n                var $first = this._getFirstItem();\n                this._setActive($first);\n            } else if (key === 40) this._setNextActive($item);\n            else if (key === 38) this._setPrevActive($item);\n        }\n    },\n    _getItems: function() {\n        return this.$panel.find(\".\" + this.prefix + \"-panel-item\");\n    },\n    _getActiveItem: function() {\n        return this._getItems().filter(function($node) {\n            return $node.hasClass(\"active\");\n        });\n    },\n    _getFirstItem: function() {\n        return this._getItems().first();\n    },\n    _getLastItem: function() {\n        return this._getItems().last();\n    },\n    _setActive: function($el) {\n        this._getItems().removeClass(\"active\");\n        $el.addClass(\"active\");\n        var itemHeight = $el.outerHeight();\n        var itemTop = $el.position().top;\n        var itemsScrollTop = this.$panel.scrollTop();\n        var scrollTop = itemTop + itemHeight * 2;\n        var itemsHeight = this.$panel.outerHeight();\n        this.$panel.scrollTop(scrollTop > itemsScrollTop + itemsHeight ? scrollTop - itemsHeight : itemTop - itemHeight < itemsScrollTop ? itemTop - itemHeight : itemsScrollTop);\n    },\n    _setNextActive: function($el) {\n        var $next = $el.next();\n        if ($next.length !== 0) this._setActive($next);\n        else {\n            var $first = this._getFirstItem();\n            this._setActive($first);\n        }\n    },\n    _setPrevActive: function($el) {\n        var $prev = $el.prev();\n        if ($prev.length !== 0) this._setActive($prev);\n        else {\n            var $last = this._getLastItem();\n            this._setActive($last);\n        }\n    },\n    _emit: function() {\n        var re = new RegExp(\"^\" + this.opts.handle.trigger);\n        this.handleStr = this.app.selection.getText(\"before\", this.handleLen);\n        this.handleStr2 = this.app.selection.getText(\"before\", this.handleLen + 1);\n        // detect\n        if (re.test(this.handleStr)) {\n            if (this.handleStr2 && this.handleStr2[0] === \" \" || this.handleStr2[0] === \"\") {\n                this.handleStr = this.handleStr.replace(this.opts.handle.trigger, \"\");\n                this.handleLen++;\n                if (this.handleLen - 1 > this.opts.handle.start) this._load();\n            }\n        }\n    },\n    _isShown: function() {\n        return this.$panel && this.$panel.hasClass(\"open\");\n    },\n    _load: function() {\n        this.ajax.post({\n            url: this.opts.handle.url,\n            data: \"handle=\" + this.handleStr,\n            success: this._parse.bind(this)\n        });\n    },\n    _parse: function(json) {\n        if (json === \"\" || Array.isArray(json) && json.length === 0) {\n            if (this.$panel) this.$panel.remove();\n            return;\n        }\n        var data = typeof json === \"object\" ? json : JSON.parse(json);\n        this._build(data);\n    },\n    _build: function(data) {\n        this.data = data;\n        this.$panel = this.app.$body.find(\".\" + this.prefix + \"-panel\");\n        if (this.$panel.length === 0) {\n            this.$panel = this.dom(\"<div>\").addClass(this.prefix + \"-panel\");\n            this.app.$body.append(this.$panel);\n        } else this.$panel.html(\"\");\n        // events\n        this._stopEvents();\n        this._startEvents();\n        // data\n        for(var key in data){\n            var $item = this.dom(\"<div>\").addClass(this.prefix + \"-panel-item\");\n            var $trigger = this.dom(\"<a>\").attr(\"href\", \"#\");\n            $trigger.html(data[key].item);\n            $trigger.attr(\"data-key\", key);\n            $trigger.on(\"click\", this._replace.bind(this));\n            $item.append($trigger);\n            this.$panel.append($item);\n        }\n        // position\n        var offset = this.app.editor.getFrameRect();\n        var pos = this.app.selection.getPosition();\n        this.$panel.addClass(\"open\");\n        this.$panel.css({\n            top: pos.top + pos.height + offset.top + \"px\",\n            left: pos.left + offset.left + \"px\"\n        });\n        this.app.selection.save();\n    },\n    _replace: function(e, $el) {\n        e.preventDefault();\n        e.stopPropagation();\n        var $item;\n        if ($el) $item = $el.find(\"a\");\n        else $item = this.dom(e.target);\n        var key = $item.attr(\"data-key\");\n        var replacement = this.data[key].replacement;\n        this.app.marker.insert(\"start\");\n        var marker = this.app.marker.find(\"start\");\n        if (marker === false) return;\n        var $marker = this.dom(marker);\n        var current = marker.previousSibling;\n        var currentText = current.textContent;\n        var re = new RegExp(this.opts.handle.trigger + this.handleStr + \"$\");\n        currentText = currentText.replace(re, \"\");\n        current.textContent = currentText;\n        $marker.before(replacement);\n        this.app.selection.restoreMarker();\n        this._hide();\n    },\n    _reset: function() {\n        this.handleStr = false;\n        this.handleLen = this.opts.handle.start;\n        this.$panel = false;\n    },\n    _hide: function(e) {\n        var hidable = false;\n        var key = e && e.which;\n        var ks = this.app.keycodes;\n        if (!e) hidable = true;\n        else if (e.type === \"click\" || key === ks.ESC || key === ks.SPACE) hidable = true;\n        if (hidable) this._hideForce();\n    },\n    _hideForce: function() {\n        if (this.$panel) this.$panel.remove();\n        this._reset();\n        this._stopEvents();\n    },\n    _startEvents: function() {\n        var name = \"click.\" + this.prefix + \"-plugin-handle keydown.\" + this.prefix + \"-plugin-handle\";\n        this.app.$doc.on(name, this._hide.bind(this));\n        this.app.editor.getBody().on(name, this._hide.bind(this));\n    },\n    _stopEvents: function() {\n        var name = \".\" + this.prefix + \"-plugin-handle\";\n        this.app.$doc.off(name);\n        this.app.editor.getBody().off(name);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"icons\", {\n    translations: {\n        en: {\n            \"icons\": {\n                \"icons\": \"Icons\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m4.83610557 5.032-3.97464639.56135882-.11503066.02273502c-.74344369.19074743-1.01211485 1.14559722-.43257233 1.69388798l2.85824938 2.70401818-.67299733 3.8119764-.01354998.1096265c-.05329246.7582459.7508858 1.3132977 1.45280081.9551391l3.5617465-1.818742 3.56345043 1.8187308.1008624.0450315c.7094575.2728097 1.4755032-.3337453 1.3384209-1.1097256l-.6737337-3.8120367 2.8592493-2.70401818.0806168-.08514687c.4956567-.58602276.1617639-1.52007291-.6282281-1.63147731l-3.976638-.56135764-1.7716142-3.48521534c-.37065902-.72902616-1.41208515-.72905169-1.78277991-.0000437zm2.664-.826 1.11796025 2.19736628.06151847.10474119c.15723483.23391009.4074375.39236473.69024457.43224609l2.43527674.34264644-1.741257 1.6488901-.08529699.09144393c-.18419657.22405591-.26337869.51926707-.2122058.80894091l.41775979 2.36372506-2.22848404-1.1365651-.1252676-.0535184c-.25574273-.0891979-.53905484-.0713624-.78377298.0535073l-2.22947541 1.1365762.4187491-2.36366475.01403221-.12426844c.0144621-.28970819-.09782698-.57400297-.31152431-.77617671l-1.742257-1.6488901 2.43601084-.34264762c.3231876-.04557858.60379519-.24600908.75173246-.53694239z\"/></svg>',\n        items: [\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.5 7.98901099c0-1.34799209.21516178-2.34981357.6454918-3.00549451.43033002-.65568093 1.04849324-.98351648 1.8545082-.98351648.86066004 0 1.49248432.32417258 1.8954918.97252747.4030075.64835489.6045082 1.65383934.6045082 3.01648352 0 1.35531813-.2168694 2.36263411-.65061475 3.02197801-.43374534.659344-1.05361619.989011-1.85963115.989011-.85382941 0-1.48223842-.3461504-1.8852459-1.0384615-.40300748-.6923112-.6045082-1.68314377-.6045082-2.97252751zm1.33196721 0c0 .89377736.09050456 1.58424665.2715164 2.07142861.18101183.4871819.47984764.7307692.89651639.7307692.40300748 0 .69842802-.223441.88627049-.6703297.18784247-.44688866.2817623-1.15750426.2817623-2.13186811 0-.88645132-.08879693-1.57142615-.26639345-2.05494506-.17759651-.4835189-.48155522-.72527472-.91188524-.72527472-.40983812 0-.70525866.22710395-.88627049.68131868-.18101184.45421473-.2715164 1.15384143-.2715164 2.0989011z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.93478261 10.7640449h1.59038901v-4.4382022l.17162472-.76404495-.54919909.66292135-1.01830663.68539326-.62929062-.84269663 2.60869565-2.06741573h.83524028v6.7640449h1.55606407v1.2359551h-4.56521739z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m10.3218527 6.07282913c0 .38095429-.0732376.76563765-.2197149 1.15406163-.14647741.38842397-.33254047.76937255-.55819481 1.14285714-.22565433.37348459-.47505801.73389182-.74821852 1.08123249-.27316052.34734067-.54037875.66666521-.80166271.95798321l-.62945368.4593837v.0560224l.85510688-.1568627h2.28028504v1.232493h-5v-.7507003c.1900247-.1867423.40379929-.4052275.64133017-.6554622.23753088-.2502346.47703759-.5154047.71852731-.79551817.24148973-.28011345.47703765-.56955967.70665083-.86834734.22961319-.29878768.43547019-.59943826.6175772-.90196079.18210701-.30252252.32660279-.59570352.43349169-.87955182.10688889-.28384829.16033254-.55275316.16033254-.80672269 0-.30625736-.09303153-.55835568-.27909739-.75630252-.18606585-.19794683-.4809956-.29691876-.8847981-.29691876-.25336627 0-.51266692.05041966-.77790974.1512605-.26524281.10084084-.48891437.22969109-.67102137.38655462l-.6175772-1.03081232c.30879014-.23903014.65914293-.43137182 1.05106888-.57703082.39192595-.14565899.85312482-.21848739 1.38361045-.21848739.34046093 0 .65320523.04481748.93824228.13445378.28503706.0896363.53048195.22035395.73634205.39215686.20586009.17180292.3681704.38655334.4869359.64425771.1187654.25770437.1781472.55835496.1781472.90196078z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m7.44047619 10.767507c.49206595 0 .8670622-.1232481 1.125-.3697479s.38690476-.54528302.38690476-.89635854c0-.42577244-.13491928-.73949479-.4047619-.94117647s-.69444155-.30252101-1.27380953-.30252101h-.85714285v-.77310924l1.44047619-1.8487395.67857143-.50420168-.94047619.10084034h-2v-1.232493h4.547619v.79551821l-1.67857139 2.11764706-.52380952.302521v.05602241l.5-.06722689c.27777917.02240908.54166542.08216572.79166667.17927171.25000125.097106.46825303.23716062.6547619.42016807.18650884.18300745.33531694.40896224.44642854.67787115.1111117.2689089.1666667.57889647.1666667.92997199 0 .44071182-.0773802.82166039-.2321429 1.14285709-.1547626.3211968-.36904621.5901017-.6428571.8067227-.27381089.2166211-.59325214.3772171-.95833333.4817928-.36508119.1045756-.75793441.1568627-1.17857143.1568627-.3492081 0-.7103156-.0298783-1.08333334-.0896359-.37301773-.0597575-.67460202-.1456577-.9047619-.257703l.41666667-1.2100841c.20635023.097106.43452256.1755366.68452381.2352941.25000125.0597576.52976035.0896359.83928571.0896359z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m10.5 9.78723404h-1.23595506v2.21276596h-1.35955056v-2.21276596h-3.40449438v-.83971631l3.56179775-4.94751773h1.20224719v4.6070922h1.23595506zm-2.59550562-2.91631205.1011236-.95319149h-.04494382l-.38202247.81702127-1.16853933 1.5319149-.56179775.43120567.71910112-.09078014h1.33707865z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m7.31818182 10.7114846c.52631842 0 .92902572-.1195133 1.20813397-.3585434.27910825-.2390302.41866029-.56769168.41866029-.98599442 0-.44818151-.16347524-.77684303-.49043063-.9859944-.32695538-.20915137-.79345789-.31372549-1.39952153-.31372549l-.94497607.03361345v-4.10084034h4.11483255v1.36694678h-2.77511963v1.51260504l.49043062-.04481793c.39075155.01493939.74361884.08216561 1.05861244.20168068s.58412966.28571322.80741627.49859944c.2232866.21288621.3947362.47058672.5143541.77310924.1196178.30252252.1794258.64052101.1794258 1.0140056 0 .44071182-.079744.82912995-.2392344 1.16526615-.1594905.3361361-.38078013.6162453-.66387565.8403361-.28309551.2240907-.61602679.3921563-.99880383.5042017-.38277703.1120454-.80143313.1680672-1.25598086.1680672-.35885347 0-.69975915-.0280109-1.02272727-.0840336s-.59609139-.1325859-.81937799-.2296919l.41866029-1.210084c.18341399.0746969.38476764.1325861.60406698.1736694s.48444821.0616247.79545455.0616247z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m10.5 9.46153846c0 .35897616-.0587601.69230614-.1762821 1.00000004-.1175219.3076938-.2831185.5750904-.49679482.8021978-.21367629.2271073-.47186459.4065927-.77457265.5384615-.30270807.1318688-.63568195.1978022-.99893163.1978022-.37037222 0-.71046853-.060439-1.02029914-.1813187s-.57870257-.3021966-.80662393-.543956c-.22792137-.2417595-.40598227-.5457857-.53418804-.9120879-.12820577-.36630224-.19230769-.79120641-.19230769-1.27472531 0-.72527835.10149471-1.38094945.30448718-1.96703297s.47720625-1.09706742.82264957-1.53296703c.34544332-.43589962.74786095-.78754445 1.20726496-1.05494506.45940401-.2674006.94551026-.4450545 1.45833333-.53296703l.30982906 1.13186813c-.35612713.05860835-.68375919.17216033-.98290598.34065934-.2991468.16849901-.56445753.3699622-.79594017.60439561-.23148264.2344334-.42734963.49633555-.58760684.78571428-.16025721.28937874-.27243558.58791055-.33653846.8956044.14245085-.1831511.32763419-.3388272.55555556-.46703297.22792136-.12820577.5128188-.19230769.85470085-.19230769.32051442 0 .61609551.05128154.88675214.15384615.27065662.10256462.50213579.25457775.69444444.45604396.19230866.20146621.34187976.44871648.44871796.74175824.1068381.29304176.1602564.63003473.1602564 1.01098901zm-1.34615385.07692308c0-.82051692-.39173397-1.23076923-1.17521367-1.23076923-.28490171 0-.52528392.0659334-.72115385.1978022-.19586992.13186879-.33297681.2857134-.41132478.46153846-.01424509.08058648-.02136753.15018285-.02136753.20879121v.17582417c0 .17582506.02492853.34981599.07478633.52197802s.12286277.32600663.21901709.46153843c.09615433.1355318.21901635.2454209.36858975.3296704.14957339.0842495.32763429.1263736.53418803.1263736.33475951 0 .60719268-.117215.81730769-.3516484s.31517094-.53479666.31517094-.90109886z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.98780488 12 2.53880266-6.16.48780488-.56-.66518847.11428571h-2.84922395v-1.39428571h5v.43428571l-3.10421286 7.56571429z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.5 9.96703297c0-.25641154.03363195-.48534698.10089686-.68681319s.16255544-.38461456.28587444-.54945055.26905746-.31318615.43721973-.44505494c.16816228-.1318688.34940112-.25274671.54372197-.36263737-.36622006-.22710736-.65396009-.4890095-.8632287-.78571428-.2092686-.29670478-.31390134-.66483297-.31390134-1.10439561 0-.28571571.05418481-.5531123.16255605-.8021978.10837125-.24908549.26532035-.46520055.47085202-.64835165s.45403442-.32600681.7455157-.42857143c.29148127-.10256461.62032701-.15384615.98654708-.15384615.33632455 0 .64274899.0439556.91928251.13186813s.51382562.21245341.71188341.37362638c.19805779.16117296.35126997.3571417.45964127.58791208.1083712.23077039.162556.4853466.162556.76373627 0 .43223659-.0990274.79853329-.2970852 1.0989011-.19805775.3003678-.48766622.57509033-.86883404.82417582.44843273.25641154.78662068.53846 1.01457394.84615385.2279534.30769384.3419283.70329428.3419283 1.18681318 0 .32967199-.0616586.62820379-.1849776.89560439s-.2970841.4963361-.52130043.6868132c-.22421636.1904771-.49327197.3388273-.80717488.4450549-.31390292.1062277-.65769619.1593407-1.03139014.1593407s-.71188189-.0494501-1.01457399-.1483516c-.3026921-.0989016-.56053705-.2362629-.7735426-.412088-.21300555-.175825-.37742842-.3882771-.49327354-.6373626-.11584513-.2490855-.17376682-.527471-.17376682-.83516483zm3.60986547-.14285715c0-.16849901-.04110572-.32234362-.12331838-.46153846-.08221267-.13919483-.18871385-.2655672-.31950673-.37912088s-.27653134-.21794824-.43721973-.31318681c-.1606884-.09523857-.32324283-.18681275-.48766816-.27472527-.35127231.19780318-.59230129.41208675-.72309417.64285714-.13079289.23077038-.19618834.45970582-.19618834.68681319 0 .29304177.10276429.54395497.30829596.75274727.20553167.2087922.49140325.3131868.85762332.3131868.33632455 0 .6072486-.0805853.81278027-.2417583.20553167-.1611729.30829596-.4029287.30829596-.72527468zm-2.02914798-3.76923077c0 .17582506.03363195.32966968.10089686.46153847s.15881855.24725225.27466368.34615384c.11584512.0989016.24663604.19047577.39237668.27472528.14574064.0842495.29708442.16300329.45403587.23626373.44843274-.37362824.67264574-.78388055.67264574-1.23076923 0-.30769384-.09155364-.54029225-.27466367-.69780219-.18311004-.15750995-.4054546-.23626374-.66704036-.23626374-.32885068 0-.56987966.08424824-.72309417.25274725-.15321452.16849901-.22982063.36629923-.22982063.59340659z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.5 6.56043956c0-.37362824.05473109-.71794714.16419492-1.03296703.10946382-.31501989.26836054-.58424797.47669491-.80769231.20833438-.22344434.46256912-.39926676.76271186-.52747253.30014275-.12820577.64441897-.19230769 1.03283899-.19230769.79802659 0 1.42478586.24725027 1.88029661.74175824.45551071.49450797.68326271 1.21428099.68326271 2.15934066 0 .8498211-.1041656 1.58424599-.3125 2.2032967-.20833437.61905072-.48728639 1.1355291-.83686441 1.5494506-.34957802.4139214-.75388188.7307681-1.21292373.9505494-.45904184.2197813-.94279406.3516481-1.45127118.3956044l-.29661017-1.1208791c.38842002-.0512823.73446176-.1501824 1.03813559-.2967033.30367384-.1465209.56497066-.3278378.78389831-.5439561.21892765-.21611826.39724507-.46153705.53495762-.7362637.13771256-.27472665.23481611-.56959549.29131356-.88461538-.16949237.19047714-.35134083.32234395-.54555084.39560439s-.45374132.10989011-.7786017.10989011c-.26836292 0-.5349563-.04761857-.79978813-.14285714-.26483184-.09523857-.50141139-.23992577-.70974577-.43406593-.20833437-.19414017-.3778242-.43955896-.50847457-.73626374s-.19597458-.64651813-.19597458-1.04945055zm1.33474576-.07692308c0 .41758451.11299322.73259967.33898305.94505495.22598983.21245527.50847288.31868132.84745763.31868132.28954947 0 .52612903-.04761857.70974576-.14285715.18361674-.09523857.32485827-.21245351.42372882-.35164835.02118654-.15384692.03177966-.3003656.03177966-.43956044 0-.20512923-.02471727-.40659241-.07415254-.6043956-.04943528-.19780319-.1253526-.37362561-.22775424-.52747253s-.23305005-.27655632-.39194915-.36813187-.34780964-.13736263-.56673729-.13736263c-.34604693 0-.61440583.11538346-.80508475.34615384-.19067892.23077039-.28601695.55128-.28601695.96153846z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-8.01098901c0 1.28938374.20150072 2.28021631.6045082 2.97252751.40300748.6923111 1.03141649 1.0384615 1.8852459 1.0384615.80601496 0 1.42588581-.329667 1.85963115-.989011.43374535-.6593439.65061475-1.66665988.65061475-3.02197801 0-1.36264418-.2015007-2.36812863-.6045082-3.01648352-.40300748-.64835489-1.03483176-.97252747-1.8954918-.97252747-.80601496 0-1.42417818.32783555-1.8545082.98351648-.43033002.65568094-.6454918 1.65750242-.6454918 3.00549451zm1.33196721 0c0-.94505967.09050456-1.64468637.2715164-2.0989011.18101183-.45421473.47643237-.68131868.88627049-.68131868.43033002 0 .73428873.24175582.91188524.72527472.17759652.48351891.26639345 1.16849374.26639345 2.05494506 0 .97436385-.09391983 1.68497945-.2817623 2.13186811-.18784247.4468887-.48326301.6703297-.88627049.6703297-.41666875 0-.71550456-.2435873-.89651639-.7307692-.18101184-.48718196-.2715164-1.17765125-.2715164-2.07142861z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.06521739-5.2359551v1.2359551h4.56521739v-1.2359551h-1.55606407v-6.7640449h-.83524028l-2.60869565 2.06741573.62929062.84269663 1.01830663-.68539326.54919909-.66292135-.17162472.76404495v4.4382022z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.3218527-9.92717087c0-.34360582-.0593818-.64425641-.1781472-.90196078-.1187655-.25770437-.28107581-.47245479-.4869359-.64425771-.2058601-.17180291-.45130499-.30252056-.73634205-.39215686-.28503705-.0896363-.59778135-.13445378-.93824228-.13445378-.53048563 0-.9916845.0728284-1.38361045.21848739-.39192595.145659-.74227874.33800068-1.05106888.57703082l.6175772 1.03081232c.182107-.15686353.40577856-.28571378.67102137-.38655462.26524282-.10084084.52454347-.1512605.77790974-.1512605.4038025 0 .69873225.09897193.8847981.29691876.18606586.19794684.27909739.45004516.27909739.75630252 0 .25396953-.05344365.5228744-.16033254.80672269-.1068889.2838483-.25138468.5770293-.43349169.87955182-.18210701.30252253-.38796401.60317311-.6175772.90196079-.22961318.29878767-.4651611.58823389-.70665083.86834734-.24148972.28011347-.48099643.54528357-.71852731.79551817-.23753088.2502347-.45130547.4687199-.64133017.6554622v.7507003h5v-1.232493h-2.28028504l-.85510688.1568627v-.0560224l.62945368-.4593837c.26128396-.291318.52850219-.61064254.80166271-.95798321.27316051-.34734067.52256419-.7077479.74821852-1.08123249.22565434-.37348459.4117174-.75443317.55819481-1.14285714.1464773-.38842398.2197149-.77310734.2197149-1.15406163z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-.55952381-5.232493c-.30952536 0-.58928446-.0298783-.83928571-.0896359-.25000125-.0597575-.47817358-.1381881-.68452381-.2352941l-.41666667 1.2100841c.23015988.1120453.53174417.1979455.9047619.257703.37301774.0597576.73412524.0896359 1.08333334.0896359.42063702 0 .81349024-.0522871 1.17857143-.1568627.36508119-.1045757.68452244-.2651717.95833333-.4817928.27381089-.216621.4880945-.4855259.6428571-.8067227.1547627-.3211967.2321429-.70214527.2321429-1.14285709 0-.35107552-.055555-.66106309-.1666667-.92997199-.1111116-.26890891-.2599197-.4948637-.44642854-.67787115-.18650887-.18300745-.40476065-.32306207-.6547619-.42016807-.25000125-.09710599-.5138875-.15686263-.79166667-.17927171l-.5.06722689v-.05602241l.52380952-.302521 1.67857139-2.11764706v-.79551821h-4.547619v1.232493h2l.94047619-.10084034-.67857143.50420168-1.44047619 1.8487395v.77310924h.85714285c.57936798 0 1.00396691.10083933 1.27380953.30252101s.4047619.51540403.4047619.94117647c0 .35107552-.12896696.64985874-.38690476.89635854s-.63293405.3697479-1.125.3697479z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.5-6.21276596v-1.18014184h-1.23595506v-4.6070922h-1.20224719l-3.56179775 4.94751773v.83971631h3.40449438v2.21276596h1.35955056v-2.21276596zm-2.59550562-2.91631205v1.73617021h-1.33707865l-.71910112.09078014.56179775-.43120567 1.16853933-1.5319149.38202247-.81702127h.04494382z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-.68181818-5.2885154c-.31100634 0-.57615521-.0205414-.79545455-.0616247s-.42065299-.0989725-.60406698-.1736694l-.41866029 1.210084c.2232866.097106.49640987.1736692.81937799.2296919s.6638738.0840336 1.02272727.0840336c.45454773 0 .87320383-.0560218 1.25598086-.1680672.38277704-.1120454.71570832-.280111.99880383-.5042017.28309552-.2240908.50438515-.5042.66387565-.8403361.1594904-.3361362.2392344-.72455433.2392344-1.16526615 0-.37348459-.059808-.71148308-.1794258-1.0140056-.1196179-.30252252-.2910675-.56022303-.5143541-.77310924-.22328661-.21288622-.49242267-.37908437-.80741627-.49859944s-.66786089-.18674129-1.05861244-.20168068l-.49043062.04481793v-1.51260504h2.77511963v-1.36694678h-4.11483255v4.10084034l.94497607-.03361345c.60606364 0 1.07256615.10457412 1.39952153.31372549.32695539.20915137.49043063.53781289.49043063.9859944 0 .41830274-.13955204.74696422-.41866029.98599442-.27910825.2390301-.68181555.3585434-1.20813397.3585434z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.5-6.53846154c0-.38095428-.0534183-.71794725-.1602564-1.01098901-.1068382-.29304176-.2564093-.54029203-.44871796-.74175824-.19230865-.20146621-.42378782-.35347934-.69444444-.45604396-.27065663-.10256461-.56623772-.15384615-.88675214-.15384615-.34188205 0-.62677949.06410192-.85470085.19230769-.22792137.12820577-.41310471.28388187-.55555556.46703297.06410288-.30769385.17628125-.60622566.33653846-.8956044.16025721-.28937873.3561242-.55128088.58760684-.78571428.23148264-.23443341.49679337-.4358966.79594017-.60439561.29914679-.16849901.62677885-.28205099.98290598-.34065934l-.30982906-1.13186813c-.51282307.08791253-.99892932.26556643-1.45833333.53296703-.45940401.26740061-.86182164.61904544-1.20726496 1.05494506-.34544332.43589961-.6196571.94688351-.82264957 1.53296703s-.30448718 1.24175462-.30448718 1.96703297c0 .4835189.06410192.90842307.19230769 1.27472531.12820577.3663022.30626667.6703284.53418804.9120879.22792136.2417594.49679332.4230763.80662393.543956s.64992692.1813187 1.02029914.1813187c.36324968 0 .69622356-.0659334.99893163-.1978022.30270806-.1318688.56089636-.3113542.77457265-.5384615.21367632-.2271074.37927292-.494504.49679482-.8021978.117522-.3076939.1762821-.64102388.1762821-1.00000004zm-1.34615385.07692308c0 .3663022-.10505593.66666546-.31517094.90109886s-.48254818.3516484-.81730769.3516484c-.20655374 0-.38461464-.0421241-.53418803-.1263736-.1495734-.0842495-.27243542-.1941386-.36858975-.3296704-.09615432-.1355318-.16915929-.2893764-.21901709-.46153843s-.07478633-.34615296-.07478633-.52197802c0-.05860835 0-.11721582 0-.17582417 0-.05860836.00712244-.12820473.02136753-.20879121.07834797-.17582506.21545486-.32966967.41132478-.46153846.19586993-.1318688.43625214-.1978022.72115385-.1978022.7834797 0 1.17521367.41025231 1.17521367 1.23076923z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.01219512-4h1.40798226l3.10421286-7.56571429v-.43428571h-5v1.39428571h2.84922395l.66518847-.11428571-.48780488.56z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-6.03296703c0 .30769383.05792169.58607933.17376682.83516483.11584512.2490855.28026799.4615376.49327354.6373626.21300555.1758251.4708505.3131864.7735426.412088.3026921.0989015.64088004.1483516 1.01457399.1483516s.71748722-.053113 1.03139014-.1593407c.31390291-.1062276.58295852-.2545778.80717488-.4450549.22421633-.1904771.39798143-.4194126.52130043-.6868132s.1849776-.5659324.1849776-.89560439c0-.4835189-.1139749-.87911934-.3419283-1.18681318-.22795326-.30769385-.56614121-.58974231-1.01457394-.84615385.38116782-.24908549.67077629-.52380802.86883404-.82417582.1980578-.30036781.2970852-.66666451.2970852-1.0989011 0-.27838967-.0541848-.53296588-.162556-.76373627-.1083713-.23077038-.26158348-.42673912-.45964127-.58791208-.19805779-.16117297-.43534989-.28571385-.71188341-.37362638s-.58295796-.13186813-.91928251-.13186813c-.36622007 0-.69506581.05128154-.98654708.15384615-.29148128.10256462-.53998403.24542033-.7455157.42857143s-.36248077.39926616-.47085202.64835165c-.10837124.2490855-.16255605.51648209-.16255605.8021978 0 .43956264.10463274.80769083.31390134 1.10439561.20926861.29670478.49700864.55860692.8632287.78571428-.19432085.10989066-.37555969.23076857-.54372197.36263737-.16816227.13186879-.31390073.28021895-.43721973.44505494s-.21860953.34798434-.28587444.54945055-.10089686.43040165-.10089686.68681319zm3.60986547-.14285715c0 .32234598-.10276429.56410178-.30829596.72527468-.20553167.161173-.47645572.2417583-.81278027.2417583-.36622007 0-.65209165-.1043946-.85762332-.3131868-.20553167-.2087923-.30829596-.4597055-.30829596-.75274727 0-.22710737.06539545-.45604281.19618834-.68681319.13079288-.23077039.37182186-.44505396.72309417-.64285714.16442533.08791252.32697976.1794867.48766816.27472527.16068839.09523857.30642685.19963313.43721973.31318681s.23729406.23992605.31950673.37912088c.08221266.13919484.12331838.29303945.12331838.46153846zm-2.02914798-3.76923077c0-.22710736.07660611-.42490758.22982063-.59340659.15321451-.16849901.39424349-.25274725.72309417-.25274725.26158576 0 .48393032.07875379.66704036.23626374.18311003.15750994.27466367.39010835.27466367.69780219 0 .44688868-.224213.85714099-.67264574 1.23076923-.15695145-.07326044-.30829523-.15201423-.45403587-.23626373-.14574064-.08424951-.27653156-.17582368-.39237668-.27472528-.11584513-.09890159-.20739877-.21428505-.27466368-.34615384s-.10089686-.28571341-.10089686-.46153847z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-9.43956044c0 .40293242.06532421.75274577.19597458 1.04945055s.3001402.54212357.50847457.73626374c.20833438.19414016.44491393.33882736.70974577.43406593.26483183.09523857.53142521.14285714.79978813.14285714.32486038 0 .58439169-.03662967.7786017-.10989011s.37605847-.20512725.54555084-.39560439c-.05649745.31501989-.153601.60988873-.29131356.88461538-.13771255.27472665-.31602997.52014544-.53495762.7362637-.21892765.2161183-.48022447.3974352-.78389831.5439561-.30367383.1465209-.64971557.245421-1.03813559.2967033l.29661017 1.1208791c.50847712-.0439563.99222934-.1758231 1.45127118-.3956044.45904185-.2197813.86334571-.536628 1.21292373-.9505494.34957802-.4139215.62853004-.93039988.83686441-1.5494506.2083344-.61905071.3125-1.3534756.3125-2.2032967 0-.94505967-.227752-1.66483269-.68326271-2.15934066-.45551075-.49450797-1.08227002-.74175824-1.88029661-.74175824-.38842002 0-.73269624.06410192-1.03283899.19230769-.30014274.12820577-.55437748.30402819-.76271186.52747253-.20833437.22344434-.36723109.49267242-.47669491.80769231-.10946383.31501989-.16419492.65933879-.16419492 1.03296703zm1.33474576-.07692308c0-.41025846.09533803-.73076807.28601695-.96153846.19067892-.23077038.45903782-.34615384.80508475-.34615384.21892765 0 .40783819.04578708.56673729.13736263s.28954751.21428495.39194915.36813187.17831896.32966934.22775424.52747253c.04943527.19780319.07415254.39926637.07415254.6043956 0 .13919484-.01059312.28571352-.03177966.43956044-.09887055.13919484-.24011208.25640978-.42372882.35164835-.18361673.09523858-.42019629.14285715-.70974576.14285715-.33898475 0-.6214678-.10622605-.84745763-.31868132-.22598983-.21245528-.33898305-.52747044-.33898305-.94505495z\"/></svg>'\n        ]\n    },\n    start: function() {\n        this.app.toolbar.add(\"icons\", {\n            title: \"## icons.icons ##\",\n            icon: this.opts.icons.icon,\n            command: \"icons.popup\",\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        var icons = this.opts.icons.items;\n        for(var i = 0; i < icons.length; i++)items[i] = {\n            html: this.dom(\"<div>\").addClass(this.prefix + \"-popup-item\").html(icons[i]),\n            command: \"icons.insert\",\n            params: {\n                icon: icons[i]\n            }\n        };\n        this.app.popup.create(\"icons\", {\n            type: \"grid\",\n            width: \"160px\",\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    insert: function(params) {\n        this.app.popup.close();\n        this.app.insertion.insertHtml(params.icon, \"after\");\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"imageposition\", {\n    translations: {\n        en: {\n            \"imageposition\": {\n                \"image-position\": \"Image position\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m15 13c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-13c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm-5-12c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .44771525 1 1 0 .5522847-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1 0-.55228475.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z\"/></svg>',\n        items: {\n            none: \"none\",\n            left: \"float-left\",\n            center: \"align-center\",\n            right: \"float-right\"\n        },\n        icons: {\n            none: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-5 7-1 1h2zm4-5h-6v5l2-2 3 3h1zm-2 1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z\"/></svg>',\n            left: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1s.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z\"/></svg>',\n            center: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm3 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1-1-.4477153-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1-1-.4477153-1-1 .44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm4 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm6-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z\"/></svg>',\n            right: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m14 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-11 8c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm-10 2c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1zm8-1c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-8-3c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z\"/></svg>'\n        }\n    },\n    start: function() {\n        this.app.toolbar.add(\"imageposition\", {\n            title: \"## imageposition.image-position ##\",\n            command: \"imageposition.popup\",\n            icon: this.opts.imageposition.icon,\n            blocks: {\n                types: [\n                    \"image\"\n                ]\n            }\n        });\n    },\n    popup: function(params, button) {\n        var segments = {};\n        var obj = this.opts.imageposition.items;\n        for(var key in obj){\n            if (!obj[key]) continue;\n            segments[key] = {\n                name: obj[key],\n                icon: this.opts.imageposition.icons[key]\n            };\n        }\n        // create\n        this.app.popup.create(\"imageposition\", {\n            setter: \"imageposition.setFloat\",\n            getter: \"imageposition.getFloat\",\n            form: {\n                \"ifloat\": {\n                    type: \"segment\",\n                    label: \"## imageposition.image-position ##\",\n                    segments: segments\n                }\n            }\n        });\n        // open\n        this.app.popup.open({\n            button: button\n        });\n    },\n    getFloat: function() {\n        var obj = this.opts.imageposition.items;\n        if (!obj) return false;\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var value = \"none\";\n        for(var key in obj)if ($block.hasClass(obj[key])) value = key;\n        return {\n            \"ifloat\": value\n        };\n    },\n    setFloat: function(popup) {\n        this.app.popup.close();\n        // get data\n        var data = popup.getData();\n        var instance = this.app.block.get();\n        instance.setClassFromObj(this.opts.imageposition.items, data.ifloat);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"imageresize\", {\n    translations: {\n        en: {\n            \"imageresize\": {\n                \"image-resize\": \"Image resize\"\n            }\n        }\n    },\n    defaults: {\n        minHeight: 20,\n        minWidth: 100,\n        zIndex: 97\n    },\n    subscribe: {\n        \"editor.blur, editor.select\": function() {\n            this.stop();\n        },\n        \"image.position\": function() {\n            this._setResizerPosition();\n        },\n        \"editor.unparse, editor.before.cut, editor.before.copy\": function(event) {\n            this._unparse(event);\n        },\n        \"block.set\": function(event) {\n            this._load();\n        }\n    },\n    stop: function() {\n        this._remove();\n        this._stopEvents();\n    },\n    // private\n    _load: function() {\n        var block = this.app.block.get();\n        // remove resizer\n        this._remove();\n        if (block.isType(\"image\")) this._build(block);\n    },\n    _build: function(block) {\n        this.$block = block.getBlock();\n        this.$image = block.getImage();\n        // create\n        this.$resizer = this.dom(\"<span>\");\n        this.$resizer.attr(\"id\", this.prefix + \"-image-resizer\");\n        this.$resizer.css({\n            \"position\": \"absolute\",\n            \"z-index\": this.opts.imageresize.zIndex,\n            \"background-color\": \"#007dff\",\n            \"width\": \"15px\",\n            \"height\": \"15px\",\n            \"border-radius\": \"8px\",\n            \"font-size\": \"0\",\n            \"border\": \"2px solid #fff\",\n            \"cursor\": \"ew-resize\"\n        });\n        this.$image.after(this.$resizer);\n        this._setResizerPosition();\n        setTimeout(this._setResizerPosition.bind(this), 30);\n        this.$resizer.on(\"mousedown touchstart\", this._press.bind(this));\n    },\n    _setResizerPosition: function() {\n        var offsetFix = 9;\n        var pos = this.$image.position();\n        var width = this.$image.width();\n        var height = this.$image.height();\n        var resizerWidth = this.$resizer.width();\n        var resizerHeight = this.$resizer.height();\n        this.$resizer.css({\n            top: Math.round(pos.top + height / 2 - resizerHeight + offsetFix) + \"px\",\n            left: Math.round(pos.left + width - resizerWidth + offsetFix) + \"px\"\n        });\n    },\n    _press: function(e) {\n        e.preventDefault();\n        var h = this.$image.height();\n        var w = this.$image.width();\n        this.resizeHandle = {\n            x: e.pageX,\n            y: e.pageY,\n            el: this.$image,\n            $figure: this.$image.closest(\"figure\"),\n            ratio: w / h,\n            h: h,\n            w: w\n        };\n        this.app.editor.getDoc().on(\"mousemove.\" + this.prefix + \".image-resize touchmove.\" + this.prefix + \".image-resize\", this._move.bind(this));\n        this.app.editor.getDoc().on(\"mouseup.\" + this.prefix + \".image-resize touchend.\" + this.prefix + \".image-resize\", this._release.bind(this));\n        this.app.$doc.on(\"mouseup.\" + this.prefix + \".image-resize touchend.\" + this.prefix + \".image-resize\", this._release.bind(this));\n        this.app.broadcast(\"image.resize.start\", {\n            e: e,\n            block: this.$block,\n            image: this.$image\n        });\n    },\n    _move: function(e) {\n        e.preventDefault();\n        var width = this._getWidth(e);\n        var height = width / this.resizeHandle.ratio;\n        var $el = this.resizeHandle.el;\n        var o = this.opts.imageresize;\n        height = Math.round(height);\n        width = Math.round(width);\n        if (height < o.minHeight || width < o.minWidth) return;\n        if (this._getResizableBoxWidth() <= width) return;\n        if (this.resizeHandle.$figure.length !== 0 && this.resizeHandle.$figure.css(\"max-width\") !== \"\") this.resizeHandle.$figure.css(\"max-width\", width + \"px\");\n        $el.attr({\n            width: width,\n            height: height\n        });\n        //$el.width(width);\n        //$el.css('max-width', width + 'px');\n        //$el.height(height);\n        this._setResizerPosition();\n        this.app.broadcast(\"image.resize.move\", {\n            e: e,\n            block: this.$block,\n            image: this.$image\n        });\n    },\n    _release: function(e) {\n        this._stopEvents();\n        this.app.broadcast(\"image.resize.stop\", {\n            e: e,\n            block: this.$block,\n            image: this.$image\n        });\n    },\n    _stopEvents: function() {\n        this.app.editor.getDoc().off(\".\" + this.prefix + \".image-resize\");\n        this.app.$doc.off(\".\" + this.prefix + \".image-resize\");\n    },\n    _remove: function() {\n        this.app.editor.getLayout().find(\"#\" + this.prefix + \"-image-resizer\").remove();\n    },\n    _getWidth: function(e) {\n        var width = this.resizeHandle.w;\n        if (e.targetTouches) width += e.targetTouches[0].pageX - this.resizeHandle.x;\n        else width += e.pageX - this.resizeHandle.x;\n        return width;\n    },\n    _getResizableBoxWidth: function() {\n        var $el = this.app.editor.getLayout();\n        var width = $el.width();\n        return width - parseInt($el.css(\"padding-left\")) - parseInt($el.css(\"padding-right\"));\n    },\n    _unparse: function(event) {\n        var html = event.get(\"html\");\n        html = this.app.utils.wrap(html, (function($w) {\n            $w.find(\"#\" + this.prefix + \"-image-resizer\").remove();\n        }).bind(this));\n        event.set(\"html\", html);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"inlineformat\", {\n    translations: {\n        en: {\n            \"inlineformat\": {\n                \"inline-format\": \"Inline Format\",\n                \"underline\": \"Underline\",\n                \"superscript\": \"Superscript\",\n                \"subscript\": \"Subscript\",\n                \"mark\": \"Mark\",\n                \"code\": \"Code\",\n                \"shortcut\": \"Shortcut\",\n                \"remove-format\": \"Remove Format\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m7.39849577 1.20113038c-3.5610278 2.68125517-5.39849577 5.14152807-5.39849577 7.49360646 0 3.50902886 2.59345039 6.30526316 6 6.30526316 3.4065496 0 6-2.7962343 6-6.30526316 0-2.35207839-1.837468-4.81235129-5.39849577-7.49360646-.35616697-.26817384-.84684149-.26817384-1.20300846 0zm.60150423 2.06186962.28200813.22720401c2.50634097 2.04313256 3.71799187 3.80538426 3.71799187 5.20453283 0 2.43669386-1.73306 4.30526316-4 4.30526316-2.26694005 0-4-1.8685693-4-4.30526316 0-1.39914857 1.21165095-3.16140027 3.71799187-5.20453283z\"/></svg>',\n        items: [\n            \"u\",\n            \"sup\",\n            \"sub\",\n            \"mark\",\n            \"code\",\n            \"kbd\"\n        ],\n        itemsObj: {\n            u: {\n                title: '<span style=\"text-decoration: underline;\">## inlineformat.underline ##</span>',\n                params: {\n                    tag: \"u\"\n                },\n                shortcut: \"Ctrl+u\"\n            },\n            sup: {\n                title: \"## inlineformat.superscript ##<sup>x</sup>\",\n                params: {\n                    tag: \"sup\"\n                },\n                shortcut: \"Ctrl+h\"\n            },\n            sub: {\n                title: \"## inlineformat.subscript ##<sub>x</sub>\",\n                params: {\n                    tag: \"sub\"\n                },\n                shortcut: \"Ctrl+l\"\n            },\n            mark: {\n                title: '<span style=\"background: yellow;\">## inlineformat.mark ##</span>',\n                params: {\n                    tag: \"mark\"\n                }\n            },\n            code: {\n                title: '<span style=\"font-family: monospace; background: #f0f1f2; padding: 4px;\">## inlineformat.code ##</span>',\n                params: {\n                    tag: \"code\"\n                }\n            },\n            kbd: {\n                title: \"## inlineformat.shortcut ##\",\n                params: {\n                    tag: \"kbd\"\n                }\n            }\n        }\n    },\n    start: function() {\n        this.app.toolbar.add(\"inlineformat\", {\n            title: \"## inlineformat.inline-format ##\",\n            icon: this.opts.inlineformat.icon,\n            position: {\n                after: \"deleted\"\n            },\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            },\n            command: \"inlineformat.popup\"\n        });\n    },\n    popup: function(params, button) {\n        var arr = this.opts.inlineformat.items;\n        var inlines = this.app.selection.getNodes({\n            type: \"inline\"\n        });\n        var items = {};\n        for(var i = 0; i < arr.length; i++){\n            var key = arr[i];\n            items[key] = this.opts.inlineformat.itemsObj[key];\n            items[key].command = \"inline.set\";\n        }\n        // remove format\n        if (inlines.length !== 0) items[\"remove\"] = {\n            title: \"## inlineformat.remove-format ##\",\n            divider: \"top\",\n            command: \"inline.removeFormat\"\n        };\n        this.app.popup.create(\"inlineformat\", {\n            width: \"300px\",\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"makebutton\", {\n    translations: {\n        en: {\n            \"makebutton\": {\n                \"make-a-button\": \"Make a Button\",\n                \"remove-button\": \"Remove button\",\n                \"button\": \"Button\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m13 3c1.6568542 0 3 1.34314575 3 3v4c0 1.6568542-1.3431458 3-3 3h-10c-1.65685425 0-3-1.3431458-3-3v-4c0-1.65685425 1.34314575-3 3-3zm0 2h-10c-.55228475 0-1 .44771525-1 1v4c0 .5522847.44771525 1 1 1h10c.5522847 0 1-.4477153 1-1v-4c0-.55228475-.4477153-1-1-1zm-8 2h6c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-6c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z\"/></svg>',\n        items: false\n    },\n    start: function() {\n        if (this.opts.makebutton.items === false) return;\n        this.app.toolbar.add(\"makebutton\", {\n            title: \"## makebutton.make-a-button ##\",\n            icon: this.opts.makebutton.icon,\n            command: \"makebutton.toggle\",\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            },\n            active: {\n                tags: [\n                    \"a\"\n                ]\n            },\n            position: {\n                after: \"link\"\n            }\n        });\n    },\n    toggle: function(params, button) {\n        var obj = this.opts.makebutton.items;\n        var items = {};\n        for(var key in obj){\n            items[key] = obj[key];\n            items[key].command = \"makebutton.set\";\n        }\n        // remove\n        items[\"remove\"] = {\n            title: \"## makebutton.remove-button ##\",\n            divider: \"top\",\n            command: \"makebutton.remove\"\n        };\n        this.app.popup.create(\"makebutton\", {\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    set: function(params, item, name) {\n        this.app.popup.close();\n        var obj = this.opts.makebutton.items[name];\n        var $link = this.app.link.getLink();\n        if ($link.length === 0) {\n            var nodes = this.app.inline.set({\n                tag: \"a\",\n                caret: \"after\"\n            });\n            $link = this.dom(nodes[0]);\n            $link.attr(\"href\", \"#\");\n            $link.text(this.lang.get(\"makebutton.button\"));\n        }\n        this._removeClasses($link);\n        $link.addClass(obj.params.classname);\n    },\n    remove: function() {\n        this.app.popup.close();\n        var $link = this.app.link.getLink();\n        this._removeClasses($link);\n    },\n    // private\n    _getClasses: function() {\n        var classes = [];\n        var obj = this.opts.makebutton.items;\n        for(var key in obj)classes.push(obj[key].params.classname);\n        return classes;\n    },\n    _removeClasses: function($link) {\n        var classes = this._getClasses();\n        for(var i = 0; i < classes.length; i++)$link.removeClass(classes[i]);\n    }\n});\n\n\n// Icon\nArticleEditor.iconMath = '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m11 2c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-3.92l2.70086881 3.37530495c.26561359.33201696.28976029.79108692.07244006 1.14620443l-.07244006.10318567-2.70186881 3.37530495h3.921c.5128358 0 .9355072.3860402.9932723.8833789l.0067277.1166211c0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-6c-.80039229 0-1.26153081-.8837601-.84621928-1.5335763l.06535047-.0911187 3.49986881-4.375305-3.49986881-4.37530495c-.5000011-.62500138-.09797137-1.53717061.66889291-1.61880377l.1119759-.00589128z\"/></svg>';\n// Block\nArticleEditor.add(\"block\", \"block.math\", {\n    mixins: [\n        \"block\"\n    ],\n    type: \"math\",\n    inline: true,\n    editable: false,\n    control: false,\n    toolbar: {\n        add: {\n            command: \"addbar.popup\",\n            title: \"## buttons.add ##\"\n        },\n        tags: {\n            command: \"math.edit\",\n            title: \"## math.math ##\",\n            icon: ArticleEditor.iconMath\n        }\n    },\n    create: function() {\n        return this.dom(\"<span>\").addClass(\"math\");\n    }\n});\n// Plugin\nArticleEditor.add(\"plugin\", \"math\", {\n    translations: {\n        en: {\n            \"math\": {\n                \"math\": \"Math\",\n                \"label\": \"Type an expression\",\n                \"add\": \"Add\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\"\n            },\n            \"blocks\": {\n                \"math\": \"Math\"\n            }\n        }\n    },\n    defaults: {\n        classname: \"math\",\n        mathjax: false,\n        delimiters: [\n            {\n                left: \"$$\",\n                right: \"$$\",\n                display: true\n            },\n            //{ left: \"$\", right: \"$\", display: false },\n            {\n                left: \"\\\\(\",\n                right: \"\\\\)\",\n                display: false\n            },\n            {\n                left: \"\\\\[\",\n                right: \"\\\\]\",\n                display: true\n            }\n        ]\n    },\n    popups: {\n        add: {\n            title: \"## math.math ##\",\n            width: \"100%\",\n            form: {\n                text: {\n                    label: \"## math.label ##\",\n                    type: \"textarea\",\n                    rows: 6\n                }\n            },\n            footer: {\n                insert: {\n                    title: \"## math.add ##\",\n                    command: \"math.insert\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## math.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        },\n        edit: {\n            title: \"## math.math ##\",\n            width: \"100%\",\n            form: {\n                text: {\n                    label: \"## math.label ##\",\n                    type: \"textarea\",\n                    rows: 6\n                }\n            },\n            footer: {\n                save: {\n                    title: \"## math.save ##\",\n                    command: \"math.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## math.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        }\n    },\n    subscribe: {\n        \"editor.parse\": function(event) {\n            this._parse(event);\n        },\n        \"editor.unparse, editor.before.cut, editor.before.copy\": function(event) {\n            this._unparse(event);\n        },\n        \"editor.ready, source.close, state.undo, state.redo, editor.paste\": function() {\n            this._render();\n        }\n    },\n    start: function() {\n        this.app.addbar.add(\"math\", {\n            title: \"## blocks.math ##\",\n            icon: ArticleEditor.iconMath,\n            command: \"math.popup\"\n        });\n    },\n    popup: function() {\n        var stack = this.app.popup.add(\"math\", this.popups.add);\n        stack.open({\n            focus: \"text\"\n        });\n    },\n    edit: function(params, button) {\n        var stack = this.app.popup.create(\"math\", this.popups.edit);\n        // data\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var code = decodeURI($block.attr(\"data-math-code\"));\n        code = this._decodeSigns(code);\n        // set\n        stack.setData({\n            text: code\n        });\n        // open\n        this.app.popup.open({\n            button: button,\n            focus: \"text\"\n        });\n    },\n    save: function(stack) {\n        this.app.popup.close();\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        var code = this._buildBlock($block, stack);\n        if (code !== false) {\n            this._renderDisplay($block);\n            this._renderTypeset($block, code);\n        }\n    },\n    insert: function(stack) {\n        this.app.popup.close();\n        // create\n        var instance = this.app.create(\"block.math\");\n        var $block = instance.getBlock();\n        var code = this._buildBlock($block, stack);\n        if (code !== false) {\n            this.app.block.add({\n                instance: instance\n            });\n            this._renderDisplay($block);\n            this._renderTypeset($block, code);\n        }\n    },\n    // private\n    _buildBlock: function($block, stack) {\n        var data = stack.getData();\n        var code = data.text.trim();\n        var delim = this._parseDelim(code);\n        if (!delim) return false;\n        $block.attr(\"data-math-display\", delim.display);\n        $block.attr(\"data-math-code\", encodeURI(code));\n        // katex\n        if (!this.opts.math.mathjax) code = code.replace(delim.left, \"\").replace(delim.right, \"\");\n        $block.html(code);\n        return code;\n    },\n    _renderTypeset: function($block, code) {\n        if (this.opts.math.mathjax) // mathjax\n        this._getMathJax().typeset();\n        else // katex\n        this._renderNode($block, code);\n    },\n    _renderDisplay: function($node) {\n        var display = $node.attr(\"data-math-display\");\n        var obj = {\n            display: \"inline-block\",\n            \"text-align\": \"\"\n        };\n        if (display) {\n            obj = {\n                display: \"block\",\n                \"text-align\": \"center\"\n            };\n            $node.addClass(\"math-display\");\n        } else $node.removeClass(\"math-display\");\n        $node.css(obj);\n    },\n    _renderNode: function($node, code) {\n        this._getKatex().render(code, $node.get(), {\n            displayMode: $node.attr(\"data-math-display\")\n        });\n    },\n    _render: function() {\n        // mathjax\n        if (this.opts.math.mathjax) this._getMathJax().typeset();\n        this.app.editor.getBody().find(\".\" + this.opts.math.classname).each((function($node) {\n            this._renderDisplay($node);\n            // katex\n            if (!this.opts.math.mathjax) {\n                if ($node.attr(\"data-math-render\")) return;\n                this._renderNode($node, $node.text());\n                $node.attr(\"data-math-render\", true);\n            }\n        }).bind(this));\n    },\n    _parseDelim: function(code) {\n        var delim = this.opts.math.delimiters;\n        for(var i = 0; i < delim.length; i++){\n            var re = new RegExp(\"^\" + this.app.utils.escapeRegExp(delim[i].left));\n            if (code.search(re) !== -1) return delim[i];\n        }\n    },\n    _getMathJax: function() {\n        return this.app.editor.getWinNode().MathJax;\n    },\n    _getKatex: function() {\n        return this.app.editor.getWinNode().katex;\n    },\n    _getReplacer: function(code, datacode, display) {\n        var start = \"<span class=\" + this.opts.math.classname + \" data-\" + this.prefix + '-type=\"math\" data-math-code=\"' + datacode + '\" data-math-display=\"' + display + '\">';\n        var end = \"</span>\";\n        return start + code + end;\n    },\n    _encodeSigns: function(code) {\n        code = code.replace(/\\$\\$/g, \"xdoubledollarsignz\");\n        code = code.replace(/\\$/g, \"xsingledollarsignz\");\n        return code;\n    },\n    _decodeSigns: function(code) {\n        code = code.replace(/xdoubledollarsignz/g, \"$$$\");\n        code = code.replace(/xsingledollarsignz/g, \"$\");\n        return code;\n    },\n    _parse: function(event) {\n        var html = event.get(\"html\");\n        var delim = this.opts.math.delimiters;\n        for(var i = 0; i < delim.length; i++){\n            var rcont = delim[i].display ? \"([\\\\w\\\\W]*?)\" : \"(.*?)\";\n            var re = new RegExp(this.app.utils.escapeRegExp(delim[i].left) + rcont + this.app.utils.escapeRegExp(delim[i].right), \"g\");\n            var match = html.match(re);\n            if (match != null) for(var z = 0; z < match.length; z++){\n                // code\n                var code = match[z].trim();\n                var datacode = this._encodeSigns(code);\n                datacode = encodeURI(datacode);\n                // katex\n                if (!this.opts.math.mathjax) code = code.replace(delim[i].left, \"\").replace(delim[i].right, \"\");\n                // replace\n                html = html.replace(match[z], this._getReplacer(code, datacode, delim[i].display));\n            }\n        }\n        event.set(\"html\", html);\n    },\n    _unparse: function(event) {\n        var html = event.get(\"html\");\n        html = this.app.utils.wrap(html, (function($w) {\n            $w.find(\".\" + this.opts.math.classname).each((function($node) {\n                var code = decodeURI($node.attr(\"data-math-code\"));\n                code = this._decodeSigns(code);\n                code = code.replace(/&/g, \"xampsignmathz\");\n                $node.text(code);\n                $node.unwrap();\n            }).bind(this));\n        }).bind(this));\n        html = html.replace(/xampsignmathz/g, \"&\");\n        event.set(\"html\", html);\n    },\n    _copy: function(event) {\n        var html = event.get(\"html\");\n        event.set(\"html\", html);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"print\", {\n    translations: {\n        en: {\n            \"print\": {\n                \"print\": \"Print\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10.125 1c.9760221 0 1.7936348.73390752 1.8692894 1.6885462l.0057106.14478713v3.16666667h1.0714286c.9927325 0 1.8438171.72087115 1.9226216 1.68668386l.0059498.14664947v3.33333337c0 .989117-.8038115 1.757089-1.7808027 1.8279863l-.1477687.005347h-1.0714286v.25c0 .9538999-.7859079 1.674765-1.7254643 1.7444667l-.1495357.0055333h-5.25c-1.00418792 0-1.875-.7458949-1.875-1.75v-.25h-1.07142857c-.99273257 0-1.8438171-.7208712-1.92262167-1.6866839l-.00594976-.1466494v-3.33333337c0-.98911703.80381155-1.757089 1.78080273-1.82798629l.1477687-.00534704h1.07142857v-3.16666667c0-.97542885.77113545-1.75578536 1.7298577-1.82789317l.1451423-.00544016zm-.125 11h-5v1h5zm3-4h-11v3l1.17735638-.0000851c.30466973-.6036661.96572942-.9999149 1.69764362-.9999149h5.25c.7319142 0 1.3929739.3962488 1.6976436.9999149l1.1773564.0000851zm-3-5h-5v3h5z\"/></svg>'\n    },\n    start: function() {\n        this.app.editor.addButton(\"print\", {\n            title: \"## print.print ##\",\n            icon: this.opts.print.icon,\n            command: \"print.toggle\",\n            position: {\n                \"before\": \"html\"\n            }\n        });\n    },\n    toggle: function() {\n        this.app.editor.getWinNode().print();\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"removeformat\", {\n    translations: {\n        en: {\n            \"removeformat\": {\n                \"removeformat\": \"Remove Format\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 11c.51283584 0 .93550716.3860402.99327227.8833789l.00672773.1166211v1c0 .5522847-.44771525 1-1 1-.51283584 0-.93550716-.3860402-.99327227-.8833789l-.00672773-.1166211v-1c0-.5522847.44771525-1 1-1zm-4.60436072-5.91850958.10436072.05248418 9.5262794 5.5c.4782927.2761424.6421678.8877328.3660254 1.3660254-.2564179.4441289-.8020741.6171529-1.2616646.4185096l-.1043608-.0524842-9.5262794-5.5c-.47829262-.27614237-.64216778-.88773278-.3660254-1.3660254.25641792-.44412886.80207419-.61715287 1.26166468-.41850958zm9.60436072-3.08149042c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4.00016698l.00016698 2c0 .55228475-.44771525 1-1 1-.51283584 0-.93550716-.38604019-.99327227-.88337887l-.00672773-.11662113-.00016698-2h-3.99983302c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/></svg>'\n    },\n    start: function() {\n        var button = {\n            title: \"## removeformat.removeformat ##\",\n            icon: this.opts.removeformat.icon,\n            command: \"inline.removeFormat\",\n            position: {\n                after: [\n                    \"deleted\",\n                    \"italic\"\n                ]\n            },\n            blocks: {\n                all: \"editable\"\n            }\n        };\n        this.app.toolbar.add(\"removeformat\", button);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"reorder\", {\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m13 5c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-10c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/><path d=\"m13 9c.5522847 0 1 .44771525 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-10c-.55228475 0-1-.4477153-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/></g></svg>'\n    },\n    subscribe: {\n        \"block.set\": function() {\n            this._observe();\n        }\n    },\n    init: function() {},\n    start: function() {\n        this.app.control.add(\"reorder\", {\n            icon: this.opts.reorder.icon,\n            position: \"first\",\n            blocks: {\n                \"all\": \"first-level\"\n            }\n        });\n    },\n    stop: function() {\n        this._stopEvents();\n    },\n    // private\n    _observe: function() {\n        this.$btn = this.app.control.get(\"reorder\");\n        if (this.$btn.length === 0) return;\n        this.$btn.addClass(this.prefix + \"-handle\");\n        this._sortable();\n    },\n    _sortable: function() {\n        this.instance = this.app.block.get();\n        this.$win = this.app.editor.getWin();\n        this.tolerance = this.$btn.width();\n        this.$clickItem = null;\n        this.$dragItem = null;\n        this.oldY = 0;\n        this.dragging = false;\n        this.$btn.on(\"mousedown.\" + this.prefix + \"-reorder touchstart.\" + this.prefix + \"-reorder\", this._press.bind(this));\n    },\n    _press: function(e) {\n        var $target = this.dom(e.target).closest(\".\" + this.prefix + \"-button\");\n        if (e && e.target && $target.hasClass(this.prefix + \"-handle\")) {\n            e.preventDefault();\n            this.app.observer.trigger = false;\n            this.$win.on(\"mouseup.\" + this.prefix + \"-reorder touchend.\" + this.prefix + \"-reorder\", this._release.bind(this));\n            this.$win.on(\"mousemove.\" + this.prefix + \"-reorder touchmove.\" + this.prefix + \"-reorder\", this._move.bind(this));\n            var item = this.instance.getBlock().get();\n            this.app.block.unset();\n            this.dragging = true;\n            this.$dragItem = this._makeDragItem(item, e.target);\n        }\n    },\n    _release: function(e) {\n        this._stopEvents();\n        this.app.observer.trigger = true;\n        this.oldY = 0;\n        this.dragging = false;\n        this._trashDragItem();\n        this.app.block.set(this.instance);\n    },\n    _move: function(e) {\n        if (!this.$dragItem && !this.dragging) return;\n        e.preventDefault();\n        var framePos = this.app.editor.getFrameRect();\n        // direction & delta\n        var direction = false;\n        var deltaY = this.oldY === 0 ? 0 : this.oldY - e.pageY;\n        if (deltaY > 0) direction = \"up\";\n        else if (deltaY < 0) direction = \"down\";\n        // env\n        var tolerance = 40;\n        var isScrollTarget = this.app.scroll.isTarget();\n        var isFrameScroll = this._isFrameScroll();\n        var docScrollTop = this.app.$doc.scrollTop();\n        var $target = isScrollTarget ? this.app.scroll.getTarget() : this.app.$doc;\n        var scrollTop = isFrameScroll ? this.app.editor.getDoc().scrollTop() : $target.scrollTop();\n        // move\n        this._moveItem(this.$dragItem, deltaY);\n        this.oldY = e.pageY;\n        // autoscroll\n        var end, startStop = false;\n        if (isScrollTarget) end = $target.height() + $target.offset().top - tolerance;\n        else if (isFrameScroll) {\n            end = framePos.bottom - tolerance;\n            endWin = this.app.$win.height() + docScrollTop - tolerance;\n            if (endWin < end) end = endWin;\n        } else {\n            startStop = !this.app.toolbar.isSticky();\n            end = this.app.$win.height() + scrollTop - tolerance;\n        }\n        var $toolbar = this.app.container.get(\"bars\");\n        var toolbarHeight = $toolbar.height();\n        var scrollPoint = isFrameScroll ? e.pageY + framePos.top - scrollTop : e.pageY + framePos.top;\n        var start = $toolbar.offset().top + toolbarHeight + tolerance;\n        // scroll up\n        if (direction === \"up\" && scrollTop > 0 && scrollPoint < start && startStop === false) this._scroll(-10);\n        else if (direction === \"down\" && scrollPoint > end) this._scroll(10);\n        // place\n        var $elms = this.app.editor.getLayout().children();\n        var len = $elms.length;\n        for(var b = 0; b < len; b++){\n            var subItem = $elms.eq(b).get();\n            if (subItem === this.$clickItem.get()) continue;\n            if (this._isOver(this.dom(subItem))) this._swapItems(subItem);\n        }\n    },\n    _scroll: function(step) {\n        var $target = this.app.scroll.isTarget() ? this.app.scroll.getTarget() : this.app.$win;\n        var isFrameScroll = this._isFrameScroll();\n        if (isFrameScroll) $target = this.app.editor.getWin();\n        var scrollY = $target.scrollTop();\n        $target.scrollTop(scrollY + step);\n    },\n    _swapItems: function(target) {\n        var y = this.$dragItem.offset().top;\n        var $item = this.$clickItem;\n        var $target = this.dom(target);\n        var offset = $target.offset();\n        var height = $target.height() / 2;\n        var func = height + offset.top > y ? \"before\" : \"after\";\n        $target[func]($item);\n    },\n    _stopEvents: function() {\n        if (this.$win) {\n            this.$btn.off(\".\" + this.prefix + \"-reorder\");\n            this.$win.off(\".\" + this.prefix + \"-reorder\");\n        }\n    },\n    _isFrameScroll: function() {\n        var frameHeight = this.app.editor.getFrame().height();\n        var bodyHeight = this.app.editor.getBody().height();\n        return bodyHeight > frameHeight;\n    },\n    _isOver: function($target) {\n        var y = this.$dragItem.offset().top;\n        var offset = $target.offset();\n        var height = $target.height();\n        return y > offset.top && y < offset.top + height;\n    },\n    _moveItem: function($item, deltaY) {\n        var top = $item.offset().top;\n        top -= deltaY;\n        $item.css(\"top\", top + \"px\");\n    },\n    _makeDragItem: function(item) {\n        this._trashDragItem();\n        var $item = this.dom(item);\n        var offset = $item.offset();\n        this.$clickItem = $item;\n        this.$clickItem.addClass(this.prefix + \"-drag-active\");\n        var $cloned = $item.clone();\n        $cloned.removeClass(this.prefix + \"-drag-active \" + this.prefix + \"-element-active\");\n        var $dragItem = this.dom(\"<div>\").addClass(this.prefix + \"-dragging\");\n        $dragItem.append($cloned);\n        $dragItem.css({\n            \"opacity\": 0.95,\n            \"position\": \"absolute\",\n            \"z-index\": 999,\n            \"left\": offset.left + \"px\",\n            \"top\": offset.top + \"px\",\n            \"width\": $item.width() + \"px\"\n        });\n        this.app.editor.getBody().append($dragItem);\n        return $dragItem;\n    },\n    _trashDragItem: function() {\n        if (this.$dragItem && this.$clickItem) {\n            this.$clickItem.removeClass(this.prefix + \"-drag-active\");\n            this.$clickItem = null;\n            this.$dragItem.remove();\n            this.$dragItem = null;\n        }\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"selector\", {\n    translations: {\n        en: {\n            \"selector\": {\n                \"selector\": \"Selector\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10.6663083 2.14369002c.5071647.07664087.8669828.53941479.8491564 1.06286535l-.0109223.12172524-.2435424 1.67154209 1.239.0001773c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773-1.531-.0001773-.291 2 1.322.0001773c.5522847 0 1 .44771525 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277-1.613-.0001773-.3121956 2.1487091c-.08323349.571695-.59347185.9682364-1.13964926.8857001-.50716474-.0766409-.86698283-.5394148-.84915642-1.0628653l.01092235-.1217253.26807893-1.8498186h-1.978l-.31219557 2.1487091c-.08323352.571695-.59347188.9682364-1.13964929.8857001-.50716474-.0766409-.86698283-.5394148-.84915642-1.0628653l.01092235-.1217253.26807893-1.8498186-1.365.0001773c-.55228475 0-1-.4477153-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 1.656-.0001773.292-2-1.448.0001773c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 1.739-.0001773.28765901-1.97043255c.08323352-.571695.59347189-.96823646 1.1396493-.88570013.50716473.07664087.86698282.53941479.84915642 1.06286535l-.01092236.12172524-.24354237 1.67154209h1.978l.28765901-1.97043255c.08323352-.571695.59347189-.96823646 1.13964929-.88570013zm-2.0103083 6.85613268.292-2h-1.979l-.291 2z\"/></svg>',\n        popup: {\n            title: \"## selector.selector ##\",\n            width: \"100%\",\n            form: {\n                id: {\n                    type: \"input\",\n                    label: \"ID\"\n                },\n                classname: {\n                    type: \"input\",\n                    label: \"Class\"\n                }\n            },\n            footer: {\n                insert: {\n                    title: \"## selector.save ##\",\n                    command: \"selector.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## selector.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        }\n    },\n    init: function() {\n        this.arxclasses = [];\n    },\n    start: function() {\n        this.app.toolbar.add(\"selector\", {\n            title: \"## selector.selector ##\",\n            icon: this.opts.selector.icon,\n            blocks: {\n                all: \"all\",\n                except: [\n                    \"variable\"\n                ]\n            },\n            command: \"selector.popup\"\n        });\n    },\n    popup: function(params, button) {\n        // create\n        var stack = this.app.popup.create(\"selector\", this.opts.selector.popup);\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var classname = $block.attr(\"class\");\n        var id = $block.attr(\"id\");\n        // classes\n        var classes = classname.split(\" \");\n        var classname = \"\";\n        for(var i = 0; i < classes.length; i++)if (classes[i].search(this.prefix + \"-\") === -1) classname += classes[i] + \" \";\n        else this.arxclasses.push(classes[i]);\n        // data\n        stack.setData({\n            id: id,\n            classname: classname.trim()\n        });\n        // open\n        this.app.popup.open({\n            button: button,\n            focus: \"id\"\n        });\n    },\n    save: function(stack) {\n        this.app.popup.close();\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var data = stack.getData();\n        // set id\n        if (data.id === \"\") $block.removeAttr(\"id\");\n        else $block.attr(\"id\", data.id);\n        // set class\n        if (this.arxclasses.length > 0) data.classname = data.classname + \" \" + this.arxclasses.join(\" \");\n        $block.attr(\"class\", data.classname);\n        this.arxclasses = [];\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"slideshow\", {\n    translations: {\n        en: {\n            \"slideshow\": {\n                \"slideshow\": \"Slideshow\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\",\n                \"insert\": \"Insert\"\n            }\n        }\n    },\n    defaults: {\n        upload: false,\n        select: false,\n        name: \"file\",\n        data: false,\n        multiple: true\n    },\n    popups: {\n        add: {\n            title: \"## slideshow.slideshow ##\",\n            width: \"100%\",\n            footer: {\n                insert: {\n                    title: \"## slideshow.insert ##\",\n                    command: \"slideshow.insert\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## slideshow.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        },\n        edit: {\n            title: \"## slideshow.slideshow ##\",\n            width: \"100%\",\n            footer: {\n                save: {\n                    title: \"## slideshow.save ##\",\n                    command: \"slideshow.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## slideshow.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        }\n    },\n    start: function() {\n        this.app.addbar.add(\"slideshow\", {\n            title: \"## slideshow.slideshow ##\",\n            icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z\"/></svg>',\n            command: \"slideshow.popup\"\n        });\n    },\n    popup: function() {\n        // create\n        var stack = this.app.popup.add(\"slideshow\", this.popups.add);\n        // body\n        var $body = stack.getBody();\n        // box\n        this.$box = this.dom(\"<div>\").addClass(this.prefix + \"-slideshow-items\");\n        $body.append(this.$box);\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.slideshow.upload, $body);\n        // select box\n        this.app.image.createSelectBox(this.opts.slideshow.select, $body, \"slideshow.insertFromSelect\");\n        // open\n        stack.open();\n        // build upload\n        this._buildUpload(this.$upload, \"slideshow.insertByUpload\");\n    },\n    edit: function(params, button) {\n        // create\n        var stack = this.app.popup.create(\"slideshow\", this.popups.edit);\n        // body\n        var $body = stack.getBody();\n        // data\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        var $elms = $block.find(\"img\");\n        // box\n        this.$box = this.dom(\"<div>\").addClass(this.prefix + \"-slideshow-items\");\n        $body.append(this.$box);\n        // items\n        $elms.each((function($node) {\n            this._buildBoxItem($node.attr(\"src\"));\n        }).bind(this));\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.slideshow.upload, $body);\n        // select box\n        this.app.image.createSelectBox(this.opts.slideshow.select, $body, \"slideshow.insertFromSelect\");\n        // open\n        this.app.popup.open({\n            button: button\n        });\n        // build upload\n        this._buildUpload(this.$upload, \"slideshow.insertByUpload\");\n    },\n    insertByUpload: function(response) {\n        for(var key in response)this._buildBoxItem(response[key].url);\n    },\n    insertFromSelect: function(e) {\n        e.preventDefault();\n        var $target = this.dom(e.target);\n        this._buildBoxItem($target.attr(\"data-url\"));\n    },\n    insert: function() {\n        // instance\n        var instance = this.app.create(\"block.uk-slideshow\");\n        this.app.block.add({\n            instance: instance\n        });\n        // save\n        this.save();\n    },\n    save: function() {\n        var current = this.app.block.get();\n        var $elms = this.$box.find(\"img\");\n        if ($elms.length === 0) {\n            current.remove();\n            this.app.popup.close();\n            return;\n        }\n        var $block = current.getBlock();\n        var $inner = $block.find(\".uk-slideshow-items\");\n        $inner.html(\"\");\n        $elms.each((function($node, i) {\n            var src = $node.attr(\"src\");\n            var $item = this.dom(\"<li>\");\n            var $img = this.dom(\"<img>\").attr({\n                \"src\": src,\n                \"uk-cover\": true\n            });\n            $item.append($img);\n            $inner.append($item);\n        }).bind(this));\n        // close popup\n        this.app.popup.close();\n    },\n    // private\n    _removeItem: function(e) {\n        var $target = this.dom(e.target).closest(\".\" + this.prefix + \"-slideshow-item\");\n        $target.fadeOut((function($node) {\n            $node.remove();\n        }).bind(this));\n    },\n    _buildBoxItem: function(src) {\n        var $item = this.dom(\"<span>\").addClass(this.prefix + \"-slideshow-item\");\n        var $remover = this.dom(\"<span>\").addClass(this.prefix + \"-upload-remove\");\n        var $img = this.dom(\"<img>\").attr(\"src\", src);\n        $remover.one(\"click\", this._removeItem.bind(this));\n        $item.append($img);\n        $item.append($remover);\n        this.$box.append($item);\n    },\n    _buildUpload: function($item, callback) {\n        if (!this.opts.slideshow.upload) return;\n        var params = {\n            box: true,\n            placeholder: this.lang.get(\"image.upload-new-placeholder\"),\n            url: this.opts.slideshow.upload,\n            name: this.opts.slideshow.name,\n            data: this.opts.slideshow.data,\n            multiple: this.opts.slideshow.multiple,\n            success: callback,\n            error: \"image.error\"\n        };\n        this.app.create(\"upload\", $item, params);\n    }\n});\n\n\n\nArticleEditor.add(\"plugin\", \"specialchars\", {\n    translations: {\n        en: {\n            \"specialchars\": {\n                \"special-chars\": \"Special Characters\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2 14v-1.8348348h2.38016529v-.0780781c-.99173554-.975976-2.10247934-2.67417419-2.10247934-4.99699701 0-3.57207207 2.28099174-6.09009009 5.73223141-6.09009009 3.43140494 0 5.71239664 2.51801802 5.71239664 6.09009009 0 2.32282282-1.1107438 4.02102101-2.1024793 4.99699701v.0780781h2.3801653v1.8348348h-4.95867769v-1.6396396c1.40826449-1.1906907 2.32066119-2.75225229 2.32066119-5.07507511 0-2.4984985-1.2495868-4.31381382-3.35206614-4.31381382s-3.37190083 1.81531532-3.37190083 4.31381382c0 2.32282282.91239669 3.88438441 2.32066116 5.07507511v1.6396396z\"/></svg>',\n        items: [\n            \"&lsquo;\",\n            \"&rsquo;\",\n            \"&ldquo;\",\n            \"&rdquo;\",\n            \"&ndash;\",\n            \"&mdash;\",\n            \"&divide;\",\n            \"&hellip;\",\n            \"&trade;\",\n            \"&bull;\",\n            \"&rarr;\",\n            \"&asymp;\",\n            \"$\",\n            \"&euro;\",\n            \"&cent;\",\n            \"&pound;\",\n            \"&yen;\",\n            \"&iexcl;\",\n            \"&curren;\",\n            \"&brvbar;\",\n            \"&sect;\",\n            \"&uml;\",\n            \"&copy;\",\n            \"&ordf;\",\n            \"&laquo;\",\n            \"&raquo;\",\n            \"&not;\",\n            \"&reg;\",\n            \"&macr;\",\n            \"&deg;\",\n            \"&sup1;\",\n            \"&sup2;\",\n            \"&sup3;\",\n            \"&acute;\",\n            \"&micro;\",\n            \"&para;\",\n            \"&middot;\",\n            \"&cedil;\",\n            \"&ordm;\",\n            \"&frac14;\",\n            \"&frac12;\",\n            \"&frac34;\",\n            \"&iquest;\",\n            \"&Agrave;\",\n            \"&Aacute;\",\n            \"&Acirc;\",\n            \"&Atilde;\",\n            \"&Auml;\",\n            \"&Aring;\",\n            \"&AElig;\",\n            \"&Ccedil;\",\n            \"&Egrave;\",\n            \"&Eacute;\",\n            \"&Ecirc;\",\n            \"&Euml;\",\n            \"&Igrave;\",\n            \"&Iacute;\",\n            \"&Icirc;\",\n            \"&Iuml;\",\n            \"&ETH;\",\n            \"&Ntilde;\",\n            \"&Ograve;\",\n            \"&Oacute;\",\n            \"&Ocirc;\",\n            \"&Otilde;\",\n            \"&Ouml;\",\n            \"&times;\",\n            \"&Oslash;\",\n            \"&Ugrave;\",\n            \"&Uacute;\",\n            \"&Ucirc;\",\n            \"&Uuml;\",\n            \"&Yacute;\",\n            \"&THORN;\",\n            \"&szlig;\",\n            \"&agrave;\",\n            \"&aacute;\",\n            \"&acirc;\",\n            \"&atilde;\",\n            \"&auml;\",\n            \"&aring;\",\n            \"&aelig;\",\n            \"&ccedil;\",\n            \"&egrave;\",\n            \"&eacute;\",\n            \"&ecirc;\",\n            \"&euml;\",\n            \"&igrave;\",\n            \"&iacute;\",\n            \"&icirc;\",\n            \"&iuml;\",\n            \"&eth;\",\n            \"&ntilde;\",\n            \"&ograve;\",\n            \"&oacute;\",\n            \"&ocirc;\",\n            \"&otilde;\",\n            \"&ouml;\",\n            \"&oslash;\",\n            \"&ugrave;\",\n            \"&uacute;\",\n            \"&ucirc;\",\n            \"&uuml;\",\n            \"&yacute;\",\n            \"&thorn;\",\n            \"&yuml;\",\n            \"&OElig;\",\n            \"&oelig;\",\n            \"&#372;\",\n            \"&#374\",\n            \"&#373\",\n            \"&#375;\"\n        ]\n    },\n    start: function() {\n        this.app.toolbar.add(\"specialchars\", {\n            title: \"## specialchars.special-chars ##\",\n            icon: this.opts.specialchars.icon,\n            command: \"specialchars.popup\",\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        var chars = this.opts.specialchars.items;\n        for(var i = 0; i < chars.length; i++)items[i] = {\n            html: this.dom(\"<div>\").addClass(this.prefix + \"-popup-item\").html(chars[i]),\n            command: \"specialchars.insert\",\n            params: {\n                character: chars[i]\n            }\n        };\n        this.app.popup.create(\"specialchars\", {\n            type: \"grid\",\n            width: \"352px\",\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    insert: function(params) {\n        this.app.popup.close();\n        this.app.insertion.insertHtml(params.character, \"after\");\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"style\", {\n    translations: {\n        en: {\n            \"style\": {\n                \"style\": \"Style\",\n                \"remove-style\": \"Remove Style\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m15 1c-3.5955345 2.88454776-5.25146525 9.6241453-7.87485347 9.6241453h-2.6253419l-2.62495116 4.3758547h-.87485347c1.75009768-5.25102559 6.33028189-14 14-14z\"/></svg>'\n    },\n    init: function() {},\n    start: function() {\n        if (typeof this.opts.styles === \"undefined\") return;\n        var keys = Object.keys(this.opts.styles);\n        if (keys.length === 0) return;\n        this.app.toolbar.add(\"style\", {\n            title: \"## style.style ##\",\n            icon: this.opts.style.icon,\n            position: {\n                after: \"format\"\n            },\n            blocks: {\n                types: keys\n            },\n            command: \"style.popup\"\n        });\n    },\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var type = instance.getType();\n        var classes = this._getClasses(type);\n        var items = this._buildItems(this.opts.styles[type], instance);\n        // popup\n        this.app.popup.create(\"style\", {\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    toggle: function(params) {\n        this._toggle(params, false);\n    },\n    remove: function() {\n        this._toggle();\n    },\n    // private\n    _toggle: function(params, remove) {\n        this.app.popup.close();\n        var instance = this.app.block.get();\n        var type = instance.getType();\n        var $block = instance.getBlock();\n        // remove\n        this._removeStyles(instance, type);\n        // set\n        if (remove === false) $block.addClass(params.classname);\n        // ui\n        this.app.control.updatePosition();\n    },\n    _buildItems: function(styles, instance) {\n        var items = {};\n        var active = false;\n        for(var key in styles){\n            items[key] = {\n                title: styles[key].title,\n                command: \"style.toggle\",\n                params: {\n                    classname: styles[key].classname\n                }\n            };\n            if (this._hasClasses(instance, styles[key].classname)) active = key;\n        }\n        if (active) items[active].active = true;\n        items[\"remove\"] = {\n            title: \"## style.remove-style ##\",\n            divider: \"top\",\n            command: \"style.remove\",\n            hidden: active === false\n        };\n        return items;\n    },\n    _hasClasses: function(instance, classname) {\n        var classes = classname.split(\" \");\n        return instance.hasClass(classes);\n    },\n    _getClasses: function(type) {\n        var styles = this.opts.styles[type];\n        var classes = [];\n        for(var key in styles)classes.push(styles[key].classname);\n        return classes;\n    },\n    _removeStyles: function(instance, type) {\n        var classes = this._getClasses(type);\n        var $block = instance.getBlock();\n        $block.removeClass(classes.join(\" \"));\n    }\n});\n\n\n// Icon\nArticleEditor.iconTags = '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m13.454 1c.853089 0 1.546.69366173 1.546 1.546v4.36371429c0 .56592472-.2790572 1.24002756-.6652017 1.62429902l-5.78655018 6.01223499c-.60256278.6050023-1.58507632.6050023-2.18621204.0014299l-4.90828435-4.90828722c-.60500231-.60256278-.60500231-1.58507632.01233983-2.19971875l5.98566032-5.75877764c.39921147-.40082772 1.07325621-.68089459 1.63853383-.68089459zm-.454 2h-3.90971429c-.0333803 0-.19751184.06819697-.23666299.10718491l-5.65962272 5.44381509 4.254 4.254 5.4606089-5.67296241c.0188278-.01875188.0660214-.12740905.0841458-.18802473l.0072453-.03429857zm-2 1c.553 0 1 .447 1 1s-.447 1-1 1-1-.447-1-1 .447-1 1-1z\"/></svg>';\n// Block\nArticleEditor.add(\"block\", \"block.tags\", {\n    mixins: [\n        \"block\"\n    ],\n    type: \"tags\",\n    parser: {\n        tag: \"div\",\n        parse: function($el) {\n            return $el.hasClass(\"tags\") ? \"tags\" : false;\n        }\n    },\n    toolbar: {\n        add: {\n            command: \"addbar.popup\",\n            title: \"## buttons.add ##\"\n        },\n        tags: {\n            command: \"tags.edit\",\n            title: \"## buttons.settings ##\",\n            icon: ArticleEditor.iconTags\n        }\n    },\n    control: {\n        trash: {\n            command: \"block.remove\",\n            title: \"## buttons.delete ##\"\n        },\n        duplicate: {\n            command: \"block.duplicate\",\n            title: \"## buttons.duplicate ##\"\n        }\n    },\n    create: function() {\n        return this.dom(\"<div>\").addClass(\"tags\");\n    }\n});\n// Plugin\nArticleEditor.add(\"plugin\", \"tags\", {\n    translations: {\n        en: {\n            \"tags\": {\n                \"tags\": \"Tags\",\n                \"add\": \"Add\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\",\n                \"label\": \"Add comma-separated tags\"\n            },\n            \"blocks\": {\n                \"tags\": \"Tags\"\n            }\n        }\n    },\n    popups: {\n        add: {\n            title: \"## tags.tags ##\",\n            width: \"100%\",\n            form: {\n                tags: {\n                    label: \"## tags.label ##\",\n                    type: \"textarea\",\n                    rows: 4\n                }\n            },\n            footer: {\n                insert: {\n                    title: \"## tags.add ##\",\n                    command: \"tags.insert\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## tags.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        },\n        edit: {\n            title: \"## tags.tags ##\",\n            width: \"100%\",\n            form: {\n                tags: {\n                    label: \"## tags.label ##\",\n                    type: \"textarea\",\n                    rows: 4\n                }\n            },\n            footer: {\n                save: {\n                    title: \"## tags.save ##\",\n                    command: \"tags.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"## tags.cancel ##\",\n                    command: \"popup.close\"\n                }\n            }\n        }\n    },\n    defaults: {\n        classname: \"tag\"\n    },\n    start: function() {\n        this.app.addbar.add(\"tags\", {\n            title: \"## blocks.tags ##\",\n            icon: ArticleEditor.iconTags,\n            command: \"tags.popup\"\n        });\n    },\n    popup: function() {\n        var stack = this.app.popup.add(\"tags\", this.popups.add);\n        stack.open({\n            focus: \"tags\"\n        });\n    },\n    edit: function(params, button) {\n        var stack = this.app.popup.create(\"tags\", this.popups.edit);\n        // data\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var tags = [];\n        $block.find(\".\" + this.opts.tags.classname).each(function($node) {\n            tags.push($node.html());\n        });\n        // set\n        stack.setData({\n            tags: tags.join(\", \")\n        });\n        // open\n        this.app.popup.open({\n            button: button,\n            focus: \"tags\"\n        });\n    },\n    save: function(stack) {\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        $block.html(\"\");\n        var instance = this._buildInstance(stack, current);\n        if (!instance) current.remove();\n    },\n    insert: function(stack) {\n        var instance = this._buildInstance(stack);\n        // insert\n        if (instance) this.app.block.add({\n            instance: instance\n        });\n    },\n    // private\n    _buildInstance: function(stack, instance) {\n        this.app.popup.close();\n        var data = stack.getData();\n        var str = data.tags.trim();\n        if (str === \"\") return;\n        // create\n        var instance = instance || this.app.create(\"block.tags\");\n        var $block = instance.getBlock();\n        // build\n        var tags = str.split(\",\");\n        for(var i = 0; i < tags.length; i++){\n            var tag = tags[i].trim();\n            var $tag = this.dom(\"<span>\").addClass(this.opts.tags.classname).html(tag);\n            $block.append($tag);\n        }\n        return instance;\n    }\n});\n\n\n\nArticleEditor.add(\"plugin\", \"textdirection\", {\n    translations: {\n        en: {\n            \"textdirection\": {\n                \"title\": \"RTL-LTR\",\n                \"ltr\": \"Left to Right\",\n                \"rtl\": \"Right to Left\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m3.8 8.10002943c.12590292.09442719.2.24262134.2.4v1.49999997h9c.5522847 0 1 .4477153 1 1 0 .5128359-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-9v1.5c0 .2761424-.22385763.5-.5.5-.15737865 0-.30557281-.0740971-.4-.2l-1.875-2.5c-.13333333-.1777778-.13333333-.4222222 0-.6l1.875-2.49999997c.16568542-.2209139.4790861-.26568543.7-.1zm7.4-6c.2209139-.16568543.5343146-.1209139.7.1l1.875 2.5c.1333333.17777777.1333333.42222222 0 .6l-1.875 2.5c-.0944272.12590292-.2426213.2-.4.2-.2761424 0-.5-.22385763-.5-.5v-1.5h-9c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 8.999-.00002943.001-1.49997057c0-.12590293.0474221-.24592777.1308533-.33724831z\"/></svg>'\n    },\n    start: function() {\n        this.app.toolbar.add(\"textdirection\", {\n            title: \"## textdirection.title ##\",\n            icon: this.opts.textdirection.icon,\n            blocks: {\n                all: \"all\",\n                except: [\n                    \"variable\"\n                ]\n            },\n            command: \"textdirection.toggle\"\n        });\n    },\n    toggle: function(params, button) {\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var currentDir = $block.attr(\"dir\");\n        var items = {\n            ltr: {\n                title: \"## textdirection.ltr ##\",\n                command: \"textdirection.set\"\n            },\n            rtl: {\n                title: \"## textdirection.rtl ##\",\n                command: \"textdirection.set\"\n            }\n        };\n        var dir = currentDir ? currentDir : this.opts.editor.direction;\n        items[dir].active = true;\n        this.app.popup.create(\"textdirection\", {\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    set: function(params, item, name) {\n        this.app.popup.close();\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var dir = this.opts.editor.direction;\n        if (dir === name) $block.removeAttr(\"dir\");\n        else $block.attr(\"dir\", name);\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"underline\", {\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12.2307692 12c.5522848 0 1 .4477153 1 1 0 .5128358-.3860402.9355072-.8833788.9932723l-.1166212.0067277h-8.2307692c-.55228475 0-1-.4477153-1-1 0-.5128358.38604019-.9355072.88337887-.9932723l.11662113-.0067277zm-1.2307692-10c.5128358 0 .9355072.43429521.9932723.99380123l.0067277.13119877v3.51108871c0 2.42071645-1.7998593 4.36391129-4 4.36391129-2.13138633 0-3.8871179-1.82364282-3.99476969-4.13841284l-.00523031-.22549845v-3.51108871c0-.62132034.44771525-1.125 1-1.125.51283584 0 .93550716.43429521.99327227.99380123l.00672773.13119877v3.51108871c0 1.15688618.88643222 2.11391129 2 2.11391129 1.06054074 0 1.91506284-.86804999 1.99404104-1.95008319l.00595896-.1638281v-3.51108871c0-.62132034.4477153-1.125 1-1.125z\"/></svg>'\n    },\n    start: function() {\n        this.app.toolbar.add(\"underline\", {\n            title: \"## buttons.underline ##\",\n            icon: this.opts.underline.icon,\n            command: \"inline.set\",\n            position: {\n                after: \"italic\"\n            },\n            active: {\n                tags: [\n                    \"u\"\n                ]\n            },\n            params: {\n                tag: \"u\"\n            },\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ]\n            }\n        });\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"variable\", {\n    translations: {\n        en: {\n            \"blocks\": {\n                \"variable\": \"Variable\"\n            },\n            \"variable\": {\n                \"variable\": \"Variable\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 0c4.418278 0 8 3.581722 8 8s-3.581722 8-8 8-8-3.581722-8-8 3.581722-8 8-8zm0 2c-3.3137085 0-6 2.6862915-6 6s2.6862915 6 6 6 6-2.6862915 6-6-2.6862915-6-6-6zm-.04375592 2c1.59851929 0 2.78098562.82644628 2.84667822 2.45730028h-1.72990447c-.01094876-.52892562-.4051042-.90358127-1.11677375-.90358127-.67882327 0-1.02918366.30853994-1.02918366.71625344 0 1.36639119 4.07293958.12121212 4.07293958 3.23966942 0 1.43250693-1.08392747 2.49035813-3.01090964 2.49035813-1.86128959 0-2.99996087-1.0688705-2.98901211-2.65564738h1.65326311c.03284629.6060606.51459183 1.05785128 1.39049282 1.05785128.72261831 0 1.14962004-.2754821 1.14962004-.76033062 0-1.43250689-3.99629825-.15426997-3.99629825-3.32782369 0-1.2892562.99633737-2.31404959 2.75908811-2.31404959z\"/></svg>',\n        items: [\n            \"email\",\n            \"name\",\n            \"lastname\"\n        ],\n        classname: \"arx-variable\",\n        template: {\n            start: \"[% \",\n            end: \" %]\"\n        }\n    },\n    subscribe: {\n        \"editor.parse\": function(event) {\n            this._parse(event);\n        },\n        \"editor.unparse\": function(event) {\n            this._unparse(event);\n        }\n    },\n    start: function() {\n        this.app.toolbar.add(\"variable\", {\n            title: \"## variable.variable ##\",\n            icon: this.opts.variable.icon,\n            command: \"variable.popup\",\n            blocks: {\n                all: \"editable\",\n                except: [\n                    \"code\"\n                ],\n                types: [\n                    \"variable\"\n                ]\n            },\n            active: {\n                types: [\n                    \"variable\"\n                ]\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        var vars = this.opts.variable.items;\n        var instance = this.app.block.get();\n        var activeKey = instance.getType(\"variable\") ? instance.getHtml() : false;\n        for(var i = 0; i < vars.length; i++)items[i] = {\n            title: vars[i],\n            command: \"variable.insert\",\n            active: activeKey === vars[i],\n            params: {\n                variable: vars[i]\n            }\n        };\n        this.app.popup.create(\"variable\", {\n            items: items\n        });\n        this.app.popup.open({\n            button: button\n        });\n    },\n    insert: function(params) {\n        this.app.popup.close();\n        var instance = this.app.create(\"block.variable\");\n        instance.setHtml(params.variable);\n        // insert\n        this.app.block.add({\n            instance: instance,\n            caret: \"after\"\n        });\n    },\n    // private\n    _parse: function(event) {\n        var html = event.get(\"html\");\n        var start = this.opts.variable.template.start;\n        var end = this.opts.variable.template.end;\n        var htmlStart = \"<span data-\" + this.prefix + '-type=\"variable\">';\n        var htmlEnd = \"</span>\";\n        var storedLinks = [];\n        var re = new RegExp(this.app.utils.escapeRegExp(start) + \"(.*?)\" + this.app.utils.escapeRegExp(end), \"gi\");\n        var match = html.match(re);\n        if (match != null) {\n            html = this._storeLinks(html, storedLinks);\n            var matched, replacer;\n            for(var i = 0; i < match.length; i++){\n                matched = match[i].replace(start, \"\").replace(end, \"\");\n                replacer = htmlStart + matched + htmlEnd;\n                html = html.replace(match[i], replacer);\n            }\n            html = this._restoreLinks(html, storedLinks);\n        }\n        event.set(\"html\", html);\n    },\n    _unparse: function(event) {\n        var html = event.get(\"html\");\n        var start = this.opts.variable.template.start;\n        var end = this.opts.variable.template.end;\n        // find\n        html = this.app.utils.wrap(html, (function($w) {\n            $w.find(\".\" + this.opts.variable.classname).replaceWith(function(node) {\n                return start + node.innerHTML + end;\n            });\n        }).bind(this));\n        event.set(\"html\", html);\n    },\n    _storeLinks: function(html, storedLinks) {\n        var links = html.match(new RegExp(\"<a[^>]*>\", \"gi\"));\n        if (links === null) return html;\n        for(var i = 0; i < links.length; i++){\n            html = html.replace(links[i], \"#####xstartvarlinkszz\" + i + \"xendvarlinkstzz#####\");\n            storedLinks.push(links[i]);\n        }\n        return html;\n    },\n    _restoreLinks: function(html, storedLinks) {\n        for(var i = 0; i < storedLinks.length; i++)html = html.replace(\"#####xstartvarlinkszz\" + i + \"xendvarlinkstzz#####\", storedLinks[i]);\n        return html;\n    }\n});\n\n\n/* globals PShowBEBaseUri, PShowBEConfig, PShowEditorImageUploadControllerURL, PShowEditorImageListControllerURL, PShowThemeCssUri */ ArticleEditor.add(\"plugin\", \"pshow-icons\", {\n    start: function() {\n        this.app.toolbar.add(\"pshow-icons\", {\n            title: \"Icons\",\n            icon: '<i class=\"fa fa-star\"></i>',\n            command: \"pshow-icons.popup\"\n        });\n    },\n    popup: function(params, button) {\n        var icons = [\n            \"fa-adjust\",\n            \"fa-adn\",\n            \"fa-align-center\",\n            \"fa-align-justify\",\n            \"fa-align-left\",\n            \"fa-align-right\",\n            \"fa-ambulance\",\n            \"fa-anchor\",\n            \"fa-android\",\n            \"fa-angellist\",\n            \"fa-angle-double-down\",\n            \"fa-angle-double-left\",\n            \"fa-angle-double-right\",\n            \"fa-angle-double-up\",\n            \"fa-angle-down\",\n            \"fa-angle-left\",\n            \"fa-angle-right\",\n            \"fa-angle-up\",\n            \"fa-apple\",\n            \"fa-archive\",\n            \"fa-area-chart\",\n            \"fa-arrow-circle-down\",\n            \"fa-arrow-circle-left\",\n            \"fa-arrow-circle-right\",\n            \"fa-arrow-circle-up\",\n            \"fa-arrow-down\",\n            \"fa-arrow-left\",\n            \"fa-arrow-right\",\n            \"fa-arrow-up\",\n            \"fa-arrows\",\n            \"fa-arrows-alt\",\n            \"fa-arrows-h\",\n            \"fa-arrows-v\",\n            \"fa-asterisk\",\n            \"fa-at\",\n            \"fa-backward\",\n            \"fa-ban\",\n            \"fa-bar-chart\",\n            \"fa-barcode\",\n            \"fa-bars\",\n            \"fa-bed\",\n            \"fa-beer\",\n            \"fa-behance\",\n            \"fa-behance-square\",\n            \"fa-bell\",\n            \"fa-bell-o\",\n            \"fa-bell-slash\",\n            \"fa-bell-slash-o\",\n            \"fa-bicycle\",\n            \"fa-binoculars\",\n            \"fa-birthday-cake\",\n            \"fa-bitbucket\",\n            \"fa-bitbucket-square\",\n            \"fa-bold\",\n            \"fa-bolt\",\n            \"fa-bomb\",\n            \"fa-book\",\n            \"fa-bookmark\",\n            \"fa-bookmark-o\",\n            \"fa-briefcase\",\n            \"fa-btc\",\n            \"fa-bug\",\n            \"fa-building\",\n            \"fa-building-o\",\n            \"fa-bullhorn\",\n            \"fa-bullseye\",\n            \"fa-bus\",\n            \"fa-calculator\",\n            \"fa-calendar\",\n            \"fa-calendar-o\",\n            \"fa-camera\",\n            \"fa-camera-retro\",\n            \"fa-car\",\n            \"fa-caret-down\",\n            \"fa-caret-left\",\n            \"fa-caret-right\",\n            \"fa-caret-up\",\n            \"fa-cart-arrow-down\",\n            \"fa-cart-plus\",\n            \"fa-cc\",\n            \"fa-cc-amex\",\n            \"fa-cc-discover\",\n            \"fa-cc-mastercard\",\n            \"fa-cc-paypal\",\n            \"fa-cc-stripe\",\n            \"fa-cc-visa\",\n            \"fa-certificate\",\n            \"fa-chain-broken\",\n            \"fa-check\",\n            \"fa-check-circle\",\n            \"fa-check-circle-o\",\n            \"fa-check-square\",\n            \"fa-check-square-o\",\n            \"fa-chevron-circle-down\",\n            \"fa-chevron-circle-left\",\n            \"fa-chevron-circle-right\",\n            \"fa-chevron-circle-up\",\n            \"fa-chevron-down\",\n            \"fa-chevron-left\",\n            \"fa-chevron-right\",\n            \"fa-chevron-up\",\n            \"fa-child\",\n            \"fa-circle\",\n            \"fa-circle-o\",\n            \"fa-circle-o-notch\",\n            \"fa-circle-thin\",\n            \"fa-clipboard\",\n            \"fa-clock-o\",\n            \"fa-cloud\",\n            \"fa-cloud-download\",\n            \"fa-cloud-upload\",\n            \"fa-code\",\n            \"fa-code-fork\",\n            \"fa-coffee\",\n            \"fa-cog\",\n            \"fa-cogs\",\n            \"fa-columns\",\n            \"fa-comment\",\n            \"fa-comment-o\",\n            \"fa-comments\",\n            \"fa-comments-o\",\n            \"fa-compass\",\n            \"fa-compress\",\n            \"fa-copy\",\n            \"fa-copyright\",\n            \"fa-credit-card\",\n            \"fa-crop\",\n            \"fa-crosshairs\",\n            \"fa-css3\",\n            \"fa-cube\",\n            \"fa-cubes\",\n            \"fa-cutlery\",\n            \"fa-database\",\n            \"fa-desktop\",\n            \"fa-diamond\",\n            \"fa-download\",\n            \"fa-dropbox\",\n            \"fa-edit\",\n            \"fa-eject\",\n            \"fa-ellipsis-h\",\n            \"fa-ellipsis-v\",\n            \"fa-envelope\",\n            \"fa-envelope-o\",\n            \"fa-envelope-square\",\n            \"fa-eraser\",\n            \"fa-exchange\",\n            \"fa-exclamation\",\n            \"fa-exclamation-circle\",\n            \"fa-exclamation-triangle\",\n            \"fa-expand\",\n            \"fa-external-link\",\n            \"fa-external-link-square\",\n            \"fa-eye\",\n            \"fa-eye-slash\",\n            \"fa-eyedropper\",\n            \"fa-facebook\",\n            \"fa-facebook-square\",\n            \"fa-fast-backward\",\n            \"fa-fast-forward\",\n            \"fa-fax\",\n            \"fa-female\",\n            \"fa-fighter-jet\",\n            \"fa-file\",\n            \"fa-file-archive-o\",\n            \"fa-file-audio-o\",\n            \"fa-file-code-o\",\n            \"fa-file-excel-o\",\n            \"fa-file-image-o\",\n            \"fa-file-o\",\n            \"fa-file-pdf-o\",\n            \"fa-file-powerpoint-o\",\n            \"fa-file-text\",\n            \"fa-file-text-o\",\n            \"fa-file-video-o\",\n            \"fa-file-word-o\",\n            \"fa-files-o\",\n            \"fa-film\",\n            \"fa-filter\",\n            \"fa-fire\",\n            \"fa-fire-extinguisher\",\n            \"fa-flag\",\n            \"fa-flag-checkered\",\n            \"fa-flag-o\",\n            \"fa-flask\",\n            \"fa-flickr\",\n            \"fa-floppy-o\",\n            \"fa-folder\",\n            \"fa-folder-o\",\n            \"fa-folder-open\",\n            \"fa-folder-open-o\",\n            \"fa-font\",\n            \"fa-forward\",\n            \"fa-foursquare\",\n            \"fa-frown-o\",\n            \"fa-futbol-o\",\n            \"fa-gamepad\",\n            \"fa-gavel\",\n            \"fa-gbp\",\n            \"fa-gift\",\n            \"fa-git\",\n            \"fa-git-square\",\n            \"fa-github\",\n            \"fa-github-alt\",\n            \"fa-github-square\",\n            \"fa-glass\",\n            \"fa-globe\",\n            \"fa-google\",\n            \"fa-google-plus\",\n            \"fa-google-plus-square\",\n            \"fa-graduation-cap\",\n            \"fa-gratipay\",\n            \"fa-h-square\",\n            \"fa-hand-o-down\",\n            \"fa-hand-o-left\",\n            \"fa-hand-o-right\",\n            \"fa-hand-o-up\",\n            \"fa-hdd-o\",\n            \"fa-header\",\n            \"fa-headphones\",\n            \"fa-heart\",\n            \"fa-heart-o\",\n            \"fa-history\",\n            \"fa-home\",\n            \"fa-hospital-o\",\n            \"fa-html5\",\n            \"fa-image\",\n            \"fa-inbox\",\n            \"fa-indent\",\n            \"fa-info\",\n            \"fa-info-circle\",\n            \"fa-inr\",\n            \"fa-instagram\",\n            \"fa-ioxhost\",\n            \"fa-italic\",\n            \"fa-joomla\",\n            \"fa-jpy\",\n            \"fa-jsfiddle\",\n            \"fa-key\",\n            \"fa-keyboard-o\",\n            \"fa-krw\",\n            \"fa-language\",\n            \"fa-laptop\",\n            \"fa-lastfm\",\n            \"fa-lastfm-square\",\n            \"fa-leaf\",\n            \"fa-lemon-o\",\n            \"fa-level-down\",\n            \"fa-level-up\",\n            \"fa-life-ring\",\n            \"fa-lightbulb-o\",\n            \"fa-line-chart\",\n            \"fa-link\",\n            \"fa-linkedin\",\n            \"fa-linkedin-square\",\n            \"fa-linux\",\n            \"fa-list\",\n            \"fa-list-alt\",\n            \"fa-list-ol\",\n            \"fa-list-ul\",\n            \"fa-location-arrow\",\n            \"fa-lock\",\n            \"fa-long-arrow-down\",\n            \"fa-long-arrow-left\",\n            \"fa-long-arrow-right\",\n            \"fa-long-arrow-up\",\n            \"fa-magic\",\n            \"fa-magnet\",\n            \"fa-male\",\n            \"fa-map-marker\",\n            \"fa-maxcdn\",\n            \"fa-meanpath\",\n            \"fa-medkit\",\n            \"fa-meh-o\",\n            \"fa-microphone\",\n            \"fa-microphone-slash\",\n            \"fa-minus\",\n            \"fa-minus-circle\",\n            \"fa-minus-square\",\n            \"fa-minus-square-o\",\n            \"fa-mobile\",\n            \"fa-money\",\n            \"fa-moon-o\",\n            \"fa-motorcycle\",\n            \"fa-music\",\n            \"fa-newspaper-o\",\n            \"fa-openid\",\n            \"fa-outdent\",\n            \"fa-pagelines\",\n            \"fa-paint-brush\",\n            \"fa-paper-plane\",\n            \"fa-paper-plane-o\",\n            \"fa-paperclip\",\n            \"fa-paragraph\",\n            \"fa-pause\",\n            \"fa-paw\",\n            \"fa-paypal\",\n            \"fa-pencil\",\n            \"fa-pencil-square\",\n            \"fa-pencil-square-o\",\n            \"fa-phone\",\n            \"fa-phone-square\",\n            \"fa-picture-o\",\n            \"fa-pie-chart\",\n            \"fa-pied-piper\",\n            \"fa-pied-piper-alt\",\n            \"fa-pinterest\",\n            \"fa-pinterest-square\",\n            \"fa-plane\",\n            \"fa-play\",\n            \"fa-play-circle\",\n            \"fa-play-circle-o\",\n            \"fa-plug\",\n            \"fa-plus\",\n            \"fa-plus-circle\",\n            \"fa-plus-square\",\n            \"fa-plus-square-o\",\n            \"fa-power-off\",\n            \"fa-print\",\n            \"fa-puzzle-piece\",\n            \"fa-qq\",\n            \"fa-qrcode\",\n            \"fa-question\",\n            \"fa-question-circle\",\n            \"fa-quote-left\",\n            \"fa-quote-right\",\n            \"fa-random\",\n            \"fa-rebel\",\n            \"fa-recycle\",\n            \"fa-reddit\",\n            \"fa-reddit-square\",\n            \"fa-refresh\",\n            \"fa-renren\",\n            \"fa-repeat\",\n            \"fa-reply\",\n            \"fa-reply-all\",\n            \"fa-retweet\",\n            \"fa-road\",\n            \"fa-rocket\",\n            \"fa-rss\",\n            \"fa-rss-square\",\n            \"fa-rub\",\n            \"fa-scissors\",\n            \"fa-search\",\n            \"fa-search-minus\",\n            \"fa-search-plus\",\n            \"fa-sellsy\",\n            \"fa-server\",\n            \"fa-share\",\n            \"fa-share-alt\",\n            \"fa-share-alt-square\",\n            \"fa-share-square\",\n            \"fa-share-square-o\",\n            \"fa-shield\",\n            \"fa-ship\",\n            \"fa-shirtsinbulk\",\n            \"fa-shopping-cart\",\n            \"fa-sign-in\",\n            \"fa-sign-out\",\n            \"fa-signal\",\n            \"fa-simplybuilt\",\n            \"fa-sitemap\",\n            \"fa-skyatlas\",\n            \"fa-skype\",\n            \"fa-slack\",\n            \"fa-sliders\",\n            \"fa-slideshare\",\n            \"fa-smile-o\",\n            \"fa-sort\",\n            \"fa-sort-alpha-asc\",\n            \"fa-sort-alpha-desc\",\n            \"fa-sort-amount-asc\",\n            \"fa-sort-amount-desc\",\n            \"fa-sort-asc\",\n            \"fa-sort-desc\",\n            \"fa-sort-numeric-asc\",\n            \"fa-sort-numeric-desc\",\n            \"fa-soundcloud\",\n            \"fa-space-shuttle\",\n            \"fa-spinner\",\n            \"fa-spoon\",\n            \"fa-spotify\",\n            \"fa-square\",\n            \"fa-square-o\",\n            \"fa-stack-exchange\",\n            \"fa-stack-overflow\",\n            \"fa-star\",\n            \"fa-star-half\",\n            \"fa-star-half-o\",\n            \"fa-star-o\",\n            \"fa-steam\",\n            \"fa-steam-square\",\n            \"fa-step-backward\",\n            \"fa-step-forward\",\n            \"fa-stethoscope\",\n            \"fa-stop\",\n            \"fa-street-view\",\n            \"fa-strikethrough\",\n            \"fa-stumbleupon\",\n            \"fa-stumbleupon-circle\",\n            \"fa-subscript\",\n            \"fa-subway\",\n            \"fa-suitcase\",\n            \"fa-sun-o\",\n            \"fa-superscript\",\n            \"fa-table\",\n            \"fa-tablet\",\n            \"fa-tachometer\",\n            \"fa-tag\",\n            \"fa-tags\",\n            \"fa-tasks\",\n            \"fa-taxi\",\n            \"fa-tencent-weibo\",\n            \"fa-terminal\",\n            \"fa-text-height\",\n            \"fa-text-width\",\n            \"fa-th\",\n            \"fa-th-large\",\n            \"fa-th-list\",\n            \"fa-thumbs-down\",\n            \"fa-thumbs-o-down\",\n            \"fa-thumbs-o-up\",\n            \"fa-thumbs-up\",\n            \"fa-ticket\",\n            \"fa-times\",\n            \"fa-times-circle\",\n            \"fa-times-circle-o\",\n            \"fa-tint\",\n            \"fa-toggle-off\",\n            \"fa-toggle-on\",\n            \"fa-train\",\n            \"fa-transgender\",\n            \"fa-transgender-alt\",\n            \"fa-trash\",\n            \"fa-trash-o\",\n            \"fa-tree\",\n            \"fa-trello\",\n            \"fa-trophy\",\n            \"fa-truck\",\n            \"fa-try\",\n            \"fa-tty\",\n            \"fa-tumblr\",\n            \"fa-tumblr-square\",\n            \"fa-twitch\",\n            \"fa-twitter\",\n            \"fa-twitter-square\",\n            \"fa-umbrella\",\n            \"fa-underline\",\n            \"fa-undo\",\n            \"fa-university\",\n            \"fa-unlock\",\n            \"fa-unlock-alt\",\n            \"fa-upload\",\n            \"fa-usd\",\n            \"fa-user\",\n            \"fa-user-md\",\n            \"fa-user-plus\",\n            \"fa-user-secret\",\n            \"fa-user-times\",\n            \"fa-users\",\n            \"fa-venus\",\n            \"fa-venus-double\",\n            \"fa-venus-mars\",\n            \"fa-viacoin\",\n            \"fa-video-camera\",\n            \"fa-vimeo-square\",\n            \"fa-vine\",\n            \"fa-vk\",\n            \"fa-volume-down\",\n            \"fa-volume-off\",\n            \"fa-volume-up\",\n            \"fa-weibo\",\n            \"fa-weixin\",\n            \"fa-whatsapp\",\n            \"fa-wheelchair\",\n            \"fa-wifi\",\n            \"fa-windows\",\n            \"fa-wordpress\",\n            \"fa-wrench\",\n            \"fa-xing\",\n            \"fa-xing-square\",\n            \"fa-yahoo\",\n            \"fa-yelp\",\n            \"fa-youtube\",\n            \"fa-youtube-play\",\n            \"fa-youtube-square\"\n        ];\n        // Create popup\n        var popup = this.app.popup.create(\"pshow-icons\", {\n            title: \"\",\n            width: \"600px\",\n            height: \"400px\"\n        });\n        var $body = popup.getBody();\n        $body.css(\"padding\", \"15px\");\n        // Create search input\n        var $search = this.dom('<input type=\"text\" placeholder=\"Search icons...\" style=\"width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;\">');\n        // Create icons container\n        var $container = this.dom('<div style=\"display: flex; flex-wrap: wrap; gap: 10px; max-height: 300px; overflow-y: auto; \">');\n        // Add icons\n        var iconElements = [];\n        icons.forEach((function(icon) {\n            var $icon = this.dom(`<div class=\"icon-item\" style=\"padding: 10px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; text-align: center; width: 80px;\">\n                <i class=\"fa ${icon}\" style=\"font-size: 20px;\"></i>\n                <div style=\"font-size: 10px; margin-top: 5px;\">${icon.substring(3).replace(/-/g, \" \")}</div>\n            </div>`);\n            $icon.on(\"click\", this.insert.bind(this, icon));\n            $container.append($icon);\n            iconElements.push({\n                element: $icon,\n                name: icon\n            });\n        }).bind(this));\n        // Search functionality\n        $search.on(\"input\", (function(e) {\n            var searchTerm = e.target.value.toLowerCase();\n            iconElements.forEach(function(item) {\n                if (item.name.toLowerCase().includes(searchTerm)) item.element.css(\"display\", \"block\");\n                else item.element.css(\"display\", \"none\");\n            });\n        }).bind(this));\n        // Append elements\n        $body.append($search);\n        $body.append($container);\n        // Open popup\n        this.app.popup.open({\n            button: button\n        });\n    },\n    insert: function(icon, e) {\n        e.preventDefault();\n        var $icon = this.dom(`<i class=\"fa ${icon}\"></i>`);\n        this.app.insertion.insertNode($icon);\n        this.app.popup.close();\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"blocklink\", {\n    start: function() {\n        this.app.toolbar.add(\"blocklink\", {\n            title: \"Block link\",\n            icon: '<i class=\"fa fa-link\"></i>',\n            command: \"blocklink.popup\",\n            blocks: {\n                all: true,\n                except: [\n                    \"variable\",\n                    \"figure\",\n                    \"paragraph\",\n                    \"image\"\n                ]\n            }\n        });\n    },\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        console.log($block.nodes[0].tagName);\n        if ($block.nodes[0].tagName != \"DIV\") {\n            console.log(\"DIV is only allowed\");\n            return;\n        }\n        // create\n        var popup = this.app.popup.create(\"blocklink\", {\n            title: \"Block link\",\n            width: \"400px\",\n            form: {\n                target_url: {\n                    type: \"input\",\n                    label: \"Target URL\"\n                }\n            },\n            footer: {\n                save: {\n                    title: \"Save\",\n                    command: \"blocklink.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"Cancel\",\n                    command: \"popup.close\"\n                }\n            }\n        });\n        // data\n        var target_url = $block.attr(\"data-target-url\");\n        // set form\n        popup.setData({\n            target_url: target_url\n        });\n        // open\n        this.app.popup.open({\n            button: button\n        });\n    },\n    save: function(popup) {\n        this.app.popup.close();\n        var data = popup.getData();\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        if (data.target_url !== \"\") $block.attr(\"data-target-url\", data.target_url);\n        else $block.removeAttr(\"data-target-url\");\n    }\n});\n\n\nArticleEditor.add(\"plugin\", \"product-block\", {\n    start: function() {\n        this.app.toolbar.add(\"product-block\", {\n            title: \"Product block\",\n            icon: '<i class=\"fa fa-product-hunt\"></i>',\n            command: \"product-block.popup\",\n            blocks: {\n                all: true,\n                except: [\n                    \"variable\",\n                    \"figure\",\n                    \"paragraph\",\n                    \"image\"\n                ]\n            }\n        });\n    },\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        console.log($block.nodes[0].tagName);\n        if ($block.nodes[0].tagName != \"DIV\") {\n            console.log(\"DIV is only allowed\");\n            return;\n        }\n        // create\n        var popup = this.app.popup.create(\"product-block\", {\n            title: \"Product block\",\n            width: \"400px\",\n            form: {\n                product_id: {\n                    type: \"input\",\n                    label: \"Product ID\"\n                }\n            },\n            footer: {\n                save: {\n                    title: \"Save\",\n                    command: \"product-block.save\",\n                    type: \"primary\"\n                },\n                cancel: {\n                    title: \"Cancel\",\n                    command: \"popup.close\"\n                }\n            }\n        });\n        // data\n        var product_id = $block.attr(\"data-product-id\");\n        // set form\n        popup.setData({\n            product_id: product_id\n        });\n        // open\n        this.app.popup.open({\n            button: button\n        });\n    },\n    save: function(popup) {\n        this.app.popup.close();\n        var data = popup.getData();\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        if (data.product_id !== \"\") $block.attr(\"data-product-id\", data.product_id);\n        else $block.removeAttr(\"data-product-id\");\n    }\n});\n\n\n// Extended FontColor Plugin with Custom Hex Color Input\n// This plugin extends the default fontcolor plugin by adding a custom hex color input field\n(function() {\n    // Create a new plugin with a different name (my-fontcolor)\n    ArticleEditor.add(\"plugin\", \"my-fontcolor\", {\n        // Define translations\n        translations: {\n            \"en\": {\n                \"fontcolor\": {\n                    \"title\": \"Text color\",\n                    \"remove\": \"Remove color\",\n                    \"text\": \"Text\",\n                    \"background\": \"Background\",\n                    \"custom\": \"Custom color\",\n                    \"customhex\": \"Enter hex color code\",\n                    \"apply\": \"Apply\"\n                }\n            }\n        },\n        // Initialize method\n        init () {\n            let colors = {\n                gray: [\n                    \"#212529\",\n                    \"#343a40\",\n                    \"#495057\",\n                    \"#868e96\",\n                    \"#adb5bd\",\n                    \"#ced4da\",\n                    \"#dee2e6\",\n                    \"#e9ecef\",\n                    \"#f1f3f5\",\n                    \"#f8f9fa\"\n                ],\n                red: [\n                    \"#c92a2a\",\n                    \"#e03131\",\n                    \"#f03e3e\",\n                    \"#fa5252\",\n                    \"#ff6b6b\",\n                    \"#ff8787\",\n                    \"#ffa8a8\",\n                    \"#ffc9c9\",\n                    \"#ffe3e3\",\n                    \"#fff5f5\"\n                ],\n                pink: [\n                    \"#a61e4d\",\n                    \"#c2255c\",\n                    \"#d6336c\",\n                    \"#e64980\",\n                    \"#f06595\",\n                    \"#f783ac\",\n                    \"#faa2c1\",\n                    \"#fcc2d7\",\n                    \"#ffdeeb\",\n                    \"#fff0f6\"\n                ],\n                grape: [\n                    \"#862e9c\",\n                    \"#9c36b5\",\n                    \"#ae3ec9\",\n                    \"#be4bdb\",\n                    \"#cc5de8\",\n                    \"#da77f2\",\n                    \"#e599f7\",\n                    \"#eebefa\",\n                    \"#f3d9fa\",\n                    \"#f8f0fc\"\n                ],\n                violet: [\n                    \"#5f3dc4\",\n                    \"#6741d9\",\n                    \"#7048e8\",\n                    \"#7950f2\",\n                    \"#845ef7\",\n                    \"#9775fa\",\n                    \"#b197fc\",\n                    \"#d0bfff\",\n                    \"#e5dbff\",\n                    \"#f3f0ff\"\n                ],\n                indigo: [\n                    \"#364fc7\",\n                    \"#3b5bdb\",\n                    \"#4263eb\",\n                    \"#4c6ef5\",\n                    \"#5c7cfa\",\n                    \"#748ffc\",\n                    \"#91a7ff\",\n                    \"#bac8ff\",\n                    \"#dbe4ff\",\n                    \"#edf2ff\"\n                ],\n                blue: [\n                    \"#1864ab\",\n                    \"#1971c2\",\n                    \"#1c7ed6\",\n                    \"#228be6\",\n                    \"#339af0\",\n                    \"#4dabf7\",\n                    \"#74c0fc\",\n                    \"#a5d8ff\",\n                    \"#d0ebff\",\n                    \"#e7f5ff\"\n                ],\n                cyan: [\n                    \"#0b7285\",\n                    \"#0c8599\",\n                    \"#1098ad\",\n                    \"#15aabf\",\n                    \"#22b8cf\",\n                    \"#3bc9db\",\n                    \"#66d9e8\",\n                    \"#99e9f2\",\n                    \"#c5f6fa\",\n                    \"#e3fafc\"\n                ],\n                teal: [\n                    \"#087f5b\",\n                    \"#099268\",\n                    \"#0ca678\",\n                    \"#12b886\",\n                    \"#20c997\",\n                    \"#38d9a9\",\n                    \"#63e6be\",\n                    \"#96f2d7\",\n                    \"#c3fae8\",\n                    \"#e6fcf5\"\n                ],\n                green: [\n                    \"#2b8a3e\",\n                    \"#2f9e44\",\n                    \"#37b24d\",\n                    \"#40c057\",\n                    \"#51cf66\",\n                    \"#69db7c\",\n                    \"#8ce99a\",\n                    \"#b2f2bb\",\n                    \"#d3f9d8\",\n                    \"#ebfbee\"\n                ],\n                lime: [\n                    \"#5c940d\",\n                    \"#66a80f\",\n                    \"#74b816\",\n                    \"#82c91e\",\n                    \"#94d82d\",\n                    \"#a9e34b\",\n                    \"#c0eb75\",\n                    \"#d8f5a2\",\n                    \"#e9fac8\",\n                    \"#f4fce3\"\n                ],\n                yellow: [\n                    \"#e67700\",\n                    \"#f08c00\",\n                    \"#f59f00\",\n                    \"#fab005\",\n                    \"#fcc419\",\n                    \"#ffd43b\",\n                    \"#ffe066\",\n                    \"#ffec99\",\n                    \"#fff3bf\",\n                    \"#fff9db\"\n                ],\n                orange: [\n                    \"#d9480f\",\n                    \"#e8590c\",\n                    \"#f76707\",\n                    \"#fd7e14\",\n                    \"#ff922b\",\n                    \"#ffa94d\",\n                    \"#ffc078\",\n                    \"#ffd8a8\",\n                    \"#ffe8cc\",\n                    \"#fff4e6\"\n                ]\n            };\n            this.colors = this.opts.fontcolor ? this.opts.fontcolor : colors;\n        },\n        // Start method\n        start () {\n            let button = {\n                title: \"## fontcolor.title ##\",\n                color: true,\n                icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.50002 4.16336C8.18972 4.16336 7.89213 4.28662 7.67271 4.50604C7.45329 4.72546 7.33002 5.02305 7.33002 5.33336V6.50336H9.67002V5.33336C9.67002 5.02305 9.54676 4.72546 9.32734 4.50604C9.10792 4.28662 8.81033 4.16336 8.50002 4.16336ZM11.33 5.33336C11.33 4.58279 11.0319 3.86297 10.5011 3.33224C9.97041 2.80152 9.25059 2.50336 8.50002 2.50336C7.74946 2.50336 7.02964 2.80152 6.49891 3.33224C5.96818 3.86297 5.67002 4.58279 5.67002 5.33336V10C5.67002 10.4584 6.04163 10.83 6.50002 10.83C6.95842 10.83 7.33002 10.4584 7.33002 10V8.16336H9.67002V10C9.67002 10.4584 10.0416 10.83 10.5 10.83C10.9584 10.83 11.33 10.4584 11.33 10V5.33336ZM3.00336 12.6667C3.00336 12.2083 3.37496 11.8367 3.83336 11.8367H13.1667C13.6251 11.8367 13.9967 12.2083 13.9967 12.6667C13.9967 13.1251 13.6251 13.4967 13.1667 13.4967H3.83336C3.37496 13.4967 3.00336 13.1251 3.00336 12.6667Z\"/></svg>',\n                blocks: {\n                    all: \"editable\",\n                    except: [\n                        \"code\"\n                    ]\n                },\n                command: \"my-fontcolor.popup\"\n            };\n            // Remove the original fontcolor button (if it exists)\n            if (this.app.toolbar.buttons && this.app.toolbar.buttons.fontcolor) this.app.toolbar.remove(\"fontcolor\");\n            // Add our custom button\n            this.app.toolbar.add(\"fontcolor\", button);\n        },\n        // Use the popup method but extend it to include our custom functionality\n        popup (e, button) {\n            let inlines = this.app.selection.getNodes({\n                type: \"inline\"\n            });\n            this.currentColor = false;\n            this.currentBackgroundColor = false;\n            if (inlines) {\n                let $inline = this.dom(inlines[0]);\n                let style = this.app.utils.cssToObject($inline.attr(\"style\"));\n                this.currentColor = style.color ? style.color : this.currentColor;\n                this.currentBackgroundColor = style.background ? style.background : this.currentBackgroundColor;\n            }\n            let $dropdown = this.dom('<div class=\"' + this.prefix + '-dropdown-cells\">');\n            this.$selector = this._buildSelector();\n            this.$selectorText = this._buildSelectorItem(\"text\", this.lang.get(\"fontcolor.text\"));\n            this.$selectorText.addClass(\"active\");\n            this.$selectorBack = this._buildSelectorItem(\"back\", this.lang.get(\"fontcolor.background\"));\n            this.$selector.append(this.$selectorText);\n            this.$selector.append(this.$selectorBack);\n            this.$pickerText = this._buildPicker(\"textcolor\");\n            this.$pickerBack = this._buildPicker(\"backcolor\");\n            let width = Math.max(260, Object.keys(this.colors).length * 20);\n            $dropdown.append(this.$selector);\n            $dropdown.append(this.$pickerText);\n            $dropdown.append(this.$pickerBack);\n            $dropdown.width(width);\n            this._buildSelectorEvents();\n            this.app.popup.create(\"fontcolor\", {\n                width: width + \"px\",\n                html: $dropdown\n            });\n            this.app.popup.open({\n                button: button\n            });\n        },\n        // Private methods\n        _remove (type) {\n            this.app.popup.close();\n            let obj = type === \"color\" ? {\n                style: \"color\"\n            } : {\n                style: \"background\"\n            };\n            this.app.inline.remove(obj);\n        },\n        _buildSelector () {\n            let $selector = this.dom(\"<div>\");\n            $selector.addClass(this.prefix + \"-dropdown-selector\");\n            return $selector;\n        },\n        _buildSelectorItem (name, title) {\n            let $item = this.dom(\"<span>\");\n            $item.attr(\"rel\", name).html(title);\n            $item.addClass(this.prefix + \"-dropdown-not-close\");\n            return $item;\n        },\n        _buildSelectorEvents () {\n            this.$selectorText.on(\"click\", (function(e) {\n                e.preventDefault();\n                this.$selectorBack.removeClass(\"active\");\n                this.$selectorText.addClass(\"active\");\n                this.$pickerBack.hide();\n                this.$pickerText.show();\n            }).bind(this));\n            this.$selectorBack.on(\"click\", (function(e) {\n                e.preventDefault();\n                this.$selectorText.removeClass(\"active\");\n                this.$selectorBack.addClass(\"active\");\n                this.$pickerText.hide();\n                this.$pickerBack.show();\n            }).bind(this));\n        },\n        _buildPicker (name) {\n            var $box = this.dom('<div class=\"' + this.prefix + \"-dropdown-box-\" + name + '\">');\n            var $colorBox = this.dom('<div class=\"' + this.prefix + '-form-colors-box\">');\n            var rule = name == \"backcolor\" ? \"background\" : \"color\";\n            var len = this.colors.length;\n            var self = this;\n            // Add preset colors\n            for (let [key, item] of Object.entries(this.colors)){\n                var $div = this.dom('<div class=\"' + this.prefix + '-form-colors\">');\n                for(var i = 0; i < item.length; i++){\n                    var color = item[i];\n                    var $swatch = this.dom('<a href=\"#\">');\n                    $swatch.attr({\n                        \"rel\": color,\n                        \"data-rule\": rule\n                    });\n                    $swatch.css({\n                        \"background-color\": color,\n                        \"font-size\": 0,\n                        \"width\": \"20px\",\n                        \"height\": \"20px\"\n                    });\n                    $swatch.on(\"click\", (function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        var $el = this.dom(e.target);\n                        let color = $el.attr(\"rel\");\n                        let style = $el.data(\"rule\") === \"color\" ? {\n                            \"color\": color\n                        } : {\n                            \"background\": color\n                        };\n                        let params = {\n                            tag: \"span\",\n                            style: style\n                        };\n                        this.app.event.trigger = false;\n                        this.app.inline.set(params);\n                        setTimeout((function() {\n                            this.app.event.trigger = true;\n                        }).bind(this), 100);\n                    }).bind(this));\n                    if (rule === \"color\" && this.currentColor === color) $swatch.addClass(\"active\");\n                    if (rule === \"background\" && this.currentBackgroundColor === color) $swatch.addClass(\"active\");\n                    $div.append($swatch);\n                }\n                $colorBox.append($div);\n            }\n            $box.append($colorBox);\n            // Add custom color input field\n            var $customColorBox = this.dom('<div class=\"' + this.prefix + '-form-custom-color-box\">');\n            // Create label for custom color\n            // var $customColorLabel = this.dom('<div class=\"' + this.prefix + '-form-custom-color-label\">');\n            // $customColorLabel.html(this.lang.get('fontcolor.custom'));\n            // $customColorBox.append($customColorLabel);\n            // Create input group\n            var $customColorGroup = this.dom('<div class=\"' + this.prefix + '-form-custom-color-group\">');\n            // Create the hex input field\n            var $customColorInput = this.dom('<input type=\"text\" class=\"' + this.prefix + '-form-custom-color-input form-control\">');\n            $customColorInput.attr(\"placeholder\", this.lang.get(\"fontcolor.customhex\"));\n            // Create preview box next to input\n            var $customColorPreview = this.dom('<div class=\"' + this.prefix + '-form-custom-color-preview\">');\n            // Create the apply button\n            var $customColorApply = this.dom('<button class=\"' + this.prefix + '-form-custom-color-apply btn btn-secondary\">');\n            $customColorApply.html(this.lang.get(\"fontcolor.apply\"));\n            // Add event listeners\n            $customColorInput.on(\"input\", function() {\n                var hexValue = $customColorInput.val();\n                // Add hashtag if missing\n                if (hexValue && hexValue.charAt(0) !== \"#\") hexValue = \"#\" + hexValue;\n                // Validate hex color\n                if (/^#([0-9A-F]{3}){1,2}$/i.test(hexValue)) $customColorPreview.css(\"background-color\", hexValue);\n            });\n            $customColorApply.on(\"click\", (function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var hexValue = $customColorInput.val();\n                // Add hashtag if missing\n                if (hexValue && hexValue.charAt(0) !== \"#\") hexValue = \"#\" + hexValue;\n                // Validate hex color\n                if (/^#([0-9A-F]{3}){1,2}$/i.test(hexValue)) {\n                    let style = rule === \"color\" ? {\n                        \"color\": hexValue\n                    } : {\n                        \"background\": hexValue\n                    };\n                    let params = {\n                        tag: \"span\",\n                        style: style\n                    };\n                    this.app.event.trigger = false;\n                    this.app.inline.set(params);\n                    setTimeout((function() {\n                        this.app.event.trigger = true;\n                    }).bind(this), 100);\n                    this.app.popup.close();\n                } else // Handle invalid hex color\n                alert(\"Please enter a valid hex color code (e.g., #FF0000 or #F00)\");\n            }).bind(this));\n            // Assemble the custom color input group\n            $customColorGroup.append($customColorPreview);\n            $customColorGroup.append($customColorInput);\n            $customColorGroup.append($customColorApply);\n            $customColorBox.append($customColorGroup);\n            // Add custom color box to main box\n            $box.append($customColorBox);\n            // Add remove color option\n            var $el = this.dom(\"<div>\").addClass(this.prefix + \"-dropdown-remove-item\");\n            var $link = this.dom(\"<a>\");\n            $link.attr({\n                \"href\": \"#\"\n            });\n            $link.html(this.lang.get(\"fontcolor.remove\"));\n            $link.on(\"click\", function(e) {\n                e.preventDefault();\n                self._remove(rule);\n            });\n            $el.append($link);\n            $box.append($el);\n            if (name == \"backcolor\") $box.hide();\n            return $box;\n        }\n    });\n})();\n\n\nwindow.PShowBlockEditor = function(selector, settings) {\n    settings = settings || PShowBEConfig;\n    if (typeof PShowBEBaseUri !== \"undefined\") settings.css = PShowBEBaseUri + \"dist/\";\n    function convertDivsToP(html) {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(html, \"text/html\");\n        const divs = doc.querySelectorAll(\"div\");\n        divs.forEach((div)=>{\n            if (Array.from(div.childNodes).some((node)=>node.nodeType === Node.TEXT_NODE && node.textContent.trim() !== \"\") && !div.querySelector(\"div\")) {\n                const p = doc.createElement(\"p\");\n                p.innerHTML = div.innerHTML;\n                p.className = \"pse-p\";\n                p.style.cssText = div.style.cssText;\n                if (div.getAttribute(\"data-target-url\")) p.setAttribute(\"data-target-url\", div.getAttribute(\"data-target-url\"));\n                div.parentNode.replaceChild(p, div);\n            }\n        });\n        return doc.body.innerHTML;\n    }\n    setTimeout(()=>{\n        let toolbarTopOffset = document.getElementById(\"header_infos\").offsetHeight;\n        toolbarTopOffset += document.getElementsByClassName(\"header-toolbar\")[0]?.offsetHeight || 0;\n        toolbarTopOffset += document.getElementsByClassName(\"page-head\")[0]?.offsetHeight || 0;\n        let tinyMceInterval = {};\n        const textarea = document.querySelectorAll(selector);\n        let editor = {};\n        const observer = new MutationObserver(function(mutations) {\n            mutations.forEach(function(mutation) {\n                if (mutation.type === \"attributes\") {\n                    if (mutation.target.disabled) {\n                        editor[mutation.target.id].disable();\n                        return;\n                    }\n                    editor[mutation.target.id].enable();\n                }\n            });\n        });\n        for(let i = 0; i < textarea.length; i++){\n            const col = textarea[i].closest(\".col-lg-9\");\n            if (col) {\n                col.classList.add(\"col-lg-11\");\n                col.classList.remove(\"col-lg-9\");\n                const colLangSelector = col.nextElementSibling;\n                if (colLangSelector) {\n                    colLangSelector.classList.add(\"col-lg-1\");\n                    colLangSelector.classList.remove(\"col-lg-2\");\n                }\n            }\n            if (!textarea[i].id) textarea[i].id = \"pse-editor-\" + Math.random().toString(36).substring(2);\n            // remove tinymce\n            textarea[i].classList.remove(\"autoload_rte\");\n            // MIGRATIONS\n            // .grid    ->  .pse-grid\n            textarea[i].value = textarea[i].value.replace(/([^-])grid/g, \"$1pse-grid\");\n            // <table>  ->  <table class=\"pse-table\">\n            textarea[i].value = textarea[i].value.replace(/<table>/g, '<table class=\"pse-table\">');\n            // .valign- ->  .pse-valign-\n            textarea[i].value = textarea[i].value.replace(/([^-])valign-([a-z]+)/g, \"$1pse-valign-$2\");\n            // .align-  ->  .pse-align-\n            textarea[i].value = textarea[i].value.replace(/([^-v])align-([a-z]+)/, \"$1pse-align-$2\");\n            const valueDOM = new DOMParser().parseFromString(textarea[i].value, \"text/html\");\n            const valueOnlyDOM = valueDOM?.body?.firstChild;\n            if (valueOnlyDOM && typeof valueOnlyDOM.querySelector === \"function\") {\n                const contentDiv = valueOnlyDOM.querySelector('div[class=\"app__tabs__content__inner js__app__tabs__content pse-div\"]');\n                if (contentDiv && contentDiv?.innerHTML) textarea[i].value = contentDiv.innerHTML;\n            }\n            // <div (...) class=\"pse-div\">(some text)</div> -> <p ... class=\"pse-p\">(some text)</p>\n            textarea[i].value = convertDivsToP(textarea[i].value);\n            editor[textarea[i].id] = ArticleEditor(\"#\" + textarea[i].id, {\n                image: {\n                    width: true,\n                    types: [\n                        \"image/png\",\n                        \"image/jpeg\"\n                    ],\n                    upload: PShowEditorImageUploadControllerURL,\n                    select: PShowEditorImageListControllerURL\n                },\n                topbar: {\n                    undoredo: true\n                },\n                toolbar: {\n                    stickyTopOffset: toolbarTopOffset\n                },\n                snippets: PShowThemeCssUri + \"pshow-block-editor-snippets.json\",\n                custom: {\n                    css: [\n                        PShowBEBaseUri + \"dist/front.css\",\n                        \"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\",\n                        PShowThemeCssUri + \"pshow-block-editor.css\"\n                    ],\n                    js: [\n                        PShowBEBaseUri + \"dist/admin.js\"\n                    ]\n                },\n                subscribe: {\n                    \"editor.before.change\": function(event) {\n                        $('form[name=\"product\"] .cancel-button').prop(\"disabled\", false).removeClass(\"disabled\");\n                        $('form[name=\"product\"] .product-form-save-button').prop(\"disabled\", false).removeClass(\"disabled\");\n                        // remove data-temp-block tags\n                        const dom = new DOMParser().parseFromString(event.params.html, \"text/html\");\n                        const tempBlocks = dom.querySelectorAll('[data-temp-block=\"true\"]');\n                        if (tempBlocks) tempBlocks.forEach((block)=>{\n                            block.remove();\n                        });\n                        // restore cover images\n                        const replacedImages = dom.querySelectorAll(\".replaced-cover-image\");\n                        replacedImages.forEach((img)=>{\n                            img.src = \"{{cover}}\";\n                            img.classList.remove(\"replaced-cover-image\");\n                        });\n                        event.params.html = dom.body.outerHTML;\n                        const iframe = editor[textarea[i].id].editor.$editor.nodes[0];\n                        if (iframe) {\n                            iframe.contentWindow.pinProductBlockIds();\n                            iframe.contentWindow.replaceCoverImages();\n                        }\n                    }\n                },\n                plugins: [\n                    \"selector\",\n                    \"imageposition\",\n                    \"imageresize\",\n                    \"removeformat\",\n                    \"specialchars\",\n                    \"underline\",\n                    // 'definedlinks',\n                    \"counter\",\n                    \"blockcode\",\n                    \"reorder\",\n                    \"fontsize\",\n                    \"fontfamily\",\n                    \"my-fontcolor\",\n                    \"pshow-icons\",\n                    \"blocklink\",\n                    \"product-block\"\n                ],\n                path: {\n                    title: \"Editor\"\n                },\n                grid: {\n                    classname: \"pse-grid\"\n                },\n                table: {\n                    template: '<table class=\"pse-table\"><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>'\n                },\n                align: {\n                    \"left\": \"pse-align-left\",\n                    \"center\": \"pse-align-center\",\n                    \"right\": \"pse-align-right\",\n                    \"justify\": \"pse-align-justify\"\n                },\n                valign: {\n                    top: \"pse-valign-top\",\n                    middle: \"pse-valign-middle\",\n                    bottom: \"pse-valign-bottom\"\n                },\n                codemirror: {\n                    lineNumbers: true\n                },\n                classes: {\n                    \"p\": \"pse-p\",\n                    \"h1\": \"pse-h1\",\n                    \"h2\": \"pse-h2\",\n                    \"h3\": \"pse-h3\",\n                    \"h4\": \"pse-h4\",\n                    \"h5\": \"pse-h5\",\n                    \"h6\": \"pse-h6\",\n                    \"blockquote\": \"pse-blockquote\",\n                    \"pre\": \"pse-pre\",\n                    \"code\": \"pse-code\",\n                    \"table\": \"pse-table\",\n                    \"th\": \"pse-th\",\n                    \"td\": \"pse-td\",\n                    \"tr\": \"pse-tr\",\n                    \"ul\": \"pse-ul\",\n                    \"ol\": \"pse-ol\",\n                    \"li\": \"pse-li\",\n                    \"img\": \"pse-img\",\n                    \"a\": \"pse-a\",\n                    \"span\": \"pse-span\",\n                    \"div\": \"pse-div\",\n                    \"iframe\": \"pse-iframe\",\n                    \"figure\": \"pse-figure\",\n                    \"figcaption\": \"pse-figcaption\",\n                    \"section\": \"pse-section\",\n                    \"hr\": \"pse-hr\",\n                    \"b\": \"pse-b\",\n                    \"i\": \"pse-i\",\n                    \"u\": \"pse-u\",\n                    \"s\": \"pse-s\",\n                    \"del\": \"pse-del\",\n                    \"sub\": \"pse-sub\",\n                    \"sup\": \"pse-sup\",\n                    \"em\": \"pse-em\",\n                    \"strong\": \"pse-strong\",\n                    \"small\": \"pse-small\",\n                    \"abbr\": \"pse-abbr\"\n                },\n                // definedlinks: {\n                //     items: [\n                //         { \"name\": \"Select...\", \"url\": false },\n                //         { \"name\": \"Google\", \"url\": \"http://google.com\" },\n                //         { \"name\": \"Home\", \"url\": \"/\" },\n                //         { \"name\": \"About\", \"url\": \"/about/\" },\n                //         { \"name\": \"Contact\", \"url\": \"/contact/\" }\n                //     ]\n                // },\n                ...settings\n            });\n            observer.observe(textarea[i], {\n                attributes: true\n            });\n            // watch for changes made by jquery\n            let originalVal = $.fn.val;\n            $.fn.val = function(value) {\n                if (value !== undefined && this[0]?.id === textarea[i]?.id) editor[textarea[i].id].editor.setContent({\n                    html: value\n                });\n                return originalVal.apply(this, arguments);\n            };\n            // remove tinymce\n            if (typeof tinymce !== \"undefined\") {\n                tinymce.remove(`#${textarea[i].id}`);\n                textarea[i].style.display = \"none\";\n            }\n            tinyMceInterval[textarea[i].id] = setInterval(()=>{\n                if (typeof tinymce === \"undefined\") return;\n                tinymce.remove(`#${textarea[i].id}`);\n                textarea[i].style.display = \"none\";\n                clearInterval(tinyMceInterval[textarea[i].id]);\n            }, 2000);\n        }\n    }, 1);\n};\nwindow.addEventListener(\"load\", function() {\n    PShowBlockEditor(\"[data-pshow-block-editor]\");\n    if (PShowBEConfig?.editors_id) for (const id of PShowBEConfig.editors_id)PShowBlockEditor(id);\n    const head = document.head;\n    const link = document.createElement(\"link\");\n    link.href = \"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\";\n    link.rel = \"stylesheet\";\n    head.appendChild(link);\n});\n\n\n\n})();\n//# sourceMappingURL=index.js.map\n","import \"./editor/css/article-editor.min.css\";\nimport \"./editor/article-editor\";\n\nimport \"./editor/plugins/blockcode/blockcode\";\nimport \"./editor/plugins/buttonlink/buttonlink\";\nimport \"./editor/plugins/carousel/carousel\";\nimport \"./editor/plugins/carousel/carousel.css\";\nimport \"./editor/plugins/clips/clips\";\nimport \"./editor/plugins/counter/counter\";\nimport \"./editor/plugins/definedlinks/definedlinks\";\nimport \"./editor/plugins/filelink/filelink\";\nimport \"./editor/plugins/fontsize/fontsize\";\nimport \"./editor/plugins/fontfamily/fontfamily\";\nimport \"./editor/plugins/fontcolor/fontcolor\";\nimport \"./editor/plugins/handle/handle\";\nimport \"./editor/plugins/icons/icons\";\nimport \"./editor/plugins/imageposition/imageposition\";\nimport \"./editor/plugins/imageresize/imageresize\";\nimport \"./editor/plugins/inlineformat/inlineformat\";\nimport \"./editor/plugins/makebutton/makebutton\";\nimport \"./editor/plugins/math/math\";\nimport \"./editor/plugins/print/print\";\nimport \"./editor/plugins/removeformat/removeformat\";\nimport \"./editor/plugins/reorder/reorder\";\nimport \"./editor/plugins/selector/selector\";\nimport \"./editor/plugins/slideshow/slideshow\";\nimport \"./editor/plugins/slideshow/slideshow.css\";\nimport \"./editor/plugins/specialchars/specialchars\";\nimport \"./editor/plugins/style/style\";\nimport \"./editor/plugins/tags/tags\";\nimport \"./editor/plugins/tags/tags.css\";\nimport \"./editor/plugins/textdirection/textdirection\";\nimport \"./editor/plugins/underline/underline\";\nimport \"./editor/plugins/variable/variable\";\n\nimport \"./init\";\n\n","/*\n    Article Editor JS\n    Version 2.4.10\n    Updated: February 1, 2024\n\n    http://imperavi.com/article/\n\n    Copyright (c) 2009-2024, Imperavi Ltd.\n    License: http://imperavi.com/article/license/\n*/\nif (typeof CodeMirror === 'undefined') { var CodeMirror; }\n(function() {\n// Version 2.0\nvar Ajax = {};\n\nAjax.settings = {};\nAjax.post = function(options) { return new AjaxRequest('post', options); };\nAjax.get = function(options) { return new AjaxRequest('get', options); };\nAjax.request = function(method, options) { return new AjaxRequest(method, options); };\n\nvar AjaxRequest = function(method, options) {\n    var defaults = {\n        method: method,\n        url: '',\n        before: function() {},\n        success: function() {},\n        error: function() {},\n        data: false,\n        async: true,\n        headers: {}\n    };\n\n    this.p = this.extend(defaults, options);\n    this.p = this.extend(this.p, Ajax.settings);\n    this.p.method = this.p.method.toUpperCase();\n\n    this.prepareData();\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.open(this.p.method, this.p.url, this.p.async);\n\n    this.setHeaders();\n\n    var before = (typeof this.p.before === 'function') ? this.p.before(this.xhr) : true;\n    if (before !== false) {\n        this.send();\n    }\n};\n\nAjaxRequest.prototype = {\n    extend: function(obj1, obj2) {\n        if (obj2) {\n            Object.keys(obj2).forEach(function(key) {\n                obj1[key] = obj2[key];\n            });\n        }\n        return obj1;\n    },\n    prepareData: function() {\n        if (['POST', 'PUT'].indexOf(this.p.method) !== -1 && !this.isFormData()) this.p.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        if (typeof this.p.data === 'object' && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n        if (this.p.method === 'GET') {\n            var sign = (this.p.url.search(/\\?/) !== -1) ? '&' : '?';\n            this.p.url = (this.p.data) ? this.p.url + sign + this.p.data : this.p.url;\n        }\n    },\n    setHeaders: function() {\n        this.xhr.setRequestHeader('X-Requested-With', this.p.headers['X-Requested-With'] || 'XMLHttpRequest');\n        Object.keys(this.p.headers).forEach(function(key) {\n            this.xhr.setRequestHeader(key, this.p.headers[key]);\n        }.bind(this));\n    },\n    isFormData: function() {\n        return (typeof window.FormData !== 'undefined' && this.p.data instanceof window.FormData);\n    },\n    isComplete: function() {\n        return !(this.xhr.status < 200 || (this.xhr.status >= 300 && this.xhr.status !== 304));\n    },\n    send: function() {\n        if (this.p.async) {\n            this.xhr.onload = this.loaded.bind(this);\n            this.xhr.send(this.p.data);\n        }\n        else {\n            this.xhr.send(this.p.data);\n            this.loaded.call(this);\n        }\n    },\n    loaded: function() {\n        var response;\n        if (this.isComplete()) {\n            response = this.parseResponse();\n            if (typeof this.p.success === 'function') this.p.success(response, this.xhr);\n        }\n        else {\n            response = this.parseResponse();\n            if (typeof this.p.error === 'function') this.p.error(response, this.xhr, this.xhr.status);\n        }\n    },\n    parseResponse: function() {\n        var response = this.xhr.response;\n        var json = this.parseJson(response);\n        return (json) ? json : response;\n    },\n    parseJson: function(str) {\n        try {\n            var o = JSON.parse(str);\n            if (o && typeof o === 'object') {\n                return o;\n            }\n\n        } catch (e) {\n            return false;\n        }\n\n        return false;\n    },\n    toParams: function (obj) {\n        return Object.keys(obj).map(\n            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]); }\n        ).join('&');\n    }\n};\n// Version 2.0\nvar DomCache = [0];\nvar DomExpando = 'data' + new Date().getTime();\n\nvar Dom = function(selector, context) {\n    return this.parse(selector, context);\n};\n\nDom.ready = function(fn) {\n    document.addEventListener('DOMContentLoaded', fn);\n};\n\nDom.prototype = {\n    get length() {\n        return this.nodes.length;\n    },\n    parse: function(s, c) {\n        var n;\n        var rehtml = /^\\s*<(\\w+|!)[^>]*>/;\n\n        if (!s) {\n            n = [];\n        }\n        else if (s instanceof Dom) {\n            this.nodes = s.nodes;\n            return s;\n        }\n        else if (rehtml.test(s)) {\n            n = this.create(s);\n        }\n        else if (typeof s !== 'string') {\n            if (s.nodeType && s.nodeType === 11) n = s.childNodes;\n            else n = (s.nodeType || this._isWindowNode(s)) ? [s] : s;\n        }\n        else {\n            n = this._query(s, c);\n        }\n\n        this.nodes = this._slice(n);\n    },\n    create: function(html) {\n        if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html)) {\n            return [document.createElement(RegExp.$1)];\n        }\n\n        var elmns = [];\n        var c = document.createElement('div');\n        c.innerHTML = html;\n        for (var i = 0, l = c.childNodes.length; i < l; i++) {\n            elmns.push(c.childNodes[i]);\n        }\n\n        return elmns;\n    },\n\n    // dataset/dataget\n    dataset: function(key, value) {\n        return this.each(function($node) {\n            DomCache[this.dataindex($node.get())][key] = value;\n        });\n    },\n    dataget: function(key) {\n        return DomCache[this.dataindex(this.get())][key];\n    },\n    dataindex: function(el) {\n        var index = el[DomExpando];\n        var nextIndex = DomCache.length;\n\n        if (!index) {\n            index = nextIndex;\n            if (el) el[DomExpando] = nextIndex;\n            DomCache[index] = {};\n        }\n\n        return index;\n    },\n\n    // add\n    add: function(n) {\n        this.nodes = this.nodes.concat(this._array(n));\n        return this;\n    },\n\n    // get\n    get: function(index) {\n        return this.nodes[(index || 0)] || false;\n    },\n    getAll: function() {\n        return this.nodes;\n    },\n    eq: function(index) {\n        return new Dom(this.nodes[index]);\n    },\n    first: function() {\n        return new Dom(this.nodes[0]);\n    },\n    last: function() {\n        return new Dom(this.nodes[this.nodes.length - 1]);\n    },\n    contents: function() {\n        return this.get().childNodes;\n    },\n\n    // loop\n    each: function(fn) {\n        var len = this.nodes.length;\n        for (var i = 0; i < len; i++) {\n            fn.call(this, new Dom(this.nodes[i]), i);\n        }\n\n        return this;\n    },\n\n    // traversing\n    is: function(s) {\n        return (this.filter(s).length > 0);\n    },\n    filter: function (s) {\n        var fn;\n        if (s === undefined) {\n            return this;\n        }\n        else if (typeof s === 'function') {\n            fn = function(node) { return s(new Dom(node)); };\n        }\n        else {\n            fn = function(node) {\n                if ((s && s.nodeType) || s instanceof Node) {\n                    return (s === node);\n                }\n                else {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return (node.nodeType === 1) ? node.matches(s || '*') : false;\n                }\n            };\n        }\n\n        return new Dom(this.nodes.filter.call(this.nodes, fn));\n    },\n    not: function(filter) {\n        return this.filter(function(node) { return !new Dom(node).is(filter || true); });\n    },\n    find: function(s) {\n        var n = [];\n        this.each(function($n) {\n            var node = $n.get();\n            var ns = this._query(s, node);\n            for (var i = 0; i < ns.length; i++) {\n                n.push(ns[i]);\n            }\n        });\n\n        return new Dom(n);\n    },\n    children: function(s) {\n        var n = [];\n        this.each(function($n) {\n            var node = $n.get();\n            if (node.children) {\n                var ns = node.children;\n                for (var i = 0; i < ns.length; i++) {\n                    n.push(ns[i]);\n                }\n            }\n        });\n\n        return new Dom(n).filter(s);\n    },\n    parent: function(s) {\n        var node = this.get();\n        var p = (node.parentNode) ? node.parentNode : false;\n        return (p) ? new Dom(p).filter(s) : new Dom();\n    },\n    parents: function(s, c) {\n        c = this._context(c);\n\n        var n = [];\n        this.each(function($n) {\n            var node = $n.get();\n            var p = node.parentNode;\n            while (p && p !== c) {\n                if (s) {\n                    if (new Dom(p).is(s)) { n.push(p); }\n                }\n                else {\n                    n.push(p);\n                }\n\n                p = p.parentNode;\n            }\n        });\n\n        return new Dom(n);\n    },\n    closest: function(s, c) {\n        c = this._context(c);\n\n        var n = [];\n        var isNode = (s && s.nodeType);\n        this.each(function($n) {\n            var node = $n.get();\n            do {\n                if (node && ((isNode && node === s) || new Dom(node).is(s))) {\n                    return n.push(node);\n                }\n            } while ((node = node.parentNode) && node !== c);\n        });\n\n        return new Dom(n);\n    },\n    next: function(s) {\n        return this._sibling(s, 'nextSibling');\n    },\n    nextElement: function(s) {\n        return this._sibling(s, 'nextElementSibling');\n    },\n    prev: function(s) {\n        return this._sibling(s, 'previousSibling');\n    },\n    prevElement: function(s) {\n        return this._sibling(s, 'previousElementSibling');\n    },\n\n    // css\n    css: function(name, value) {\n        if (value === undefined && (typeof name !== 'object')) {\n            var node = this.get();\n            if (name === 'width' || name === 'height') {\n                return (node.style) ? this._getHeightOrWidth(name) + 'px' : undefined;\n            }\n            else {\n                return (node.style) ? getComputedStyle(node, null)[name] : undefined;\n            }\n        }\n\n        // set\n        return this.each(function($n) {\n            var node = $n.get();\n            var o = {};\n            if (typeof name === 'object') o = name;\n            else o[name] = value;\n\n            for (var key in o) {\n                if (node.style) node.style[key] = o[key];\n            }\n        });\n    },\n\n    // attr\n    attr: function(name, value, data) {\n        data = (data) ? 'data-' : '';\n\n        if (typeof value === 'undefined' && (typeof name !== 'object')) {\n            var node = this.get();\n            if (node && node.nodeType !== 3) {\n                return (name === 'checked') ? node.checked : this._boolean(node.getAttribute(data + name));\n            }\n            else {\n                return;\n            }\n        }\n\n        // set\n        return this.each(function($n) {\n            var node = $n.get();\n            var o = {};\n            if (typeof name === 'object') o = name;\n            else o[name] = value;\n\n            for (var key in o) {\n                if (node.nodeType !== 3) {\n                    if (key === 'checked') node.checked = o[key];\n                    else node.setAttribute(data + key, o[key]);\n                }\n            }\n        });\n    },\n    data: function(name, value) {\n        if (name === undefined || name === true) {\n            var reDataAttr = /^data-(.+)$/;\n            var attrs = this.get().attributes;\n\n            var data = {};\n            var replacer = function (g) { return g[1].toUpperCase(); };\n\n            for (var key in attrs) {\n                if (attrs[key] && reDataAttr.test(attrs[key].nodeName)) {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    if (name !== true) {\n                        dataName = dataName.replace(/-([a-z])/g, replacer);\n                    }\n\n                    if (val.search(/^{/) !== -1) val = this._object(val);\n                    else val = (this._number(val)) ? parseFloat(val) : this._boolean(val);\n\n                    data[dataName] = val;\n                }\n            }\n\n            return data;\n        }\n\n        return this.attr(name, value, true);\n    },\n    val: function(value) {\n        if (value === undefined) {\n            var el = this.get();\n            if (el.type && el.type === 'checkbox') return el.checked;\n            else return el.value;\n        }\n\n        return this.each(function($n) {\n            var el = $n.get();\n            if (el.type && el.type === 'checkbox') el.checked = value;\n            else el.value = value;\n        });\n    },\n    removeAttr: function(value) {\n        return this.each(function($n) {\n            var node = $n.get();\n            var fn = function(name) { if (node.nodeType !== 3) node.removeAttribute(name); };\n            value.split(' ').forEach(fn);\n        });\n    },\n\n    // class\n    addClass: function(value) {\n        return this._eachClass(value, 'add');\n    },\n    removeClass: function(value) {\n        return this._eachClass(value, 'remove');\n    },\n    toggleClass: function(value) {\n        return this._eachClass(value, 'toggle');\n    },\n    hasClass: function(value) {\n        var node = this.get();\n        if (value) {\n            var classes = value.split(' ');\n            return (node.classList) ? node.matches('.' + classes.join('.')) : false;\n        }\n        else {\n            return false;\n        }\n    },\n\n    // html & text\n    empty: function() {\n        return this.each(function($n) { $n.get().innerHTML = ''; });\n    },\n    html: function(html) {\n        return (html === undefined) ? (this.get().innerHTML || '') : this.empty().append(html);\n    },\n    text: function(text) {\n        return (text === undefined) ? (this.get().textContent || '') : this.each(function($n) { $n.get().textContent = text; });\n    },\n\n    // manipulation\n    after: function(html) {\n        return this._inject(html, function(frag, node) {\n            if (typeof frag === 'string') {\n                node.insertAdjacentHTML('afterend', frag);\n            }\n            else {\n                if (node.parentNode !== null) {\n                    for (var i = frag instanceof Node ? [frag] : this._array(frag).reverse(), s = 0; s < i.length; s++) {\n                        node.parentNode.insertBefore(i[s], node.nextSibling);\n                    }\n                }\n            }\n\n            return node;\n        });\n    },\n    before: function(html) {\n        return this._inject(html, function(frag, node) {\n            if (typeof frag === 'string') {\n                node.insertAdjacentHTML('beforebegin', frag);\n            }\n            else {\n                var elms = (frag instanceof Node) ? [frag] : this._array(frag);\n                for (var i = 0; i < elms.length; i++) {\n                    node.parentNode.insertBefore(elms[i], node);\n                }\n            }\n\n            return node;\n        });\n    },\n    append: function(html) {\n        return this._inject(html, function(frag, node) {\n            if (typeof frag === 'string' || typeof frag === 'number') {\n                node.insertAdjacentHTML('beforeend', frag);\n            }\n            else {\n                var elms = (frag instanceof Node) ? [frag] : this._array(frag);\n                for (var i = 0; i < elms.length; i++) {\n                    node.appendChild(elms[i]);\n                }\n            }\n\n            return node;\n        });\n    },\n    prepend: function(html) {\n        return this._inject(html, function(frag, node) {\n            if (typeof frag === 'string' || typeof frag === 'number') {\n                node.insertAdjacentHTML('afterbegin', frag);\n            }\n            else {\n                var elms = (frag instanceof Node) ? [frag] : this._array(frag).reverse();\n                for (var i = 0; i < elms.length; i++) {\n                    node.insertBefore(elms[i], node.firstChild);\n                }\n            }\n\n            return node;\n        });\n    },\n    wrap: function(html) {\n        return this._inject(html, function(frag, node) {\n            var wrapper = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag)[0] : (frag instanceof Node) ? frag : this._array(frag)[0];\n\n            if (node.parentNode) {\n                node.parentNode.insertBefore(wrapper, node);\n            }\n\n            wrapper.appendChild(node);\n            return wrapper;\n        });\n    },\n    unwrap: function() {\n        return this.each(function($n) {\n            var node = $n.get();\n            var docFrag = document.createDocumentFragment();\n            while (node.firstChild) {\n                var child = node.removeChild(node.firstChild);\n                docFrag.appendChild(child);\n            }\n\n            node.parentNode.replaceChild(docFrag, node);\n        });\n    },\n    replaceWith: function(html) {\n        return this._inject(html, function(frag, node) {\n            var docFrag = document.createDocumentFragment();\n            var elms = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag) : (frag instanceof Node) ? [frag] : this._array(frag);\n\n            for (var i = 0; i < elms.length; i++) {\n                docFrag.appendChild(elms[i]);\n            }\n\n            var result = docFrag.childNodes[0];\n            if (node.parentNode) {\n                node.parentNode.replaceChild(docFrag, node);\n            }\n\n            return result;\n        });\n    },\n    remove: function() {\n        return this.each(function($n) {\n            var node = $n.get();\n            if (node.parentNode) node.parentNode.removeChild(node);\n        });\n    },\n    clone: function(events) {\n        var n = [];\n        this.each(function($n) {\n            var node = $n.get();\n            var copy = this._clone(node);\n            if (events) copy = this._cloneEvents(node, copy);\n            n.push(copy);\n        });\n\n        return new Dom(n);\n    },\n\n    // show/hide\n    show: function() {\n        return this.each(function($n) {\n            var node = $n.get();\n            if (!node.style || !this._hasDisplayNone(node)) return;\n\n            var target = node.getAttribute('domTargetShow');\n            node.style.display = (target) ? target : 'block';\n            node.removeAttribute('domTargetShow');\n\n        }.bind(this));\n    },\n    hide: function() {\n        return this.each(function($n) {\n            var node = $n.get();\n            if (!node.style || this._hasDisplayNone(node)) return;\n\n            var display = node.style.display;\n            if (display !== 'block') node.setAttribute('domTargetShow', display);\n            node.style.display = 'none';\n        });\n    },\n\n    // dimensions\n    scrollTop: function(value) {\n        var node = this.get();\n        var isWindow = this._isWindowNode(node);\n        var isDocument = (node.nodeType === 9);\n        var el = (isDocument) ? (node.scrollingElement || node.body.parentNode || node.body || node.documentElement) : node;\n\n        if (typeof value !== 'undefined') {\n            value = parseInt(value);\n            if (isWindow) node.scrollTo(0, value);\n            else el.scrollTop = value;\n            return;\n        }\n\n        return (isWindow) ? node.pageYOffset : el.scrollTop;\n    },\n    offset: function() {\n        return this._getPos('offset');\n    },\n    position: function() {\n        return this._getPos('position');\n    },\n    width: function(value) {\n        return (value !== undefined) ? this.css('width', parseInt(value) + 'px') : this._getSize('width', 'Width');\n    },\n    height: function(value) {\n        return (value !== undefined) ? this.css('height', parseInt(value) + 'px') : this._getSize('height', 'Height');\n    },\n    outerWidth: function() {\n        return this._getSize('width', 'Width', 'outer');\n    },\n    outerHeight: function() {\n        return this._getSize('height', 'Height', 'outer');\n    },\n    innerWidth: function() {\n        return this._getSize('width', 'Width', 'inner');\n    },\n    innerHeight: function() {\n        return this._getSize('height', 'Height', 'inner');\n    },\n\n    // events\n    click: function() {\n        return this._trigger('click');\n    },\n    focus: function() {\n        return this._trigger('focus');\n    },\n    blur: function() {\n        return this._trigger('blur');\n    },\n    on: function(names, handler, one) {\n        return this.each(function($n) {\n            var node = $n.get();\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++) {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                handler = (one) ? this._getOneHandler(handler, names) : handler;\n                node.addEventListener(event, handler);\n\n                node._e = node._e || {};\n                node._e[namespace] = node._e[namespace] || {};\n                node._e[namespace][event] = node._e[namespace][event] || [];\n                node._e[namespace][event].push(handler);\n            }\n\n        });\n    },\n    one: function(events, handler) {\n        return this.on(events, handler, true);\n    },\n    off: function(names, handler) {\n        var testEvent = function(name, key, event) { return (name === event); };\n        var testNamespace = function(name, key, event, namespace) { return (key === namespace); };\n        var testEventNamespace = function(name, key, event, namespace) { return (name === event && key === namespace); };\n        var testPositive = function() { return true; };\n\n        if (names === undefined) {\n            // all\n            return this.each(function($n) {\n                this._offEvent($n.get(), false, false, handler, testPositive);\n            });\n        }\n\n        return this.each(function($n) {\n            var node = $n.get();\n            var events = names.split(' ');\n\n            for (var i = 0; i < events.length; i++) {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                // 1) event without namespace\n                if (namespace === '_events') this._offEvent(node, event, namespace, handler, testEvent);\n                // 2) only namespace\n                else if (!event && namespace !== '_events') this._offEvent(node, event, namespace, handler, testNamespace);\n                // 3) event + namespace\n                else this._offEvent(node, event, namespace, handler, testEventNamespace);\n            }\n        });\n    },\n\n    // form\n    serialize: function(asObject) {\n        var obj = {};\n        var elms = this.get().elements;\n        for (var i = 0; i < elms.length; i++) {\n            var el = elms[i];\n            if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n            if (!el.name || el.disabled || el.type === 'file') continue;\n\n            if (el.type === 'select-multiple') {\n                for (var z = 0; z < el.options.length; z++) {\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n            }\n\n            obj[el.name] = (this._number(el.value)) ? parseFloat(el.value) : this._boolean(el.value);\n        }\n\n        return (asObject) ? obj : this._params(obj);\n    },\n\n    // animation\n    scroll: function() {\n        this.get().scrollIntoView({ behavior: 'smooth' });\n    },\n    fadeIn: function(speed, fn) {\n        var anim = this._anim(speed, fn, 500);\n\n        return this.each(function($n) {\n            $n.css({ 'display': 'block', 'opacity': 0, 'animation': 'fadeIn ' + anim.speed + 's ease-in-out' }).removeClass('hidden');\n            $n.one('animationend', function() {\n                $n.css({ 'opacity': '', 'animation': '' });\n                if (anim.fn) anim.fn($n);\n            });\n        });\n    },\n    fadeOut: function(speed, fn) {\n        var anim = this._anim(speed, fn, 300);\n\n        return this.each(function($n) {\n            $n.css({ 'opacity': 1, 'animation': 'fadeOut ' + anim.speed + 's ease-in-out' });\n            $n.one('animationend', function() {\n                $n.css({ 'display': 'none', 'opacity': '', 'animation': '' });\n                if (anim.fn) anim.fn($n);\n            });\n        });\n    },\n    slideUp: function(speed, fn) {\n        var anim = this._anim(speed, fn, 300);\n\n        return this.each(function($n) {\n            $n.height($n.height());\n            $n.css({ 'overflow': 'hidden', 'animation': 'slideUp ' + anim.speed + 's ease-out' });\n            $n.one('animationend', function() {\n                $n.css({ 'display': 'none', 'height': '', 'animation': '' });\n                if (anim.fn) anim.fn($n);\n            });\n        });\n    },\n    slideDown: function(speed, fn) {\n        var anim = this._anim(speed, fn, 400);\n\n        return this.each(function($n) {\n            $n.height($n.height());\n            $n.css({ 'display': 'block', 'overflow': 'hidden', 'animation': 'slideDown ' + anim.speed + 's ease-in-out' }).removeClass('hidden');\n            $n.one('animationend', function() {\n                $n.css({ 'overflow': '', 'height': '', 'animation': '' });\n                if (anim.fn) anim.fn($n);\n            });\n        });\n    },\n\n    // private\n    _queryContext: function(s, c) {\n        c = this._context(c);\n        return (c.nodeType !== 3 && typeof c.querySelectorAll === 'function') ? c.querySelectorAll(s) : [];\n    },\n    _query: function(s, c) {\n        var d = document;\n        if (c) {\n            return this._queryContext(s, c);\n        }\n        else if (/^[.#]?[\\w-]*$/.test(s)) {\n            if (s[0] === '#') {\n                var el = d.getElementById(s.slice(1));\n                return el ? [el] : [];\n            }\n            if (s[0] === '.') {\n                return d.getElementsByClassName(s.slice(1));\n            }\n\n            return d.getElementsByTagName(s);\n        }\n\n        return d.querySelectorAll(s);\n    },\n    _context: function(c) {\n        return (!c) ? document : ((typeof c === 'string') ? document.querySelector(c) : c);\n    },\n    _sibling: function(s, method) {\n        var isNode = (s && s.nodeType);\n        var sibling;\n\n        this.each(function($n) {\n            var node = $n.get();\n            do {\n                node = node[method];\n                 if (node && ((isNode && node === s) || new Dom(node).is(s))) {\n                    sibling = node;\n                    return;\n                }\n            }\n            while (node);\n        });\n\n        return new Dom(sibling);\n    },\n    _slice: function(o) {\n        return (!o || o.length === 0) ? [] : (o.length) ? [].slice.call(o.nodes || o) : [o];\n    },\n    _array: function(o) {\n        if (o === undefined) return [];\n        else if (o instanceof NodeList) {\n            var arr = [];\n            for (var i = 0; i < o.length; i++) {\n                arr[i] = o[i];\n            }\n\n            return arr;\n        }\n\n        return (o instanceof Dom) ? o.nodes : o;\n    },\n    _object: function(str) {\n        var jsonStr = str.replace(/(\\w+:)|(\\w+ :)/g, function(matchedStr) {\n            return '\"' + matchedStr.substring(0, matchedStr.length - 1) + '\":';\n        });\n\n        return JSON.parse(jsonStr);\n    },\n    _params: function(obj) {\n        var params = '';\n        Object.keys(obj).forEach(function(key) {\n            params += '&' + this._encodeUri(key) + '=' + this._encodeUri(obj[key]);\n        }.bind(this));\n\n        return params.replace(/^&/, '');\n    },\n    _boolean: function(str) {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _number: function(str) {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _inject: function(html, fn) {\n        var len = this.nodes.length;\n        var nodes = [];\n        while (len--) {\n            var res = (typeof html === 'function') ? html.call(this, this.nodes[len]) : html;\n            var el = (len === 0) ? res : this._clone(res);\n            var node = fn.call(this, el, this.nodes[len]);\n\n            if (node) {\n                if (node.dom) nodes.push(node.get());\n                else nodes.push(node);\n            }\n        }\n\n        return new Dom(nodes);\n    },\n    _clone: function(node) {\n        if (typeof node === 'undefined') return;\n        if (typeof node === 'string') return node;\n        else if (node instanceof Node || node.nodeType) return node.cloneNode(true);\n        else if ('length' in node) {\n            return [].map.call(this._array(node), function(el) { return el.cloneNode(true); });\n        }\n    },\n    _cloneEvents: function(node, copy) {\n        var events = node._e;\n        if (events) {\n            copy._e = events;\n            for (var name in events._events) {\n                if (events._events.hasOwnProperty(name)) {\n                    for (var i = 0; i < events._events[name].length; i++) {\n                        copy.addEventListener(name, events._events[name][i]);\n                    }\n                }\n            }\n        }\n\n        return copy;\n    },\n    _trigger: function(name) {\n        var node = this.get();\n        if (node && node.nodeType !== 3) node[name]();\n        return this;\n    },\n    _encodeUri: function(str) {\n        return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A').replace(/%20/g, '+');\n    },\n    _getSize: function(name, cname) {\n        var el = this.get();\n        var value = 0;\n        if (el.nodeType === 3) {\n            value = 0;\n        }\n        else if (el.nodeType === 9) {\n            value = this._getDocSize(el, cname);\n        }\n        else if (this._isWindowNode(el)) {\n            value = window['inner' + cname];\n        }\n        else {\n            value = this._getHeightOrWidth(name);\n        }\n\n        return Math.round(value);\n    },\n    _getDocSize: function(node, type) {\n        var body = node.body, html = node.documentElement;\n        return Math.max(body['scroll' + type], body['offset' + type], html['client' + type], html['scroll' + type], html['offset' + type]);\n    },\n    _getPos: function(type) {\n        var node = this.get();\n        var dim = { top: 0, left: 0 };\n        if (node.nodeType === 3 || this._isWindowNode(node) || node.nodeType === 9) {\n            return dim;\n        }\n        else if (type === 'position') {\n            return { top: node.offsetTop, left: node.offsetLeft };\n        }\n        else if (type === 'offset') {\n            var rect = node.getBoundingClientRect();\n            var doc = node.ownerDocument;\n            var docElem = doc.documentElement;\n            var win = doc.defaultView;\n\n            return {\n                top: rect.top + win.pageYOffset - docElem.clientTop,\n                left: rect.left + win.pageXOffset - docElem.clientLeft\n            };\n        }\n\n        return dim;\n    },\n    _getHeightOrWidth: function(name, type) {\n        var cname = name.charAt(0).toUpperCase() + name.slice(1);\n        var mode = (type) ? type : 'offset';\n        var result = 0;\n        var el = this.get();\n        var style = getComputedStyle(el, null);\n        var $targets = this.parents().filter(function($n) {\n            var node = $n.get();\n            return (node.nodeType === 1 && getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        if (style.display === 'none') $targets.add(el);\n        if ($targets.length !== 0) {\n            var fixStyle = 'visibility: hidden !important; display: block !important;';\n            var tmp = [];\n\n            $targets.each(function($n) {\n                var thisStyle = $n.attr('style');\n                if (thisStyle !== null) tmp.push(thisStyle);\n                $n.attr('style', (thisStyle !== null) ? thisStyle + ';' + fixStyle : fixStyle);\n            });\n\n            result = el[mode + cname];\n\n            $targets.each(function($n, i) {\n                if (tmp[i] === undefined) $n.removeAttr('style');\n                else $n.attr('style', tmp[i]);\n            });\n        }\n        else {\n            result = el[mode + cname];\n        }\n\n        return result;\n    },\n    _eachClass: function(value, type) {\n        return this.each(function($n) {\n            if (value) {\n                var node = $n.get();\n                var fn = function(name) { if (node.classList) node.classList[type](name); };\n                value.split(' ').forEach(fn);\n            }\n        });\n    },\n    _getOneHandler: function(handler, events) {\n        var self = this;\n        return function() {\n            handler.apply(this, arguments);\n            self.off(events);\n        };\n    },\n    _getEventNamespace: function(event) {\n        var arr = event.split('.');\n        var namespace = (arr[1]) ? arr[1] : '_events';\n        return (arr[2]) ? namespace + arr[2] : namespace;\n    },\n    _getEventName: function(event) {\n        return event.split('.')[0];\n    },\n    _offEvent: function(node, event, namespace, handler, condition) {\n        for (var key in node._e) {\n            if (node._e.hasOwnProperty(key)) {\n                for (var name in node._e[key]) {\n                    if (condition(name, key, event, namespace)) {\n                        var handlers = node._e[key][name];\n                        for (var i = 0; i < handlers.length; i++) {\n                            if (typeof handler !== 'undefined' && handlers[i].toString() !== handler.toString()) {\n                                continue;\n                            }\n\n                            node.removeEventListener(name, handlers[i]);\n                            node._e[key][name].splice(i, 1);\n\n                            if (node._e[key][name].length === 0) delete node._e[key][name];\n                            if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                        }\n                    }\n                }\n            }\n        }\n    },\n    _hasDisplayNone: function(el) {\n        return (el.style.display === 'none') || ((el.currentStyle) ? el.currentStyle.display : getComputedStyle(el, null).display) === 'none';\n    },\n    _anim: function(speed, fn, speedDef) {\n        if (typeof speed === 'function') {\n            fn = speed;\n            speed = speedDef;\n        }\n        else {\n            speed = speed || speedDef;\n        }\n\n        return {\n            fn: fn,\n            speed: speed/1000\n        };\n    },\n    _isWindowNode: function(node) {\n        return (node === window || (node.parent && node.parent === window));\n    }\n};\n// Unique ID\nvar arx_uuid = 0;\n\n// Init\nvar ArticleEditor = function(selector, settings) {\n    return ArticleEditorInit(selector, settings);\n};\n\n// Class\nvar ArticleEditorInit = function(selector, settings) {\n    var $elms = $ARX.dom(selector);\n    var instance;\n    $elms.each(function($el) {\n        instance = $el.dataget($ARX.namespace);\n        if (!instance) {\n            // Initialization\n            instance = new App($el, settings, arx_uuid);\n            $el.dataset($ARX.namespace, instance);\n            $ARX.instances[arx_uuid] = instance;\n            arx_uuid++;\n        }\n    });\n\n    return instance;\n};\n\nvar $ARX = ArticleEditor;\n\n// Dom & Ajax\n$ARX.dom = function(selector, context) { return new Dom(selector, context); };\n$ARX.ajax = Ajax;\n\n// Globals\n$ARX.instances = [];\n$ARX.namespace = 'article-editor';\n$ARX.prefix = 'arx';\n$ARX.version = '2.4.10';\n$ARX.settings = {};\n$ARX.lang = {};\n$ARX._mixins = {};\n$ARX._repository = {};\n$ARX._subscribe = {};\n$ARX.keycodes = {\n    BACKSPACE: 8,\n    DELETE: 46,\n    UP: 38,\n    DOWN: 40,\n    ENTER: 13,\n    SPACE: 32,\n    ESC: 27,\n    TAB: 9,\n    CTRL: 17,\n    META: 91,\n    SHIFT: 16,\n    ALT: 18,\n    RIGHT: 39,\n    LEFT: 37\n};\n\n// Add\n$ARX.add = function(type, name, obj) {\n    // translations\n    if (obj.translations) {\n        $ARX.lang = $ARX.extend(true, $ARX.lang, obj.translations);\n    }\n\n    // defaults\n    if (obj.defaults) {\n        var localopts = {};\n        localopts[name] = obj.defaults;\n        $ARX.opts = $ARX.extend(true, $ARX.opts, localopts);\n    }\n\n    // extend parser\n    if (obj.parser) {\n        var opt = {};\n        opt[obj.type] = obj.parser;\n        $ARX.opts.parser = $ARX.extend({}, true, $ARX.opts.parser, opt);\n    }\n\n    // extend nested\n    if (obj.nested) {\n        $ARX.opts.nested.push(obj.type);\n    }\n\n    if (type === 'mixin') {\n        $ARX._mixins[name] = obj;\n    }\n    else {\n        // subscribe\n        if (obj.subscribe) {\n            for (var key in obj.subscribe) {\n                if (obj.subscribe.hasOwnProperty(key)) {\n                    var arr = key.split(',');\n                    for (var i = 0; i < arr.length; i++) {\n                        var ns = arr[i].trim();\n                        if (typeof $ARX._subscribe[ns] === 'undefined') $ARX._subscribe[ns] = [];\n                        $ARX._subscribe[ns].push({ module: name, func: obj.subscribe[key] });\n                    }\n                }\n            }\n        }\n\n        // prototype\n        var F = function() {};\n        F.prototype = obj;\n\n        // mixins\n        if (obj.mixins) {\n            for (var z = 0; z < obj.mixins.length; z++) {\n                $ARX.inherit(F, $ARX._mixins[obj.mixins[z]]);\n            }\n        }\n\n        $ARX._repository[name] = { type: type, proto: F, obj: obj };\n    }\n};\n\n// Extend\n$ARX.extend = function() {\n    var extended = {};\n    var deep = false;\n    var i = 0;\n    var length = arguments.length;\n\n    if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\n        deep = arguments[0];\n        i++;\n    }\n\n    var merge = function(obj) {\n        for (var prop in obj) {\n            if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n                if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') extended[prop] = $ARX.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        }\n    };\n\n    for (; i < length; i++) {\n        var obj = arguments[i];\n        merge(obj);\n    }\n\n    return extended;\n};\n\n// Error\n$ARX.error = function(exception) {\n    throw exception;\n};\n\n// Inherit\n$ARX.inherit = function(current, parent) {\n    var F = function() {};\n    F.prototype = parent;\n    var f = new F();\n\n    for (var prop in current.prototype) {\n        if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n    }\n\n    current.prototype = f;\n    current.prototype.super = parent;\n\n    return current;\n};\n\n// Lang\n$ARX.addLang = function(lang, obj) {\n    if (typeof $ARX.lang[lang] === 'undefined') $ARX.lang[lang] = {};\n    $ARX.lang[lang] = $ARX.extend(true, $ARX.lang[lang], obj);\n};\n\nArticleEditor.opts = {\n    plugins: [],\n    content: false,\n    placeholder: false,\n    css: false,\n    custom: {\n        css: false,\n        js: false\n    },\n    editor: {\n        classname: 'entry',\n        disabled: false,\n        focus: false,\n        sync: true,\n        drop: true,\n        lang: 'en',\n        add: 'top',\n        addbar: false,\n        https: false,\n        padding: true,\n        markup: 'paragraph',\n        mobile: 400,\n        enterKey: true,\n        scrollTarget: window,\n        direction: 'ltr',\n        spellcheck: true,\n        grammarly: true,\n        notranslate: false,\n        reloadmarker: true,\n        minHeight: '100px', // string, '500px'\n        maxHeight: false, // string, '500px'\n        doctype: '<!doctype html>',\n        csscache: false\n    },\n    selection: {\n        multiple: true,\n    },\n    control: true,\n    source: true,\n    image: {\n        states: true,\n        upload: false,\n        url: true,\n        select: false,\n        selectMethod: 'get',\n        name: 'file',\n        data: false,\n        drop: true,\n        multiple: true,\n        clipboard: true,\n        types: ['image/*'],\n        tag: 'figure', // p, div, figure\n        newtab: false,\n        link: true,\n        width: false\n    },\n    classes: false,\n    codemirrorSrc: false,\n    codemirror: false,\n    state: {\n        limit: 100\n    },\n    path: {\n        title: '## editor.title ##',\n        sticky: true,\n        stickyMinHeight: 200, // pixels\n        stickyTopOffset: 0 // number\n    },\n    autosave: {\n        url: false,\n        name: false,\n        data: false,\n        method: 'post'\n    },\n    paste: {\n        clean: true,\n        autoparse: true,\n        paragraphize: true,\n        plaintext: false,\n        linkTarget: false,\n        images: true,\n        links: true,\n        keepStyle: [],\n        keepClass: [],\n        keepAttrs: ['td', 'th'],\n        formTags: ['form', 'input', 'button', 'select', 'textarea', 'legend', 'fieldset'],\n        blockTags: ['pre', 'div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'hr', 'figure', 'iframe', 'figcaption', 'address', 'section', 'header', 'footer', 'aside', 'article', 'audio', 'source'],\n        inlineTags: ['a', 'svg', 'img', 'br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i', 'abbr']\n    },\n    clean: {\n        comments: false,\n        enter: true,\n        enterinline: false\n    },\n    tab: {\n        key: true,\n        spaces: false // true or number of spaces\n    },\n    topbar: {\n        undoredo: false,\n        shortcuts: true\n    },\n    toolbar: {\n        hide: [],\n        sticky: true,\n        stickyMinHeight: 200, // pixels\n        stickyTopOffset: 0 // number\n    },\n    buttons: {\n        editor: ['add', 'template', 'mobile', 'html'],\n        topbar: ['undo', 'redo', 'shortcut'],\n        toolbar: false,\n        tags: {\n            'b': ['bold'],\n            'strong': ['bold'],\n            'i': ['italic'],\n            'em': ['italic'],\n            'del': ['deleted'],\n            'u': ['underline'],\n            'a': ['link']\n        },\n        types: false,\n        icons: false,\n        hidden: {}\n    },\n    card: {\n        classname: 'card',\n        template: '<div class=\"card\"><div class=\"card-head\"><h3>Card title</h3></div><div class=\"card-body\"><p>Card body</p></div></div>'\n    },\n    text: {\n        classname: 'arx-text'\n    },\n    noneditable: {\n        classname: 'noneditable'\n    },\n    embed: {\n        responsive: 'embed-responsive',\n        script: true,\n        checkbox: false\n    },\n    code: {\n        template: '<pre></pre>',\n        spaces: 4 // or false\n    },\n    line: true,\n    layer: {\n        template: '<div></div>'\n    },\n    table: {\n        template: '<table><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>'\n    },\n    quote: {\n        template: '<blockquote><p>Quote...</p><p><cite>Author Attribution</cite></p></blockquote>'\n    },\n    snippets: false,\n    templates: false,\n    grid: {\n        classname: 'grid',\n        classes: '',\n        overlay: true,\n        offset: {\n            left: 0,\n            right: 0\n        },\n        columns: 12,\n        gutter: '1.25rem',\n        patterns:  {\n            '6|6': 'column column-6|column column-6',\n            '4|4|4': 'column column-4|column column-4|column column-4',\n            '3|3|3|3': 'column column-3|column column-3|column column-3|column column-3',\n            '2|2|2|2|2|2': 'column column-2|column column-2|column column-2|column column-2|column column-2|column column-2',\n            '3|6|3': 'column column-3|column column-6|column column-3',\n            '2|8|2': 'column column-2|column column-8|column column-2',\n            '5|7': 'column column-5|column column-7',\n            '7|5': 'column column-7|column column-5',\n            '4|8': 'column column-4|column column-8',\n            '8|4': 'column column-8|column column-4',\n            '3|9': 'column column-3|column column-9',\n            '9|3': 'column column-9|column column-3',\n            '2|10': 'column column-2|column column-10',\n            '10|2': 'column column-10|column column-2',\n            '12': 'column column-12'\n        }\n    },\n    link: {\n        size: 30,\n        nofollow: false,\n        target: false\n    },\n    addbar: ['paragraph', 'image', 'embed', 'line', 'table', 'snippet', 'quote', 'code', 'grid', 'layer'], // text, card\n    addbarAdd: [],\n    addbarHide: [],\n    format: ['p', 'h1', 'h2', 'h3', 'ul', 'ol'], // h4, h5, h6,  dl, address, div (text)\n    formatAdd: false,\n    outset: {\n        none: 'none',\n        left: 'outset-left',\n        both: 'outset-both',\n        right: 'outset-right'\n    },\n    align: {\n        left: 'align-left',\n        center: 'align-center',\n        right: 'align-right',\n        justify: 'align-justify'\n    },\n    valign: {\n        none: 'none',\n        top: 'valign-top',\n        middle: 'valign-middle',\n        bottom: 'valign-bottom'\n    },\n    shortcutsRemove: false,\n    shortcutsBase: {\n        'meta+z': '## shortcuts.meta-z ##',\n        'meta+shift+z': '## shortcuts.meta-shift-z ##',\n        'meta+a': '## shortcuts.meta-a ##',\n        'meta+shift+a': '## shortcuts.meta-shift-a ##',\n        'meta+click': '## shortcuts.meta-click ##'\n    },\n    shortcuts: {\n        'ctrl+shift+d, meta+shift+d': {\n            title: '## shortcuts.meta-shift-d ##',\n            name: 'meta+shift+d',\n            command: 'block.duplicate'\n        },\n        'ctrl+shift+up, meta+shift+up': {\n            title: '## shortcuts.meta-shift-up ##',\n            name: 'meta+shift+&uarr;',\n            command: 'block.moveUp'\n        },\n        'ctrl+shift+down, meta+shift+down': {\n            title: '## shortcuts.meta-shift-down ##',\n            name: 'meta+shift+&darr;',\n            command: 'block.moveDown'\n        },\n        'ctrl+shift+m, meta+shift+m': {\n            title: '## shortcuts.meta-shift-m ##',\n            name: 'meta+shift+m',\n            command: 'inline.removeFormat'\n        },\n        'ctrl+b, meta+b': {\n            title: '## shortcuts.meta-b ##',\n            name: 'meta+b',\n            command: 'inline.set',\n            params: { tag: 'b' }\n        },\n        'ctrl+i, meta+i': {\n            title: '## shortcuts.meta-i ##',\n            name: 'meta+i',\n            command: 'inline.set',\n            params: { tag: 'i' }\n        },\n        'ctrl+u, meta+u': {\n            title: '## shortcuts.meta-u ##',\n            name: 'meta+u',\n            command: 'inline.set',\n            params: { tag: 'u' }\n        },\n        'ctrl+h, meta+h': {\n            title: '## shortcuts.meta-h ##',\n            name: 'meta+h',\n            command: 'inline.set',\n            params: { tag: 'sup' }\n        },\n        'ctrl+l, meta+l': {\n            title: '## shortcuts.meta-l ##',\n            name: 'meta+l',\n            command: 'inline.set',\n            params: { tag: 'sub' }\n        },\n        'ctrl+alt+0, meta+alt+0': {\n            title: '## shortcuts.meta-alt-0 ##',\n            name: 'meta+alt+0',\n            command: 'block.format',\n            params: { tag: 'p' }\n        },\n        'ctrl+alt+1, meta+alt+1': {\n            title: '## shortcuts.meta-alt-1 ##',\n            name: 'meta+alt+1',\n            command: 'block.format',\n            params: { tag: 'h1' }\n        },\n        'ctrl+alt+2, meta+alt+2': {\n            title: '## shortcuts.meta-alt-2 ##',\n            name: 'meta+alt+2',\n            command: 'block.format',\n            params: { tag: 'h2' }\n        },\n        'ctrl+alt+3, meta+alt+3': {\n            title: '## shortcuts.meta-alt-3 ##',\n            name: 'meta+alt+3',\n            command: 'block.format',\n            params: { tag: 'h3' }\n        },\n        'ctrl+alt+4, meta+alt+4': {\n            title: '## shortcuts.meta-alt-4 ##',\n            name: 'meta+alt+4',\n            command: 'block.format',\n            params: { tag: 'h4' }\n        },\n        'ctrl+alt+5, meta+alt+5': {\n            title: '## shortcuts.meta-alt-5 ##',\n            name: 'meta+alt+5',\n            command: 'block.format',\n            params: { tag: 'h5' }\n        },\n        'ctrl+alt+6, meta+alt+6': {\n            title: '## shortcuts.meta-alt-6 ##',\n            name: 'meta+alt+6',\n            command: 'block.format',\n            params: { tag: 'h6' }\n        },\n        'ctrl+shift+7, meta+shift+7': {\n            title: '## shortcuts.meta-shift-7 ##',\n            name: 'meta+shift+7',\n            command: 'block.format',\n            params: { tag: 'ol'}\n        },\n        'ctrl+shift+8, meta+shift+8': {\n            title: '## shortcuts.meta-shift-8 ##',\n            name: 'meta+shift+8',\n            command: 'block.format',\n            params: { tag: 'ul' }\n        },\n        'ctrl+], meta+]': {\n            title: '## shortcuts.meta-indent ##',\n            name: 'meta+]',\n            command: 'list.indent'\n        },\n        'ctrl+[, meta+[': {\n            title: '## shortcuts.meta-outdent ##',\n            name: 'meta+[',\n            command: 'list.outdent'\n        },\n        'ctrl+k, meta+k': {\n            title: '## shortcuts.meta-k ##',\n            name: 'meta+k',\n            command: 'link.format'\n        }\n    },\n\n    // private\n    disableMode: false,\n    markerChar: '\\ufeff',\n    containers: {\n        main: ['bars', 'editor', 'source', 'statusbar'],\n        bars: ['pathbar', 'toolbar']\n    },\n    tags: {\n        denied: ['font', 'html', 'head', 'link', 'title', 'body', 'meta', 'applet', 'marquee'],\n        incode: ['!DOCTYPE', '!doctype', 'html', 'head', 'link', 'title', 'body', 'meta', 'textarea', 'style'],\n        form: ['form', 'input', 'button', 'select', 'textarea', 'legend', 'fieldset'],\n        inline: ['a', 'svg', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'abbr'],\n        block: ['pre', 'hr', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'table', 'tbody', 'thead', 'tfoot', 'tr', 'th', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'main', 'section', 'header', 'footer', 'aside', 'article', 'iframe', 'audio', 'source'],\n        parser: ['pre', 'hr', 'ul', 'ol', 'dl', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'div', 'table', 'address', 'blockquote', 'figure', 'main', 'section', 'header', 'footer', 'aside', 'article', 'iframe']\n    },\n    bsmodal: false,\n    regex: {\n        youtube: /^https?\\:\\/\\/(?:www\\.youtube(?:\\-nocookie)?\\.com\\/|m\\.youtube\\.com\\/|youtube\\.com\\/)?(?:ytscreeningroom\\?vi?=|youtu\\.be\\/|vi?\\/|user\\/.+\\/u\\/\\w{1,2}\\/|embed\\/|watch\\?(?:.*\\&)?vi?=|\\&vi?=|\\?(?:.*\\&)?vi?=)([^#\\&\\?\\n\\/<>\"']*)/gi,\n        vimeo: /(http|https)?:\\/\\/(?:www.|player.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^\\/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:\\/[a-zA-Z0-9_-]+)?/gi,\n        imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n        url: /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z\\u00F0-\\u02AF0-9()!@:%_+.~#?&//=]*)/gi,\n        aurl1: /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim,\n        aurl2: /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim\n    },\n    addbarExtend: {},\n    buttonsObj: {\n        'undo': { title: '## buttons.undo ##', command: 'state.undo' },\n        'redo': { title: '## buttons.redo ##', command: 'state.redo' },\n        'shortcut': { title: '## buttons.shortcuts ##', observer: 'shortcut.observe', command: 'shortcut.popup' },\n        'template': { title: '## buttons.templates ##', command: 'template.popup', observer: 'template.observe' },\n        'mobile': { title: '## buttons.mobile-view ##', command: 'editor.toggleView' },\n        'html': { title: '## buttons.html ##',  command: 'source.toggle' },\n        'paragraph': { title: '## blocks.paragraph ##', command: 'block.add' },\n        'image': { title: '## blocks.image ##', command: 'image.popup', observer: 'image.observe' },\n        'embed': { title: '## blocks.embed ##', command: 'embed.popup', observer: 'embed.observe' },\n        'line': { title: '## blocks.line ##', command: 'block.add', observer: 'block.observe' },\n        'table': { title: '## blocks.table ##', command: 'table.add', observer: 'table.observe' },\n        'snippet': { title: '## blocks.snippet ##', command: 'snippet.popup', observer: 'snippet.observe' },\n        'quote': { title: '## blocks.quote ##', command: 'block.add', observer: 'block.observe' },\n        'text': { title: '## blocks.text ##', command: 'block.add' },\n        'code': { title: '## blocks.code ##', command: 'block.add', observer: 'block.observe' },\n        'grid': { title: '## blocks.grid ##', command: 'grid.popup', observer: 'grid.observe' },\n        'layer': { title: '## blocks.layer ##', command: 'block.add', observer: 'block.observe' },\n        'card': { title: '## blocks.card ##', command: 'block.add' },\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' }\n    },\n    nested: [],\n    parser: {},\n    parserTags: [],\n    formatObj: {\n        p: {\n            title: '## blocks.paragraph ##',\n            type: 'paragraph',\n            shortcut: 'Ctrl+Alt+0'\n        },\n        div: {\n            title: '## blocks.text ##',\n            type: 'text'\n        },\n        h1: {\n            title: '<span style=\"font-size: 20px; font-weight: bold;\">## headings.h1 ##</span>',\n            type: 'heading',\n            shortcut: 'Ctrl+Alt+1'\n        },\n        h2: {\n            title: '<span style=\"font-size: 16px; font-weight: bold;\">## headings.h2 ##</span>',\n            type: 'heading',\n            shortcut: 'Ctrl+Alt+2'\n        },\n        h3: {\n            title: '<span style=\"font-weight: bold;\">## headings.h3 ##</span>',\n            type: 'heading',\n            shortcut: 'Ctrl+Alt+3'\n        },\n        h4: {\n            title: '<span style=\"font-weight: bold;\">## headings.h4 ##</span>',\n            type: 'heading',\n            shortcut: 'Ctrl+Alt+4'\n        },\n        h5: {\n            title: '<span style=\"font-weight: bold;\">## headings.h5 ##</span>',\n            type: 'heading',\n            shortcut: 'Ctrl+Alt+5'\n        },\n        h6: {\n            title: '<span style=\"font-weight: bold;\">## headings.h6 ##</span>',\n            type: 'heading',\n            shortcut: 'Ctrl+Alt+6'\n        },\n        ol: {\n            title: '1. ## list.ordered-list ##',\n            type: 'list',\n            shortcut: 'Ctrl+Shift+7'\n        },\n        ul: {\n            title: '&bull; ## list.unordered-list ##',\n            type: 'list',\n            shortcut: 'Ctrl+Shift+8'\n        },\n        dl: {\n            title: '## blocks.dlist ##',\n            type: 'dlist'\n        },\n        address: {\n            title: '<em>## blocks.address ##</em>',\n            type: 'address'\n        }\n    }\n};\nArticleEditor.lang.en = {\n    \"accessibility\": {\n        \"help-label\": \"Rich text editor\"\n    },\n    \"editor\": {\n        \"title\": \"Article\",\n        \"multiple\": \"Multiple\",\n    },\n    \"placeholders\": {\n        \"figcaption\": \"Type caption (optional)\",\n        \"text\": \"Type something...\",\n        \"code\": \"Edit to add code...\",\n        \"layer\": \"Press enter to add a new text...\"\n    },\n    \"popup\": {\n        \"link\": \"Link\",\n        \"add\": \"Add\",\n        \"grid\": \"Grid\",\n        \"back\": \"Back\",\n        \"image\": \"Image\",\n        \"snippets\": \"Snippets\",\n        \"add-image\": \"Add Image\"\n    },\n    \"shortcuts\": {\n        \"meta-a\": \"Select text in the block\",\n        \"meta-shift-a\": \"Select all blocks\",\n        \"meta-click\": \"Select multiple blocks\",\n        \"meta-z\": \"Undo\",\n        \"meta-shift-z\": \"Redo\",\n        \"meta-shift-m\": \"Remove inline format\",\n        \"meta-b\": \"Bold\",\n        \"meta-i\": \"Italic\",\n        \"meta-u\": \"Underline\",\n        \"meta-h\": \"Superscript\",\n        \"meta-l\": \"Subscript\",\n        \"meta-k\": \"Link\",\n        \"meta-alt-0\": \"Normal text\",\n        \"meta-alt-1\": \"Heading 1\",\n        \"meta-alt-2\": \"Heading 2\",\n        \"meta-alt-3\": \"Heading 3\",\n        \"meta-alt-4\": \"Heading 4\",\n        \"meta-alt-5\": \"Heading 5\",\n        \"meta-alt-6\": \"Heading 6\",\n        \"meta-shift-7\": \"Ordered List\",\n        \"meta-shift-8\": \"Unordered List\",\n        \"meta-indent\": \"Indent\",\n        \"meta-outdent\": \"Outdent\",\n        \"meta-shift-backspace\": \"Delete block\",\n        \"meta-shift-d\": \"Duplicate block\",\n        \"meta-shift-up\": \"Move line up\",\n        \"meta-shift-down\": \"Move line down\"\n    },\n    \"headings\": {\n        \"h1\": \"Heading 1\",\n        \"h2\": \"Heading 2\",\n        \"h3\": \"Heading 3\",\n        \"h4\": \"Heading 4\",\n        \"h5\": \"Heading 5\",\n        \"h6\": \"Heading 6\"\n    },\n    \"inline\": {\n        \"bold\": \"Bold\",\n        \"italic\": \"Italic\",\n        \"deleted\": \"Deleted\"\n    },\n    \"list\": {\n        \"unordered-list\": \"Unordered List\",\n        \"ordered-list\": \"Ordered List\",\n        \"indent\": \"Indent\",\n        \"outdent\": \"Outdent\"\n    },\n    \"link\": {\n        \"link\": \"Link\",\n        \"edit-link\": \"Edit link\",\n        \"unlink\": \"Unlink\",\n        \"link-in-new-tab\": \"Open link in new tab\",\n        \"save\": \"Save\",\n        \"insert\": \"Insert\",\n        \"cancel\": \"Cancel\",\n        \"text\": \"Text\",\n        \"url\": \"URL\"\n    },\n    \"table\": {\n        \"width\": \"Width\",\n        \"nowrap\": \"Nowrap\",\n        \"save\": \"Save\",\n        \"cancel\": \"Cancel\",\n        \"table-cell\": \"Table Cell\",\n        \"add-head\": \"Add head\",\n        \"remove-head\": \"Remove head\",\n        \"add-row-below\": \"Add row below\",\n        \"add-row-above\": \"Add row above\",\n        \"remove-row\": \"Remove row\",\n        \"add-column-after\": \"Add column after\",\n        \"add-column-before\": \"Add column before\",\n        \"remove-column\": \"Remove column\"\n    },\n    \"image\": {\n        \"or\": \"or\",\n        \"alt-text\": \"Alt Text\",\n        \"save\": \"Save\",\n        \"link\": \"Link\",\n        \"width\": \"Width\",\n        \"delete\": \"Delete\",\n        \"cancel\": \"Cancel\",\n        \"insert\": \"Insert\",\n        \"caption\": \"Caption\",\n        \"link-in-new-tab\": \"Open link in new tab\",\n        \"url-placeholder\": \"Paste url of image...\",\n        \"upload-new-placeholder\": \"Drag to upload a new image<br>or click to select\"\n    },\n    \"code\": {\n        \"code\": \"Code\",\n        \"insert\": \"Insert\",\n        \"save\": \"Save\",\n        \"cancel\": \"Cancel\"\n    },\n    \"embed\": {\n        \"embed\": \"Embed\",\n        \"caption\": \"Caption\",\n        \"insert\": \"Insert\",\n        \"save\": \"Save\",\n        \"cancel\": \"Cancel\",\n        \"description\": \"Paste any embed/html code or enter the url (vimeo or youtube video only)\",\n        \"responsive-video\": \"Responsive video\"\n    },\n    \"upload\": {\n        \"placeholder\": \"Drag to upload <br>or click to select\"\n    },\n    \"templates\": {\n        \"templates\": \"Templates\"\n    },\n    \"snippets\": {\n        \"snippets\": \"Snippets\"\n    },\n    \"form\": {\n        \"link\": \"Link\",\n        \"url\": \"Url\",\n        \"text\": \"Text\",\n        \"name\": \"Name\",\n        \"alt-text\": \"Alt Text\",\n        \"image\": \"Image\",\n        \"upload\": \"Upload\",\n        \"alignment\": \"Alignment\",\n        \"outset\": \"Outset\",\n        \"valign\": \"Valign\"\n    },\n    \"buttons\": {\n        \"mobile-view\": \"Mobile View\",\n        \"cancel\": \"Cancel\",\n        \"insert\": \"Insert\",\n        \"unlink\": \"Unlink\",\n        \"save\": \"Save\",\n        \"add\": \"Add\",\n        \"transform-to-text\": \"Transform to text\",\n        \"align\": \"Alignment\",\n        \"valign\": \"Valign\",\n        \"outset\": \"Outset\",\n        \"indent\": \"Indent\",\n        \"outdent\": \"Outdent\",\n        \"head\": \"Head\",\n        \"row\": \"Row\",\n        \"cell\": \"Cell\",\n        \"html\": \"HTML\",\n        \"templates\": \"Templates\",\n        \"shortcuts\": \"Keyboard Shortcuts\",\n        \"format\": \"Format\",\n        \"bold\": \"Bold\",\n        \"italic\": \"Italic\",\n        \"deleted\": \"Deleted\",\n        \"underline\": \"Underline\",\n        \"table\": \"Table\",\n        \"link\": \"Link\",\n        \"undo\": \"Undo\",\n        \"redo\": \"Redo\",\n        \"style\": \"Style\",\n        \"config\": \"Config\",\n        \"settings\": \"Settings\",\n        \"text\": \"Text\",\n        \"embed\": \"Embed\",\n        \"grid\": \"Grid\",\n        \"image\": \"Image\",\n        \"list\": \"List\",\n        \"delete\": \"Delete\",\n        \"duplicate\": \"Duplicate\",\n        \"sort\": \"Sort\",\n        \"edit\": \"Edit\",\n        \"inline\": \"Inline\"\n    },\n    \"blocks\": {\n        \"noneditable\": \"Noneditable\",\n        \"paragraph\": \"Paragraph\",\n        \"heading\": \"Heading\",\n        \"image\": \"Image\",\n        \"figcaption\": \"Figcaption\",\n        \"embed\": \"Embed\",\n        \"line\": \"Line\",\n        \"code\": \"Code\",\n        \"quote\": \"Quote\",\n        \"quoteitem\": \"Paragraph\",\n        \"snippet\": \"Snippet\",\n        \"column\": \"Column\",\n        \"grid\": \"Grid\",\n        \"list\": \"List\",\n        \"table\": \"Table\",\n        \"layer\": \"Layer\",\n        \"row\": \"Row\",\n        \"text\": \"Text\",\n        \"cell\": \"Cell\",\n        \"dlist\": \"Definition List\",\n        \"address\": \"Address\",\n        \"form\": \"Form\",\n        \"card\": \"Card\"\n    }\n};\nvar App = function($element, settings, uuid) {\n    // environment\n    var maps = ['keycodes', 'prefix', 'dom', 'ajax', '_repository', '_subscribe'];\n    for (var i = 0; i < maps.length; i++) {\n        this[maps[i]] = $ARX[maps[i]];\n    }\n\n    this.uuid = uuid;\n    this.$win = this.dom(window);\n    this.$doc = this.dom(document);\n    this.$body = this.dom('body');\n    this.$element = $element;\n    this.app = this;\n\n    // initial\n    this.initialSettings = settings;\n\n    // starter\n    this._initer = ['setting', 'lang'];\n    this._priority = ['container', 'editor', 'accessibility', 'state'];\n    this._plugins = [];\n\n    // started\n    this.started = false;\n\n    // start\n    this.start();\n};\n\nApp.prototype = {\n    // start\n    start: function(settings) {\n        if (!this.isTextarea()) return;\n        if (this.isStarted()) return;\n        if (settings) this.initialSettings = settings;\n\n        // core\n        this._initCore();\n        this._plugins = this.setting.get('plugins');\n\n        // starting\n        this.broadcast('app.before.start');\n\n        // init\n        this._initModules();\n        this._initPlugins();\n\n        // start\n        this._startPriority();\n        this._startModules();\n        this._startPlugins();\n\n        this.started = true;\n\n        // started\n        this.broadcast('app.start');\n\n        // call load methods\n        this._loadModulesAndPlugins();\n\n        // disable mode\n        if (this.opts.disableMode !== false) {\n            this.disable();\n        }\n    },\n    isStarted: function() {\n        return this.started;\n    },\n    isTextarea: function() {\n        return (this.$element.get().tagName === 'TEXTAREA');\n    },\n\n    // stop\n    stop: function() {\n        if (this.isStopped()) return;\n\n        // stopping\n        this.broadcast('app.before.stop');\n\n        this._stopPlugins();\n        this._stopPriority();\n        this._stopModules();\n\n        this.started = false;\n\n        // stopped\n        this.broadcast('app.stop');\n    },\n    isStopped: function() {\n        return !this.started;\n    },\n\n    // destroy\n    destroy: function() {\n        clearTimeout(this.app.sync.typingTimer);\n        this.stop();\n        this.broadcast('app.destroy');\n        this.$element.dataset($ARX.namespace, false);\n\n        var index = $ARX.instances.indexOf(this.uuid);\n        if (index > -1) {\n            $ARX.instances.splice(index, 1);\n        }\n    },\n\n    // disable / enable\n    disable: function() {\n        this.block.unset();\n        this.blocks.unset();\n        this.selection.removeAllRanges();\n\n        if (this.source.is()) {\n            this.source.close();\n        }\n\n        this.popup.close(false);\n\n        this.toolbar.disableSticky();\n        this.toolbar.disable();\n        this.path.disable();\n        this.topbar.disable();\n\n        this.editor.getOverlay().addClass(this.prefix + '-editor-disabled');\n        this.opts.disableMode = true;\n    },\n    enable: function() {\n        this.toolbar.enableSticky();\n        this.toolbar.enable();\n        this.path.enable();\n        this.topbar.enable();\n\n        this.editor.getOverlay().removeClass(this.prefix + '-editor-disabled');\n        this.opts.disableMode = false;\n    },\n\n    // broadcast\n    broadcast: function(name, params) {\n        var event = (params instanceof App.Event) ? params : new App.Event(name, params);\n        if (typeof this._subscribe[name] !== 'undefined') {\n            var events = this._subscribe[name];\n            for (var i = 0; i < events.length; i++) {\n                var instance = this[events[i].module];\n                if (instance) {\n                    events[i].func.call(instance, event);\n                }\n            }\n        }\n\n        // callbacks\n        var callbacks = (this.setting.has('subscribe')) ? this.setting.get('subscribe') : {};\n        if (typeof callbacks[name] === 'function') {\n            callbacks[name].call(this, event);\n        }\n\n        return event;\n    },\n    broadcastParams: function(name, params) {\n        var event = this.broadcast(name, params);\n        return event.getAll();\n    },\n    broadcastHtml: function(name, html) {\n        var event = this.broadcast(name, { html: html });\n        return event.get('html');\n    },\n\n    // create\n    create: function(name) {\n        if (typeof this._repository[name] === 'undefined') {\n            $ARX.error('The class \"' + name + '\" does not exist.');\n        }\n\n        var args = [].slice.call(arguments, 1);\n        var instance = new this._repository[name].proto();\n\n        // extend\n        instance._name = name;\n        instance.app = this;\n\n        var maps = ['uuid', 'prefix', 'dom', 'ajax'];\n        for (var i = 0; i < maps.length; i++) {\n           instance[maps[i]] = this[maps[i]];\n        }\n\n        // lang & settings\n        if (this.lang) instance.lang = this.lang;\n        if (this.opts) instance.opts = this.opts;\n\n        // init\n        var result;\n        if (instance.init) {\n            result = instance.init.apply(instance, args);\n        }\n\n        return (result) ? result : instance;\n    },\n\n    // api\n    api: function(name) {\n        var args = [].slice.call(arguments, 1);\n        var namespaces = name.split(\".\");\n        var func = namespaces.pop();\n        var context = this;\n        for (var i = 0; i < namespaces.length; i++) {\n            context = context[namespaces[i]];\n        }\n\n        if (context && typeof context[func] === 'function') {\n            return context[func].apply(context, args);\n        }\n    },\n\n    // init\n    _initCore: function() {\n        for (var i = 0; i < this._initer.length; i++) {\n            this[this._initer[i]] = this.create(this._initer[i]);\n        }\n\n        // opts\n        if (this.setting) {\n            this.opts = this.setting.dump();\n        }\n    },\n    _initModules: function() {\n        for (var key in this._repository) {\n            if (this._repository[key].type === 'module' && this._initer.indexOf(key) === -1) {\n                this[key] = this.create(key);\n            }\n        }\n    },\n    _initPlugins: function() {\n        var plugins = this.setting.get('plugins');\n        for (var key in this._repository) {\n            if (this._repository[key].type === 'plugin' && plugins.indexOf(key) !== -1) {\n                this[key] = this.create(key);\n            }\n        }\n    },\n\n    // start\n    _startPriority: function() {\n        for (var i = 0; i < this._priority.length; i++) {\n            this._call(this[this._priority[i]], 'start');\n        }\n    },\n    _startModules: function() {\n        this._iterate('module', 'start');\n    },\n    _startPlugins: function() {\n        this._iterate('plugin', 'start');\n    },\n\n    // stop\n    _stopPriority: function() {\n        var priority = this._priority.slice().reverse();\n        for (var i = 0; i < priority.length; i++) {\n            this._call(this[priority[i]], 'stop');\n        }\n    },\n    _stopModules: function() {\n        this._iterate('module', 'stop');\n    },\n    _stopPlugins: function() {\n        this._iterate('plugin', 'stop');\n    },\n\n    // load\n    _loadModulesAndPlugins: function() {\n        this._iterate('module', 'load');\n        this._iterate('plugin', 'load');\n    },\n\n    // iterate\n    _iterate: function(type, method) {\n        for (var key in this._repository) {\n            if (this._repository.hasOwnProperty(key)) {\n                var isIn = (type === 'module') ? (method === 'load' || this._priority.indexOf(key) === -1) : (this._plugins.indexOf(key) !== -1);\n                if (this._repository[key].type === type && isIn) {\n                    this._call(this[key], method);\n                }\n            }\n        }\n    },\n\n    // call\n    _call: function(instance, method) {\n        if (typeof instance[method] === 'function') {\n            instance[method].apply(instance);\n        }\n    }\n};\nApp.Event = function(name, params) {\n    // local\n    this.name = name;\n    this.params = (typeof params === 'undefined') ? {} : params;\n    this.stopped = false;\n};\n\nApp.Event.prototype = {\n    is: function(name) {\n        if (Array.isArray(name)) {\n            for (var i = 0; i < name.length; i++) {\n                if (this.params[name[i]]) {\n                    return true;\n                }\n            }\n        }\n        else {\n            return this.get(name);\n        }\n    },\n    has: function(name) {\n        return (typeof this.params[name] !== 'undefined');\n    },\n    getAll: function() {\n        return this.params;\n    },\n    get: function(name) {\n        return this.params[name];\n    },\n    set: function(name, value) {\n        this.params[name] = value;\n    },\n    stop: function() {\n        this.stopped = true;\n    },\n    isStopped: function() {\n        return this.stopped;\n    }\n};\nArticleEditor.add('mixin', 'block', {\n    defaults: {\n        id: { getter: 'getId', setter: 'setId' },\n        html: { getter: 'getHtml', setter: 'setHtml' },\n        align: { getter: 'getAlign', setter: 'setAlign' },\n        valign: { getter: 'getValign', setter: 'setValign' },\n        outset: { getter: 'getOutset', setter: 'setOutset' },\n    },\n    init: function(source, params) {\n\n        this.$block = (source) ? this.dom(source) : this.create(params);\n\n        // build & render\n        this._build(params);\n        this._buildData();\n        this._render();\n    },\n\n    // is\n    isType: function(type) {\n        var types = (Array.isArray(type)) ? type : [type];\n        return (types.indexOf(this.type) !== -1);\n    },\n    isBlock: function() {\n        return true;\n    },\n    isAllowedButton: function(name, obj) {\n        // type\n        var type = this.getType();\n\n        // hidden\n        if (typeof this.opts.buttons.hidden[type] !== 'undefined') {\n            var val = this.opts.buttons.hidden[type];\n            if (Array.isArray(val) && val.indexOf(name) !== -1) {\n                return false;\n            }\n        }\n\n        // all\n        if (typeof obj.blocks === 'undefined') {\n            return true;\n        }\n\n        var blocks = obj.blocks;\n\n        // except\n        if (blocks.except && blocks.except.indexOf(type) !== -1) {\n            return false;\n        }\n\n        // array of elements\n        if ((Array.isArray(blocks.types) && blocks.types.indexOf(type) !== -1)) {\n            return true;\n        }\n\n        if (blocks.all) {\n            // editable\n            if (blocks.all === true || blocks.all === 'all') {\n                return true;\n            }\n            else if (blocks.all === 'editable' && this.isEditable()) {\n                return true;\n            }\n            else if (blocks.all === 'first-level' && this.isFirstLevel()) {\n                return true;\n            }\n            else if (blocks.all === 'noneditable' && !this.isEditable()) {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    isFirstLevel: function() {\n        return this.$block.attr('data-' + this.prefix + '-first-level');\n    },\n    isSecondLevel: function() {\n        return (['quoteitem', 'row', 'cell'].indexOf(this.type) !== -1);\n    },\n    isEditable: function() {\n        return (typeof this.editable !== 'undefined' && this.editable === true);\n    },\n    isInlineBlock: function() {\n        return (typeof this.inline !== 'undefined');\n    },\n    isAllSelected: function() {\n        if (this.isEditable()) {\n            return this.app.selection.isAll(this.$block);\n        }\n        else {\n            return true;\n        }\n    },\n    isEmpty: function() {\n        if (this.isEmptiable()) {\n            if (this.$block.hasClass(this.prefix + '-empty-layer')) {\n                return true;\n            }\n            else {\n                var html = this.$block.html();\n                html = html.trim();\n                html = this._cleanEmpty(html);\n\n                return (html === '');\n            }\n        }\n        else if (this.isEditable()) {\n            return this._isEmpty();\n        }\n    },\n    isEmptiable: function() {\n        return (typeof this.emptiable !== 'undefined');\n    },\n    isCaretStart: function() {\n        if (this.getType() === 'code') {\n            return this.app.caret.is(this.$block, 'start', false, false);\n        }\n        else if (this.getType() === 'list') {\n            // check if the item is the first\n            var current = this.app.selection.getCurrent();\n            var $item = this.dom(current).closest('li');\n            var $prev = $item.prev();\n            if ($prev.length === 0) {\n                return this.app.caret.is(this.$block, 'start');\n            }\n            else {\n                return false;\n            }\n        }\n        else if (this.isEditable()) {\n            return this.app.caret.is(this.$block, 'start');\n        }\n\n        return true;\n    },\n    isCaretEnd: function() {\n        if (this.getType() === 'code') {\n            return this.app.caret.is(this.$block, 'end', false, false);\n        }\n        else if (this.getType() === 'address') {\n            return this.app.caret.is(this.$block, 'end', false, true, false);\n        }\n        else if (this.isEditable()) {\n            return this.app.caret.is(this.$block, 'end');\n        }\n\n        return true;\n    },\n\n    // get\n    getData: function(name) {\n        var data = {};\n        Object.keys(this.data).forEach(function(key) {\n            data[key] = this[this.data[key].getter].apply(this);\n        }.bind(this));\n\n        return (name) ? data[name] : data;\n    },\n    getType: function() {\n        return this.type;\n    },\n    getTag: function() {\n        return (this.$block) ? this.$block.get().tagName.toLowerCase() : false;\n    },\n    getTitle: function() {\n        var type = this.getType();\n        var titles = this.lang.get('blocks');\n        var title = this.$block.attr('data-title');\n\n        return (typeof titles[type] !== 'undefined') ? titles[type] : title;\n    },\n    getOffset: function() {\n        var offset = this.app.editor.getFrame().offset();\n        var elOffset = this.$block.offset();\n\n        return { top: offset.top + elOffset.top, left: offset.left + elOffset.left };\n    },\n    getBlock: function() {\n        return this.$block;\n    },\n    getHtml: function() {\n        return this.$block.html();\n    },\n    getPlainText: function() {\n        var html = this.$block.html();\n\n        return this.app.content.getTextFromHtml(html, { nl: true });\n    },\n    getOuterHtml: function() {\n        return this.$block.get().outerHTML;\n    },\n    getParent: function(type) {\n        type = (type) ? '=' + type : '';\n\n        var $el = this.$block.parent().closest('[data-' + this.prefix + '-type' + type + ']');\n        if ($el.length !== 0) {\n            return $el.dataget('instance');\n        }\n\n        return false;\n    },\n    getNext: function(type) {\n        type = (type) ? '=' + type : '';\n\n        var $el = this.$block.nextElement();\n        if ($el.length !== 0 && $el.is('[data-' + this.prefix + '-type' + type + ']')) {\n            return $el.dataget('instance');\n        }\n\n        return false;\n    },\n    getPrev: function(type) {\n        type = (type) ? '=' + type : '';\n\n        var $el = this.$block.prevElement();\n        if ($el.length !== 0 && $el.is('[data-' + this.prefix + '-type' + type + ']')) {\n            return $el.dataget('instance');\n        }\n\n        return false;\n    },\n    getChildFirst: function(type) {\n        type = (type) ? '=' + type : '';\n\n        var $el = this.$block.find('[data-' + this.prefix + '-type' + type + ']').first();\n        if ($el.length !== 0) {\n            return $el.dataget('instance');\n        }\n\n        return false;\n    },\n    getChildLast: function(type) {\n        type = (type) ? '=' + type : '';\n\n        var $el = this.$block.find('[data-' + this.prefix + '-type' + type + ']').last();\n        if ($el.length !== 0) {\n            return $el.dataget('instance');\n        }\n\n        return false;\n    },\n    getId: function() {\n        return this.$block.attr('id');\n    },\n    getAlign: function() {\n        var obj = this.opts.align;\n        if (!obj) return false;\n\n        var value = 'left';\n        for (var key in obj) {\n            if (this.$block.hasClass(obj[key])) {\n                value = key;\n            }\n        }\n\n        return value;\n    },\n    getValign: function() {\n        var obj = this.opts.valign;\n        if (!obj) return false;\n\n        var value = 'none';\n        for (var key in obj) {\n            if (this.$block.hasClass(obj[key])) {\n                value = key;\n            }\n        }\n\n        return value;\n    },\n    getOutset: function() {\n        var obj = this.opts.outset;\n        if (!obj) return false;\n\n        var value = 'none';\n        for (var key in obj) {\n            if (this.$block.hasClass(obj[key])) {\n                value = key;\n            }\n        }\n\n        return value;\n    },\n    getCaption: function() {\n        var $caption = this.$block.find('figcaption');\n\n        return ($caption.length !== 0) ? $caption.html().trim() : '';\n    },\n\n    // set\n    setData: function(data) {\n        for (var key in data) {\n            if (!this.data[key]) continue;\n            this[this.data[key].setter].call(this, data[key]);\n        }\n    },\n    setEmpty: function() {\n        this.$block.html('');\n\n        if (this.isEmptiable()) {\n            this._addEmptyButton(this.$block);\n        }\n    },\n    setSelectAll: function() {\n        if (this.isEditable()) {\n            this.app.selection.select(this.$block);\n        }\n    },\n    setHtml: function(html) {\n        this.$block.html(html);\n\n        if (html !== '') {\n            this._buildInstancesInside(this.$block);\n        }\n    },\n    setId: function(value) {\n        if (value === '') {\n            this.$block.removeAttr('id');\n        }\n        else {\n            this.$block.attr('id', value);\n        }\n    },\n    setAlign: function(value) {\n        this._removeObjClasses(this.opts.align);\n        this.$block.addClass(this.opts.align[value]);\n    },\n    setValign: function(value) {\n        this._removeObjClasses(this.opts.valign);\n\n        if (value !== 'none') {\n            this.$block.addClass(this.opts.valign[value]);\n        }\n    },\n    setOutset: function(value) {\n        this._removeObjClasses(this.opts.outset);\n\n        if (value !== 'none') {\n            this.$block.addClass(this.opts.outset[value]);\n        }\n\n        // ui\n        this.app.control.updatePosition();\n    },\n    setCaption: function(value) {\n        if (value === '') {\n            this.$block.find('figcaption').remove();\n        }\n        else {\n            var $caption = this.$block.find('figcaption');\n            if ($caption.length === 0) {\n                $caption = this.dom('<figcaption>');\n                $caption.attr('data-placeholder', this.lang.get('placeholders.figcaption'));\n                this.$block.append($caption);\n                // create\n                this.app.create('block.figcaption', $caption);\n            }\n\n            $caption.html(value);\n        }\n    },\n    setClassFromObj: function(obj, key) {\n        this._removeObjClasses(obj);\n\n        var value = obj[key];\n        if (value !== 'none' || value !== false) {\n            this.$block.addClass(value);\n        }\n    },\n\n    // has\n    hasClass: function(value) {\n        value = (typeof value === 'string') ? [value] : value;\n        for (var i = 0; i < value.length; i++) {\n            if (this.$block.hasClass(value[i])) {\n                return value[i];\n            }\n        }\n\n        return false;\n    },\n\n    // remove\n    remove: function(broadcast) {\n        var parent = this.getParent();\n        var type = this.getType();\n\n        this.$block.remove();\n\n        // emptiable\n        if (parent && parent.isEmptiable() && parent.isEmpty()) {\n            parent.setEmpty();\n        }\n\n        // broadcast\n        if (broadcast) {\n            this.app.broadcast('block.remove', { type: type, parent: parent });\n        }\n    },\n\n    // duplicate\n    duplicate: function(empty) {\n        var type = this.getType();\n        var $clone = this.$block.clone();\n        $clone.removeClass(this.prefix + '-block-focus ' + this.prefix + '-block-multiple-hover');\n\n        if (empty) {\n            $clone.html('');\n        }\n\n        return this.app.create('block.' + type, $clone);\n    },\n    duplicateEmpty: function() {\n        return this.duplicate(true);\n    },\n\n    // insert\n    insertEmpty: function(params) {\n        params = params || {};\n        params.instance = this.app.block.create();\n\n        return this.insert(params);\n    },\n    insert: function(params) {\n        var defs = {\n            instance: false,\n            position: false,\n            caret: false,\n            remove: true,\n            type: 'input'\n        };\n\n        // params\n        var p = $ARX.extend({}, defs, params);\n        var $block = p.instance.getBlock();\n\n        // delete selection\n        if (this.isEditable()) {\n            this.app.selection.deleteContents();\n        }\n\n        // list to list\n        if (p.instance.getType() === 'list' && this.getType() === 'list') {\n            if (p.type === 'duplicate') {\n                p.position = p.position || 'after';\n                this.$block[p.position]($block);\n\n                // set caret\n                if (p.caret) {\n                    this.app.block.set(p.instance, p.caret);\n                }\n            }\n            else {\n                this.app.insertion.insertListToList($block, this.$block, p.caret);\n            }\n        }\n        else {\n            // variable to variable\n            if (p.instance.isInlineBlock() && this.isInlineBlock()) {\n                this.$block.after($block);\n                this.$block.remove();\n            }\n            // like variable\n            else if (p.instance.isInlineBlock() && this.isEditable()) {\n                this.app.insertion.insertNode(p.instance.getBlock(), false, true);\n            }\n            // editable\n            else if (this.isEditable() && this.getType() !== 'card') {\n                // detect position\n                p.position = this.app.insertion.detectPosition(this.$block, p.position);\n\n                // insert\n                if (p.position === 'split') {\n                    this.app.element.split(this.$block).before($block);\n                }\n                else {\n                    this.$block[p.position]($block);\n\n                    // remove\n                    if (p.remove && this.isEmpty()) {\n                        this.$block.remove();\n                    }\n                }\n            }\n            // non editable\n            else {\n                p.position = p.position || 'after';\n                this.$block[p.position]($block);\n            }\n\n            // rebuild\n            this.app.editor.build();\n\n            // set caret\n            if (p.caret) {\n                this.app.block.set(p.instance, p.caret);\n            }\n\n            // observe\n            this.app.toolbar.observe();\n\n            // broadcast\n            this.app.broadcast('block.add', { instance: p.instance, type: p.type });\n\n            return p.instance;\n        }\n    },\n\n    // append\n    appendNext: function() {\n        var next = this.getNext();\n\n        // next empty\n        if (next.isEmpty()) {\n            next.remove();\n            return;\n        }\n        // current empty\n        else if (this.isEmpty()) {\n            this.remove();\n            this.app.block.set(next, 'start');\n            return;\n        }\n\n        // not empty\n        var html = next.getHtml();\n        var type = this.getType();\n        var nextType = next.getType();\n        var insert = true;\n        var remove = true;\n\n        // code\n        if (type === 'code' && nextType !== 'code') {\n            html = next.getPlainText();\n        }\n\n        // next type\n        if (nextType === 'dlist') {\n\n            if (type === 'dlist') {\n                // append as nodes\n                var nodes = next.getBlock().children();\n                this.$block.append(nodes);\n                insert = false;\n            }\n            else {\n                // insert with br\n                html = next.getPlainText(true);\n            }\n        }\n        else if (nextType === 'list') {\n            if (type === 'list') {\n                var $items = next.getBlock().children();\n                this.$block.append($items);\n\n                insert = false;\n                remove = true;\n            }\n            else {\n                html = this._appendListHtml(next.getBlock(), html);\n                remove = next.isEmpty();\n            }\n        }\n\n        // append\n        if (insert) {\n\n            // set caret after inline\n            var inline = this.app.selection.getTopInline();\n            if (inline) {\n                this.app.caret.set(inline, 'after');\n            }\n\n            // insert\n            this.app.insertion.insertHtml(html, 'start');\n            this._buildInstancesInside(this.$block);\n        }\n\n        // remove\n        if (remove) {\n            next.remove();\n        }\n\n    },\n    appendToPrev: function() {\n        var prev = this.getPrev();\n\n        // current empty\n        if (this.isEmpty()) {\n            this.remove();\n            this.app.block.set(prev, 'end');\n            return;\n        }\n        // prev empty\n        else if (prev.isEmpty()) {\n            prev.remove();\n            this.app.control.updatePosition();\n            return;\n        }\n\n        // not empty\n        var prevType = prev.getType();\n        var html = this.getHtml();\n        var type = this.getType();\n        var insert = true;\n        var remove = true;\n\n        // code\n        if (type !== 'code' && prevType === 'code') {\n            html = this.getPlainText();\n        }\n\n        // current type\n        if (type === 'dlist') {\n            if (prevType === 'dlist') {\n                // append as nodes\n                var nodes = this.getBlock().children();\n                this.app.block.set(prev, 'end');\n                prev.getBlock().append(nodes);\n\n                insert = false;\n            }\n            else {\n                // insert with br\n                html = this.getPlainText(true);\n            }\n        }\n        else if (type === 'list') {\n            if (prevType === 'list') {\n                var $items = this.getBlock().children();\n                this.app.block.set(prev, 'end');\n                prev.getBlock().append($items);\n\n                insert = false;\n                remove = true;\n            }\n            else {\n                html = this._appendListHtml(this.getBlock(), html);\n                remove = this.isEmpty();\n            }\n        }\n\n        // append\n        if (insert) {\n\n            // set\n            this.app.block.set(prev, 'end');\n\n            // set caret after inline\n            var inline = this.app.selection.getTopInline();\n            if (inline) {\n                this.app.caret.set(inline, 'after');\n            }\n\n            // insert\n            this.app.insertion.insertHtml(html, 'start');\n            this._buildInstancesInside(prev.getBlock());\n        }\n\n        // remove\n        if (remove) {\n            this.remove();\n        }\n    },\n    append: function(instance, set) {\n        if (this.isEmptiable() && this.isEmpty()) {\n            this.$block.html('');\n            this.$block.removeClass(this.prefix + '-empty-layer');\n        }\n\n        this.$block.append(instance.getBlock());\n\n        if (set !== false) {\n            this.app.block.set(instance);\n        }\n\n        // broadcast\n        this.app.broadcast('block.add', { instance: instance });\n    },\n\n    // change\n    change: function(newInstance, broadcast) {\n        var $newBlock = newInstance.getBlock();\n\n        this.$block.after($newBlock);\n        this.$block.remove();\n\n        // rebuild\n        this.app.editor.build();\n        this.app.toolbar.observe();\n\n        // set\n        this.app.block.set(newInstance);\n\n        // broadcast\n        if (broadcast !== false) {\n            this.app.broadcast('block.change', { instance: newInstance });\n        }\n    },\n\n    // move\n    moveUp: function() {\n        var target = this.getPrev();\n        if (!target) return;\n\n        this._move(target, 'before');\n    },\n    moveDown: function(direction) {\n        var target = this.getNext();\n        if (!target) return;\n\n        this._move(target, 'after');\n    },\n\n    // private\n    _appendListHtml: function($target, html) {\n        var $item = $target.find('li').first();\n        html = $item.html().trim();\n        html = html.replace(/<\\/li>/gi, '</li><br>');\n        html = html.replace(/<(ul|ol)/gi, '<br><$1');\n        html = this.app.content.removeTags(html, ['ul', 'ol', 'li']);\n        html = html.trim();\n        html = html.replace(/<br\\s?\\/?>$/gi, '');\n\n        $item.remove();\n\n        return html;\n    },\n    _move: function(target, func) {\n        // save selection\n        if (this.isEditable()) this.app.selection.save(this.$block);\n\n        // move\n        var $targetBlock = target.getBlock();\n        $targetBlock[func](this.$block, true);\n\n        // set force\n        this.app.block.set(this.$block, false, true);\n\n        // restore selection\n        if (this.isEditable()) this.app.selection.restore(this.$block);\n    },\n    _build: function(params) {\n        // build empty\n        if (this.isEmptiable() && this.isEmpty()) {\n            this._addEmptyButton(this.$block);\n        }\n\n        // build\n        if (this.build) {\n            this.build(params);\n        }\n\n        // instances inside\n        this._buildInstancesInside(this.$block);\n    },\n    _buildData: function() {\n        if (!this.data) this.data = {};\n        this.data = $ARX.extend({}, true, this.defaults, this.data);\n    },\n    _buildInstancesInside: function($block) {\n        $block.find('[data-' + this.prefix + '-type]').each(this._buildInstanceInside.bind(this));\n    },\n    _buildInstanceInside: function($node) {\n        var instance = $node.dataget('instance');\n        if (!instance) {\n            var type = $node.attr('data-' + this.prefix + '-type');\n            this.app.create('block.' + type, $node);\n        }\n    },\n    _buildItems: function(selector, type) {\n        var $items = this.$block.find(selector);\n        if ($items.length !== 0) {\n            $items.each(function($node) {\n                this.app.create('block.' + type, $node);\n            }.bind(this));\n        }\n    },\n    _buildCaption: function() {\n        if (this.getTag() !== 'figure') return;\n\n        this.$block.find('figcaption').attr('data-placeholder', this.lang.get('placeholders.figcaption'));\n    },\n    _isEmpty: function() {\n        var html = this.$block.text();\n        html = this._cleanEmpty(html);\n\n        return (html === '');\n    },\n    _getNameByTag: function() {\n        var tag = this.getTag();\n        var name = this.app.utils.capitalize(tag);\n\n        return name;\n    },\n    _render: function() {\n        this._renderEdit();\n        this._renderDraggable();\n        this._renderEditable();\n    },\n    _renderDraggable: function() {\n\n        if (typeof this.draggable !== 'undefined' && this.draggable === false) {\n            this.$block.on('dragstart', function(e) { e.preventDefault(); return false; });\n            this.$block.find('img').on('dragstart', function(e) { e.preventDefault(); return false; });\n        }\n    },\n    _renderEditable: function() {\n\n        if (this.isEditable()) {\n            this.$block.attr('contenteditable', true);\n        }\n        else if (typeof this.editable !== 'undefined' && this.editable === false) {\n            this.$block.attr('contenteditable', false);\n        }\n\n        if (this.isEditable() && !this.opts.editor.grammarly) this.$block.attr('data-gramm_editor', false);\n    },\n    _renderEdit: function() {\n        this.$block.dataset('instance', this);\n        this.$block.attr('data-' + this.prefix + '-type', this.getType());\n    },\n    _cleanEmpty: function(html) {\n        html = this.app.utils.removeInvisibleChars(html);\n        html = (html.search(/^<br\\s?\\/?>$/) !== -1) ? '' : html;\n        html = html.replace(/\\n/g, '');\n\n        return html;\n    },\n    _removeObjClasses: function(obj) {\n        var classes = this._buildObjClasses(obj);\n        this.$block.removeClass(classes.join(' '));\n        this.app.element.removeEmptyAttrs(this.$block, ['class']);\n    },\n    _buildObjClasses: function(obj) {\n        var classes = [];\n        for (var key in obj) {\n            if (obj[key]) {\n                classes.push(obj[key]);\n            }\n        }\n\n        return classes;\n    },\n    _addEmptyButton: function($el) {\n        if ($el.hasClass(this.prefix + '-empty-layer')) return;\n\n        $el.addClass(this.prefix + '-empty-layer');\n\n        var $plus = this.dom('<span>').addClass(this.prefix + '-plus-button');\n\n        // button\n        this.app.create('button', { name: 'plus', element: $plus }, { command: 'addbar.popup' });\n\n        // append\n        $el.append($plus);\n    }\n});\nArticleEditor.add('mixin', 'tool', {\n    init: function(name, obj, popup, data) {\n        this.name = name;\n        this.setter = popup.get('setter');\n        this.popup = popup;\n        this.data = data;\n        this.obj = this._observe(obj);\n\n        if (this.obj) {\n            this._build();\n        }\n    },\n    getElement: function() {\n        return this.$tool;\n    },\n    getInput: function() {\n        return this.$input;\n    },\n    getValue: function() {\n        var value = this.$input.val();\n        return value.trim();\n    },\n    setValue: function(value) {\n        this.$input.val(value);\n    },\n    setFocus: function() {\n        this.$input.focus();\n    },\n    trigger: function(value) {\n        this.setValue(value);\n\n        if (this.setter) {\n            this.app.api(this.setter, this.popup);\n        }\n    },\n\n    // private\n    _build: function() {\n        this._buildTool();\n        this._buildLabel();\n        this._buildInputElement();\n        this._buildInput();\n        this._buildEvent();\n\n        // props\n        if (this._has('placeholder')) this.$input.attr('placeholder', this.lang.parse(this.obj.placeholder));\n        if (this._has('width')) this.$input.css('width', this.obj.width);\n        if (this._has('classname')) this.$input.addClass(this.obj.classname);\n    },\n    _buildInputElement: function() {\n        this.$input = this.dom('<' + this._getInputParam('tag') + '>').addClass(this.prefix + this._getInputParam('classname'));\n        this.$input.attr({ 'name': this.name, 'type': this._getInputParam('type'), 'data-type': this.type });\n        this.$input.dataset('instance', this);\n    },\n    _buildInput: function() {\n        return;\n    },\n    _buildEvent: function() {\n        var types = ['segment'];\n        if (types.indexOf(this.type) === -1 && this.setter) {\n            var events = (this.type === 'checkbox' || this.type === 'select') ? 'change' : 'keydown blur';\n            events = (this.type === 'number') ? events + ' change' : events;\n            this.$input.on(events, this._catchSetter.bind(this));\n        }\n    },\n    _buildTool: function() {\n        this.$tool = this.dom('<div>').addClass(this.prefix + '-form-item').dataset('instance', this);\n    },\n    _buildLabel: function() {\n        if (this.type !== 'checkbox' && this._has('label')) {\n            this.$label = this.dom('<label>').addClass(this.prefix + '-form-label').html(this.lang.parse(this.obj.label));\n            this.$tool.append(this.$label);\n        }\n    },\n    _getInputParam: function(name) {\n        return (this.input && typeof this.input[name] !== 'undefined') ? this.input[name] : '';\n    },\n    _get: function(name) {\n        return this.obj[name];\n    },\n    _has: function(name) {\n        return Object.prototype.hasOwnProperty.call(this.obj, name);\n    },\n    _observe: function(obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, 'observer')) {\n            obj = this.app.api(obj.observer, obj, this.name);\n        }\n\n        return obj;\n    },\n    _catchSetter: function(e) {\n        if (e.type === 'keydown' && e.which !== 13) return;\n        if (e.type === 'keydown') e.preventDefault();\n\n        // call setter\n        this.app.api(this.setter, this.popup);\n    }\n});\nArticleEditor.add('module', 'lang', {\n    init: function() {\n        this.langKey = this.app.setting.get('editor.lang');\n        this.vars = this._build();\n    },\n    get: function(name) {\n        var value = this._get(name, this.vars);\n        if (typeof value === 'undefined' && this.langKey !== 'en') {\n            value = this._get(name, $ARX.lang.en);\n        }\n\n        return (typeof value === 'undefined') ? '' : value;\n    },\n    parse: function(str) {\n        if (typeof str !== 'string') return str;\n\n        var matches = str.match(/## (.*?) ##/g);\n        if (matches) {\n            for (var i = 0; i < matches.length; i++) {\n                var key = matches[i].replace(/^##\\s/g, '').replace(/\\s##$/g, '');\n                str = str.replace(matches[i], this.get(key));\n            }\n        }\n\n        return str;\n    },\n\n    // private\n    _get: function(name, vars) {\n        var value;\n        var arr = name.split('.');\n\n        if (arr.length === 1) value = vars[name];\n        else value = (typeof vars[arr[0]] !== 'undefined') ? vars[arr[0]][arr[1]] : undefined;\n\n        return value;\n    },\n    _build: function() {\n        var vars = $ARX.lang.en;\n        if (this.langKey !== 'en') {\n            vars = ($ARX.lang[this.langKey] !== 'undefined') ? $ARX.lang[this.langKey] : vars;\n        }\n\n        return vars;\n    }\n});\nArticleEditor.add('module', 'setting', {\n    init: function() {\n        this.opts = this._build();\n    },\n    dump: function() {\n        return this.opts;\n    },\n    has: function(name) {\n        var value;\n        var arr = name.split('.');\n\n        if (arr.length === 1) value = (typeof this.opts[name] !== 'undefined');\n        else value = (typeof this.opts[arr[0]] !== 'undefined' && typeof this.opts[arr[1]] !== 'undefined');\n\n        return value;\n    },\n    set: function(section, name, value) {\n        if (typeof this.opts[section] === 'undefined') this.opts[section] = {};\n\n        if (typeof value === 'undefined') this.opts[section] = name;\n        else this.opts[section][name] = value;\n    },\n    get: function(name) {\n        var value;\n        var arr = name.split('.');\n\n        if (arr.length === 1) value = this.opts[name];\n        else value = (typeof this.opts[arr[0]] !== 'undefined') ? this.opts[arr[0]][arr[1]] : undefined;\n\n        return value;\n    },\n\n    // private\n    _build: function() {\n        var opts = $ARX.extend(true, {}, $ARX.opts, this.app.initialSettings);\n        opts = $ARX.extend(true, opts, $ARX.settings);\n\n        return opts;\n    }\n});\nArticleEditor.add('module', 'container', {\n    init: function() {\n        this.blurclass = this.prefix + '-in-blur';\n        this.focusclass = this.prefix + '-in-focus';\n    },\n    start: function() {\n        this._buildMain();\n        this._buildContainers(this.$main, this.opts.containers.main);\n        this._buildBSModal();\n    },\n    stop: function() {\n        this.$main.remove();\n    },\n    get: function(name) {\n        return this['$' + name];\n    },\n    setFocus: function() {\n        this.$main.removeClass(this.blurclass).addClass(this.focusclass);\n    },\n    setBlur: function() {\n        this.$main.removeClass(this.focusclass).addClass(this.blurclass);\n    },\n    isFocus: function() {\n        return this.$main.hasClass(this.focusclass);\n    },\n\n    // private\n    _buildMain: function() {\n        this.$main = this.dom('<div>').attr(this.prefix + '-uuid', this.uuid);\n        this.$main.addClass(this.prefix + '-container ' + this.prefix + '-container-' + this.uuid);\n\n        // place\n        this.app.$element.after(this.$main);\n    },\n    _buildContainers: function($target, containers) {\n        for (var i = 0; i < containers.length; i++) {\n            var name = containers[i];\n            var elName = '$' + name;\n\n            // create\n            this[elName] = this._createContainer(name);\n\n            // nested\n            if (typeof this.opts.containers[name] !== 'undefined') {\n                this._buildContainers(this[elName], this.opts.containers[name]);\n            }\n\n            // append\n            $target.append(this[elName]);\n        }\n    },\n    _buildBSModal: function() {\n        this.opts.bsmodal = (this.$main.closest('.modal-dialog').length !== 0);\n    },\n    _createContainer: function(name) {\n        return this.dom('<div>').addClass(this.prefix + '-' + name + '-container');\n    }\n});\nArticleEditor.add('module', 'accessibility', {\n    start: function() {\n        this._buildRole();\n        this._buildLabel();\n    },\n    _buildRole: function() {\n        this.app.editor.getEditor().attr({ 'aria-labelledby': this.prefix + '-voice', 'role': 'presentation' });\n    },\n    _buildLabel: function() {\n        var html = this.lang.get('accessibility.help-label');\n        var $label = this._createLabel(html);\n\n        // append\n        this.app.container.get('main').prepend($label);\n    },\n    _createLabel: function(html) {\n        var $label = this.dom('<span />').addClass(this.prefix + '-voice-label');\n        $label.attr({ 'id': this.prefix + '-voice-' + this.uuid, 'aria-hidden': false });\n        $label.html(html);\n\n        return $label;\n    }\n});\nArticleEditor.add('module', 'utils', {\n\n    // mobile\n    isMobile: function() {\n        return (\"ontouchstart\" in document.documentElement);\n    },\n\n    // invisible chars\n    createInvisibleChar: function() {\n        return document.createTextNode(this.opts.markerChar);\n    },\n    searchInvisibleChars: function(str) {\n        return str.search(/^\\uFEFF$/g);\n    },\n    removeInvisibleChars: function(str) {\n        return str.replace(/\\uFEFF/g, '');\n    },\n\n    // wrapper\n    wrap: function(html, func) {\n        var $w = this.dom('<div>').html(html);\n        func($w);\n\n        html = $w.html();\n        $w.remove();\n\n        return html;\n    },\n\n    // arrays\n    extendArray: function(arr, extend) {\n        arr = arr.concat(arr);\n        if (extend) {\n            for (var i = 0 ; i < extend.length; i++) {\n                arr.push(extend[i]);\n            }\n        }\n\n        return arr;\n    },\n    removeFromArrayByValue: function(arr, val) {\n        val = (Array.isArray(val)) ? val : [val];\n        var index;\n        for (var i = 0; i < val.length; i++) {\n            index = arr.indexOf(val[i]);\n            if (index > -1) arr.splice(index, 1);\n        }\n        return arr;\n    },\n    sumOfArray: function(arr) {\n        return arr.reduce(function(a, b) {\n            return parseInt(a) + parseInt(b);\n        }, 0);\n    },\n\n    // object\n    getObjectIndex: function(obj, key) {\n        return Object.keys(obj).indexOf(key);\n    },\n    insertToObject: function (key, value, obj, pos) {\n        return Object.keys(obj).reduce(function(ac, a, i) {\n            if (i === pos) ac[key] = value;\n            ac[a] = obj[a];\n            return ac;\n        }, {});\n    },\n\n    // random\n    getRandomId: function() {\n        var id = '';\n        var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n        for (var i = 0; i < 12; i++) {\n            id += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return id;\n    },\n\n    // escape\n    escapeRegExp: function(s) {\n        return s.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    },\n\n    // string\n    capitalize: function(str) {\n        str = str.toLowerCase();\n\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    // data\n    extendData: function(data, obj) {\n        for (var key in obj) {\n            if (key === 'elements') {\n                data = this._extendDataElements(data, obj[key]);\n            }\n            else {\n                data = this._setData(data, key, obj[key]);\n            }\n        }\n\n        return data;\n    },\n    _extendDataElements: function(data, value) {\n        this.dom(value).each(function($node) {\n            if ($node.get().tagName === 'FORM') {\n                var serializedData = $node.serialize(true);\n                Object.keys(serializedData).forEach(function(key) {\n                    data = this._setData(data, key, serializedData[key]);\n                }.bind(this));\n            }\n            else {\n                var name = ($node.attr('name')) ? $node.attr('name') : $node.attr('id');\n                data = this._setData(data, name, $node.val());\n            }\n        }.bind(this));\n\n        return data;\n    },\n    _setData: function(data, name, value) {\n        if (data instanceof FormData) data.append(name, value);\n        else data[name] = value;\n\n        return data;\n    },\n\n    // css\n    cssToObject: function(str) {\n        let regex = /([\\w-]*)\\s*:\\s*([^;]*)/g,\n            match,\n            props = {};\n\n        do {\n            match = regex.exec(str);\n            if (match != null) {\n                props[match[1]] = this._normalizeValue(match[1], match[2].trim());\n            }\n        }\n        while (match);\n\n        return props;\n    },\n    _normalizeValue: function(key, val) {\n        val = (typeof val === 'string') ? val.replace(/'/g, '\"') : val;\n        val = val.trim().replace(/;$/, '');\n        if (key.search(/color|background/) !== -1) {\n            val = this.convertRgb2hex(val);\n            val = val.toLowerCase();\n        }\n        if (key.search(/family/) !== -1) {\n            val = val.replace(/\"/g, '');\n        }\n\n        return val;\n    },\n\n    // color\n    getInvertedColor: function(hex) {\n        hex = (hex === '' || hex === null || typeof hex === 'undefined') ? '#ffffff' : hex;\n        hex = this.normalizeColor(hex);\n        hex = this._removeHexDiese(hex);\n\n        var r = parseInt(hex.slice(0, 2), 16),\n            g = parseInt(hex.slice(2, 4), 16),\n            b = parseInt(hex.slice(4, 6), 16);\n\n        return ((r * 0.299 + g * 0.587 + b * 0.114) > 186) ? 'black' : 'white';\n    },\n    normalizeColor: function(color) {\n        color = (color) ? this.convertRgb2hex(color) : color;\n        color = (color) ? this.convertShorthex2long(color) : color;\n\n        return color;\n    },\n    convertRgb2hex: function(color) {\n        if (color.search(/^rgb/i) === -1) {\n            return color;\n        }\n\n        var arr = color.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n        return (arr && arr.length === 4) ? \"#\" +\n        (\"0\" + parseInt(arr[1],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(arr[2],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(arr[3],10).toString(16)).slice(-2) : '';\n    },\n    convertShorthex2long: function(hex) {\n        hex = this._removeHexDiese(hex);\n        return (hex.length === 3) ? '#' + hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2] : '#' + hex;\n    },\n    replaceRgbToHex: function(html) {\n        return html.replace(/rgb\\((.*?)\\)/g, function (match, capture) {\n            let a = capture.split(',');\n            let b = a.map(function(x) {\n                x = parseInt(x).toString(16);\n                return (x.length === 1) ? '0' + x : x;\n            });\n\n            return '#' + b.join(\"\");\n        });\n    }\n});\nArticleEditor.add('module', 'paragraphizer', {\n    init: function() {\n        this.remStart = '#####replace';\n        this.remEnd = '#####';\n\n        var extendTags =  ['form', 'audio', 'figcaption', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n                    'button', 'option', 'map', 'area', 'math', 'fieldset', 'legend', 'hgroup', 'nav', 'details', 'menu', 'summary'];\n        this.tags = this.opts.tags.parser.concat(extendTags);\n    },\n    paragraphize: function(html) {\n        // build markup tag\n        var tag = 'p';\n        var stored = [];\n        var storedComments = [];\n\n        // store\n        html = this._storeTags(html, stored);\n        html = this.app.content.storeComments(html, storedComments);\n\n        // trim\n        html = html.trim();\n        html = this._trimLinks(html);\n\n        // replace new lines\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)$/g, '');\n        html = html.replace(/xparagraphmarkerz$/g, '');\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)/g, '\\n');\n        html = html.replace(/xparagraphmarkerz/g, '\\n');\n        html = html.replace(/[\\n]+/g, \"\\n\");\n\n        // wrap to tag\n        var str = '';\n        var arr = html.split(\"\\n\");\n        for (var i = 0; i < arr.length; i++) {\n            str += '<' + tag + '>' + arr[i].trim() + '</' + tag + '>\\n';\n        }\n\n        // trim new line at the end\n        html = str.replace(/\\n$/, '');\n\n        // clean\n        html = html.replace(new RegExp('<' + tag + '>\\\\s+#####', 'gi'), '#####');\n        html = html.replace(new RegExp('<' + tag + '>#####', 'gi'), '#####');\n        html = html.replace(new RegExp('#####</' + tag + '>', 'gi'), '#####');\n\n        // restore\n        html = this._restoreTags(html, stored);\n        html = this.app.content.restoreComments(html, storedComments);\n\n        // clean empty\n        html = html.replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\\s\\n]*<\\/\\1>/gi, '<$1$2></$1>');\n        html = html.replace(/<p(.*?)><\\/?br\\s?\\/?><\\/p>/gi, \"<p$1></p>\");\n        html = html.replace(/<div(.*?)><\\/?br\\s?\\/?><\\/div>/gi, \"<div$1></div>\");\n        html = html.replace(/<\\/?br\\s?\\/?><\\/div>/gi, \"</div>\");\n        html = html.replace(/<\\/?br\\s?\\/?><\\/li>/gi, \"</li>\");\n\n        return html;\n    },\n\n    // private\n    _storeTags: function(html, stored) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find(this.tags.join(', ')).each(function($node, i) { this._replaceTag($node, i, stored); }.bind(this));\n        }.bind(this));\n    },\n    _restoreTags: function(html, stored) {\n        for (var i = 0; i < stored.length; i++) {\n            var str = stored[i].replace(/\\$/gi, '&#36;');\n            html = html.replace(this.remStart + i + this.remEnd, str);\n        }\n\n        return html;\n    },\n    _replaceTag: function($node, i, stored) {\n        var node = $node.get();\n        var replacement = document.createTextNode(this.remStart + i + this.remEnd + 'xparagraphmarkerz');\n        stored.push(node.outerHTML);\n        node.parentNode.replaceChild(replacement, node);\n    },\n    _trimLinks: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('a').each(this._trimLink.bind(this));\n        }.bind(this));\n    },\n    _trimLink: function($node) {\n        $node.html($node.html().trim());\n    }\n});\nArticleEditor.add('module', 'element', {\n    // is\n    is: function(el, type, extend) {\n        var res = false;\n        var node = (type === 'text') ? el : this._getNode(el);\n\n        if (type === 'inline') {\n            res = (this._isElement(node) && this._isInlineTag(node.tagName, extend));\n        }\n        else if (type === 'blocks') {\n            res = (this._isElement(node) && node.hasAttribute('data-' + this.prefix + '-type'));\n        }\n        else if (type === 'blocks-first') {\n            res = (this._isElement(node) && node.hasAttribute('data-' + this.prefix + '-first-level'));\n        }\n        else if (type === 'block') {\n            res = (this._isElement(node) && this._isBlockTag(node.tagName, extend));\n        }\n        else if (type === 'element') {\n            res = this._isElement(node);\n        }\n        else if (type === 'text') {\n            res = (typeof node === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(node)) ? true : this.isTextNode(node);\n        }\n        else if (type === 'list') {\n            res = (this._isElement(node) && (['ul', 'ol'].indexOf(node.tagName.toLowerCase()) !== -1));\n        }\n        else if (type === 'heading') {\n            res = (this._isElement(node) && (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(node.tagName.toLowerCase()) !== -1));\n        }\n\n        return res;\n    },\n    isEmptyOrImageInline: function(el) {\n        var node = this.dom(el).get();\n        if (!node || node.nodeType === 3) {\n            return false;\n        }\n\n        var tag = node.tagName.toLowerCase();\n        var tags = ['svg', 'img'];\n        var noeditattr = (node.getAttribute('contenteditable') === 'false');\n        var isInline = this.is(node, 'inline');\n        if (\n                (isInline && this.isEmpty(node)) ||\n                (isInline && noeditattr) ||\n                (tags.indexOf(tag) !== -1)\n            ) {\n            return true;\n        }\n\n        return false;\n    },\n    isEmpty: function(el) {\n        var node = this._getNode(el);\n        if (node) {\n            return (node.nodeType === 3) ? (node.textContent.trim().replace(/\\n/, '') === '') : (node.innerHTML === '');\n        }\n\n        return false;\n    },\n    isTag: function(el, tag) {\n        return (this._getNode(el).tagName.toLowerCase() === tag);\n    },\n    isTextNode: function(el) {\n        var node = this._getNode(el);\n\n        return (node && node.nodeType && node.nodeType === 3);\n    },\n    isVisible: function(el) {\n        var node = this._getNode(el);\n\n        return !!(node.offsetWidth || node.offsetHeight || node.getClientRects().length);\n    },\n    isScrollVisible: function(el) {\n        var $scrollTarget = this.app.scroll.getTarget();\n        var $el = this.dom(el);\n        var docViewTop = $scrollTarget.scrollTop();\n        var docViewBottom = docViewTop + $scrollTarget.height();\n        var elemTop = $el.offset().top;\n\n        return (elemTop <= docViewBottom);\n    },\n\n    // get\n    getFirstLevel: function(el) {\n        return this.dom(el).closest('[data-' + this.prefix + '-first-level]');\n    },\n    getDataBlock: function(el) {\n        return this.dom(el).closest('[data-' + this.prefix + '-type]');\n    },\n    getType: function(el) {\n        return this.dom(el).attr('data-' + this.prefix + '-type');\n    },\n    getAllInlines: function(inline) {\n        var inlines = [];\n        var node = inline;\n        while (node) {\n            if (this.is(node, 'inline')) {\n                inlines.push(node);\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines;\n    },\n    getClosest: function(el, types) {\n        return this.dom(el).closest(this.getTypesSelector(types));\n    },\n    getParents: function(el, types) {\n        return this.dom(el).parents(this.getTypesSelector(types));\n    },\n    getChildren: function(el, types) {\n        return this.dom(el).find(this.getTypesSelector(types));\n    },\n    getTypesSelector: function(types) {\n        return '[data-' + this.prefix + '-type=' + types.join('],[data-' + this.prefix + '-type=') + ']';\n    },\n\n    // has\n    hasClass: function(el, value) {\n        value = (typeof value === 'string') ? [value] : value;\n\n        var $el = this.dom(el);\n        var count = value.length;\n        var z = 0;\n        for (var i = 0; i < count; i++) {\n            if ($el.hasClass(value[i])) {\n                z++;\n            }\n        }\n\n        return (count === z);\n    },\n\n    // scroll\n    scrollTo: function($el, tolerance) {\n        if (!this.isScrollVisible($el)) {\n            tolerance = tolerance || 60;\n            var offset = $el.offset();\n            var $target = this.app.scroll.getTarget();\n            var value = offset.top - tolerance;\n            $target.scrollTop(value);\n\n            setTimeout(function() {\n                $target.scrollTop(value);\n            }, 1);\n\n        }\n    },\n\n    // replace\n    replaceToTag: function(el, tag, keepchildnodes) {\n        return this.dom(el).replaceWith(function(node) {\n\n            var $el = this.dom('<' + tag + '>');\n            if (!keepchildnodes) {\n                $el.append(node.innerHTML);\n            }\n\n            if (node.attributes) {\n                var attrs = node.attributes;\n                for (var i = 0; i < attrs.length; i++) {\n                    $el.attr(attrs[i].nodeName, attrs[i].value);\n                }\n            }\n\n            if (keepchildnodes) {\n                while (node.childNodes.length > 0) {\n                    $el.append(this.dom(node.firstChild));\n                }\n            }\n\n            return $el;\n        }.bind(this));\n    },\n\n    // compare\n    compareStyle: function(el, obj) {\n        let len = Object.keys(obj).length,\n            $el = this.dom(el),\n            css = this.app.utils.cssToObject($el.attr('style')),\n            cssSize = Object.keys(css).length,\n            size = 0;\n\n        if (cssSize !== len) {\n            return false;\n        }\n        else {\n            for (let [key, val] of Object.entries(css)) {\n                if (obj[key]) {\n                    let value = obj[key];\n                    value = this._normalizeValue(key, value);\n                    val = this._normalizeValue(key, val);\n\n                    if (value === val) {\n                        size++;\n                    }\n                }\n            }\n        }\n\n        return (cssSize === size);\n    },\n\n    // has\n    hasAttrs: function(el, obj) {\n        let len = Object.keys(obj).length,\n            $el = this.dom(el),\n            size = 0;\n\n        for (let [key, val] of Object.entries(obj)) {\n            let value = $el.attr(key);\n\n            if (value === val) {\n                size++;\n            }\n        }\n\n        return (len === size);\n    },\n    hasStyle: function(el, obj) {\n        if (!obj) return false;\n\n        let $el = this.dom(el),\n            len = Object.keys(obj).length,\n            size = 0;\n\n        for (let [key, val] of Object.entries(obj)) {\n            let value = $el.css(key);\n            value = this._normalizeValue(key, value);\n            val = this._normalizeValue(key, val);\n\n            if (value === val) {\n                size++;\n            }\n        }\n\n        return (len === size);\n    },\n\n    // split\n    split: function(el) {\n        var $el = this.dom(el);\n        el = $el.get();\n        var tag = el.tagName.toLowerCase();\n        var fragment = this.app.content.extractHtmlFromCaret(el);\n        if (fragment.nodeType && fragment.nodeType === 11) {\n            fragment = this.dom(fragment.childNodes);\n        }\n\n        var $secondPart = this.dom('<' + tag + ' />');\n        $secondPart = this.cloneAttrs(el, $secondPart);\n        $secondPart.append(fragment);\n        $el.after($secondPart);\n\n        var $last = $el.children().last();\n        if (this.is($last, 'inline')) {\n            var html = $last.html();\n            html = this.app.utils.removeInvisibleChars(html);\n            if (html === '') {\n                $last.remove();\n            }\n        }\n\n        var type = this.getType($secondPart);\n        if (type) {\n            this.app.create('block.' + type, $secondPart, true);\n        }\n\n        if ($el.html() === '') $el.remove();\n\n        return $secondPart;\n    },\n\n    // clone\n    cloneEmpty: function(el) {\n        var $el = this.dom(el);\n        var tag =  $el.get().tagName.toLowerCase();\n        var $clone = this.dom('<' + tag + '>');\n\n        return $clone;\n    },\n    cloneAttrs: function(elFrom, elTo) {\n        var $elTo = this.dom(elTo);\n        var attrs = this._getNode(elFrom).attributes;\n        var len = attrs.length;\n        while (len--) {\n            var attr = attrs[len];\n            $elTo.attr(attr.name, attr.value);\n        }\n\n        return $elTo;\n    },\n\n    // attrs\n    getAttrs: function(el) {\n        var node = this._getNode(el);\n        var attr = {};\n        if (node.attributes != null && node.attributes.length) {\n            for (var i = 0; i < node.attributes.length; i++) {\n                var val = node.attributes[i].nodeValue;\n                val = (this._isNumber(val)) ? parseFloat(val) : this._getBooleanFromStr(val);\n                attr[node.attributes[i].nodeName] = val;\n            }\n        }\n\n        return attr;\n    },\n    removeEmptyAttrs: function(el, attrs) {\n        var $el = this.dom(el);\n        var name = attrs.join(' ');\n        var res = false;\n\n        if (typeof $el.attr(name) === 'undefined' || $el.attr(name) === null) {\n            res = true;\n        }\n        else if ($el.attr(name) === '') {\n            $el.removeAttr(name);\n            res = true;\n        }\n\n        return res;\n    },\n\n    // blocks\n    getBlocks: function(el, parsertags, extendtags) {\n        var node = this._getNode(el);\n        var nodes = node.childNodes;\n        var finalNodes = [];\n        var tags = parsertags || this.opts.tags.parser;\n        if (extendtags) {\n            tags = this.app.utils.extendArray(tags, extendtags);\n        }\n\n        for (var i = 0; i < nodes.length; i++) {\n            if (nodes[i].nodeType === 1 && tags.indexOf(nodes[i].tagName.toLowerCase()) !== -1) {\n                finalNodes.push(nodes[i]);\n            }\n        }\n\n        return finalNodes;\n    },\n    hasBlocks: function(el) {\n        return (this.getBlocks(el).length !== 0);\n    },\n\n    // siblings\n    hasTextSiblings: function(el) {\n        var node = this._getNode(el);\n        var hasPrev = (node.previousSibling && node.previousSibling.nodeType === 3 && !this.isEmpty(node.previousSibling));\n        var hasNext = (node.nextSibling && node.nextSibling.nodeType === 3 && !this.isEmpty(node.nextSibling));\n\n        return (hasPrev || hasNext);\n    },\n\n    // private\n    _getNode: function(el) {\n        return this.dom(el).get();\n    },\n    _getBooleanFromStr: function(str) {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _isBlockTag: function(tag, extend) {\n        var arr = this.app.utils.extendArray(this.opts.tags.block, extend);\n\n        return (arr.indexOf(tag.toLowerCase()) !== -1);\n    },\n    _isInlineTag: function(tag, extend) {\n        var arr = this.app.utils.extendArray(this.opts.tags.inline, extend);\n\n        return (arr.indexOf(tag.toLowerCase()) !== -1);\n    },\n    _isElement: function(node) {\n        return (node && node.nodeType && node.nodeType === 1);\n    },\n    _isTag: function(tag) {\n        return (tag !== undefined && tag);\n    },\n    _isNumber: function(str) {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _normalizeValue: function(key, val) {\n        val = (typeof val === 'string') ? val.replace(/'/g, '\"') : val;\n        val = val.trim().replace(/;$/, '');\n        if (key.search(/color|background/) !== -1) {\n            val = this.app.utils.convertRgb2hex(val);\n            val = val.toLowerCase();\n        }\n        if (key.search(/family/) !== -1) {\n            val = val.replace(/\"/g, '');\n        }\n\n        return val;\n    }\n});\nArticleEditor.add('module', 'scroll', {\n    init: function() {\n        this.scrolltop = false;\n    },\n    save: function() {\n        this.scrolltop = this.getTarget().scrollTop();\n    },\n    restore: function() {\n        if (this.scrolltop !== false) {\n            this.getTarget().scrollTop(this.scrolltop);\n            this.scrolltop = false;\n        }\n    },\n    isTarget: function() {\n        return (this.opts.editor.scrollTarget !== window);\n    },\n    getTarget: function() {\n        return this.dom(this.opts.editor.scrollTarget);\n    }\n});\nArticleEditor.add('module', 'button', {\n    init: function(name, obj, $container, type) {\n        // build\n        if (typeof name === 'object') {\n            this.name = name.name;\n            this.obj = obj;\n            this._buildFromElement(name.element);\n        }\n        else if (name) {\n            this.type = type || false;\n            this.name = name;\n\n            var res = this._observe(obj);\n            this.obj = (typeof res === 'undefined') ? obj : res;\n\n            if (this.obj) {\n                this._build(name, $container);\n            }\n        }\n    },\n    setColor: function(stack, data) {\n        var name = stack.getName();\n        if (name === 'background' || name === 'text-color') {\n            var key = (name === 'background') ? 'background-color' : 'color';\n            this.setBackground(data[key]);\n        }\n    },\n    isButton: function() {\n        return true;\n    },\n    isAddbar: function() {\n        return this._has('addbar');\n    },\n    isControl: function() {\n        return this._has('control');\n    },\n    getName: function() {\n        return this.name;\n    },\n    getTitle: function() {\n        return this.title;\n    },\n    getParams: function() {\n        return (this._has('params')) ? this.obj.params : false;\n    },\n    getOffset: function() {\n        return this.$button.offset();\n    },\n    getDimension: function() {\n        return {\n            width: this.$button.width(),\n            height: this.$button.height()\n        };\n    },\n    getElement: function() {\n        return this.$button;\n    },\n    setBackground: function(color) {\n        this._background('add', color);\n    },\n    resetBackground: function() {\n        this._background('remove', '');\n    },\n\n    // private\n    _has: function(name) {\n        return Object.prototype.hasOwnProperty.call(this.obj, name);\n    },\n    _observe: function(obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, 'observer')) {\n            obj = this.app.api(obj.observer, obj, this.name);\n        }\n\n        return obj;\n    },\n    _background: function(type, color) {\n        var func = (type === 'remove') ? 'removeClass' : 'addClass';\n        this.$icon[func](this.prefix + '-button-icon-color').css({\n            'background-color': color,\n            'color': (color !== '') ? this.app.color.invert(color) : ''\n        });\n    },\n    _buildFromElement: function(element) {\n        this.$button = this.dom(element);\n        this.$button.addClass(this.prefix + '-button-target');\n        this._buildData();\n    },\n    _build: function(name, $container) {\n\n        this._buildTitle();\n        this._buildElement();\n        this._buildIcon();\n        this._buildData($container);\n    },\n    _buildData: function($container) {\n\n        // data\n        this.$button.attr({\n            'tabindex': '-1',\n            'data-name': this.name,\n            'data-command': this.obj.command || false\n        });\n\n        this.$button.dataset('instance', this);\n\n        // func\n        var func = (this._has('command')) ? '_catch' : '_stop';\n\n        // events\n        this.$button.on('click.' + this.prefix + '-button', this[func].bind(this));\n        this.$button.on('dragstart.' + this.prefix + '-button', function(e) { e.preventDefault(); return; });\n\n        if ($container) {\n            this._buildTooltip();\n            this._buildBackground();\n            this._buildPosition($container);\n        }\n    },\n    _buildTitle: function() {\n        this.title = (typeof this.obj.title !== 'undefined') ? this.lang.parse(this.obj.title) : '';\n    },\n    _buildElement: function() {\n        this.$button = this.dom('<a href=\"#\"></a>');\n        this.$button.addClass(this.prefix + '-button ' + this.prefix + '-button-target');\n\n        if (this.type) {\n            this.$button.addClass(this.prefix + '-button-' + this.type);\n        }\n\n        if (this._has('classname')) {\n            this.$button.addClass(this.obj.classname);\n        }\n    },\n    _buildIcon: function() {\n        var isIcon = this._has('icon');\n        var span = '<span class=\"' + this.prefix + '-icon-' + this.name + '\"></span>';\n\n        this.$icon = this._buildIconElement();\n\n        if (isIcon && this.obj.icon !== true) {\n            if (this.obj.icon.search(/</) !== -1) {\n                span = this.obj.icon;\n            }\n            else {\n                span = '<span class=\"' + this.prefix + '-icon-' + this.obj.icon + '\"></span>';\n            }\n        }\n\n        // buttons.icons\n        if (this.opts.buttons.icons && typeof this.opts.buttons.icons[this.name] !== 'undefined') {\n            span = this.opts.buttons.icons[this.name];\n        }\n\n        this.$icon.append(span);\n        this.$button.append(this.$icon);\n    },\n    _buildIconElement: function() {\n        return this.dom('<span>').addClass(this.prefix + '-button-icon');\n    },\n    _buildTooltip: function() {\n        if (this.type === 'toolbar' || (this.type === 'context' && this.opts.tooltip.context)) {\n            this.app.tooltip.build(this.$button, this.title);\n        }\n    },\n    _buildBackground: function() {\n        if (this._has('background')) {\n            this.setBackground(this.obj.background);\n        }\n    },\n    _buildPosition: function($container) {\n        if (this._has('position')) {\n            var pos = this.obj.position;\n            if (pos === 'first') {\n                $container.prepend(this.$button);\n            }\n            else if (typeof pos === 'object') {\n\n                var type = (Object.prototype.hasOwnProperty.call(pos, 'after')) ? 'after' : 'before';\n                var name = pos[type];\n                var $el = this._findPositionElement(name, $container);\n\n                if ($el) {\n                    $el[type](this.$button);\n                }\n                else {\n                    $container.append(this.$button);\n                }\n            }\n        }\n        else {\n            $container.append(this.$button);\n        }\n    },\n    _findPositionElement: function(name, $container) {\n        var $el;\n        if (Array.isArray(name)) {\n            for (var i = 0; i < name.length; i++) {\n                $el = $container.find('[data-name=' + name[i] + ']');\n                if ($el.length !== 0) break;\n            }\n        }\n        else {\n            $el = $container.find('[data-name=' + name + ']');\n        }\n\n        return ($el.length !== 0) ? $el : 0;\n    },\n    _stop: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    },\n    _catch: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $btn = this.dom(e.target).closest('.' + this.prefix + '-button-target');\n        if ($btn.hasClass('disable')) return;\n\n        // editor focus\n        this.app.editor.setFocus();\n\n        var command = $btn.attr('data-command');\n        var name = $btn.attr('data-name');\n        var instance = $btn.dataget('instance');\n\n        // command\n        this.app.api(command, this.getParams(), instance, name, e);\n        this.app.tooltip.close();\n    }\n});\nArticleEditor.add('module', 'tooltip', {\n    init: function() {\n        this.classname = this.prefix + '-tooltip';\n        this.eventname = this.prefix + '-button-' + this.uuid;\n    },\n    stop: function() {\n        this.close();\n    },\n    build: function($btn, title) {\n        title = this._cleanTitle(title);\n        if (title) {\n            $btn.attr('data-tooltip', title);\n            $btn.on('mouseover.' + this.eventname, this.open.bind(this));\n            $btn.on('mouseout.' + this.eventname, this.close.bind(this));\n        }\n    },\n    open: function(e) {\n        var $btn = this._getButton(e);\n        if (this.app.popup.isOpen() || $btn.hasClass('disable')) {\n            return;\n        }\n\n        // create\n        this.$tooltip = this._create($btn);\n\n        // position\n        this._setPosition($btn);\n        this._fixBSModal();\n\n        // append\n        this.app.$body.append(this.$tooltip);\n    },\n    close: function() {\n        this.app.$body.find('.' + this.classname).remove();\n    },\n\n    // private\n    _create: function($btn) {\n        return this.dom('<span>').addClass(this.classname).html($btn.attr('data-tooltip'));\n    },\n    _cleanTitle: function(title) {\n        return (title) ? title.replace(/(<([^>]+)>)/gi, '') : false;\n    },\n    _setPosition: function($btn) {\n        var offset = $btn.offset();\n        var height = $btn.height();\n\n        this.$tooltip.css({\n            top: (offset.top + height) + 'px',\n            left: (offset.left) + 'px'\n        });\n    },\n    _fixBSModal: function() {\n        if (this.opts.bsmodal) {\n            this.$tooltip.css('z-index', 1060);\n        }\n    },\n    _getButton: function(e) {\n        return this.dom(e.target).closest('.' + this.prefix + '-button-target');\n    }\n});\nArticleEditor.add('module', 'fragment', {\n    build: function(node) {\n        return (this.is(node)) ? node : this.create(node);\n    },\n    insert: function(fragment) {\n        var sel = this.app.selection.get();\n        if (!sel.range) return;\n\n        if (sel.collapsed) {\n            var start = sel.range.startContainer;\n            if (start.nodeType !== 3 && start.tagName === 'BR') {\n                start.parentNode.removeChild(start);\n            }\n        }\n        else {\n            sel.range.deleteContents();\n        }\n\n        if (fragment.frag) {\n            sel.range.insertNode(fragment.frag);\n        }\n        else {\n            sel.range.insertNode(fragment);\n        }\n    },\n    createContainer: function(html) {\n        var $div = this.dom('<div>');\n\n        if (typeof html === 'string') $div.html(html);\n        else $div.append(this.dom(html).clone(true));\n\n        return $div.get();\n    },\n    create: function(html) {\n        var el = (typeof html === 'string') ? this.createContainer(html) : html;\n        var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n        var nodes = [];\n        var i = 0;\n        while ((node = el.firstChild)) {\n            i++;\n            var n = frag.appendChild(node);\n            if (i === 1) firstNode = n;\n\n            nodes.push(n);\n            lastNode = n;\n        }\n\n        return { frag: frag, first: firstNode, last: lastNode, nodes: nodes };\n    },\n    is: function(obj) {\n        return (typeof obj === 'object' && obj.frag);\n    }\n});\nArticleEditor.add('module', 'clipboard', {\n    getContent: function(clipboard) {\n        var type = (this.isPlainText(clipboard)) ? 'text/plain' : 'text/html';\n        var html = clipboard.getData(type);\n\n        // html\n        return (type === 'text/plain') ?  this.app.content.escapeHtml(html) : html;\n    },\n    setContent: function(e, html, text) {\n        var clipboard = e.clipboardData;\n\n        // unparse\n        html = this.app.parser.unparse(html);\n        html = '<meta type=\"' + this.prefix + '-editor\"/>' + html;\n\n        // text\n        text = text || this.app.content.getTextFromHtml(html, { nl: true });\n\n        // set\n        clipboard.setData('text/html', html);\n        clipboard.setData('text/plain', text);\n    },\n    isPlainText: function(clipboard) {\n        var text = clipboard.getData('text/plain');\n        var html = clipboard.getData('text/html');\n\n        if (html && html.trim() !== '') {\n            return false;\n        }\n        else {\n            return (text !== null);\n        }\n    }\n});\nArticleEditor.add('module', 'codemirror', {\n    init: function() {\n        this.cm = false;\n    },\n    create: function(params) {\n        if (!this.is()) return;\n\n        var opts = (typeof this.opts.codemirror === 'object') ? this.opts.codemirror : {};\n        var instance = (this.opts.codemirrorSrc) ? this.opts.codemirrorSrc : CodeMirror;\n\n        this.cm = instance.fromTextArea(this.dom(params.el).get(), opts);\n\n        if (params.height) this.cm.setSize(null, params.height);\n        if (params.focus) this.cm.focus();\n\n        return this.cm;\n    },\n    destroy: function() {\n        if (this.cm) {\n            this.cm.toTextArea();\n            this.cm = false;\n        }\n    },\n    is: function() {\n        return this.opts.codemirror;\n    },\n    val: function(html) {\n        if (this.is() && this.cm) {\n            html = this.cm.getValue();\n        }\n\n        return html;\n    }\n});\nArticleEditor.add('class', 'upload', {\n    defaults: {\n        type: 'image',\n        box: false,\n        url: false,\n        cover: true, // 'cover'\n        name: 'file',\n        data: false,\n        multiple: true,\n        placeholder: false,\n        hidden: true,\n        target: false,\n        success: false,\n        error: false,\n        remove: false,\n        trigger: false,\n        input: false\n    },\n    init: function($el, params, trigger) {\n        this.eventname = this.prefix + '-upload';\n\n        if ($el) {\n            this._build($el, params, trigger);\n        }\n    },\n    send: function(e, files, params, trigger) {\n        this.p = this._buildParams(params, trigger);\n        this._send(e, files);\n    },\n    complete: function(response, e) {\n        this._complete(response, e);\n    },\n\n    // api\n    setImage: function(url) {\n        if (this.p.input) return;\n\n        if (this.$image) this.$image.remove();\n        if (this.$remove) this.$remove.remove();\n\n        if (url === '') {\n            this.$placeholder.show();\n        }\n        else {\n            this.$placeholder.hide();\n            this._buildImage(url);\n\n            if (this.p.remove) {\n                this._buildRemove();\n            }\n        }\n    },\n\n    // build\n    _build: function($el, params, trigger) {\n        this.p = this._buildParams(params, trigger);\n        this.$element = this.dom($el);\n\n        var tag = this.$element.get().tagName;\n        if (tag === 'INPUT') {\n            this._buildByInput();\n        }\n        else {\n            this._buildByBox();\n        }\n    },\n    _buildImage: function(url) {\n        this.$image = this.dom('<img>');\n        this.$image.attr('src', url);\n        this.$box.append(this.$image);\n\n        if (this.p.input === false) {\n            this.$box.off('click.' + this.eventname);\n            this.$image.on('click.' + this.eventname, this._click.bind(this));\n        }\n    },\n    _buildRemove: function() {\n        this.$remove = this.dom('<span>');\n        this.$remove.addClass(this.prefix + '-upload-remove');\n        this.$remove.on('click', this._removeImage.bind(this));\n        this.$box.append(this.$remove);\n    },\n    _buildParams: function(params, trigger) {\n        params = $ARX.extend(true, this.defaults, params);\n        if (trigger) params.trigger = trigger;\n\n        return params;\n    },\n    _buildByInput: function() {\n\n        this.$input = this.$element;\n\n        // box\n        if (this.p.box) {\n            this._buildBox();\n            this._buildPlaceholder();\n        }\n        // input\n        else {\n            this.p.input = true;\n        }\n\n        this._buildAccept();\n        this._buildMultiple();\n        this._buildEvents();\n    },\n    _buildByBox: function() {\n        this._buildInput();\n        this._buildAccept();\n        this._buildMultiple();\n        this._buildBox();\n        this._buildPlaceholder();\n        this._buildEvents();\n    },\n    _buildBox: function() {\n        this.$box = this.dom('<div>').addClass(this.prefix + '-form-upload-box');\n        this.$element.before(this.$box);\n\n        // cover\n        if (this.p.cover === false) {\n            this.$box.addClass(this.prefix + '-form-upload-cover-off');\n        }\n\n        // hide\n        if (this.p.hidden) {\n            this.$element.hide();\n        }\n    },\n    _buildPlaceholder: function() {\n        if (!this.p.placeholder) return;\n        this.$placeholder = this.dom('<span>').addClass(this.prefix + '-form-upload-placeholder');\n        this.$placeholder.html(this.p.placeholder);\n        this.$box.append(this.$placeholder);\n    },\n    _buildInput: function() {\n        this.$input = this.dom('<input>');\n        this.$input.attr('type', 'file');\n        this.$input.attr('name', this._getUploadParam());\n        this.$input.hide();\n\n        this.$element.before(this.$input);\n    },\n    _buildAccept: function() {\n        if (this.p.type !== 'image') return;\n\n        var types = this.opts.image.types.join(',');\n        this.$input.attr('accept', types);\n    },\n    _buildMultiple: function() {\n        if (this.p.type !== 'image') return;\n\n        if (this.p.multiple) {\n            this.$input.attr('multiple', 'multiple');\n        }\n        else {\n            this.$input.removeAttr('multiple');\n        }\n    },\n    _buildEvents: function() {\n        this.$input.on('change.' + this.eventname + '-' + this.uuid, this._change.bind(this));\n\n        if (this.p.input === false) {\n            this.$box.on('click.' + this.eventname, this._click.bind(this));\n            this.$box.on('drop.' + this.eventname, this._drop.bind(this));\n            this.$box.on('dragover.' + this.eventname, this._dragover.bind(this));\n            this.$box.on('dragleave.' + this.eventname, this._dragleave.bind(this));\n        }\n    },\n    _buildData: function(name, files, data) {\n        if (this.p.multiple === 'single') {\n            data.append(name, files[0]);\n        }\n        else if (this.p.multiple) {\n            for (var i = 0; i < files.length; i++) {\n                data.append(name + '[]', files[i]);\n            }\n        }\n        else {\n            data.append(name + '[]', files[0]);\n        }\n\n        return data;\n    },\n\n    // remove\n    _removeImage: function(e) {\n        if (e) {\n            e.preventDefault();\n            e.stopPropagation();\n        }\n\n        if (this.$image) this.$image.remove();\n        if (this.$remove) this.$remove.remove();\n\n        this.$placeholder.show();\n\n        if (this.p.input === false) {\n            this.$box.on('click.' + this.eventname, this._click.bind(this));\n        }\n\n        if (e) {\n            this.app.api(this.p.remove, e);\n        }\n    },\n\n    // get\n    _getUploadParam: function() {\n        return this.p.name;\n    },\n\n\n    // events\n    _click: function(e) {\n        e.preventDefault();\n        this.$input.click();\n    },\n    _change: function(e) {\n        this._send(e, this.$input.get().files);\n    },\n    _drop: function(e) {\n        e.preventDefault();\n        this._send(e);\n    },\n    _dragover: function(e) {\n        e.preventDefault();\n        this._setStatus('hover');\n        return false;\n    },\n    _dragleave: function(e) {\n        e.preventDefault();\n        this._removeStatus();\n        return false;\n    },\n\n    // set\n    _setStatus: function(status) {\n        if (this.p.input || !this.p.box) return;\n        this._removeStatus();\n        this.$box.addClass(this.prefix + '-form-upload-' + status);\n    },\n\n    // remove\n    _removeStatus: function() {\n        if (this.p.input || !this.p.box) return;\n        var status = ['hover', 'error'];\n        for (var i = 0; i < status.length; i++) {\n            this.$box.removeClass(this.prefix + '-form-upload-' + status[i]);\n        }\n    },\n\n    // send\n    _send: function(e, files) {\n        files =  files || e.dataTransfer.files;\n\n        var data = new FormData();\n        var name = this._getUploadParam();\n\n        data = this._buildData(name, files, data);\n        data = this.app.utils.extendData(data, this.p.data);\n\n        // send data\n        this._sendData(e, files, data);\n    },\n    _sendData: function(e, files, data) {\n        if (typeof this.p.url === 'function') {\n            this.p.url.call(this.app, this, { data: data, files: files, e: e });\n        }\n        else {\n            this.app.progress.show();\n            this.ajax.post({\n                url: this.p.url,\n                data: data,\n                before: function(xhr) {\n                    var event = this.app.broadcast('upload.before.send', { xhr: xhr, data: data, files: files, e: e });\n                    if (event.isStopped()) {\n                        this.app.progress.hide();\n                        return false;\n                    }\n                }.bind(this),\n                success: function(response) {\n                    this._complete(response, e);\n                }.bind(this),\n                error: function(response) {\n                    this._complete(response, e);\n                }.bind(this)\n            });\n        }\n    },\n\n    // complete\n    _complete: function(response, e) {\n        if (response && response.error) {\n            this._setStatus('error');\n\n            if (this.p.error) {\n                this.app.broadcast('upload.error', { response: response });\n                this.app.api(this.p.error, response, e);\n            }\n        }\n        else {\n            this._removeStatus();\n            this._trigger(response);\n\n            if (this.p.success) {\n                this.app.broadcast('upload.complete', { response: response });\n                this.app.api(this.p.success, response, e);\n            }\n        }\n\n        setTimeout(function() {\n            this.app.progress.hide();\n        }.bind(this), 500);\n    },\n    _trigger: function(response) {\n        if (this.p.trigger) {\n            if (response && response.url) {\n                var instance = this.p.trigger.instance;\n                var method = this.p.trigger.method;\n                instance[method].call(instance, response.url);\n            }\n        }\n    }\n});\nArticleEditor.add('module', 'progress', {\n    stop: function() {\n        this.hide();\n    },\n    show: function() {\n        this.hide();\n\n        this.$progress = this.dom('<div>').addClass(this.prefix + '-editor-progress');\n        this.$progress.attr('id', this.prefix + '-progress');\n\n        this.$progressBar = this.dom('<span>');\n        this.$progress.append(this.$progressBar);\n        this.app.$body.append(this.$progress);\n    },\n    hide: function() {\n        this.app.$body.find('#' + this.prefix + '-progress').remove();\n    }\n});\nArticleEditor.add('module', 'autosave', {\n    send: function() {\n        if (this.opts.autosave.url) {\n            this._sending();\n        }\n    },\n\n    // private\n    _getName: function() {\n        var name;\n        if (this.opts.autosave.name) {\n            name = this.opts.autosave.name;\n        }\n        else {\n            name = this.app.$element.attr('name');\n            name = (!name) ? 'content' + this.uuid : name;\n        }\n\n        return name;\n    },\n    _sending: function() {\n        var name = this._getName();\n        var data = {};\n        data[name] = this.app.$element.val();\n        data = this.app.utils.extendData(data, this.opts.autosave.data);\n\n        this.ajax.request(this.opts.autosave.method, {\n            url: this.opts.autosave.url,\n            data: data,\n            before: function(xhr) {\n                var event = this.app.broadcast('autosave.before.send', { xhr: xhr, name: name, data: data });\n                if (event.isStopped()) {\n                    return false;\n                }\n            }.bind(this),\n            success: function(response) {\n                this._complete(response, name, data);\n            }.bind(this)\n        });\n    },\n    _complete: function(response, name, data) {\n        var callback = (response && response.error) ? 'autosave.error' : 'autosave.send';\n        this.app.broadcast(callback, { name: name, data: data, response: response });\n    }\n});\nArticleEditor.add('module', 'statusbar', {\n    init: function() {\n        this.classname = this.prefix + '-statusbar';\n    },\n    start: function() {\n        this._build();\n    },\n    add: function(name, html) {\n        return this.update(name, html);\n    },\n    update: function(name, html) {\n        var $item = this.get(name);\n        if ($item.length === 0) {\n            $item = this._buildItem(name);\n        }\n\n        return $item.html(html);\n    },\n    get: function(name) {\n        var s = (name) ? '[data-name=' + name + ']' : '[data-name]';\n        return this.$statusbar.find(s);\n    },\n    remove: function(name) {\n        this.get(name).remove();\n    },\n    clear: function() {\n        this.$statusbar.html('');\n    },\n\n    // private\n    _build: function() {\n        this.$statusbar = this.dom('<div>').attr('dir', this.opts.editor.direction);\n        this.$statusbar.addClass(this.classname + ' ' + this.classname + '-' + this.uuid);\n\n        this.app.container.get('statusbar').append(this.$statusbar);\n    },\n    _buildItem: function(name) {\n        var $item = this.dom('<span>').addClass(this.classname + '-item');\n        $item.attr('data-name', name);\n\n        // append\n        this.$statusbar.append($item);\n\n        return $item;\n    }\n});\nArticleEditor.add('module', 'shortcut', {\n    init: function() {\n        // remove\n        if (this.opts.shortcutsRemove) {\n            var keys = this.opts.shortcutsRemove;\n            for (var i = 0; i < keys.length; i++) {\n                this.remove(keys[i]);\n            }\n        }\n\n        // local\n        this.shortcuts = this.opts.shortcuts;\n\n        // based on https://github.com/jeresig/jquery.hotkeys\n        this.hotkeys = {\n            8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n            188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n        };\n\n        this.hotkeysShiftNums = {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        };\n    },\n    add: function(keys, obj) {\n        this.shortcuts[keys] = obj;\n    },\n    remove: function(keys) {\n        this.opts.shortcutsBase = this._remove(keys, this.opts.shortcutsBase);\n        this.opts.shortcuts = this._remove(keys, this.opts.shortcuts);\n    },\n    popup: function(params, button) {\n\n        var meta = (/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) ? '<b>&#8984;</b>' : 'ctrl';\n        var items = {};\n        var z = 0;\n\n        // items\n        z = this._buildPopupItems(items, z, this.opts.shortcutsBase, meta, 'base');\n        this._buildPopupItems(items, z, this.opts.shortcuts, meta);\n\n        // create\n        this.app.popup.create('shortcuts', {\n            width: '360px',\n            items: items\n        });\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    handle: function(e) {\n        this.triggered = false;\n\n        // disable browser's hot keys for bold and italic if shortcuts off\n        if (this.shortcuts === false) {\n            if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) {\n                e.preventDefault();\n            }\n            return true;\n        }\n\n        // build\n        if (e.ctrlKey || e.metaKey || e.shoftKey || e.altKey) {\n            for (var key in this.shortcuts) {\n                if (this.shortcuts.hasOwnProperty(key)) {\n                    this._build(e, key, this.shortcuts[key]);\n                }\n            }\n        }\n\n        return (this.triggered);\n    },\n\n    // private\n    _buildPopupItems: function(items, z, shortcuts, meta, type) {\n        for (var key in shortcuts) {\n            if (shortcuts.hasOwnProperty(key)) {\n                var $item = this.dom('<div>').addClass(this.prefix + '-popup-shortcut-item');\n                var title = (type === 'base') ? shortcuts[key] : shortcuts[key].title;\n\n                var $title = this.dom('<span>').addClass(this.prefix + '-popup-shortcut-title').html(this.lang.parse(title));\n                var $kbd = this.dom('<span>').addClass(this.prefix + '-popup-shortcut-kbd');\n\n                var name = (type === 'base') ? key.replace('meta', meta) : shortcuts[key].name.replace('meta', meta);\n                var arr = name.split('+');\n                for (var i = 0; i < arr.length; i++) {\n                    arr[i] = '<span>' + arr[i] + '</span>';\n                }\n                $kbd.html(arr.join('+'));\n\n                $item.append($title);\n                $item.append($kbd);\n\n                items[z] = { html: $item };\n\n                z++;\n            }\n        }\n\n        return z;\n    },\n    _build: function(e, str, obj) {\n        var keys = str.split(',');\n        var len = keys.length;\n        for (var i = 0; i < len; i++) {\n            if (typeof keys[i] === 'string' && !Object.prototype.hasOwnProperty.call(obj, 'trigger')) {\n                this._handler(e, keys[i].trim(), obj);\n            }\n        }\n    },\n    _handler: function(e, keys, obj) {\n        keys = keys.toLowerCase().split(\" \");\n\n        var special = this.hotkeys[e.keyCode];\n        var character = (e.which !== 91) ? String.fromCharCode(e.which).toLowerCase() : false;\n        var modif = \"\", possible = {};\n        var cmdKeys = [\"meta\", \"ctrl\", \"alt\", \"shift\"];\n\n        for (var i = 0; i < cmdKeys.length; i++) {\n            var specialKey = cmdKeys[i];\n            if (e[specialKey + 'Key'] && special !== specialKey) {\n                modif += specialKey + '+';\n            }\n        }\n\n        // right cmd\n        if (e.keyCode === 93) {\n            modif += 'meta+';\n        }\n\n        if (special) possible[modif + special] = true;\n        if (character) {\n            possible[modif + character] = true;\n            possible[modif + this.hotkeysShiftNums[character]] = true;\n\n            // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n            if (modif === \"shift+\") {\n                possible[this.hotkeysShiftNums[character]] = true;\n            }\n        }\n\n        var len = keys.length;\n        for (var z = 0; z < len; z++) {\n            if (possible[keys[z]]) {\n\n                e.preventDefault();\n                this.triggered = true;\n\n                this.app.api(obj.command, obj.params, e);\n                return;\n            }\n        }\n    },\n    _remove: function(keys, obj) {\n        return Object.keys(obj).reduce(function(object, key) {\n            if (key !== keys) { object[key] = obj[key]; }\n            return object;\n        }, {});\n    }\n});\nArticleEditor.add('module', 'offset', {\n    get: function(el) {\n        el = this._getEl(el);\n\n        var sel = this.app.editor.getWinNode().getSelection();\n        var offset = false;\n\n        if (sel && sel.rangeCount > 0) {\n            var range = sel.getRangeAt(0);\n            if (el.contains(sel.anchorNode)) {\n                var cloned = range.cloneRange();\n                cloned.selectNodeContents(el);\n                cloned.setEnd(range.startContainer, range.startOffset);\n\n                var start = cloned.toString().length;\n                offset = {\n                    start: start,\n                    end: start + range.toString().length\n                };\n            }\n        }\n\n        return offset;\n    },\n    set: function(el, offset) {\n        if (offset === false) {\n            offset = { start: 0, end: 0 };\n        }\n\n        el = this._getEl(el);\n\n        var charIndex = 0, range = this.app.editor.getDocNode().createRange();\n        var nodeStack = [el], node, foundStart = false, stop = false;\n\n        range.setStart(el, 0);\n        range.collapse(true);\n\n        while (!stop && (node = nodeStack.pop())) {\n            if (node.nodeType === 3) {\n                var nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && offset.start >= charIndex && offset.start <= nextCharIndex) {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex) {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n\n                charIndex = nextCharIndex;\n            }\n            else {\n                var i = node.childNodes.length;\n                while (i--) {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        this.app.selection.setRange(range);\n    },\n\n    // private\n    _getEl: function(el) {\n        return (!el) ? this.app.editor.getLayout().get() : this.dom(el).get();\n    }\n});\nArticleEditor.add('module', 'marker', {\n    build: function(pos) {\n        var $marker = this.dom('<span>').attr('id', 'selection-marker-' + pos);\n        $marker.addClass(this.prefix + '-selection-marker');\n        $marker.html(this.opts.markerChar);\n\n        return $marker.get();\n    },\n    insert: function() {\n        this.remove();\n\n        var sel = this.app.selection.get();\n        var both = (!sel.collapsed);\n\n        if (!sel.range) return;\n\n        var start = this.build('start');\n        var end = this.build('end');\n\n        var cloned = sel.range.cloneRange();\n\n        if (both) {\n            cloned.collapse(false);\n            cloned.insertNode(end);\n        }\n\n        cloned.setStart(sel.range.startContainer, sel.range.startOffset);\n        cloned.collapse(true);\n        cloned.insertNode(start);\n\n        sel.range.setStartAfter(start);\n\n        if (both) {\n            sel.range.setEndBefore(end);\n        }\n\n        this.app.selection.setRange(sel.range);\n    },\n    restore: function() {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        var sel = this.app.selection.get();\n        var range = (sel.range) ? sel.range : this.app.editor.getDocNode().createRange();\n\n        if (start) {\n            var prev = (end) ? end.previousSibling : false;\n            var next = start.nextSibling;\n            next = (next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, '') === '') ? false : next;\n\n            if (!end) {\n                if (next) {\n                    range.selectNodeContents(next);\n                    range.collapse(true);\n                }\n                else {\n                    this._restoreInject(range, start);\n                }\n            }\n            else if (next && next.id === 'selection-marker-end') {\n                this._restoreInject(range, start);\n            }\n            else {\n                if (prev && next) {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStart(next, 0);\n                }\n                else if (prev && !next) {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStartAfter(start);\n                }\n                else {\n                    range.setStartAfter(start);\n                    range.setEndBefore(end);\n                }\n            }\n\n            this.app.selection.setRange(range);\n\n            var fix = (start && end) ? 2 : 1;\n            var offset = this.app.offset.get();\n            offset = {\n                start: offset.start-fix,\n                end: offset.end-fix\n            };\n\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n\n            this.app.editor.setWinFocus();\n            this.app.offset.set(false, offset);\n        }\n    },\n    find: function(pos) {\n        var $editor = this.app.editor.getLayout();\n        var $marker = $editor.find('#selection-marker-' + pos);\n\n        return ($marker.length !== 0) ? $marker.get() : false;\n    },\n    remove: function() {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        if (start) start.parentNode.removeChild(start);\n        if (end) end.parentNode.removeChild(end);\n    },\n\n    // private\n    _restoreInject: function(range, start) {\n        var textNode = this.app.utils.createInvisibleChar();\n        this.dom(start).after(textNode);\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n    }\n});\nArticleEditor.add('module', 'state', {\n    init: function() {\n        this.started = false;\n        this.storage = false;\n        this.state = false;\n        this.passed = true;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    load: function() {\n        this.clear();\n        this.trigger(true);\n    },\n    stop: function() {\n        this.clear();\n    },\n    clear: function() {\n        this.storage = false;\n        this.state = false;\n        this.passed = true;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    get: function() {\n        return this.undoStorage;\n    },\n    add: function(e) {\n        if ((e && (e.ctrlKey || e.metaKey || this._isUndo(e) || this._isRedo(e))) || !this.app.observer.trigger) {\n            return;\n        }\n\n        // state\n        this.state = this._createState();\n        if (this.started === false) {\n            this._setState(this.state, 0);\n            this.started = true;\n        }\n    },\n    trigger: function(start) {\n        if (!this.passed) {\n            return;\n        }\n\n        // storage\n        var storage = this._createState();\n\n        // storage\n        if (this.state) {\n            storage = this.state;\n        }\n        else if (!this.state && !start) {\n            storage = this.storage;\n            this.started = true;\n        }\n\n        this._addState(storage);\n\n        // previous state\n        this.storage = this._createState();\n        this.state = false;\n    },\n    listen: function(e) {\n        // undo\n        if (this._isUndo(e)) {\n            e.preventDefault();\n            this.undo();\n            return true;\n        }\n        // redo\n        else if (this._isRedo(e)) {\n            e.preventDefault();\n            this.redo();\n            return true;\n        }\n\n        this.passed = true;\n    },\n    undo: function() {\n        if (!this._hasUndo()) return;\n\n        this.passed = false;\n        var state = this._getUndo();\n        this._setRedo();\n\n        var $parsed = this.app.parser.parse(state[0]);\n        this.app.editor.getLayout().html($parsed.children());\n        this._rebuild(state, 'undo');\n\n        var instance = this.app.block.get();\n        var el = (instance && instance.isEditable()) ? instance.getBlock() : false;\n\n        this.app.offset.set(el, state[1]);\n    },\n    redo: function() {\n        if (!this._hasRedo()) return;\n\n        this.passed = false;\n        var state = this.redoStorage.pop();\n\n        this._addState({\n            html: state[0],\n            offset: state[1]\n        });\n\n        var $parsed = this.app.parser.parse(state[0]);\n        this.app.editor.getLayout().html($parsed.children());\n        this._rebuild(state, 'redo');\n\n        var instance = this.app.block.get();\n        var el = (instance && instance.isEditable()) ? instance.getBlock() : false;\n\n        this.app.offset.set(el, state[1]);\n\n    },\n\n    // private\n    _rebuild: function(state, type) {\n        this.app.editor.build();\n        this.app.editor.getLayout().find('.' + this.prefix + '-block-state').each(function($node) {\n            this.app.block.set($node);\n        }.bind(this));\n\n        this.app.broadcast('state.' + type, { html: state[0], offset: state[1] });\n    },\n    _isUndo: function(e) {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && key === 90 && !e.shiftKey && !e.altKey);\n    },\n    _isRedo: function(e) {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && ((key === 90 && e.shiftKey) || (key === 89 && !e.shiftKey)) && !e.altKey);\n    },\n    _hasUndo: function() {\n        return (this.undoStorage.length !== 0);\n    },\n    _hasRedo: function() {\n        return (this.redoStorage.length !== 0);\n    },\n    _getUndo: function() {\n        return (this.undoStorage.length === 1) ? this.undoStorage[0] : this.undoStorage.pop();\n    },\n    _createState: function() {\n        var html = this.app.editor.getLayout().html();\n        html = this.app.utils.wrap(html, function($w) {\n            $w.find('.' + this.prefix + '-block-focus').addClass(this.prefix + '-block-state');\n        }.bind(this));\n\n        var instance = this.app.block.get();\n        var el = (instance && instance.isEditable()) ? instance.getBlock() : false;\n        var unparsed = this.app.parser.unparse(html, true);\n        var offset = this.app.offset.get(el);\n\n        return { html: unparsed, offset: offset };\n    },\n    _setState: function(state, pos) {\n        this.undoStorage[pos] = [state.html, state.offset];\n    },\n    _addState: function(state) {\n        var last = this.undoStorage[this.undoStorage.length-1];\n        if (typeof last === 'undefined' || last[0] !== state.html) {\n            this.undoStorage.push([state.html, state.offset]);\n            this._removeOverStorage();\n        }\n        else {\n            last[1] = state.offset;\n        }\n    },\n    _setRedo: function() {\n        var state = this._createState();\n\n        this.redoStorage.push([state.html, state.offset]);\n        this.redoStorage = this.redoStorage.slice(0, this.opts.state.limit);\n    },\n    _removeOverStorage: function() {\n        if (this.undoStorage.length > this.opts.state.limit) {\n            this.undoStorage = this.undoStorage.slice(0, (this.undoStorage.length - this.opts.state.limit));\n        }\n    }\n});\nArticleEditor.add('module', 'sync', {\n    build: function() {\n        this.syncedHtml = this.app.$element.val();\n    },\n    trigger: function() {\n        if (!this.opts.editor.sync) return;\n\n        if (this.typingTimer) {\n            clearTimeout(this.typingTimer);\n        }\n        this.typingTimer = setTimeout(function() {\n            var html = this._getHtml();\n            if (this.is(html)) {\n                this._sync(html);\n            }\n        }.bind(this), 300);\n    },\n    invoke: function() {\n        var html = this._getHtml();\n        this.syncedHtml = html;\n        this._sync(html);\n    },\n    is: function(html) {\n        var sync = false;\n        if (this.syncedHtml !== html) {\n            this.syncedHtml = html;\n            sync = true;\n        }\n\n        return sync;\n    },\n\n    // private\n    _getHtml: function() {\n        var html = this.app.editor.getLayout().html();\n        return this.app.parser.unparse(html);\n    },\n    _sync: function(html) {\n        var event = this.app.broadcast('editor.before.change', { html: html });\n        if (!event.isStopped()) {\n            this.app.$element.val(event.get('html'));\n            this.app.autosave.send();\n            this.app.state.trigger();\n            this.app.broadcast('editor.change', event);\n        }\n    }\n});\nArticleEditor.add('module', 'placeholder', {\n    start: function() {\n        this.placeholder = false;\n        this.$layout = this.app.editor.getLayout();\n\n        // build\n        this._build();\n    },\n    handleClick: function(e) {\n        if (this.dom(e.target).hasClass(this.prefix + '-placeholder')) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.app.editor.setFocus('start');\n        }\n    },\n    trigger: function() {\n        if (this.placeholder && this.app.editor.isEmpty(true)) {\n            this.show();\n        }\n        else {\n            this.hide();\n        }\n    },\n    toggle: function() {\n        if (this.observerTimer) {\n            clearTimeout(this.observerTimer);\n        }\n        this.observerTimer = setTimeout(this.trigger.bind(this), 10);\n    },\n    show: function() {\n        this.$layout.addClass(this.prefix + '-placeholder');\n    },\n    hide: function() {\n        this.$layout.removeClass(this.prefix + '-placeholder');\n    },\n    change: function(value) {\n        this.opts.placeholder = value;\n        this._rebuild();\n        if (this.app.editor.isEmpty(true)) {\n            this.app.editor.setEmpty();\n        }\n    },\n\n    // private\n    _build: function() {\n        this._rebuild()\n        this.toggle();\n    },\n    _rebuild: function() {\n        var o = this.opts.placeholder;\n        var p = this.app.$element.attr('placeholder');\n        var is = (o !== false || p);\n        if (!is) return;\n\n        this.$layout.attr('placeholder', (o !== false) ? o : p);\n        this.placeholder = true;\n    }\n});\nArticleEditor.add('module', 'list', {\n    indent: function() {\n\n        var sel = this.app.selection.get();\n        var item = this.app.selection.getBlock();\n        var $item = this.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (sel.collapsed && item && prev && prev.tagName === 'LI');\n\n        this.app.selection.save(item);\n\n        if (isIndent) {\n            $prev = this.dom(prev);\n            var $prevChild = $prev.children('ul, ol');\n            var $list = $item.closest('ul, ol');\n\n            if ($prevChild.length !== 0) {\n                $prevChild.append($item);\n            }\n            else {\n                var listTag = $list.get().tagName.toLowerCase();\n                var $newList = this.dom('<' + listTag + '>');\n\n                $newList.append($item);\n                $prev.append($newList);\n            }\n        }\n\n        this.app.selection.restore();\n\n        return isIndent;\n    },\n    outdent: function() {\n\n        var sel = this.app.selection.get();\n        var item = this.app.selection.getBlock();\n        var $item = this.dom(item);\n        var isOutdent = false;\n\n        if (sel.collapsed && item) {\n\n            var $listItem = $item.parent();\n            var $liItem = $listItem.closest('li');\n            var $prev = $item.prevElement();\n            var $next = $item.nextElement();\n            var prev = $prev.get();\n            var next = $next.get();\n            var nextItems, $newList;\n            var isTop = (prev === false);\n            var isMiddle = (prev !== false && next !== false);\n\n            this.app.selection.save(item);\n\n            // out\n            if ($liItem.length !== 0) {\n                if (isMiddle) {\n                    nextItems = this._getAllNext($item.get());\n                    $newList = this.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n\n                    for (var i = 0; i < nextItems.length; i++) {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $liItem.after($item);\n                    $item.append($newList);\n                }\n                else {\n                    $liItem.after($item);\n\n                    if ($listItem.children().length === 0) {\n                        $listItem.remove();\n                    }\n                    else {\n                        if (isTop) $item.append($listItem);\n                    }\n                }\n\n                isOutdent = true;\n            }\n\n            this.app.selection.restore();\n        }\n\n        return isOutdent;\n    },\n\n    // private\n    _getAllNext: function(next) {\n        var nodes = [];\n\n        while (next) {\n            var $next = this.dom(next).nextElement();\n            next = $next.get();\n\n            if (next) nodes.push(next);\n            else return nodes;\n        }\n\n        return nodes;\n    }\n});\nArticleEditor.add('module', 'cleaner', {\n    cleanHtml: function(html) {\n\n        html = this.app.broadcastHtml('editor.before.clean', html);\n\n        // local\n        var stored = {};\n        var storedIndex = 0;\n        var exceptedTags = this.opts.paste.blockTags.concat(this.opts.paste.inlineTags).concat(this.opts.paste.formTags);\n\n        // gdocs & word\n        var isPages = this._isPages(html);\n        var isMsWord = this._isHtmlMsWord(html);\n        var isEditor = this._isEditor(html);\n\n        // store\n        html = this.app.content.store(html, 'embed', stored, storedIndex);\n\n        // remove doctype tag\n        html = this.app.content.removeDoctype(html);\n\n        // remove denied tags\n        html = this.app.content.removeTags(html, this.opts.tags.denied);\n        html = html.trim();\n\n        // remove comments\n        html = this.app.content.removeComments(html);\n\n        // remove style & script tag\n        html = this.app.content.removeTagsWithContent(html, ['script', 'style']);\n\n        // clean pages\n        html = (isPages) ? this._cleanPages(html) : html;\n\n        // clean gdocs\n        html = (isMsWord) ? html : this._cleanGDocs(html);\n\n        // encode php code\n        html = this._encodePhp(html);\n\n        // remove tags\n        html = this.app.content.removeTagsExcept(html, exceptedTags);\n\n        // clean ms word\n        html = (isMsWord) ? this._cleanMsWord(html) : html;\n\n        var restored = false;\n        // paste event clean embed figure/frame\n        if (!isEditor && this.app.event.pasteEvent) {\n            html = this.app.content.restore(html, 'embed', stored);\n            restored = true;\n        }\n\n        // remove class && attrs if the pasting is not from the editor\n        if (!isEditor) {\n            var filterClass = (this.opts.paste.keepClass.length !== 0) ? this.opts.paste.keepClass.join(',') : '';\n            var filterAttrs = (this.opts.paste.keepAttrs.length !== 0) ? this.opts.paste.keepAttrs.join(',') : '';\n            html = this.app.utils.wrap(html, function($w) {\n                var $elms = $w.find('*');\n                $elms.not(filterClass).removeAttr('class');\n                $elms.not(filterAttrs).each(function($node) {\n                    var node = $node.get();\n                    var attrs = node.attributes;\n\n                    for (var i = attrs.length - 1; i >= 0; i--) {\n                        var name = attrs[i].name;\n\n                        if (name === 'class' || name === 'dir' || name.search(/^data-/) !== -1) continue;\n                        if (node.tagName === 'IMG' && (name === 'src' || name === 'alt')) continue;\n                        if (node.tagName === 'A' && (name === 'href' || name === 'target')) continue;\n\n                        node.removeAttribute(name);\n                    }\n                });\n            });\n        }\n\n        // restore\n        if (!restored) {\n            html = this.app.content.restore(html, 'embed', stored);\n        }\n\n        // work with style\n        if (isEditor) {\n            // cache styles for block and inline tags and img\n            html = this.app.content.cacheStyle(html);\n        }\n        else {\n            // remove style\n            html = this.app.content.removeStyleAttr(html);\n        }\n\n        // remove empty inline\n        html = this.app.content.removeEmptyInlines(html);\n\n        // clean empty\n        html = html.replace(/<figure[^>]*><\\/figure>/gi, '');\n        html = html.replace(/<p>&nbsp;<\\/p>/gi, '<p></p>');\n        html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<p></p>');\n\n        // gmail list paste\n        html = html.replace(/^<li/gi, '<ul><li');\n        html = html.replace(/<\\/li>$/gi, '</li></ul>');\n\n        if (isMsWord || isPages) {\n            html = html.replace(/<p><\\/p>/gi, '');\n            html = html.replace(/<p>\\s<\\/p>/gi, '');\n        }\n\n        html = this.app.utils.wrap(html, function($w) {\n            // clean apple space\n            $w.find('.Apple-converted-space').unwrap();\n\n            // tidy lists\n            // place ul/ol into li\n            $w.find('ul, ol').each(this._placeListToItem.bind(this));\n\n            // remove p in li\n            $w.find('li p').unwrap();\n\n        }.bind(this));\n\n\n        // broadcast\n        return this.app.broadcastHtml('editor.clean', html);\n    },\n\n\n    // private\n    _encodePhp: function(html) {\n        html = html.replace('<?php', '&lt;?php');\n        html = html.replace('<?', '&lt;?');\n        html = html.replace('?>', '?&gt;');\n\n        return html;\n    },\n    _isEditor: function(html) {\n        return html.match(new RegExp('meta\\\\stype=\"' + this.prefix + '-editor\"', 'i'));\n    },\n    _isHtmlMsWord: function(html) {\n        return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n    },\n    _isPages: function(html) {\n        return html.match(/name=\"Generator\"\\scontent=\"Cocoa\\sHTML\\sWriter\"/i);\n    },\n    _placeListToItem: function($node) {\n        var node = $node.get();\n        var prev = node.previousSibling;\n        if (prev && prev.tagName === 'LI') {\n            var $li = this.dom(prev);\n            $li.find('p').unwrap();\n            $li.append(node);\n        }\n    },\n    _cleanPages: function(html) {\n        html = html.replace(/\\sclass=\"s[0-9]\"/gi, '');\n        html = html.replace(/\\sclass=\"p[0-9]\"/gi, '');\n\n        return html;\n    },\n    _cleanGDocs: function(html) {\n        if (html.search(/docs-internal-guid/i) !== -1) {\n            html = this.app.utils.wrap(html, function($w) {\n                var $elms = $w.find('h1, h2, h3, h4, h5, h6');\n                $elms.each(function($node) {\n                    $node.find('span').unwrap();\n                })\n            });\n            html = html.replace(/ dir=\"[^>]*\"/gi, '');\n        }\n\n        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n        html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?(bold|600|700)|font-weight:\\s?(bold|600|700);\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$4</i></b>');\n        html = html.replace(/<span[^>]*font-style:\\s?italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n        html = html.replace(/<span[^>]*font-weight:\\s?(bold|600|700)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$2</b>');\n\n\n        return html;\n    },\n    _cleanMsWord: function(html) {\n\n        // comments\n        html = html.replace(/<!--[\\s\\S]+?-->/gi, '');\n        html = html.trim();\n        html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|meta|link|style|\\w:\\w+)(?=[\\s/>]))[^>]*>/gi, '');\n        html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n        html = html.replace(/&nbsp;/gi, ' ');\n        html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n            return (spaces.length > 0) ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : '';\n        });\n\n        html = this.app.utils.wrap(html, function($w) {\n            // build lists\n            $w.find('p').each(function($node) {\n                var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec($node.attr('style'));\n                if (matches) {\n                    $node.attr('data-listLevel',  parseInt(matches[1], 10));\n                }\n            });\n\n            // parse Lists\n            this._parseWordLists($w);\n\n            $w.find('[align]').removeAttr('align');\n            $w.find('[name]').removeAttr('name');\n            $w.find('span').each(function($node) {\n                var str = $node.attr('style');\n                var matches = /mso-list:Ignore/.exec(str);\n                if (matches) $node.remove();\n                else $node.unwrap();\n            });\n            $w.find('[style]').removeAttr('style');\n            $w.find(\"[class^='Mso']\").removeAttr('class');\n            $w.find('a').filter(function($node) { return !$node.attr('href'); }).unwrap();\n\n        }.bind(this));\n\n        html = html.replace(/<p><img(.*?)>/gi, \"<p><img$1></p><p>\");\n        html = html.replace(/<p[^>]*><\\/p>/gi, '');\n        html = html.replace(/<li>/gi, '<li>');\n        html = html.trim();\n\n        // remove spaces between\n        html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, '/$1>\\n<$2');\n\n        var result = '';\n        var lines = html.split(/\\n/);\n        for (var i = 0; i < lines.length; i++) {\n            var space = (lines[i] !== '' && lines[i].search(/>$/) === -1) ? ' ' : '\\n';\n            result += lines[i] + space;\n        }\n\n        result = result.trim();\n\n        return result;\n    },\n    _parseWordLists: function($w) {\n        var lastLevel = 0;\n        var $item = null;\n        var $list = null;\n        var $listChild = null;\n\n        $w.find('p').each(function($node) {\n            var level = $node.attr('data-listLevel');\n            if (level === null && $node.hasClass('MsoListParagraphCxSpMiddle')) {\n                level = 1;\n            }\n\n            if (level !== null) {\n                var txt = $node.text();\n                var listTag = (/^\\s*\\w+\\./.test(txt)) ? '<ol></ol>' : '<ul></ul>';\n\n                // new parent list\n                if ($node.hasClass('MsoListParagraphCxSpFirst') || $node.hasClass('MsoNormal')) {\n                    $list = this.dom(listTag);\n                    $node.before($list);\n                }\n                // new child list\n                else if (level > lastLevel && lastLevel !== 0) {\n                    $listChild = this.dom(listTag);\n                    $item.append($listChild);\n                    $list = $listChild;\n                }\n                // level up\n                if (level < lastLevel) {\n                    var len = lastLevel - level + 1;\n                    for (var i = 0; i < len; i++) {\n                        $list = $list.parent();\n                    }\n                }\n\n                // create item\n                $node.find('span').first().unwrap();\n                $item = this.dom('<li>' + $node.html().trim() + '</li>');\n                if ($list === null) {\n                    $node.before(listTag);\n                    $list = $node.prev();\n                }\n\n                // append\n                $list.append($item);\n                $node.remove();\n\n                lastLevel = level;\n            }\n            else {\n                $list = null;\n                lastLevel = 0;\n            }\n        }.bind(this));\n    }\n});\nArticleEditor.add('module', 'tidy', {\n    init: function() {},\n    parse: function(code) {\n\n        code = this.app.content.encodeAttrSings(code);\n\n        // clean setup\n        var ownLine = ['li'];\n        var contOwnLine = ['li'];\n        var newLevel = ['p', 'ul', 'ol', 'li', 'div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'figure',\n        'figcaption', 'table', 'thead', 'tbody', 'tfoot', 'tr', 'td', 'th', 'dl', 'dt', 'dd'];\n\n        this.lineBefore = new RegExp('^<(/?' + ownLine.join('|/?' ) + '|' + contOwnLine.join('|') + ')[ >]');\n        this.lineAfter = new RegExp('^<(/?' + ownLine.join('|/?' ) + '|/' + contOwnLine.join('|/') + ')[ >]');\n        this.newLevel = new RegExp('^</?(' + newLevel.join('|' ) + ')[ >]');\n\n        var i = 0,\n        codeLength = code.length,\n        point = 0,\n        start = null,\n        end = null,\n        tag = '',\n        out = '',\n        cont = '';\n\n        this.cleanlevel = 0;\n\n        for (; i < codeLength; i++) {\n            point = i;\n\n            // if no more tags, copy and exit\n            if (-1 === code.substr(i).indexOf('<')) {\n                out += code.substr(i);\n\n                return this.finish(out);\n            }\n\n            // copy verbatim until a tag\n            while (point < codeLength && code.charAt(point) !== '<') {\n                point++;\n            }\n\n            if (i !== point) {\n                cont = code.substr(i, point - i);\n                if (!cont.match(/^\\s{2,}$/g)) {\n                    if ('\\n' === out.charAt(out.length - 1)) out += this.getTabs();\n                    else if ('\\n' === cont.charAt(0)) {\n                        out += '\\n' + this.getTabs();\n                        cont = cont.replace(/^\\s+/, '');\n                    }\n\n                    out += cont;\n                }\n\n                //if (cont.match(/\\n/)) out += '\\n' + this.getTabs();\n            }\n\n            start = point;\n\n            // find the end of the tag\n            while (point < codeLength && '>' !== code.charAt(point)) {\n                point++;\n            }\n\n            tag = code.substr(start, point - start);\n            i = point;\n\n            var t;\n\n            if ('!--' === tag.substr(1, 3)) {\n                if (!tag.match(/--$/)) {\n                    while ('-->' !== code.substr(point, 3)) {\n                        point++;\n                    }\n                    point += 2;\n                    tag = code.substr(start, point - start);\n                    i = point;\n                }\n\n                if ('\\n' !== out.charAt(out.length - 1)) out += '\\n';\n\n                out += this.getTabs();\n                out += tag + '>\\n';\n            }\n            else if ('!' === tag[1]) {\n                out = this.placeTag(tag + '>', out);\n            }\n            else if ('?' === tag[1]) {\n                out += tag + '>\\n';\n            }\n            else if (t === tag.match(/^<(script|style|pre)/i)) {\n                t[1] = t[1].toLowerCase();\n                tag = this.cleanTag(tag);\n                out = this.placeTag(tag, out);\n                end = String(code.substr(i + 1)).toLowerCase().indexOf('</' + t[1]);\n\n                if (end) {\n                    cont = code.substr(i + 1, end);\n                    i += end;\n                    out += cont;\n                }\n            }\n            else {\n                tag = this.cleanTag(tag);\n                out = this.placeTag(tag, out);\n            }\n        }\n\n        return this.finish(out);\n    },\n    getTabs: function() {\n        var s = '';\n        for ( var j = 0; j < this.cleanlevel; j++ ) {\n            s += '    ';\n        }\n\n        return s;\n    },\n    finish: function(code) {\n        code = code.replace(/\\n\\s*\\n/g, '\\n');\n        code = code.replace(/^[\\s\\n]*/, '');\n        code = code.replace(/[\\s\\n]*$/, '');\n        code = code.replace(/<li(.*?)>[\\s\\n]*/gi, '<li$1>');\n        code = code.replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\\s\\n]*<\\/\\1>/gi, '<$1$2></$1>');\n        code = code.replace(/[\\s\\n]*<\\/li>/gi, '</li>');\n        code = code.replace(/<script(.*?)>\\n<\\/script>/gi, '<script$1></script>');\n        code = this.app.content.decodeAttrSings(code);\n\n        this.cleanlevel = 0;\n\n        return code;\n    },\n    cleanTag: function (tag) {\n        var tagout = '';\n        tag = tag.replace(/\\n/g, ' ');\n        tag = tag.replace(/\\s{2,}/g, ' ');\n        tag = tag.replace(/^\\s+|\\s+$/g, ' ');\n\n        var suffix = '';\n        if (tag.match(/\\/$/)) {\n            suffix = '/';\n            tag = tag.replace(/\\/+$/, '');\n        }\n\n        var m;\n        while (m = /\\s*([^= ]+)(?:=((['\"']).*?\\3|[^ ]+))?/.exec(tag)) {\n            if (m[2]) tagout += m[1].toLowerCase() + '=' + m[2];\n            else if (m[1]) tagout += m[1].toLowerCase();\n\n            tagout += ' ';\n            tag = tag.substr(m[0].length);\n        }\n\n        return tagout.replace(/\\s*$/, '') + suffix + '>';\n    },\n    placeTag: function (tag, out) {\n        var nl = tag.match(this.newLevel);\n\n        if (tag.match(this.lineBefore) || nl) {\n            out = out.replace(/\\s*$/, '');\n            out += '\\n';\n        }\n\n        if (nl && '/' === tag.charAt(1)) this.cleanlevel--;\n        if ('\\n' === out.charAt(out.length - 1)) out += this.getTabs();\n        if (nl && '/' !== tag.charAt(1)) this.cleanlevel++;\n\n        out += tag;\n\n        if (tag.match(this.lineAfter) || tag.match(this.newLevel)) {\n            out = out.replace(/ *$/, '');\n            out += '\\n';\n        }\n\n        return out;\n    }\n});\nArticleEditor.add('module', 'source', {\n    start: function() {\n        this.eventname = this.prefix + '-source-events';\n        this._build();\n    },\n    toggle: function() {\n        if (this.is()) this.close();\n        else this.open();\n    },\n    is: function() {\n        return (this.app.container.get('source').css('display') !== 'none');\n    },\n    open: function() {\n        this.app.broadcast('source.before.open');\n\n        var html = this.app.editor.getContent();\n        html = this.app.tidy.parse(html);\n\n        var height = this.app.container.get('editor').height();\n\n        this.$source.height(height);\n        this.$source.val(html);\n        this.$source.on('focus.' + this.eventname, this._handleFocus.bind(this));\n        this.$source.on('input.' + this.eventname, this._handleChanges.bind(this));\n        this.$source.on('keydown.' + this.eventname, this.app.input.handleTextareaTab.bind(this));\n\n        this.app.editor.unselectAll();\n\n        this.app.container.get('editor').hide();\n        this.app.container.get('source').show();\n\n        // codemirror\n        var codemirror = this.app.codemirror.create({ el: this.$source, height: height, focus: true });\n        if (codemirror) {\n            codemirror.on('change', this._handleChanges.bind(this));\n            codemirror.on('focus', this._handleFocus.bind(this));\n        }\n\n        // ui\n        this.app.editor.disableUI();\n        this.app.toolbar.setToggled('html');\n\n        // broadcast\n        this.app.broadcast('source.open');\n    },\n    close: function() {\n        this.app.broadcast('source.before.close');\n\n        var html = this.getContent();\n        this.app.codemirror.destroy();\n\n        this.$source.off('.' + this.eventname);\n\n        this.app.container.get('source').hide();\n        this.app.container.get('editor').show();\n\n        // set code\n        this.app.editor.setContent({ html: html, caret: 'start' });\n\n        // ui\n        this.app.editor.enableUI();\n        this.app.toolbar.unsetToggled('html');\n\n        // broadcast\n        this.app.broadcast('source.close');\n    },\n    update: function(html) {\n        var func = (this.app.editor.isTextarea()) ? 'val' : 'html';\n        this.app.$element[func](html);\n    },\n    getContent: function() {\n        var html = this.$source.val();\n        html = this.app.codemirror.val(html);\n\n        return html;\n    },\n\n    // private\n    _build: function() {\n        if (!this.opts.source) return;\n\n        this.$source = this.dom('<textarea>').addClass(this.prefix + '-source');\n        this.$source.attr('data-gramm_editor', false);\n\n        this.app.container.get('source').append(this.$source);\n    },\n    _handleFocus: function() {\n        this.app.editor.setFocus();\n    },\n    _handleChanges: function(e) {\n        var html = this.getContent();\n\n        this.update(html);\n        this.app.broadcast('source.change', { e: e });\n    }\n});\nArticleEditor.add('module', 'content', {\n    init: function() {\n        this._selectors = {\n            code: ['pre', 'code'],\n            embed: ['figure'],\n            noneditable: ['.' + this.opts.noneditable.classname],\n            images: ['img'],\n            links: ['a']\n        };\n    },\n\n    // paragraphize\n    paragraphize: function(html) {\n        return this.app.paragraphizer.paragraphize(html);\n    },\n\n    // encode\n    encodeEntities: function(str) {\n        return this.decodeEntities(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n    },\n    encodeCode: function(html) {\n\n        html = this.encodeAttrSings(html);\n\n        // replace all tags\n        html = html.replace(/<\\s/gi, '&lt; ');\n        html = html.replace(/<([^>]+)</gi, '&lt;$1<');\n        html = html.replace(/<(.*?)>/gi, 'xtagstartz$1xtagendz');\n\n        // revert pre / code\n        html = html.replace(/xtagstartzpre(.*?)xtagendz/g, '<pre$1>');\n        html = html.replace(/xtagstartzcode(.*?)xtagendz/g, '<code$1>');\n        html = html.replace(/xtagstartz\\/codextagendz/g, '</code>');\n        html = html.replace(/xtagstartz\\/prextagendz/g, '</pre>');\n\n        // encode\n        html = this._encodeCode(html);\n\n        // revert all tags\n        html = html.replace(/xtagstartz([\\w\\W]*?)xtagendz/g, '<$1>');\n        html = html.replace(/xtagstartz\\/(.*?)xtagendz/g, '</$1>');\n\n        html = this.decodeAttrSings(html);\n\n        return html;\n    },\n    encodeAttrSings: function(html) {\n        var matches = html.match(/=\"(.*?)\"/g);\n        if (matches !== null) {\n            for (var i = 0; i < matches.length; i++) {\n                if (matches[i].search(/^\"</) !== -1 || matches[i].search(/>\"$/) !== -1) {\n                    continue;\n                }\n\n                var str = matches[i].replace('>', 'xmoresignz');\n                str = str.replace('<', 'xlesssignz');\n                html = html.replace(matches[i], str);\n            }\n        }\n\n        return html;\n    },\n\n    // decode\n    decodeAttrSings: function(html) {\n        html = html.replace(/xmoresignz/gi, '>');\n        html = html.replace(/xlesssignz/gi, '<');\n\n        return html;\n    },\n    decodeEntities: function(str) {\n        return String(str).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&amp;/g, '&');\n    },\n    decodeHref: function(html) {\n        var pattern = \"(href=\\\".*?)(&amp;)(.*?\\\">)\";\n        var matches = html.match(new RegExp(pattern, 'g'));\n        if (matches !== null) {\n            for (var i = 0; i < matches.length; i++) {\n                html = html.replace(matches[i], matches[i].replace(/&amp;/g, '&'));\n            }\n        }\n\n        return html;\n    },\n\n    // sanitize\n    sanitize: function(html) {\n        html = this.app.utils.wrap(html, function($w) {\n            $w.find('[src]').each(this._sanitizeSrc);\n            $w.find('a').each(this._sanitizeHref);\n            $w.find('a,b,i,strong,em,svg,img,details,audio').each(this._sanitizeEvents);\n        }.bind(this));\n\n        return html;\n    },\n\n    // escape\n    escapeHtml: function(str) {\n        return str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n    },\n\n    // store / restore\n    store: function(html, name, stored, storedIndex) {\n        var selectors = this._selectors[name];\n        for (var i = 0; i < selectors.length; i++) {\n            var matched = this._getElementsFromHtml(html, selectors[i]);\n            html = this._store(html, name, matched, stored, storedIndex);\n        }\n\n        return html;\n    },\n    restore: function(html, name, stored) {\n        if (typeof stored[name] === 'undefined') return html;\n        for (var i = 0; i < stored[name].length; i++) {\n            html = html.replace('####_' + name + i + '_####', stored[name][i]);\n        }\n\n        return html;\n    },\n    storeComments: function(html, storedComments) {\n        var comments = html.match(new RegExp('<!--([\\\\w\\\\W]*?)-->', 'gi'));\n        if (comments === null) return html;\n\n        for (var i = 0; i < comments.length; i++) {\n            html = html.replace(comments[i], '#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####');\n            storedComments.push(comments[i]);\n        }\n\n        return html;\n    },\n    restoreComments: function(html, storedComments) {\n        for (var i = 0; i < storedComments.length; i++) {\n            var str = storedComments[i].replace(/\\$/gi, '&#36;');\n            html = html.replace('#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####', str);\n        }\n\n        return html;\n    },\n\n    // cache / recache\n    cacheStyle: function(html) {\n        var selector = this.opts.tags.block.join(',') + ',img,' + this.opts.tags.inline.join(',');\n\n        return this.app.utils.wrap(html, function($w) {\n            $w.find(selector).each(this._cacheStyle.bind(this));\n        }.bind(this));\n    },\n    recacheStyle: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('[data-' + this.prefix + '-style-cache]').each(this._recacheStyle.bind(this));\n        }.bind(this));\n    },\n    cacheElementStyle: function($el) {\n        let name = 'data-' + this.prefix + '-style-cache',\n            style = $el.attr('style');\n\n        if (style) {\n            style = style.replace(/\"/g, '');\n            $el.attr(name, style);\n        }\n        else if (!style || style === '') {\n            $el.removeAttr(name);\n        }\n    },\n    recacheElementStyle: function($el) {\n        let name = 'data-' + this.prefix + '-style-cache',\n            style = $el.attr(name);\n\n        $el.attr('style', style).removeAttr(name);\n    },\n\n    // fix\n    fixListMargin: function($block) {\n        var ml = parseInt($block.css('margin-left'));\n        if (ml !== 0) {\n            var pl = parseInt($block.css('padding-left'));\n            $block.css({ 'margin-left': 0, 'padding-left': (pl + ml) + 'px' });\n            $block.attr(this.prefix + '-list-left', ml);\n        }\n    },\n    unfixListMargin: function($block) {\n        if ($block.attr(this.prefix + '-list-left')) {\n            $block.css({ 'padding-left': '', 'margin-left': '' });\n            $block.removeAttr(this.prefix + '-list-left');\n        }\n    },\n\n    // add\n    addNofollow: function(html) {\n        if (!this.opts.link.nofollow) return html;\n\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('a').attr('rel', 'nofollow');\n        });\n    },\n    addHttps: function(html) {\n        if (!this.opts.editor.https) {\n            return html;\n        }\n\n        html = html.replace('href=\"http://', 'href=\"https://');\n        html = html.replace('src=\"http://', 'src=\"https://');\n        html = html.replace('srcset=\"http://', 'srcset=\"https://');\n\n        return html;\n    },\n    addSpaceToBlocks: function(html) {\n        return html.replace(/<\\/(div|li|dt|dd|td|p|H[1-6])>\\n?/gi, '</$1> ');\n    },\n    addBrToBlocks: function(html) {\n        return html.replace(/<\\/(div|li|dt|dd|td|p|H[1-6])>\\n?/gi, '</$1><br>');\n    },\n    addPredefinedTagClass: function($node) {\n        var tag = $node.get().tagName.toLowerCase();\n        var classes = (typeof this.opts.classes.tags !== 'undefined') ? this.opts.classes.tags : this.opts.classes;\n        if (typeof classes[tag] !== 'undefined') {\n            $node.addClass(classes[tag]);\n        }\n    },\n    addPredefinedBlockClass: function($node) {\n        var type = $node.attr('data-' + this.prefix + '-type');\n        var classes = this.opts.classes.blocks;\n        if (typeof classes[type] !== 'undefined') {\n            $node.addClass(classes[type]);\n        }\n    },\n\n    // get\n    getPredefinedBlocks: function() {\n        var blocks = [];\n        Object.keys(this.opts.classes.blocks).forEach(function(key) {\n            blocks.push(key);\n        });\n\n        return blocks;\n    },\n    getPredefinedTags: function() {\n        var tags = [];\n        var classes = (typeof this.opts.classes.tags !== 'undefined') ? this.opts.classes.tags : this.opts.classes;\n        Object.keys(classes).forEach(function(key) {\n            tags.push(key);\n        });\n\n        return tags;\n    },\n    getText: function (n) {\n        var rv = '';\n\n        if (n.nodeType === 3) {\n            rv = n.nodeValue;\n        }\n        else {\n            for (var i = 0; i < n.childNodes.length; i++) {\n                rv += this.getText(n.childNodes[i]);\n            }\n\n            var d = (n.nodeType === 1) ? getComputedStyle(n).getPropertyValue('display') : '';\n            if (d.match(/^block/) || d.match(/list/) || n.tagName === 'BR' || n.tagName === 'HR') {\n                rv += \"\\n\";\n            }\n        }\n\n        return rv;\n    },\n    getTextFromHtml: function(html, params) {\n        var stored = {};\n        var storedIndex = 0;\n        var defaults = {\n            br: false,\n            nl: false,\n            trimlines: true,\n            images: false,\n            links: false\n        };\n\n        params = $ARX.extend({}, defaults, params);\n\n        html = this.store(html, 'code', stored, storedIndex);\n        html = (params.links) ? this.store(html, 'links', stored, storedIndex) : html;\n        html = (params.images) ? this.store(html, 'images', stored, storedIndex) : html;\n\n        html = html.replace(/<(ul|ol)>\\s+<li>/gi, '<$1><li>');\n        html = html.replace(/<li[^>]*>\\n/gi, '<li$1>');\n        html = html.replace(/<p[^>]*>(\\s+|)<\\/p>/gi, 'xemptyz');\n        html = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n        html = html.replace(/<style[\\s\\S]*?style>/gi, '');\n        html = html.replace(/<script[\\s\\S]*?script>/gi, '');\n        html = html.replace(/<\\/(div|li|dt|dd|td|p|H[1-6])>\\n?/gi, '</$1>\\n');\n        html = html.replace(/&(lt|gt);/gi, 'x$1z');\n\n        var $tmp = this.dom('<div>').html(html);\n\n        html = this.getText($tmp.get());\n\n        // trim lines\n        if (params.trimlines) {\n            var str = '';\n            var arr = html.split(\"\\n\");\n            for (var i = 0; i < arr.length; i++) {\n                str += arr[i].trim() + '\\n';\n            }\n            html = str;\n        }\n\n        html = html.replace(/[\\n]+/g, \"\\n\");\n        html = html.replace('xemptyz', \"\\n\");\n        html = html.replace(/x(lt|gt)z/gi, '&$1;');\n\n        // keep newlines\n        if (params.br) {\n            html = html.replace(/\\n/g, \"<br>\\n\");\n            html = html.replace(/<br\\s?\\/?>\\n?$/gi, '');\n        }\n        else {\n            html = (params.nl) ? html : html.replace(/\\n/gi, ' ');\n        }\n\n        html = this.restore(html, 'code', stored);\n        html = (params.links) ? this.restore(html, 'links', stored) : html;\n        html = (params.images) ? this.restore(html, 'images', stored) : html;\n        html = html.replace(/<pre[^>]*>/g, '');\n        html = html.replace(/<code[^>]*>/g, '');\n        html = html.replace(/<\\/pre>\\n?/g, '');\n        html = html.replace(/<\\/code>/g, '');\n\n        if (!params.images) {\n            html = html.replace(/<img[\\s\\S]*?>/gi, '');\n            html = html.replace(/<a[^>]*>(\\s+|)<\\/a>/gi, '');\n        }\n\n        return html.trim();\n\n    },\n\n    // extract\n    extractHtmlFromCaret: function(el) {\n        var node = this.dom(el).get();\n        var range = this.app.selection.getRange();\n        if (range) {\n            var cloned = range.cloneRange();\n            cloned.selectNodeContents(node);\n            cloned.setStart(range.endContainer, range.endOffset);\n\n            return cloned.extractContents();\n        }\n    },\n\n    // is\n    isEmptyHtml: function(html, emptyparagraph) {\n        html = html.trim();\n        html = this.app.utils.removeInvisibleChars(html);\n        html = html.replace(/^&nbsp;$/gi, '1');\n        html = html.replace(/&nbsp;/gi, '');\n        html = html.replace(/<\\/?br\\s?\\/?>/g, '');\n        html = html.replace(/\\s/g, '');\n        html = html.replace(/^<p>\\s\\S<\\/p>$/i, '');\n        html = html.replace(/<hr(.*?[^>])>$/i, 'hr');\n        html = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n        html = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n        // remove comments\n        html = this.removeComments(html);\n\n        // remove empty tags\n        html = (emptyparagraph) ? html.replace(/<p[^>]*><\\/p>/gi, '') : html;\n        html = html.replace(/<[^/>]><\\/[^>]+>/gi, '');\n        html = html.replace(/<[^/>]><\\/[^>]+>/gi, '');\n\n        // trim\n        html = html.trim();\n\n        return (html === '');\n    },\n    isLine: function(html) {\n        var element = document.createElement(\"div\");\n        element.innerHTML = html;\n\n        return (this.dom(element).find(this.opts.tags.block.join(',') + ',img').length === 0);\n    },\n\n    // remove\n    removeDoctype: function(html) {\n        return html.replace(new RegExp(\"<!doctype[^>]*>\", 'gi'), '');\n    },\n    removeComments: function(html) {\n        return html.replace(/<!--[\\s\\S]*?-->\\n?/g, '');\n    },\n    removeTags: function(input, denied) {\n        var re = (denied) ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n        var replacer = (!denied) ? '' : function ($0, $1) {\n            return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n        };\n\n        return input.replace(re, replacer);\n    },\n    removeTagsExcept: function(input, except) {\n        if (except === undefined) {\n            return input.replace(/(<([^>]+)>)/gi, '');\n        }\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n        return input.replace(tags, function($0, $1) {\n            return except.indexOf($1.toLowerCase()) === -1 ? '' : $0;\n        });\n    },\n    removeTagsWithContent: function(html, tags) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find(tags.join(',')).remove();\n        });\n    },\n    removeMarkers: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('.' + this.prefix + '-plus-button').remove();\n            $w.find('.' + this.prefix + 'pastemarker').removeClass(this.prefix + 'pastemarker');\n            $w.find('.' + this.prefix + 'pasteitems').removeClass(this.prefix + 'pasteitems');\n            $w.find('.' + this.prefix + '-selection-marker').remove();\n        }.bind(this));\n    },\n    removeEmptySpans: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('span').each(this._removeEmptySpan.bind(this));\n        }.bind(this));\n    },\n    removeEmptyInlines: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find(this.opts.tags.inline.join(',')).each(this._removeEmptyTag.bind(this));\n        }.bind(this));\n    },\n    removeEmptyAttrs: function(html, attrs) {\n        return this.app.utils.wrap(html, function($w) {\n            for (var i = 0; i < attrs.length; i++) {\n                $w.find('[' + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n            }\n        });\n    },\n    removeBlockTags: function(html, tags, except) {\n        var blocks = this.opts.tags.block.concat();\n\n        // except\n        if (except) {\n            blocks = this.app.utils.removeFromArrayByValue(blocks, except);\n        }\n\n        // extend\n        if (tags) {\n            tags = (tags) ? this.app.utils.extendArray(blocks, tags) : blocks;\n        }\n\n        return this.removeTags(html, tags);\n    },\n    removeBlockTagsInside: function(html, tags) {\n        this.blockListTags = this.app.utils.removeFromArrayByValue(this.opts.tags.block.concat(), ['ul', 'ol', 'li']);\n\n        return this.app.utils.wrap(html, function($w) {\n            $w.find(tags.join(',')).each(this._removeBlockTagsInside.bind(this));\n        }.bind(this));\n    },\n    removeInlineStyles: function(html) {\n        var inlines = this.app.utils.removeFromArrayByValue(this.opts.tags.inline, 'a');\n\n        return this.app.utils.wrap(html, function($w) {\n            $w.find(inlines.join(',')).removeAttr('style');\n        });\n    },\n    removeStyleAttr: function(html, filter) {\n        filter = filter || '';\n\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('*').not('[data-' + this.prefix + '-style-cache]' + filter).removeAttr('style');\n        }.bind(this));\n    },\n\n    // private\n    _cacheStyle: function($el) {\n        var name = 'data-' + this.prefix + '-style-cache';\n        var style = $el.attr('style');\n        if (style) {\n            style = style.replace(/\"/g, '');\n            $el.attr(name, style);\n        }\n        else if (!style || style === '') {\n            $el.removeAttr(name);\n        }\n    },\n    _recacheStyle: function($el) {\n        var name = 'data-' + this.prefix + '-style-cache';\n        var style = $el.attr(name);\n        $el.attr('style', style).removeAttr(name);\n    },\n\n    // clean\n    _cleanEmpty: function(html) {\n        html = html.trim();\n        html = this.app.utils.removeInvisibleChars(html);\n        html = html.replace(/<\\/?br\\s?\\/?>/g, '');\n        html = html.replace(/\\s/g, '');\n\n        return html;\n    },\n\n    // remove\n    _removeEmptySpan: function($node) {\n        if ($node.get().attributes.length === 0) {\n            $node.unwrap();\n        }\n    },\n    _removeEmptyTag: function($node) {\n        var html = $node.html().trim();\n        if ($node.get().attributes.length === 0 && html === '') {\n            $node.unwrap();\n        }\n    },\n    _removeBlockTagsInside: function($node) {\n        var tags = ($node.get().tagName === 'LI') ? this.blockListTags : this.opts.tags.block;\n        $node.find(tags.join(',')).append('<br>').unwrap();\n    },\n\n    // store\n    _store: function(html, name, matched, stored, storedIndex) {\n        if (!matched) return html;\n        if (typeof stored[name] === 'undefined') stored[name] = [];\n\n        for (var i = 0; i < matched.length; i++) {\n            stored[name][storedIndex] = matched[i];\n            html = html.replace(matched[i], '####_' + name + storedIndex + '_####');\n            storedIndex++;\n        }\n\n        return html;\n    },\n\n    // get\n    _getElementsFromHtml: function(html, selector) {\n        var matched = [];\n        var $div = this.dom('<div>').html(html);\n        $div.find(selector).each(function($node) {\n            matched.push($node.get().outerHTML);\n        });\n\n        return matched;\n    },\n\n    // sanitize\n    _sanitizeSrc: function($node) {\n        var node = $node.get();\n        var src = node.getAttribute('src');\n        if (src.search(/^javascript:/i) !== -1 || (node.tagName !== 'IMG' && src.search(/^data:/i) !== -1)) {\n            node.setAttribute('src', '');\n        }\n    },\n    _sanitizeHref: function($node) {\n        var node = $node.get();\n        var str = node.getAttribute('href');\n        if (str && str.search(/^javascript:/i) !== -1) {\n            node.setAttribute('href', '');\n        }\n    },\n    _sanitizeEvents: function($node) {\n        $node.removeAttr('onload onerror ontoggle onwheel onmouseover oncopy');\n    },\n\n    // encode\n    _encodeCode: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('pre code, pre, code').each(this._encodeNode.bind(this));\n        }.bind(this));\n    },\n    _encodeNode: function($node) {\n        var node = $node.get();\n        var first = node.firstChild;\n        var html = node.innerHTML;\n        if (node.tagName === 'PRE' && first && first.tagName === 'CODE') {\n            return;\n        }\n\n        html = html.replace(/xtagstartz/g, '<');\n        html = html.replace(/xtagendz/g, '>');\n\n        var encoded = this.decodeEntities(html);\n        node.textContent = this._encodeNodeHtml(encoded);\n    },\n    _encodeNodeHtml: function(html) {\n        html = html.replace(/&nbsp;/g, ' ').replace(/<br\\s?\\/?>/g, '\\n');\n        html = (this.opts.code.spaces) ? html.replace(/\\t/g, new Array(this.opts.code.spaces + 1).join(' ')) : html;\n\n        return html;\n    }\n});\nArticleEditor.add('module', 'autoparse', {\n    parse: function(html) {\n        if (!this.opts.paste.autoparse) {\n            return html;\n        }\n\n        var instance = this.app.block.get();\n        var storedComments = [];\n\n        // store comments\n        html = this.app.content.storeComments(html, storedComments);\n\n        // remove doctype tag\n        html = this.app.content.removeDoctype(html);\n\n        var tags = ['figure', 'html', 'form', 'pre', 'div', 'span', 'video', 'object', 'iframe', 'code', 'a', 'img', 'link', 'script'];\n        var singleTags = ['div', 'img', 'html', 'span'];\n        var stored = [];\n        var z = 0;\n        var i;\n\n        // store tags\n        for (i = 0; i < tags.length; i++) {\n            var reTags = (singleTags.indexOf(tags[i]) !== -1) ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '[^>]*>([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null) {\n                for (var y = 0; y < matched.length; y++) {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // links\n        html = html.replace('&amp;', '&');\n        if ((html.match(this.opts.regex.aurl1) || html.match(this.opts.regex.aurl2)) && !html.match(this.opts.regex.imageurl)) {\n            html = this._formatLinks(html);\n        }\n\n        // images\n        if (html.match(this.opts.regex.imageurl)) {\n            var imagesMatches = html.match(this.opts.regex.imageurl);\n            for (i = 0; i < imagesMatches.length; i++) {\n                html = html.replace(imagesMatches[i], this._splitBlock(instance, '<img src=\"' + imagesMatches[i] + '\">'));\n            }\n        }\n\n        // restore\n        html = this._restoreReplaced(stored, html);\n        html = this.app.content.restoreComments(html, storedComments);\n\n        // repeat for nested tags\n        html = this._restoreReplaced(stored, html);\n\n        return html;\n    },\n\n    // private\n    _splitBlock: function(instance, str) {\n        return (instance) ? str = \"\\n\" + str + \"\\n\" : str;\n    },\n    _formatLinks: function(content) {\n        var target = (this.opts.paste.linkTarget !== false) ? ' target=\"' + this.opts.paste.linkTarget + '\"' : '';\n        var protocol = (this.opts.editor.https) ? 'https' : 'http';\n        var self = this;\n\n        content = content.replace(this.opts.regex.aurl1, function(url) {\n            return '<a href=\"' + url + '\"' + target + '>' + self._subLinkText(url) + '</a>';\n        });\n\n        content = content.replace(this.opts.regex.aurl2, function(match, before, url) {\n            return before + '<a href=\"' + protocol + '://' + url + '\"' + target + '>' + self._subLinkText(url) + '</a>';\n        });\n\n        return content;\n    },\n    _subLinkText: function(text) {\n        text = (text.length > this.opts.link.size) ? text.substring(0, this.opts.link.size) + '...' : text;\n        text = (text.search('%') === -1) ? decodeURIComponent(text) : text;\n\n        return text;\n    },\n    _restoreReplaced: function(stored, html) {\n        for (var i = 0; i < stored.length; i++) {\n            html = html.replace('#####replaceparse' + i + '#####', stored[i]);\n        }\n\n        return html;\n    }\n});\nArticleEditor.add('module', 'caret', {\n    set: function(el, type) {\n        var node = this.dom(el).get();\n        var range = this.app.editor.getDocNode().createRange();\n        var map = { 'start': '_setStart', 'end': '_setEnd', 'before': '_setBefore', 'after': '_setAfter' };\n\n        if (!node || !this._isInPage(node)) {\n            return;\n        }\n\n        // focus\n        this.app.editor.setWinFocus();\n\n        // non editable inline node\n        if (this._isInline(node) && this._isNon(node)) {\n            if (type === 'start') type = 'before';\n            else if (type === 'end') type = 'after';\n        }\n\n        // set\n        this[map[type]](range, node);\n        this.app.selection.setRange(range);\n    },\n    is: function(el, type, removeblocks, trimmed, br) {\n        var node = this.dom(el).get();\n        var sel = this.app.editor.getWinNode().getSelection();\n        var result = false;\n\n        if (!node || !sel.isCollapsed) {\n            return result;\n        }\n\n        var position = this._getPosition(node, trimmed, br);\n        var size = this._getSize(node, removeblocks, trimmed);\n\n        if (type === 'end') {\n            result = (position === size);\n        }\n        else if (type === 'start') {\n            result = (position === 0);\n        }\n\n        return result;\n    },\n\n    // private\n    _setStart: function(range, node) {\n        range.setStart(node, 0);\n        range.collapse(true);\n\n        // block node has first inline\n        var inline = this._getInlineInside(node);\n        if (inline) {\n            range = this._setStartInline(range, inline);\n        }\n\n        // inline node\n        if (this._isInline(node)) {\n            this._insertInvisibleNode(range);\n        }\n    },\n    _setStartInline: function(range, inline) {\n        var inlines = this.app.element.getAllInlines(inline);\n        var node = inlines[0];\n        range.selectNodeContents(node);\n        range.collapse(true);\n    },\n    _setEnd: function(range, node) {\n\n        // block node has last inline\n        var last = (node.nodeType === 1) ? node.lastChild : false;\n        var lastInline = (last && this._isInline(last));\n        if (lastInline) {\n            node = last;\n        }\n\n        range.selectNodeContents(node);\n        range.collapse(false);\n    },\n    _setBefore: function(range, node) {\n        range.setStartBefore(node);\n        range.collapse(true);\n\n        // inline node\n        if (this._isInline(node)) {\n            this._insertInvisibleNode(range, node);\n        }\n    },\n    _setAfter: function(range, node) {\n        range.setStartAfter(node);\n        range.collapse(true);\n\n        // inline node\n        var tag = (node.nodeType !== 3) ? node.tagName.toLowerCase() : false;\n        if (this._isInline(node) || tag === 'br' || tag === 'svg') {\n            this._insertInvisibleNode(range);\n        }\n    },\n    _insertInvisibleNode: function(range, before) {\n        var textNode = this.app.utils.createInvisibleChar();\n\n        if (before) {\n            before.parentNode.insertBefore(textNode, before);\n        }\n        else {\n            range.insertNode(textNode);\n        }\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n\n        return textNode;\n    },\n    _getInlineInside: function(node) {\n        var inline = node.firstChild;\n        if (this._isInline(inline)) {\n            var inside = inline.firstChild;\n            while (inside) {\n                if (this._isInline(inside)) {\n                    return inside;\n                }\n                inside = inside.firstChild;\n            }\n\n            return inline;\n        }\n    },\n    _getSize: function(node, removeblocks, trimmed) {\n        var str;\n        var isTextNode = (node.nodeType === 3);\n\n        if (removeblocks && removeblocks.length !== 0) {\n            var $node = this.dom(node);\n            var $cloned = $node.clone();\n            $cloned.find(removeblocks.join(',')).remove();\n            str = $cloned.html().trim();\n        }\n        else {\n            str = (isTextNode) ? node.textContent : node.innerHTML;\n            str = (isTextNode || trimmed === false) ? str : str.trim();\n        }\n\n        return this._trimmed(str, isTextNode, trimmed).length;\n    },\n    _getPosition: function(node, trimmed, br) {\n        var range = this.app.editor.getWinNode().getSelection().getRangeAt(0);\n        var caretRange = range.cloneRange();\n        var tmp = document.createElement(\"div\");\n        var isTextNode = (node.nodeType === 3);\n\n        caretRange.selectNodeContents(node);\n        caretRange.setEnd(range.endContainer, range.endOffset);\n        tmp.appendChild(caretRange.cloneContents());\n\n        var str = (isTextNode || trimmed === false) ? tmp.innerHTML : tmp.innerHTML.trim();\n        var brEnd = (str.search(/<\\/?br\\s?\\/?>$/g) !== -1) ? 1 : 0;\n        if (br === false) brEnd = 0;\n\n        str = this._trimmed(str, isTextNode, trimmed);\n\n        return str.length + brEnd;\n    },\n    _trimmed: function(str, isTextNode, trimmed) {\n        if (trimmed === false) {\n            str = str.replace(/\\n$/g, '');\n            return str;\n        }\n\n        str = this.app.utils.removeInvisibleChars(str);\n        str = str.replace(/<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi, '');\n        str = str.replace(/\\s+/g, ' ');\n        if (str !== '' && !isTextNode) {\n            str = str.replace(/\\s$/, '');\n        }\n\n        return str;\n    },\n    _isInline: function(node) {\n        return this.app.element.is(node, 'inline');\n    },\n    _isInPage: function(node) {\n        var isIn = false;\n        var doc = this.app.editor.getDocNode();\n        if (node && node.nodeType) {\n            isIn = (node === doc.body) ? false : doc.body.contains(node);\n        }\n\n        return isIn;\n    },\n    _isNon: function(node) {\n        return (node.getAttribute('contenteditable') === 'false');\n    }\n});\nArticleEditor.add('module', 'selection', {\n    init: function() {\n        this.savedSelection = false;\n        this.savedMarker = false;\n        this.savedPosition = false;\n        this.savedRange = false;\n    },\n    // get\n    get: function() {\n        var sel = this._getSelection();\n        var range = this._getRange(sel);\n        var current = this._getCurrent(sel);\n\n        return {\n            selection: sel,\n            range: range,\n            collapsed: this._getCollapsed(sel, range),\n            current: current,\n            parent: this._getParent(current)\n        };\n    },\n    getRange: function() {\n        return this._getRange(this.get().selection);\n    },\n    getNodes: function(data) {\n        var sel = this.get();\n        var isInline = (data && ((data.type && data.type === 'inline') || (data.tags && data.tags.indexOf('a') !== -1)));\n        var func = (isInline) ? '_getAllRangeNodes' : '_getRangeNodes';\n        var nodes = [];\n\n        if (this.app.editor.isAllSelected()) {\n            nodes = this.app.editor.getLayout().children().getAll();\n        }\n        else {\n            nodes = (sel.selection && sel.range) ? this[func](sel.range) : nodes;\n        }\n\n        return (nodes.length > 0) ? this._filterNodes(nodes, sel.range, isInline, data) : nodes;\n    },\n    getCurrent: function() {\n        var sel = this._getSelection();\n        return this._getCurrent(sel);\n    },\n    getParent: function() {\n        var current = this.getCurrent();\n        return this._getParent(current);\n    },\n    getElement: function(el) {\n        return this._getElement(el, 'element');\n    },\n    getInline: function(el) {\n        return this._getElement(el, 'inline');\n    },\n    getTopInline: function(el) {\n        var node = (el) ? this.dom(el).get() : this.getCurrent();\n        var inlines = [];\n        while (node) {\n            if (this._getElement(node, 'inline')) {\n                inlines.push(node);\n            }\n            else {\n                break;\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines[inlines.length-1];\n    },\n    getDataBlock: function(el) {\n        var sel = this._getSelection();\n        var node = el || this._getCurrent(sel);\n\n        if (node) {\n            node = this.dom(node).get();\n            while (node) {\n                if (node.nodeType === 1 && node.getAttribute('data-' + this.prefix + '-type')) {\n                    return this.dom(node);\n                }\n\n                node = node.parentNode;\n            }\n        }\n\n        return this.dom();\n    },\n    getBlock: function(el) {\n        return this._getElement(el, 'block');\n    },\n    getText: function(type, num) {\n        var sel = this.get();\n        var text = false;\n\n        if (!sel.selection) return false;\n        if (type && sel.range) {\n            num = (typeof num === 'undefined') ? 1 : num;\n\n            var el = this.app.editor.getLayout().get();\n            var cloned = sel.range.cloneRange();\n\n            if (type === 'before') {\n                cloned.collapse(true);\n                cloned.setStart(el, 0);\n\n                text = cloned.toString().slice(-num);\n            }\n            else if (type === 'after') {\n                cloned.selectNodeContents(el);\n                cloned.setStart(sel.range.endContainer, sel.range.endOffset);\n\n                text = cloned.toString().slice(0, num);\n            }\n        }\n        else {\n            text = (sel.selection) ? sel.selection.toString() : '';\n        }\n\n        return text;\n    },\n    getHtml: function() {\n        var html = '';\n        var sel = this.get();\n        if (sel.selection) {\n            var cloned = sel.range.cloneContents();\n            var div = document.createElement('div');\n            div.appendChild(cloned);\n            html = div.innerHTML;\n            html = html.replace(/<p><\\/p>$/i, '');\n        }\n\n        return html;\n    },\n    getPosition: function(type) {\n        var range = this.getRange();\n        var pos = { top: 0, left: 0, width: 0, height: 0 };\n        if (this.app.editor.getWinNode().getSelection && range.getBoundingClientRect) {\n            range = range.cloneRange();\n\n            if (type == 'end') {\n                range.setStart(range.endContainer, range.endOffset);\n            }\n            else {\n                var offset = (range.startOffset-1);\n                range.setStart(range.startContainer, (offset < 0) ? 0 : offset);\n            }\n\n            var rect = range.getBoundingClientRect();\n            pos = { top: rect.top, bottom: rect.bottom, left: rect.left, width: (rect.right - rect.left) , height: (rect.bottom - rect.top) };\n        }\n\n        return pos;\n    },\n\n    // set\n    set: function(sel, range) {\n        if (sel) {\n            sel.removeAllRanges();\n            sel.addRange(range);\n        }\n    },\n    setRange: function(range) {\n        this.set(this.app.editor.getWinNode().getSelection(), range);\n    },\n\n    // is\n    is: function(el) {\n        if (typeof el !== 'undefined') {\n            var node = this.dom(el).get();\n            var nodes = this.getNodes();\n\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i] === node) return true;\n            }\n        }\n        else {\n            return this.get().selection;\n        }\n\n        return false;\n    },\n    isCollapsed: function() {\n        var sel = this.get();\n        return this._getCollapsed(sel.selection, sel.range);\n\n    },\n    isIn: function(el) {\n        var node = this.dom(el).get();\n        var current = this.getCurrent();\n\n        return (current && node) ? node.contains(current) : false;\n    },\n    isAll: function(el) {\n        var isEditor = (!el);\n        var node = (el) ? this.dom(el).get() : this.app.editor.getLayout().get();\n        var selection = this.app.editor.getWinNode().getSelection();\n        var range = this._getRange(selection);\n        var isNode = (isEditor) ? true : this.is(node);\n\n        if (selection.isCollapsed) return false;\n\n        if (isNode) {\n            return ((typeof node.textContent !== 'undefined') && (node.textContent.trim().length === range.toString().trim().length));\n        }\n        else {\n            return false;\n        }\n    },\n\n    // select\n    select: function(el) {\n        var node = (el) ? this.dom(el).get() : this.app.editor.getLayout().get();\n        var range = this.app.editor.getDocNode().createRange();\n        range.selectNodeContents(node);\n        this.setRange(range);\n    },\n\n    // remove\n    removeAllRanges: function() {\n        var sel = this._getSelection();\n        if (sel) {\n            sel.removeAllRanges();\n        }\n    },\n\n    // delete\n    deleteContents: function() {\n        var range = this.getRange();\n        if (!this.isCollapsed() && range) {\n            range.deleteContents();\n        }\n    },\n\n    // collapse\n    collapse: function(type) {\n        type = type || 'start';\n        var sel = this.get();\n        if (sel.selection && !sel.collapsed) {\n            if (type === 'start') sel.selection.collapseToStart();\n            else sel.selection.collapseToEnd();\n        }\n    },\n\n    // save & restore\n    save: function(el) {\n        if (!el) {\n            var instance = this.app.block.get();\n            if (instance) {\n                el = instance.getBlock();\n            }\n            else {\n                el = this.app.editor.getLayout();\n            }\n        }\n\n        this.savedSelection = { el: el, offset: this.app.offset.get(el) };\n    },\n    restore: function(set) {\n        if (this.savedMarker) return;\n        if (!this.savedSelection) return;\n\n        // focus\n        this.app.editor.setWinFocus();\n\n        var el = this.savedSelection.el;\n        var instance = this.dom(el).dataget('instance');\n        if (instance && set !== false) {\n            this.app.block.set(el);\n        }\n\n        if (el) {\n            el.focus();\n            this.app.offset.set(el, this.savedSelection.offset);\n        }\n\n        this.savedSelection = false;\n    },\n\n    saveMarker: function() {\n        this.savedMarker = true;\n        this.app.marker.insert();\n    },\n    restoreMarker: function() {\n        this.app.marker.restore();\n        this.savedMarker = false;\n        this.savedSelection = false;\n    },\n\n    // private\n    _getSelection: function() {\n        return this.app.editor.getSelection();\n    },\n    _getRange: function(selection) {\n        return (selection) ? ((selection.rangeCount > 0) ? selection.getRangeAt(0) : false) : false;\n    },\n    _getCurrent: function(selection) {\n        return (selection) ? selection.anchorNode : false;\n    },\n    _getParent: function(current) {\n        return (current) ? current.parentNode : false;\n    },\n    _getElement: function(el, type) {\n        var sel = this._getSelection();\n        if (sel) {\n            var node = el || this._getCurrent(sel);\n            node = this.dom(node).get();\n            while (node) {\n                if (this.app.element.is(node, type)) {\n                    return node;\n                }\n\n                node = node.parentNode;\n            }\n        }\n\n        return false;\n    },\n    _getCollapsed: function(selection, range) {\n        var collapsed = false;\n        if (selection && selection.isCollapsed) collapsed = true;\n        else if (range && range.toString().length === 0) collapsed = true;\n\n        return collapsed;\n    },\n    _getNextNode: function(node) {\n        if (node.firstChild) return node.firstChild;\n\n        while (node) {\n            if (node.nextSibling) return node.nextSibling;\n            node = node.parentNode;\n        }\n    },\n    _getRangeNodes: function(range, all) {\n        var start = range.startContainer.childNodes[range.startOffset] || range.startContainer;\n        var end = range.endContainer.childNodes[range.endOffset] || range.endContainer;\n        var commonAncestor = range.commonAncestorContainer;\n        var nodes = [];\n        var node;\n\n        if (all) {\n            if (!this.app.editor.isLayout(start)) {\n                nodes.push(start);\n            }\n\n            for (node = start.parentNode; node; node = node.parentNode) {\n                if (this.app.editor.isLayout(node)) break;\n                nodes.push(node);\n                if (node === commonAncestor) break;\n            }\n\n            nodes.reverse();\n\n            for (node = start; node; node = this._getNextNode(node)) {\n                if (node.nodeType !== 3 && this.dom(node.parentNode).closest(commonAncestor).length === 0) break;\n\n                nodes.push(node);\n                if (node === end) break;\n            }\n        }\n        else {\n            // push first element\n            if (start.nodeType === 3) {\n                nodes.push(this.getBlock(start));\n            }\n\n            for (node = start; node; node = this._getNextNode(node)) {\n                if (node === commonAncestor) break;\n                if (node.nodeType !== 3 && this.dom(node.parentNode).closest(commonAncestor).length === 0) break;\n\n                nodes.push(node);\n                if (node === end) break;\n            }\n        }\n\n        return nodes;\n    },\n    _getAllRangeNodes: function(range) {\n        return this._getRangeNodes(range, true);\n    },\n    _filterNodes: function(nodes, range, isInline, data) {\n        var selected = this.getText();\n        selected = (selected) ? selected.replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\") : '';\n\n        var finalNodes = [];\n        for (var i = 0; i < nodes.length; i++) {\n\n            var push = true;\n            if (this.app.editor.isLayout(nodes[i])) {\n                push = false;\n            }\n            if (data) {\n                push = (data.types) ? this._filterByTypes(push, data, nodes[i]) : push;\n                push = (data.selected) ? this._filterBySelected(push, data, nodes[i], range, selected) : push;\n                push = (data.type) ? this._filterByType(push, data, nodes[i], isInline) : push;\n                push = (data.tags) ? this._filterByTags(push, data, nodes[i]) : push;\n            }\n\n            if (push) {\n                finalNodes.push(nodes[i]);\n            }\n        }\n\n        // filter blocks\n        var blocks = [];\n        if (data && (data.type === 'blocks' || data.type === 'blocks-first')) {\n\n            for (var z = 0; z < finalNodes.length; z++) {\n                var node;\n\n                if (data.type === 'blocks-first') {\n                    node = (!this.app.element.is(finalNodes[z], 'blocks-first')) ? this.app.element.getFirstLevel(finalNodes[z]).get() : finalNodes[z];\n                }\n                else if (data.type === 'blocks') {\n                    node = (!this.app.element.is(finalNodes[z], 'blocks')) ? this.app.element.getDataBlock(finalNodes[z]).get() : finalNodes[z];\n                }\n\n                if (!this._isInNodesArray(blocks, node)) {\n                    blocks.push(node);\n                }\n            }\n\n            finalNodes = blocks;\n        }\n\n        return finalNodes;\n    },\n    _filterByTypes: function(push, data, node) {\n        var type;\n        if (data.types === true) {\n            type = this.app.element.getType(node);\n            if (!type) {\n                push = false;\n            }\n        }\n        else {\n            type = this.app.element.getType(node);\n            if (data.types.indexOf(type) === -1) {\n                push = false;\n            }\n        }\n\n        return push;\n    },\n    _filterByType: function(push, data, node, isInline) {\n        var type = data.type;\n        if (type === 'blocks' || type === 'blocks-first') {\n            type = 'block';\n        }\n\n        if (isInline) {\n            if (data.links) {\n                if (!this.app.element.is(node, type)) {\n                    push = false;\n                }\n            }\n            else {\n                if ((node.nodeType === 1 && node.tagName === 'A') || !this.app.element.is(node, type)) {\n                    push = false;\n                }\n            }\n        }\n        else if (!this.app.element.is(node, type)) {\n            push = false;\n        }\n\n        return push;\n    },\n    _filterByTags: function(push, data, node) {\n\n        var isTagName = (typeof node.tagName !== 'undefined');\n        if (!isTagName) {\n            push = false;\n        }\n        else if (isTagName && data.tags.indexOf(node.tagName.toLowerCase()) === -1) {\n            push = false;\n        }\n\n        return push;\n    },\n    _filterBySelected: function(push, data, node, range, selected) {\n        if (data.selected === true && !this._containsNodeText(range, node)) {\n            push = false;\n        }\n        else if (data.selected === 'inside') {\n            if (node.nodeType === 1 && node.tagName === 'A') {\n                push = true;\n            }\n            else if (!this._isTextSelected(node, selected)) {\n                push = false;\n            }\n        }\n\n        return push;\n    },\n    _isTextSelected: function(node, selected) {\n        var text = (node.nodeType !== 9) ? this.app.utils.removeInvisibleChars(node.textContent) : '';\n\n        return (\n            selected === text || text.search(selected) !== -1 || selected.search(new RegExp('^' + this.app.utils.escapeRegExp(text) + '$')) !== -1\n        );\n    },\n    _isBackwards: function() {\n        var backwards = false;\n        var sel = this.get();\n\n        if (sel && !sel.collapsed) {\n            var range = this.app.editor.getDocNode().createRange();\n            range.setStart(sel.selection.anchorNode, sel.selection.anchorOffset);\n            range.setEnd(sel.selection.focusNode, sel.selection.focusOffset);\n            backwards = range.collapsed;\n            range.detach();\n        }\n\n        return backwards;\n    },\n    _containsNodeText: function (range, node) {\n        var treeWalker = this.app.editor.getDocNode().createTreeWalker(node, NodeFilter.SHOW_TEXT, { acceptNode: function(node) { return NodeFilter.FILTER_ACCEPT; } }, false);\n        var first, last, textNode;\n        while ((textNode = treeWalker.nextNode())) {\n            if (!first) {\n                first = textNode;\n            }\n            last = textNode;\n        }\n        var nodeRange = range.cloneRange();\n        if (first) {\n            nodeRange.setStart(first, 0);\n            nodeRange.setEnd(last, last.length);\n        }\n        else {\n            nodeRange.selectNodeContents(node);\n        }\n        return (range.compareBoundaryPoints(Range.START_TO_START, nodeRange) < 1 && range.compareBoundaryPoints(Range.END_TO_END, nodeRange) > -1);\n    },\n    _isInNodesArray: function(nodes, node) {\n        return (nodes.indexOf(node) !== -1);\n    }\n});\nArticleEditor.add('module', 'inline', {\n    set(params) {\n        let $nodes = this.dom([]);\n\n        // close\n        this.app.popup.close();\n\n        // params\n        this.params = params || {};\n\n        // normalize style\n        if (this.params.style) {\n            let obj = {};\n            for (let [key, val] of Object.entries(this.params.style)) {\n                let str = key.replace( /([A-Z])/g, \" $1\" );\n                str = str.split(' ').join('-').toLowerCase();\n                obj[str] = val;\n            }\n\n            this.params.style = obj;\n        }\n\n        if (!this.app.selection.getRange()) return;\n\n        if (this.app.selection.isCollapsed()) {\n            $nodes = this._formatCollapsed();\n        }\n        else {\n            $nodes = this._formatUncollapsed();\n        }\n\n        this.app.broadcast('inline.set', { $nodes: $nodes });\n        this.app.sync.trigger();\n        this.app.editor.observeUI();\n        if (this.app.context) {\n            this.app.context.updatePosition();\n        }\n\n        return $nodes;\n    },\n    remove(params) {\n        let inlines = this.app.selection.getNodes({ type: 'inline' }),\n            inline = this.app.selection.getTopInline();\n\n        // make split\n        if (this.app.selection.isCollapsed() && inline) {\n            let tag = inline.tagName.toLowerCase(),\n                $target = this._insertSplit(inline, tag);\n\n            this.app.caret.set($target, 'before');\n            return;\n        }\n\n        // remove\n        this.app.selection.save();\n        if (params.style) {\n            let arr = (Array.isArray(params.style)) ? params.style : [params.style];\n            for (let i = 0; i < inlines.length; i++) {\n                let $el = this.dom(inlines[i]);\n                $el.removeAttr('data-' + this.prefix + '-style-cache');\n                for (let z = 0; z < arr.length; z++) {\n                    $el.css(arr[z], '');\n                }\n                if ($el.attr('style') === '') {\n                    $el.removeAttr('style');\n                }\n                this.app.content.cacheElementStyle($el);\n            }\n        }\n        else if (params.classname) {\n            for (let i = 0; i < inlines.length; i++) {\n                let $el = this.dom(inlines[i]);\n                $el.removeClass(params.classname);\n                if ($el.attr('class') === '') {\n                    $el.removeAttr('class');\n                }\n            }\n        }\n        this.app.selection.restore();\n        if (this.app.context) {\n            this.app.context.updatePosition();\n        }\n    },\n    removeFormat() {\n        this.app.popup.close();\n\n        // instance\n        let instance = this.app.block.get(),\n            $block,\n            nodes,\n            i = 0,\n            $node;\n\n        if (!instance) return;\n\n        // save selection\n        $block = instance.getBlock();\n        this.app.selection.save($block);\n\n        nodes = this.app.selection.getNodes({ type: 'inline' });\n        for (i; i < nodes.length; i++) {\n            $node = this.dom(nodes[i]);\n            if (!$node.attr('data' + this.prefix + '-type')) {\n                $node.unwrap();\n            }\n        }\n\n        // restore selection\n        this.app.selection.restore();\n        this.app.editor.observeUI();\n        if (this.app.context) {\n            this.app.context.updatePosition();\n        }\n    },\n    _formatCollapsed() {\n        let node,\n            inline = this.app.selection.getInline(),\n            $inline = this.dom(inline),\n            tags = this._getTags(),\n            hasSameTag = this._isSameTag(inline, tags),\n            point = (this.params && this.params.caret) ? this.params.caret : false;\n\n        // save\n        this.app.selection.save();\n\n        // 1) not inline\n        if (!inline) {\n            node = this._insertInline(this.params.tag, point);\n            node = this._setParams(node);\n        }\n        // 2) inline is empty\n        else if (inline && this.app.utils.isEmptyHtml(inline.innerHTML)) {\n            // 2.1) has same tag\n            if (hasSameTag) {\n                // 2.2.1) params\n                if (this._isParams()) {\n                    // all the same\n                    if (this._hasAllSameParams(inline)) {\n                        this.app.caret.set(inline, (point) ? point : 'after');\n                        $inline.remove();\n                    }\n                    else if (this._hasSameClassname(inline)) {\n                        this.app.selection.restore();\n                        node = this._setStyle(inline);\n                    }\n                    else if (this._hasSameStyle(inline)) {\n                        this.app.selection.restore();\n                        node = this._setClassname(inline);\n                    }\n                    // not the same\n                    else {\n                        this.app.selection.restore();\n                        node = this._setParams(inline);\n                    }\n                }\n                // 2.2.2) no params\n                else {\n                    this.app.caret.set(inline, (point) ? point : 'after');\n                    $inline.remove();\n                }\n            }\n            // 2.2) has a different tag\n            else {\n                node = this._insertInline(this.params.tag, point);\n                node = this._setParams(node);\n            }\n        }\n        // 3) inline isn't empty\n        else if (inline) {\n            // 3.1) has same tag\n            if (hasSameTag) {\n                // 3.1.1) params\n                if (this._isParams()) {\n                    // all the same\n                    if (this._hasAllSameParams(inline)) {\n                        this._makeSplit(inline, point);\n                    }\n                    else if (this._hasSameClassname(inline)) {\n                        node = this._insertInline(this.params.tag, point);\n                        node = this._setStyle(node);\n                    }\n                    else if (this._hasSameStyle(inline)) {\n                        node = this._insertInline(this.params.tag, point);\n                        node = this._setClassname(node);\n                    }\n                    // not the same\n                    else {\n                        node = this._insertInline(this.params.tag, point);\n                        node = this._setParams(node);\n                    }\n                }\n                // 3.1.2) no params\n                else {\n                    this._makeSplit(inline, point);\n                }\n            }\n            // 3.2) has a different tag\n            else {\n                node = this._insertInline(this.params.tag, point);\n                node = this._setParams(node);\n            }\n        }\n\n        return this.dom(node);\n    },\n    _formatUncollapsed() {\n        let $nodes = false,\n            selectedAll = this.app.editor.isAllSelected(),\n            $blocks = this.dom(this.app.selection.getNodes({ type: 'blocks', partial: true }));\n\n        let inlines = this.app.selection.getNodes({ type: 'inline' });\n\n\n        // convert tags\n        this.app.selection.save();\n        this._convertTags($blocks, inlines);\n        this.app.selection.restore();\n\n        // convert strike\n        this.app.selection.save();\n        this._convertToStrike(inlines);\n        this.app.selection.restore();\n\n        // apply strike\n        this.app.editor.getDocNode().execCommand('strikethrough');\n\n        // revert strike\n        this.app.selection.save();\n        $nodes = this._revertToInlines($blocks);\n        this.app.selection.restore();\n\n        // clean up\n        this._clearEmptyStyle();\n\n        // apply params\n        this.app.selection.save();\n        $nodes.each(this._applyParams.bind(this));\n        this.app.selection.restore();\n\n        // normalize\n        $blocks.each(function($node) {\n            $node.get().normalize();\n        });\n\n        // revert tags\n        this.app.selection.save();\n        this._revertTags($blocks);\n        this.app.selection.restore();\n\n        // caret\n        if (this.params.caret) {\n            let $last = $nodes.last();\n            this.app.caret.set($last, this.params.caret);\n        }\n\n        // all selected\n        if (selectedAll) {\n            this.app.editor.selectAll();\n        }\n\n        return $nodes;\n    },\n\n    // params\n    _isParams() {\n        return (this.params.style || this.params.classname);\n    },\n    _applyParams($node) {\n        let tag = $node.get().tagName.toLowerCase(),\n            tags = this._getTags(),\n            $parent = $node.parent(),\n            hasSameTag = ($parent.length !== 0) ? this._isSameTag($parent.get(), tags) : false;\n\n        if (hasSameTag && $parent.text() === $node.text()) {\n            // parent has same params keys\n            if (this.params.style) {\n                let obj = this.params.style,\n                    parentObj = this.app.utils.cssToObject($parent.attr('style')),\n                    len = Object.keys(obj).length,\n                    size = 0;\n\n                for (let key of Object.keys(obj)) {\n                    if (parentObj[key]) {\n                        size++;\n                    }\n                }\n\n                if (size === len) {\n                    $parent.unwrap();\n                }\n                else {\n                    $node.unwrap();\n                    this._applyParamsToNode($parent, tag)\n                }\n            }\n        }\n\n        this._applyParamsToNode($node, tag);\n    },\n    _applyParamsToNode($node, tag) {\n        $node.removeAttr('data-' + this.prefix + '-style-cache');\n        if ($node.attr('class') === '') $node.removeAttr('class');\n        if ($node.get().attributes.length === 0) {\n            if (this._isParams() && this.params.tag === 'span') {\n                this._setParams($node);\n                this._clearSpanInside($node);\n            }\n            else if (tag === 'span') {\n                $node.unwrap();\n            }\n        }\n        else if (this._isParams()) {\n            this._setParams($node);\n            this._clearSpanInside($node);\n        }\n    },\n    _setParams(el) {\n        el = this._setClassname(el);\n        el = this._setStyle(el);\n\n        return el;\n    },\n    _setClassname(el) {\n        let $node = this.dom(el);\n\n        if (this.params.classname) {\n            // remove group classes\n            if (this.params.group) {\n                let optName = 'inlineGroups.' + this.params.group;\n                let classes = (this.opts.is(optName)) ? this.opts.get(optName) : false;\n                if (classes) {\n                    $node.removeClass(classes.join(' '));\n                }\n            }\n            // remove class\n            else {\n                $node.removeAttr('class');\n            }\n\n            // add class\n            $node.addClass(this.params.classname);\n        }\n\n        return $node.get();\n    },\n    _setStyle(el) {\n        let $node = this.dom(el);\n\n        if (this.params.style) {\n            $node.css(this.params.style);\n            this.app.content.cacheElementStyle($node);\n        }\n\n        return $node.get();\n    },\n    _hasAllSameParams(el) {\n        return (this._hasSameClassname(el) && this._hasSameStyle(el));\n    },\n    _hasSameClassname(el) {\n        let $el = this.dom(el);\n\n        if (this.params.classname) {\n            return $el.hasClass(this.params.classname);\n        }\n\n        return true;\n    },\n    _hasSameStyle(el) {\n        let $el = this.dom(el);\n\n        if (this.params.style) {\n            return this.app.element.compareStyle($el, this.params.style);\n        }\n\n        return true;\n    },\n\n    // insert\n    _makeSplit(inline, point) {\n        let caret = this.app.create('caret'),\n            isEnd = caret.is(inline, 'end'),\n            target = inline;\n\n        if (isEnd) {\n            point = 'after';\n        }\n        else {\n            target = this._insertSplit(inline);\n        }\n\n        caret.set(target, (point) ? point : 'before');\n    },\n    _insertSplit(inline, tag) {\n        let $inline = this.dom(inline),\n            extractedContent = this.app.content.extractHtmlFromCaret(inline),\n            $secondPart = this.dom('<' + (tag || this.params.tag) + ' />'),\n            div = document.createElement(\"div\");\n\n        div.appendChild(extractedContent);\n\n        $secondPart = this.app.element.cloneAttrs(inline, $secondPart);\n        $secondPart.append(div.innerHTML);\n\n        $inline.after($secondPart);\n\n        return $secondPart;\n    },\n    _insertInline(tag, point) {\n        let insertion = this.app.create('insertion');\n\n        return insertion.insertNode(document.createElement(tag), (point) ? point : 'start');\n    },\n\n    // tag\n    _isSameTag(inline, tags) {\n        return (inline && tags.indexOf(inline.tagName.toLowerCase()) !== -1);\n    },\n    _getTags() {\n        let tags = [this.params.tag];\n        if (this.params.tag === 'b' || this.params.tag === 'strong') {\n            tags = ['b', 'strong'];\n        }\n        else if (this.params.tag === 'i' || this.params.tag === 'em') {\n            tags = ['i', 'em'];\n        }\n\n        return tags;\n    },\n\n    // convert\n    _convertToStrike(inlines) {\n        let selected = this.app.selection.getText().replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\"),\n            tags = this._getTags(),\n            inline,\n            $inline,\n            tag,\n            hasSameArgs,\n            convertable = false;\n\n        for (let i = 0 ; i < inlines.length; i++) {\n            inline = inlines[i];\n            $inline = this.dom(inline);\n            tag = inlines[i].tagName.toLowerCase();\n            hasSameArgs  = this._hasAllSameParams(inline);\n\n            if (tags.indexOf(tag) !== -1) {\n\n                if (this.params.tag === 'span' && this._isFullySelected(inline, selected)) {\n                    $inline.addClass('rx-inline-convertable');\n                    $inline.removeAttr('data-' + this.prefix + '-style-cache');\n                }\n                else if (hasSameArgs && this.params.tag !== 'a') {\n                    this._replaceToStrike($inline);\n                }\n                else if (this.params.tag === 'span') {\n                    if (this.params.style && this._hasSameStyle($inline)) {\n                        convertable = true;\n                    }\n                    if (this.params.classname && this._hasSameClassname($inline)) {\n                        convertable = true;\n                    }\n\n                    if (convertable) {\n                        $inline.addClass('rx-inline-convertable');\n                        $inline.removeAttr('data-' + this.prefix + '-style-cache');\n                    }\n                    else {\n                        $inline.addClass('rx-inline-unconvertable');\n                    }\n                }\n                else if (!hasSameArgs) {\n                    $inline.addClass('rx-inline-convertable');\n                    $inline.removeAttr('data-' + this.prefix + '-style-cache');\n                }\n            }\n        }\n    },\n    _convertInlineBlocks($blocks) {\n         $blocks.find('[data-' + this.prefix + '-inline]').each(function($node) {\n            if ($node.attr('contenteditable') === true) {\n                $node.addClass('rx-inlineblock-editable').attr('contenteditable', false);\n            }\n        });\n    },\n    _convertTag(tag, $blocks) {\n        if (this.params.tag !== tag) {\n            $blocks.find(tag).each(function($node) {\n                let $el = this.app.element.replaceToTag($node, 'span');\n                $el.addClass('rx-convertable-' + tag);\n            }.bind(this));\n        }\n        else if (this.params.tag === 'del') {\n            $blocks.find(tag).each(function($node) {\n                this.app.element.replaceToTag($node, 'strike');\n            }.bind(this));\n        }\n    },\n    _convertTags($blocks, inlines) {\n        this._convertTag('del', $blocks);\n        this._convertTag('u', $blocks);\n        this._convertInlineBlocks($blocks);\n    },\n    _replaceToStrike($el) {\n        $el.replaceWith(function() {\n            return this.dom('<strike>').append($el.contents());\n        }.bind(this));\n    },\n    _revertInlineBlocks($blocks) {\n        $blocks.find('.rx-inlineblock-editable').removeClass('rx-inlineblock-editable').attr('contenteditable', true);\n    },\n    _revertTag(tag, $blocks) {\n        $blocks.find('span.rx-convertable-' + tag).each(function(node) {\n            let $el = this.app.element.replaceToTag(node, tag);\n            $el.removeAttr('class');\n        }.bind(this));\n    },\n    _revertTags($blocks) {\n        this._revertTag('u', $blocks);\n        this._revertTag('del', $blocks);\n        this._revertInlineBlocks($blocks);\n    },\n    _revertToInlines($blocks) {\n        let $el,\n            $nodes = this.dom([]);\n\n        if (this.params.tag !== 'u') {\n            $blocks.find('u').unwrap();\n        }\n\n        // styled\n        $blocks.each(function($node) {\n           $node.find('*').each(function(node) {\n               if (node.get().style.textDecorationLine) {\n                   node.css('text-decoration-line', '');\n                   node.wrap('<u>');\n                   if (node.attr('style') === '') {\n                       node.removeAttr('style');\n                   }\n               }\n           });\n        });\n\n        // span convertable\n        $blocks.find('.rx-inline-convertable').each(function($node) {\n            $node.find('strike').each(function($strike) {\n                if ($node.text() === $strike.text()) {\n                    $strike.unwrap();\n                }\n            });\n            $node.removeClass('rx-inline-convertable');\n            this.app.element.removeEmptyAttrs($node, ['class']);\n\n            if (this._hasAllSameParams($node)) {\n                $node.unwrap();\n            }\n            else {\n                $nodes.add($node);\n            }\n\n        }.bind(this));\n\n        // span unconvertable\n        $blocks.find('span.rx-inline-unconvertable').each(function($node) {\n            $node.removeClass('rx-inline-unconvertable');\n            this.app.element.removeEmptyAttrs($node, ['class']);\n\n        }.bind(this));\n\n        // strike\n        $blocks.find('strike').each(function($node) {\n            $node = this.app.element.replaceToTag($node, this.params.tag);\n            $nodes.add($node);\n        }.bind(this));\n\n        return $nodes;\n\n    },\n    _clearEmptyStyle() {\n        let inlines = this.app.selection.getNodes({ type: 'inline' }),\n            i = 0,\n            max = inlines.length,\n            childNodes,\n            z = 0;\n\n        for (i; i < max; i++) {\n            this._clearEmptyStyleAttr(inlines[i]);\n\n            childNodes = inlines[i].childNodes;\n            if (childNodes) {\n                for (z; z < childNodes.length; z++) {\n                    this._clearEmptyStyleAttr(childNodes[z]);\n                }\n            }\n        }\n    },\n    _clearEmptyStyleAttr(node) {\n        if (node.nodeType !== 3 && node.getAttribute('style') === '') {\n            node.removeAttribute('style');\n        }\n    },\n    _clearSpanInside($node) {\n        $node.find('span').each(function($el) {\n            if (this.params.classname) {\n                $el.removeAttr('class');\n            }\n            if (this.params.styles) {\n                for (let key of Object.keys(this.params.styles)) {\n                    $el.css(key, '');\n                }\n            }\n\n            if ($el.attr('class') === '') $el.removeAttr('class');\n            if ($el.attr('style') === '') $el.removeAttr('style');\n\n            if ($el.get().attributes.length === 0) {\n                $el.unwrap();\n            }\n\n        }.bind(this));\n    },\n    _isFullySelected(node, selected) {\n        let text = this.app.utils.removeInvisibleChars(node.textContent);\n\n        return (selected === text || selected.search(new RegExp('^' + this.app.utils.escapeRegExp(text) + '$')) !== -1);\n    }\n});\nArticleEditor.add('module', 'popup', {\n    init: function() {\n        this.stack = false;\n        this.stacks = [];\n        this.name = false;\n        this.supername = false;\n        this.autoclose = true;\n        this.control = false;\n        this.saved = false;\n    },\n    start: function() {\n        this._build();\n        this._buildDepth();\n    },\n    stop: function() {\n        this._stopEvents();\n        this._stop();\n    },\n    stopStack: function() {\n        this._stopEvents();\n        this.app.toolbar.unsetToggled();\n        this.$popup.removeAttr('data-' + this.prefix + '-popup-name');\n        this.$popup.removeClass('open');\n    },\n\n    // is\n    isOpen: function(name) {\n        var opened = this.$popup.hasClass('open');\n        if (name) {\n            return (this._getName() === name && opened);\n        }\n\n        return opened;\n    },\n\n    // create\n    create: function(name, params) {\n        if (this.isOpen(name)) {\n            return this.stack;\n        }\n\n        this._reset();\n        this.name = name;\n        this.supername = name;\n        this.stack = this._createStack(name, params);\n\n        return this.stack;\n    },\n\n    // add\n    add: function(name, params) {\n        return this._createStack(name, params, true);\n    },\n\n    // set\n    setStack: function(stack) {\n        this.stack = stack;\n        this.name = stack.getName();\n    },\n    setData: function(data) {\n        this.stack.setData(data);\n    },\n    setFocus: function(name) {\n        this.stack.setFocus(name);\n    },\n    setWidth: function(width) {\n        this.stack.setWidth(width);\n    },\n\n    // get\n    getName: function() {\n        return this.name;\n    },\n    getElement: function() {\n        return this.$popup;\n    },\n    getButton: function() {\n        return this.button;\n    },\n    getStack: function(name) {\n        return (name) ? this.stacks[name] : this.stack;\n    },\n    getBody: function() {\n        return this.stack.getBody();\n    },\n    getItems: function() {\n        return this.stack.getItems();\n    },\n    getFooter: function() {\n        return this.stack.getFooter();\n    },\n    getFooterPrimary: function() {\n        return this.stack.getFooterPrimary();\n    },\n    getTool: function(name) {\n        return this.stack.getTool(name);\n    },\n    getInput: function(name) {\n        return this.stack.getInput(name);\n    },\n    getFormItem: function(name) {\n        return this.stack.getFormItem(name);\n    },\n    getData: function(name) {\n        return this.stack.getData(name);\n    },\n\n    // open\n    open: function(params) {\n        // all popups are closed\n        if (!this.isOpen()) {\n            this.saved = false;\n            this._open(params);\n        }\n        // current open\n        else if (this.isOpen(this.supername)) {\n            this.saved = true;\n            this.close(false);\n        }\n        // another is opened\n        else {\n            this.saved = true;\n            this.close(false);\n            this._open(params, false);\n        }\n    },\n    openStack: function(name) {\n        var stack = this.getStack(name);\n        var params = {};\n\n        if (this.stack && this.stack.isCollapsed()) {\n            params = { collapse: true };\n            this.removeStack(this.stack);\n        }\n\n        // open\n        stack.open(params);\n    },\n\n    // close\n    close: function(e, name) {\n        if (this.autoclose === false) {\n            if (e === true) {}\n            else if (!name) {\n                return;\n            }\n        }\n        if (!this.isOpen()) return;\n        if (e && this._isPopupTarget(e)) return;\n\n        // close\n        this._stopEvents();\n        this._resetToolbarToggledButton();\n\n        // selection\n        if (e !== false && this.saved === false) {\n            this.app.scroll.save();\n            this.app.selection.restore();\n            this.app.scroll.restore();\n        }\n\n        this.$popup.hide();\n        this._closed();\n    },\n    closeStacks: function() {\n        for (var key in this.stacks) {\n            if (typeof this.stacks[key] === 'object') {\n                this.stacks[key].close();\n            }\n        }\n    },\n\n    // remove\n    removeStack: function(stack) {\n        var name = stack.getName();\n\n        // object\n        delete this.stacks[name];\n\n        // layer\n        this.$popup.find('[data-' + this.prefix + '-stack-name=' + name + ']').remove();\n    },\n\n    // update\n    updatePosition: function(e) {\n        this._buildPosition(e);\n        this._buildHeight();\n    },\n\n    // resize\n    resize: function() {\n        var data = this.$popup.attr('data-width');\n        var width = this.app.editor.getWidth();\n        if (data !== '100%') {\n            var w = parseInt(data);\n            if (w < width) {\n                return;\n            }\n        }\n\n        this.$popup.css('width', width + 'px');\n    },\n\n\n    // =private\n\n    // build\n    _build: function() {\n        this.$popup = this.dom('<div>').addClass(this.prefix + '-popup ' + this.prefix + '-popup-' + this.uuid);\n        this.$popup.hide();\n        this.$popup.attr('dir', this.opts.editor.direction);\n\n        // append\n        this.app.$body.append(this.$popup);\n    },\n    _buildDepth: function() {\n        if (this.opts.bsmodal) {\n            this.$popup.css('z-index', 1061);\n        }\n    },\n    _buildButton: function(params) {\n        if (!params) return;\n        this.button = (Object.prototype.hasOwnProperty.call(params, 'button')) ? params.button : false;\n    },\n    _buildControl: function(params) {\n        if (!params) return;\n        this.control = (Object.prototype.hasOwnProperty.call(params, 'control')) ? params.control : false;\n    },\n    _buildName: function() {\n        this.$popup.attr('data-' + this.prefix + '-popup-name', this.name);\n        this.$popup.addClass(this.prefix + '-popup-' + this.name);\n    },\n    _buildHeader: function() {\n        this.header = this.app.create('popup.header', this);\n    },\n    _buildHeight: function() {\n        var targetHeight, top;\n        var $target = this.app.scroll.getTarget();\n        var tolerance = 10;\n        var offset = this.$popup.offset();\n\n        if (this.app.scroll.isTarget()) {\n            top = offset.top - $target.offset().top;\n            targetHeight = $target.height() - parseInt($target.css('border-bottom-width'));\n        }\n        else {\n            top = offset.top - $target.scrollTop();\n            targetHeight = $target.height();\n        }\n\n        var cropHeight = targetHeight - top - tolerance;\n        this.$popup.css('max-height', cropHeight + 'px');\n    },\n    _buildPosition: function() {\n        var topFix = 1;\n        var pos;\n\n        // control\n        if ((this._isButton() && this.button.isControl()) || this._isControl()) {\n            pos = this._buildPositionControl();\n        }\n        // button\n        else if (this._isButton()) {\n            pos = this._buildPositionButton();\n        }\n        // modal\n        else {\n            pos = this._buildPositionModal();\n        }\n\n        // set\n        this.$popup.css({\n            top: (pos.top - topFix) + 'px',\n            left: pos.left + 'px'\n        });\n    },\n    _buildPositionButton: function() {\n        var editorRect = this.app.editor.getRect();\n        var offset = this.button.getOffset();\n        var dim = this.button.getDimension();\n        var popupWidth = this.$popup.width();\n        var popupHeight = this.$popup.height();\n        var pos = {};\n\n        if (this._isToolbarButton() || this._isTopbarButton()) {\n            pos = {\n                top: (offset.top + dim.height),\n                left: offset.left\n            };\n\n            // out of the right edge\n            if ((pos.left + popupWidth) > editorRect.right) {\n                pos.left = (offset.left + dim.width) - popupWidth;\n            }\n        }\n        else {\n            pos = {\n                top: (offset.top + editorRect.top + dim.height),\n                left: (offset.left + editorRect.left + (dim.width/2) - (popupWidth/2))\n            };\n\n            // out of the right edge\n            if ((pos.left + popupWidth) > editorRect.right) {\n                pos.left = editorRect.left + editorRect.width - popupWidth;\n            }\n\n            // out of the bottom edge\n            if ((pos.top + popupHeight) > this.app.$doc.height()) {\n                pos.top = pos.top - popupHeight - dim.height;\n            }\n        }\n\n        // out of the left edge\n        if (pos.left < editorRect.left || pos.left < 0) {\n            pos.left = editorRect.left;\n        }\n\n        return pos;\n\n    },\n    _buildPositionControl: function() {\n        var instance = this.app.block.get();\n        if (instance.isSecondLevel()) {\n            instance = instance.getFirstLevel();\n        }\n\n        var $block = instance.getBlock();\n        var offset = $block.offset();\n\n        // set\n        return {\n            top: offset.top,\n            left: offset.left\n        };\n    },\n    _buildPositionModal: function() {\n        var offset, top, left;\n        if (!this.opts.toolbar) {\n            var instance = this.app.block.get();\n            if (instance.isSecondLevel()) {\n                instance = instance.getFirstLevel();\n            }\n\n            var $block = instance.getBlock();\n            offset = $block.offset();\n            top = offset.top;\n            left = offset.left;\n        }\n        else {\n            var $container = this.app.container.get('toolbar');\n            var height = $container.height();\n\n            offset = $container.offset();\n            top = offset.top + height;\n            left = offset.left;\n        }\n\n\n        return { top: top, left: left };\n    },\n\n    // get\n    _getName: function() {\n        return this.$popup.attr('data-' + this.prefix + '-popup-name');\n    },\n\n    // set\n    _setToolbarToggledButton: function() {\n        this.app.toolbar.unsetToggled();\n        if (!this._isToolbarButton()) {\n            return;\n        }\n\n        var name = this.button.getName();\n        this.app.toolbar.setToggled(name);\n    },\n\n    // create\n    _createStack: function(name, params, collapse) {\n        if (Object.prototype.hasOwnProperty.call(params, 'collapse') && params.collapse === false) {\n            collapse = false;\n        }\n\n        if (Object.prototype.hasOwnProperty.call(params, 'autoclose')) {\n            this.autoclose = params.autoclose;\n        }\n\n        var stack = this.app.create('popup.stack', name, params, collapse, this);\n        this.stacks[name] = stack;\n\n        return stack;\n    },\n\n    // open\n    _open: function(params, animation) {\n        this._buildButton(params);\n        this._buildControl(params);\n        this._buildName();\n        this._buildHeader();\n\n        // broadcast\n        var event = this.app.broadcast('popup.before.open');\n        if (event.isStopped()) {\n            this.stopStack();\n            return;\n        }\n\n        // set & start\n        this._setToolbarToggledButton();\n        this._startEvents();\n\n        // selection (all popups are closed)\n        if (animation !== false && this.app.editor.isPopupSelection()) {\n            this.app.selection.save();\n        }\n\n        // find active\n        this.stack = this._findActiveStack();\n\n        // open stack\n        this.stack.open(params, false, false);\n\n        // build position\n        this._buildPosition();\n\n        // show\n        if (animation === false) {\n            this.$popup.show();\n            this._opened();\n        }\n        else {\n            this.$popup.fadeIn(100, this._opened.bind(this));\n        }\n    },\n    _opened: function() {\n        this._buildHeight();\n        this.$popup.addClass('open');\n\n        // broadcast\n        this.app.broadcast('popup.open');\n        this.stack.renderFocus();\n    },\n\n    // closed\n    _closed: function() {\n        var attrname = 'data-' + this.prefix + '-popup-name';\n        var name = this.$popup.attr(attrname);\n        this.$popup.removeAttr(attrname);\n        this.$popup.removeClass('open ' + this.prefix + '-popup-' + name);\n        this.saved = false;\n\n        // broadcast\n        this.app.broadcast('popup.close');\n    },\n\n    // is\n    _isPopupTarget: function(e) {\n        return (this.dom(e.target).closest('.' + this.prefix + '-popup').length !== 0);\n    },\n    _isButton: function() {\n        return this.button;\n    },\n    _isControl: function() {\n        return this.control;\n    },\n    _isToolbarButton: function() {\n        return (this.button && (this.button.type === 'toolbar' || this.button.type === 'context'));\n    },\n    _isTopbarButton: function() {\n        return (this.button && this.button.type === 'topbar');\n    },\n\n\n    // find\n    _findActiveStack: function() {\n        for (var key in this.stacks) {\n            if (typeof this.stacks[key] === 'object' && this.stacks[key].isActive()) {\n                this.stack = this.stacks[key];\n            }\n        }\n\n        return this.stack;\n    },\n\n    // reset\n    _reset: function() {\n        this.button = false;\n        this.control = false;\n        this.autoclose = true;\n        this.stack = false;\n        this.stacks = [];\n        this.$popup.html('');\n        this.$popup.removeClass('has-footer has-items has-form');\n    },\n    _resetToolbarToggledButton: function() {\n        if (!this.button) return;\n        var name = this.button.getName();\n        this.app.toolbar.unsetToggled(name);\n    },\n\n    // start\n    _startEvents: function() {\n        var eventname = this.prefix + '-popup';\n        this.app.scroll.getTarget().on('resize.' + eventname, this.updatePosition.bind(this));\n        this.app.scroll.getTarget().on('scroll.' + eventname, this._buildPosition.bind(this));\n    },\n\n    // stop\n    _stopEvents: function() {\n        this.app.scroll.getTarget().off('.' + this.prefix + '-popup');\n    },\n    _stop: function() {\n        if (this.$popup) this.$popup.remove();\n    }\n});\nArticleEditor.add('class', 'popup.item', {\n    defaults: {\n        container: false,\n        title: false,\n        html: false,\n        toggle: true,\n        active: false,\n        divider: false,\n        remover: false,\n        classname: false,\n        params: false,\n        instance: false,\n        observer: false,\n        command: false\n    },\n    init: function(popup, name, params) {\n        this.popup = popup;\n        this.name = name;\n        this.params = this._buildParams(params);\n\n        this._build();\n        this._buildContainer();\n        this._buildIcon();\n        this._buildTitle();\n        this._buildImage();\n        this._buildShortcut();\n        this._buildActive();\n        this._buildHidden();\n        this._buildDivider();\n        this._buildCommand();\n        this._buildRemover();\n    },\n\n    // get\n    getPopup: function() {\n        return this.popup;\n    },\n    getName: function() {\n        return this.name;\n    },\n    getParams: function() {\n        return this.params.params;\n    },\n    getElement: function() {\n        return this.$item;\n    },\n    getInstance: function() {\n        return this.params.instance;\n    },\n\n    // is\n    isControl: function() {\n        return this.params.control;\n    },\n\n    // private\n    _build: function() {\n        this.$item = (this.params.html) ? this.dom(this.params.html) : this.dom('<div>');\n        this.$item.addClass(this.prefix + '-popup-item ' + this.prefix + '-popup-stack-item');\n        this.$item.attr({ 'data-name': this.name });\n    },\n    _buildContainer: function() {\n        if (this.params.container) {\n            this.$item.addClass(this.prefix + '-popup-item-container');\n        }\n    },\n    _buildTitle: function() {\n        if (this.params.title) {\n            this.$title = this.dom('<span>').addClass(this.prefix + '-popup-item-title');\n            this.$title.html(this.lang.parse(this.params.title));\n\n            this.$item.append(this.$title);\n        }\n    },\n    _buildImage: function() {\n        if (this.params.image) {\n            this.$image = this.dom('<span>').addClass(this.prefix + '-popup-item-image');\n            this.$image.html(this.params.image);\n\n            this.$item.append(this.$image);\n        }\n    },\n    _buildIcon: function() {\n        if (this.params.icon) {\n            this.$icon = this.dom('<span>').addClass(this.prefix + '-popup-item-icon');\n\n            // html icon\n            if (this.opts.buttons.icons && typeof this.opts.buttons.icons[this.name] !== 'undefined') {\n                this.$icon.html(this.opts.buttons.icons[this.name]);\n            }\n            else if (this.params.icon === true) {\n                this.$icon.addClass(this.prefix + '-icon-' + this.name);\n            }\n            else if (this.params.icon.search(/</) !== -1) {\n                this.$icon.html(this.params.icon);\n            }\n            else {\n                this.$icon.addClass(this.prefix + '-icon-' + this.params.icon);\n            }\n\n            this.$item.append(this.$icon);\n        }\n    },\n    _buildShortcut: function() {\n        if (this.params.shortcut) {\n            var meta = (/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) ? '<b>&#8984;</b>' : 'ctrl';\n            meta = this.params.shortcut.replace('Ctrl', meta);\n\n            this.$shortcut = this.dom('<span>').addClass(this.prefix + '-popup-item-shortcut');\n            this.$shortcut.html(meta);\n\n            this.$item.append(this.$shortcut);\n        }\n    },\n    _buildParams: function(params) {\n        return $ARX.extend({}, true, this.defaults, params);\n    },\n    _buildActive: function() {\n       if (this.params.active) {\n           this.$item.addClass('active');\n       }\n    },\n    _buildHidden: function() {\n        if (this.params.hidden) {\n            this.$item.addClass(this.prefix + '-popup-item-hidden');\n        }\n    },\n    _buildDivider: function() {\n        if (this.params.divider) {\n            this.$item.addClass(this.prefix + '-popup-item-divider-' + this.params.divider);\n        }\n    },\n    _buildCommand: function() {\n        if (this.params.command) {\n            this.$item.on('click.' + this.prefix + '-popup-item-' + this.uuid, this._catch.bind(this));\n            this.$item.attr('data-command', this.params.command);\n        }\n    },\n    _buildRemover: function() {\n        if (!this.params.title) return;\n        if (this.params.remover) {\n           var $trash = this.dom('<span>').addClass(this.prefix + '-popup-item-trash ' + this.prefix + '-icon-trash');\n           $trash.attr('data-command', this.params.remover);\n           $trash.on('click.' + this.prefix + '-popup-item-' + this.uuid, this._catchRemover.bind(this));\n\n           this.$item.append($trash);\n        }\n    },\n    _catchRemover: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $item = this.dom(e.target).closest('.' + this.prefix + '-popup-stack-item');\n        var $trash = this.dom(e.target).closest('.' + this.prefix + '-popup-item-trash');\n        var command = $trash.attr('data-command');\n        var name = $item.attr('data-name');\n\n        this.app.api(command, this, name);\n\n        $item.fadeOut(200, function($node) {\n            $node.remove();\n        });\n    },\n    _catch: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $item = this.dom(e.target).closest('.' + this.prefix + '-popup-stack-item');\n        var name = $item.attr('data-name');\n        var command = $item.attr('data-command');\n\n        this.popup.$items.find('.' + this.prefix + '-popup-stack-item').removeClass('active');\n\n        if (this.params.toggle) {\n            $item.addClass('active');\n        }\n\n        // command\n        this.app.api(command, this.getParams(), this, name, e);\n    }\n});\n\nArticleEditor.add('class', 'popup.stack', {\n    defaults: {\n        active: false,\n        title: false,\n        type: false, // grid\n        width: false, // string like '200px' or '100%'\n        setter: false,\n        getter: false,\n        builder: false,\n        observer: false,\n        instance: false,\n        collapse: false,\n        form: false,\n        items: false,\n        html: false,\n        focus: false,\n        footer: false\n    },\n    init: function(name, params, collapse, popup) {\n        this.defaultWidth = '240px';\n        this.popup = popup;\n        this.name = name;\n        this.tools = {};\n        this.data = false;\n        this.items = false;\n        this.formitems = false;\n        this.params = $ARX.extend({}, true, this.defaults, params);\n        if (collapse) {\n            this.params.collapse = true;\n        }\n\n        // build\n        this._build();\n        this._observe();\n    },\n\n    // set\n    set: function(name, value) {\n        this.params[name] = value;\n    },\n    setData: function(data) {\n        this.data = data;\n    },\n    setFocus: function(name) {\n        if (typeof this.tools[name] !== 'undefined') {\n            this.tools[name].setFocus();\n        }\n    },\n    setWidth: function(width) {\n        var $popup = this.app.popup.getElement();\n\n        $popup.attr('data-width', width);\n\n        if (width === '100%') {\n            width = this.app.editor.getWidth() + 'px';\n        }\n\n        $popup.css('width', width);\n        this.app.$win.on('resize.' + this.prefix + '-popup-' + this.uuid, this.popup.resize.bind(this.popup));\n        this.popup.resize();\n    },\n    setItemsData: function(items) {\n        this.items = items;\n    },\n\n    // get\n    get: function(name) {\n        return this.params[name];\n    },\n    getElement: function() {\n        return this.$stack;\n    },\n    getName: function() {\n        return this.name;\n    },\n    getBody: function() {\n        return this.$body;\n    },\n    getInstance: function() {\n        return this.get('instance');\n    },\n    getItemsData: function() {\n        return this.items;\n    },\n    getItems: function() {\n        return this.$items;\n    },\n    getFooter: function() {\n        return this.$footer;\n    },\n    getFooterPrimary: function() {\n        return this.$footer.find('.' + this.prefix + '-form-button-primary');\n    },\n    getTool: function(name) {\n        return (typeof this.tools[name] !== 'undefined') ? this.tools[name] : false;\n    },\n    getInput: function(name) {\n        var tool = this.getTool(name);\n        return (tool) ? tool.getInput() : this.dom();\n    },\n    getFormItem: function(name) {\n        var tool = this.getTool(name);\n\n        return (tool) ? tool.getInput().closest('.' + this.prefix + '-form-item') : this.dom();\n    },\n    getData: function(name) {\n        var data;\n        if (name) {\n            if (typeof this.tools[name] !== 'undefined') {\n                data = this.tools[name].getValue();\n            }\n        }\n        else {\n            data = {};\n            Object.keys(this.tools).forEach(function(key) {\n                data[key] = this.tools[key].getValue();\n            }.bind(this));\n        }\n\n        return data;\n    },\n\n    // has\n    hasForm: function() {\n        return this.formitems;\n    },\n    hasFooter: function() {\n        return (this.footerbuttons !== 0);\n    },\n    hasItems: function() {\n        return (this.items !== false);\n    },\n\n    // is\n    isCollapsed: function() {\n        return this.get('collapse');\n    },\n    isActive: function() {\n        return this.get('active');\n    },\n\n    // open\n    open: function(params, focus, direct) {\n        // input focus\n        if (params && params.focus) {\n            this.set('focus', params.focus);\n        }\n\n        // close stacks\n        this.popup.closeStacks();\n\n        // set\n        this.app.popup.setStack(this);\n\n        // broadcast\n        if (direct !== false) {\n            var event = this.app.broadcast('popup.before.open');\n            if (event.isStopped()) {\n                this.popup.stopStack();\n                return;\n            }\n        }\n\n        // render\n        if (params && params.collapse) {\n            this._buildItems();\n            this._renderItems();\n        }\n        else {\n            this.render();\n        }\n\n        // header\n        this.popup.header.render(this.popup.stacks);\n        this.popup.header.setActive(this);\n\n        // show\n        this.$stack.show();\n        this._renderWidth();\n        this.popup._buildPosition();\n        if (focus !== false) {\n            this.renderFocus();\n        }\n\n        // broadcast\n        if (direct !== false) {\n            this.app.broadcast('popup.open');\n        }\n    },\n\n    // close\n    close: function() {\n        this.$stack.hide();\n    },\n    collapse: function() {\n        var prev = this._getPrev();\n\n        if (this.isCollapsed()) {\n            this.popup.removeStack(this);\n        }\n\n        // open\n        prev.open({ collapse: true });\n    },\n\n    // render\n    render: function() {\n        this._renderType();\n        if (this.params.html) {\n            this._renderHtml();\n        }\n        else {\n            this._renderItems();\n        }\n        this._renderForm();\n        this._renderFooter();\n        this._renderEnv();\n    },\n    renderFocus: function() {\n        if (this.get('focus')) {\n            this.setFocus(this.get('focus'));\n        }\n    },\n\n    // =private\n\n    // observe\n    _observe: function() {\n        if (this.params.observer) {\n            this.app.api(this.params.observer, this);\n        }\n    },\n\n    // get\n    _getPrev: function() {\n        var prev;\n        for (var key in this.popup.stacks) {\n            if (this.popup.stacks.hasOwnProperty(key)) {\n                if (key === this.name) {\n                    return prev;\n                }\n                prev = this.popup.stacks[key];\n            }\n        }\n    },\n\n    // build\n    _build: function() {\n        this._buildElement();\n        this._buildBody();\n        this._buildFooter();\n        this._buildParams();\n    },\n    _buildElement: function() {\n        this.$stack = this.dom('<div>').addClass(this.prefix + '-popup-stack ' + this.prefix + '-popup-stack-' + this.name);\n        this.$stack.hide();\n        this.$stack.attr('data-' + this.prefix + '-stack-name', this.name);\n\n        // append\n        this.popup.getElement().append(this.$stack);\n    },\n    _buildBody: function() {\n        this.$body = this.dom('<div>').addClass(this.prefix + '-popup-body');\n        this.$stack.append(this.$body);\n    },\n    _buildFooter: function() {\n        this.$footer = this.dom('<div>').addClass(this.prefix + '-popup-footer');\n        this.$stack.append(this.$footer);\n    },\n    _buildParams: function() {\n        this.params.width = (this.params.width) ? this.params.width : this.defaultWidth;\n        this.params.setter = (this.params.setter) ? this.params.setter : false;\n        this.params.getter = (this.params.getter) ? this.params.getter : false;\n        this.data = (this.params.getter) ? this.app.api(this.params.getter, this) : false;\n        this._buildItems();\n    },\n    _buildItems: function() {\n        // items\n        if (this.params.builder) {\n            this.items = this.app.api(this.params.builder, this);\n        }\n        else if (this.params.items) {\n            this.items = this.params.items;\n        }\n    },\n\n    // render\n    _renderWidth: function() {\n        this.setWidth(this.get('width'));\n    },\n    _renderType: function() {\n        this.$stack.removeClass(this.prefix + '-popup-type-grid');\n\n        var type = this.get('type');\n        if (type) {\n            this.$stack.addClass(this.prefix + '-popup-type-' + type);\n        }\n    },\n    _renderHtml: function() {\n        if (this.$items) {\n            this.$items.html('');\n        }\n        else {\n            this.$items = this.dom('<div>').addClass(this.prefix + '-popup-html');\n            this.$body.append(this.$items);\n        }\n\n        this.$items.append(this.params.html);\n    },\n    _renderItems: function() {\n        if (!this.items) return;\n\n        if (this.$items) {\n            this.$items.html('');\n        }\n        else {\n            this.$items = this.dom('<div>').addClass(this.prefix + '-popup-items');\n            this.$body.append(this.$items);\n        }\n\n        // build items\n        for (var name in this.items) {\n            if (this.items.hasOwnProperty(name)) {\n                if (Object.prototype.hasOwnProperty.call(this.items[name], 'observer') && this.items[name].observer) {\n                    var res = this.app.api(this.items[name].observer, this.items[name], name, this);\n                    if (typeof res !== 'undefined') {\n                        this.items[name] = res;\n                    }\n                }\n\n                if (this.items[name] === false) continue;\n\n                var item = this.app.create('popup.item', this, name, this.items[name]);\n                var $item = item.getElement();\n\n                this._renderItemPosition(this.$items, $item, this.items[name]);\n            }\n        }\n    },\n    _renderItemPosition: function($container, $item, params) {\n         if (params.position) {\n            var pos = params.position;\n            if (pos === 'first') {\n                $container.prepend($item);\n            }\n            else if (typeof pos === 'object') {\n                var type = (Object.prototype.hasOwnProperty.call(pos, 'after')) ? 'after' : 'before';\n                var name = pos[type];\n                var $el = this._findPositionElement(name, $container);\n                if ($el) {\n                    $el[type]($item);\n                }\n                else {\n                    $container.append($item);\n                }\n            }\n        }\n        else {\n            $container.append($item);\n        }\n    },\n    _renderEnv: function() {\n        var $popup = this.popup.getElement();\n\n        $popup.removeClass('has-footer has-items has-form');\n\n        if (this.hasForm()) $popup.addClass('has-form');\n        if (this.hasFooter()) $popup.addClass('has-footer');\n        if (this.hasItems()) $popup.addClass('has-items');\n    },\n    _renderForm: function() {\n        this.formitems = this.get('form');\n\n        if (!this.formitems) return;\n\n        // build form element\n        if (this.$form) {\n            this.$form.html('');\n        }\n        else {\n            this.$form = this.dom('<form>').addClass(this.prefix + '-popup-form');\n            this.$body.append(this.$form);\n        }\n\n        this._renderTools();\n        this._renderData();\n\n        // enter events\n        this.$form.find('input[type=text],input[type=url],input[type=email]').on('keydown.' + this.prefix + '-popup', function(e) {\n            if (e.which === 13) {\n                e.preventDefault();\n                return false;\n            }\n        }.bind(this));\n    },\n    _renderTools: function() {\n        Object.keys(this.formitems).forEach(function(key) {\n            this._renderTool(key, this.formitems[key]);\n        }.bind(this));\n    },\n    _renderTool: function(name, obj) {\n        var tool = this.app.create('tool.' + obj.type, name, obj, this, this.data);\n        var $tool = tool.getElement();\n        if ($tool) {\n            this.tools[name] = tool;\n            this.$form.append($tool);\n        }\n    },\n    _renderData: function() {\n        if (!this.data) return;\n        for (var name in this.data) {\n            if (typeof this.tools[name] !== 'undefined') {\n                this.tools[name].setValue(this.data[name]);\n            }\n        }\n    },\n    _renderFooter: function() {\n        this.footerbuttons = 0;\n        var buttons = this.get('footer');\n        if (!buttons) return;\n\n        this.$footer.html('');\n\n        // buttons\n        for (var key in buttons) {\n            if (buttons.hasOwnProperty(key)) {\n                if (buttons[key] === false) continue;\n\n                var button = this.app.create('popup.button', key, this, buttons[key]);\n                this.$footer.append(button.getElement());\n                this.footerbuttons++;\n            }\n        }\n    },\n\n    // find\n    _findPositionElement: function(name, $container) {\n        var $el;\n        if (Array.isArray(name)) {\n            for (var i = 0; i < name.length; i++) {\n                $el = $container.find('[data-name=' + name[i] + ']');\n                if ($el.length !== 0) break;\n            }\n        }\n        else {\n            $el = $container.find('[data-name=' + name + ']');\n        }\n\n        return ($el.length !== 0) ? $el : 0;\n    }\n});\nArticleEditor.add('class', 'popup.header', {\n    init: function(popup) {\n        this.popup = popup;\n\n        // build\n        this._build();\n    },\n    setActive: function(stack) {\n        this.$headerbox.find('.' + this.prefix + '-popup-header-item').removeClass('active');\n        this.$headerbox.find('[data-' + this.prefix + '-name=' + stack.getName() + ']').addClass('active');\n    },\n    render: function(stacks) {\n        this._reset();\n        var len = this._buildItems(stacks);\n        if (len > 0) {\n            this._buildClose();\n        }\n    },\n\n    // private\n    _build: function() {\n        this.$header = this.dom('<div>').addClass(this.prefix + '-popup-header');\n        this.$headerbox = this.dom('<div>').addClass(this.prefix + '-popup-header-box');\n\n        this.$header.append(this.$headerbox);\n        this.popup.getElement().prepend(this.$header);\n    },\n    _buildClose: function() {\n        var $close = this.dom('<span>').addClass(this.prefix + '-popup-close');\n        $close.one('click', this._catchClose.bind(this));\n\n        this.$header.append($close);\n    },\n    _buildItems: function(stacks) {\n        var len = Object.keys(stacks).length;\n        var count = 0;\n        var z = 0;\n        for (var key in stacks) {\n            if (stacks.hasOwnProperty(key)) {\n                if (typeof stacks[key] !== 'object') {\n                    continue;\n                }\n                z++;\n                var title = stacks[key].get('title');\n                if (title) {\n                    count++;\n                    this._buildItem(stacks[key], title, len);\n                }\n                else if (z === 1 && len > 1) {\n                    count++;\n                    this._buildItem(stacks[key], '## popup.back ##', len);\n                }\n            }\n        }\n\n        return count;\n    },\n    _buildItem: function(stack, title, len) {\n        var isLink = (len > 1);\n        var $item = (isLink) ? this.dom('<a>').attr('href', '#') : this.dom('<span>');\n\n        if (isLink) {\n            $item.dataset('stack', stack);\n            $item.addClass(this.prefix + '-popup-header-item-link');\n            $item.on('click', this._catchStack.bind(this));\n        }\n\n        $item.attr('data-' + this.prefix + '-name', stack.getName());\n        $item.addClass(this.prefix + '-popup-header-item');\n        $item.html(this.lang.parse(title));\n\n        this.$headerbox.append($item);\n    },\n    _reset: function() {\n        this.$headerbox.html('');\n        this.$header.find('.' + this.prefix + '-popup-close').remove();\n    },\n    _catchStack: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $item = this.dom(e.target);\n        var stack = $item.dataget('stack');\n        var current = this.app.popup.getStack();\n\n        // remove collapsable\n        if (current.isCollapsed()) {\n            this.app.popup.removeStack(current);\n        }\n\n        // open\n        stack.open();\n    },\n    _catchClose: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.popup.close();\n    }\n});\nArticleEditor.add('class', 'popup.button', {\n    init: function(name, popup, obj) {\n\n        this.name = name;\n        this.obj = obj;\n        this.popup = popup;\n\n        this.$button = this.dom('<button>').addClass(this.prefix + '-form-button');\n        this.$button.attr('data-name', this.name);\n        this.$button.html(this.lang.parse(this.obj.title));\n        this.$button.dataset('instance', this);\n\n        if (this._has('type')) this.$button.addClass(this.prefix + '-form-button-' + this.obj.type);\n        if (this._has('classname')) this.$button.addClass(this.obj.classname);\n        if (this._has('fullwidth')) this.$button.addClass(this.prefix + '-form-button-fullwidth');\n        if (this._has('right')) this.$button.addClass(this.prefix + '-form-button-push-right');\n\n        // event\n        this.$button.on('click.' + this.prefix + '-popup-button' + this.uuid, this._catch.bind(this));\n    },\n    getName: function() {\n        return this.name;\n    },\n    getElement: function() {\n        return this.$button;\n    },\n    invokeCommand: function() {\n        this._invoke();\n    },\n\n\n    // private\n    _has: function(name) {\n        return Object.prototype.hasOwnProperty.call(this.obj, name);\n    },\n    _catch: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (this._has('command')) {\n            this._invoke(e);\n        }\n        else if (this._has('close')) {\n            this.app.popup.close();\n        }\n    },\n    _invoke: function(e) {\n        this.app.api(this.obj.command, this.popup, this.name, e);\n    }\n});\nArticleEditor.add('module', 'editor', {\n    init: function() {\n        this.mobileMode = false;\n        this.customButtons = {};\n    },\n    start: function() {\n        this._buildFrame();\n        this._buildDisabled();\n        this._buildBlurClass();\n        this._buildOptions();\n        this._buildMultiple();\n        this._buildParserTags();\n        this._buildStartHtml();\n        this._buildLayout();\n        this._buildContent();\n    },\n    stop: function() {\n        this.$editor = false;\n        this.customButtons = {};\n        this.app.$element.show();\n    },\n    build: function() {\n        this.app.embed.build();\n        this.app.blocks.build();\n        this.app.image.observeStates();\n        this.app.parser.buildPredefinedClasses();\n\n        // broadcast\n        this.app.broadcast('editor.build');\n    },\n\n    // insert\n    insertContent: function(params) {\n        this.app.insertion.insertContent(params);\n    },\n\n    // set\n    setContent: function(params) {\n        this.app.insertion.setContent(params);\n    },\n    setEmpty: function() {\n        this.app.insertion.setContent({ html: '' });\n    },\n    setWinFocus: function() {\n        this.getWin().focus();\n    },\n    setFocus: function(caret) {\n        if (this.opts.disableMode) return;\n        if (caret) {\n            this._setFocusCaret(caret);\n        }\n        else {\n            this._setFocusEvent();\n        }\n    },\n    setBlur: function() {\n        if (this.opts.disableMode || !this.isFocus()) return;\n        if (!this.$editor.get) return;\n\n        this.app.container.setBlur();\n\n        if (!this.app.source.is()) {\n            this._enableToolbarButtons();\n            this.app.block.unset();\n            this.app.blocks.unset();\n        }\n\n        this.app.selection.removeAllRanges();\n\n        // ui\n        if (!this.app.source.is() && !this.isMobileView()) {\n            this.app.path.build();\n            this.app.toolbar.build();\n            this.app.control.close();\n        }\n\n        this.app.popup.close(false);\n\n        // broadcast\n        this.app.broadcast('editor.blur');\n    },\n\n    // select\n    selectAll: function(type) {\n        if (this.isAllSelected()) return;\n\n        this._setSelectAllClass();\n\n        this.app.blocks.unset();\n        this.app.blocks.setFirstLevel();\n        this.app.selection.removeAllRanges();\n\n        // ui\n        this.app.path.build();\n        this.app.toolbar.build();\n        this.app.control.close();\n\n    },\n\n    // unselect\n    unselectAll: function() {\n        if (!this.isAllSelected()) return;\n\n        this.unsetSelectAllClass();\n\n        this.app.block.unset();\n        this.app.blocks.unset();\n    },\n\n    // unset\n    unsetSelectAllClass: function() {\n        this.$editor.removeClass(this.prefix + '-select-all');\n    },\n\n    // add\n    addButton: function(name, obj) {\n        this.customButtons[name] = obj;\n    },\n\n    // get\n    getButtons: function() {\n        var buttons = this.getButtonsFromArr(this.opts.buttons.editor);\n        var res = {};\n        for (var name in buttons) {\n            if (buttons.hasOwnProperty(name)) {\n                if (name === 'html' && !this.opts.source) continue;\n                if (name === 'templates' && !this.opts.templates.json) continue;\n\n                res[name] = buttons[name];\n            }\n        }\n\n        // custom buttons\n        res = $ARX.extend(true, {}, res, this.customButtons);\n\n        return res;\n    },\n    getContent: function(tidy) {\n        var html = '';\n        if (this.app.source.is()) {\n            html = this.app.source.getContent();\n        }\n        else {\n            html = this._getContent();\n            html = (tidy) ? this.app.tidy.parse(html) : html;\n        }\n\n        // decode href\n        html = this.app.content.decodeHref(html);\n\n        return html;\n    },\n    getWidth: function() {\n        var $editor = this.getEditor();\n        var padLeft = parseInt($editor.css('padding-left'));\n        var padRight = parseInt($editor.css('padding-right'));\n\n        return ($editor.width() - padLeft - padRight);\n    },\n    getRect: function() {\n        return this.getFrameRect();\n    },\n    getFrameRect: function() {\n        var offset = this.$editor.offset();\n        var width = this.$editor.width();\n        var height = this.$editor.height();\n        var top = Math.round(offset.top);\n        var left = Math.round(offset.left);\n\n        return {\n            top: top,\n            left: left,\n            bottom: top + height,\n            right: left + width,\n            width: width,\n            height: height\n        };\n    },\n    getSelection: function() {\n        var sel = this.getWinNode().getSelection();\n        return (sel.rangeCount > 0) ? sel : false;\n    },\n    getEditor: function() {\n        return this.getFrame();\n    },\n    getFrame: function() {\n        return (this.$editor) ? this.$editor : this.dom();\n    },\n    getLayout: function() {\n        return this.$layout;\n    },\n    getOverlay: function() {\n        return this.$overlay;\n    },\n    getHead: function() {\n        return this.getDoc().find('head');\n    },\n    getBody: function() {\n        return (this.$editor) ? this.getDoc().find('body') : this.dom();\n    },\n    getDoc: function() {\n        return this.dom(this.getDocNode());\n    },\n    getDocNode: function() {\n        return (this.$editor === false) ? null : this.$editor.get().contentWindow.document;\n    },\n    getWin: function() {\n        return this.dom(this.getWinNode());\n    },\n    getWinNode: function() {\n        return this.$editor.get().contentWindow;\n    },\n    getButtonsFromArr: function(arr) {\n        var buttons = {};\n\n        if (!Array.isArray(arr) && typeof arr === 'object') {\n            return arr;\n        }\n        else if (arr) {\n            var obj = $ARX.extend(true, {}, this.opts.buttonsObj);\n            for (var i = 0; i < arr.length; i++) {\n                var name = arr[i];\n                if (typeof obj[name] !== 'undefined') {\n                    buttons[name] = obj[name];\n                }\n            }\n        }\n\n        return buttons;\n    },\n\n    // adjust\n    adjustHeight: function() {\n        if (!this.$editor || this.app.isStopped()) return;\n        setTimeout(function() {\n            this.$editor.height(this.getBody().height());\n        }.bind(this), 1);\n    },\n\n    // toggle\n    toggleView: function(button) {\n        if (this.mobileMode) {\n            this.$editor.css('width', '');\n            this.enableUI();\n            this.app.toolbar.unsetToggled('mobile');\n            this.app.event.run();\n            this.app.blocks.runEditableBlocks();\n            this.app.observer.build();\n            this.mobileMode = false;\n        }\n        else {\n            this.$editor.css('width', this.opts.editor.mobile + 'px');\n            this.disableUI();\n            this.app.toolbar.setToggled('mobile');\n            this.app.popup.close();\n            this.app.control.close();\n            this.app.event.pause();\n            this.app.blocks.pauseEditableBlocks();\n            this.app.observer.stop();\n            this.mobileMode = true;\n        }\n\n        this.adjustHeight();\n    },\n\n    // ui\n    observeUI: function() {\n        this.app.toolbar.observe();\n    },\n    enableUI: function() {\n        this.app.path.enable();\n        this.app.topbar.enable();\n        this.app.toolbar.enable();\n        this.app.toolbar.enableSticky();\n    },\n    disableUI: function() {\n        this.app.path.disable();\n        this.app.topbar.disable();\n        this.app.toolbar.disable();\n        this.app.toolbar.disableSticky();\n    },\n\n    // is\n    isEditor: function(el) {\n         return this.isLayout(el);\n    },\n    isLayout: function(el) {\n        return (this.dom(el).get() === this.$layout.get());\n    },\n    isTextarea: function() {\n        return (this.opts.content === false);\n    },\n    isAllSelected: function() {\n        return this.$editor.hasClass(this.prefix + '-select-all');\n    },\n    isFocus: function() {\n        return this.app.container.isFocus();\n    },\n    isEmpty: function(emptyparagraph) {\n        var blocks = this.app.blocks.getFirstLevel();\n        if (blocks.length > 1) {\n            return false;\n        }\n        else {\n            return this.app.content.isEmptyHtml(this.$layout.html(), emptyparagraph);\n        }\n    },\n    isMobileView: function() {\n        return this.mobileMode;\n    },\n    isPopupSelection: function() {\n        return true;\n    },\n    isBlocksSelection: function() {\n        return false;\n    },\n\n    // build\n    _buildFrame: function() {\n        this.app.$element.hide();\n        this.$editor = this.dom('<iframe>').addClass(this.prefix + '-editor-frame');\n\n        // append\n        this.app.container.get('editor').append(this.$editor);\n\n        // overlay\n        this.$overlay = this.dom('<div>').addClass(this.prefix + '-editor-overlay');\n        this.app.container.get('editor').append(this.$overlay);\n    },\n    _buildDisabled: function() {\n        this.opts.disableMode = (this.opts.editor.disabled || this.app.$element.attr('disabled') !== null);\n    },\n    _buildBlurClass: function() {\n        this.app.container.get('main').addClass(this.prefix + '-in-blur');\n    },\n    _buildMultiple: function() {\n        if (this.opts.selection.multiple === false) {\n            this.app.shortcut.remove('meta+click');\n        }\n    },\n    _buildOptions: function() {\n        var $e = this.$editor;\n        var o = this.opts.editor;\n\n        // 2.3.0 legacy\n        var p = this.opts.paste;\n        if (Object.prototype.hasOwnProperty.call(p, 'autolink')) {\n            p.autoparse = p.autolink;\n        }\n\n        $e.attr('dir', o.direction);\n        $e.attr('scrolling', 'no');\n        $e.css('visibility', 'hidden');\n\n        if (o.minHeight) $e.css('min-height', o.minHeight);\n        if (o.maxHeight) {\n            $e.css('max-height', o.maxHeight);\n            $e.attr('scrolling', 'yes');\n        }\n        if (o.notranslate) $e.addClass('notranslate');\n        if (!o.spellcheck) $e.attr('spellcheck', false);\n    },\n    _buildStartHtml: function() {\n        var doctype = this._createDoctype();\n        var scripts = this._createScripts();\n        var layout = '<div class=\"' + this.opts.editor.classname + '\"></div>';\n        var code = doctype + '<html><head></head><body>' + layout + scripts + '</body></html>';\n\n        // write code\n        this._writeCode(code);\n    },\n    _buildLayout: function() {\n        var $body = this.getBody();\n        var classes = this.opts.editor.classname.split(' ').join('.');\n\n        this.$layout = $body.find('.' + classes).first();\n        this.$layout.attr('dir', this.opts.editor.direction);\n\n        if (this.opts.editor.padding === false) {\n            this.$layout.css('padding', 0);\n        }\n\n        // body height\n        $body.css('height', 'auto');\n    },\n    _buildContent: function() {\n        var content = this._getContentValue();\n\n        content = this.app.broadcastHtml('editor.before.load', content);\n\n        // set parsed\n        var $parsed = this.app.parser.parse(content, true, true);\n        this.$layout.html($parsed.get().childNodes);\n\n        // set unparsed\n        var unparsed = this.app.parser.unparse(this.$layout.html());\n        this.app.$element.val(unparsed);\n\n        // load\n        this._load();\n    },\n    _buildVisibility: function() {\n        this.$editor.css('visibility', 'visible');\n    },\n    _buildEditorCss: function() {\n        if (!this.opts.css) return;\n\n        var css;\n        if (Array.isArray(this.opts.css)) {\n            css = this.opts.css;\n        }\n        else {\n            css = [\n                this.opts.css + 'arx-frame.min.css',\n                this.opts.css + 'arx-content.min.css'\n            ];\n        }\n\n        for (var i = 0; i < css.length; i++) {\n            this._buildCssLink(css[i]);\n        }\n    },\n    _buildCustomCss: function() {\n        if (!this.opts.custom.css) return;\n\n        for (var i = 0; i < this.opts.custom.css.length; i++) {\n            this._buildCssLink(this.opts.custom.css[i]);\n        }\n    },\n    _buildCssLink: function(href) {\n        var obj = (typeof href === 'object') ? href : { href: href };\n        var isMark = (typeof href === 'string') ? href.search(/\\?/g) : href.href.search(/\\?/g);\n        var mark = (isMark === -1) ? '?' : '&';\n        var tstamp = (this.opts.editor.csscache) ? '' : mark + new Date().getTime();\n        obj.href = obj.href + tstamp;\n\n        // link tag\n        var $css = this.dom('<link>').attr({ 'class': this.prefix + '-css', 'rel': 'stylesheet' });\n\n        $css.attr(obj);\n\n        // append\n        this.getHead().append($css);\n    },\n    _buildGridCssVar: function() {\n        if (!this.opts.grid) return;\n\n        var style = this.getDocNode().documentElement.style;\n        style.setProperty('--' + this.prefix + '-grid-columns', this.opts.grid.columns);\n        style.setProperty('--' + this.prefix + '-grid-gutter', this.opts.grid.gutter);\n        style.setProperty('--' + this.prefix + '-grid-offset-left', this.opts.grid.offset.left);\n        style.setProperty('--' + this.prefix + '-grid-offset-right', this.opts.grid.offset.right);\n\n        // patterns opts\n        if (this.app.initialSettings.grid && this.app.initialSettings.grid.patterns) {\n            this.opts.grid.patterns = this.app.initialSettings.grid.patterns;\n        }\n    },\n    _buildParserTags: function() {\n        var parser = this.opts.parser;\n        for (var key in parser) {\n            // add tag\n            if (parser[key].parse && parser[key].tag) {\n                var tag = parser[key].tag;\n                if (typeof this.opts.parserTags[tag] === 'undefined') this.opts.parserTags[tag] = [];\n                this.opts.parserTags[tag].push(parser[key].parse);\n            }\n        }\n    },\n    _buildDraggable: function() {\n        var $items = this.app.$body.find('[data-' + this.prefix + '-drop-id]');\n        $items.each(function($node) {\n            $node.attr('draggable', true);\n            $node.on('dragstart', function(e) {\n                var $target = this.dom(e.target);\n                var id = $target.attr('data-' + this.prefix + '-drop-id');\n                e.dataTransfer.setData('item', id);\n            }.bind(this));\n        }.bind(this));\n\n    },\n\n    // load\n    _load: function() {\n        try {\n            this._loadImages();\n            this._loaded();\n        }\n        catch(e) {\n            $ARX.error(e);\n        }\n    },\n    _loaded: function() {\n        this.app.sync.build();\n        this.app.event.build();\n        this.app.embed.build();\n        this.app.blocks.build();\n        this.app.image.observeStates();\n\n        this._buildVisibility();\n        this._buildEditorCss();\n        this._buildCustomCss();\n        this._buildGridCssVar();\n        this._buildDraggable();\n\n        // adjust on resize\n        this.getWin().on('resize.' + this.prefix + '-editor-frame', this.adjustHeight.bind(this));\n\n        // broadcast\n        this.app.broadcast('editor.load');\n\n        // adjust height & build observer\n        this.adjustHeight();\n        setTimeout(function() {\n            if (this.app.isStopped()) return;\n\n            this.adjustHeight();\n            this._setFocusOnStart();\n            this.app.observer.build();\n            this.app.broadcast('editor.ready');\n        }.bind(this), 500);\n        setTimeout(this.adjustHeight.bind(this), 3000);\n    },\n    _loadedImage: function() {\n        this.imageslen--;\n    },\n    _loadImages: function() {\n        var $doc = this.getDoc();\n        var $images = $doc.find('img');\n        this.imageslen = $images.length;\n\n        $images.each(this._loadImage.bind(this));\n        var timerImg = setInterval(function() {\n            if (this.imageslen === 0) {\n                this.adjustHeight();\n                clearInterval(timerImg);\n                return;\n            }\n        }.bind(this), 50);\n    },\n    _loadImage: function($img) {\n        var img = $img.get();\n        if (this.opts.editor.images) {\n            var arr = img.src.split('/');\n            var last = arr[arr.length-1];\n            img.src = this.opts.editor.images + last;\n        }\n\n        $img.one('load', this._loadedImage.bind(this));\n    },\n\n    // set\n    _setFocusOnStart: function() {\n        if (!this.opts.editor.focus) return;\n\n        this.setFocus();\n        this.setFocus(this.opts.editor.focus);\n    },\n    _setSelectAllClass: function() {\n        this.$editor.addClass(this.prefix + '-select-all');\n    },\n    _setFocusCaret: function(caret) {\n        caret = this._getCaretPosition(caret);\n        var target = this._getFocusTarget(caret);\n\n        this.app.block.set(target, caret);\n    },\n    _setFocusEvent: function() {\n        if (this.isFocus()) return;\n\n        for (var i = 0; i < $ARX.instances.length; i++) {\n            if ($ARX.instances[i] !== this.app) {\n                $ARX.instances[i].editor.setBlur();\n            }\n        }\n\n        this.app.container.setFocus();\n\n        // broadcast\n        this.app.broadcast('editor.focus');\n    },\n\n    // get\n    _getCaretPosition: function(caret) {\n        return (caret === true) ? 'start' : caret;\n    },\n    _getFocusTarget: function(caret) {\n        return (caret === 'start') ? this.app.blocks.getFirst() : this.app.blocks.getLast();\n    },\n    _getContent: function() {\n        var html = this.$layout.html();\n        html = this.app.parser.unparse(html);\n\n        return html;\n    },\n    _getContentValue: function() {\n        return (this.opts.content) ? this.opts.content : this.app.$element.val();\n    },\n\n    // enable\n    _enableToolbarButtons: function() {\n        if (this.app.source.is() || this.isMobileView()) return;\n        this.app.toolbar.enable();\n    },\n\n    // write\n    _writeCode: function(html) {\n        var doc = this.getDocNode();\n        doc.open();\n        doc.write(html);\n        doc.close();\n    },\n\n    // create\n    _createDoctype: function() {\n        return this.opts.editor.doctype + '\\n';\n    },\n    _createScripts: function() {\n        if (!this.opts.custom.js) return '';\n\n        var str = '';\n        var scripts = this.opts.custom.js;\n        for (var i = 0; i < scripts.length; i++) {\n            var obj = (typeof scripts[i] === 'object') ? scripts[i] : { src: scripts[i] };\n            obj.src = obj.src + '?' + new Date().getTime();\n\n            // script tag\n            var $el = this.dom('<script>').addClass(this.prefix + '-js').attr(obj);\n\n            // all scripts str\n            str = str + $el.get().outerHTML;\n        }\n\n        return str;\n    }\n});\nArticleEditor.add('module', 'observer', {\n    init: function() {\n        this.observer = false;\n        this.trigger = true;\n    },\n    build: function() {\n        if (window.MutationObserver) {\n            var el = this.app.editor.getLayout().get();\n            this.observer = this._build(el);\n            this.observer.observe(el, {\n                 attributes: true,\n                 subtree: true,\n                 childList: true,\n                 characterData: true,\n                 characterDataOldValue: true\n            });\n        }\n    },\n    stop: function() {\n        if (this.observer) this.observer.disconnect();\n        this.trigger = true;\n    },\n\n    // private\n    _build: function(el) {\n        var self = this;\n        return new MutationObserver(function(mutations) {\n            self._observe(mutations[mutations.length-1], el);\n        });\n    },\n    _observe: function(mutation, el) {\n        if (mutation.type === 'attributes' && mutation.target === el) {\n            return;\n        }\n\n        // sync\n        if (this.trigger) {\n            this.app.editor.adjustHeight();\n            this.app.broadcast('observer.change');\n            this.app.placeholder.toggle();\n            this.app.sync.trigger();\n        }\n    }\n});\nArticleEditor.add('module', 'parser', {\n    build: function(html) {\n        this.$layout = this.dom('<div>');\n        this.$layout.html(html);\n        this.$layout.find('[data-' + this.prefix + '-type]').each(this._build.bind(this));\n\n        return this.$layout;\n    },\n    buildElement: function($el) {\n        $el.find('[data-' + this.prefix + '-type]').each(this._build.bind(this));\n    },\n    buildPredefinedClasses: function($el) {\n        if (!this.opts.classes) return;\n\n        $el = $el || this.app.editor.getLayout();\n\n        var content = this.app.content;\n        var findTags = true;\n        var findBlocks = false;\n        if (typeof this.opts.classes.blocks !== 'undefined') {\n            findBlocks = true;\n            if (typeof this.opts.classes.tags === 'undefined') {\n                findTags = false;\n            }\n        }\n\n        if (findTags) $el.find(content.getPredefinedTags().join(',')).each(content.addPredefinedTagClass.bind(this));\n        if (findBlocks) {\n            var types = content.getPredefinedBlocks();\n            var datatype = 'data-' + this.prefix + '-type';\n            var selector = '[' + datatype + '=' + types.join('],[' + datatype + '=') + ']';\n            $el.find(selector).each(content.addPredefinedBlockClass.bind(this));\n        }\n    },\n\n    // parse\n    parse: function(html, build, start) {\n        // parse\n        html = html.trim();\n        html = this.app.broadcastHtml('editor.before.parse', html);\n\n        // check empty\n        if (this.app.content.isEmptyHtml(html)) {\n            html = this.app.block.createHtml();\n        }\n        // clean & parse\n        else {\n            html = this._clean(html, start);\n            html = this._parse(html);\n        }\n\n        // broadcast\n        html = this.app.broadcastHtml('editor.parse', html);\n\n        // build\n        return (build !== false) ? this.build(html) : html;\n    },\n    parseLine: function(html, build) {\n        if (html === ' ') {\n            html = '&nbsp;';\n        }\n        else {\n            // broadcast\n            html = this.app.broadcastHtml('editor.before.parse', html);\n\n            // convert newlines to br\n            html = html.replace(/\\r?\\n/g, \"<br>\");\n            html = this.app.content.encodeCode(html);\n            html = this.app.content.sanitize(html);\n            html = this.app.content.removeEmptySpans(html);\n            html = this.app.content.addHttps(html);\n\n            // broadcast\n            html = this.app.broadcastHtml('editor.parse', html);\n        }\n\n        // build\n        return (build !== false) ? this.build(html) : html;\n    },\n\n    // unparse\n    unparse: function(html, state) {\n        var stored = {};\n        var storedIndex = 0;\n\n        html = html.trim();\n        html = this.app.broadcastHtml('editor.before.unparse', html);\n\n        // empty\n        if (this.app.content.isEmptyHtml(html)) {\n            return '';\n        }\n\n        // revert\n        html = this._revertForms(html);\n        html = this._revertFrames(html);\n\n        // store\n        html = this.app.content.store(html, 'noneditable', stored, storedIndex);\n        html = this.app.content.store(html, 'embed', stored, storedIndex);\n\n        // link nofollow\n        html = this.app.content.addNofollow(html);\n\n        // remove selection markers\n        html = this.app.content.removeMarkers(html);\n        html = this.app.utils.removeInvisibleChars(html);\n\n        // restore data style cache\n        html = this.app.content.recacheStyle(html);\n\n        // restore\n        html = this.app.content.restore(html, 'noneditable', stored);\n        html = this.app.content.restore(html, 'embed', stored);\n\n        // remove empty attrs\n        html = this.app.content.removeEmptyAttrs(html, ['style', 'class', 'rel', 'alt', 'title']);\n\n        // unparse\n        html = this._unparseAllTags(html);\n        html = this._unparseDataType(html, state);\n\n        // remove empty attrs again\n        html = this.app.content.removeEmptyAttrs(html, ['style', 'class', 'rel', 'alt', 'title']);\n\n        // replace quot\n        html = html.replace(/&quot;(.*?)&quot;/gi, \"'$1'\");\n        html = this.app.utils.replaceRgbToHex(html);\n\n        // add predefined classes\n        if (this.opts.classes) {\n            html = this.app.utils.wrap(html, this.buildPredefinedClasses.bind(this));\n        }\n\n        if (html === '<p></p>') {\n            html = '';\n        }\n\n        // tidy\n        //html = this.app.content.tidy.html(html);\n\n        // broadcast\n        return this.app.broadcastHtml('editor.unparse', html);\n    },\n\n    // private\n    _build: function($node) {\n        var type = $node.attr('data-' + this.prefix + '-type');\n        this.app.create('block.' + type, $node);\n    },\n    _clean: function(html, start) {\n        var stored = {};\n        var storedIndex = 0;\n        var storedComments = [];\n\n        // store comments\n        html = this.app.content.storeComments(html, storedComments);\n\n        // fix &curren; entity in the links\n        html = html.replace(/t/gi, '&current');\n\n        // encode\n        if (start && this.app.editor.isTextarea()) {\n            html = this.app.content.encodeCode(html);\n        }\n\n        // sanitize\n        html = this.app.content.sanitize(html);\n\n        // convert\n        html = this._convertFrames(html);\n        html = this._convertForms(html);\n\n        // store\n        html = this.app.content.store(html, 'noneditable', stored, storedIndex);\n        html = this.app.content.store(html, 'embed', stored, storedIndex);\n\n        // remove denied tags\n        html = this.app.content.removeTags(html, this.opts.tags.denied);\n\n        // remove doctype tag\n        html = this.app.content.removeDoctype(html);\n\n        // remove style & script tag\n        html = this.app.content.removeTagsWithContent(html, ['script', 'style']);\n\n        // remove empty spans\n        html = this.app.content.removeEmptySpans(html);\n\n        // add https for links and images\n        html = this.app.content.addHttps(html);\n\n        // remove block tags in\n        html = this.app.content.removeBlockTagsInside(html, ['th', 'td', 'li', 'dt', 'dd', 'address']);\n\n        // cache styles for block and inline tags and img\n        html = this.app.content.cacheStyle(html);\n\n        // restore\n        html = this.app.content.restore(html, 'noneditable', stored);\n        html = this.app.content.restore(html, 'embed', stored);\n\n        // restore comments\n        html = this.app.content.restoreComments(html, storedComments);\n\n        // remove comments\n        if (this.opts.clean.comments) {\n            html = this.app.content.removeComments(html);\n        }\n\n        // empty or paragraphize\n        if (this.app.content.isEmptyHtml(html)) {\n            html = this.app.block.createHtml();\n        }\n        else {\n            html = this.app.content.paragraphize(html);\n        }\n\n        return html;\n    },\n    _parse: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            var nodes = this.app.element.getBlocks($w);\n            for (var i = 0; i < nodes.length; i++) {\n                this._parseHtml(nodes[i]);\n            }\n\n            // predefined classes\n            this.buildPredefinedClasses($w);\n\n        }.bind(this));\n    },\n    _parseHtml: function(el) {\n        var tag = el.tagName.toLowerCase();\n        var $el = this.dom(el);\n        var type;\n\n        // check custom\n        var parser = this.opts.parserTags;\n        if (parser[tag]) {\n            for (var i = 0; i < parser[tag].length; i++) {\n                type = parser[tag][i].call(this.app, $el);\n                if (type) break;\n            }\n        }\n\n        if (!type) {\n            type = this._parseType($el, tag);\n        }\n\n        // set\n        if (type) {\n            $el.attr('data-' + this.prefix + '-type', type);\n\n            // check image tag\n            if (type === 'image') {\n                if (tag !== this.opts.image.tag) {\n                    $el = this.app.element.replaceToTag($el, this.opts.image.tag, true);\n                }\n            }\n\n            // nested\n            if (this.opts.nested.indexOf(type) !== -1) {\n                this._parseNested($el);\n            }\n        }\n    },\n    _parseType: function($el, tag) {\n        var type;\n        if ($el.attr('data-' + this.prefix + '-type')) {\n            type = $el.attr('data-' + this.prefix + '-type');\n        }\n        else if (this._isNoneditable($el)) {\n            type = 'noneditable';\n        }\n        else {\n            type = this._parseTypeByTag($el, tag);\n        }\n\n        return type;\n    },\n    _parseNested: function($el) {\n        var nodes = this.app.element.getBlocks($el);\n        for (var i = 0; i < nodes.length; i++) {\n            this._parseHtml(nodes[i]);\n        }\n    },\n    _parseTypeByTag: function($el, tag) {\n        var type;\n        switch (tag) {\n            case 'p':\n                type = 'paragraph';\n                if (this._isImageBlock($el, 'p')) {\n                    type = 'image';\n                }\n                break;\n            case 'figure':\n                type = 'embed';\n                if (this._isImageBlock($el, 'figure')) {\n                    type = 'image';\n                }\n                else if (this._hasChild($el, 'pre')) {\n                    type = 'code';\n                }\n                else if (this._hasChild($el, 'blockquote')) {\n                    type = 'quote';\n                }\n                break;\n            case 'div':\n                type = 'layer';\n                if ($el.attr('data-' + this.prefix + '-type')) {\n                    type = false;\n                }\n                else if (this._isGridBlock($el)) {\n                    type = 'grid';\n                }\n                else if (this._isColumnBlock($el)) {\n                    type = 'column';\n                }\n                else if (this._isTextBlock($el)) {\n                    type = 'text';\n                }\n                else if (this._isCardBlock($el)) {\n                    type = 'card';\n                }\n                else if (this._isImageBlock($el, 'div')) {\n                    type = 'image';\n                }\n                break;\n            case 'h1':\n            case 'h2':\n            case 'h3':\n            case 'h4':\n            case 'h5':\n            case 'h6':\n                type = 'heading';\n                break;\n            case 'blockquote':\n                type = 'quote';\n                break;\n            case 'table':\n                type = 'table';\n                break;\n            case 'pre':\n                type = 'code';\n                break;\n            case 'hr':\n                type = 'line';\n                break;\n            case 'dl':\n                type = 'dlist';\n                break;\n            case 'address':\n                type = 'address';\n                break;\n            case 'ul':\n            case 'ol':\n                type = 'list';\n                break;\n            case 'main':\n            case 'section':\n            case 'header':\n            case 'footer':\n            case 'aside':\n            case 'article':\n                type = 'layer';\n                break;\n            default:\n                break;\n        }\n\n        return type;\n    },\n\n    // is\n    _isNoneditable: function($el) {\n        return $el.hasClass(this.opts.noneditable.classname);\n    },\n    _isColumnBlock: function($el) {\n        if (!this.opts.grid) return;\n\n        var $parent = $el.parent();\n        if ($parent.length !== 0 && $parent.attr('data-' + this.prefix +'-type') === 'grid') {\n            return true;\n        }\n    },\n    _isGridBlock: function($el) {\n        if (!this.opts.grid) return;\n\n        return $el.hasClass(this.opts.grid.classname);\n    },\n    _isTextBlock: function($el) {\n        return (this.opts.text && $el.hasClass(this.opts.text.classname));\n    },\n    _isCardBlock: function($el) {\n        return (this.opts.card && $el.hasClass(this.opts.card.classname));\n    },\n    _isImageBlock: function($el, tag) {\n        var $img = $el.find('img');\n        if ($img.length === 0) return;\n        if (tag === 'div' && $img.closest('figure').length !== 0) return;\n\n        var $target = $img;\n        var $parent = $img.parent();\n        var parentTag = ($parent.length !== 0) ? $parent.get().tagName : false;\n\n        if (parentTag && (parentTag === 'A' || parentTag === 'SPAN')) {\n            $target = $parent;\n        }\n        else if (parentTag && $parent.get() !== $el.get()) {\n            return;\n        }\n\n        if ($target.prevElement().length !== 0) return;\n        if (tag !== 'figure' && $target.nextElement().length !== 0) return;\n\n        return true;\n    },\n\n    // has\n    _hasChild: function($el, tag) {\n        if (tag === 'pre') {\n            var $pre = $el.find('pre');\n            if ($pre.length !== 0) {\n                return true;\n            }\n        }\n        else if (tag === 'blockquote') {\n            var $quote = $el.find('blockquote');\n            var $script = $el.find('script');\n            if ($script.length === 0 && $quote.length !== 0) {\n                return true;\n            }\n        }\n    },\n\n    // get\n    _getPredefinedTags: function() {\n        var tags = [];\n        Object.keys(this.opts.classes).forEach(function(key) {\n            tags.push(key);\n        });\n\n        return tags;\n    },\n\n    // add\n    _addPredefinedClass: function($node) {\n        var tag = $node.get().tagName.toLowerCase();\n        if (typeof this.opts.classes[tag] !== 'undefined') {\n            $node.addClass(this.opts.classes[tag]);\n        }\n    },\n\n    // unparse\n    _unparseAllTags: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('*').removeAttr('contenteditable data-gramm_editor');\n\n             // remove images states\n             if (!this.opts.image.states) {\n                 $w.find('img').removeAttr('data-image');\n             }\n\n\n        }.bind(this));\n    },\n    _unparseDataType: function(html, state) {\n        return this.app.utils.wrap(html, function($w) {\n            var $elms = $w.find('[data-' + this.prefix + '-type]');\n\n            if (state !== true) {\n                $elms.removeClass(this.prefix + '-block-state');\n            }\n\n            $elms.removeAttr('data-' + this.prefix + '-first-level data-' + this.prefix + '-parsed');\n            $elms.removeClass(this.prefix + '-block-focus ' + this.prefix + '-block-multiple-focus ' + this.prefix + '-block-multiple-hover ' + this.prefix + '-editable-pause');\n            $elms.removeClass(this.prefix + '-empty-layer');\n            $elms.each(this._unparseByType.bind(this));\n            $elms.removeAttr('data-' + this.prefix + '-type');\n            $w.find('figcaption').removeAttr('data-' + this.prefix + '-type data-placeholder').each(this.app.content._removeEmptyTag.bind(this));\n\n        }.bind(this));\n    },\n    _unparseByType: function($node) {\n        var type = $node.attr('data-' + this.prefix + '-type');\n\n        if (type === 'list') {\n            this.app.content.unfixListMargin($node);\n        }\n\n        if (this.opts.parser[type] && this.opts.parser[type].unparse) {\n            this.opts.parser[type].unparse.call(this.app, $node);\n        }\n    },\n\n    // convert\n    _convertFrames: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('iframe').each(this._convertFrame.bind(this));\n        }.bind(this));\n    },\n    _convertForms: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('form').each(this._convertForm.bind(this));\n        }.bind(this));\n    },\n    _convertFrame: function($node) {\n        if ($node.closest('figure').length === 0) {\n            $node.wrap('<figure>');\n            $node.parent().addClass(this.prefix + '-figure-iframe');\n        }\n    },\n    _convertForm: function($node) {\n        var $el = this.app.element.replaceToTag($node, 'figure');\n        $el.addClass(this.prefix + '-figure-form');\n        $el.attr('data-' + this.prefix + '-type', 'form');\n    },\n\n    // revert\n    _revertFrames: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('.' + this.prefix + '-figure-iframe').each(this._revertFrame.bind(this));\n        }.bind(this));\n    },\n    _revertForms: function(html) {\n        return this.app.utils.wrap(html, function($w) {\n            $w.find('.' + this.prefix + '-figure-form').each(this._revertForm.bind(this));\n        }.bind(this));\n    },\n    _revertFrame: function($node) {\n        var $figcaption = $node.find('figcaption');\n        if ($figcaption.length !== 0) {\n            $node.removeClass(this.prefix + '-figure-iframe');\n        }\n        else {\n            $node.unwrap();\n        }\n    },\n    _revertForm: function($node) {\n        var $el = this.app.element.replaceToTag($node, 'form');\n        $el.removeClass(this.prefix + '-figure-form');\n    }\n});\nArticleEditor.add('module', 'blocks', {\n    build: function() {\n        this._buildFirstLevel();\n    },\n    is: function() {\n        return (this.getSelected().length > 1);\n    },\n    set: function($block) {\n        $block = $block.closest('[data-' + this.prefix + '-first-level]');\n\n        // unset not first level\n        this.unsetNotFirstLevel();\n\n        // set focus class\n        this._setFocus($block);\n        setTimeout(function() {\n            this.app.selection.removeAllRanges();\n        }.bind(this), 0);\n\n        // ui\n        this.app.path.build();\n        this.app.toolbar.build();\n        this.app.control.close();\n\n        // check all or one selected\n        this._checkSelected();\n    },\n    setFirstLevel: function() {\n        this.app.blocks.getFirstLevel().addClass(this.prefix + '-block-focus');\n    },\n    unset: function() {\n        this.getBlocks().removeClass(this.prefix + '-block-focus ' + this.prefix + '-block-multiple-hover');\n    },\n    unsetNotFirstLevel: function() {\n        this.getBlocks().not('[data-' + this.prefix + '-first-level]').removeClass(this.prefix + '-block-focus');\n    },\n    unsetHover: function() {\n        this.getBlocks().removeClass(this.prefix + '-block-multiple-hover');\n    },\n    getBlocks: function() {\n        return this.app.editor.getLayout().find('[data-' + this.prefix + '-type]');\n    },\n    getFirstLevel: function() {\n        return this.app.editor.getLayout().find('[data-' + this.prefix + '-first-level]');\n    },\n    getEditableBlocks: function() {\n        return this.app.editor.getLayout().find('[contenteditable=true]');\n    },\n    getSelected: function() {\n        return this.app.editor.getLayout().find('.' + this.prefix + '-block-focus');\n    },\n    getSelectedBlocks: function() {\n        return this.getSelectedBlocks();\n    },\n    getFirst: function() {\n        return this.getBlocks().first().dataget('instance');\n    },\n    getFirstSelected: function() {\n        return this.getSelected().first().dataget('instance');\n    },\n    getLast: function() {\n        return this.getBlocks().last().dataget('instance');\n    },\n    getLastSelected: function() {\n        return this.getSelected().last().dataget('instance');\n    },\n    pauseEditableBlocks: function() {\n        this.getEditableBlocks().attr('contenteditable', false).addClass(this.prefix + '-editable-pause');\n    },\n    runEditableBlocks: function() {\n        var $blocks = this.app.editor.getLayout().find('.' + this.prefix + '-editable-pause');\n        $blocks.attr('contenteditable', true).removeClass(this.prefix + '-editable-pause');\n    },\n    removeSelected: function(traverse) {\n        var last = this.getLastSelected();\n        var next;\n        if (traverse !== false && last) {\n            next = last.getNext();\n        }\n\n        // remove\n        this.getSelected().each(this._removeSelectedBlock.bind(this));\n\n        // traverse\n        if (next) {\n            this.app.block.set(next, 'start');\n        }\n    },\n\n    // private\n    _buildFirstLevel: function() {\n        var name = 'data-' + this.prefix + '-first-level';\n        var $layout = this.app.editor.getLayout();\n\n        $layout.find('[' + name + ']').removeAttr(name);\n        $layout.children('[data-' + this.prefix + '-type]').attr(name, true);\n    },\n    _checkSelected: function() {\n        var $all = this.getFirstLevel();\n        var $selected = this.getSelected();\n        if ($selected.length === 0) {\n            this.unsetHover();\n            this.app.block.unset();\n        }\n        else if ($selected.length === 1) {\n            this.unsetHover();\n            this.app.block.set($selected.eq(0), false, true);\n        }\n        else if ($all.length === $selected.length) {\n            this.unsetHover();\n            this.app.editor.selectAll();\n        }\n        else {\n            this.app.editor.unsetSelectAllClass();\n        }\n    },\n    _setFocus: function($block) {\n       var func = ($block.hasClass(this.prefix + '-block-focus')) ? 'removeClass' : 'addClass';\n\n       $block[func](this.prefix + '-block-focus');\n       $block.removeClass(this.prefix + '-block-multiple-hover');\n    },\n    _removeSelectedBlock: function($node) {\n        var instance = $node.dataget('instance');\n        instance.remove({ traverse: false });\n    }\n});\nArticleEditor.add('module', 'block', {\n    init: function() {\n        this.instance = false;\n        this.$block = false;\n    },\n    create: function(html) {\n        var instance = this.app.create('block.' + this.opts.editor.markup);\n        if (html) instance.getBlock().html(html);\n\n        return instance;\n    },\n    createHtml: function(html) {\n        return this.create(html).getOuterHtml();\n    },\n    is: function($el) {\n        return ($el) ? this._isBlockActive($el) : this.get();\n    },\n    isType: function(type) {\n        if (!this.is()) return;\n        return this.get().isType(type);\n    },\n    isParent: function(type) {\n        if (!this.is()) return;\n\n        var types = (Array.isArray(type)) ? type : [type];\n        var $block = this.get().getBlock();\n        var $blocks = this.app.element.getParents($block, types);\n\n        return ($blocks.length !== 0);\n    },\n    get: function() {\n        return this.instance;\n    },\n    set: function(el, caret, force) {\n        // is instance\n        if (el.isBlock) {\n            el = el.getBlock();\n        }\n\n        // check if active\n        if (force !== true && this._isBlockActive(el)) return;\n\n        // unset\n        this.unset();\n\n        // set\n        this.instance = this._getInstance(el);\n        this.$block = this.instance.getBlock();\n        this.$block.addClass(this.prefix + '-block-focus');\n\n        // caret\n        this._setCaret(caret);\n\n        // ui\n        this.app.path.build();\n        this.app.toolbar.build();\n        this.app.control.build();\n\n        // broadcast\n        this.app.broadcast('block.set');\n    },\n    unset: function() {\n        if (!this.instance) return;\n\n        this.instance = false;\n        this.$block = false;\n\n        // unset\n        this.app.blocks.unset();\n        this.app.editor.unsetSelectAllClass();\n\n        // ui\n        this.app.path.build();\n        this.app.toolbar.build();\n        this.app.control.close();\n\n        // broadcast\n        this.app.broadcast('block.unset');\n    },\n    duplicate: function() {\n        if (!this._isAction()) return;\n\n        var instance = this.get();\n        var clone = instance.duplicate();\n        var newInstance = instance.insert({\n            instance: clone,\n            position: 'after',\n            caret: 'start',\n            type: 'duplicate'\n        });\n\n        this.app.broadcast('block.duplicate', { instance: newInstance });\n\n        return newInstance;\n    },\n    moveUp: function() {\n        if (!this._isAction()) return;\n        this.get().moveUp();\n    },\n    moveDown: function() {\n        if (!this._isAction()) return;\n        this.get().moveDown();\n    },\n    change: function(instance) {\n        if (!this.is()) return;\n\n        var current = this.get();\n        var $block = current.getBlock();\n        var $newBlock = instance.getBlock();\n\n        $block.after($newBlock);\n        $block.remove();\n\n        // rebuild\n        this.app.parser.buildElement($newBlock);\n        this.app.editor.build();\n\n        // set\n        this.set(instance);\n\n        // broadcast\n        this.app.broadcast('block.change', { instance: instance });\n    },\n    add: function(params) {\n\n        this.app.popup.close();\n\n        var current = this.get();\n        if (params.type && params.type === 'image' && (current && current.getType() === 'cell')) {\n            current = current.getParent('table');\n        }\n\n        var remove = false;\n        var position = false;\n\n        // create\n        var newInstance = (params.instance) ? params.instance : this.app.create('block.' + params.name, params.source);\n\n        // all selected\n        if (this.app.editor.isAllSelected()) {\n            current = this.create();\n            this.app.editor.unsetSelectAllClass();\n            this.app.editor.getLayout().html('').append(current.getBlock());\n            position = 'after';\n            remove = true;\n        }\n        // blocks\n        else if (this.app.blocks.is()) {\n            current = this.app.blocks.getLastSelected();\n            position = 'after';\n        }\n        // not selected\n        else if (!current) {\n            if (this.opts.editor.add === 'top') {\n                current = this.app.blocks.getFirst();\n                position = 'before';\n            }\n            else {\n                current = this.app.blocks.getLast();\n                position = 'after';\n            }\n        }\n        // like variable\n        else if (current.isInlineBlock()) {\n            if (newInstance.getType() !== 'variable') {\n                var parent = current.getParent();\n                this.app.caret.set(current.getBlock(), 'after');\n                this.app.block.set(parent);\n                current = this.get();\n            }\n        }\n        // empty emptiable\n        else if (current.isEmptiable() && current.isEmpty()) {\n            var $block = current.getBlock();\n\n            $block.removeClass(this.prefix + '-empty-layer');\n            $block.html('');\n            position = 'append';\n        }\n\n        // position\n        position = (params.position) ? params.position : position;\n\n        var currentremove = true;\n        if (current) {\n            var type = current.getType();\n            var types = ['paragraph', 'text', 'heading'];\n            // adding new paragraph without removing current empty\n            if (params.name === 'paragraph' && types.indexOf(type) !== -1) {\n                currentremove = false;\n            }\n        }\n\n        // insert\n        current.insert({\n            instance: newInstance,\n            position: position,\n            caret: (params.caret) ? params.caret : 'end',\n            remove: currentremove,\n            type: 'add'\n        });\n\n        if (remove) {\n            current.remove();\n        }\n\n        return newInstance;\n    },\n    format: function(params) {\n        this.app.format.set(params);\n    },\n    remove: function(params) {\n        var instance = this.get();\n        if (!instance) return;\n\n        var type = instance.getType();\n        var parent = instance.getParent();\n        var isTraverse = (params && typeof params.traverse !== 'undefined' && params.traverse === false) ? false : true;\n        if (isTraverse) {\n            var next = instance.getNext();\n            var prev = instance.getPrev();\n            instance.remove();\n\n            if (next) {\n                this.app.block.set(next, 'start');\n            }\n            else if (prev) {\n                this.app.block.set(prev, 'end');\n            }\n            else {\n                this.unset();\n            }\n        }\n        else {\n            this.unset();\n            instance.remove();\n        }\n\n        // broadcast image\n        if (type === 'image') {\n            this.app.broadcast('image.remove', {\n                url: instance.getSrc(),\n                id: instance.getId()\n            });\n        }\n\n        // broadcast\n        this.app.broadcast('block.remove', { type: type, parent: parent });\n\n        // check empty\n        if (this.app.editor.isEmpty()) {\n            this.app.editor.setEmpty();\n        }\n    },\n    observe: function(obj, name) {\n        var types = ['line', 'quote', 'layer', 'code'];\n        if (types.indexOf(name) !== -1 && !this.opts[name]) return false;\n\n        // align / valign / outset\n        if (name === 'alignment' && !this.opts.align) return false;\n        if (name === 'valign' && !this.opts.valign) return false;\n        if (name === 'outset' && !this.opts.outset) return false;\n    },\n    observeCard: function(obj, name) {\n        if (name === 'image') {\n            var instance = this.get();\n            if (!instance.hasImage()) return false;\n        }\n    },\n    popup: function(params, button, name) {\n\n        // alignment\n        var form;\n        if (name === 'alignment') {\n            form = this._buildSegments('align', 'alignment');\n        }\n        // valign\n        else if (name === 'valign') {\n            form = this._buildSegments('valign');\n        }\n        // outset\n        else if (name === 'outset') {\n            form = this._buildSegments('outset');\n        }\n\n        // popup\n        this.app.popup.create(name, {\n            setter: 'block.setData',\n            getter: 'block.getData',\n            form: form\n        });\n\n        this.app.popup.open({ button: button });\n    },\n    css: function(name, value) {\n        if (!this.is()) return;\n\n        var $el = this.get().getBlock();\n        $el.css(name, value);\n\n        // save\n        name = 'data-' + this.prefix + '-style-cache';\n        var style = $el.attr('style');\n        if (style) {\n            style = style.replace(/\"/g, '');\n            $el.attr(name, style);\n        }\n    },\n\n    // data\n    getData: function() {\n        if (!this.is()) return;\n\n        var instance = this.get();\n        return instance.getData();\n    },\n    setData: function(stack) {\n        if (!this.is()) return;\n\n        var data = stack.getData();\n        var instance = this.get();\n        instance.setData(data);\n    },\n\n    // private\n    _isBlockActive: function(el) {\n        if (this.app.blocks.is()) return false;\n        return (this.instance && (this.dom(el).get() === this.$block.get()));\n    },\n    _isAction: function() {\n        return (!this.app.blocks.is() && this.is());\n    },\n    _buildSegments: function(name, title) {\n        var form = {};\n        var segments = {};\n        var obj = this.opts[name];\n        for (var key in obj) {\n            if (!obj[key]) continue;\n            segments[key] = { name: obj[key], prefix: name };\n        }\n\n        title = title || name;\n        form[name] = {\n            type: 'segment',\n            label: '## form.' + title + ' ##',\n            segments: segments\n        };\n\n        return form;\n    },\n    _appendToEmptyBlock: function(instance) {\n        var emptyBlock = this.app.block.create();\n        emptyBlock.append(instance);\n\n        return emptyBlock.getBlock();\n    },\n    _getInstance: function(el) {\n        return this.dom(el).dataget('instance');\n    },\n    _setCaret: function(caret) {\n\n        if (this.instance.isEditable()) {\n            if (caret) {\n                var $target = this.$block;\n                if (this.instance.getType() === 'list' && (caret === 'start' || caret === 'end')) {\n                    $target = (caret === 'start') ? this.$block.find('li').first() : this.$block.find('li').last();\n                }\n\n                this.app.caret.set($target, caret);\n            }\n        }\n        else {\n            this.app.scroll.save();\n            this.app.editor.getWin().focus();\n            this.$block.focus();\n            setTimeout(function() {\n                this.app.selection.removeAllRanges();\n            }.bind(this), 0);\n            this.app.scroll.restore();\n        }\n    }\n});\nArticleEditor.add('module', 'event', {\n    init: function() {\n        // local\n        this.dragoverEvent = false;\n        this.imageDrag = false;\n        this.pressedCmd = false;\n        this.isPopupMouseUp = false;\n        this.isBlockMouseUp = false;\n        this.pasteEvent = false;\n\n        // events\n        this.events = {\n            frame: ['click', 'contextmenu', 'touchstart', 'mouseover', 'mouseup', 'mousedown', 'keydown', 'keyup',\n                    'paste', 'copy', 'cut', 'drop', 'dragstart', 'dragover', 'dragleave'],\n            doc: ['keydown', 'mousedown', 'click'],\n            win: ['focus'],\n            editor: ['click']\n        };\n    },\n    run: function() {\n        this._runEvents();\n    },\n    pause: function() {\n        this._pauseEvents();\n    },\n    build: function() {\n        this._buildTargets();\n        this._buildPreventLinks();\n        this._buildEvents();\n    },\n    stop: function() {\n        var eventname = this.prefix + '-events';\n\n        this.$body.off('.' + eventname);\n        this.$win.off('.' + eventname);\n        this.app.$doc.off('.' + eventname);\n    },\n\n    // on\n    onmouseover: function(e) {\n        // multiple hover\n        this._buildHover(e);\n\n        // broadcast\n        this.app.broadcast('editor.mouseover', { e: e });\n    },\n    oncontextmenu: function(e) {\n        if (this.pressedCmd) {\n            e.preventDefault();\n            var $block = this._getBlock(e);\n            this.app.blocks.set($block);\n        }\n    },\n    onclick: function(e) {\n        this.app.broadcast('editor.click', { e: e });\n        if (this._isEditorClick(e) && !this.isBlockMouseUp) {\n            this._setByClick(e);\n        }\n    },\n    onmouseup: function(e) {\n        // state\n        this.app.state.add(e);\n\n        // broadcast\n        this.app.broadcast('editor.mouseup', { e: e });\n\n        // ui\n        this.app.toolbar.observe();\n    },\n    onmousedown: function(e) {\n        if (this.app.popup.isOpen()) {\n            this.app.popup.close();\n        }\n\n        this._setBlock(e);\n        this._setCaretInline(e);\n        this.app.placeholder.handleClick(e);\n\n        if (this._isEditorClick(e)) {\n            this.isBlockMouseUp = false;\n            return;\n        }\n        else {\n            this.isBlockMouseUp = true;\n        }\n\n        // state\n        this.app.state.add(e);\n\n        // broadcast\n        this.app.broadcast('editor.mousedown', { e: e });\n    },\n    ontouchstart: function(e) {\n        // state\n        this.app.state.add(e);\n    },\n    onkeydown: function(e) {\n        // broadcast\n        var event = this.app.broadcast('editor.keydown', this._buildEventKeysObj(e));\n        if (event.isStopped()) return e.preventDefault();\n\n        // enter key\n        if (this.opts.editor.enterKey === false && e.which === 13) {\n            e.preventDefault();\n            return;\n        }\n\n        // listen undo & redo\n        if (this.app.state.listen(e)) {\n            this.pressedCmd = false;\n            return;\n        }\n\n        this.pressedCmd = this._isCmdPressed(e);\n\n        // esc\n        if (this._isEsc(e)) {\n            this.app.block.unset();\n            this.app.selection.removeAllRanges();\n        }\n\n        // handle shortcut\n        if (this.app.shortcut.handle(e)) {\n            this.pressedCmd = false;\n            return;\n        }\n\n        // release keydown\n        this.app.input.handle(event);\n    },\n    onkeyup: function(e) {\n        // broadcast\n        var event = this.app.broadcast('editor.keyup', this._buildEventKeysObj(e));\n        if (event.isStopped()) return e.preventDefault();\n\n        // catch tab\n        var key = e.which;\n        if (key === this.app.keycodes.TAB && !this.app.block.is()) {\n            if (e.target && e.target.tagName === 'BODY') {\n                var $first = this.app.blocks.getFirst();\n\n                this.app.editor.setFocus();\n                this.app.block.set($first);\n            }\n            else {\n                this._setBlock(e);\n            }\n        }\n\n        this.pressedCmd = false;\n        this.app.blocks.unsetHover();\n\n        // ui\n        this.app.toolbar.observe();\n    },\n    onpaste: function(e) {\n        this._paste(e);\n    },\n    oncopy: function(e) {\n        this._copy(e);\n    },\n    oncut: function(e) {\n        this._cut(e);\n    },\n    ondrop: function(e) {\n        if (!this.opts.editor.drop) return e.preventDefault();\n\n        // broadcast\n        var event = this.app.broadcast('editor.drop', { e: e });\n        if (event.isStopped()) return e.preventDefault();\n\n        // drop\n        var html;\n        var dt = e.dataTransfer;\n        var item = dt.getData('item');\n        if (item !== '') {\n            e.preventDefault();\n\n            if (this.opts.draggable && typeof this.opts.draggable[item] !== 'undefined') {\n                html = this.opts.draggable[item];\n            }\n            else {\n                html = this.dom('[data-' + this.prefix + '-drop-item=' + item + ']').html();\n                html = html.trim();\n            }\n\n            // drop\n            if (html) {\n                var position = 'after';\n                var $over = this.app.editor.getBody().find('.' + this.prefix + '-draggable-over');\n                if ($over.length !== 0) {\n                    position = 'append';\n                }\n\n                this._drop(e, html, position, false);\n            }\n        }\n        else if (this.opts.image && this.opts.image.upload && dt.files !== null && dt.files.length > 0) {\n            e.preventDefault();\n            this.app.image.drop(e, dt);\n        }\n        else {\n            html = dt.getData(\"text/html\");\n            html = (html.trim() === '') ? dt.getData('Text') : html;\n\n            // drop\n            var dropped = this._drop(e, html);\n\n            if (this.imageDrag && dropped.instances.length !== 0) {\n                var instance = dropped.instances[0];\n                instance.change(this.imageDrag, false);\n            }\n        }\n\n        this._removeDragPlaceholder();\n\n        this.imageDrag = false;\n        this.app.observer.trigger = true;\n    },\n    ondragstart: function(e) {\n        var $block = this._getBlock(e.target);\n        if ($block.length !== 0 && this.app.element.getType($block) === 'image') {\n            this.imageDrag = $block.dataget('instance');\n        }\n\n        // broadcast\n        this.app.broadcast('editor.dragstart', { e: e });\n    },\n    ondragover: function(e) {\n        e.preventDefault();\n        this.dragoverEvent = true;\n        this.app.observer.trigger = false;\n        this._removeDragPlaceholder();\n\n        // data\n        var types = e.dataTransfer.types;\n        if (types.indexOf('item') !== -1) {\n            var $block = this._getBlock(e.target);\n            if ($block.length !== 0) {\n\n                var instance = $block.dataget('instance');\n                if (instance.getType('layer') && instance.isEmpty()) {\n                    $block.addClass(this.prefix + '-draggable-over');\n                }\n                else {\n                    var $pl = this.dom('<div>').addClass(this.prefix + '-draggable-placeholder');\n                    $block.after($pl);\n                }\n            }\n        }\n\n        // broadcast\n        this.app.broadcast('editor.dragover', { e: e });\n    },\n    ondragleave: function(e) {\n        e.preventDefault();\n        this.dragoverEvent = false;\n\n        this._removeDragPlaceholder();\n        this.app.observer.trigger = true;\n\n        // broadcast\n        this.app.broadcast('editor.dragleave', { e: e });\n    },\n\n    // on editor (frame doc)\n    oneditorclick: function(e) {\n        if (e.target.tagName === 'HTML') {\n            this._setByClick(e);\n        }\n    },\n\n    // on win\n    onwinfocus: function(e) {\n        if (this._isRemoveRanges()) {\n            setTimeout(function() {\n                this.app.selection.removeAllRanges();\n            }.bind(this), 0);\n            return;\n        }\n    },\n\n    // on doc\n    ondockeydown: function(e) {\n        if (this.app.popup.isOpen()) {\n            if (this._isEnter(e)) {\n                var stack = this.app.popup.getStack();\n                if (stack.hasForm() !== false && e.target.tagName !== 'TEXTAREA') {\n                    e.preventDefault();\n                    var $btn = stack.getFooterPrimary();\n                    $btn.dataget('instance').invokeCommand();\n                    return;\n                }\n            }\n\n            if (this._isEsc(e)) {\n                this.app.popup.close(false);\n            }\n        }\n    },\n    ondocmousedown: function(e) {\n        this.isPopupMouseUp = (this.dom(e.target).closest('.' + this.prefix + '-popup-' + this.uuid).length !== 0);\n    },\n    ondocclick: function(e) {\n        if (!this._isOutsideEditor(e)) return;\n\n        if (this.app.popup.isOpen()) {\n            if (this.isPopupMouseUp === false) this.app.popup.close(false);\n        }\n        else {\n            this.app.editor.setBlur();\n        }\n\n        this.pressedCmd = false;\n    },\n\n    // private\n    _buildPreventLinks: function() {\n        var eventname = this.prefix + '-prevent-events';\n        this.$body.on('click.' + eventname  + ' dblclick.' + eventname, this._preventLinks.bind(this));\n    },\n    _buildTargets: function() {\n        this.$body = this.app.editor.getBody();\n        this.$win = this.app.editor.getWin();\n    },\n    _buildEventKeysObj: function(e) {\n        var key = e.which;\n        var arrowKeys = [this.app.keycodes.UP, this.app.keycodes.DOWN, this.app.keycodes.LEFT, this.app.keycodes.RIGHT];\n        var isAlphaKeys = ((!e.ctrlKey && !e.metaKey) && ((key >= 48 && key <= 57) || (key >= 65 && key <= 90)));\n        var k = this.app.keycodes;\n\n        return {\n            'e': e,\n            'key': key,\n            'ctrl': (e.ctrlKey || e.metaKey),\n            'shift': (e.shiftKey),\n            'alt': (e.altKey),\n            'select': ((e.ctrlKey || e.metaKey) && !e.altKey && key === 65),\n            'enter': (key === k.ENTER),\n            'space': (key === k.SPACE),\n            'esc': (key === k.ESC),\n            'tab': (key === k.TAB && !e.shiftKey && !e.altKey && !e.ctrlKey && !e.metaKey),\n            'delete': (key === k.DELETE),\n            'backspace': (key === k.BACKSPACE),\n            'alpha': isAlphaKeys,\n            'arrow': (arrowKeys.indexOf(key) !== -1),\n            'left': (key === k.LEFT),\n            'right': (key === k.RIGHT),\n            'up': (key === k.UP),\n            'down': (key === k.DOWN),\n            'left-right': (key === k.LEFT || key === k.RIGHT),\n            'up-left': (key === k.UP || key === k.LEFT),\n            'down-right': (key === k.DOWN || key === k.RIGHT)\n        };\n    },\n    _buildEvents: function() {\n        var eventname = this.prefix + '-events';\n\n        this._buildTargetEvents(this.$body, this.events.frame, eventname, '');\n        this._buildTargetEvents(this.$win, this.events.win, eventname, 'win');\n        this._buildTargetEvents(this.app.$doc, this.events.doc, eventname, 'doc');\n        this._buildTargetEvents(this.app.editor.getDoc(), this.events.editor, eventname, 'editor');\n    },\n    _buildTargetEvents: function($target, events, eventname, type) {\n        for (var i = 0; i < events.length; i++) {\n            $target.on(events[i] + '.' + eventname, this['on' + type + events[i]].bind(this));\n        }\n    },\n    _buildHover: function(e) {\n        var instance = this.app.block.get();\n\n        // check pressed & instance\n        if (!this.pressedCmd || !instance) return;\n\n        var $block = this.dom(e.target).closest('[data-' + this.prefix + '-first-level]');\n        if ($block.length === 0) return;\n\n        // unset\n        this.app.blocks.unsetHover();\n\n        // build hover\n        if (!$block.hasClass(this.prefix + '-block-focus')) {\n            $block.addClass(this.prefix + '-block-multiple-hover');\n        }\n    },\n    _runEvents: function() {\n        var eventname = this.prefix + '-events';\n\n        this._buildTargetEvents(this.$body, this.events.frame, eventname, '');\n        this._buildTargetEvents(this.$win, this.events.win, eventname, 'win');\n    },\n    _pauseEvents: function() {\n        var eventname = this.prefix + '-events';\n\n        if (this.$body) {\n            this.$body.off('.' + eventname);\n            this.$win.off('.' + eventname);\n        }\n    },\n    _getBlock: function(target) {\n        return this.dom(target).closest('[data-' + this.prefix + '-type]');\n    },\n    _setByClick: function(e) {\n        var blocks = this.app.blocks.getFirstLevel();\n        var coords = [];\n        blocks.each(function($node) {\n            var rect = $node.get().getBoundingClientRect();\n            coords.push([rect.x, rect.y, rect.y + rect.height]);\n        });\n\n        var distances = [];\n        var heightIndex = false;\n        coords.forEach(function(coord, index) {\n            var y = parseInt(e.clientY);\n            var x = parseInt(e.clientX);\n            if (coord[1] < y && y < coord[2]) {\n                heightIndex = index;\n                return;\n            }\n            var distance = Math.hypot(coord[0]-x, coord[1]-y);\n            distances.push(parseInt(distance));\n        });\n\n        var closestIndex = (heightIndex !== false) ? heightIndex : distances.indexOf(Math.min.apply(Math, distances));\n\n        var $block = blocks.eq(closestIndex);\n        this.app.block.set($block.dataget('instance'), 'start');\n        this.app.editor.setFocus();\n    },\n    _setCaretInline: function(e) {\n        var instance = this.app.block.get();\n        var code = false;\n        if (instance && instance.isEditable()) {\n            // svg or img\n            if (this.app.element.isEmptyOrImageInline(e.target)) {\n                this.app.caret.set(e.target, 'after');\n            }\n            // code\n            else if (this.app.selection.isCollapsed() && e.target.tagName === 'CODE') {\n                code = true;\n                setTimeout(function() {\n                    var current = this.app.selection.getElement();\n                    if (current && code && current.tagName !== 'CODE') {\n                        this.app.caret.set(e.target, 'start');\n                        code = false;\n                    }\n                }.bind(this), 1);\n            }\n        }\n    },\n    _setBlock: function(e) {\n        // set focus event\n        this.app.editor.setFocus();\n\n        var $block = (e) ? this._getBlock(e.target) : this.app.selection.getDataBlock();\n        if ($block.length === 0) return;\n\n        // prevent contenteditable false focus\n        if ($block.attr('contenteditable') === false) {\n            e.preventDefault();\n        }\n\n        // multiple\n        if (this.pressedCmd) {\n            if (e) e.preventDefault();\n            this.app.blocks.set($block);\n        }\n        // single\n        else {\n            this.app.block.set($block);\n        }\n    },\n    _isRemoveRanges: function() {\n        var instance = this.app.block.get();\n        return (this.app.blocks.is() || (instance && instance.isInlineBlock()));\n    },\n    _isEsc: function(e) {\n        return (e.which === this.app.keycodes.ESC);\n    },\n    _isEnter: function(e) {\n        return (e.which === this.app.keycodes.ENTER);\n    },\n    _isEditorClick: function(e) {\n        if (this.app.editor.isEditor(e.target)) {\n            e.preventDefault();\n            return true;\n        }\n    },\n    _isOutsideEditor: function(e) {\n        var $target = this.dom(e.target);\n        var targets = ['-container-', '-popup-', '-control-'];\n\n        return ($target.closest('.' + this.prefix + targets.join(this.uuid + ',.' + this.prefix) + this.uuid).length === 0);\n    },\n    _isCmdPressed: function(e) {\n        return (this.opts.selection.multiple) ? ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) : false;\n    },\n    _isLinkClick: function(e) {\n        return (this.dom(e.target).closest('a').length !== 0);\n    },\n    _removeDragPlaceholder: function() {\n        var $body = this.app.editor.getBody();\n        $body.find('.' + this.prefix + '-draggable-placeholder').remove();\n        $body.find('.' + this.prefix + '-draggable-over').removeClass(this.prefix + '-draggable-over');\n    },\n    _preventLinks: function(e) {\n        if (this._isLinkClick(e)) e.preventDefault();\n    },\n    _drop: function(e, html, position, cleanDrop) {\n        var target = this.app.element.getDataBlock(e.target);\n        target = (target.length === 0) ? this.app.blocks.getFirst() : target;\n\n        // set target\n        this.app.block.set(target);\n\n        // drop point\n        if (!position) {\n            this.app.insertion.insertPoint(e);\n        }\n\n        var clean = true;\n        var parse = true;\n\n        var instance = this.app.block.get();\n        var isAll = this.app.editor.isAllSelected();\n        if (instance && instance.getType() === 'code' && !isAll) {\n            clean = false;\n            parse = false;\n            html = this.app.content.getTextFromHtml(html, { nl: true, trimlines: false });\n        }\n\n        if (cleanDrop === false) {\n            clean = false;\n        }\n\n        // empty\n        if (html === '') {\n            return;\n        }\n\n        // autoparse\n        html = (clean) ? this.app.autoparse.parse(html) : html;\n\n        // insert\n        return this.app.insertion.insertContent({ html: html, clean: clean, parse: parse, position: position });\n    },\n    _paste: function(e) {\n\n        e.preventDefault();\n\n        var clipboard = e.clipboardData;\n\n        // image\n        if (this.app.image.insertFromClipboard(clipboard)) {\n            return;\n        }\n\n        // html / text\n        var url = clipboard.getData('URL');\n        var html = this.app.clipboard.getContent(clipboard);\n\n        // broadcast\n        this.pasteEvent = true;\n        var event = this.app.broadcast('editor.before.paste', { e: e, html: html });\n        if (event.isStopped()) {\n            this.pasteEvent = false;\n            return;\n        }\n\n        html = event.get('html');\n\n        // get safari anchor links\n        html = (!url || url === '') ? html : url;\n\n        // clean\n        var instance = this.app.block.get();\n        var clean = true;\n        var parse = true;\n        var isAll = this.app.editor.isAllSelected();\n        if (this.opts.paste.plaintext) {\n            clean = false;\n            parse = false;\n            html = this.app.content.getTextFromHtml(html, { br: true });\n        }\n        else if (instance && instance.getType() === 'code' && !isAll) {\n            clean = false;\n            parse = false;\n            html = this.app.content.getTextFromHtml(html, { nl: true, trimlines: false });\n        }\n        else if (!this.opts.paste.clean) {\n            clean = false;\n        }\n\n        html = (this.opts.paste.links) ? html : this.app.content.removeTags(html, ['a']);\n        html = (this.opts.paste.images) ? html : this.app.content.removeTags(html, ['img']);\n\n        // empty\n        if (html === '') {\n            this.pasteEvent = false;\n            return;\n        }\n\n        // local images\n        var rtf = clipboard.getData('text/rtf');\n        var images;\n        if (rtf) {\n            images = this._findLocalImages(html);\n            html = this._replaceLocalImages(html, images, this._extractImagesFromRtf(rtf));\n        }\n\n        // autoparse\n        html = (clean) ? this.app.autoparse.parse(html) : html;\n\n        // insert\n        var inserted = this.app.insertion.insertContent({ html: html, clean: clean, parse: parse });\n\n        // upload inserted base64 or blob\n        if (this.opts.image.upload) {\n            this.app.image.parseInserted(inserted);\n        }\n\n        // placeholder\n        this.app.placeholder.toggle();\n\n        // broadcast\n        this.app.broadcast('editor.paste', inserted);\n        this.pasteEvent = false;\n    },\n    _copy: function(e) {\n        this._action(e, 'copy');\n    },\n    _cut: function(e) {\n        this._action(e, 'cut');\n    },\n    _action: function(e, name) {\n        var instance = this.app.block.get();\n        var isMultiple = this.app.blocks.is();\n        var html = false;\n        var obj = {\n            html: false,\n            remove: 'content'\n        };\n\n        // do nothing\n        if (!isMultiple && !instance) return;\n        if (!isMultiple && instance && instance.isEditable() && this.app.selection.isCollapsed()) return;\n\n        // stop event\n        e.preventDefault();\n\n        // select all\n        if (this.app.editor.isAllSelected()) {\n            obj = { html: this.app.editor.getLayout().html(), remove: 'all' };\n        }\n        // multiple\n        else if (isMultiple) {\n            obj = { html: this._copyFromMultiple(name), remove: 'blocks' };\n        }\n        // single editable\n        else if (instance && instance.isEditable()) {\n            obj = this._copyFromEditable(name, instance);\n        }\n        // single non editable\n        else if (instance) {\n            obj = this._copyFromNonEditable(name, instance);\n        }\n\n        // broadcast\n        var event = this.app.broadcast('editor.before.' + name, { e: e, html: obj.html });\n        if (event.isStopped()) {\n            return;\n        }\n\n        // delete content\n        if (name === 'cut') {\n            this._cutDeleteContent(obj);\n        }\n\n        html = event.get('html');\n\n        // set to clipboard\n        html = this.app.clipboard.setContent(e, html);\n\n        // broadcast\n        this.app.broadcastHtml('editor.' + name, html);\n    },\n    // copy\n    _cutDeleteContent: function(obj) {\n        if (obj.remove === 'instance') {\n            obj.instance.remove(true);\n            this.app.control.close();\n        }\n        else if (obj.remove === 'all') {\n            this.app.editor.setEmpty();\n        }\n        else if (obj.remove === 'blocks') {\n            this.app.blocks.removeSelected(false);\n        }\n        else if (obj.remove === 'row') {\n            obj.instance.getBlock().find('td, th').html('');\n        }\n        else if (obj.remove === 'noneditable') {\n            var type = obj.instance.getType();\n            var parentInstance = obj.instance.getParent('layer');\n            if (type === 'column') {\n                obj.instance.setEmpty();\n            }\n            else {\n                obj.instance.remove(true);\n                this.app.control.close();\n            }\n\n            if (type === 'layer' && parentInstance && parentInstance.isEmpty()) {\n                parentInstance.setEmpty();\n            }\n        }\n        else if (obj.remove !== false) {\n            this.app.selection.deleteContents();\n        }\n    },\n    _copyFromMultiple: function(name) {\n        var $blocks = this.app.blocks.getSelected();\n        var $tmp = this.dom('<div>');\n        $blocks.each(function($node) {\n            $tmp.append($node.clone());\n        });\n\n        return $tmp.html();\n    },\n    _copyFromEditable: function(name, instance) {\n        var type = instance.getType();\n        var html = this.app.selection.getHtml();\n        var remove = 'content';\n\n        if (type === 'figcaption' || type === 'cell') {\n            remove = 'content';\n        }\n        else if (instance.isAllSelected()) {\n            html = instance.getOuterHtml();\n            remove = 'instance';\n        }\n        else if (type === 'dlist') {\n            // wrap to dlist\n            if (html.search(/<dl/gi) === -1) {\n                html = '<dl>' + html + '</dl>';\n            }\n        }\n        else if (type === 'list') {\n            var tag = instance.getTag();\n            // contains li\n            if (html.search(/<li/gi) !== -1) {\n                // does not have li at start\n                if (html.search(/^<li/g) === -1) {\n                    html = '<li>' + html + '</li>';\n                }\n\n                // wrap to list\n                html = '<' + tag + '>' + html + '</' + tag + '>';\n            }\n        }\n\n        return { html: html, remove: remove, instance: instance };\n    },\n    _copyFromNonEditable: function(name, instance) {\n        var $block = instance.getBlock();\n        var type = instance.getType();\n        var html = '';\n        var remove = 'noneditable';\n\n        // column\n        if (type === 'column') {\n            html = $block.html();\n        }\n        // row\n        else if (type === 'row') {\n            // wrap to table\n            html = instance.getOuterHtml();\n            html = '<table>' + html + '</table>';\n            remove = 'row';\n        }\n        else {\n            html = instance.getOuterHtml();\n        }\n\n        return { html: html, remove: remove, instance: instance };\n    },\n    // local images\n    _findLocalImages: function(html) {\n        var images = [];\n\n        this.app.utils.wrap(html, function($w) {\n            $w.find('img').each(function($node) {\n                if ($node.attr('src').search(/^file:\\/\\//) !== -1) {\n                    images.push($node.attr('src'));\n                }\n            });\n        });\n\n        return images;\n    },\n    _extractImagesFromRtf: function(rtf) {\n        if (!rtf) return [];\n\n        var reHeader = /{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?({\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s}]*?/;\n        var reImage = new RegExp('(?:(' + reHeader.source + '))([\\\\da-fA-F\\\\s]+)\\\\}', 'g');\n        var images = rtf.match(reImage);\n\n        if (!images) return [];\n\n        var res = [];\n        for (var i = 0; i < images.length; i++) {\n            var type = false;\n\n            if (images[i].indexOf('\\\\pngblip') !== -1) {\n                type = 'image/png';\n            }\n            else if (images[i].indexOf('\\\\jpegblip') !== -1) {\n                type = 'image/jpeg';\n            }\n\n            if (type) {\n                res.push({\n                    hex: images[i].replace(reHeader, '').replace(/[^\\da-fA-F]/g, ''),\n                    type: type\n                });\n            }\n        }\n\n        return res;\n    },\n    _convertHexToBase64: function(str) {\n        return btoa(str.match(/\\w{2}/g).map(function(char) {\n            return String.fromCharCode(parseInt(char, 16));\n        }).join(''));\n    },\n    _replaceLocalImages: function(html, images, sources) {\n        if (images.length === sources.length) {\n\n            for (var i = 0; i < images.length; i++) {\n                var src = 'data:' + sources[i].type + ';base64,' + this._convertHexToBase64(sources[i].hex);\n                html = html.replace(new RegExp('src=\"' + images[i] + '\"', 'g'), 'src=\"' + src + '\"');\n            }\n        }\n\n        return html;\n    }\n});\nArticleEditor.add('module', 'input', {\n    handle: function(event) {\n        var e = event.get('e');\n        var key = event.get('key');\n\n        if (this._doSelectAll(e, event)) {\n            return;\n        }\n\n        // events\n        if (event.is('enter') && event.is('shift')) {\n            this.handleShiftEnter(e, key, event);\n        }\n        else if (event.is('enter')) {\n            this.handleEnter(e, key, event);\n        }\n        else if (event.is('space') && event.is('shift')) {\n            this.handleShiftSpace(e, key, event);\n        }\n        else if (event.is('space')) {\n            this.handleSpace(e, key, event);\n        }\n        else if (event.is('tab') && this.opts.tab.key) {\n            this.handleTab(e, key, event);\n        }\n        else if (event.is('arrow')) {\n            if (event.is(['shift', 'alt', 'ctrl'])) return;\n            this.handleArrow(e, key, event);\n        }\n        else if (event.is(['delete', 'backspace'])) {\n            this.handleDelete(e, key, event);\n        }\n    },\n\n    // handle\n    handleDelete: function(e, key, event) {\n\n        var instance = this.app.block.get();\n        var isBackspace = event.is('backspace');\n        var isDelete = event.is('delete');\n\n        if (this.app.blocks.is()) {\n            e.preventDefault();\n            this.app.blocks.removeSelected();\n            return;\n        }\n\n        // trim invisible char\n        if (instance && instance.isEditable() && this._trimInvisibleChar(e, (event.is('backspace') ? 'left' : 'right'), isDelete)) {\n            return;\n        }\n\n        // inline\n        var inline = this.app.selection.getInline();\n        if (inline && inline.innerHTML.length === 1) {\n            e.preventDefault();\n            inline.innerHTML = '';\n            return;\n        }\n\n        // handle block\n        if (instance.handleDelete && instance.handleDelete(e, key, event)) {\n            return;\n        }\n\n        // instance\n        var next = instance.getNext();\n        var prev = instance.getPrev();\n\n        // like variable\n        if (instance.isInlineBlock()) {\n            e.preventDefault();\n            var $block = instance.getBlock();\n            var parent = instance.getParent();\n            this.app.caret.set($block, 'after');\n\n            instance.remove(true);\n            this.app.block.set(parent);\n        }\n        // non editable\n        else if (!instance.isEditable()) {\n            e.preventDefault();\n\n            instance.remove(true);\n\n            if (next) {\n                this.app.block.set(next, 'start');\n            }\n            else if (prev) {\n                this.app.block.set(prev, 'end');\n            }\n            else {\n                if (this.app.editor.isEmpty()) {\n                    this.app.editor.setEmpty();\n                }\n                else {\n                    this.app.block.unset();\n                }\n            }\n        }\n        // editable\n        else if (instance.isEditable()) {\n            var type = instance.getType();\n\n            // all block selected\n            if (instance.isAllSelected()) {\n                e.preventDefault();\n                if (type === 'card') {\n                    this.app.block.remove();\n                }\n                else {\n                    instance.setEmpty();\n                }\n                return;\n            }\n\n            // delete & end\n            if (isDelete && next && instance.isCaretEnd()) {\n                e.preventDefault();\n\n                if (next.getType() === 'card' || !next.isEditable()) {\n                    this.app.block.set(next);\n                }\n                else {\n                    if (type === 'card') {\n                        return;\n                    }\n                    else {\n                        instance.appendNext();\n                    }\n                }\n            }\n            // backspace & start\n            else if (isBackspace && prev && instance.isCaretStart()) {\n                e.preventDefault();\n                if (prev.getType() === 'card' || !prev.isEditable()) {\n                    this.app.block.set(prev);\n\n                    // remove\n                    if (instance.isEmpty()) {\n                        instance.remove(true);\n                    }\n                }\n                else {\n                    if (type === 'card' || type === 'cell') {\n                        return;\n                    }\n                    else {\n                        instance.appendToPrev();\n                    }\n                }\n            }\n        }\n    },\n    handleArrow: function(e, key, event) {\n        var instance = this.app.block.get();\n\n        // multiple\n        if (this.app.blocks.is()) {\n            return;\n        }\n\n        // editable & inline code or like variable\n        if (instance.isEditable()) {\n            var current = this.app.selection.getCurrent();\n            var inline = this.app.selection.getTopInline();\n\n            // inline code\n            if (event.is('right') && inline && inline.tagName === 'CODE') {\n                var inlineEnd = this.app.caret.is(inline, 'end');\n                var blockEnd = this.app.caret.is(instance.getBlock(), 'end');\n                if (inlineEnd && blockEnd) {\n                    e.preventDefault();\n                    this.app.caret.set(inline, 'after');\n                    return;\n                }\n            }\n\n            // variable\n            if (inline && this._catchInlineBlock(e, event, inline)) {\n                return;\n            }\n            else if (current && this._catchInlineBlock(e, event, current)) {\n                return;\n            }\n        }\n\n        // trim invisible char\n        if (instance.isEditable() && this._trimInvisibleChar(e, (event.is('left') ? 'left' : 'right'))) {\n            return;\n        }\n\n        // handle block\n        if (instance.handleArrow && instance.handleArrow(e, key, event)) {\n            return;\n        }\n\n        // like variable\n        if (instance.isInlineBlock()) {\n            e.preventDefault();\n            var $block = instance.getBlock();\n            var parent = instance.getParent();\n\n            var caret = (event.is('up-left')) ? 'before' : 'after';\n            this.app.caret.set($block, caret);\n            this.app.block.set(parent);\n        }\n        else {\n            this._doArrow(e, event, instance);\n        }\n    },\n    handleTab: function(e, key, event) {\n        var instance = this.app.block.get();\n\n        // multiple\n        if (this.app.blocks.is()) {\n            e.preventDefault();\n            return;\n        }\n\n        // handle block tab\n        if (instance.handleTab && instance.handleTab(e, key, event)) {\n            return;\n        }\n\n        // tab as spaces\n        if (this.opts.tab.spaces && instance.isEditable()) {\n            e.preventDefault();\n            var num = this.opts.tab.spaces;\n            var node = document.createTextNode(Array(num + 1).join('\\u00a0'));\n            this.app.insertion.insertNode(node, 'end');\n            return;\n        }\n        // like variable\n        else if (instance.isInlineBlock()) {\n            e.preventDefault();\n            var $block = instance.getBlock();\n            var parent = instance.getParent();\n            this.app.caret.set($block, 'after');\n            this.app.block.set(parent);\n        }\n        else {\n            e.preventDefault();\n            var next = instance.getNext();\n            if (next) {\n                this.app.block.set(next, 'start');\n            }\n        }\n    },\n    handleShiftSpace: function(e, key, event) {\n        var instance = this.app.block.get();\n\n        // multiple\n        if (this.app.blocks.is()) return;\n\n        // instance\n        var $block = instance.getBlock();\n\n        // editable\n        if (instance.isEditable()) {\n            // selected all\n            if (instance.isAllSelected()) {\n                instance.setEmpty();\n                return;\n            }\n            else {\n                if (instance.getType() !== 'code') {\n                    e.preventDefault();\n                    this.app.insertion.insertHtml('&nbsp;', 'end');\n                }\n            }\n        }\n        // like variable\n        else if (instance.isInlineBlock()) {\n            e.preventDefault();\n            var parent = instance.getParent();\n            this.app.caret.set($block, 'after');\n\n            instance.remove(true);\n            this.app.block.set(parent);\n            this.app.insertion.insertHtml('&nbsp;', 'end');\n        }\n        // emptiable\n        else if (instance.isEmptiable() && instance.isEmpty()) {\n            e.preventDefault();\n\n            $block.removeClass(this.prefix + '-empty-layer');\n            $block.html('');\n\n            instance.insertEmpty({ position: 'append', caret: 'start' });\n        }\n    },\n    handleSpace: function(e, key, event) {\n        var instance = this.app.block.get();\n\n        // multiple\n        if (this.app.blocks.is()) {\n            e.preventDefault();\n            var last = this.app.blocks.getLastSelected();\n            last.insertEmpty({ position: 'after', caret: 'start' });\n            this.app.blocks.removeSelected(false);\n            return;\n        }\n\n        // instance\n        var $block = instance.getBlock();\n        var type = instance.getType();\n\n        // handle block space\n        if (instance.handleSpace && instance.handleSpace(e, key, event)) {\n            return;\n        }\n\n        // do nothing\n        if (type === 'row') {\n            e.preventDefault();\n            return;\n        }\n        // editable\n        else if (instance.isEditable() && instance.isAllSelected()) {\n            instance.setEmpty();\n            return;\n        }\n        // like variable\n        else if (instance.isInlineBlock()) {\n            e.preventDefault();\n\n            var parent = instance.getParent();\n            this.app.caret.set($block, 'after');\n\n            instance.remove(true);\n            this.app.block.set(parent);\n            this.app.insertion.insertHtml('&nbsp;', 'end');\n        }\n        // emptiable\n        else if (instance.isEmptiable() && instance.isEmpty()) {\n            e.preventDefault();\n\n            $block.removeClass(this.prefix + '-empty-layer');\n            $block.html('');\n\n            instance.insertEmpty({ position: 'append', caret: 'start' });\n        }\n        // non editable\n        else if (!instance.isEditable()) {\n            e.preventDefault();\n            instance.insertEmpty({ position: 'after', caret: 'start' });\n            instance.remove(true);\n            this.app.control.updatePosition();\n        }\n    },\n    handleShiftEnter: function(e, key, event) {\n        var instance = this.app.block.get();\n        var type = instance.getType();\n        var $block = instance.getBlock();\n\n        if (this.app.blocks.is() || type === 'row') {\n            e.preventDefault();\n        }\n        // like variable\n        else if (instance.isInlineBlock()) {\n            e.preventDefault();\n\n            var parent = instance.getParent();\n            this.app.caret.set($block, 'after');\n\n            instance.remove(true);\n            this.app.block.set(parent);\n            this.app.insertion.insertBreakline();\n        }\n        // editable\n        else if (instance.isEditable()) {\n            e.preventDefault();\n            this.app.insertion.insertBreakline();\n        }\n        // non editable\n        else {\n            e.preventDefault();\n            var position = 'after';\n            if (instance.isEmptiable() && instance.isEmpty()) {\n                position = 'append';\n\n                $block.removeClass(this.prefix + '-empty-layer');\n                $block.html('');\n            }\n\n            instance.insertEmpty({ position: position, caret: 'start' });\n        }\n\n    },\n    handleEnter: function(e, key, event) {\n        var instance = this.app.block.get();\n\n        // blocks\n        if (this.app.blocks.is()) {\n            e.preventDefault();\n            var last = this.app.blocks.getLastSelected();\n            last.insertEmpty({ position: 'after', caret: 'start' });\n            return;\n        }\n\n        // instance\n        var $block = instance.getBlock();\n\n        // editable\n        if (instance.isEditable()) {\n            // all block selected\n            if (instance.isAllSelected()) {\n                e.preventDefault();\n                instance.setEmpty();\n                return;\n            }\n            // partial selected\n            else if (!this.app.selection.isCollapsed()) {\n                e.preventDefault();\n                if (instance.getType() === 'code') {\n                    this.app.insertion.insertNewline();\n                }\n                else {\n                    this.app.insertion.insertBreakline();\n                }\n                return;\n            }\n        }\n\n        // like variable\n        if (instance.isInlineBlock()) {\n            e.preventDefault();\n\n            var parent = instance.getParent();\n            this.app.caret.set($block, 'after');\n\n            instance.remove(true);\n            this.app.block.set(parent);\n        }\n        // emptiable\n        else if (instance.isEmptiable() && instance.isEmpty()) {\n            e.preventDefault();\n\n            $block.removeClass(this.prefix + '-empty-layer');\n            $block.html('');\n\n            instance.insertEmpty({ position: 'append', caret: 'start' });\n        }\n        // non editable\n        else if (!instance.isEditable()) {\n            e.preventDefault();\n            instance.insertEmpty({ position: 'after', caret: 'start' });\n        }\n\n        // handle block enter\n        if (instance.handleEnter) {\n            instance.handleEnter(e, key, event);\n        }\n\n        // ui\n        this.app.control.updatePosition();\n    },\n    handleTextareaTab: function(e) {\n        if (e.keyCode !== 9) return true;\n\n        e.preventDefault();\n\n        var el = e.target;\n        var val = el.value;\n        var start = el.selectionStart;\n\n        el.value = val.substring(0, start) + \"    \" + val.substring(el.selectionEnd);\n        el.selectionStart = el.selectionEnd = start + 4;\n    },\n\n    // private\n    _isNextBlock: function(event, node) {\n        return (event.is('right') && this.app.caret.is(node, 'end') && this.app.element.getType(node.nextSibling));\n    },\n    _isPrevBlock: function(event, node) {\n       return (event.is('left') && this.app.caret.is(node, 'start') && this.app.element.getType(node.previousSibling));\n    },\n    _isSiblingInlineBlock: function(e, node) {\n        var $el = this.dom(node);\n        var instance = $el.dataget('instance');\n        if (instance && instance.isInlineBlock()) {\n            e.preventDefault();\n            this.app.block.set(instance);\n            return true;\n        }\n    },\n    _isInvisibleChar: function(direction) {\n        var sel = this.app.selection.get();\n        var text = this.app.selection.getText(direction);\n        return (sel.current && sel.current.nodeType === 3 && this.app.utils.searchInvisibleChars(text) === 0);\n    },\n    _catchInlineBlock: function(e, event, node) {\n        if (event.is('left') && node.nodeType === 3) {\n            var str = node.textContent;\n            var isChar = (this.app.utils.searchInvisibleChars(str) !== -1);\n            if (isChar) {\n                var charnode = node;\n                if (this._isSiblingInlineBlock(e, node.previousSibling)) {\n                    charnode.parentNode.removeChild(charnode);\n                    return true;\n                }\n            }\n        }\n\n        if (this._isPrevBlock(event, node)) {\n            if (this._isSiblingInlineBlock(e, node.previousSibling)) return true;\n        }\n        else if (this._isNextBlock(event, node)) {\n            if (this._isSiblingInlineBlock(e, node.nextSibling)) return true;\n        }\n    },\n    _trimInvisibleChar: function(e, pointer, remove) {\n        var direction = (pointer === 'left') ? 'before' : 'after';\n        var sel = this.app.selection.get();\n        var isChar = this._isInvisibleChar(direction);\n        var el;\n        if (isChar && pointer === 'left') {\n            el = sel.current;\n            var data = this.app.offset.get();\n            this.dom(el).replaceWith(el.textContent.replace(/\\uFEFF/g, ''));\n            this.app.offset.set(false, { start: data.start - 1, end: data.end - 1 });\n        }\n        else if (isChar && remove && sel.current && sel.current.nextSibling) {\n            el = sel.current.nextSibling;\n            this.dom(el).replaceWith(el.textContent.replace(/\\uFEFF/g, ''));\n        }\n        else if (isChar && pointer === 'right') {\n            e.preventDefault();\n            el = sel.current;\n            var data = this.app.offset.get();\n            this.app.offset.set(false, { start: data.start + 1, end: data.end + 1 });\n            return true;\n        }\n    },\n    _doSelectAll: function(e, event) {\n        var instance = this.app.block.get();\n\n        // if select all & action key - make empty\n        if (this._isAllSelected(event)) {\n            this._setEditorEmpty(e, event);\n            return true;\n        }\n\n        // select all\n        if (event.is('select')) {\n            e.preventDefault();\n\n            if (!this.app.blocks.is() && instance) {\n                if (instance.isAllSelected() || instance.isEmpty()) {\n                    this.app.editor.selectAll();\n                }\n                else {\n                    instance.setSelectAll();\n                }\n            }\n            else {\n                this.app.editor.selectAll();\n            }\n\n            return true;\n        }\n    },\n    _doArrow: function(e, event, instance) {\n        var target, caret;\n        var type = instance.getType();\n        var types = ['code', 'line', 'image', 'embed', 'layer', 'grid'];\n\n        if (event.is('up-left') && instance.isCaretStart()) {\n            caret = 'end';\n            target = instance.getPrev();\n\n            // insert before\n            if (!target && types.indexOf(type) !== -1) {\n                this.app.insertion.insertEmptyBlock({ position: 'before', caret: 'start' });\n                return;\n            }\n        }\n        else if (event.is('down-right') && instance.isCaretEnd()) {\n            caret = 'start';\n            target = instance.getNext();\n\n            // insert after\n            if (!target && types.indexOf(type) !== -1) {\n                this.app.insertion.insertEmptyBlock({ position: 'after', caret: 'start' });\n                return;\n            }\n        }\n\n        // set next or prev\n        if (target) {\n            e.preventDefault();\n            this.app.block.set(target, caret);\n        }\n    },\n    _isAllSelected: function(event) {\n        return (this.app.editor.isAllSelected() && event.is(['enter', 'delete', 'backspace', 'alpha', 'space']));\n    },\n    _setEditorEmpty: function(e, event) {\n        if (!event.is(['alpha', 'space'])) e.preventDefault();\n        this.app.editor.setEmpty();\n    }\n});\nArticleEditor.add('module', 'toolbar', {\n    init: function() {\n        this.eventname = this.prefix + '-toolbar';\n        this.activeClass = 'active';\n        this.toggledClass = 'toggled';\n        this.disableClass = 'disable';\n        this.customButtons = {};\n        this.aTags = {};\n        this.aTypes = {};\n    },\n    start: function() {\n        if (this.opts.toolbar) {\n            this.sticky = this.opts.toolbar;\n        }\n        else if (this.opts.path && this.opts.path.sticky) {\n            this.sticky = this.opts.path;\n        }\n\n        if (this._isToolbar()) {\n            this.$container = this.app.container.get('toolbar');\n            this._build();\n        }\n\n        this._buildSticky();\n    },\n    load: function() {\n        this._buildActiveButtons();\n\n        if (this._isToolbar()) {\n            this.$toolbar.html('');\n            this._buildButtons();\n        }\n\n    },\n    stop: function() {\n        if (!this._isToolbar()) return;\n        this.$toolbar.remove();\n        this.customButtons = {};\n        this.editorButtons = {};\n    },\n    build: function() {\n        if (!this._isToolbar()) return;\n\n        this.$toolbar.html('');\n        this._buildButtons();\n    },\n    observe: function() {\n        if (!this._isToolbar()) return;\n\n        this.unsetActive();\n\n        if (this.app.blocks.is() || this.app.editor.isAllSelected()) return;\n        if (!this._isObserveButtons()) return;\n\n        var instance = this.app.block.get();\n        var type = (instance) ? instance.getType() : false;\n        var tag = (instance) ? instance.getTag() : false;\n        var inlines = this.app.selection.getNodes({ type: 'inline', selected: 'inside', links: true });\n        var tags = this._getObservedTags(tag, inlines);\n        var buttons = [];\n        var keys;\n\n        // tags\n        for (var i = 0; i < tags.length; i++) {\n            keys = this.aTags[tags[i]];\n            if (keys) {\n                buttons = buttons.concat(keys);\n            }\n        }\n\n        // types\n        if (type) {\n            keys = this.aTypes[type];\n            if (keys) {\n                buttons = buttons.concat(keys);\n            }\n        }\n\n        // set active\n        this._setActiveKeys(buttons);\n    },\n\n    // public\n    getElement: function() {\n        return this.$toolbar;\n    },\n    get: function(name) {\n        return this._findButton(name);\n    },\n    add: function(name, obj) {\n        this.customButtons[name] = obj;\n    },\n    setActive: function(name) {\n        if (!this._isToolbar()) return;\n        this._findButtons().removeClass(this.activeClass);\n        this._findButton(name).removeClass(this.disableClass).addClass(this.activeClass);\n\n    },\n    setToggled: function(name) {\n        if (!this._isToolbar()) return;\n        this._findButtons().removeClass(this.toggledClass);\n        this._findButton(name).removeClass(this.disableClass).addClass(this.toggledClass);\n    },\n    unsetActive: function(name) {\n        if (!this._isToolbar()) return;\n\n        var $elms = (name) ? this._findButton(name) : this._findButtons();\n        $elms.removeClass(this.activeClass);\n\n    },\n    unsetToggled: function(name) {\n        if (!this._isToolbar()) return;\n\n        var $elms = (name) ? this._findButton(name) : this._findButtons();\n        $elms.removeClass(this.toggledClass);\n    },\n    enable: function() {\n        if (!this._isToolbar()) return;\n        this._findButtons().removeClass(this.disableClass);\n    },\n    disable: function(except) {\n        if (!this._isToolbar()) return;\n        this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass);\n    },\n    disableSticky: function() {\n        if (!this._isToolbar()) return;\n\n        var $container = this.app.container.get('bars');\n        $container.removeClass(this.prefix + '-bars-sticky');\n        $container.css('top', '');\n    },\n    enableSticky: function() {\n        if (!this._isToolbar()) return;\n        if (this.opts.toolbar.sticky) {\n            var $container = this.app.container.get('bars');\n            $container.addClass(this.prefix + '-bars-sticky');\n            $container.css('top', this.opts.toolbar.stickyTopOffset + 'px');\n        }\n    },\n    isSticky: function() {\n        var $container = this.app.container.get('bars');\n        var $main = this.app.container.get('main');\n        var mainTop = $main.offset().top + parseInt($main.css('border-top-width'));\n        var containerTop = $container.offset().top;\n\n        return (containerTop > mainTop || containerTop < mainTop);\n    },\n\n    // private\n    _build: function() {\n        this.$toolbar = this.dom('<div>').addClass(this.prefix + '-toolbar');\n\n        this.$container.append(this.$toolbar);\n        this.app.container.get('bars').addClass('has-toolbar');\n    },\n    _buildSticky: function() {\n        if (this.sticky) {\n\n            var $container = this.app.container.get('bars');\n            $container.addClass(this.prefix + '-bars-sticky');\n            $container.css('top', this.sticky.stickyTopOffset + 'px');\n\n            var $scrollTarget = this.app.scroll.getTarget();\n            $scrollTarget.on('scroll.' + this.prefix + '-toolbar', this._observeSticky.bind(this));\n        }\n    },\n    _buildActiveButtons: function() {\n\n        this.aTags = (this.opts.buttons.tags) ? this.opts.buttons.tags : {};\n        this.aTypes = (this.opts.buttons.types) ? this.opts.buttons.types : {};\n\n        var btns = this.customButtons;\n        Object.keys(btns).forEach(function(key) {\n            var active = btns[key].active;\n            if (active) {\n                this._buildActiveButton(key, active.tags, this.aTags);\n                this._buildActiveButton(key, active.types, this.aTypes);\n            }\n        }.bind(this));\n    },\n    _buildActiveButton: function(key, arr, obj) {\n        if (!arr) return;\n\n        for (var i = 0; i < arr.length; i++) {\n            var item = arr[i];\n\n            if (obj[item]) {\n                obj[item].push(key);\n            }\n            else {\n                obj[item]= [key];\n            }\n        }\n    },\n    _buildButtons: function() {\n        var instance = this._getCurrentInstance();\n        var buttons = (instance) ? this.app.editor.getButtonsFromArr(instance.toolbar) : this.app.editor.getButtons();\n\n        // create button\n        this._createButtons(buttons, instance);\n\n        // create custom (plugin)\n        if (instance) {\n            this._createButtons(this.customButtons, instance);\n        }\n    },\n    _createButtons: function(buttons, instance) {\n        for (var name in buttons) {\n            if (buttons.hasOwnProperty(name)) {\n                if (instance && !instance.isAllowedButton(name, buttons[name])) continue;\n                if (this._isHidden(name)) continue;\n                if (name === 'add' && this.opts.addbar === false) continue;\n                if (name === 'format' && this.opts.format === false) continue;\n\n                this.app.create('button', name, buttons[name], this.$toolbar, 'toolbar');\n            }\n        }\n    },\n    _observeSticky: function() {\n        if (this.app.source.is()) {\n            this.app.container.get('bars').css('top', 0);\n            return;\n        }\n\n        var $scrollTarget = this.app.scroll.getTarget();\n        var paddingTop = (this.app.scroll.isTarget()) ? parseInt($scrollTarget.css('padding-top')) : 0;\n\n        var $container = this.app.container.get('bars');\n        $container.css('top', (0 - paddingTop + this.sticky.stickyTopOffset) + 'px');\n\n        if (this.isSticky()) {\n            this.app.broadcast('toolbar.sticky');\n        }\n        else {\n            this.app.broadcast('toolbar.static');\n        }\n    },\n    _findButtons: function() {\n        return this.$toolbar.find('.' + this.prefix + '-button-toolbar');\n    },\n    _findButton: function(name) {\n        return this.$toolbar.find('[data-name=' + name + ']');\n    },\n    _isHidden: function(name) {\n        return (this.opts.toolbar.hide.indexOf(name) !== -1);\n    },\n    _isToolbar: function() {\n        return this.opts.toolbar;\n    },\n    _isObserveButtons: function() {\n        if (!this.opts.buttons.tags && !this.opts.buttons.types) return false;\n\n        return true;\n    },\n    _setActiveKeys: function(keys) {\n        for (var i = 0; i < keys.length; i++) {\n            this._findButton(keys[i]).addClass(this.activeClass);\n        }\n    },\n    _getCurrentInstance: function() {\n        var instance = (this.app.block.is()) ? this.app.block.get() : false;\n        return (this.app.blocks.is()) ? false : instance;\n    },\n    _getObservedTags: function(tag, inlines) {\n        var tags = [];\n\n        if (tag) {\n            tags.push(tag);\n        }\n\n        if (inlines.length > 0) {\n            for (var i = 0; i < inlines.length; i++) {\n                tags.push(inlines[i].tagName.toLowerCase());\n            }\n        }\n\n        return tags;\n    }\n});\nArticleEditor.add('module', 'path', {\n    init: function() {\n        this.activeClass = 'active';\n        this.disableClass = 'disable';\n        this.pathItemClass = this.prefix + '-path-item';\n    },\n    start: function() {\n        if (!this.opts.path) return;\n\n        this.$container = this.app.container.get('pathbar');\n        this._build();\n        this._buildRoot();\n        this._buildActive();\n    },\n    build: function() {\n        if (!this.opts.path) return;\n\n        this._clear();\n        this._buildRoot();\n\n        if (this.app.blocks.is()) {\n            this._buildMultipleItem();\n        }\n        else {\n            this._buildItems();\n            this._buildActive();\n        }\n    },\n    disable: function() {\n        if (!this.opts.path) return;\n\n        this._getAll().addClass(this.disableClass);\n    },\n    enable: function() {\n        if (!this.opts.path) return;\n\n        this._getAll().removeClass(this.disableClass);\n    },\n\n    // private\n    _clear: function() {\n        this.$path.find('.' + this.pathItemClass).off('.' + this.prefix + '-path-' + this.uuid);\n        this.$path.html('');\n    },\n    _getAll: function() {\n        return this.$path.find('.' + this.pathItemClass);\n    },\n    _selectItem: function(e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        var $item = this.dom(e.target).closest('.' + this.pathItemClass);\n        if ($item.hasClass(this.disableClass)) return;\n\n        var instance = $item.dataget('instance');\n        if (instance) {\n            this.app.popup.close();\n            this.app.block.set(instance, 'start');\n        }\n        else {\n            this._clear();\n            this._buildRoot();\n            this._buildActive();\n            this.app.block.unset();\n        }\n    },\n    _createItem: function() {\n        return this.dom('<a href=\"#\"></a>').attr('tabindex', '-1').addClass(this.pathItemClass);\n    },\n    _build: function() {\n        this.$path = this.dom('<div>').addClass(this.prefix + '-path');\n\n        this.$container.append(this.$path);\n    },\n    _buildRoot: function() {\n        this._buildItem(false, this.lang.parse(this.opts.path.title));\n    },\n    _buildActive: function() {\n        this.$path.find('a').removeClass(this.activeClass).last().addClass(this.activeClass);\n    },\n    _buildItems: function() {\n        var current = this.app.block.get();\n        if (!current) return;\n\n        // parents\n        var $parents = current.getBlock().parents('[data-' + this.prefix + '-type]');\n        $parents.nodes.reverse();\n        $parents.each(this._buildParentItem.bind(this));\n\n        // current\n        this._buildItem(current);\n    },\n    _buildParentItem: function($el) {\n        var instance = $el.dataget('instance');\n\n        this._buildItem(instance);\n    },\n    _buildMultipleItem: function() {\n        var $item = this._createItem();\n        $item.addClass(this.activeClass);\n\n        this._buildTitle($item, this.lang.get('editor.multiple'));\n        this.$path.append($item);\n    },\n    _buildItem: function(instance, root) {\n        var $item = this._createItem();\n        $item.dataset('instance', instance);\n        $item.on('click.' + this.prefix + '-path-' + this.uuid, this._selectItem.bind(this));\n\n        this._buildTitle($item, root || instance.getTitle());\n        this.$path.append($item);\n    },\n    _buildTitle: function($item, title) {\n        var $title = this.dom('<span>').html(title);\n        $item.append($title);\n    }\n});\nArticleEditor.add('module', 'topbar', {\n    init: function() {\n        this.activeClass = 'active';\n        this.toggledClass = 'disable';\n        this.disableClass = 'disable';\n        this.customButtons = {};\n    },\n    start: function() {\n        if (!this._isTopbar()) return;\n\n        this._build();\n    },\n    load: function() {\n        this._buildButtons();\n    },\n    get: function(name) {\n        return this._findButton(name);\n    },\n    add: function(name, obj) {\n        this.customButtons[name] = obj;\n    },\n    setToggled: function(name) {\n        if (!this._isTopbar()) return;\n        this._findButtons().removeClass(this.toggledClass);\n        this._findButton(name).addClass(this.toggledClass);\n    },\n    unsetToggled: function(name) {\n        if (!this._isTopbar()) return;\n        var $elms = (name)? this._findButton(name) : this._findButtons();\n        $elms.removeClass(this.toggledClass);\n    },\n    enable: function() {\n        if (!this._isTopbar()) return;\n        this._findButtons().removeClass(this.disableClass);\n    },\n    disable: function() {\n        if (!this._isTopbar()) return;\n        var $btns = this._findButtons();\n        $btns.removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass);\n    },\n\n    // private\n    _isTopbar: function() {\n        return this.opts.path;\n    },\n    _build: function() {\n        this.$topbar = this.dom('<div>').addClass(this.prefix + '-topbar');\n        this.app.container.get('pathbar').append(this.$topbar);\n    },\n    _buildButtons: function() {\n        var buttons = this.app.editor.getButtonsFromArr(this.opts.buttons.topbar);\n        for (var name in buttons) {\n            if (buttons.hasOwnProperty(name)) {\n                if (name === 'undo' && !this.opts.topbar.undoredo) continue;\n                if (name === 'redo' && !this.opts.topbar.undoredo) continue;\n                if (name === 'shortcut' && !this.opts.topbar.shortcuts) continue;\n\n                this.app.create('button', name, buttons[name], this.$topbar, 'topbar');\n            }\n        }\n    },\n    _findButtons: function() {\n        return this.$topbar.find('.' + this.prefix + '-button-topbar');\n    },\n    _findButton: function(name) {\n        return this.$topbar.find('[data-name=' + name + ']');\n    }\n});\nArticleEditor.add('module', 'control', {\n    init: function() {\n        this.instance = false;\n        this.customButtons = {};\n        this.eventName = this.prefix + '-control';\n    },\n    start: function() {\n        if (!this.opts.control) return;\n        this._build();\n    },\n    stop: function() {\n        if (this.opts.control) {\n            this.$control.remove();\n        }\n        this.instance = false;\n        this.customButtons = {};\n    },\n    isOpen: function() {\n        return (this.$control.css('display') !== 'none');\n    },\n    getElement: function() {\n        return this.$control;\n    },\n    get: function(name) {\n        return this._findButton(name);\n    },\n    add: function(name, obj) {\n        this.customButtons[name] = obj;\n    },\n    remove: function(name) {\n        this._findButton(name).remove();\n    },\n    build: function() {\n        if (!this.opts.control) return;\n        var instance = this.app.block.get();\n        if (!instance) {\n            this.close();\n        }\n        else {\n            this.open(instance);\n        }\n    },\n    open: function(instance) {\n        if (!this.opts.control) return;\n        this.$control.html('');\n\n        this.instance = instance;\n        var len = this._buildButtons();\n\n        if (len > 0) {\n            var $scrollTarget = this.app.scroll.getTarget();\n\n            this.updatePosition();\n            $scrollTarget.on('resize.' + this.eventName, this.updatePosition.bind(this));\n            $scrollTarget.on('scroll.' + this.eventName, this.updatePosition.bind(this));\n            this.app.editor.getWin().on('scroll.' + this.eventName, this.updatePosition.bind(this));\n            this.instance.getBlock().on('keyup.' + this.eventName, this.updatePosition.bind(this));\n        }\n        else {\n            this.close();\n        }\n    },\n    close: function() {\n        if (!this.opts.control) return;\n        this.$control.hide();\n\n        if (this.instance) {\n            var $block = this.instance.getBlock();\n            this.app.content.unfixListMargin($block);\n            $block.off('.' + this.eventName);\n        }\n\n        this.app.scroll.getTarget().off('.' + this.eventName);\n        this.app.editor.getDoc().off('.' + this.eventName);\n        this.instance = false;\n    },\n    updatePosition: function() {\n        if (!this.opts.control) return;\n        if (!this.instance) {\n            this.close();\n            return;\n        }\n\n        if (this.instance.getType() === 'list') {\n            var $block = this.instance.getBlock();\n            this.app.content.fixListMargin($block);\n        }\n\n        var isEditable = this.instance.isEditable();\n        var offset = this.instance.getOffset();\n        var width = this.$control.width();\n        var scrollTop = this.app.editor.getWin().scrollTop();\n        var topOutlineFix = (isEditable) ? 4 : 2;\n        var leftOutlineFix = (isEditable) ? 6 : 4;\n        var top = (offset.top - topOutlineFix - scrollTop);\n        var left = (offset.left - width - leftOutlineFix);\n        var $container = this.app.container.get('toolbar');\n        var toolbarBottom = ($container.offset().top + $container.height()) - topOutlineFix;\n        var frameRect = this.app.editor.getFrameRect();\n\n\n        if (top < toolbarBottom || frameRect.bottom < top) {\n            this.$control.hide();\n        }\n        else {\n            this.$control.show();\n        }\n\n\n        // scroll target bottom hide\n        if (this.app.scroll.isTarget()) {\n            var $target = this.app.scroll.getTarget();\n            var targetBottom = $target.offset().top + $target.height();\n            var bottom = top + this.$control.height();\n            if (bottom > targetBottom) {\n                this.$control.hide();\n            }\n        }\n\n        // left out of edge\n        if (!isEditable && (left + width/2) < frameRect.left) {\n            left = frameRect.left + 3;\n            top = top + 6;\n        }\n\n        // position\n        this.$control.css({\n            top: top + 'px',\n            left: left + 'px'\n        });\n    },\n\n    // private\n    _buildButtons: function() {\n        var buttons = this.app.editor.getButtonsFromArr(this.instance.control);\n        var count = 0;\n        if (buttons !== false) {\n            count = this._createButtons(buttons, count);\n            count = this._createButtons(this.customButtons, count);\n        }\n\n        return count;\n    },\n    _build: function() {\n        this.$control = this.dom('<div>').addClass(this.prefix + '-control ' + this.prefix + '-control-' + this.uuid).hide();\n\n        // bs modal\n        if (this.opts.bsmodal) {\n            this.$control.css('z-index', 1060);\n        }\n\n        this.app.$body.append(this.$control);\n    },\n    _createButtons: function(buttons, count) {\n        for (var name in buttons) {\n            if (!this.instance.isAllowedButton(name, buttons[name])) continue;\n            this.app.create('button', name, buttons[name], this.$control, 'control');\n            count++;\n        }\n\n        return count;\n    },\n    _findButton: function(name) {\n        return this.$control.find('[data-name=' + name + ']');\n    }\n});\nArticleEditor.add('module', 'insertion', {\n    init: function() {\n        this._clear();\n    },\n    start: function() {\n        this.win = this.app.editor.getWinNode();\n        this.doc = this.app.editor.getDocNode();\n    },\n\n    // get\n    getFirstInserted: function() {\n        return this.inserted.instances[0];\n    },\n    getLastInserted: function() {\n        var len = this.inserted.instances.length;\n        var last = this.inserted.instances[len-1];\n        if (last && last.isInlineBlock()) {\n            last = last.getParent();\n        }\n\n        return last;\n    },\n    getInserted: function() {\n        return this.inserted;\n    },\n\n    // set\n    setContent: function(params) {\n        this._insert(params, 'set');\n\n        var inserted = this.getInserted();\n        this.inserted = false;\n\n        return inserted;\n    },\n\n    // insert\n    insertContent: function(params) {\n        this._insert(params, 'insert');\n\n        var inserted = this.getInserted();\n        this.inserted = false;\n\n        return inserted;\n    },\n    insertEmptyBlock: function(params) {\n        if (!params) {\n            params = {};\n        }\n\n        params.html = this.app.block.createHtml();\n        this._insert(params, 'insert');\n\n        var inserted = this.getInserted();\n        this.inserted = false;\n\n        // broadcast\n        this.app.broadcast('block.add', { instance: inserted.instances[0], type: 'input' });\n\n        return inserted;\n    },\n    insertNewline: function(caret, doublenode) {\n        var str = (doublenode) ? '\\n\\n' : '\\n';\n\n        return this._insertFragment({ node: document.createTextNode(str) }, (caret) ? caret : 'after');\n    },\n    insertPoint: function(e) {\n        var range;\n        var marker = this.app.utils.createInvisibleChar();\n        var doc = this.app.editor.getDocNode();\n        var x = e.clientX, y = e.clientY;\n\n        if (doc.caretPositionFromPoint) {\n            var pos = doc.caretPositionFromPoint(x, y);\n            var sel = doc.getSelection();\n            range = sel.getRangeAt(0);\n            range.setStart(pos.offsetNode, pos.offset);\n            range.collapse(true);\n            range.insertNode(marker);\n        }\n        else if (doc.caretRangeFromPoint) {\n            range = doc.caretRangeFromPoint(x, y);\n            range.insertNode(marker);\n        }\n\n        this.app.caret.set(marker, 'after');\n    },\n    insertBreakline: function(caret) {\n        // split inline\n        var inlines = this.app.selection.getNodes({ type: 'inline' });\n        if (this.app.selection.isCollapsed() && inlines.length !== 0) {\n            return this._splitInline(inlines, document.createElement('br'));\n        }\n\n        return this._insertFragment({ node: document.createElement('br') }, (caret) ? caret : 'after');\n    },\n    insertNode: function(node, caret, splitinline) {\n        if (splitinline) {\n            var inlines = this.app.selection.getNodes({ type: 'inline' });\n            if (inlines.length !== 0) {\n                return this._splitInline(inlines, node);\n            }\n        }\n\n        return this._insertFragment({ node: this.dom(node).get() }, caret);\n    },\n    insertHtml: function(html, caret) {\n        return this._insertFragment({ html: html }, caret);\n    },\n    insertText: function(text, caret) {\n        var instance = this.app.block.get();\n        if ((instance && !instance.isEditable()) || this.app.blocks.is()) {\n            this.insertContent({ html: text, caret: caret });\n            return;\n        }\n\n        var sel = this.win.getSelection();\n        var node;\n        if (sel.getRangeAt && sel.rangeCount) {\n            text = this.app.content.getTextFromHtml(text, { nl: true });\n            node = document.createTextNode(text);\n            var range = sel.getRangeAt(0);\n            range.deleteContents();\n            range.insertNode(node);\n\n            caret = caret || 'end';\n            this.app.caret.set(node, caret);\n        }\n\n        return node;\n    },\n    insertListToList: function($list, $target, caret) {\n        // add paste marker\n        var $items = $list.find('li');\n        var $last = $items.last();\n        $items.addClass(this.prefix + '-pasteitems');\n        $last.addClass(this.prefix + '-pastemarker');\n\n        // build nodes\n        var $nodes = $list.children();\n\n        // current li item\n        var $item = this.dom(this.app.selection.getBlock());\n\n        // caret position\n        var isStart = this.app.caret.is($target, 'start');\n        var isEnd = this.app.caret.is($target, 'end');\n        var isStartItem = this.app.caret.is($item, 'start');\n        var isEndItem = this.app.caret.is($item, 'end', ['ul', 'ol']);\n        var isEmptyItem = this.app.content.isEmptyHtml($item.html());\n\n        // start\n        if (isStart) {\n            if (isEmptyItem) {\n                $item.remove();\n            }\n            $target.prepend($nodes);\n        }\n        // end\n        else if (isEnd) {\n            if (isEmptyItem) {\n                $item.remove();\n            }\n            $target.append($nodes);\n        }\n        // middle\n        else {\n            // item empty\n            if (isEmptyItem) {\n                $item.after($nodes);\n                $item.remove();\n            }\n            // item before\n            else if (isStartItem) {\n                $item.before($nodes);\n            }\n            // item after\n            else if (isEndItem) {\n                var $childList = $item.find('ul, ol');\n                if ($childList.length !== 0) {\n                    $childList.prepend($nodes);\n                }\n                else {\n                    $item.after($nodes);\n                }\n            }\n            // item middle\n            else {\n                this.app.element.split($item).before($nodes);\n            }\n        }\n\n        // set caret\n        var pastemarker = this.prefix + '-pastemarker';\n        var pasteitems = this.prefix + '-pasteitems';\n        if (caret) {\n            $last = this.app.editor.getLayout().find('.' + pastemarker).removeClass(pastemarker);\n            this.app.caret.set($last, 'end');\n        }\n\n        return this.app.editor.getLayout().find('.' + pasteitems).removeClass(pasteitems);\n\n    },\n\n    // detect\n    detectPosition: function($target, position) {\n        if (position) return position;\n\n        // caret position\n        var isStart = this.app.caret.is($target, 'start');\n        var isEnd = this.app.caret.is($target, 'end');\n\n        // end\n        if (isEnd) {\n            position = 'after';\n        }\n        // start\n        else if (isStart) {\n            position = 'before';\n        }\n        // middle\n        else {\n            position = 'split';\n        }\n\n        return position;\n    },\n\n    // private\n\n    // insert\n    _insert: function(params, type) {\n\n        this.html = params.html;\n\n        // broadcast before\n        this.html = this.app.broadcastHtml('editor.before.insert', this.html);\n\n        // params\n        this.isParse = (typeof params.parse === 'undefined') ? true : params.parse;\n        this.isClean = (typeof params.clean === 'undefined') ? false : params.clean;\n        this.isCaret = (typeof params.caret === 'undefined') ? true : params.caret;\n        this.isPosition = (typeof params.position === 'undefined') ? false : params.position;\n\n        // type\n        if (type === 'set' || this.app.editor.isAllSelected()) {\n            // set\n            this._setContent();\n        }\n        else {\n            // insert\n            this._insertContent();\n        }\n\n        // broadcast\n        this.app.broadcast('editor.insert', this.inserted);\n    },\n    _insertContent: function() {\n\n        var current = this.app.block.get();\n        var position = false;\n        var remove = false;\n        var nodes, $block;\n\n        // check\n        this._checkEmpty();\n        this._checkLine();\n\n        // blocks\n        if (this.app.blocks.is()) {\n            // insert to blocks\n            if (this.isEmpty) {\n                return;\n            }\n            else if (this.isLine) {\n                this.html = this.app.block.createHtml(this.html);\n            }\n\n            // parse & clean\n            this._clean();\n            this._parse();\n            this._parseBuild();\n\n            // nodes\n            nodes = this._buildParsedNodes();\n\n            // insert\n            var last = this.app.blocks.getLastSelected();\n            var $last = last.getBlock();\n            $last.after(nodes);\n\n            // remove\n            this.app.blocks.removeSelected(false);\n        }\n        // not selected\n        else if (!current || this.isPosition) {\n            // insert to blocks\n            if (this.isEmpty) {\n                return;\n            }\n            else if (this.isLine) {\n                this.html = this.app.block.createHtml(this.html);\n            }\n\n            // parse & clean\n            this._clean();\n            this._parse();\n            this._parseBuild();\n\n            // nodes\n            nodes = this._buildParsedNodes();\n            var positions = ['after', 'before', 'append'];\n            var emptyLayer = false;\n\n            if (this.isPosition === 'top' || (!this.isPosition && this.opts.editor.add === 'top')) {\n                current = this.app.blocks.getFirst();\n                position = 'before';\n            }\n            else if (current && positions.indexOf(this.isPosition) !== -1) {\n                position = this.isPosition;\n                emptyLayer = (current.getType('layer') && current.isEmpty());\n            }\n            else {\n                current = this.app.blocks.getLast();\n                position = 'after';\n            }\n\n            $block = current.getBlock();\n            if (emptyLayer) {\n                $block.removeClass(this.prefix + '-empty-layer');\n                $block.html('');\n            }\n\n            $block[position](nodes);\n        }\n        // list to list\n        else if (this._isListToList(current)) {\n            // delete selection\n            this.app.selection.deleteContents();\n\n            // parse & clean\n            this._clean();\n            this._parse();\n            this._parseBuild();\n\n            // insert\n            $block = current.getBlock();\n            var $list = this.$parsed.children().first();\n            this.$nodes = this.insertListToList($list, $block, 'end');\n            this.isCaret = false;\n        }\n        else if (current) {\n\n            // like variable\n            if (current.isInlineBlock()) {\n                var parent = current.getParent();\n                this.app.caret.set(current.getBlock(), 'after');\n                current.remove();\n\n                this.app.block.set(parent);\n                current = parent;\n            }\n\n            // editable\n            if (current.isEditable()) {\n\n                if (this.isEmpty) {\n                    return;\n                }\n\n                // parse & clean\n                this._clean();\n                this._cleanSpecial();\n\n                if (this.isLine) this._parseLine();\n                else this._parse();\n\n                this._parseBuild();\n\n                if (current.isEmpty()) {\n                    remove = true;\n                    position = 'after';\n                }\n                else {\n                    // delete selection\n                    this.app.selection.deleteContents();\n                }\n\n                // nodes\n                nodes = this._buildParsedNodes();\n                $block = current.getBlock();\n\n                // insert\n                this._insertToEditable(current, $block, nodes, position, remove);\n            }\n            // non editable\n            else {\n\n                // set position\n                position = 'after';\n\n                // check\n                if (this.isEmpty) {\n                    return;\n                }\n                else if (this.isLine) {\n                    this.html = this.app.block.createHtml(this.html);\n                }\n\n                // parse & clean\n                this._clean();\n\n                if (this.isLine) this._parseLine();\n                else this._parse();\n\n                this._parseBuild();\n\n                // nodes\n                nodes = this._buildParsedNodes();\n                $block = current.getBlock();\n\n                // emptiable empty\n                if (current.isEmptiable() && current.isEmpty()) {\n                    $block.removeClass(this.prefix + '-empty-layer');\n                    $block.html('');\n                    position = 'append';\n                }\n\n                // insert\n                $block[position](nodes);\n            }\n        }\n        else {\n            return;\n        }\n\n        // inserted\n        this._buildInserted();\n        this._buildEditor();\n        this._buildCaret();\n    },\n    _insertToEditable: function(current, $block, nodes, position, remove) {\n        if (this.isLine) {\n            this.$nodes = this._insertFragment({ fragment: this.$parsed.get() }, 'end');\n            this.isCaret = false;\n        }\n        else {\n            // detect position\n            if (this.app.content.isEmptyHtml($block.html())) {\n                position = 'after';\n                remove = true;\n            }\n            else {\n                position = this.detectPosition($block, position);\n            }\n\n            // insert\n            if (position === 'split') {\n                this.app.element.split($block).before(nodes);\n            }\n            else {\n                $block[position](nodes);\n            }\n\n            // remove\n            if (remove) current.remove();\n        }\n    },\n    _insertFragment: function(obj, caret) {\n        var fragment;\n        if (obj.html || obj.fragment) {\n            fragment = this.app.fragment.build(obj.html || obj.fragment);\n            this.app.fragment.insert(fragment);\n        }\n        else {\n            this.app.fragment.insert(obj.node);\n        }\n\n        if (caret) {\n            var target = (obj.node) ? obj.node : ((caret === 'start') ? fragment.first : fragment.last);\n            this.app.caret.set(target, caret);\n        }\n\n        if (obj.node) {\n            return this.dom(obj.node);\n        }\n        else {\n            return this.dom(fragment.nodes);\n        }\n    },\n\n    // set\n    _setContent: function() {\n\n        // check\n        this._checkEmpty();\n        this._checkLine();\n\n        // set to editor\n        if (this.isEmpty) {\n            this.html = this.app.block.createHtml();\n        }\n        else if (this.isLine) {\n            this.html = this.app.block.createHtml(this.html);\n        }\n\n        // parse & clean\n        this._clean();\n        this._parse();\n        this._parseBuild();\n\n        // nodes\n        var nodes = this._buildParsedNodes();\n\n        // set\n        this.app.editor.unsetSelectAllClass();\n        this.app.editor.getLayout().html('').append(nodes);\n\n        // broadcast empty\n        if (this.isEmpty) {\n            this.app.broadcast('editor.empty');\n        }\n\n        // inserted\n        this._buildInserted();\n        this._buildEditor();\n        this._buildCaret();\n    },\n\n    // split\n    _splitInline: function(inlines, node) {\n        var $part = this.app.element.split(inlines[0]);\n        $part.before(node);\n        if ($part.html() === '') {\n            $part.remove();\n        }\n\n        return this.dom(node);\n    },\n\n    // build\n    _buildEditor: function() {\n        this.app.placeholder.trigger();\n        this.app.editor.build();\n        this.app.editor.setFocus();\n    },\n    _buildCaret: function() {\n        if (!this.isCaret) return;\n\n        var instance, caret = 'end';\n        if (this.isCaret === 'start') {\n            instance = this.getFirstInserted();\n            caret = 'start';\n        }\n        else {\n            instance = this.getLastInserted();\n        }\n\n        // set\n        setTimeout(function() {\n            if (instance) {\n                this.app.block.set(instance, caret);\n            }\n            // ui\n            this.app.toolbar.observe();\n        }.bind(this), 0);\n    },\n    _buildInserted: function() {\n\n        this.inserted = {\n            $nodes: this.$nodes,\n            instances: []\n        };\n\n        this.inserted.$nodes.each(this._buildInstance.bind(this));\n    },\n    _buildInstance: function($node) {\n        var instance = $node.dataget('instance');\n        if (instance) {\n            this.inserted.instances.push(instance);\n        }\n\n        var $nodes = $node.find('[data-' + this.prefix + '-type]');\n        if ($nodes.length !== 0) {\n            $nodes.each(this._buildInstance.bind(this));\n        }\n    },\n    _buildParsedNodes: function() {\n        return this.$parsed.get().childNodes;\n    },\n\n    // clear\n    _clear: function() {\n        this.html = false;\n        this.isLine = false;\n        this.isEmpty = false;\n        this.isSplit = false;\n        this.isClean = false;\n        this.isParse = true;\n        this.isCaret = true;\n        this.isPosition = false;\n    },\n\n    // clean\n    _clean: function() {\n        if (this.isClean) {\n            this.html = this.app.cleaner.cleanHtml(this.html);\n        }\n    },\n    _cleanSpecial: function(type) {\n        var clean, extend, except;\n        if (['cell', 'address', 'figcaption', 'quoteitem'].indexOf(type) !== -1) {\n            clean = true;\n        }\n        else if (type === 'dlist') {\n            clean = true;\n            except = ['dt', 'dd'];\n        }\n        else if (type === 'list') {\n            clean = true;\n            except = ['ul', 'ol', 'li'];\n        }\n\n        if (clean) {\n            this.isLine = true;\n\n            this.html = this.app.content.addBrToBlocks(this.html);\n            this.html = this.app.content.removeBlockTags(this.html, extend, except);\n            this.html = this.html.replace(/<br\\s?\\/?>\\n?$/gi, '');\n        }\n\n    },\n\n    // parse\n    _parse: function() {\n        if (this.isParse) {\n            this.html = this.app.parser.parse(this.html, false);\n        }\n    },\n    _parseLine: function() {\n        if (this.isParse) {\n            this.html = this.app.parser.parseLine(this.html, false);\n        }\n    },\n    _parseBuild: function() {\n        this.$parsed = this.app.parser.build(this.html);\n        this.$nodes = this.$parsed.children();\n    },\n\n    // check\n    _checkEmpty: function() {\n        this.isEmpty = this.app.content.isEmptyHtml(this.html);\n    },\n    _checkLine: function() {\n        this.isLine = this.app.content.isLine(this.html);\n    },\n\n    // is\n    _isListToList: function(instance) {\n        var $target = instance.getBlock();\n        var type = $target.attr('data-' + this.prefix + '-type');\n        var $list = this.dom('<div>').html(this.html);\n        $list.find('meta').remove();\n        // unwrap b fixes google docs\n        $list.find('b').unwrap();\n        $list = $list.children().first();\n\n        return (type === 'list' && $list.length !== 0 && ['ul', 'ol'].indexOf($list.get().tagName.toLowerCase()) !== -1);\n    }\n});\nArticleEditor.add('module', 'addbar', {\n    init: function() {\n        this.customButtons = {};\n    },\n    popup: function(params, button) {\n\n        // create\n        this.app.popup.create('addbar', {\n            width: '476px',\n            items: this.buildItems()\n        });\n\n        // show the popup at the top always\n        if (this.opts.editor.addbar === 'top') {\n            button = false;\n        }\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    buildItems: function() {\n        var items = {};\n        var obj = $ARX.extend(true, this.opts.buttonsObj);\n        var arr = this.opts.addbar.concat(this.opts.addbarAdd);\n        if (this.opts.addbarAdd.length !== 0 && this.opts.addbarAdd.indexOf('text') !== -1) {\n            var tin = arr.indexOf('text');\n            var pin = arr.indexOf('paragraph');\n            var to = (pin !== -1) ? pin+1 : 0;\n\n            // move text block button\n            arr.splice(to, 0, arr.splice(tin, 1)[0]);\n        }\n\n        for (var i = 0; i < arr.length; i++) {\n            var name = arr[i];\n            if (this.opts.addbarHide.indexOf(name) !== -1) continue;\n\n            items[name] = obj[name];\n        }\n\n        var customItems = $ARX.extend(true, this.customButtons);\n        var instance = this.app.block.get();\n\n        // build custom\n        Object.keys(customItems).forEach(function(key) {\n            items[key] = customItems[key];\n        });\n\n        // build all\n        Object.keys(items).forEach(function(key) {\n            this._buildItem(instance, items, items[key], key);\n        }.bind(this));\n\n        return items;\n    },\n    add: function(name, obj) {\n        this.customButtons[name] = obj;\n    },\n\n    // private\n    _buildItem: function(instance, items, item, key) {\n\n        // allowed buttons\n        if ((item.blocks && !instance) ||\n            (instance && item.blocks && !instance.isAllowedButton(key, item))) {\n\n            items[key] = false;\n            return;\n        }\n\n        items[key] = {\n            container: true,\n            addbar: true,\n            title: item.title,\n            icon: item.icon || key,\n            command: item.command,\n            observer: item.observer || false,\n            params: { name: key }\n        };\n    }\n});\nArticleEditor.add('module', 'format', {\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var $block = (instance) ? instance.getBlock() : false;\n        var tag = instance.getTag();\n        var tags = this.opts.format;\n\n        // build items\n        var items = {};\n        for (var i = 0; i < tags.length; i++) {\n            var key = tags[i];\n            items[key] = {\n                title: this.opts.formatObj[key].title,\n                params: { tag: key },\n                command: 'block.format',\n                shortcut: this.opts.formatObj[key].shortcut\n            };\n        }\n\n        // build format add\n        if (this.opts.formatAdd) {\n            var obj = this.opts.formatAdd;\n            Object.keys(obj).forEach(function(name) {\n                items[name] = {\n                    title: obj[name].title,\n                    params: obj[name].params,\n                    command: 'block.format'\n                };\n            });\n        }\n\n        // active item\n        var active = this._isActiveFormat($block, tag, items);\n        if (active) {\n            items[active].active = true;\n        }\n\n        this.app.popup.create('format', {\n            width: '300px',\n            items: items\n        });\n\n        this.app.popup.open({ button: button });\n    },\n    set: function(params) {\n        // popup\n        if (this.app.popup.isOpen()) {\n            this.app.popup.close();\n        }\n\n        // blocks\n        if (this.app.blocks.is()) {\n            return;\n        }\n\n        var $items, $block;\n        var instance = this.app.block.get();\n        var isEmpty = instance.isEmpty();\n        var caret = (isEmpty) ? 'start' : false;\n        var format = {\n            type: this.opts.formatObj[params.tag].type,\n            tag: params.tag,\n            classname: params.classname || false\n        };\n\n        // current params\n        this.tag = instance.getTag();\n        this.type = instance.getType();\n        this.$block = instance.getBlock();\n\n        // selection\n        if (!isEmpty) {\n            this.app.selection.saveMarker();\n        }\n\n        // check same\n        if (this._isSameTag(format)) {\n            format = this._checkSameFormat(this.$block, format);\n        }\n\n        // format\n        if (format) {\n            if (this._isListToText(format, 'list')) {\n                $block = this._formatListToText(format);\n            }\n            else if (this._isListToText(format, 'dlist')) {\n                $items = this._formatListToText(format, true);\n            }\n            else if (this._isTextToList(format, 'list')) {\n                this._formatTextToList(format, false, caret);\n            }\n            else if (this._isTextToList(format, 'dlist')) {\n                this._formatTextToList(format, true, caret);\n            }\n            else {\n                this._replaceTo(instance, format, caret);\n            }\n        }\n\n        // restore\n        if (!isEmpty) {\n            this.app.selection.restoreMarker();\n        }\n\n        if ($items) {\n            this.app.editor.build();\n            this.app.block.set($items.last(), caret);\n        }\n        if ($block) {\n            this.app.editor.build();\n            this.app.block.set($block, caret);\n        }\n\n        // broadcast\n        instance = this.app.block.get();\n        this.app.broadcast('block.format', { instance: instance });\n    },\n\n    // private\n    _isSameTag: function(format) {\n        return (this.tag === format.tag && this.type === format.type);\n    },\n    _checkSameFormat: function($el, format) {\n        var hasClass = this.app.element.hasClass($el, format.classname);\n\n        return (!format.classname || hasClass) ? this._buildDefaultFormat() : format;\n    },\n    _buildDefaultFormat: function() {\n        var type = this.opts.editor.markup;\n        var tag = (type === 'paragraph') ? 'p' : 'div';\n\n        return { type: type, tag: tag };\n    },\n    _formatListToText: function(format, dlist) {\n        var $items = (dlist) ? this._getDlistItems() : this._getListItems();\n\n        $items = this._createItems($items, format);\n        this.$block.remove();\n\n        return $items;\n    },\n    _formatTextToList: function(format, dlist, caret) {\n        var newInstance = this.app.create('block.' + format.type, '<' + format.tag + '>');\n        var $newBlock = newInstance.getBlock();\n\n        if (dlist && this.type === 'list') {\n            var z = 0;\n            this._getListItems().each(function($node) {\n                var tag = (z === 0) ? 'dt' : 'dd';\n                var $item = this.dom('<' + tag + '>').html($node.html());\n                z = (tag === 'dt') ? 1 : 0;\n\n                $newBlock.append($item);\n            }.bind(this));\n\n        }\n        else if (!dlist && this.type === 'dlist') {\n            this._getDlistItems().each(function($node) {\n                var $item = this.dom('<li>').html($node.html());\n                $newBlock.append($item);\n            }.bind(this));\n        }\n        else {\n            var tag = (dlist) ? '<dt>' : '<li>';\n            var $item = this.dom(tag).html(this.$block.html());\n            $newBlock.append($item);\n        }\n\n        // parse instance\n        this.app.create('block.' + format.type, $newBlock);\n\n        this.$block.after($newBlock);\n        this.$block.remove();\n\n        // style & class\n        this._setStyleAndClass($newBlock, format);\n\n        // set\n        this.app.editor.build();\n        this.app.block.set($newBlock, caret);\n    },\n    _replaceTo: function(instance, format, caret) {\n        var $block = instance.getBlock();\n        var $newBlock = this._replaceToBlock($block, format);\n\n        // set\n        this.app.editor.build();\n        this.app.block.set($newBlock, caret);\n    },\n    _replaceToBlock: function($block, format) {\n        var $newBlock = this.app.element.replaceToTag($block, format.tag);\n\n        // style & class\n        this._setStyleAndClass($newBlock, format);\n\n        // new instance\n        return this.app.create('block.' + format.type, $newBlock);\n    },\n    _createItems: function($items, format) {\n        var $block;\n        $items.each(function($node) {\n            var $item = this.dom('<' + format.tag + '>');\n            $item.html($node.html());\n            $node.remove();\n\n            $block = this.app.create('block.' + format.type, $item);\n            this.$block.before($item);\n\n            // style & class\n            this._setStyleAndClass($item, format);\n\n        }.bind(this));\n\n        return $block;\n    },\n    _isListToText: function(format, type) {\n        return (this.type === type && ['heading', 'address', 'paragraph', 'text'].indexOf(format.type) !== -1);\n    },\n    _isTextToList: function(format, type) {\n        var checkType = (type === 'list') ? 'dlist' : 'list';\n        return (format.type === type && ['heading', 'address', 'paragraph', 'text', checkType].indexOf(this.type) !== -1);\n    },\n    _isActiveFormat: function($el, tag, items) {\n        if (!$el) return;\n\n        var name;\n        for (var key in items) {\n            if (items.hasOwnProperty(key)) {\n                var classname = items[key].params.classname || false;\n                var paramstag = items[key].params.tag;\n                if (tag === paramstag) {\n                    if (!classname) {\n                        name = key;\n                    }\n                    else if (classname && this.app.element.hasClass($el, classname)) {\n                        name = key;\n                    }\n                }\n            }\n        }\n\n        return name;\n    },\n    _setStyleAndClass: function($el, format) {\n        // add classname\n        if (format.classname) {\n            // clean classes & styles\n            $el.removeAttr('style class data-' + this.prefix + '-style-cache');\n\n            $el.addClass(format.classname);\n        }\n    },\n    _getListItems: function() {\n        var $items = this.$block.find('li');\n\n        $items.find('ul, ol').each(function($node) { $node.parent().after($node); });\n        $items.find('ul, ol').unwrap();\n\n        return $items;\n    },\n    _getDlistItems: function() {\n        return this.$block.find('dt, dd');\n    }\n});\nArticleEditor.add('module', 'link', {\n    popups: {\n        format: {\n            items: {\n                format: { title: '## link.link ##', command: 'link.format', shortcut: 'Ctrl+k' },\n                unlink: { title: '## link.unlink ##', command: 'link.unlink' }\n            }\n        },\n        change: {\n            items: {\n                edit: { title: '## link.edit-link ##', command: 'link.edit', shortcut: 'Ctrl+k' },\n                unlink: { title: '## link.unlink ##', command: 'link.unlink' }\n            }\n        },\n        create: {\n            title: '## popup.link ##',\n            width: '600px',\n            form:  {\n                text: { type: 'input', label: '## link.text ##' },\n                url: { type: 'input', label: '## link.url ##' },\n                target: { type: 'checkbox', text: '## link.link-in-new-tab ##' }\n            },\n            footer: {\n                insert: { title: '## link.insert ##', command: 'link.insert', type: 'primary' },\n                cancel: { title: '## link.cancel ##', command: 'popup.close' }\n            }\n        },\n        edit: {\n            title: '## popup.link ##',\n            width: '600px',\n            form: {\n                text: { type: 'input', label: '## link.text ##' },\n                url: { type: 'input', label: '## link.url ##' },\n                target: { type: 'checkbox', text: '## link.link-in-new-tab ##' }\n            },\n            footer: {\n                save: { title: '## link.save ##', command: 'link.save', type: 'primary' },\n                cancel: { title: '## link.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    popup: function(params, button) {\n        // get link\n        var $link = this.getLink();\n        var popup = ($link.length === 0) ? 'format' : 'change';\n\n        this.app.popup.create('link', this.popups[popup]);\n        this.app.popup.open({ button: button });\n    },\n    format: function(params) {\n        // selection\n        var text = this.app.selection.getText();\n\n        // popup\n        var stack = this.app.popup.create('link-create', this.popups.create);\n        var data = {\n            text: text,\n            target: this.opts.link.target\n        };\n\n        // set data\n        stack.setData(data);\n\n        // open\n        this.app.popup.open({ focus: (text) ? 'url' : 'text' });\n    },\n    edit: function() {\n        // get link\n        var $link = this.getLink();\n        var stack = this.app.popup.create('link-edit', this.popups.edit);\n\n        // set\n        var data = {\n            text: $link.text(),\n            url: $link.attr('href'),\n            target: $link.attr('target') || this.opts.link.target\n        };\n\n        // clean\n        data = this._encodeUrl(data);\n\n        // set data\n        stack.setData(data);\n\n        // open\n        this.app.popup.open({ focus: 'url' });\n\n    },\n    insert: function(stack) {\n        this.app.popup.close();\n\n        var nodes = this.app.inline.set({ tag: 'a', caret: 'after' });\n        var $link = this.dom(nodes);\n\n        // data\n        this._save(stack, $link, 'add');\n    },\n    save: function(stack) {\n        this.app.popup.close();\n\n        var $link = this.getLink();\n\n        // data\n        this._save(stack, $link, 'change');\n    },\n    unlink: function() {\n        this.app.popup.close();\n\n        var links = this.app.selection.getNodes({ tags: ['a'] });\n        if (links.length === 0) return;\n\n        // unlink\n        for (var i = 0; i < links.length; i++) {\n            var $link = this.dom(links[i]);\n\n            this.app.broadcast('link.remove', { url: $link.attr('href'), text: $link.text() });\n            $link.unwrap();\n        }\n\n        // ui\n        this.app.toolbar.observe();\n    },\n    getLink: function() {\n        var links = this.app.selection.getNodes({ tags: ['a'] });\n        var $link = (links.length !== 0) ? this.dom(links[0]) : this.dom([]);\n\n        return $link;\n    },\n\n    // private\n    _save: function(stack, $link, type) {\n        var data = stack.getData();\n        data = this._cleanUrl(data);\n        data = this._encodeUrl(data);\n\n        if (data.url === '') return;\n\n        data = this._setUrl($link, data);\n\n        if ($link.length === 1) {\n            data = this._setText($link, data);\n        }\n\n        data = this._setTarget($link, data);\n        data.element = $link;\n\n        this.app.broadcast('link.' + type, data);\n    },\n    _cleanUrl: function(data) {\n        data.url = this.app.content.escapeHtml(data.url);\n        data.url = (data.url.search(/^javascript:/i) !== -1) ? '' : data.url;\n\n        return data;\n    },\n    _encodeUrl: function(data) {\n        data.url = (data.url) ? data.url.replace(/&amp;/g, '&') : '';\n\n        return data;\n    },\n    _setUrl: function($link, data) {\n        $link.attr('href', data.url);\n\n        return data;\n    },\n    _setText: function($link, data) {\n        data.text = (data.text === '') ? data.url : data.text;\n        $link.text(data.text);\n\n        return data;\n    },\n    _setTarget: function($link, data) {\n        if (data.target) $link.attr('target', '_blank');\n        else $link.removeAttr('target');\n\n        return data;\n    }\n});\nArticleEditor.add('module', 'embed', {\n    popups: {\n        add: {\n            title: '## embed.embed ##',\n            width: '100%',\n            form: {\n                embed: { type: 'textarea', label: '## embed.description ##', rows: 6 },\n                caption: { type: 'input', label: '## embed.caption ##' },\n                responsive: { type: 'checkbox', text: '## embed.responsive-video ##' }\n            },\n            footer: {\n                insert: { title: '## buttons.insert ##', command: 'embed.insert', type: 'primary' },\n                cancel: { title: '## buttons.cancel ##', command: 'popup.close' }\n            }\n        },\n        edit: {\n            title: '## embed.embed ##',\n            width: '100%',\n            form: {\n                embed: { type: 'textarea', label: '## embed.description ##', rows: 6 },\n                caption: { type: 'input', label: '## embed.caption ##' },\n                responsive: { type: 'checkbox', text: '## embed.responsive-video ##' }\n            },\n            footer: {\n                save: { title: '## buttons.save ##', command: 'embed.save', type: 'primary' },\n                cancel: { title: '## buttons.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    build: function(scripts) {\n        if (scripts) {\n            this._callScripts(scripts);\n        }\n        else {\n            this._findScripts();\n        }\n    },\n    observe: function(obj, name, stack) {\n        if (!this.opts.embed) {\n            return false;\n        }\n\n        var instance = this.app.block.get();\n        if (stack && stack.getName() === 'addbar') {\n            obj.command = 'embed.popup';\n        }\n        else if (instance && instance.getType() === 'embed') {\n            obj.command = 'embed.edit';\n        }\n\n        return obj;\n    },\n    popup: function() {\n        var stack = this.app.popup.add('embed', this.popups.add);\n        stack.open({ focus: 'embed' });\n\n        // checkbox\n        if (this.opts.embed.checkbox) {\n            stack.getInput('responsive').attr('checked', true);\n        }\n\n        // codemirror\n        this._buildCodemirror(stack);\n    },\n    edit: function(params, button) {\n        var instance = this.app.block.get();\n        var data = {\n            embed: instance.getEmbedCode(),\n            caption: instance.getCaption(),\n            responsive: instance.isResponsive()\n        };\n\n        // popup & data\n        var stack = this.app.popup.create('embed', this.popups.edit);\n        stack.setData(data);\n\n        // open\n        this.app.popup.open({ button: button, focus: 'embed' });\n\n        // codemirror\n        this._buildCodemirror(stack);\n    },\n    insert: function(stack) {\n        this.app.popup.close();\n\n        // data\n        var data = stack.getData();\n        var code = this._getEmbedCode(data);\n        if (code === '') {\n            return;\n        }\n\n        // create\n        var instance = this._createInstance(data, code);\n        this.app.block.add({ instance: instance });\n    },\n    save: function(stack) {\n        this.app.popup.close();\n\n        // data\n        var current = this.app.block.get();\n        var data = stack.getData();\n        var code = this._getEmbedCode(data);\n        if (code === '') {\n            this.app.block.remove();\n            return;\n        }\n\n        // create\n        var instance = this._createInstance(data, code, current);\n\n        // change\n        if (this._isNeedToChange(data, instance, current)) {\n            this.app.block.change(instance);\n        }\n    },\n\n    // private\n    _buildCodemirror: function(stack) {\n        var $input = stack.getInput('embed');\n\n        this.app.codemirror.create({ el: $input, height: '200px', focus: true });\n        this.app.popup.updatePosition();\n    },\n    _findScripts: function() {\n        var scripts = this.app.editor.getLayout().find('[data-' + this.prefix + '-type=embed]').find('script').getAll();\n        this.build.call(this, scripts);\n    },\n    _callScripts: function(scripts) {\n        for (var i = 0; i < scripts.length; i++) {\n            if (scripts[i].src !== '') {\n                var src = scripts[i].src;\n\n                this.app.editor.getDoc().find('head script[src=\"' + src + '\"]').remove();\n                var $script = this.dom('<script>').attr({ 'src': src, 'async': true, 'defer': 'true' });\n                $script.on('load', function() {\n                    if (src.search('instagram') !== -1) {\n                        var win = this.app.editor.getWinNode();\n                        if (win.instgrm) {\n                            win.instgrm.Embeds.process();\n                        }\n                    }\n                    this.build(scripts.slice(i + 1));\n                }.bind(this));\n\n\n                var head = this.app.editor.getDocNode().getElementsByTagName('head')[0];\n                if (head) head.appendChild($script.get());\n            }\n        }\n    },\n    _getEmbedCode: function(data) {\n        var code = data.embed.trim();\n        code = this.app.codemirror.val(code);\n        code = this._removeScript(code);\n        code = this.app.content.sanitize(code);\n        code = (!this._isHtmlString(code) && code !== '') ? this._parseUrl(code) : code;\n\n        return code;\n    },\n    _removeScript: function(code) {\n        if (!this.opts.embed.script) {\n            code = this.app.content.removeTagsWithContent(code, ['script']);\n        }\n        return code;\n    },\n    _createInstance: function(data, code, current) {\n        var $figure;\n        if (current) {\n            var figure = current.duplicateEmpty();\n            $figure = figure.getBlock();\n            $figure.html(code);\n        }\n        else {\n            $figure = (this._isFigure(code)) ? code : '<figure>' + code + '</figure>';\n        }\n\n        var instance = this.app.create('block.embed', $figure);\n\n        // caption\n        instance.setCaption(data.caption);\n\n        // responsive\n        if (data.responsive) {\n            instance.addResponsive();\n        }\n\n        return instance;\n    },\n    _parseUrl: function(str) {\n        var iframeStart = '<iframe width=\"560\" height=\"315\" src=\"';\n        var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n        var parsed;\n        if (str.match(this.opts.regex.youtube)) {\n            var yturl = '//www.youtube.com';\n            if (str.search('youtube-nocookie.com') !== -1) {\n                yturl = '//www.youtube-nocookie.com';\n            }\n\n            parsed = str.replace(this.opts.regex.youtube, yturl + '/embed/$1');\n            return iframeStart + parsed + iframeEnd;\n        }\n        else if (str.match(this.opts.regex.vimeo)) {\n            parsed = str.replace(this.opts.regex.vimeo, '//player.vimeo.com/video/$2');\n            return iframeStart + parsed + iframeEnd;\n        }\n\n        return str;\n\n    },\n    _isNeedToChange: function(data, instance, current) {\n        if (current.getEmbedCode() !== instance.getEmbedCode()) return true;\n        if (data.responsive !== current.isResponsive()) return true;\n        if (data.caption !== current.getCaption()) return true;\n    },\n    _isHtmlString: function(str) {\n        return /^\\s*<(\\w+|!)[^>]*>/.test(str);\n    },\n    _isFigure: function(str) {\n        return /^<figure/.test(str);\n    }\n});\nArticleEditor.add('module', 'grid', {\n    popup: function() {\n\n        // create\n        var stack = this.app.popup.add('grid', {\n            title: '## popup.grid ##',\n            width: '320px',\n            items: this.buildItems()\n        });\n\n        stack.open();\n    },\n    observe: function() {\n        if (!this.opts.grid) return false;\n    },\n    buildItems: function() {\n        var items = {};\n\n        var z = 0;\n        for (var pattern in this.opts.grid.patterns) {\n            if (this.opts.grid.patterns.hasOwnProperty(pattern)) {\n                z++;\n                var $item = this._createPattern(pattern);\n\n                items['column' + z] = {\n                    html: $item,\n                    command: 'grid.add',\n                    params: { pattern: pattern, columns: this.opts.grid.patterns[pattern] }\n                };\n            }\n        }\n\n        return items;\n    },\n    add: function(params) {\n\n        this.app.popup.close();\n\n        var pattern = (params.columns === '');\n        var columns = (pattern) ? params.pattern.split('|') : params.columns.split('|');\n        var $grid =  this.dom('<div>').addClass(this.opts.grid.classname);\n        if (this.opts.grid.classes !== '') {\n            $grid.addClass(this.opts.grid.classes);\n        }\n\n        for (var i = 0; i < columns.length; i++) {\n            var column = this.app.create('block.column');\n            var $column = column.getBlock();\n\n            if (!pattern) {\n                $column.addClass(columns[i]);\n            }\n\n            $grid.append($column);\n        }\n\n        // add\n        var instance = this.app.block.add({\n            name: 'grid',\n            source: $grid,\n            caret: false\n        });\n\n        // set\n        this.app.block.set(instance);\n    },\n\n    // private\n    _createPattern: function(pattern) {\n        var $item = this.dom('<div>').addClass(this.prefix + '-popup-grid-box');\n        var columns = pattern.split('|');\n        var sum = this.app.utils.sumOfArray(columns);\n        var unit = 100/sum;\n\n        for (var i = 0; i < columns.length; i++) {\n            var $column = this.dom('<span>');\n            $column.addClass(this.prefix + '-popup-grid-column');\n            $column.css('width', (columns[i] * unit) + '%');\n\n            $item.append($column);\n        }\n\n\n        return $item;\n    }\n});\nArticleEditor.add('module', 'image', {\n    popups: {\n        add: {\n            title: '## popup.add-image ##',\n            width: '100%'\n        },\n        edit: {\n            title: '## popup.image ##',\n            width: '100%',\n            getter: 'block.getData',\n            form: {\n                width: { type: 'input', width: '100px', label: '## image.width ##', observer: 'image.observeImageWidth' },\n                alt: { type: 'input', label: '## image.alt-text ##' },\n                caption: { type: 'input', label: '## image.caption ##', observer: 'image.observeImageCaption' },\n                link: { type: 'input', label: '## image.link ##', observer: 'image.observeImageLink' },\n                target: { type: 'checkbox', text: '## image.link-in-new-tab ##', observer: 'image.observeImageLink' }\n            },\n            footer:  {\n                'save': { title: '## image.save ##', command: 'image.save', type: 'primary' },\n                'cancel': { title: '## image.cancel ##', command: 'popup.close' }\n            }\n        },\n        editcard: {\n            title: '## popup.image ##',\n            width: '100%',\n            getter: 'block.getData',\n            setter: 'block.setData',\n            form: {\n                alt: { type: 'input', label: '## image.alt-text ##' }\n            },\n            footer:  {\n                'save': { title: '## image.save ##', command: 'image.save', type: 'primary' },\n                'cancel': { title: '## image.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    init: function() {\n        this.dataStates = [];\n    },\n    popup: function() {\n\n        var stack = this.app.popup.add('image', this.popups.add);\n        var $body = stack.getBody();\n\n        this._createImageByUrl($body);\n        this._createOrSection($body);\n        this._createUploadBox($body);\n        this._createSelectBox($body);\n\n        // open\n        stack.open();\n    },\n    edit: function(params, button) {\n        this._edit('edit', button);\n    },\n    editCard: function(params, button) {\n        this._edit('editcard', button);\n    },\n    observe: function(obj, name, stack) {\n        if (!this.opts.image) {\n            return false;\n        }\n\n        var instance = this.app.block.get();\n        if (stack && stack.getName() === 'addbar') {\n            obj.command = 'image.popup';\n        }\n        else if (instance && instance.getType() === 'image') {\n            obj.command = 'image.edit';\n        }\n\n        return obj;\n    },\n    observeStates: function() {\n        this._findImages().each(this._addImageState.bind(this));\n    },\n    observeImageLink: function(obj) {\n        return (this.opts.image.link) ? obj : false;\n    },\n    observeImageCaption: function(obj) {\n        var instance = this.app.block.get();\n        if (instance && instance.getTag() === 'figure') {\n            return obj;\n        }\n        else {\n            return false;\n        }\n    },\n    observeImageWidth: function(obj) {\n        return (this.opts.image.width) ? obj : false;\n    },\n    parseInserted: function(inserted) {\n        var files = [];\n        var params = {\n            url: this.opts.image.upload,\n            name: this.opts.image.name,\n            data: this.opts.image.data,\n            multiple: true,\n            success: 'image.insertFromInserted',\n            error: 'image.error'\n        };\n        this.pasteInsertedImages = [];\n        this.resolved = [];\n        var fetchImages = 0;\n        for (var i = 0; i < inserted.instances.length; i++) {\n            var instance = inserted.instances[i];\n            var type = instance.getType();\n            if (type === 'image') {\n                var src = instance.getSrc();\n\n                if (src.search(/^data:/i) !== -1) {\n                    var blob = this._dataURLtoFile(src, 'image' + i);\n                    files.push(blob);\n                    this.pasteInsertedImages.push(instance);\n                }\n                else if (src.search(/^blob:/i) !== -1) {\n                    fetchImages++;\n                    this.pasteInsertedImages.push(instance);\n                    var self = this;\n                    function sendFile(src, i) {\n                        var xhr = new XMLHttpRequest();\n                        xhr.open('GET', src, true);\n                        xhr.responseType = 'blob';\n                        xhr.onload = function(e) {\n                          if (xhr.status == 200) {\n                            var blob = xhr.response;\n                            var file = new File([blob], 'image' + i, { type: \"image/png\" });\n                            self.resolved.push(file);\n                          }\n                        };\n                        xhr.send();\n                    }\n                    sendFile(src, i);\n                }\n            }\n        }\n\n        if (fetchImages !== 0) {\n            var interval = setInterval(function() {\n                if (this.resolved.length === fetchImages) {\n                    clearInterval(interval);\n                    var upload = this.app.create('upload');\n                    upload.send(false, this.resolved, params);\n                }\n            }.bind(this), 100);\n        }\n\n\n        if (files.length !== 0) {\n            var upload = this.app.create('upload');\n            upload.send(false, files, params);\n        }\n    },\n    paste: function(blob, e) {\n        var params = {\n            url: this.opts.image.upload,\n            name: this.opts.image.name,\n            data: this.opts.image.data,\n            multiple: false,\n            success: 'image.insertFromBlob',\n            error: 'image.error'\n        };\n\n        // upload\n        var upload = this.app.create('upload');\n        upload.send(e, [blob], params);\n    },\n    drop: function(e, dt) {\n        var files = [];\n        for (var i = 0; i < dt.files.length; i++) {\n            var file = dt.files[i] || dt.items[i].getAsFile();\n            if (file) {\n                files.push(file);\n            }\n        }\n\n        var params = {\n            url: this.opts.image.upload,\n            name: this.opts.image.name,\n            data: this.opts.image.data,\n            multiple: this.opts.image.multiple,\n            success: 'image.insertByDrop',\n            error: 'image.error'\n        };\n\n        if (files.length > 0) {\n\n            var $block = this.dom(e.target).closest('[data-' + this.prefix + '-type]');\n            if ($block.length !== 0) {\n                this.app.block.set($block);\n            }\n\n            // upload\n            var upload = this.app.create('upload');\n            upload.send(e, files, params);\n        }\n    },\n    insertFromClipboard: function(clipboard) {\n        var text = clipboard.getData(\"text/plain\") || clipboard.getData(\"text/html\");\n        text = text.trim();\n\n        if (text !== '') {\n            return;\n        }\n\n        var items = clipboard.items;\n        var blob = null;\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].type.indexOf(\"image\") === 0) {\n                blob = items[i].getAsFile();\n            }\n        }\n\n        if (blob !== null) {\n            this.paste(blob);\n            return true;\n        }\n    },\n    insertFromBlob: function(response) {\n        this.insert(response);\n    },\n    insertByDrop: function(response, e) {\n        if (this.app.block.is()) {\n            var instance = this.app.block.get();\n            var target = e.target;\n            var type = instance.getType();\n            var isChange = ((type === 'card' && target && target.tagName === 'IMG' && instance.hasImage()) || type === 'image');\n            if (isChange) {\n                this.change(response);\n                return;\n            }\n            else if (e && type !== 'card' && instance.isEditable()) {\n                this.app.insertion.insertPoint(e);\n            }\n        }\n\n        this.insert(response);\n    },\n    insertByUpload: function(response) {\n        this.insert(response);\n    },\n    insertByUrl: function(e) {\n        e.preventDefault();\n\n        var str = this.$urlinput.val();\n        if (str.trim() === '') {\n            return;\n        }\n\n        var response = {\n            file: { url: str, id: this.app.utils.getRandomId() }\n        };\n\n        // insert\n        this.insert(response);\n    },\n    insertFromSelect: function(e) {\n        e.preventDefault();\n\n        var $target = this.dom(e.target);\n        var obj = { url: $target.attr('data-url') };\n        var attrs = ['id', 'alt', 'caption', 'link', 'width', 'height'];\n        for (var i = 0; i < attrs.length; i++) {\n            var val = $target.attr('data-' + attrs[i]);\n            if (val !== null) { obj[attrs[i]] = val; }\n        }\n\n        // insert\n        this.insert({ file: obj }, true);\n    },\n    insertFromInserted: function(response) {\n        var z = 0;\n        for (var key in response) {\n            if (response.hasOwnProperty(key)) {\n                this.pasteInsertedImages[z].setImage(response[key]);\n                z++;\n            }\n        }\n    },\n    changeClone: function(response) {\n        for (var key in response) {\n            if (response.hasOwnProperty(key)) {\n                this.$imageclone.attr('src', response[key].url);\n                break;\n            }\n        }\n\n        this.change(response, false);\n    },\n    change: function(response, closepopup) {\n        if (closepopup !== false) {\n            this.app.popup.close();\n        }\n\n        var instance = this.app.block.get();\n        for (var key in response) {\n            if (response.hasOwnProperty(key)) {\n                instance.setImage(response[key]);\n\n                // broadcast\n                this.app.broadcast('image.change', response[key]);\n                this.app.broadcast('image.upload', { instance: instance, data: response[key] });\n                return;\n            }\n        }\n    },\n    save: function(stack) {\n        this.app.popup.close();\n        this.app.block.setData(stack);\n    },\n    insert: function(response, select) {\n        // popup close\n        this.app.popup.close();\n\n        // insert\n        this.imageslen = 0;\n        this.imagescount = 0;\n\n        // tag\n        var tag = this.opts.image.tag;\n\n        // loop\n        for (var key in response) {\n            if (response.hasOwnProperty(key)) {\n                var $source = this.dom('<' + tag + '>');\n                var $image = this._createImageFromResponseItem(response[key]);\n\n                $source.append($image);\n\n                var instance = this.app.create('block.image', $source);\n                this.app.block.add({ instance: instance, type: 'image' });\n\n                // caption\n                if (Object.prototype.hasOwnProperty.call(response[key], 'caption')) {\n                    var $caption = this.dom('<figcaption>').html(response[key].caption);\n                    instance.$block.append($caption);\n                    this.app.create('block.figcaption', $caption);\n                }\n\n                // broadcast\n                var eventType = (select) ? 'select' : 'upload';\n                this.app.broadcast('image.' + eventType, { instance: instance, data: response[key] });\n\n                this.$last = instance.getBlock();\n                this.imageslen++;\n            }\n        }\n    },\n    error: function(response) {\n        this.app.broadcast('image.upload.error', { response: response });\n    },\n    getStates: function() {\n        var $images = this._findImages();\n\n        // check status\n        for (var key in this.dataStates) {\n            if (this.dataStates.hasOwnProperty(key)) {\n                var data = this.dataStates[key];\n                var status = $images.is('[data-image=\"' + data.id + '\"]');\n                this._setImageState(data.id, status);\n            }\n        }\n\n        return this.dataStates;\n    },\n    createUploadBox: function(upload, $body) {\n        if (!upload) return;\n\n        var $upload = this.dom('<div>');\n        $body.append($upload);\n\n        return $upload;\n    },\n    createSelectBox: function(select, $body, callback) {\n        if (!select) return;\n\n        // images box\n        this.$selectbox = this._createImagesBox($body);\n\n        if (typeof select === 'object') {\n            this._parseList(select, callback);\n        }\n        else {\n            var getdata = (this.opts.editor.reloadmarker) ? { d: new Date().getTime() } : {};\n\n            this.ajax.request(this.opts.image.selectMethod, {\n                url: select,\n                data: getdata,\n                success: function(data) {\n                    this._parseList(data, callback);\n                }.bind(this)\n            });\n        }\n    },\n\n    // private\n    _edit: function(type, button) {\n        this.app.popup.create('image-edit', this.popups[type]);\n        this._buildEditUpload();\n        this.app.popup.open({ button: button });\n    },\n    _findImages: function() {\n        return this.app.editor.getLayout().find('[data-image]');\n    },\n    _addImageState: function($node) {\n        var id = $node.attr('data-image');\n        this.dataStates[id] = { type: 'image', status: true, url: $node.attr('src'), $img: $node, $el: $node, id: id };\n    },\n    _setImageState: function(url, status) {\n        this.dataStates[url].status = status;\n    },\n    _checkImageLoad: function() {\n        this.imagescount++;\n        if (this.imagescount === this.imageslen) {\n            this.app.block.unset();\n            this.app.block.set(this.$last);\n            this.app.editor.adjustHeight();\n        }\n    },\n    _buildEditUpload: function() {\n        if (!this.opts.image.upload) return;\n\n        var instance = this.app.block.get();\n\n        // stack\n        var stack = this.app.popup.getStack();\n        var $body = stack.getBody();\n\n        // form item\n        var $item = this._createFormItem();\n        $item.addClass(this.prefix + '-form-item-edit-image-box');\n\n        // image\n        this.$imageclone = instance.getImage().clone();\n        this.$imageclone.removeAttr('width height style');\n\n        var $imageitem = this.dom('<div>').addClass(this.prefix + '-form-item-image');\n\n        $imageitem.append(this.$imageclone);\n        $item.append($imageitem);\n\n        // upload item\n        this.$upload = this.dom('<div>');\n        $item.append(this.$upload);\n\n        // append to popup\n        $body.prepend($item);\n\n        // build upload\n        this._buildUpload(this.$upload, 'image.changeClone');\n    },\n    _buildUpload: function($item, callback) {\n        if (!this.opts.image.upload) return;\n\n        var params = {\n            box: true,\n            placeholder: this.lang.get('image.upload-new-placeholder'),\n            url: this.opts.image.upload,\n            name: this.opts.image.name,\n            data: this.opts.image.data,\n            multiple: this.opts.image.multiple,\n            success: callback,\n            error: 'image.error'\n        };\n\n        this.app.create('upload', $item, params);\n    },\n    _createSelectBox: function($body) {\n        this.createSelectBox(this.opts.image.select, $body, 'image.insertFromSelect');\n    },\n    _createUploadBox: function($body) {\n        this.$upload = this.createUploadBox(this.opts.image.upload, $body);\n        this._buildUpload(this.$upload, 'image.insertByUpload');\n    },\n    _createImageFromResponseItem: function(item) {\n        var $image = this.dom('<img>').attr('src', item.url).one('load', this._checkImageLoad.bind(this));\n        var $item = $image;\n\n        var attrs = ['id', 'alt', 'width', 'height'];\n        for (var i = 0; i < attrs.length; i++) {\n            if (Object.prototype.hasOwnProperty.call(item, attrs[i])) {\n                $item.attr(attrs[i], item[attrs[i]]);\n            }\n        }\n\n        // srcset & data-image\n        if (Object.prototype.hasOwnProperty.call(item, 'id')) $item.attr('data-image', item.id);\n        if (Object.prototype.hasOwnProperty.call(item, '2x')) $item.attr('srcset', item['2x'] + ' 2x');\n\n        // link\n        if (Object.prototype.hasOwnProperty.call(item, 'link')) {\n            var $link = this.dom('<a>');\n            $link.attr('href', item.link);\n            $image.wrap($link);\n            $item = $link;\n        }\n\n        return $item;\n    },\n    _createImagesBox: function($body) {\n        var $box = this.dom('<div>').addClass(this.prefix + '-popup-images-box');\n        $body.append($box);\n\n        return $box;\n    },\n    _createOrSection: function($body) {\n        if (this.opts.image.url && (this.opts.image.upload || this.opts.image.select)) {\n            var $section = this.dom('<div>').addClass(this.prefix + '-popup-image-section-or');\n            $section.html(this.lang.get('image.or'));\n            $body.append($section);\n        }\n    },\n    _createImageByUrl: function($body) {\n        if (!this.opts.image.url) return;\n\n        var $item = this._createFormItem();\n\n        this.$urlinput = this._createUrlInput();\n        this.$urlbutton = this._createUrlButton();\n\n        $item.append(this.$urlinput);\n        $item.append(this.$urlbutton);\n\n        $body.append($item);\n    },\n    _createFormItem: function() {\n        return this.dom('<div>').addClass(this.prefix + '-form-container-flex');\n    },\n    _createUrlInput: function() {\n        var $input = this.dom('<input>').addClass(this.prefix + '-form-input');\n        $input.attr('placeholder', this.lang.get('image.url-placeholder'));\n\n        return $input;\n    },\n    _createUrlButton: function() {\n        var $button = this.dom('<button>').addClass(this.prefix + '-form-button ' + this.prefix + '-form-button-primary');\n        $button.html(this.lang.get('image.insert'));\n        $button.one('click', this.insertByUrl.bind(this));\n\n        return $button;\n    },\n    _parseList: function(data, callback) {\n        for (var key in data) {\n            if (data.hasOwnProperty(key)) {\n                var obj = data[key];\n                if (typeof obj !== 'object') continue;\n\n                var $img = this.dom('<img>');\n                var url = (obj.thumb) ? obj.thumb : obj.url;\n\n                $img.addClass(this.prefix + '-popup-event');\n                $img.attr('src', url);\n                $img.attr('data-url', obj.url);\n                $img.attr('data-callback', callback);\n\n                var attrs = ['id', 'alt', 'caption', 'link', 'width', 'height'];\n                for (var i = 0; i < attrs.length; i++) {\n                    if (Object.prototype.hasOwnProperty.call(obj, attrs[i])) {\n                        $img.attr('data-' + attrs[i], obj[attrs[i]]);\n                    }\n                }\n\n                $img.on('click.' + this.prefix + '-popup-event-' + this.uuid, function(e) {\n                    var $target = this.dom(e.target);\n                    var callback = $target.attr('data-callback');\n\n                    this.app.api(callback, e);\n\n                }.bind(this));\n\n                this.$selectbox.append($img);\n            }\n        }\n    },\n    _dataURLtoFile: function(dataurl, filename) {\n        var arr = dataurl.split(','),\n            mime = arr[0].match(/:(.*?);/)[1],\n            bstr = atob(arr[1]),\n            n = bstr.length,\n            u8arr = new Uint8Array(n);\n\n        while(n--){\n            u8arr[n] = bstr.charCodeAt(n);\n        }\n\n        return new File([u8arr], filename, {type:mime});\n    }\n});\nArticleEditor.add('module', 'table', {\n    popups: {\n        cell: {\n            title: '## table.table-cell ##',\n            width: '300px',\n            form: {\n                width: { type: 'input', label: '## table.width ##' },\n                nowrap: { type: 'checkbox', text: '## table.nowrap ##' }\n            },\n            footer: {\n                insert: { title: '## table.save ##', command: 'table.save', type: 'primary' },\n                cancel: { title: '## table.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    items: {\n        table: {\n            addhead: { title: '## table.add-head ##', command: 'table.addHead' },\n            removehead: { title: '## table.remove-head ##', command: 'table.removeHead' }\n        },\n        row: {\n            addrowbelow: { title: '## table.add-row-below ##', command: 'table.addRowBelow' },\n            addrowabove: { title: '## table.add-row-above ##', command: 'table.addRowAbove' },\n            removerow: { title: '## table.remove-row ##', command: 'table.removeRow' }\n        },\n        cell: {\n            addcolumnafter: { title: '## table.add-column-after ##', command: 'table.addColumnAfter' },\n            addcolumnbefore: { title: '## table.add-column-before ##', command: 'table.addColumnBefore' },\n            addrowbelow: { title: '## table.add-row-below ##', command: 'table.addRowBelow' },\n            addrowabove: { title: '## table.add-row-above ##', command: 'table.addRowAbove' },\n            removecolumn: { title: '## table.remove-column ##', command: 'table.removeColumn' },\n            removerow: { title: '## table.remove-row ##', command: 'table.removeRow' }\n        }\n    },\n    add: function() {\n        // add\n        var instance = this.app.block.add({\n            name: 'table',\n            source: this.opts.table.template,\n            caret: false\n        });\n\n        // focus\n        var cell = instance.getFirstCell();\n        if (cell) {\n            this.app.block.set(cell, 'start');\n        }\n    },\n    observe: function(obj, name, stack) {\n        if (!this.opts.table) {\n            return false;\n        }\n\n        var instance = this.app.block.get();\n        if (stack && stack.getName() === 'addbar') {\n            obj.command = 'table.add';\n        }\n        else if (instance && instance.isType(['table', 'row', 'cell'])) {\n            obj.command = 'table.popup';\n        }\n\n        return obj;\n    },\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var type = instance.getType();\n\n        this.app.popup.create('table', {\n            items: this.items[type]\n        });\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    addHead: function() {\n        this.removeHead();\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n            var columns = $block.find('tr').first().children('td, th').length;\n            var $head = this.dom('<thead>');\n        var $row = this._buildRow(columns, '<th>');\n\n        $head.append($row);\n        $block.prepend($head);\n\n        // set\n        this.app.block.set($row.children('td, th').first(), 'start');\n    },\n    addRowBelow: function() {\n        this._addRow('below');\n    },\n    addRowAbove: function() {\n        this._addRow('above');\n    },\n    addColumnBefore: function() {\n        this._addColumn('before');\n    },\n    addColumnAfter: function() {\n        this._addColumn('after');\n    },\n    removeHead: function() {\n        this.app.popup.close();\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        var $head = $block.find('thead');\n        if ($head.length !== 0) {\n            $head.remove();\n        }\n    },\n    removeRow: function() {\n        this.app.popup.close();\n        this.app.control.close();\n\n        var instance = this.app.block.get();\n        if (instance.getType() === 'cell') {\n            instance = instance.getParent(['row']);\n        }\n        instance.remove(true);\n    },\n    removeColumn: function() {\n        this.app.popup.close();\n        this.app.control.close();\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        var $table = $block.closest('table');\n        var $row = $block.closest('tr');\n\n        var index = 0;\n        $row.find('td, th').each(function($node, i) {\n            if ($node.get() === $block.get()) index = i;\n        });\n\n        $table.find('tr').each(function($node) {\n            var cell = $node.find('td, th').get(index);\n            var $cell = this.dom(cell);\n            $cell.remove();\n        }.bind(this));\n    },\n    cellSetting: function(params, button) {\n        var instance = this.app.block.get();\n        var popup = this.app.popup.create('cell', this.popups.cell);\n\n        // data\n        popup.setData({\n            width: instance.getWidth(),\n            nowrap: instance.getNowrap()\n        });\n\n        // open\n        this.app.popup.open({ button: button, focus: 'width' });\n    },\n    save: function(stack) {\n        // popup close\n        this.app.popup.close();\n\n        // data\n        var data = stack.getData();\n        var instance = this.app.block.get();\n\n        if (data.width !== '') {\n            instance.setWidth(data.width);\n        }\n\n        instance.setNowrap(data.nowrap);\n    },\n\n\n    // private\n    _addColumn: function(name) {\n        this.app.popup.close();\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        var $table = $block.closest('table');\n        var $row = $block.closest('tr');\n\n        var index = 0;\n        $row.find('td, th').each(function($node, i) {\n            if ($node.get() === $block.get()) index = i;\n        });\n\n        var rowIndex = 0;\n        $table.find('tr').each(function($node, i) {\n            if ($node.get() === $row.get()) rowIndex = i;\n        });\n\n        var $newCell;\n        $table.find('tr').each(function($node, i) {\n            var cell = $node.find('td, th').get(index);\n            var $cell = this.dom(cell);\n\n\n            var $td = $cell.clone();\n            $td.html('');\n\n      // create instance\n            this.app.create('block.cell', $td);\n\n            if (rowIndex === i) {\n                $newCell = $td;\n            }\n\n            // after / before\n              $cell[name]($td);\n\n        }.bind(this));\n\n        // set focus\n        if ($newCell) {\n            this.app.block.set($newCell, 'start');\n        }\n    },\n    _addRow: function(name) {\n        this.app.popup.close();\n\n        var position = (name === 'below') ? 'after' : 'before';\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        var $row = $block.closest('tr');\n        var $head = $block.closest('thead');\n\n        var columns = $row.children('td, th').length;\n        var $newRow = this._buildRow(columns, '<td>');\n        if ($head.length !== 0) {\n            $head.after($newRow);\n        }\n        else {\n            $row[position]($newRow);\n        }\n\n        // set focus\n        this.app.block.set($newRow.find('td, th').first(), 'start');\n    },\n    _buildRow: function(columns, tag) {\n        var $row = this.dom('<tr>');\n\n        // create instance\n        this.app.create('block.row', $row);\n\n        for (var i = 0; i < columns; i++) {\n            var $cell = this.dom(tag);\n\n            // create instance\n            this.app.create('block.cell', $cell);\n\n            // append\n            $row.append($cell);\n        }\n\n        return $row;\n    }\n});\nArticleEditor.add('module', 'snippet', {\n    popups: {\n        base: {\n            title: '## popup.snippets ##',\n            width: '100%'\n        }\n    },\n    init: function() {\n        this.json = {};\n    },\n    observe: function() {\n        if (!this.opts.snippets) return false;\n    },\n    popup: function() {\n        var stack = this.app.popup.add('snippets', this.popups.base);\n\n        // data\n        var $body = stack.getBody();\n\n        // json url\n        if (typeof this.opts.snippets === 'string') {\n            var getdata = (this.opts.editor.reloadmarker) ? { d: new Date().getTime() } : {};\n\n            this.ajax.get({\n                url: this.opts.snippets,\n                data: getdata,\n                success: function(data) {\n                    this._buildPopup(data, $body);\n                }.bind(this)\n            });\n        }\n        // json object\n        else {\n            this._buildPopup(this.opts.snippets, $body);\n        }\n\n        // open\n        stack.open();\n    },\n    insert: function(e) {\n        var $trigger = this.dom(e.target).closest('.' + this.prefix + '-snippet-container');\n        var key = $trigger.attr('data-snippet-key');\n\n        if (Object.prototype.hasOwnProperty.call(this.json, key)) {\n            this.app.popup.close();\n\n            var html = this.json[key].html;\n\n            this.app.editor.insertContent({ html: html, caret: 'start' });\n        }\n    },\n\n    // private\n    _buildPopup: function(data, $body) {\n        this.json = data;\n        if (typeof data === 'string') {\n            this.json = JSON.parse(data);\n        }\n\n        Object.keys(this.json).forEach(function(key) {\n            var $container = this._buildPreviewContainer($body, key);\n\n            // preview\n            this._buildPreview($container, key);\n            this._buildPreviewName($container, key);\n        }.bind(this));\n    },\n    _buildPreviewContainer: function($body, key) {\n        var $div = this.dom('<div>').addClass(this.prefix + '-snippet-container');\n        $div.attr('data-snippet-key', key);\n        $div.one('click', this.insert.bind(this));\n\n        // append\n        $body.append($div);\n\n        return $div;\n    },\n    _buildPreview: function($container, key) {\n        var $div = this.dom('<div>');\n        if (Object.prototype.hasOwnProperty.call(this.json[key], 'image')) {\n            $div.addClass(this.prefix + '-snippet-image');\n            var $img = this.dom('<img>').attr('src', this.json[key].image);\n            $div.html($img);\n        }\n        else {\n            $div.addClass(this.prefix + '-snippet-preview');\n            $div.html(this.json[key].html);\n        }\n\n        $container.append($div);\n    },\n    _buildPreviewName: function($container, key) {\n        if (!Object.prototype.hasOwnProperty.call(this.json[key], 'name')) return;\n\n        var $span = this.dom('<div>').addClass(this.prefix + '-snippet-name');\n        $span.text(this.json[key].name);\n\n        $container.append($span);\n    }\n});\nArticleEditor.add('module', 'template', {\n    popups: {\n        base: {\n            title: '## templates.templates ##',\n            width: '100%'\n        }\n    },\n    init: function() {\n        this.json = {};\n    },\n    observe: function() {\n        if (!this.opts.templates) return false;\n    },\n    popup: function(params, button) {\n        // json url\n        if (typeof this.opts.templates === 'string') {\n            var getdata = (this.opts.editor.reloadmarker) ? { d: new Date().getTime() } : {};\n\n            this.ajax.get({\n                url: this.opts.templates,\n                data: getdata,\n                success: function(data) {\n                    this._buildPopup(button, data);\n                }.bind(this)\n            });\n        }\n        // json object\n        else {\n            this._buildPopup(button, this.opts.templates);\n        }\n    },\n    insert: function(e) {\n        var $trigger = this.dom(e.target).closest('.' + this.prefix + '-template-container');\n        var key = $trigger.attr('data-template-key');\n\n        if (Object.prototype.hasOwnProperty.call(this.json, key)) {\n            this.app.popup.close();\n\n            var html = this.json[key].html;\n            this.app.editor.setContent({ html: html, caret: false });\n        }\n    },\n\n    // private\n    _buildPopup: function(button, data) {\n\n        // popup\n        var popup = this.app.popup.create('templates', this.popups.base);\n        var $body = popup.getBody();\n\n        // json\n        this.json = (typeof data === 'string') ? JSON.parse(data) : data;\n\n        // items\n        Object.keys(this.json).forEach(function(key) {\n            var $container = this._buildPreviewContainer($body, key);\n\n            // preview\n            this._buildPreview($container, key);\n            this._buildPreviewName($container, key);\n        }.bind(this));\n\n        // open\n        this.app.popup.open({ button: button });\n\n    },\n    _buildPreviewContainer: function($body, key) {\n        var $div = this.dom('<div>').addClass(this.prefix + '-template-container');\n        $div.attr('data-template-key', key);\n        $div.one('click', this.insert.bind(this));\n\n        // append\n        $body.append($div);\n\n        return $div;\n    },\n    _buildPreview: function($container, key) {\n        var $div = this.dom('<div>');\n        if (Object.prototype.hasOwnProperty.call(this.json[key], 'image')) {\n            $div.addClass(this.prefix + '-template-image');\n            var $img = this.dom('<img>').attr('src', this.json[key].image);\n            $div.html($img);\n        }\n        else {\n            $div.addClass(this.prefix + '-template-preview');\n            $div.html(this.json[key].html);\n        }\n\n        $container.append($div);\n    },\n    _buildPreviewName: function($container, key) {\n        if (!Object.prototype.hasOwnProperty.call(this.json[key], 'name')) return;\n\n        var $span = this.dom('<div>').addClass(this.prefix + '-template-name');\n        $span.text(this.json[key].name);\n\n        $container.append($span);\n    }\n});\nArticleEditor.add('class', 'tool.checkbox', {\n    mixins: ['tool'],\n    type: 'checkbox',\n    input: {\n        tag: 'input',\n        type: 'checkbox',\n        classname: '-form-checkbox'\n    },\n    getValue: function() {\n        return this.$input.val();\n    },\n\n    // private\n    _buildInput: function() {\n        this.$box = this.dom('<label>').addClass(this.prefix + '-form-checkbox-item');\n        this.$box.append(this.$input);\n\n        // checkbox text\n        if (this._has('text')) {\n            var $span = this.dom('<span>').html(this.lang.parse(this.obj.text));\n            this.$box.append($span);\n        }\n\n        this.$tool.append(this.$box);\n    }\n});\nArticleEditor.add('class', 'tool.input', {\n    mixins: ['tool'],\n    type: 'input',\n    input: {\n        tag: 'input',\n        type: 'text',\n        classname: '-form-input'\n    },\n\n    // private\n    _buildInput: function() {\n        this.$tool.append(this.$input);\n    }\n});\nArticleEditor.add('class', 'tool.number', {\n    mixins: ['tool'],\n    type: 'number',\n    input: {\n        tag: 'input',\n        type: 'number',\n        classname: '-form-input'\n    },\n\n    // private\n    _buildInput: function() {\n        this.$input.attr('min', 0).css('max-width', '65px');\n        this.$tool.append(this.$input);\n    }\n});\nArticleEditor.add('class', 'tool.segment', {\n    mixins: ['tool'],\n    type: 'segment',\n    input: {\n        tag: 'input',\n        type: 'hidden',\n        classname: '-form-input'\n    },\n    setValue: function(value) {\n        this.$segment.find('.' + this.prefix + '-form-segment-item').removeClass('active');\n        this.$segment.find('[data-segment=' + value + ']').addClass('active');\n        this.$input.val(value);\n    },\n\n    // private\n    _buildInput: function() {\n        this.$segment = this.dom('<div>').addClass(this.prefix + '-form-segment');\n\n        var segments = this.obj.segments;\n        for (var name in segments) {\n            if (segments.hasOwnProperty(name)) {\n                var $segment = this.dom('<span>').addClass(this.prefix + '-form-segment-item');\n                $segment.attr('data-segment', name).on('click', this._catchSegment.bind(this));\n\n                if (Object.prototype.hasOwnProperty.call(segments[name], 'icon')) {\n                    $segment.html(segments[name].icon);\n                }\n                else {\n                    $segment.addClass(this.prefix + '-icon-' + segments[name].prefix + '-' + name);\n                }\n\n                this.$segment.append($segment);\n            }\n        }\n\n        this.$segment.append(this.$input);\n        this.$tool.append(this.$segment);\n    },\n    _catchSegment: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $item = this.dom(e.target).closest('.' + this.prefix + '-form-segment-item');\n        var value = $item.attr('data-segment');\n\n        this.$segment.find('.' + this.prefix + '-form-segment-item').removeClass('active');\n        $item.addClass('active');\n        this.$input.val(value);\n\n        // call setter\n        this.app.api(this.setter, this.popup);\n    }\n});\nArticleEditor.add('class', 'tool.select', {\n    mixins: ['tool'],\n    type: 'select',\n    input: {\n        tag: 'select',\n        classname: '-form-select'\n    },\n\n    // private\n    _buildInput: function() {\n        for (var value in this.obj.options) {\n            if (this.obj.options.hasOwnProperty(value)) {\n                var $option = this.dom('<option>');\n                $option.val(value);\n                $option.html(this.lang.parse(this.obj.options[value]));\n\n                this.$input.append($option);\n            }\n        }\n\n        this.$tool.append(this.$input);\n    }\n});\nArticleEditor.add('class', 'tool.textarea', {\n    mixins: ['tool'],\n    type: 'textarea',\n    input: {\n        tag: 'textarea',\n        classname: '-form-textarea'\n    },\n    setFocus: function() {\n        this.$input.focus();\n        this.$input.get().setSelectionRange(0, 0);\n        this.$input.scrollTop(0);\n    },\n\n    // private\n    _buildInput: function() {\n        if (this._has('rows')) {\n            this.$input.attr('rows', this._get('rows'));\n        }\n\n        this.$input.attr('data-gramm_editor', false);\n        this.$tool.append(this.$input);\n    }\n});\nArticleEditor.add('class', 'tool.upload', {\n    mixins: ['tool'],\n    type: 'upload',\n    input: {\n        tag: 'input',\n        type: 'hidden',\n        classname: '-form-input'\n    },\n    setValue: function(value) {\n        value = (value) ? value : '';\n\n        if (this.upload) {\n            this.upload.setImage(value);\n        }\n\n        this.$input.val(value);\n    },\n\n    // private\n    _buildInput: function() {\n        // input\n        this.$tool.append(this.$input);\n        this._buildUpload();\n    },\n    _buildUpload: function() {\n        this.$upload = this.dom('<input>').attr('type', 'file');\n        this.$tool.append(this.$upload);\n\n        // tool trigger method\n        var trigger = {};\n        if (this._has('trigger') && this._get('trigger')) {\n            trigger = {\n                instance: this,\n                method: 'trigger'\n            };\n        }\n\n        // create upload\n        this.upload = this.app.create('upload', this.$upload, this.obj.upload, trigger);\n    }\n});\nArticleEditor.add('block', 'block.paragraph', {\n    mixins: ['block'],\n    type: 'paragraph',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'format': { title: '## buttons.format ##', command: 'format.popup' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<p>');\n    },\n\n    // handle\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        // empty or end\n        if (this.isEmpty() || this.isCaretEnd()) {\n            var clone = this.app.block.create();\n\n            // clone paragraph styles\n            if (!this.opts.clean.enter) {\n                clone = this.duplicateEmpty();\n\n                // remove id attr\n                clone.getBlock().removeAttr('id');\n            }\n\n            if (!this.opts.clean.enterinline) {\n                // clone inline\n                var inline = this.app.selection.getInline();\n                if (inline) {\n                    var cloned;\n                    var inlines = this.app.element.getAllInlines(inline);\n                    for (var i = 0; i < inlines.length; i++) {\n                        if (inlines[i].tagName === 'A') {\n                            continue;\n                        }\n                        if (i === 0) {\n                            cloned = inlines[i].cloneNode();\n                            cloned.removeAttribute('id');\n                            cloned.innerHTML = '';\n                        }\n                        else {\n                            var clonedInline = inlines[i].cloneNode();\n                            clonedInline.removeAttribute('id');\n                            clonedInline.innerHTML = '';\n                            cloned.appendChild(clonedInline);\n                        }\n\n                    }\n\n                    if (cloned) {\n                        clone = this.app.block.create(cloned.outerHTML);\n                    }\n                }\n            }\n\n            // fix editor body height (paragraph margin)\n            if (clone.isEmpty()) {\n                clone.getBlock().html(this.app.utils.createInvisibleChar());\n            }\n\n            this.insert({ instance: clone, position: 'after', caret: 'start', remove: false });\n        }\n        // start\n        else if (this.isCaretStart()) {\n            this.insert({ instance: this.duplicateEmpty(), position: 'before' });\n        }\n        // middle\n        else {\n            var $block = this.getBlock();\n            var $part = this.app.element.split($block);\n            this.app.block.set($part, 'start');\n        }\n\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.text', {\n    mixins: ['block'],\n    type: 'text',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'format': { title: '## buttons.format ##', command: 'format.popup' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<div>').addClass(this.opts.text.classname);\n    },\n\n    // handle\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n        this.app.insertion.insertBreakline();\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.address', {\n    mixins: ['block'],\n    type: 'address',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'format': { title: '## buttons.format ##', command: 'format.popup' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<address>');\n    },\n\n    // handle\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        // empty or end  check address exit\n        if (this.isEmpty() || this.isCaretEnd()) {\n            var $block = this.getBlock();\n            var $nodes = $block.children();\n            var len = $nodes.length;\n            var $last = $nodes.eq(len-1);\n            var $lastPrev = $nodes.eq(len-2);\n            var html = $block.html().trim();\n            html = this.app.utils.removeInvisibleChars(html);\n\n            if (html.search(/<br\\s?\\/?>$/) !== -1) {\n\n                // remove empty\n                $lastPrev.remove();\n                $last.remove();\n\n                // insert\n                this.insertEmpty({ position: 'after', caret: 'start' });\n                return;\n            }\n        }\n\n        // insert br\n        this.app.insertion.insertBreakline();\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.cell', {\n    mixins: ['block'],\n    type: 'cell',\n    editable: true,\n    toolbar: {\n        'table': { title: '## blocks.table ##', command: 'table.add', observer: 'table.observe' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' },\n        'tune': { command: 'table.cellSetting', title: '## buttons.settings ##' }\n    },\n    create: function() {\n        return this.dom('<td>');\n    },\n    getNextCell: function() {\n        var cell = this.getNext();\n        if (!cell) {\n            var row = this.getParent('row');\n            if (row) {\n                var nextRow = row.getNextRow();\n                if (nextRow) {\n                    cell = nextRow.getChildFirst('cell');\n                }\n            }\n        }\n\n        return cell;\n    },\n    getPrevCell: function() {\n        var cell = this.getPrev();\n        if (!cell) {\n            var row = this.getParent('row');\n            if (row) {\n                var prevRow = row.getPrevRow();\n                if (prevRow) {\n                    cell = prevRow.getChildLast('cell');\n                }\n            }\n        }\n\n        return cell;\n    },\n    getWidth: function() {\n        var value = this.$block.attr('width');\n\n        return (value) ? value : '';\n    },\n    getNowrap: function() {\n        var value = this.$block.css('white-space');\n\n        return (value === 'nowrap');\n    },\n    setWidth: function(value) {\n        this._eachCell(function($cell) {\n            if (value === '') {\n                $cell.removeAttr('width');\n            }\n            else {\n                value = (value.search('%') !== -1) ? value : value.replace('px', '');\n                $cell.attr('width', value);\n            }\n        });\n    },\n    setNowrap: function(value) {\n        this._eachCell(function($cell) {\n            value = (value) ? 'nowrap' : '';\n            $cell.css('white-space', value);\n        });\n    },\n\n    // handle\n    handleArrow: function(e, key, event) {\n        var parentInstance;\n        if (event.is('up-left') && this.isCaretStart()) {\n            e.preventDefault();\n            var prev = this.getPrevCell();\n            if (prev) {\n                this.app.block.set(prev, 'end');\n            }\n            else {\n                parentInstance = this.getParent('table');\n                this.app.block.set(parentInstance);\n            }\n\n            return true;\n        }\n        else if (event.is('down-right') && this.isCaretEnd()) {\n            e.preventDefault();\n            var next = this.getNextCell();\n            if (next) {\n                this.app.block.set(next, 'start');\n            }\n            else {\n                parentInstance = this.getParent('table');\n                this.app.block.set(parentInstance);\n            }\n\n            return true;\n        }\n    },\n    handleTab: function(e, key, event) {\n        e.preventDefault();\n\n        var next = this.getNextCell();\n        if (next) {\n            this.app.block.set(next, 'start');\n        }\n        else {\n            var parentInstance = this.getParent('table');\n            this.app.block.set(parentInstance);\n        }\n\n        return true;\n    },\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n        this.app.insertion.insertBreakline();\n        return true;\n    },\n\n    // private\n    _eachCell: function(func) {\n        var index = 0;\n        var $table = this.$block.closest('table');\n\n        // index\n        this.$block.closest('tr').find('td, th').each(function($node, i) {\n            if ($node.get() === this.$block.get()) index = i;\n        }.bind(this));\n\n        $table.find('tr').each(function($node) {\n            var cell = $node.find('td, th').get(index);\n            var $cell = this.dom(cell);\n\n            func($cell);\n            //content.cacheBlocksStyle($cell);\n\n        }.bind(this));\n    }\n});\nArticleEditor.add('block', 'block.code', {\n    mixins: ['block'],\n    type: 'code',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom(this.opts.code.template);\n    },\n    build: function() {\n        this._buildCaption();\n        this._buildItems('figcaption', 'figcaption');\n    },\n\n    // handle\n    handleArrow: function(e, key, event) {\n        if (event.is('down-right') && this.isCaretEnd()) {\n            var next = this.getNext();\n            if (next) {\n                this.app.block.set(next, 'start');\n                return true;\n            }\n            else {\n                this.app.insertion.insertEmptyBlock({ position: 'after', caret: 'start' });\n                return true;\n            }\n        }\n    },\n    handleTab: function(e, key, event) {\n        e.preventDefault();\n        var num = this.opts.code.spaces;\n        var node = document.createTextNode(Array(num + 1).join(' '));\n        this.app.insertion.insertNode(node, 'end');\n        return true;\n    },\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        var last = this.$block.html().search(/\\n$/);\n\n\n        if (this.isCaretEnd() && last === -1) {\n            this.app.insertion.insertNewline('after', true);\n        }\n        else {\n            this.app.insertion.insertNewline();\n        }\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.column', {\n    mixins: ['block'],\n    type: 'column',\n    nested: true,\n    emptiable: true,\n    toolbar: {\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' }\n    },\n    create: function() {\n        return this.dom('<div>');\n    }\n});\nArticleEditor.add('block', 'block.dlist', {\n    mixins: ['block'],\n    type: 'dlist',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'format': { title: '## buttons.format ##', command: 'format.popup' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<dl>');\n    },\n    getPlainText: function(keepbr) {\n        var html = '';\n        var $items = this.$block.find('dt, dd');\n        var len = $items.length;\n\n        $items.each(function($node, i) {\n            var br = (keepbr) ? '<br>' : '';\n            if (i === len) br = '';\n\n            html += $node.html() + br;\n        });\n\n        return html;\n    },\n    setEmpty: function() {\n        this.$block.html('');\n\n        var $item = this.dom('<dt>');\n        this.$block.append($item);\n        this.app.caret.set($item, 'start');\n    },\n    isEmpty: function() {\n        var html = this.$block.html();\n        html = this._cleanEmpty(html);\n\n        var $items = this.$block.find('dt, dd');\n        if ($items.length === 0) {\n            html = html.trim();\n\n            return (html === '');\n        }\n        else if ($items.length === 1) {\n            html = $items.eq(0).html();\n            html = this._cleanEmpty(html);\n\n            return (html === '');\n        }\n\n        return false;\n\n    },\n\n    // handle\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        // empty or end\n        if (this.isEmpty() || this.isCaretEnd()) {\n            var currentItem = this.app.selection.getBlock();\n            var $currentItem = this.dom(currentItem);\n            var tag = currentItem.tagName.toLowerCase();\n            var isItemEmpty = this.app.content.isEmptyHtml(currentItem.innerHTML);\n\n            if (tag === 'dt' && isItemEmpty) {\n                // remove empty\n                $currentItem.remove();\n\n                // insert\n                this.insertEmpty({ position: 'after', caret: 'start' });\n                return true;\n            }\n\n            // insert dt or dd\n            var $newItem;\n            if (tag === 'dt') {\n                $newItem = this.dom('<dd>');\n            }\n            else {\n                $newItem = this.dom('<dt>');\n            }\n\n            this.dom(currentItem).after($newItem);\n            this.app.caret.set($newItem, 'start');\n        }\n        // start\n        else if (this.isCaretStart()) {\n            return true;\n        }\n        // middle\n        else {\n            this.app.insertion.insertBreakline();\n        }\n\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.embed', {\n    mixins: ['block'],\n    type: 'embed',\n    parser: {\n        unparse: function($node) {\n            var code = decodeURI($node.attr('data-embed-code'));\n            var classes = this.opts.embed.responsive.split(' ').join('.');\n            var $responsive = $node.find('.' + classes);\n            var $el = $node.find('figcaption');\n            var $figcaption;\n            if ($el.length !== 0) {\n                $figcaption = $el.clone();\n                $el.remove();\n            }\n\n            if ($responsive.length === 0) {\n                $node.html(code);\n            }\n            else {\n                $responsive.html(code);\n            }\n\n            if ($figcaption) {\n                $node.append($figcaption);\n            }\n\n            $node.removeAttr('data-embed-code data-arx-type');\n            if ($node.get().attributes.length === 0 && $node.find('figcaption').length === 0 && $node.find('div').length === 0) {\n                $node.unwrap();\n            }\n        }\n    },\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'outset': { title: '## buttons.outset ##', command: 'block.popup', observer: 'block.observe' },\n        'embed': { title: '## blocks.embed ##', command: 'embed.popup', observer: 'embed.observe' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<figure>');\n    },\n    build: function() {\n        this._buildCaption();\n        this._buildItems('figcaption', 'figcaption');\n        this._buildEmbedCode();\n    },\n    addResponsive: function() {\n        var $responsive = this.dom('<div>').addClass(this.opts.embed.responsive);\n        var $figcaption = this.$block.find('figcaption');\n\n        var $cloneFigcaption = $figcaption.clone();\n        var html = this.getEmbedCode();\n        $figcaption.remove();\n\n        $responsive.html(html);\n        this.$block.html('').append($responsive);\n\n        if ($cloneFigcaption.length !== 0) {\n            this.app.create('block.figcaption', $cloneFigcaption);\n            this.$block.append($cloneFigcaption);\n        }\n\n        this._buildEmbedCode();\n    },\n    removeResponsive: function() {\n        this.$block.find(this._getEmbedClass()).unwrap();\n    },\n    getEmbedCode: function() {\n        return decodeURI(this.$block.attr('data-embed-code'));\n    },\n    isResponsive: function() {\n        return (this.$block.find(this._getEmbedClass()).length !== 0);\n    },\n\n    // private\n    _buildEmbedCode: function() {\n        var $clone = this.$block.clone();\n        $clone.find(this._getEmbedClass()).unwrap();\n        $clone.find('figcaption').remove();\n\n        var code = $clone.html().trim();\n        this.$block.attr('data-embed-code', encodeURI(code));\n    },\n    _getEmbedClass: function() {\n        return '.' + this.opts.embed.responsive.replace(/ +/g, '.');\n    }\n});\nArticleEditor.add('block', 'block.figcaption', {\n    mixins: ['block'],\n    type: 'figcaption',\n    editable: true,\n    toolbar: {\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    create: function() {\n        return this.dom('<figcaption>');\n    },\n    getFigure: function() {\n        return this.$block.closest('figure').dataget('instance');\n    },\n\n    // handle\n    handleArrow: function(e, key, event) {\n        if ((event.is('up-left') && this.isCaretStart()) || (event.is('down-right') && this.isCaretEnd())) {\n            e.preventDefault();\n            var parentInstance = this.getFigure();\n            this.app.block.set(parentInstance);\n            return true;\n        }\n    },\n    handleTab: function(e, key, event) {\n        e.preventDefault();\n        var parentInstance = this.getFigure();\n        this.app.block.set(parentInstance);\n        return true;\n    },\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        // empty or end\n        if (this.isEmpty() || this.isCaretEnd() || this.isCaretStart()) {\n            return true;\n        }\n        // middle\n        else {\n            this.app.insertion.insertBreakline();\n        }\n\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.grid', {\n    mixins: ['block'],\n    type: 'grid',\n    nested: true,\n    parser: {\n        unparse: function($node) {\n            $node.removeClass(this.prefix + '-grid-overlay');\n        }\n    },\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'valign': { title: '## buttons.valign ##', command: 'block.popup', observer: 'block.observe' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        var $block = this.dom('<div>').addClass(this.opts.grid.classname);\n        if (this.opts.grid.classes !== '') {\n            $block.addClass(this.opts.grid.classes);\n        }\n\n        return $block;\n    },\n    build: function() {\n        this._buildOverlay();\n    },\n\n    // privae\n    _buildOverlay: function() {\n        if (this.opts.grid && this.opts.grid.overlay) {\n            this.$block.addClass(this.prefix + '-grid-overlay');\n        }\n    }\n});\nArticleEditor.add('block', 'block.heading', {\n    mixins: ['block'],\n    type: 'heading',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'format': { title: '## buttons.format ##', command: 'format.popup' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<h2>');\n    },\n    getTitle: function() {\n        var titles = this.lang.get('headings');\n        var tag = this.getTag();\n        var title = this.$block.attr('data-title');\n\n        return (typeof titles[tag] !== 'undefined') ? titles[tag] : title;\n    },\n\n    // handle\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        // empty or end\n        if (this.isEmpty() || this.isCaretEnd()) {\n            this.insertEmpty({ position: 'after', caret: 'start', remove: false });\n        }\n        // start\n        else if (this.isCaretStart()) {\n            this.insert({ instance: this.duplicateEmpty(), position: 'before' });\n        }\n        // middle\n        else {\n            var $block = this.getBlock();\n            var $part = this.app.element.split($block);\n            this.app.block.set($part, 'start');\n        }\n\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.image', {\n    mixins: ['block'],\n    type: 'image',\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'outset': { title: '## buttons.outset ##', command: 'block.popup', observer: 'block.observe' },\n        'image': { title: '## blocks.image ##', command: 'image.popup', observer: 'image.observe' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<' + this.opts.image.tag + '>');\n    },\n    build: function() {\n        this._buildCaption();\n        this._buildItems('figcaption', 'figcaption');\n\n        this.data = {\n            'alt': { getter: 'getAlt', setter: 'setAlt' },\n            'width': { getter: 'getWidth', setter: 'setWidth' },\n            'link': { getter: 'getLinkUrl', setter: 'setLinkUrl' },\n            'target': { getter: 'getTarget', setter: 'setTarget' },\n            'caption': { getter: 'getCaption', setter: 'setCaption' },\n        };\n    },\n    getImage: function() {\n        return this.$block.find('img').eq(0);\n    },\n    getSrc: function() {\n        var $img = this.getImage();\n\n        return $img.attr('src');\n    },\n    getId: function() {\n        var $img = this.getImage();\n\n        return $img.attr('data-image');\n    },\n    getLink: function() {\n        var $link = this.getImage().parent();\n        $link = ($link.get().tagName !== 'A') ? false : $link;\n\n        return $link;\n    },\n    getWidth: function() {\n        var $img = this.getImage();\n        var width = $img.css('width');\n        var value = $img.attr('width');\n        if (value && value.search(/%/) !== -1) {\n            width = value;\n        }\n        return width;\n    },\n    getAlt: function() {\n        var $img = this.getImage();\n        var alt = $img.attr('alt');\n\n        return (alt) ? alt : '';\n    },\n    getLinkUrl: function() {\n        var $link = this.getLink();\n        return ($link) ? $link.attr('href') : '';\n    },\n    getTarget: function() {\n        var $link = this.getLink();\n        return ($link) ? $link.attr('target') : this.opts.image.newtab;\n    },\n    setWidth: function(value) {\n        var $img = this.getImage();\n        value = value.trim();\n\n        if (value === '') {\n            $img.removeAttr('width');\n        }\n        else {\n            var percent = (value.search(/%/) !== -1);\n            var width = (percent) ? value : parseInt(value);\n            var ratio = $img.width() / $img.height();\n\n            if (percent) {\n                $img.removeAttr('height');\n                $img.attr({ 'width': width });\n            }\n            else {\n                var height = Math.round(width / ratio);\n                $img.attr({ 'width': width, 'height': height });\n            }\n        }\n\n        $img.css({ 'width': value, 'max-width': value });\n\n        // broadcast\n        this.app.broadcast('image.width', { image: $img, width: value });\n    },\n    setAlt: function(value) {\n        var $img = this.getImage();\n\n        value = value.replace(/\"/g, \"'\");\n        $img.attr('alt', value);\n    },\n    setTarget: function(value) {\n        var $link = this.getLink();\n        if (!$link) return;\n\n        if (value) $link.attr('target', '_blank');\n        else $link.removeAttr('target');\n    },\n    setLinkUrl: function(value) {\n        var $link = this.getLink();\n\n        if ($link) {\n            if (value !== '') {\n                $link.attr('href', value);\n            }\n            else {\n                this.removeLink();\n\n                // broadcast\n                this.app.broadcast('image.unlink', { instance: this });\n                return;\n            }\n        }\n        else if (!$link) {\n            if (value !== '') {\n                var $img = this.getImage();\n                $link = this.dom('<a>');\n                $img.wrap($link);\n                $link.attr('href', value);\n            }\n            else {\n                return;\n            }\n        }\n\n        // broadcast\n        this.app.broadcast('image.link', { instance: this, link: $link });\n    },\n    setImage: function(data) {\n        var $img = this.getImage();\n        $img.attr('src', data.url);\n\n        if (Object.prototype.hasOwnProperty.call(data, 'id')) $img.attr('data-image', data.id);\n        if (Object.prototype.hasOwnProperty.call(data, '2x')) $img.attr('srcset', data['2x'] + ' 2x');\n\n        $img.one('load', this.app.editor.adjustHeight.bind(this.app.editor));\n    },\n    removeLink: function() {\n        var $link = this.getLink();\n        if ($link) {\n            $link.unwrap();\n        }\n    }\n});\nArticleEditor.add('block', 'block.layer', {\n    mixins: ['block'],\n    type: 'layer',\n    nested: true,\n    emptiable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom(this.opts.layer.template);\n    },\n    getTitle: function() {\n        var title = this.$block.attr('data-title');\n        return title || this._getNameByTag();\n    }\n});\nArticleEditor.add('block', 'block.line', {\n    mixins: ['block'],\n    type: 'line',\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<hr>');\n    }\n});\nArticleEditor.add('block', 'block.list', {\n    mixins: ['block'],\n    type: 'list',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'format': { title: '## buttons.format ##', command: 'format.popup' },\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'outdent': { title: '## buttons.outdent ##', command: 'list.outdent' },\n        'indent': { title: '## buttons.indent ##', command: 'list.indent' },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<ul>');\n    },\n    unparse: function($el) {\n        this.app.content.unfixListMargin($el);\n    },\n    setEmpty: function() {\n        this.$block.html('');\n\n        var $item = this.dom('<li>');\n        this.$block.append($item);\n        this.app.caret.set($item, 'start');\n    },\n    isEmpty: function() {\n        var html = this.$block.html();\n        html = this._cleanEmpty(html);\n\n        var $items = this.$block.find('li');\n        if ($items.length === 0) {\n            html = html.trim();\n\n            return (html === '');\n        }\n        else if ($items.length === 1) {\n            html = $items.eq(0).html();\n            html = this._cleanEmpty(html);\n\n            return (html === '');\n        }\n\n        return false;\n\n    },\n\n    // handle\n    handleTab: function(e, key, event) {\n        var currentItem = this.app.selection.getBlock();\n        var isItemStart = this.app.caret.is(currentItem, 'start');\n\n        if (this.isCaretStart() || this.isCaretEnd()) {\n            var next = this.getNext();\n            if (next) {\n                e.preventDefault();\n                this.app.block.set(next, 'start');\n                return true;\n            }\n        }\n        else {\n\n            if (this.opts.tab.spaces && !isItemStart) {\n                return;\n            }\n\n            e.preventDefault();\n            this.app.list.indent();\n            return true;\n        }\n    },\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n        var $newItem, $currentItem, currentItem, isItemEmpty;\n\n        // empty or end\n        if (this.isEmpty() || this.isCaretEnd()) {\n\n            currentItem = this.app.selection.getBlock();\n            $currentItem = this.dom(currentItem);\n            isItemEmpty = this.app.content.isEmptyHtml(currentItem.innerHTML);\n\n            // list exit\n            if (isItemEmpty) {\n                // remove empty\n                $currentItem.remove();\n\n                // insert\n                this.insertEmpty({ position: 'after', caret: 'start' });\n                return true;\n            }\n\n            // insert li\n            $newItem = this.dom('<li>');\n\n            this.app.element.cloneAttrs(currentItem, $newItem);\n            this.dom(currentItem).after($newItem);\n            this.app.caret.set($newItem, 'start');\n        }\n        // start\n        else if (this.isCaretStart()) {\n            $newItem = this.dom('<li>');\n            currentItem = this.app.selection.getBlock();\n\n            this.app.element.cloneAttrs(currentItem, $newItem);\n            this.dom(currentItem).before($newItem);\n        }\n        // middle\n        else {\n            currentItem = this.app.selection.getBlock();\n            $currentItem = this.dom(currentItem);\n            isItemEmpty = this.app.content.isEmptyHtml(currentItem.innerHTML);\n\n            var isItemStart = this.app.caret.is(currentItem, 'start');\n            var isItemEnd = this.app.caret.is(currentItem, 'end', ['ul', 'ol']);\n\n            $newItem = this.dom('<li>');\n            this.app.element.cloneAttrs(currentItem, $newItem);\n\n            // empty\n            if (isItemEmpty) {\n                $currentItem.after($newItem);\n                this.app.caret.set($newItem, 'start');\n            }\n            // start\n            else if (isItemStart) {\n                $currentItem.before($newItem);\n            }\n            // end\n            else if (isItemEnd) {\n                var $listInside = $currentItem.find('ul, ol').first();\n                if ($listInside.length !== 0) {\n                    $newItem.append(this.app.utils.createInvisibleChar());\n                    $newItem.append($listInside);\n                    $currentItem.after($newItem);\n                }\n                else {\n                    $currentItem.after($newItem);\n                }\n\n                this.app.caret.set($newItem, 'start');\n            }\n            // middle\n            else {\n                var $part = this.app.element.split(currentItem);\n                $newItem = $part;\n                this.app.caret.set($part, 'start');\n            }\n        }\n\n        // event\n        this.app.broadcast('list.item', { element: $newItem });\n\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.noneditable', {\n    mixins: ['block'],\n    type: 'noneditable',\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom('<div>').addClass(this.opts.noneditable.classname);\n    }\n});\nArticleEditor.add('block', 'block.quote', {\n    mixins: ['block'],\n    type: 'quote',\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom(this.opts.quote.template);\n    },\n    build: function() {\n        this._buildCaption();\n        this._buildItems('p', 'quoteitem');\n        this._buildItems('figcaption', 'figcaption');\n    }\n});\nArticleEditor.add('block', 'block.quoteitem', {\n    mixins: ['block'],\n    type: 'quoteitem',\n    editable: true,\n    toolbar: {\n        'alignment': { title: '## buttons.align ##', command: 'block.popup', observer: 'block.observe' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' }\n    },\n    create: function() {\n        return this.dom('<p>');\n    },\n    getBlockquote: function() {\n        return this.$block.closest('blockquote');\n    },\n\n    // handle\n    handleArrow: function(e, key, event) {\n        var $blockquote = this.getBlockquote();\n        if ($blockquote.length === 0) return;\n\n        var isStart = this.app.caret.is($blockquote, 'start');\n        var isEnd = this.app.caret.is($blockquote, 'end');\n\n        if ((event.is('up-left') && isStart) || (event.is('down-right') && isEnd)) {\n            e.preventDefault();\n            var parentInstance = this.getParent('quote');\n            this.app.block.set(parentInstance);\n            return true;\n        }\n    },\n    handleTab: function(e, key, event) {\n        e.preventDefault();\n        var next = this.getNext();\n        if (next) {\n            this.app.block.set(next, 'start');\n            return true;\n        }\n        else {\n            var quote = this.getParent('quote');\n            this.app.block.set(quote);\n            return true;\n        }\n    },\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n\n        // prepare new instance\n        var newInstance = this.app.create('block.quoteitem');\n\n        // empty or end\n        if (this.isEmpty() || this.isCaretEnd()) {\n            this.insert({ instance: newInstance, position: 'after', caret: 'start' });\n        }\n        // start\n        else if (this.isCaretStart()) {\n            this.insert({ instance: newInstance, position: 'before' });\n        }\n        // middle\n        else {\n            var $block = this.getBlock();\n            var $part = this.app.element.split($block);\n            this.app.block.set($part, 'start');\n        }\n\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.row', {\n    mixins: ['block'],\n    type: 'row',\n    toolbar: {\n        'table': { title: '## blocks.table ##', command: 'table.add', observer: 'table.observe' }\n    },\n    create: function() {\n        return this.dom('<tr>');\n    },\n    getNextRow: function() {\n        var row = this.getNext();\n        var $parent = this.$block.parent();\n        if (!row && $parent.get().tagName !== 'TABLE') {\n            row = $parent.nextElement().find('tr').first().dataget('instance');\n        }\n\n        return row;\n    },\n    getPrevRow: function() {\n        var row = this.getPrev();\n        var $parent = this.$block.parent();\n        if (!row && $parent.get().tagName !== 'TABLE') {\n            row = $parent.prevElement().find('tr').last().dataget('instance');\n        }\n\n        return row;\n    },\n\n    // handle\n    handleDelete: function(e, key, event) {\n        e.preventDefault();\n        return true;\n    },\n    handleArrow: function(e, key, event) {\n        e.preventDefault();\n\n        if (event.is('up-left')) {\n            var parentInstance = this.getParent('table');\n            this.app.block.set(parentInstance);\n        }\n        else {\n            var cellInstance = this.getChildFirst('cell');\n            this.app.block.set(cellInstance, 'start');\n        }\n\n        return true;\n    },\n    handleTab: function(e, key, event) {\n        e.preventDefault();\n\n        var next = this.getNextRow();\n        if (next) {\n            this.app.block.set(next);\n        }\n        else {\n            var parentInstance = this.getParent('table');\n            this.app.block.set(parentInstance);\n        }\n\n        return true;\n    },\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n        return true;\n    }\n});\nArticleEditor.add('block', 'block.table', {\n    mixins: ['block'],\n    type: 'table',\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'table': { title: '## blocks.table ##', command: 'table.add', observer: 'table.observe' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom(this.opts.table.template);\n    },\n    build: function() {\n        this._buildItems('tr', 'row');\n        this._buildItems('td, th', 'cell');\n    },\n    getFirstCell: function() {\n        var $cell = this.$block.find('th, td').first();\n        if ($cell.length !== 0) {\n            return $cell.dataget('instance');\n        }\n    }\n});\nArticleEditor.add('block', 'block.variable', {\n    mixins: ['block'],\n    type: 'variable',\n    editable: false,\n    inline: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    create: function() {\n        return this.dom('<span>').addClass(this.opts.variable.classname);\n    },\n    build: function() {\n        this.$block.addClass(this.opts.variable.classname);\n    }\n});\nArticleEditor.add('block', 'block.form', {\n    mixins: ['block'],\n    type: 'form',\n    create: function() {\n        return this.dom('<form>');\n    },\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' }\n    },\n    control: {\n        trash: { command: 'block.remove', title: '## buttons.delete ##' },\n        duplicate: { command: 'block.duplicate', title: '## buttons.duplicate ##'  }\n    }\n});\nArticleEditor.add('block', 'block.card', {\n    mixins: ['block'],\n    type: 'card',\n    editable: true,\n    toolbar: {\n        'add': { title: '## buttons.add ##', command: 'addbar.popup' },\n        'bold': { title: '## buttons.bold ##', command: 'inline.set', params: { tag: 'b' } },\n        'italic': { title: '## buttons.italic ##', command: 'inline.set', params: { tag: 'i' } },\n        'deleted': { title: '## buttons.deleted ##', command: 'inline.set', params: { tag: 'del' } },\n        'link': { title: '## buttons.link ##', command: 'link.popup' },\n        'image': { title: '## buttons.settings ##', command: 'image.editCard', observer: 'block.observeCard' }\n    },\n    control: {\n        'trash': { title: '## buttons.delete ##', command: 'block.remove' },\n        'duplicate': { title: '## buttons.duplicate ##', command: 'block.duplicate' }\n    },\n    create: function() {\n        return this.dom(this.opts.card.template);\n    },\n    build: function() {\n        this.data = {\n            'alt': { getter: 'getAlt', setter: 'setAlt' }\n        };\n    },\n    hasImage: function() {\n        return (this.$block.find('img').length !== 0);\n    },\n    getImage: function() {\n        return this.$block.find('img').eq(0);\n    },\n    getAlt: function() {\n        var $img = this.getImage();\n        var alt = $img.attr('alt');\n\n        return (alt) ? alt : '';\n    },\n    setAlt: function(value) {\n        var $img = this.getImage();\n        $img.attr('alt', value);\n    },\n    setImage: function(data) {\n        var $img = this.getImage();\n        $img.attr('src', data.url);\n        if (Object.prototype.hasOwnProperty.call(data, 'id')) {\n            $img.attr('data-image', data.id);\n        }\n\n        $img.one('load', this.app.editor.adjustHeight.bind(this.app.editor));\n    },\n\n    // handle\n    handleEnter: function(e, key, event) {\n        e.preventDefault();\n        this.app.insertion.insertBreakline();\n        return true;\n    }\n});\n\n    window.ArticleEditor = ArticleEditor;\n\n    // Data attribute load\n    window.addEventListener('load', function() {\n        ArticleEditor('[data-article-editor]');\n    });\n\n    // Export for webpack\n    if (typeof module === 'object' && module.exports) {\n        module.exports = ArticleEditor;\n        module.exports.ArticleEditor = ArticleEditor;\n    }\n}());","ArticleEditor.add('plugin', 'blockcode', {\n    translations: {\n        en: {\n            \"blockcode\": {\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\",\n                \"edit-code\": \"Edit Code\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10.6128994 3.20970461.0942074.08318861 4 4c.3604839.36048396.3882135.92771502.0831886 1.32000622l-.0831886.09420734-4 4.00000002c-.3905243.3905243-1.02368929.3905243-1.41421358 0-.36048396-.360484-.3882135-.927715-.08318861-1.3200062l.08318861-.0942074 3.29210678-3.2928932-3.29210678-3.29289322c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734c.36048396-.36048396.92771498-.3882135 1.32000618-.08318861zm-3.90579262.08318861c.36048396.36048396.3882135.92771502.08318861 1.32000622l-.08318861.09420734-3.29210678 3.29289322 3.29210678 3.2928932c.36048396.360484.3882135.927715.08318861 1.3200062l-.08318861.0942074c-.36048396.3604839-.92771502.3882135-1.32000622.0831886l-.09420734-.0831886-4-4.00000002c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734 4-4c.39052429-.39052429 1.02368927-.39052429 1.41421356 0z\"/></svg>',\n        popup: {\n            width: '100%',\n            title: '## blockcode.edit-code ##',\n            form: {\n                'code': { type: 'textarea', rows: '8' }\n            },\n            footer: {\n                save: { title: '## blockcode.save ##', command: 'blockcode.save', type: 'primary' },\n                cancel: { title: '## blockcode.cancel ##', close: true }\n            }\n        }\n    },\n    init: function() {\n        this.offset = false;\n    },\n    start: function() {\n        this.app.control.add('blockcode', {\n            icon: this.opts.blockcode.icon,\n            command: 'blockcode.edit',\n            title: '## blockcode.edit-code ##',\n            blocks: {\n                all: true,\n                except: ['variable']\n            }\n        });\n    },\n    edit: function() {\n        var current = this.app.block.get();\n        var code = current.getOuterHtml();\n        code = this.app.parser.unparse(code);\n\n        if (current.isEditable()) {\n            this.offset = this.app.offset.get(current.getBlock());\n        }\n\n        // create\n        var stack = this.app.popup.create('code', this.opts.blockcode.popup);\n        stack.setData({ code: code });\n\n        // open\n        this.app.popup.open({ focus: 'code' });\n\n        // hadnle & codemirror\n        this._buildInputHandle(stack);\n        this._buildCodemirror(stack);\n    },\n    save: function(stack) {\n        this.app.popup.close();\n\n        var current = this.app.block.get();\n        var code = this._getCode(stack);\n        if (code === '') {\n            return;\n        }\n\n        // create\n        code = this.app.parser.parse(code, false);\n        var $source = this.dom(code);\n        var instance = this.app.create('block.' + current.getType(), $source);\n\n        // change\n        this.app.block.change(instance);\n\n        // set editable focus\n        if (this.offset && instance.isEditable()) {\n            this.app.offset.set(instance.getBlock(), this.offset);\n        }\n\n        // clear offset\n        this.offset = false;\n    },\n\n    // private\n    _getCode: function(stack) {\n        var data = stack.getData();\n        var code = data.code.trim();\n        code = this.app.codemirror.val(code);\n\n        return code;\n    },\n    _buildInputHandle: function(stack) {\n        var $input = stack.getInput('code');\n        $input.on('keydown', this.app.input.handleTextareaTab.bind(this));\n    },\n    _buildCodemirror: function(stack) {\n        var $input = stack.getInput('code');\n\n        this.app.codemirror.create({ el: $input, height: '200px', focus: true });\n        this.app.popup.updatePosition();\n    },\n});","ArticleEditor.add('plugin', 'buttonlink', {\n    translations: {\n        en: {\n            \"buttonlink\": {\n                \"button\": \"Button\"\n            }\n        }\n    },\n    defaults: {\n        classname: false\n    },\n    subscribe: {\n        'popup.before.open': function() {\n            if (this.opts.buttonlink.classname === false) return;\n\n            var stack = this.app.popup.getStack();\n            var name = stack.getName();\n\n            if (name === 'link') {\n                this._build(stack);\n            }\n        }\n    },\n    make: function() {\n        this.app.popup.close();\n\n        var $link = this.app.link.getLink();\n        $link.addClass(this.opts.buttonlink.classname);\n\n    },\n    unmake: function() {\n        this.app.popup.close();\n\n        var $link = this.app.link.getLink();\n        $link.removeClass(this.opts.buttonlink.classname);\n    },\n\n    // private\n    _build: function(stack) {\n        var $link = this.app.link.getLink();\n\n        if ($link.length === 0) return;\n\n        var items = stack.getItemsData();\n        var item = { title: '## buttonlink.button ##', command: 'buttonlink.make' };\n        var index = this.app.utils.getObjectIndex(items, 'unlink');\n\n        if (this._hasClass($link)) {\n            item = { title: '## buttonlink.button ##', command: 'buttonlink.unmake', active: true };\n        }\n\n        items = this.app.utils.insertToObject('buttonlink', item, items, index);\n        stack.setItemsData(items);\n    },\n    _hasClass: function($link) {\n        var arr = this.opts.buttonlink.classname.split(' ');\n        var count = 0;\n        for (var i = 0; i < arr.length; i++) {\n            if ($link.hasClass(arr[i])) count++;\n        }\n\n        return (count === arr.length);\n    }\n});","ArticleEditor.add('plugin', 'carousel', {\n    translations: {\n        en: {\n             \"carousel\": {\n                 \"carousel\": \"Carousel\",\n                 \"save\": \"Save\",\n                 \"cancel\": \"Cancel\",\n                 \"insert\": \"Insert\"\n             }\n        }\n    },\n    defaults: {\n        upload: false,\n        select: false,\n        name: 'file',\n        data: false,\n        multiple: true\n    },\n    popups: {\n        add: {\n            title: '## carousel.carousel ##',\n            width: '100%',\n            footer: {\n                insert: { title: '## carousel.insert ##', command: 'carousel.insert', type: 'primary' },\n                cancel: { title: '## carousel.cancel ##', command: 'popup.close' }\n            }\n        },\n        edit: {\n            title: '## carousel.carousel ##',\n            width: '100%',\n            footer: {\n                save: { title: '## carousel.save ##', command: 'carousel.save', type: 'primary' },\n                cancel: { title: '## carousel.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    start: function() {\n        this.app.addbar.add('carousel', {\n            title: '## carousel.carousel ##',\n            icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z\"/></svg>',\n            command: 'carousel.popup'\n        });\n    },\n    popup: function() {\n        // create\n        var stack = this.app.popup.add('slideshow', this.popups.add);\n\n        // body\n        var $body = stack.getBody();\n\n        // box\n        this.$box = this.dom('<div>').addClass(this.prefix + '-slideshow-items');\n        $body.append(this.$box);\n\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.carousel.upload, $body);\n\n        // select box\n        this.app.image.createSelectBox(this.opts.carousel.select, $body, 'carousel.insertFromSelect');\n\n        // open\n        stack.open();\n\n        // build upload\n        this._buildUpload(this.$upload, 'carousel.insertByUpload');\n    },\n    edit: function(params, button) {\n        // create\n        var stack = this.app.popup.create('slideshow', this.popups.edit);\n\n        // body\n        var $body = stack.getBody();\n\n        // data\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        var $elms = $block.find('img');\n\n        // box\n        this.$box = this.dom('<div>').addClass(this.prefix + '-slideshow-items');\n        $body.append(this.$box);\n\n        // items\n        $elms.each(function($node) {\n            this._buildBoxItem($node.attr('src'));\n        }.bind(this));\n\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.carousel.upload, $body);\n\n        // select box\n        this.app.image.createSelectBox(this.opts.carousel.select, $body, 'carousel.insertFromSelect');\n\n        // open\n        this.app.popup.open({ button: button });\n\n        // build upload\n        this._buildUpload(this.$upload, 'carousel.insertByUpload');\n    },\n    insertByUpload: function(response) {\n        for (var key in response) {\n            this._buildBoxItem(response[key].url);\n        }\n    },\n    insertFromSelect: function(e) {\n        e.preventDefault();\n\n        var $target = this.dom(e.target);\n        this._buildBoxItem($target.attr('data-url'));\n    },\n    insert: function() {\n        // instance\n        var instance = this.app.create('block.bs-carousel');\n        this.app.block.add({ instance: instance });\n\n        // save\n        this.save();\n    },\n    save: function() {\n        var current = this.app.block.get();\n        var $elms = this.$box.find('img');\n\n        if ($elms.length === 0) {\n            current.remove();\n            this.app.popup.close();\n            return;\n        }\n\n        var $block = current.getBlock();\n        var $inner = $block.find('.carousel-inner');\n\n        // indicators\n        var $indicators = $block.find('.carousel-indicators');\n        var blockId = current.getId();\n\n        // clear\n        $indicators.html('');\n        $inner.html('');\n\n        $elms.each(function($node, i) {\n            var src = $node.attr('src');\n\n            var $item = this.dom('<div>').addClass('carousel-item');\n            var $img = this.dom('<img>').addClass('d-block w-100').attr('src', src);\n            var $indicator = this.dom('<li>').attr({ 'data-slide-to': i, 'data-target': '#' + blockId });\n\n            $item.append($img);\n            $inner.append($item);\n            $indicators.append($indicator);\n\n\n        }.bind(this));\n\n        $inner.find('.carousel-item').first().addClass('active');\n        $indicators.find('li').first().addClass('active');\n\n        // close popup\n        this.app.popup.close();\n    },\n\n    // private\n    _removeItem: function(e) {\n        var $target = this.dom(e.target).closest('.' + this.prefix + '-slideshow-item');\n        $target.fadeOut(function($node) {\n            $node.remove();\n        }.bind(this));\n    },\n    _buildBoxItem: function(src) {\n        var $item = this.dom('<span>').addClass(this.prefix + '-slideshow-item');\n        var $remover = this.dom('<span>').addClass(this.prefix + '-upload-remove');\n        var $img = this.dom('<img>').attr('src', src);\n\n        $remover.one('click', this._removeItem.bind(this));\n\n        $item.append($img);\n        $item.append($remover);\n        this.$box.append($item);\n    },\n    _buildUpload: function($item, callback) {\n        if (!this.opts.carousel.upload) return;\n\n        var params = {\n            box: true,\n            placeholder: this.lang.get('image.upload-new-placeholder'),\n            url: this.opts.carousel.upload,\n            name: this.opts.carousel.name,\n            data: this.opts.carousel.data,\n            multiple: this.opts.carousel.multiple,\n            success: callback,\n            error: 'image.error'\n        };\n\n        this.app.create('upload', $item, params);\n    }\n});","ArticleEditor.add('plugin', 'clips', {\n    translations: {\n        en: {\n            \"clips\": {\n                \"clips\": \"Clips\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12.1666667 1c1.0193924 0 1.8333333.83777495 1.8333333 1.85714286v10.28571424c0 1.0193679-.8139409 1.8571429-1.8333333 1.8571429h-8.33333337c-1.01868744 0-1.83333333-.8379215-1.83333333-1.8571429v-10.28571424c0-1.01922137.81464589-1.85714286 1.83333333-1.85714286zm-.1666667 2h-8v10h8zm-2 7c.5522847 0 1 .4477153 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-4c-.55228475 0-1-.4477153-1-1 0-.5128358.38604019-.9355072.88337887-.9932723l.11662113-.0067277zm0-3c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773zm0-3c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/></svg>',\n        items: false\n    },\n    start: function() {\n        if (!this.opts.clips.items) return;\n\n        this.app.toolbar.add('clips', {\n            title: '## clips.clips ##',\n            icon: this.opts.clips.icon,\n            command: 'clips.popup',\n            blocks: {\n                all: 'editable'\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        for (var key in this.opts.clips.items) {\n\n            items[key] = {\n                title: this.opts.clips.items[key].title,\n                command: 'clips.insert'\n            }\n        }\n\n        this.app.popup.create('clips', { items: items });\n        this.app.popup.open({ button: button });\n    },\n    insert: function(params, item, name) {\n        this.app.popup.close();\n\n        var html = this.opts.clips.items[name].html;\n        this.app.editor.insertContent({ html: html });\n    }\n});","ArticleEditor.add('plugin', 'counter', {\n    translations: {\n        en: {\n            \"counter\": {\n                \"words\": \"words\",\n                \"chars\": \"chars\"\n            }\n        }\n    },\n    subscribe: {\n        'editor.change': function() {\n            this._count();\n        }\n    },\n    start: function() {\n        this._count();\n    },\n\n    // private\n    _count: function() {\n        var words = 0, characters = 0, spaces = 0;\n        var html = this.app.$element.val();\n\n        html = this._clean(html)\n        if (html !== '') {\n            var arrWords = html.split(/\\s+/);\n            var arrSpaces = html.match(/\\s/g);\n\n            words = (arrWords) ? arrWords.length : 0;\n            spaces = (arrSpaces) ? arrSpaces.length : 0;\n\n            characters = html.replace(/\\s+/g, ' ').length;\n        }\n\n        var data = { words: words, characters: characters, spaces: spaces };\n\n        // broadcast\n        this.app.broadcast('counter.count', data);\n\n        // statusbar\n        this.app.statusbar.add('words', this.lang.get('counter.words') + ': ' + data.words);\n        this.app.statusbar.add('chars', this.lang.get('counter.chars') + ': ' + data.characters);\n    },\n    _clean: function(html) {\n        html = html.replace(/<\\/(.*?)>/gi, ' ');\n        html = html.replace(/<(.*?)>/gi, '');\n        html = html.replace(/\\t/gi, '');\n        html = html.replace(/\\n|\\r/gi, ' ');\n        html = html.replace(/&nbsp;/g, '1');\n        html = html.trim();\n        html = this.app.utils.removeInvisibleChars(html);\n\n        return html;\n    }\n});","ArticleEditor.add('plugin', 'definedlinks', {\n    defaults: {\n        items: false\n    },\n    subscribe: {\n        'popup.open': function() {\n            if (this.opts.definedlinks.items === false) return;\n\n            var stack = this.app.popup.getStack();\n            var name = stack.getName();\n            var names = ['link-create', 'link-edit'];\n\n            if (names.indexOf(name) !== -1) {\n                this._build(stack);\n            }\n        }\n    },\n\n    // private\n    _build: function(stack) {\n        this.stack = stack;\n\n        var $item = stack.getFormItem('text');\n        var $box = this.dom('<div>').addClass(this.prefix + '-form-item');\n\n        // select\n        this.$select = this._create();\n\n        $box.append(this.$select);\n        $item.before($box);\n    },\n    _change: function(e) {\n        var key = this.dom(e.target).val();\n        var data = this.opts.definedlinks.items[key];\n        var $text = this.stack.getInput('text');\n        var $url = this.stack.getInput('url');\n        var name = data.name;\n        var url = data.url;\n\n        if (data.url === false) {\n            url = '';\n            name = '';\n        }\n\n        $text.val(name);\n        $url.val(url);\n    },\n    _create: function() {\n        var items = this.opts.definedlinks.items;\n        var $select = this.dom('<select>').addClass(this.prefix + '-form-select');\n        $select.on('change', this._change.bind(this));\n\n        for (var i = 0; i < items.length; i++) {\n            var data = items[i];\n            var $option = this.dom('<option>');\n            $option.val(i);\n            $option.html(data.name);\n\n            $select.append($option);\n        }\n\n        return $select;\n    }\n});","ArticleEditor.add('plugin', 'filelink', {\n    translations: {\n        en: {\n            \"filelink\": {\n                \"file\": \"File\",\n                \"upload\": \"Upload\",\n                \"title\": \"Title\",\n                \"choose\": \"Choose\",\n                \"placeholder\": \"Drag to upload a file<br>or click to select\"\n            }\n        }\n    },\n    defaults: {\n        states: true,\n        classname: false,\n        upload: false,\n        select: false,\n        name: 'file',\n        data: false,\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m14 9c.5128358 0 .9355072.38604019.9932723.88337887l.0067277.11662113v3.2c0 .9600523-.7638671 1.7205052-1.7068479 1.7941504l-.150295.0058496h-10.28571424c-.96021508 0-1.77209294-.7124503-1.85088019-1.6501425l-.00626267-.1498575v-3.2c0-.55228475.44771525-1 1-1 .51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v3h10v-3c0-.51283584.3860402-.93550716.8833789-.99327227zm-6-8c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6h1.5c.1573787 0 .3055728.07409708.4.2.1656854.2209139.1209139.53431458-.1.7l-2.5 1.875c-.17777778.1333333-.42222222.1333333-.6 0l-2.5-1.875c-.12590292-.09442719-.2-.24262135-.2-.4 0-.27614237.22385763-.5.5-.5h1.5v-6c0-.55228475.44771525-1 1-1z\"/></svg>'\n    },\n    subscribe: {\n        'editor.load, editor.build': function() {\n            this.observeStates();\n        }\n    },\n    popups: {\n        create: {\n            title: '## filelink.upload ##',\n            width: '400px',\n            form: {\n                title: { type: 'input', label: '## filelink.title ##'},\n                file: {}\n            }\n        },\n        choose: {\n            collapse: false,\n            title: '## filelink.choose ##',\n            width: '400px'\n        }\n    },\n    init: function() {\n        this.dataStates = [];\n    },\n    start: function() {\n        if (!this._is()) return;\n\n        this.app.toolbar.add('file', {\n            title: '## filelink.file ##',\n            icon: this.opts.filelink.icon,\n            command: 'filelink.popup',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            },\n            position: { after: 'link' }\n        });\n    },\n    popup: function(params, button) {\n        // create\n        var choosetype = 'create';\n        if (this.opts.filelink.upload) {\n            choosetype = 'add';\n            var text = this.app.selection.getText();\n            var popup = this.app.popup.create('file', this._buildPopupUpload(this.popups.create));\n            popup.setData({ title: text });\n        }\n\n        // select\n        if (this.opts.filelink.select) {\n            var spopup = this.app.popup[choosetype]('file-select', this.popups.choose);\n            this.$sbox = spopup.getBody();\n\n            if (typeof this.opts.filelink.select === 'string') {\n                this.ajax.get({\n                    url: this.opts.filelink.select,\n                    success: this._parseList.bind(this)\n                });\n            }\n            else {\n                this._parseList.apply(this, [this.opts.filelink.select]);\n            }\n        }\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    insertByUpload: function(response) {\n        // popup close\n        this.app.popup.close();\n\n        // data\n        var data = this.app.popup.getData();\n\n        // insert\n        this._insert(response, data.title);\n    },\n    insertBySelect: function(e) {\n        e.preventDefault();\n\n        // popup close\n        this.app.popup.close();\n\n        // selection\n        var text = this.app.selection.getText();\n\n        var $el = this.dom(e.target).closest('.' + this.prefix + '-popup-list-item');\n        var data = JSON.parse(decodeURI($el.attr('data-params')));\n\n        this._insert({ file: data }, text, true);\n    },\n    error: function(response) {\n        this.app.broadcast('file.upload.error', { response: response });\n    },\n    observeStates: function() {\n        this._findFiles().each(this._addFileState.bind(this));\n    },\n    getStates: function() {\n        var $files = this._findFiles();\n\n        // check status\n        for (var key in this.dataStates) {\n            var data = this.dataStates[key];\n            var status = $files.is('[data-file=\"' + data.id + '\"]');\n            this._setFileState(data.id, status);\n        }\n\n        return this.dataStates;\n    },\n\n    // private\n    _is: function() {\n        return (this.opts.filelink.upload || this.opts.filelink.select);\n    },\n    _insert: function(response, title, select) {\n        // loop\n        for (var key in response) {\n            // create file link\n            var $file = this._createFileAndStore(response[key], title);\n\n            // broadcast\n            var eventType = (select) ? 'select' : 'upload';\n            this.app.broadcast('file.' + eventType, { response: response, $el: $file });\n            break;\n        }\n    },\n    _buildPopupUpload: function(obj) {\n        obj.form.file = {\n            type: 'upload',\n            upload: {\n                type: 'file',\n                box: true,\n                placeholder: this.lang.get('filelink.placeholder'),\n                url: this.opts.filelink.upload,\n                name: this.opts.filelink.name,\n                data: this.opts.filelink.data,\n                multiple: false,\n                success: 'filelink.insertByUpload',\n                error: 'filelink.error'\n            }\n        };\n\n        return obj;\n    },\n    _findFiles: function() {\n        return this.app.editor.getLayout().find('[data-file]');\n    },\n    _addFileState: function($node) {\n        var id = $node.attr('data-file');\n        this.dataStates[id] = { type: 'file', status: true, url: $node.attr('src'), $el: $node, id: id };\n    },\n    _setFileState: function(url, status) {\n        this.dataStates[url].status = status;\n    },\n    _parseList: function(data) {\n        var $ul = this.dom('<ul>');\n        $ul.addClass(this.prefix + '-popup-list');\n\n        for (var key in data) {\n            var obj = data[key];\n            if (typeof obj !== 'object') continue;\n\n            var $li = this.dom('<li>');\n            var $item = this.dom('<span>');\n            $li.append($item);\n\n            // file item\n            $item.addClass(this.prefix + '-popup-list-item');\n            $item.attr('data-params', encodeURI(JSON.stringify(obj)));\n            $item.text(obj.title || obj.name);\n\n            // file name\n            var $name = this.dom('<span>');\n            $name.addClass(this.prefix + '-popup-list-aside');\n            $name.text(obj.name);\n            $li.append($name);\n\n            // file size\n            var $size = this.dom('<span>');\n            $size.addClass(this.prefix + '-popup-list-aside');\n            $size.text('(' + obj.size + ')');\n            $li.append($size);\n\n            // event\n            $li.on('click', this.insertBySelect.bind(this));\n\n            // append\n            $ul.append($li);\n        }\n\n        this.$sbox.append($ul);\n    },\n    _createFileAndStore: function(item, title) {\n        var nodes = this.app.inline.set({ tag: 'a', caret: 'after' });\n        var $file = this.dom(nodes);\n\n        $file.attr('href', item.url);\n        $file.attr('data-file', (item.id) ? item.id : this.app.utils.getRandomId());\n        $file.attr('data-name', item.name);\n\n        // classname\n        if (this.opts.filelink.classname) {\n            $file.addClass(this.opts.filelink.classname);\n        }\n\n        // title\n        title = (title && title !== '') ? title : this._truncateUrl(item.name);\n        $file.html(title);\n\n        return $file;\n    },\n    _truncateUrl: function(url) {\n        return (url.search(/^http/) !== -1 && url.length > 20) ? url.substring(0, 20) + '...' : url;\n    },\n});","ArticleEditor.add('plugin', 'fontsize', {\n    translations: {\n        'en': {\n            \"fontsize\": {\n                \"title\": \"Text size\",\n                \"remove\":  \"Remove text size\"\n            }\n        }\n    },\n    init() {\n        this.sizes = (this.opts.fontsize) ? this.opts.fontsize : ['10px', '11px', '12px', '14px', '16px', '18px', '20px', '24px', '28px', '30px'];\n    },\n    start() {\n        let button = {\n            title: '## fontsize.title ##',\n            icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M1.33667 3.33336C1.33667 2.87496 1.70827 2.50336 2.16667 2.50336H10.8333C11.2917 2.50336 11.6633 2.87496 11.6633 3.33336V4.66669C11.6633 5.12509 11.2917 5.49669 10.8333 5.49669C10.3749 5.49669 10.0033 5.12509 10.0033 4.66669V4.16336H7.66334V11.8367H8.16667C8.62507 11.8367 8.99667 12.2083 8.99667 12.6667C8.99667 13.1251 8.62507 13.4967 8.16667 13.4967H5.5C5.04161 13.4967 4.67 13.1251 4.67 12.6667C4.67 12.2083 5.04161 11.8367 5.5 11.8367H6.00334V4.16336H2.99667V4.66669C2.99667 5.12509 2.62507 5.49669 2.16667 5.49669C1.70827 5.49669 1.33667 5.12509 1.33667 4.66669V3.33336ZM9.33667 8.00002C9.33667 7.54163 9.70827 7.17002 10.1667 7.17002H14.1667C14.6251 7.17002 14.9967 7.54163 14.9967 8.00002V8.66669C14.9967 9.12509 14.6251 9.49669 14.1667 9.49669C13.7642 9.49669 13.4286 9.2102 13.3527 8.83002H12.9967V11.8528C13.3768 11.9286 13.6633 12.2642 13.6633 12.6667C13.6633 13.1251 13.2917 13.4967 12.8333 13.4967H11.5C11.0416 13.4967 10.67 13.1251 10.67 12.6667C10.67 12.2642 10.9565 11.9286 11.3367 11.8528V8.83002H10.9806C10.9047 9.2102 10.5692 9.49669 10.1667 9.49669C9.70827 9.49669 9.33667 9.12509 9.33667 8.66669V8.00002Z\"/></svg>',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            },\n            command: 'fontsize.popup'\n        };\n\n        this.app.toolbar.add('fontsize', button);\n    },\n    popup(e, button) {\n        let buttons = {};\n        for (let i = 0; i < this.sizes.length; i++) {\n            let size = this.sizes[i];\n            let params = { tag: 'span', style: { 'font-size': size }};\n            let obj = {\n                title: size,\n                command: 'inline.set',\n                params: params\n            };\n\n            buttons[i] = obj;\n        }\n\n        // remove font family\n        buttons['remove'] = {\n            title: '## fontsize.remove ##',\n            divider: 'top',\n            command: 'fontsize.remove'\n        };\n\n        this.app.popup.create('fontsize', {\n            //width: '300px',\n            items: buttons\n        });\n        this.app.popup.open({ button: button });\n    },\n    remove() {\n        this.app.popup.close();\n\n        let obj = { style: 'font-size' };\n        this.app.inline.remove(obj);\n    }\n});","ArticleEditor.add('plugin', 'fontfamily', {\n    translations: {\n        'en': {\n            \"fontfamily\": {\n                \"title\": \"Font\",\n                \"remove\":  \"Remove font family\"\n            }\n        }\n    },\n    init() {\n        this.fonts = (this.opts.fontfamily) ? this.opts.fontfamily : ['Arial', 'Helvetica', 'Georgia', 'Times New Roman', 'Monospace'];\n    },\n    start() {\n        let button = {\n            title: '## fontfamily.title ##',\n            icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.05618 2.37524C7.17767 2.05129 7.48736 1.83667 7.83334 1.83667H9.16667C9.49643 1.83667 9.79491 2.03188 9.92708 2.33399L14.3762 12.5033H14.5C14.9584 12.5033 15.33 12.8749 15.33 13.3333C15.33 13.7917 14.9584 14.1633 14.5 14.1633H13.8524C13.8399 14.1636 13.8275 14.1636 13.8152 14.1633H11.1855C11.1732 14.1636 11.1609 14.1636 11.1486 14.1633H9.83334C9.37494 14.1633 9.00334 13.7917 9.00334 13.3333C9.00334 12.8749 9.37494 12.5033 9.83334 12.5033H9.91398L9.20556 10.83H5.65853L5.03103 12.5033H5.16667C5.62507 12.5033 5.99667 12.8749 5.99667 13.3333C5.99667 13.7917 5.62507 14.1633 5.16667 14.1633H3.85246C3.83966 14.1636 3.82682 14.1636 3.81397 14.1633H3.16667C2.70827 14.1633 2.33667 13.7917 2.33667 13.3333C2.33667 12.8749 2.70827 12.5033 3.16667 12.5033H3.25815L7.05618 2.37524ZM6.28103 9.17H8.50278L7.32462 6.38709L6.28103 9.17ZM8.17134 4.12916L11.7166 12.5033H12.5643L8.62384 3.49667H8.40853L8.17134 4.12916Z\"/></svg>',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            },\n            command: 'fontfamily.popup'\n        };\n\n        this.app.toolbar.add('fontfamily', button);\n    },\n    popup(e, button) {\n        let buttons = {};\n        for (let i = 0; i < this.fonts.length; i++) {\n            let font = this.fonts[i];\n            let obj = {\n                title: font.replace(/'/g, ''),\n                command: 'inline.set',\n                params: {\n                    tag: 'span',\n                    style: {\n                        'font-family': font\n                    }\n                }\n            };\n\n            buttons[i] = obj;\n        }\n\n        // remove font family\n        buttons['remove'] = {\n            title: '## fontfamily.remove ##',\n            divider: 'top',\n            command: 'fontfamily.remove'\n        };\n\n        this.app.popup.create('fontfamily', {\n            //width: '300px',\n            items: buttons\n        });\n        this.app.popup.open({ button: button });\n    },\n    remove() {\n        this.app.popup.close();\n        this.app.inline.remove({ style: 'font-family' });\n    }\n});","ArticleEditor.add('plugin', 'fontcolor', {\n    translations: {\n        'en': {\n            \"fontcolor\": {\n                \"title\": \"Text color\",\n                \"remove\":  \"Remove color\",\n                \"text\": \"Text\",\n                \"background\": \"Background\"\n            }\n        }\n    },\n    init() {\n        let colors = {\n            gray:   ['#212529', '#343a40', '#495057', '#868e96', '#adb5bd', '#ced4da', '#dee2e6', '#e9ecef', '#f1f3f5', '#f8f9fa'],\n            red:    [\"#c92a2a\", \"#e03131\", \"#f03e3e\", \"#fa5252\", \"#ff6b6b\", \"#ff8787\", \"#ffa8a8\", \"#ffc9c9\", \"#ffe3e3\", \"#fff5f5\"],\n            pink:   [\"#a61e4d\", \"#c2255c\", \"#d6336c\", \"#e64980\", \"#f06595\", \"#f783ac\", \"#faa2c1\", \"#fcc2d7\", \"#ffdeeb\", \"#fff0f6\"],\n            grape:  [\"#862e9c\", \"#9c36b5\", \"#ae3ec9\", \"#be4bdb\", \"#cc5de8\", \"#da77f2\", \"#e599f7\", \"#eebefa\", \"#f3d9fa\", \"#f8f0fc\"],\n            violet: [\"#5f3dc4\", \"#6741d9\", \"#7048e8\", \"#7950f2\", \"#845ef7\", \"#9775fa\", \"#b197fc\", \"#d0bfff\", \"#e5dbff\", \"#f3f0ff\"],\n            indigo: [\"#364fc7\", \"#3b5bdb\", \"#4263eb\", \"#4c6ef5\", \"#5c7cfa\", \"#748ffc\", \"#91a7ff\", \"#bac8ff\", \"#dbe4ff\", \"#edf2ff\"],\n            blue:   [\"#1864ab\", \"#1971c2\", \"#1c7ed6\", \"#228be6\", \"#339af0\", \"#4dabf7\", \"#74c0fc\", \"#a5d8ff\", \"#d0ebff\", \"#e7f5ff\"],\n            cyan:   [\"#0b7285\", \"#0c8599\", \"#1098ad\", \"#15aabf\", \"#22b8cf\", \"#3bc9db\", \"#66d9e8\", \"#99e9f2\", \"#c5f6fa\", \"#e3fafc\"],\n            teal:   [\"#087f5b\", \"#099268\", \"#0ca678\", \"#12b886\", \"#20c997\", \"#38d9a9\", \"#63e6be\", \"#96f2d7\", \"#c3fae8\", \"#e6fcf5\"],\n            green:  [\"#2b8a3e\", \"#2f9e44\", \"#37b24d\", \"#40c057\", \"#51cf66\", \"#69db7c\", \"#8ce99a\", \"#b2f2bb\", \"#d3f9d8\", \"#ebfbee\"],\n            lime:   [\"#5c940d\", \"#66a80f\", \"#74b816\", \"#82c91e\", \"#94d82d\", \"#a9e34b\", \"#c0eb75\", \"#d8f5a2\", \"#e9fac8\", \"#f4fce3\"],\n            yellow: [\"#e67700\", \"#f08c00\", \"#f59f00\", \"#fab005\", \"#fcc419\", \"#ffd43b\", \"#ffe066\", \"#ffec99\", \"#fff3bf\", \"#fff9db\"],\n            orange: [\"#d9480f\", \"#e8590c\", \"#f76707\", \"#fd7e14\", \"#ff922b\", \"#ffa94d\", \"#ffc078\", \"#ffd8a8\", \"#ffe8cc\", \"#fff4e6\"]\n        };\n\n\n        this.colors = (this.opts.fontcolor) ? this.opts.fontcolor : colors;\n    },\n    start() {\n        let button = {\n            title: '## fontcolor.title ##',\n            color: true,\n            icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.50002 4.16336C8.18972 4.16336 7.89213 4.28662 7.67271 4.50604C7.45329 4.72546 7.33002 5.02305 7.33002 5.33336V6.50336H9.67002V5.33336C9.67002 5.02305 9.54676 4.72546 9.32734 4.50604C9.10792 4.28662 8.81033 4.16336 8.50002 4.16336ZM11.33 5.33336C11.33 4.58279 11.0319 3.86297 10.5011 3.33224C9.97041 2.80152 9.25059 2.50336 8.50002 2.50336C7.74946 2.50336 7.02964 2.80152 6.49891 3.33224C5.96818 3.86297 5.67002 4.58279 5.67002 5.33336V10C5.67002 10.4584 6.04163 10.83 6.50002 10.83C6.95842 10.83 7.33002 10.4584 7.33002 10V8.16336H9.67002V10C9.67002 10.4584 10.0416 10.83 10.5 10.83C10.9584 10.83 11.33 10.4584 11.33 10V5.33336ZM3.00336 12.6667C3.00336 12.2083 3.37496 11.8367 3.83336 11.8367H13.1667C13.6251 11.8367 13.9967 12.2083 13.9967 12.6667C13.9967 13.1251 13.6251 13.4967 13.1667 13.4967H3.83336C3.37496 13.4967 3.00336 13.1251 3.00336 12.6667Z\"/></svg>',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            },\n            command: 'fontcolor.popup'\n        };\n\n        this.app.toolbar.add('fontcolor', button);\n    },\n    popup(e, button) {\n        let inlines = this.app.selection.getNodes({ type: 'inline' });\n\n        this.currentColor = false;\n        this.currentBackgroundColor = false;\n\n        if (inlines) {\n            let $inline = this.dom(inlines[0]);\n            let style = this.app.utils.cssToObject($inline.attr('style'));\n            this.currentColor = (style.color) ? style.color : this.currentColor;\n            this.currentBackgroundColor = (style.background) ? style.background : this.currentBackgroundColor;\n        }\n\n        let $dropdown = this.dom('<div class=\"' + this.prefix + '-dropdown-cells\">');\n\n        this.$selector = this._buildSelector();\n\n        this.$selectorText = this._buildSelectorItem('text', this.lang.get('fontcolor.text'));\n        this.$selectorText.addClass('active');\n\n        this.$selectorBack = this._buildSelectorItem('back', this.lang.get('fontcolor.background'));\n\n        this.$selector.append(this.$selectorText);\n        this.$selector.append(this.$selectorBack);\n\n        this.$pickerText = this._buildPicker('textcolor');\n        this.$pickerBack = this._buildPicker('backcolor');\n\n        let width = Object.keys(this.colors).length * 20;\n\n        $dropdown.append(this.$selector);\n        $dropdown.append(this.$pickerText);\n        $dropdown.append(this.$pickerBack);\n        $dropdown.width(width);\n\n        this._buildSelectorEvents();\n\n        this.app.popup.create('fontcolor', {\n            width: width + 'px',\n            html: $dropdown\n        });\n        this.app.popup.open({ button: button });\n    },\n\n    // =private\n    _remove(type) {\n        this.app.popup.close();\n\n        let obj = (type === 'color') ? { style: 'color' } : { style: 'background' };\n        this.app.inline.remove(obj);\n    },\n    _buildSelector() {\n        let $selector = this.dom('<div>');\n        $selector.addClass(this.prefix + '-dropdown-selector');\n\n        return $selector;\n    },\n    _buildSelectorItem(name, title) {\n        let $item = this.dom('<span>');\n        $item.attr('rel', name).html(title);\n        $item.addClass(this.prefix + '-dropdown-not-close');\n\n        return $item;\n    },\n    _buildSelectorEvents() {\n        this.$selectorText.on('click', function(e) {\n            e.preventDefault();\n\n            this.$selector.find('span').removeClass('active');\n            this.$pickerBack.hide();\n            this.$pickerText.show();\n            this.$selectorText.addClass('active');\n\n        }.bind(this));\n\n        this.$selectorBack.on('click', function(e) {\n            e.preventDefault();\n\n            this.$selector.find('span').removeClass('active');\n            this.$pickerText.hide();\n            this.$pickerBack.show();\n            this.$selectorBack.addClass('active');\n\n        }.bind(this));\n    },\n    _buildPicker(name) {\n        var $box = this.dom('<div class=\"' + this.prefix + '-dropdown-box-' + name + '\">');\n        var $colorBox = this.dom('<div class=\"' + this.prefix + '-form-colors-box\">');\n        var rule = (name == 'backcolor') ? 'background' : 'color';\n        var len = this.colors.length;\n        var self = this;\n\n        for (let [key, item] of Object.entries(this.colors)) {\n            var $div = this.dom('<div class=\"' + this.prefix + '-form-colors\">');\n\n            for (var i = 0; i < item.length; i++) {\n                var color = item[i];\n                var $swatch = this.dom('<a href=\"#\">');\n                $swatch.attr({ 'rel': color, 'data-rule': rule });\n                $swatch.css({ 'background-color': color, 'font-size': 0, 'width': '20px', 'height': '20px' });\n                $swatch.on('click', function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    var $el = this.dom(e.target);\n                    let color = $el.attr('rel');\n                    let style = ($el.data('rule') === 'color') ? { 'color': color } : { 'background': color };\n                    let params = { tag: 'span', style: style };\n\n                    this.app.event.trigger = false;\n                    this.app.inline.set(params);\n                    setTimeout(function() {\n                        this.app.event.trigger = true;\n                    }.bind(this), 100);\n                }.bind(this));\n\n                if (rule === 'color' && this.currentColor === color) {\n                    $swatch.addClass('active');\n                }\n                if (rule === 'background' && this.currentBackgroundColor === color) {\n                    $swatch.addClass('active');\n                }\n\n                $div.append($swatch);\n            }\n\n            $colorBox.append($div);\n        }\n\n        $box.append($colorBox);\n\n        var $el = this.dom('<div>').addClass(this.prefix + '-dropdown-remove-item');\n        var $link = this.dom('<a>');\n        $link.attr({ 'href': '#' });\n        $link.html(this.lang.get('fontcolor.remove'));\n        $link.on('click', function(e) {\n            e.preventDefault();\n            self._remove(rule);\n        });\n\n        $el.append($link);\n        $box.append($el);\n\n        if (name == 'backcolor') $box.hide();\n\n        return $box;\n    }\n\n});","ArticleEditor.add('plugin', 'handle', {\n    translations: {\n        en: {\n            \"handle\": {\n                \"handle\": \"Handle\"\n            }\n        }\n    },\n    defaults: {\n        url: false,\n        start: 1,\n        trigger: '@'\n    },\n    subscribe: {\n        'editor.keydown': function(event) {\n            this._listen(event);\n        },\n        'editor.keyup': function(event) {\n            if (this.opts.handle.url === false) return;\n            this._handle(event);\n        }\n    },\n    start: function() {\n        this.handleLen = this.opts.handle.start;\n    },\n    stop: function() {\n        this._hide();\n    },\n\n    // private\n    _handle: function(event) {\n        var e = event.get('e');\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var arrows = [37, 38, 39, 40];\n        var ks = this.app.keycodes;\n\n        if (key === ks.ESC) {\n            this.app.selection.restore();\n            return;\n        }\n        if (key === ks.DELETE || key === ks.SPACE || key === ks.SHIFT || ctrl || (arrows.indexOf(key) !== -1)) {\n            return;\n        }\n\n        if (key === ks.BACKSPACE) {\n            this.handleLen = this.handleLen - 2;\n            if (this.handleLen <= this.opts.handle.start) {\n                this._hide();\n            }\n        }\n\n        this._emit();\n    },\n    _listen: function(event) {\n        var e = event.get('e');\n        var key = e.which;\n        var ks = this.app.keycodes;\n\n        // listen enter\n        if (this._isShown() && key === ks.ENTER) {\n            var $item = this._getActiveItem();\n            if ($item.length === 0) {\n                this._hideForce();\n                return;\n            }\n            else {\n                e.preventDefault();\n                event.stop();\n                this._replace(e, $item);\n                return;\n            }\n        }\n\n        // listen down / up\n        if (this._isShown() && (key === 40 || key === 38)) {\n            e.preventDefault();\n            event.stop();\n\n            var $item = this._getActiveItem();\n            if ($item.length === 0) {\n                var $first = this._getFirstItem();\n                this._setActive($first);\n            }\n            // down\n            else if (key === 40) {\n                this._setNextActive($item);\n            }\n            // up\n            else if (key === 38) {\n                this._setPrevActive($item);\n            }\n        }\n    },\n    _getItems: function() {\n        return this.$panel.find('.' + this.prefix + '-panel-item');\n    },\n    _getActiveItem: function() {\n        return this._getItems().filter(function($node) {\n            return $node.hasClass('active');\n        });\n    },\n    _getFirstItem: function() {\n        return this._getItems().first();\n    },\n    _getLastItem: function() {\n        return this._getItems().last();\n    },\n    _setActive: function($el) {\n        this._getItems().removeClass('active');\n        $el.addClass('active');\n\n        var itemHeight = $el.outerHeight();\n        var itemTop = $el.position().top;\n        var itemsScrollTop = this.$panel.scrollTop();\n        var scrollTop = itemTop + itemHeight * 2;\n        var itemsHeight = this.$panel.outerHeight();\n\n        this.$panel.scrollTop(\n            scrollTop > itemsScrollTop + itemsHeight ? scrollTop - itemsHeight :\n                itemTop - itemHeight < itemsScrollTop ? itemTop - itemHeight :\n                itemsScrollTop\n        );\n    },\n    _setNextActive: function($el) {\n        var $next = $el.next();\n        if ($next.length !== 0) {\n            this._setActive($next);\n        }\n        else {\n            var $first = this._getFirstItem();\n            this._setActive($first);\n        }\n    },\n    _setPrevActive: function($el) {\n        var $prev = $el.prev();\n        if ($prev.length !== 0) {\n            this._setActive($prev);\n        }\n        else {\n            var $last = this._getLastItem();\n            this._setActive($last);\n        }\n    },\n    _emit: function() {\n        var re = new RegExp('^' + this.opts.handle.trigger);\n        this.handleStr = this.app.selection.getText('before', this.handleLen);\n        this.handleStr2 = this.app.selection.getText('before', this.handleLen+1);\n\n        // detect\n        if (re.test(this.handleStr)) {\n            if (this.handleStr2 && this.handleStr2[0] === ' ' || this.handleStr2[0] === '') {\n                this.handleStr = this.handleStr.replace(this.opts.handle.trigger, '');\n                this.handleLen++;\n\n                if ((this.handleLen-1) > this.opts.handle.start) {\n                    this._load();\n                }\n            }\n        }\n    },\n    _isShown: function() {\n        return (this.$panel && this.$panel.hasClass('open'));\n    },\n    _load: function() {\n        this.ajax.post({\n            url: this.opts.handle.url,\n            data: 'handle=' + this.handleStr,\n            success: this._parse.bind(this)\n        });\n    },\n    _parse: function(json) {\n        if (json === '' || (Array.isArray(json) && json.length === 0)) {\n            if (this.$panel) this.$panel.remove();\n            return;\n        }\n        var data = (typeof json === 'object') ? json : JSON.parse(json);\n\n        this._build(data);\n    },\n    _build: function(data) {\n\n        this.data = data;\n        this.$panel = this.app.$body.find('.' + this.prefix + '-panel');\n\n        if (this.$panel.length === 0) {\n            this.$panel = this.dom('<div>').addClass(this.prefix + '-panel');\n            this.app.$body.append(this.$panel);\n        }\n        else {\n            this.$panel.html('');\n        }\n\n        // events\n        this._stopEvents();\n        this._startEvents();\n\n        // data\n        for (var key in data) {\n            var $item = this.dom('<div>').addClass(this.prefix + '-panel-item');\n            var $trigger = this.dom('<a>').attr('href', '#');\n            $trigger.html(data[key].item);\n            $trigger.attr('data-key', key);\n            $trigger.on('click', this._replace.bind(this));\n\n            $item.append($trigger);\n            this.$panel.append($item);\n        }\n\n        // position\n        var offset = this.app.editor.getFrameRect();\n        var pos = this.app.selection.getPosition();\n\n        this.$panel.addClass('open');\n        this.$panel.css({\n            top: (pos.top + pos.height + offset.top) + 'px',\n            left: (pos.left + offset.left) + 'px'\n        });\n\n        this.app.selection.save();\n    },\n    _replace: function(e, $el) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $item;\n        if ($el) {\n            $item = $el.find('a');\n        }\n        else {\n            $item =this.dom(e.target);\n        }\n        var key = $item.attr('data-key');\n        var replacement = this.data[key].replacement;\n\n        this.app.marker.insert('start');\n        var marker = this.app.marker.find('start');\n        if (marker === false) return;\n\n        var $marker = this.dom(marker);\n        var current = marker.previousSibling;\n\n        var currentText = current.textContent;\n        var re = new RegExp(this.opts.handle.trigger + this.handleStr + '$');\n\n        currentText = currentText.replace(re, '');\n        current.textContent = currentText;\n\n        $marker.before(replacement);\n        this.app.selection.restoreMarker();\n\n        this._hide();\n    },\n    _reset: function() {\n        this.handleStr = false;\n        this.handleLen = this.opts.handle.start;\n        this.$panel = false;\n    },\n    _hide: function(e) {\n        var hidable = false;\n        var key = (e && e.which);\n        var ks = this.app.keycodes;\n\n        if (!e) {\n            hidable = true;\n        }\n        else if (e.type === 'click' || key === ks.ESC || key === ks.SPACE) {\n            hidable = true;\n        }\n\n        if (hidable) {\n            this._hideForce();\n        }\n    },\n    _hideForce: function() {\n        if (this.$panel) this.$panel.remove();\n        this._reset();\n        this._stopEvents();\n    },\n    _startEvents: function() {\n        var name = 'click.' + this.prefix + '-plugin-handle keydown.' + this.prefix + '-plugin-handle';\n\n        this.app.$doc.on(name, this._hide.bind(this));\n        this.app.editor.getBody().on(name, this._hide.bind(this));\n    },\n    _stopEvents: function() {\n        var name = '.' + this.prefix + '-plugin-handle';\n\n        this.app.$doc.off(name);\n        this.app.editor.getBody().off(name);\n    }\n});","ArticleEditor.add('plugin', 'icons', {\n    translations: {\n        en: {\n            \"icons\": {\n                \"icons\": \"Icons\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m4.83610557 5.032-3.97464639.56135882-.11503066.02273502c-.74344369.19074743-1.01211485 1.14559722-.43257233 1.69388798l2.85824938 2.70401818-.67299733 3.8119764-.01354998.1096265c-.05329246.7582459.7508858 1.3132977 1.45280081.9551391l3.5617465-1.818742 3.56345043 1.8187308.1008624.0450315c.7094575.2728097 1.4755032-.3337453 1.3384209-1.1097256l-.6737337-3.8120367 2.8592493-2.70401818.0806168-.08514687c.4956567-.58602276.1617639-1.52007291-.6282281-1.63147731l-3.976638-.56135764-1.7716142-3.48521534c-.37065902-.72902616-1.41208515-.72905169-1.78277991-.0000437zm2.664-.826 1.11796025 2.19736628.06151847.10474119c.15723483.23391009.4074375.39236473.69024457.43224609l2.43527674.34264644-1.741257 1.6488901-.08529699.09144393c-.18419657.22405591-.26337869.51926707-.2122058.80894091l.41775979 2.36372506-2.22848404-1.1365651-.1252676-.0535184c-.25574273-.0891979-.53905484-.0713624-.78377298.0535073l-2.22947541 1.1365762.4187491-2.36366475.01403221-.12426844c.0144621-.28970819-.09782698-.57400297-.31152431-.77617671l-1.742257-1.6488901 2.43601084-.34264762c.3231876-.04557858.60379519-.24600908.75173246-.53694239z\"/></svg>',\n        items: [\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.5 7.98901099c0-1.34799209.21516178-2.34981357.6454918-3.00549451.43033002-.65568093 1.04849324-.98351648 1.8545082-.98351648.86066004 0 1.49248432.32417258 1.8954918.97252747.4030075.64835489.6045082 1.65383934.6045082 3.01648352 0 1.35531813-.2168694 2.36263411-.65061475 3.02197801-.43374534.659344-1.05361619.989011-1.85963115.989011-.85382941 0-1.48223842-.3461504-1.8852459-1.0384615-.40300748-.6923112-.6045082-1.68314377-.6045082-2.97252751zm1.33196721 0c0 .89377736.09050456 1.58424665.2715164 2.07142861.18101183.4871819.47984764.7307692.89651639.7307692.40300748 0 .69842802-.223441.88627049-.6703297.18784247-.44688866.2817623-1.15750426.2817623-2.13186811 0-.88645132-.08879693-1.57142615-.26639345-2.05494506-.17759651-.4835189-.48155522-.72527472-.91188524-.72527472-.40983812 0-.70525866.22710395-.88627049.68131868-.18101184.45421473-.2715164 1.15384143-.2715164 2.0989011z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.93478261 10.7640449h1.59038901v-4.4382022l.17162472-.76404495-.54919909.66292135-1.01830663.68539326-.62929062-.84269663 2.60869565-2.06741573h.83524028v6.7640449h1.55606407v1.2359551h-4.56521739z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m10.3218527 6.07282913c0 .38095429-.0732376.76563765-.2197149 1.15406163-.14647741.38842397-.33254047.76937255-.55819481 1.14285714-.22565433.37348459-.47505801.73389182-.74821852 1.08123249-.27316052.34734067-.54037875.66666521-.80166271.95798321l-.62945368.4593837v.0560224l.85510688-.1568627h2.28028504v1.232493h-5v-.7507003c.1900247-.1867423.40379929-.4052275.64133017-.6554622.23753088-.2502346.47703759-.5154047.71852731-.79551817.24148973-.28011345.47703765-.56955967.70665083-.86834734.22961319-.29878768.43547019-.59943826.6175772-.90196079.18210701-.30252252.32660279-.59570352.43349169-.87955182.10688889-.28384829.16033254-.55275316.16033254-.80672269 0-.30625736-.09303153-.55835568-.27909739-.75630252-.18606585-.19794683-.4809956-.29691876-.8847981-.29691876-.25336627 0-.51266692.05041966-.77790974.1512605-.26524281.10084084-.48891437.22969109-.67102137.38655462l-.6175772-1.03081232c.30879014-.23903014.65914293-.43137182 1.05106888-.57703082.39192595-.14565899.85312482-.21848739 1.38361045-.21848739.34046093 0 .65320523.04481748.93824228.13445378.28503706.0896363.53048195.22035395.73634205.39215686.20586009.17180292.3681704.38655334.4869359.64425771.1187654.25770437.1781472.55835496.1781472.90196078z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m7.44047619 10.767507c.49206595 0 .8670622-.1232481 1.125-.3697479s.38690476-.54528302.38690476-.89635854c0-.42577244-.13491928-.73949479-.4047619-.94117647s-.69444155-.30252101-1.27380953-.30252101h-.85714285v-.77310924l1.44047619-1.8487395.67857143-.50420168-.94047619.10084034h-2v-1.232493h4.547619v.79551821l-1.67857139 2.11764706-.52380952.302521v.05602241l.5-.06722689c.27777917.02240908.54166542.08216572.79166667.17927171.25000125.097106.46825303.23716062.6547619.42016807.18650884.18300745.33531694.40896224.44642854.67787115.1111117.2689089.1666667.57889647.1666667.92997199 0 .44071182-.0773802.82166039-.2321429 1.14285709-.1547626.3211968-.36904621.5901017-.6428571.8067227-.27381089.2166211-.59325214.3772171-.95833333.4817928-.36508119.1045756-.75793441.1568627-1.17857143.1568627-.3492081 0-.7103156-.0298783-1.08333334-.0896359-.37301773-.0597575-.67460202-.1456577-.9047619-.257703l.41666667-1.2100841c.20635023.097106.43452256.1755366.68452381.2352941.25000125.0597576.52976035.0896359.83928571.0896359z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m10.5 9.78723404h-1.23595506v2.21276596h-1.35955056v-2.21276596h-3.40449438v-.83971631l3.56179775-4.94751773h1.20224719v4.6070922h1.23595506zm-2.59550562-2.91631205.1011236-.95319149h-.04494382l-.38202247.81702127-1.16853933 1.5319149-.56179775.43120567.71910112-.09078014h1.33707865z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m7.31818182 10.7114846c.52631842 0 .92902572-.1195133 1.20813397-.3585434.27910825-.2390302.41866029-.56769168.41866029-.98599442 0-.44818151-.16347524-.77684303-.49043063-.9859944-.32695538-.20915137-.79345789-.31372549-1.39952153-.31372549l-.94497607.03361345v-4.10084034h4.11483255v1.36694678h-2.77511963v1.51260504l.49043062-.04481793c.39075155.01493939.74361884.08216561 1.05861244.20168068s.58412966.28571322.80741627.49859944c.2232866.21288621.3947362.47058672.5143541.77310924.1196178.30252252.1794258.64052101.1794258 1.0140056 0 .44071182-.079744.82912995-.2392344 1.16526615-.1594905.3361361-.38078013.6162453-.66387565.8403361-.28309551.2240907-.61602679.3921563-.99880383.5042017-.38277703.1120454-.80143313.1680672-1.25598086.1680672-.35885347 0-.69975915-.0280109-1.02272727-.0840336s-.59609139-.1325859-.81937799-.2296919l.41866029-1.210084c.18341399.0746969.38476764.1325861.60406698.1736694s.48444821.0616247.79545455.0616247z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m10.5 9.46153846c0 .35897616-.0587601.69230614-.1762821 1.00000004-.1175219.3076938-.2831185.5750904-.49679482.8021978-.21367629.2271073-.47186459.4065927-.77457265.5384615-.30270807.1318688-.63568195.1978022-.99893163.1978022-.37037222 0-.71046853-.060439-1.02029914-.1813187s-.57870257-.3021966-.80662393-.543956c-.22792137-.2417595-.40598227-.5457857-.53418804-.9120879-.12820577-.36630224-.19230769-.79120641-.19230769-1.27472531 0-.72527835.10149471-1.38094945.30448718-1.96703297s.47720625-1.09706742.82264957-1.53296703c.34544332-.43589962.74786095-.78754445 1.20726496-1.05494506.45940401-.2674006.94551026-.4450545 1.45833333-.53296703l.30982906 1.13186813c-.35612713.05860835-.68375919.17216033-.98290598.34065934-.2991468.16849901-.56445753.3699622-.79594017.60439561-.23148264.2344334-.42734963.49633555-.58760684.78571428-.16025721.28937874-.27243558.58791055-.33653846.8956044.14245085-.1831511.32763419-.3388272.55555556-.46703297.22792136-.12820577.5128188-.19230769.85470085-.19230769.32051442 0 .61609551.05128154.88675214.15384615.27065662.10256462.50213579.25457775.69444444.45604396.19230866.20146621.34187976.44871648.44871796.74175824.1068381.29304176.1602564.63003473.1602564 1.01098901zm-1.34615385.07692308c0-.82051692-.39173397-1.23076923-1.17521367-1.23076923-.28490171 0-.52528392.0659334-.72115385.1978022-.19586992.13186879-.33297681.2857134-.41132478.46153846-.01424509.08058648-.02136753.15018285-.02136753.20879121v.17582417c0 .17582506.02492853.34981599.07478633.52197802s.12286277.32600663.21901709.46153843c.09615433.1355318.21901635.2454209.36858975.3296704.14957339.0842495.32763429.1263736.53418803.1263736.33475951 0 .60719268-.117215.81730769-.3516484s.31517094-.53479666.31517094-.90109886z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.98780488 12 2.53880266-6.16.48780488-.56-.66518847.11428571h-2.84922395v-1.39428571h5v.43428571l-3.10421286 7.56571429z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.5 9.96703297c0-.25641154.03363195-.48534698.10089686-.68681319s.16255544-.38461456.28587444-.54945055.26905746-.31318615.43721973-.44505494c.16816228-.1318688.34940112-.25274671.54372197-.36263737-.36622006-.22710736-.65396009-.4890095-.8632287-.78571428-.2092686-.29670478-.31390134-.66483297-.31390134-1.10439561 0-.28571571.05418481-.5531123.16255605-.8021978.10837125-.24908549.26532035-.46520055.47085202-.64835165s.45403442-.32600681.7455157-.42857143c.29148127-.10256461.62032701-.15384615.98654708-.15384615.33632455 0 .64274899.0439556.91928251.13186813s.51382562.21245341.71188341.37362638c.19805779.16117296.35126997.3571417.45964127.58791208.1083712.23077039.162556.4853466.162556.76373627 0 .43223659-.0990274.79853329-.2970852 1.0989011-.19805775.3003678-.48766622.57509033-.86883404.82417582.44843273.25641154.78662068.53846 1.01457394.84615385.2279534.30769384.3419283.70329428.3419283 1.18681318 0 .32967199-.0616586.62820379-.1849776.89560439s-.2970841.4963361-.52130043.6868132c-.22421636.1904771-.49327197.3388273-.80717488.4450549-.31390292.1062277-.65769619.1593407-1.03139014.1593407s-.71188189-.0494501-1.01457399-.1483516c-.3026921-.0989016-.56053705-.2362629-.7735426-.412088-.21300555-.175825-.37742842-.3882771-.49327354-.6373626-.11584513-.2490855-.17376682-.527471-.17376682-.83516483zm3.60986547-.14285715c0-.16849901-.04110572-.32234362-.12331838-.46153846-.08221267-.13919483-.18871385-.2655672-.31950673-.37912088s-.27653134-.21794824-.43721973-.31318681c-.1606884-.09523857-.32324283-.18681275-.48766816-.27472527-.35127231.19780318-.59230129.41208675-.72309417.64285714-.13079289.23077038-.19618834.45970582-.19618834.68681319 0 .29304177.10276429.54395497.30829596.75274727.20553167.2087922.49140325.3131868.85762332.3131868.33632455 0 .6072486-.0805853.81278027-.2417583.20553167-.1611729.30829596-.4029287.30829596-.72527468zm-2.02914798-3.76923077c0 .17582506.03363195.32966968.10089686.46153847s.15881855.24725225.27466368.34615384c.11584512.0989016.24663604.19047577.39237668.27472528.14574064.0842495.29708442.16300329.45403587.23626373.44843274-.37362824.67264574-.78388055.67264574-1.23076923 0-.30769384-.09155364-.54029225-.27466367-.69780219-.18311004-.15750995-.4054546-.23626374-.66704036-.23626374-.32885068 0-.56987966.08424824-.72309417.25274725-.15321452.16849901-.22982063.36629923-.22982063.59340659z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z\"/><path d=\"m5.5 6.56043956c0-.37362824.05473109-.71794714.16419492-1.03296703.10946382-.31501989.26836054-.58424797.47669491-.80769231.20833438-.22344434.46256912-.39926676.76271186-.52747253.30014275-.12820577.64441897-.19230769 1.03283899-.19230769.79802659 0 1.42478586.24725027 1.88029661.74175824.45551071.49450797.68326271 1.21428099.68326271 2.15934066 0 .8498211-.1041656 1.58424599-.3125 2.2032967-.20833437.61905072-.48728639 1.1355291-.83686441 1.5494506-.34957802.4139214-.75388188.7307681-1.21292373.9505494-.45904184.2197813-.94279406.3516481-1.45127118.3956044l-.29661017-1.1208791c.38842002-.0512823.73446176-.1501824 1.03813559-.2967033.30367384-.1465209.56497066-.3278378.78389831-.5439561.21892765-.21611826.39724507-.46153705.53495762-.7362637.13771256-.27472665.23481611-.56959549.29131356-.88461538-.16949237.19047714-.35134083.32234395-.54555084.39560439s-.45374132.10989011-.7786017.10989011c-.26836292 0-.5349563-.04761857-.79978813-.14285714-.26483184-.09523857-.50141139-.23992577-.70974577-.43406593-.20833437-.19414017-.3778242-.43955896-.50847457-.73626374s-.19597458-.64651813-.19597458-1.04945055zm1.33474576-.07692308c0 .41758451.11299322.73259967.33898305.94505495.22598983.21245527.50847288.31868132.84745763.31868132.28954947 0 .52612903-.04761857.70974576-.14285715.18361674-.09523857.32485827-.21245351.42372882-.35164835.02118654-.15384692.03177966-.3003656.03177966-.43956044 0-.20512923-.02471727-.40659241-.07415254-.6043956-.04943528-.19780319-.1253526-.37362561-.22775424-.52747253s-.23305005-.27655632-.39194915-.36813187-.34780964-.13736263-.56673729-.13736263c-.34604693 0-.61440583.11538346-.80508475.34615384-.19067892.23077039-.28601695.55128-.28601695.96153846z\"/></g></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-8.01098901c0 1.28938374.20150072 2.28021631.6045082 2.97252751.40300748.6923111 1.03141649 1.0384615 1.8852459 1.0384615.80601496 0 1.42588581-.329667 1.85963115-.989011.43374535-.6593439.65061475-1.66665988.65061475-3.02197801 0-1.36264418-.2015007-2.36812863-.6045082-3.01648352-.40300748-.64835489-1.03483176-.97252747-1.8954918-.97252747-.80601496 0-1.42417818.32783555-1.8545082.98351648-.43033002.65568094-.6454918 1.65750242-.6454918 3.00549451zm1.33196721 0c0-.94505967.09050456-1.64468637.2715164-2.0989011.18101183-.45421473.47643237-.68131868.88627049-.68131868.43033002 0 .73428873.24175582.91188524.72527472.17759652.48351891.26639345 1.16849374.26639345 2.05494506 0 .97436385-.09391983 1.68497945-.2817623 2.13186811-.18784247.4468887-.48326301.6703297-.88627049.6703297-.41666875 0-.71550456-.2435873-.89651639-.7307692-.18101184-.48718196-.2715164-1.17765125-.2715164-2.07142861z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.06521739-5.2359551v1.2359551h4.56521739v-1.2359551h-1.55606407v-6.7640449h-.83524028l-2.60869565 2.06741573.62929062.84269663 1.01830663-.68539326.54919909-.66292135-.17162472.76404495v4.4382022z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.3218527-9.92717087c0-.34360582-.0593818-.64425641-.1781472-.90196078-.1187655-.25770437-.28107581-.47245479-.4869359-.64425771-.2058601-.17180291-.45130499-.30252056-.73634205-.39215686-.28503705-.0896363-.59778135-.13445378-.93824228-.13445378-.53048563 0-.9916845.0728284-1.38361045.21848739-.39192595.145659-.74227874.33800068-1.05106888.57703082l.6175772 1.03081232c.182107-.15686353.40577856-.28571378.67102137-.38655462.26524282-.10084084.52454347-.1512605.77790974-.1512605.4038025 0 .69873225.09897193.8847981.29691876.18606586.19794684.27909739.45004516.27909739.75630252 0 .25396953-.05344365.5228744-.16033254.80672269-.1068889.2838483-.25138468.5770293-.43349169.87955182-.18210701.30252253-.38796401.60317311-.6175772.90196079-.22961318.29878767-.4651611.58823389-.70665083.86834734-.24148972.28011347-.48099643.54528357-.71852731.79551817-.23753088.2502347-.45130547.4687199-.64133017.6554622v.7507003h5v-1.232493h-2.28028504l-.85510688.1568627v-.0560224l.62945368-.4593837c.26128396-.291318.52850219-.61064254.80166271-.95798321.27316051-.34734067.52256419-.7077479.74821852-1.08123249.22565434-.37348459.4117174-.75443317.55819481-1.14285714.1464773-.38842398.2197149-.77310734.2197149-1.15406163z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-.55952381-5.232493c-.30952536 0-.58928446-.0298783-.83928571-.0896359-.25000125-.0597575-.47817358-.1381881-.68452381-.2352941l-.41666667 1.2100841c.23015988.1120453.53174417.1979455.9047619.257703.37301774.0597576.73412524.0896359 1.08333334.0896359.42063702 0 .81349024-.0522871 1.17857143-.1568627.36508119-.1045757.68452244-.2651717.95833333-.4817928.27381089-.216621.4880945-.4855259.6428571-.8067227.1547627-.3211967.2321429-.70214527.2321429-1.14285709 0-.35107552-.055555-.66106309-.1666667-.92997199-.1111116-.26890891-.2599197-.4948637-.44642854-.67787115-.18650887-.18300745-.40476065-.32306207-.6547619-.42016807-.25000125-.09710599-.5138875-.15686263-.79166667-.17927171l-.5.06722689v-.05602241l.52380952-.302521 1.67857139-2.11764706v-.79551821h-4.547619v1.232493h2l.94047619-.10084034-.67857143.50420168-1.44047619 1.8487395v.77310924h.85714285c.57936798 0 1.00396691.10083933 1.27380953.30252101s.4047619.51540403.4047619.94117647c0 .35107552-.12896696.64985874-.38690476.89635854s-.63293405.3697479-1.125.3697479z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.5-6.21276596v-1.18014184h-1.23595506v-4.6070922h-1.20224719l-3.56179775 4.94751773v.83971631h3.40449438v2.21276596h1.35955056v-2.21276596zm-2.59550562-2.91631205v1.73617021h-1.33707865l-.71910112.09078014.56179775-.43120567 1.16853933-1.5319149.38202247-.81702127h.04494382z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-.68181818-5.2885154c-.31100634 0-.57615521-.0205414-.79545455-.0616247s-.42065299-.0989725-.60406698-.1736694l-.41866029 1.210084c.2232866.097106.49640987.1736692.81937799.2296919s.6638738.0840336 1.02272727.0840336c.45454773 0 .87320383-.0560218 1.25598086-.1680672.38277704-.1120454.71570832-.280111.99880383-.5042017.28309552-.2240908.50438515-.5042.66387565-.8403361.1594904-.3361362.2392344-.72455433.2392344-1.16526615 0-.37348459-.059808-.71148308-.1794258-1.0140056-.1196179-.30252252-.2910675-.56022303-.5143541-.77310924-.22328661-.21288622-.49242267-.37908437-.80741627-.49859944s-.66786089-.18674129-1.05861244-.20168068l-.49043062.04481793v-1.51260504h2.77511963v-1.36694678h-4.11483255v4.10084034l.94497607-.03361345c.60606364 0 1.07256615.10457412 1.39952153.31372549.32695539.20915137.49043063.53781289.49043063.9859944 0 .41830274-.13955204.74696422-.41866029.98599442-.27910825.2390301-.68181555.3585434-1.20813397.3585434z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.5-6.53846154c0-.38095428-.0534183-.71794725-.1602564-1.01098901-.1068382-.29304176-.2564093-.54029203-.44871796-.74175824-.19230865-.20146621-.42378782-.35347934-.69444444-.45604396-.27065663-.10256461-.56623772-.15384615-.88675214-.15384615-.34188205 0-.62677949.06410192-.85470085.19230769-.22792137.12820577-.41310471.28388187-.55555556.46703297.06410288-.30769385.17628125-.60622566.33653846-.8956044.16025721-.28937873.3561242-.55128088.58760684-.78571428.23148264-.23443341.49679337-.4358966.79594017-.60439561.29914679-.16849901.62677885-.28205099.98290598-.34065934l-.30982906-1.13186813c-.51282307.08791253-.99892932.26556643-1.45833333.53296703-.45940401.26740061-.86182164.61904544-1.20726496 1.05494506-.34544332.43589961-.6196571.94688351-.82264957 1.53296703s-.30448718 1.24175462-.30448718 1.96703297c0 .4835189.06410192.90842307.19230769 1.27472531.12820577.3663022.30626667.6703284.53418804.9120879.22792136.2417594.49679332.4230763.80662393.543956s.64992692.1813187 1.02029914.1813187c.36324968 0 .69622356-.0659334.99893163-.1978022.30270806-.1318688.56089636-.3113542.77457265-.5384615.21367632-.2271074.37927292-.494504.49679482-.8021978.117522-.3076939.1762821-.64102388.1762821-1.00000004zm-1.34615385.07692308c0 .3663022-.10505593.66666546-.31517094.90109886s-.48254818.3516484-.81730769.3516484c-.20655374 0-.38461464-.0421241-.53418803-.1263736-.1495734-.0842495-.27243542-.1941386-.36858975-.3296704-.09615432-.1355318-.16915929-.2893764-.21901709-.46153843s-.07478633-.34615296-.07478633-.52197802c0-.05860835 0-.11721582 0-.17582417 0-.05860836.00712244-.12820473.02136753-.20879121.07834797-.17582506.21545486-.32966967.41132478-.46153846.19586993-.1318688.43625214-.1978022.72115385-.1978022.7834797 0 1.17521367.41025231 1.17521367 1.23076923z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.01219512-4h1.40798226l3.10421286-7.56571429v-.43428571h-5v1.39428571h2.84922395l.66518847-.11428571-.48780488.56z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-6.03296703c0 .30769383.05792169.58607933.17376682.83516483.11584512.2490855.28026799.4615376.49327354.6373626.21300555.1758251.4708505.3131864.7735426.412088.3026921.0989015.64088004.1483516 1.01457399.1483516s.71748722-.053113 1.03139014-.1593407c.31390291-.1062276.58295852-.2545778.80717488-.4450549.22421633-.1904771.39798143-.4194126.52130043-.6868132s.1849776-.5659324.1849776-.89560439c0-.4835189-.1139749-.87911934-.3419283-1.18681318-.22795326-.30769385-.56614121-.58974231-1.01457394-.84615385.38116782-.24908549.67077629-.52380802.86883404-.82417582.1980578-.30036781.2970852-.66666451.2970852-1.0989011 0-.27838967-.0541848-.53296588-.162556-.76373627-.1083713-.23077038-.26158348-.42673912-.45964127-.58791208-.19805779-.16117297-.43534989-.28571385-.71188341-.37362638s-.58295796-.13186813-.91928251-.13186813c-.36622007 0-.69506581.05128154-.98654708.15384615-.29148128.10256462-.53998403.24542033-.7455157.42857143s-.36248077.39926616-.47085202.64835165c-.10837124.2490855-.16255605.51648209-.16255605.8021978 0 .43956264.10463274.80769083.31390134 1.10439561.20926861.29670478.49700864.55860692.8632287.78571428-.19432085.10989066-.37555969.23076857-.54372197.36263737-.16816227.13186879-.31390073.28021895-.43721973.44505494s-.21860953.34798434-.28587444.54945055-.10089686.43040165-.10089686.68681319zm3.60986547-.14285715c0 .32234598-.10276429.56410178-.30829596.72527468-.20553167.161173-.47645572.2417583-.81278027.2417583-.36622007 0-.65209165-.1043946-.85762332-.3131868-.20553167-.2087923-.30829596-.4597055-.30829596-.75274727 0-.22710737.06539545-.45604281.19618834-.68681319.13079288-.23077039.37182186-.44505396.72309417-.64285714.16442533.08791252.32697976.1794867.48766816.27472527.16068839.09523857.30642685.19963313.43721973.31318681s.23729406.23992605.31950673.37912088c.08221266.13919484.12331838.29303945.12331838.46153846zm-2.02914798-3.76923077c0-.22710736.07660611-.42490758.22982063-.59340659.15321451-.16849901.39424349-.25274725.72309417-.25274725.26158576 0 .48393032.07875379.66704036.23626374.18311003.15750994.27466367.39010835.27466367.69780219 0 .44688868-.224213.85714099-.67264574 1.23076923-.15695145-.07326044-.30829523-.15201423-.45403587-.23626373-.14574064-.08424951-.27653156-.17582368-.39237668-.27472528-.11584513-.09890159-.20739877-.21428505-.27466368-.34615384s-.10089686-.28571341-.10089686-.46153847z\"/></svg>',\n            '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-9.43956044c0 .40293242.06532421.75274577.19597458 1.04945055s.3001402.54212357.50847457.73626374c.20833438.19414016.44491393.33882736.70974577.43406593.26483183.09523857.53142521.14285714.79978813.14285714.32486038 0 .58439169-.03662967.7786017-.10989011s.37605847-.20512725.54555084-.39560439c-.05649745.31501989-.153601.60988873-.29131356.88461538-.13771255.27472665-.31602997.52014544-.53495762.7362637-.21892765.2161183-.48022447.3974352-.78389831.5439561-.30367383.1465209-.64971557.245421-1.03813559.2967033l.29661017 1.1208791c.50847712-.0439563.99222934-.1758231 1.45127118-.3956044.45904185-.2197813.86334571-.536628 1.21292373-.9505494.34957802-.4139215.62853004-.93039988.83686441-1.5494506.2083344-.61905071.3125-1.3534756.3125-2.2032967 0-.94505967-.227752-1.66483269-.68326271-2.15934066-.45551075-.49450797-1.08227002-.74175824-1.88029661-.74175824-.38842002 0-.73269624.06410192-1.03283899.19230769-.30014274.12820577-.55437748.30402819-.76271186.52747253-.20833437.22344434-.36723109.49267242-.47669491.80769231-.10946383.31501989-.16419492.65933879-.16419492 1.03296703zm1.33474576-.07692308c0-.41025846.09533803-.73076807.28601695-.96153846.19067892-.23077038.45903782-.34615384.80508475-.34615384.21892765 0 .40783819.04578708.56673729.13736263s.28954751.21428495.39194915.36813187.17831896.32966934.22775424.52747253c.04943527.19780319.07415254.39926637.07415254.6043956 0 .13919484-.01059312.28571352-.03177966.43956044-.09887055.13919484-.24011208.25640978-.42372882.35164835-.18361673.09523858-.42019629.14285715-.70974576.14285715-.33898475 0-.6214678-.10622605-.84745763-.31868132-.22598983-.21245528-.33898305-.52747044-.33898305-.94505495z\"/></svg>'\n        ]\n    },\n    start: function() {\n        this.app.toolbar.add('icons', {\n            title: '## icons.icons ##',\n            icon: this.opts.icons.icon,\n            command: 'icons.popup',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        var icons = this.opts.icons.items;\n\n        for (var i = 0; i < icons.length; i++) {\n            items[i] = {\n                html: this.dom('<div>').addClass(this.prefix + '-popup-item').html(icons[i]),\n                command: 'icons.insert',\n                params: {\n                    icon: icons[i]\n                }\n            };\n        }\n\n        this.app.popup.create('icons', {\n            type: 'grid',\n            width: '160px',\n            items: items\n        });\n        this.app.popup.open({ button: button });\n\n    },\n    insert: function(params) {\n        this.app.popup.close();\n        this.app.insertion.insertHtml(params.icon, 'after');\n    }\n});","ArticleEditor.add('plugin', 'imageposition', {\n    translations: {\n        en: {\n            \"imageposition\": {\n                \"image-position\": \"Image position\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m15 13c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-13c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm-5-12c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .44771525 1 1 0 .5522847-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1 0-.55228475.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z\"/></svg>',\n        items: {\n            none: 'none',\n            left: 'float-left',\n            center: 'align-center',\n            right: 'float-right'\n        },\n        icons: {\n            none: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-5 7-1 1h2zm4-5h-6v5l2-2 3 3h1zm-2 1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z\"/></svg>',\n            left: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1s.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z\"/></svg>',\n            center: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm3 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1-1-.4477153-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1-1-.4477153-1-1 .44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm4 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm6-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z\"/></svg>',\n            right: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m14 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-11 8c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm-10 2c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1zm8-1c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-8-3c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z\"/></svg>'\n        }\n    },\n    start: function() {\n        this.app.toolbar.add('imageposition', {\n            title: '## imageposition.image-position ##',\n            command: 'imageposition.popup',\n            icon: this.opts.imageposition.icon,\n            blocks: {\n                types: ['image']\n            }\n        });\n    },\n    popup: function(params, button) {\n        var segments = {};\n        var obj = this.opts.imageposition.items;\n        for (var key in obj) {\n            if (!obj[key]) continue;\n            segments[key] = { name: obj[key], icon: this.opts.imageposition.icons[key] };\n        }\n\n        // create\n        this.app.popup.create('imageposition', {\n            setter: 'imageposition.setFloat',\n            getter: 'imageposition.getFloat',\n            form: {\n                \"ifloat\": {\n                    type: 'segment',\n                    label: '## imageposition.image-position ##',\n                    segments: segments\n                }\n            }\n        });\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    getFloat: function() {\n        var obj = this.opts.imageposition.items;\n        if (!obj) return false;\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var value = 'none';\n        for (var key in obj) {\n            if ($block.hasClass(obj[key])) {\n                value = key;\n            }\n        }\n\n        return { 'ifloat': value };\n    },\n    setFloat: function(popup) {\n        this.app.popup.close();\n\n        // get data\n        var data = popup.getData();\n        var instance = this.app.block.get();\n\n        instance.setClassFromObj(this.opts.imageposition.items, data.ifloat);\n    }\n});","ArticleEditor.add('plugin', 'imageresize', {\n    translations: {\n        en: {\n            \"imageresize\": {\n                \"image-resize\": \"Image resize\"\n            }\n        }\n    },\n    defaults: {\n        minHeight: 20,\n        minWidth: 100,\n        zIndex: 97\n    },\n    subscribe: {\n        'editor.blur, editor.select': function() {\n            this.stop();\n        },\n        'image.position': function() {\n            this._setResizerPosition();\n        },\n        'editor.unparse, editor.before.cut, editor.before.copy': function(event) {\n            this._unparse(event);\n        },\n        'block.set': function(event) {\n            this._load();\n        }\n    },\n    stop: function() {\n        this._remove();\n        this._stopEvents();\n    },\n\n    // private\n    _load: function() {\n        var block = this.app.block.get();\n\n        // remove resizer\n        this._remove();\n\n        if (block.isType('image')) {\n            this._build(block);\n        }\n    },\n    _build: function(block) {\n        this.$block = block.getBlock();\n        this.$image = block.getImage();\n\n        // create\n        this.$resizer = this.dom('<span>');\n        this.$resizer.attr('id', this.prefix + '-image-resizer');\n        this.$resizer.css({\n            'position': 'absolute',\n            'z-index': this.opts.imageresize.zIndex,\n            'background-color': '#007dff',\n            'width': '15px',\n            'height': '15px',\n            'border-radius': '8px',\n            'font-size': '0',\n            'border': '2px solid #fff',\n            'cursor': 'ew-resize'\n        });\n\n        this.$image.after(this.$resizer);\n        this._setResizerPosition();\n        setTimeout(this._setResizerPosition.bind(this), 30);\n\n        this.$resizer.on('mousedown touchstart', this._press.bind(this));\n    },\n    _setResizerPosition: function() {\n        var offsetFix = 9;\n        var pos = this.$image.position();\n        var width = this.$image.width();\n        var height = this.$image.height();\n        var resizerWidth =  this.$resizer.width();\n        var resizerHeight =  this.$resizer.height();\n\n        this.$resizer.css({\n            top: Math.round(pos.top + (height/2) - resizerHeight + offsetFix) + 'px',\n            left: Math.round(pos.left + width - resizerWidth + offsetFix) + 'px'\n        });\n    },\n    _press: function(e) {\n        e.preventDefault();\n\n        var h = this.$image.height();\n        var w = this.$image.width();\n\n        this.resizeHandle = {\n            x : e.pageX,\n            y : e.pageY,\n            el : this.$image,\n            $figure: this.$image.closest('figure'),\n            ratio: w / h,\n            h: h,\n            w: w\n        };\n\n        this.app.editor.getDoc().on('mousemove.' + this.prefix + '.image-resize touchmove.' + this.prefix + '.image-resize', this._move.bind(this));\n        this.app.editor.getDoc().on('mouseup.' + this.prefix + '.image-resize touchend.' + this.prefix + '.image-resize', this._release.bind(this));\n        this.app.$doc.on('mouseup.' + this.prefix + '.image-resize touchend.' + this.prefix + '.image-resize', this._release.bind(this));\n        this.app.broadcast('image.resize.start', { e: e, block: this.$block, image: this.$image });\n    },\n    _move: function(e) {\n        e.preventDefault();\n\n        var width = this._getWidth(e);\n        var height = width / this.resizeHandle.ratio;\n\n        var $el = this.resizeHandle.el;\n        var o = this.opts.imageresize;\n\n        height = Math.round(height);\n        width = Math.round(width);\n\n        if (height < o.minHeight || width < o.minWidth) return;\n        if (this._getResizableBoxWidth() <= width) return;\n\n        if (this.resizeHandle.$figure.length !== 0 && this.resizeHandle.$figure.css('max-width') !== '') {\n            this.resizeHandle.$figure.css('max-width', width + 'px');\n        }\n\n        $el.attr({ width: width, height: height });\n        //$el.width(width);\n        //$el.css('max-width', width + 'px');\n        //$el.height(height);\n\n        this._setResizerPosition();\n        this.app.broadcast('image.resize.move', { e: e, block: this.$block, image: this.$image });\n    },\n    _release: function(e) {\n        this._stopEvents();\n        this.app.broadcast('image.resize.stop', { e: e, block: this.$block, image: this.$image });\n    },\n    _stopEvents: function() {\n        this.app.editor.getDoc().off('.' + this.prefix + '.image-resize');\n        this.app.$doc.off('.' + this.prefix + '.image-resize');\n    },\n    _remove: function() {\n        this.app.editor.getLayout().find('#' + this.prefix + '-image-resizer').remove();\n    },\n    _getWidth: function(e) {\n        var width = this.resizeHandle.w;\n        if (e.targetTouches) {\n            width += (e.targetTouches[0].pageX -  this.resizeHandle.x);\n        }\n        else {\n            width += (e.pageX - this.resizeHandle.x);\n        }\n\n        return width;\n    },\n    _getResizableBoxWidth: function() {\n        var $el = this.app.editor.getLayout();\n        var width = $el.width();\n        return width - parseInt($el.css('padding-left')) - parseInt($el.css('padding-right'));\n    },\n    _unparse: function(event) {\n        var html = event.get('html');\n\n        html = this.app.utils.wrap(html, function($w) {\n            $w.find('#' + this.prefix + '-image-resizer').remove();\n        }.bind(this));\n\n        event.set('html', html);\n    }\n});","ArticleEditor.add('plugin', 'inlineformat', {\n    translations: {\n        en: {\n            \"inlineformat\": {\n                \"inline-format\": \"Inline Format\",\n                \"underline\": \"Underline\",\n                \"superscript\": \"Superscript\",\n                \"subscript\": \"Subscript\",\n                \"mark\": \"Mark\",\n                \"code\": \"Code\",\n                \"shortcut\": \"Shortcut\",\n                \"remove-format\": \"Remove Format\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m7.39849577 1.20113038c-3.5610278 2.68125517-5.39849577 5.14152807-5.39849577 7.49360646 0 3.50902886 2.59345039 6.30526316 6 6.30526316 3.4065496 0 6-2.7962343 6-6.30526316 0-2.35207839-1.837468-4.81235129-5.39849577-7.49360646-.35616697-.26817384-.84684149-.26817384-1.20300846 0zm.60150423 2.06186962.28200813.22720401c2.50634097 2.04313256 3.71799187 3.80538426 3.71799187 5.20453283 0 2.43669386-1.73306 4.30526316-4 4.30526316-2.26694005 0-4-1.8685693-4-4.30526316 0-1.39914857 1.21165095-3.16140027 3.71799187-5.20453283z\"/></svg>',\n        items: ['u', 'sup', 'sub', 'mark', 'code', 'kbd'],\n        itemsObj: {\n            u: {\n                title: '<span style=\"text-decoration: underline;\">## inlineformat.underline ##</span>',\n                params: { tag: 'u' },\n                shortcut: 'Ctrl+u'\n            },\n            sup: {\n                title: '## inlineformat.superscript ##<sup>x</sup>',\n                params: { tag: 'sup' },\n                shortcut: 'Ctrl+h'\n            },\n            sub: {\n                title: '## inlineformat.subscript ##<sub>x</sub>',\n                params: { tag: 'sub' },\n                shortcut: 'Ctrl+l'\n            },\n            mark: {\n                title: '<span style=\"background: yellow;\">## inlineformat.mark ##</span>',\n                params: { tag: 'mark' }\n            },\n            code: {\n                title: '<span style=\"font-family: monospace; background: #f0f1f2; padding: 4px;\">## inlineformat.code ##</span>',\n                params: { tag: 'code' }\n            },\n            kbd: {\n                title: '## inlineformat.shortcut ##',\n                params: { tag: 'kbd' }\n            }\n        }\n    },\n    start: function() {\n        this.app.toolbar.add('inlineformat', {\n            title: '## inlineformat.inline-format ##',\n            icon: this.opts.inlineformat.icon,\n            position: { after: 'deleted' },\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            },\n            command: 'inlineformat.popup'\n        });\n    },\n    popup: function(params, button) {\n        var arr = this.opts.inlineformat.items;\n        var inlines = this.app.selection.getNodes({ type: 'inline' });\n        var items = {};\n        for (var i = 0; i < arr.length; i++) {\n            var key = arr[i];\n            items[key] = this.opts.inlineformat.itemsObj[key];\n            items[key].command = 'inline.set'\n        }\n\n        // remove format\n        if (inlines.length !== 0) {\n            items['remove'] = {\n                title: '## inlineformat.remove-format ##',\n                divider: 'top',\n                command: 'inline.removeFormat'\n            };\n        }\n\n        this.app.popup.create('inlineformat', {\n            width: '300px',\n            items: items\n        });\n        this.app.popup.open({ button: button });\n    }\n});","ArticleEditor.add('plugin', 'makebutton', {\n    translations: {\n        en: {\n            \"makebutton\": {\n                \"make-a-button\": \"Make a Button\",\n                \"remove-button\": \"Remove button\",\n                \"button\": \"Button\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m13 3c1.6568542 0 3 1.34314575 3 3v4c0 1.6568542-1.3431458 3-3 3h-10c-1.65685425 0-3-1.3431458-3-3v-4c0-1.65685425 1.34314575-3 3-3zm0 2h-10c-.55228475 0-1 .44771525-1 1v4c0 .5522847.44771525 1 1 1h10c.5522847 0 1-.4477153 1-1v-4c0-.55228475-.4477153-1-1-1zm-8 2h6c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-6c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z\"/></svg>',\n        items: false\n    },\n    start: function() {\n        if (this.opts.makebutton.items === false) return;\n\n        this.app.toolbar.add('makebutton', {\n            title: '## makebutton.make-a-button ##',\n            icon: this.opts.makebutton.icon,\n            command: 'makebutton.toggle',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            },\n            active: {\n                tags: ['a']\n            },\n            position: { after: 'link' }\n        });\n    },\n    toggle: function(params, button) {\n        var obj = this.opts.makebutton.items;\n        var items = {};\n        for (var key in obj) {\n            items[key] = obj[key];\n            items[key].command = 'makebutton.set'\n        }\n\n        // remove\n        items['remove'] = {\n            title: '## makebutton.remove-button ##',\n            divider: 'top',\n            command: 'makebutton.remove'\n        };\n\n        this.app.popup.create('makebutton', { items: items });\n        this.app.popup.open({ button: button });\n    },\n    set: function(params, item, name) {\n        this.app.popup.close();\n\n        var obj = this.opts.makebutton.items[name];\n        var $link = this.app.link.getLink();\n\n        if ($link.length === 0) {\n            var nodes = this.app.inline.set({ tag: 'a', caret: 'after' });\n            $link = this.dom(nodes[0]);\n            $link.attr('href', '#');\n            $link.text(this.lang.get('makebutton.button'));\n        }\n\n        this._removeClasses($link);\n        $link.addClass(obj.params.classname);\n    },\n    remove: function() {\n        this.app.popup.close();\n\n        var $link = this.app.link.getLink();\n        this._removeClasses($link);\n    },\n\n    // private\n    _getClasses: function() {\n        var classes = [];\n        var obj = this.opts.makebutton.items;\n\n        for (var key in obj) {\n            classes.push(obj[key].params.classname);\n        }\n\n        return classes;\n    },\n    _removeClasses: function($link) {\n        var classes = this._getClasses();\n        for (var i = 0; i < classes.length; i++) {\n            $link.removeClass(classes[i]);\n        }\n    }\n});","// Icon\nArticleEditor.iconMath = '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m11 2c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-3.92l2.70086881 3.37530495c.26561359.33201696.28976029.79108692.07244006 1.14620443l-.07244006.10318567-2.70186881 3.37530495h3.921c.5128358 0 .9355072.3860402.9932723.8833789l.0067277.1166211c0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-6c-.80039229 0-1.26153081-.8837601-.84621928-1.5335763l.06535047-.0911187 3.49986881-4.375305-3.49986881-4.37530495c-.5000011-.62500138-.09797137-1.53717061.66889291-1.61880377l.1119759-.00589128z\"/></svg>';\n\n// Block\nArticleEditor.add('block', 'block.math', {\n    mixins: ['block'],\n    type: 'math',\n    inline: true,\n    editable: false,\n    control: false,\n    toolbar: {\n        add: { command: 'addbar.popup', title: '## buttons.add ##' },\n        tags: { command: 'math.edit', title: '## math.math ##', icon: ArticleEditor.iconMath }\n    },\n    create: function() {\n        return this.dom('<span>').addClass('math');\n    }\n});\n\n// Plugin\nArticleEditor.add('plugin', 'math', {\n    translations: {\n        en: {\n            \"math\": {\n                \"math\": \"Math\",\n                \"label\": \"Type an expression\",\n                \"add\": \"Add\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\"\n            },\n             \"blocks\": {\n                 \"math\": \"Math\"\n             }\n        }\n    },\n    defaults: {\n        classname: 'math',\n        mathjax: false,\n        delimiters: [\n            { left: \"$$\", right: \"$$\", display: true },\n            //{ left: \"$\", right: \"$\", display: false },\n            { left: \"\\\\(\", right: \"\\\\)\", display: false },\n            { left: \"\\\\[\", right: \"\\\\]\", display: true }\n        ]\n    },\n    popups: {\n        add: {\n            title: '## math.math ##',\n            width: '100%',\n            form: {\n                text: { label: '## math.label ##', type: 'textarea', rows: 6 }\n            },\n            footer: {\n                insert: { title: '## math.add ##', command: 'math.insert', type: 'primary' },\n                cancel: { title: '## math.cancel ##', command: 'popup.close' }\n            }\n        },\n        edit: {\n            title: '## math.math ##',\n            width: '100%',\n            form: {\n                text: { label: '## math.label ##', type: 'textarea', rows: 6 }\n            },\n            footer: {\n                save: { title: '## math.save ##', command: 'math.save', type: 'primary' },\n                cancel: { title: '## math.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    subscribe: {\n        'editor.parse': function(event) {\n            this._parse(event);\n        },\n        'editor.unparse, editor.before.cut, editor.before.copy': function(event) {\n            this._unparse(event);\n        },\n        'editor.ready, source.close, state.undo, state.redo, editor.paste': function() {\n            this._render();\n        }\n    },\n    start: function() {\n        this.app.addbar.add('math', {\n            title: '## blocks.math ##',\n            icon: ArticleEditor.iconMath,\n            command: 'math.popup'\n        });\n    },\n    popup: function() {\n        var stack = this.app.popup.add('math', this.popups.add);\n        stack.open({ focus: 'text' });\n    },\n    edit: function(params, button) {\n        var stack = this.app.popup.create('math', this.popups.edit);\n\n        // data\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var code = decodeURI($block.attr('data-math-code'));\n        code = this._decodeSigns(code);\n\n        // set\n        stack.setData({ text: code });\n\n        // open\n        this.app.popup.open({ button: button, focus: 'text' });\n    },\n    save: function(stack) {\n        this.app.popup.close();\n\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        var code = this._buildBlock($block, stack);\n\n        if (code !== false) {\n            this._renderDisplay($block);\n            this._renderTypeset($block, code);\n        }\n    },\n    insert: function(stack) {\n        this.app.popup.close();\n\n        // create\n        var instance = this.app.create('block.math');\n        var $block = instance.getBlock();\n        var code = this._buildBlock($block, stack);\n\n        if (code !== false) {\n            this.app.block.add({ instance: instance });\n\n            this._renderDisplay($block);\n            this._renderTypeset($block, code);\n        }\n    },\n\n    // private\n    _buildBlock: function($block, stack) {\n        var data = stack.getData();\n        var code = data.text.trim();\n\n        var delim = this._parseDelim(code);\n        if (!delim) {\n            return false;\n        }\n\n        $block.attr('data-math-display', delim.display);\n        $block.attr('data-math-code', encodeURI(code));\n\n        // katex\n        if (!this.opts.math.mathjax) {\n            code = code.replace(delim.left, '').replace(delim.right, '');\n        }\n\n        $block.html(code);\n\n        return code;\n    },\n    _renderTypeset: function($block, code) {\n        if (this.opts.math.mathjax) {\n            // mathjax\n            this._getMathJax().typeset();\n        }\n        else {\n            // katex\n            this._renderNode($block, code);\n        }\n    },\n    _renderDisplay: function($node) {\n        var display = $node.attr('data-math-display');\n        var obj = { display: 'inline-block', 'text-align': '' };\n        if (display) {\n            obj = { display: 'block', 'text-align': 'center' };\n            $node.addClass('math-display');\n        }\n        else {\n            $node.removeClass('math-display');\n        }\n\n        $node.css(obj);\n    },\n    _renderNode: function($node, code) {\n        this._getKatex().render(code, $node.get(), { displayMode: $node.attr('data-math-display') });\n    },\n    _render: function() {\n        // mathjax\n        if (this.opts.math.mathjax) {\n            this._getMathJax().typeset();\n        }\n\n\n        this.app.editor.getBody().find('.' + this.opts.math.classname).each(function($node) {\n            this._renderDisplay($node);\n\n            // katex\n            if (!this.opts.math.mathjax) {\n                if ($node.attr('data-math-render')) return;\n                this._renderNode($node, $node.text());\n                $node.attr('data-math-render', true);\n            }\n        }.bind(this));\n    },\n    _parseDelim: function(code) {\n        var delim = this.opts.math.delimiters;\n        for (var i = 0; i < delim.length; i++) {\n            var re = new RegExp('^' + this.app.utils.escapeRegExp(delim[i].left));\n            if (code.search(re) !== -1) {\n                return delim[i];\n            }\n        }\n    },\n    _getMathJax: function() {\n        return this.app.editor.getWinNode().MathJax;\n    },\n    _getKatex: function() {\n        return this.app.editor.getWinNode().katex;\n    },\n    _getReplacer: function(code, datacode, display) {\n        var start = '<span class=' + this.opts.math.classname + ' data-' + this.prefix + '-type=\"math\" data-math-code=\"' + datacode + '\" data-math-display=\"' + display + '\">';\n        var end = '</span>';\n\n        return start + code + end;\n    },\n    _encodeSigns: function(code) {\n        code = code.replace(/\\$\\$/g, 'xdoubledollarsignz');\n        code = code.replace(/\\$/g, 'xsingledollarsignz');\n\n        return code;\n    },\n    _decodeSigns: function(code) {\n        code = code.replace(/xdoubledollarsignz/g, \"$$$\");\n        code = code.replace(/xsingledollarsignz/g, \"$\");\n\n        return code;\n    },\n    _parse: function(event) {\n        var html = event.get('html');\n        var delim = this.opts.math.delimiters;\n\n        for (var i = 0; i < delim.length; i++) {\n            var rcont = (delim[i].display) ? '([\\\\w\\\\W]*?)' : '(.*?)';\n            var re = new RegExp(this.app.utils.escapeRegExp(delim[i].left) + rcont + this.app.utils.escapeRegExp(delim[i].right), 'g');\n            var match = html.match(re);\n            if (match != null) {\n                for (var z = 0; z < match.length; z++) {\n                    // code\n                    var code = match[z].trim();\n                    var datacode = this._encodeSigns(code)\n                    datacode = encodeURI(datacode);\n\n                    // katex\n                    if (!this.opts.math.mathjax) {\n                        code = code.replace(delim[i].left, '').replace(delim[i].right, '');\n                    }\n\n                    // replace\n                    html = html.replace(match[z], this._getReplacer(code, datacode, delim[i].display));\n                }\n            }\n        }\n\n        event.set('html', html);\n    },\n    _unparse: function(event) {\n        var html = event.get('html');\n\n        html = this.app.utils.wrap(html, function($w) {\n            $w.find('.' + this.opts.math.classname).each(function($node) {\n                var code = decodeURI($node.attr('data-math-code'));\n                code = this._decodeSigns(code);\n                code = code.replace(/&/g, 'xampsignmathz');\n                $node.text(code);\n                $node.unwrap();\n            }.bind(this));\n        }.bind(this));\n\n        html = html.replace(/xampsignmathz/g, '&');\n\n        event.set('html', html);\n    },\n    _copy: function(event) {\n        var html = event.get('html');\n\n        event.set('html', html);\n    }\n});","ArticleEditor.add('plugin', 'print', {\n    translations: {\n        en: {\n            \"print\": {\n                \"print\": \"Print\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10.125 1c.9760221 0 1.7936348.73390752 1.8692894 1.6885462l.0057106.14478713v3.16666667h1.0714286c.9927325 0 1.8438171.72087115 1.9226216 1.68668386l.0059498.14664947v3.33333337c0 .989117-.8038115 1.757089-1.7808027 1.8279863l-.1477687.005347h-1.0714286v.25c0 .9538999-.7859079 1.674765-1.7254643 1.7444667l-.1495357.0055333h-5.25c-1.00418792 0-1.875-.7458949-1.875-1.75v-.25h-1.07142857c-.99273257 0-1.8438171-.7208712-1.92262167-1.6866839l-.00594976-.1466494v-3.33333337c0-.98911703.80381155-1.757089 1.78080273-1.82798629l.1477687-.00534704h1.07142857v-3.16666667c0-.97542885.77113545-1.75578536 1.7298577-1.82789317l.1451423-.00544016zm-.125 11h-5v1h5zm3-4h-11v3l1.17735638-.0000851c.30466973-.6036661.96572942-.9999149 1.69764362-.9999149h5.25c.7319142 0 1.3929739.3962488 1.6976436.9999149l1.1773564.0000851zm-3-5h-5v3h5z\"/></svg>'\n    },\n    start: function() {\n        this.app.editor.addButton('print', {\n            title: '## print.print ##',\n            icon: this.opts.print.icon,\n            command: 'print.toggle',\n            position: {\n                'before': 'html'\n            }\n        });\n    },\n    toggle: function() {\n        this.app.editor.getWinNode().print();\n    }\n});","ArticleEditor.add('plugin', 'removeformat', {\n    translations: {\n        en: {\n            \"removeformat\": {\n                \"removeformat\": \"Remove Format\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 11c.51283584 0 .93550716.3860402.99327227.8833789l.00672773.1166211v1c0 .5522847-.44771525 1-1 1-.51283584 0-.93550716-.3860402-.99327227-.8833789l-.00672773-.1166211v-1c0-.5522847.44771525-1 1-1zm-4.60436072-5.91850958.10436072.05248418 9.5262794 5.5c.4782927.2761424.6421678.8877328.3660254 1.3660254-.2564179.4441289-.8020741.6171529-1.2616646.4185096l-.1043608-.0524842-9.5262794-5.5c-.47829262-.27614237-.64216778-.88773278-.3660254-1.3660254.25641792-.44412886.80207419-.61715287 1.26166468-.41850958zm9.60436072-3.08149042c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4.00016698l.00016698 2c0 .55228475-.44771525 1-1 1-.51283584 0-.93550716-.38604019-.99327227-.88337887l-.00672773-.11662113-.00016698-2h-3.99983302c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/></svg>'\n    },\n    start: function() {\n        var button = {\n            title: '## removeformat.removeformat ##',\n            icon: this.opts.removeformat.icon,\n            command: 'inline.removeFormat',\n            position: {\n                after: ['deleted', 'italic']\n            },\n            blocks: {\n                all: 'editable'\n            }\n        };\n\n        this.app.toolbar.add('removeformat', button);\n    }\n});","ArticleEditor.add('plugin', 'reorder', {\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"#000\" fill-rule=\"nonzero\"><path d=\"m13 5c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-10c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/><path d=\"m13 9c.5522847 0 1 .44771525 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-10c-.55228475 0-1-.4477153-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z\"/></g></svg>'\n    },\n    subscribe: {\n        'block.set': function() {\n            this._observe();\n        }\n    },\n    init: function() {},\n    start: function() {\n        this.app.control.add('reorder', {\n            icon: this.opts.reorder.icon,\n            position: 'first',\n            blocks: {\n                'all': 'first-level'\n            }\n        });\n    },\n    stop: function() {\n        this._stopEvents();\n    },\n\n    // private\n    _observe: function() {\n        this.$btn = this.app.control.get('reorder');\n        if (this.$btn.length === 0) return;\n        this.$btn.addClass(this.prefix + '-handle');\n\n        this._sortable();\n    },\n    _sortable: function() {\n        this.instance = this.app.block.get();\n\n        this.$win = this.app.editor.getWin();\n        this.tolerance = this.$btn.width();\n        this.$clickItem = null;\n        this.$dragItem  = null;\n        this.oldY = 0;\n        this.dragging = false;\n\n        this.$btn.on('mousedown.' + this.prefix + '-reorder touchstart.' + this.prefix + '-reorder', this._press.bind(this));\n    },\n    _press: function(e) {\n        var $target = this.dom(e.target).closest('.' + this.prefix + '-button');\n        if (e && e.target && $target.hasClass(this.prefix + '-handle')) {\n            e.preventDefault();\n            this.app.observer.trigger = false;\n\n            this.$win.on('mouseup.' + this.prefix + '-reorder touchend.' + this.prefix + '-reorder', this._release.bind(this));\n            this.$win.on('mousemove.' + this.prefix + '-reorder touchmove.' + this.prefix + '-reorder', this._move.bind(this));\n\n            var item = this.instance.getBlock().get();\n            this.app.block.unset();\n\n            this.dragging = true;\n            this.$dragItem = this._makeDragItem(item, e.target);\n        }\n    },\n    _release: function(e) {\n        this._stopEvents();\n\n        this.app.observer.trigger = true;\n        this.oldY = 0;\n        this.dragging = false;\n        this._trashDragItem();\n        this.app.block.set(this.instance);\n    },\n    _move: function(e) {\n        if (!this.$dragItem && !this.dragging) {\n            return;\n        }\n\n        e.preventDefault();\n\n        var framePos = this.app.editor.getFrameRect();\n\n        // direction & delta\n        var direction = false;\n        var deltaY = (this.oldY === 0) ? 0 : this.oldY - e.pageY;\n        if (deltaY > 0) {\n            direction = 'up';\n        } else if (deltaY < 0) {\n            direction = 'down';\n        }\n\n        // env\n        var tolerance = 40;\n        var isScrollTarget = this.app.scroll.isTarget();\n        var isFrameScroll = this._isFrameScroll();\n        var docScrollTop = this.app.$doc.scrollTop();\n        var $target = (isScrollTarget) ? this.app.scroll.getTarget() : this.app.$doc;\n        var scrollTop = (isFrameScroll) ? this.app.editor.getDoc().scrollTop() : $target.scrollTop();\n\n        // move\n        this._moveItem(this.$dragItem, deltaY);\n        this.oldY = e.pageY;\n\n        // autoscroll\n        var end, startStop = false;\n        if (isScrollTarget) {\n            end = $target.height() + $target.offset().top - tolerance;\n        }\n        else if (isFrameScroll) {\n            end = framePos.bottom - tolerance;\n            endWin = this.app.$win.height() + docScrollTop - tolerance;\n            if (endWin < end) {\n                end = endWin;\n            }\n        }\n        else {\n            startStop = !this.app.toolbar.isSticky();\n            end = this.app.$win.height() + scrollTop - tolerance;\n        }\n\n        var $toolbar = this.app.container.get('bars');\n        var toolbarHeight = $toolbar.height();\n        var scrollPoint = (isFrameScroll) ? e.pageY + framePos.top - scrollTop : e.pageY + framePos.top;\n        var start = $toolbar.offset().top + toolbarHeight + tolerance;\n\n        // scroll up\n        if (direction === 'up' && scrollTop > 0 && scrollPoint < start && startStop === false) {\n            this._scroll(-10);\n        }\n\n        // scroll down\n        else if (direction === 'down' && scrollPoint > end) {\n            this._scroll(10);\n        }\n\n\n        // place\n        var $elms = this.app.editor.getLayout().children();\n        var len = $elms.length;\n        for (var b = 0; b < len; b++) {\n            var subItem = $elms.eq(b).get();\n\n            if (subItem === this.$clickItem.get()) {\n                continue;\n            }\n\n            if (this._isOver(this.dom(subItem))) {\n                this._swapItems(subItem);\n            }\n        }\n    },\n    _scroll: function(step) {\n        var $target = (this.app.scroll.isTarget()) ? this.app.scroll.getTarget() : this.app.$win;\n        var isFrameScroll = this._isFrameScroll();\n        if (isFrameScroll) {\n            $target = this.app.editor.getWin();\n        }\n\n        var scrollY = $target.scrollTop();\n        $target.scrollTop(scrollY + step);\n    },\n    _swapItems: function(target) {\n\n        var y = this.$dragItem.offset().top;\n        var $item = this.$clickItem;\n        var $target = this.dom(target);\n\n        var offset = $target.offset();\n        var height = $target.height()/2;\n        var func = (height + offset.top > y) ? 'before' : 'after';\n\n        $target[func]($item);\n    },\n    _stopEvents: function() {\n        if (this.$win) {\n            this.$btn.off('.' + this.prefix + '-reorder');\n            this.$win.off('.' + this.prefix + '-reorder');\n        }\n    },\n    _isFrameScroll: function() {\n        var frameHeight = this.app.editor.getFrame().height();\n        var bodyHeight =  this.app.editor.getBody().height();\n\n        return (bodyHeight > frameHeight);\n    },\n    _isOver: function($target) {\n\n        var y = this.$dragItem.offset().top;\n        var offset = $target.offset();\n        var height = $target.height();\n\n        return (y > offset.top && y < (offset.top + height));\n    },\n    _moveItem: function($item, deltaY) {\n        var top = $item.offset().top;\n        top -= deltaY;\n\n        $item.css('top', top + 'px');\n    },\n    _makeDragItem: function(item) {\n        this._trashDragItem();\n\n        var $item = this.dom(item);\n        var offset = $item.offset();\n\n        this.$clickItem = $item;\n        this.$clickItem.addClass(this.prefix + '-drag-active');\n\n        var $cloned = $item.clone();\n        $cloned.removeClass(this.prefix + '-drag-active ' + this.prefix + '-element-active');\n\n        var $dragItem = this.dom('<div>').addClass(this.prefix + '-dragging');\n        $dragItem.append($cloned);\n        $dragItem.css({\n            'opacity': 0.95,\n            'position': 'absolute',\n            'z-index': 999,\n            'left': offset.left + 'px',\n            'top': offset.top + 'px',\n            'width': $item.width() + 'px'\n        });\n\n        this.app.editor.getBody().append($dragItem);\n\n        return $dragItem;\n    },\n    _trashDragItem: function() {\n        if (this.$dragItem && this.$clickItem) {\n            this.$clickItem.removeClass(this.prefix + '-drag-active');\n            this.$clickItem = null;\n\n            this.$dragItem.remove();\n            this.$dragItem = null;\n        }\n    }\n});","ArticleEditor.add('plugin', 'selector', {\n    translations: {\n        en: {\n            \"selector\": {\n                \"selector\": \"Selector\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m10.6663083 2.14369002c.5071647.07664087.8669828.53941479.8491564 1.06286535l-.0109223.12172524-.2435424 1.67154209 1.239.0001773c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773-1.531-.0001773-.291 2 1.322.0001773c.5522847 0 1 .44771525 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277-1.613-.0001773-.3121956 2.1487091c-.08323349.571695-.59347185.9682364-1.13964926.8857001-.50716474-.0766409-.86698283-.5394148-.84915642-1.0628653l.01092235-.1217253.26807893-1.8498186h-1.978l-.31219557 2.1487091c-.08323352.571695-.59347188.9682364-1.13964929.8857001-.50716474-.0766409-.86698283-.5394148-.84915642-1.0628653l.01092235-.1217253.26807893-1.8498186-1.365.0001773c-.55228475 0-1-.4477153-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 1.656-.0001773.292-2-1.448.0001773c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 1.739-.0001773.28765901-1.97043255c.08323352-.571695.59347189-.96823646 1.1396493-.88570013.50716473.07664087.86698282.53941479.84915642 1.06286535l-.01092236.12172524-.24354237 1.67154209h1.978l.28765901-1.97043255c.08323352-.571695.59347189-.96823646 1.13964929-.88570013zm-2.0103083 6.85613268.292-2h-1.979l-.291 2z\"/></svg>',\n        popup: {\n            title: '## selector.selector ##',\n            width: '100%',\n            form: {\n                id: { type: 'input', label: 'ID'},\n                classname: { type: 'input', label: 'Class' }\n            },\n            footer: {\n                insert: { title: '## selector.save ##', command: 'selector.save', type: 'primary' },\n                cancel: { title: '## selector.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    init: function() {\n        this.arxclasses = [];\n    },\n    start: function() {\n        this.app.toolbar.add('selector', {\n            title: '## selector.selector ##',\n            icon: this.opts.selector.icon,\n            blocks: {\n                all: 'all',\n                except: ['variable']\n            },\n            command: 'selector.popup'\n        });\n    },\n    popup: function(params, button) {\n\n        // create\n        var stack = this.app.popup.create('selector', this.opts.selector.popup);\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var classname = $block.attr('class');\n        var id = $block.attr('id');\n\n        // classes\n        var classes = classname.split(' ');\n        var classname = '';\n        for (var i = 0; i < classes.length; i++) {\n            if (classes[i].search(this.prefix + '-') === -1) {\n                classname += classes[i] + ' ';\n            }\n            else {\n                this.arxclasses.push(classes[i]);\n            }\n        }\n\n        // data\n        stack.setData({\n            id: id,\n            classname: classname.trim()\n        });\n\n        // open\n        this.app.popup.open({ button: button, focus: 'id' });\n    },\n    save: function(stack) {\n        this.app.popup.close();\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var data = stack.getData();\n\n        // set id\n        if (data.id === '') {\n            $block.removeAttr('id');\n        }\n        else {\n            $block.attr('id', data.id);\n        }\n\n        // set class\n        if (this.arxclasses.length > 0) {\n            data.classname = data.classname + ' ' + this.arxclasses.join(' ');\n        }\n\n        $block.attr('class', data.classname);\n        this.arxclasses = [];\n    }\n});","ArticleEditor.add('plugin', 'slideshow', {\n    translations: {\n        en: {\n             \"slideshow\": {\n                 \"slideshow\": \"Slideshow\",\n                 \"save\": \"Save\",\n                 \"cancel\": \"Cancel\",\n                 \"insert\": \"Insert\"\n             }\n        }\n    },\n    defaults: {\n        upload: false,\n        select: false,\n        name: 'file',\n        data: false,\n        multiple: true\n    },\n    popups: {\n        add: {\n            title: '## slideshow.slideshow ##',\n            width: '100%',\n            footer: {\n                insert: { title: '## slideshow.insert ##', command: 'slideshow.insert', type: 'primary' },\n                cancel: { title: '## slideshow.cancel ##', command: 'popup.close' }\n            }\n        },\n        edit: {\n            title: '## slideshow.slideshow ##',\n            width: '100%',\n            footer: {\n                save: { title: '## slideshow.save ##', command: 'slideshow.save', type: 'primary' },\n                cancel: { title: '## slideshow.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    start: function() {\n        this.app.addbar.add('slideshow', {\n            title: '## slideshow.slideshow ##',\n            icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z\"/></svg>',\n            command: 'slideshow.popup'\n        });\n    },\n    popup: function() {\n        // create\n        var stack = this.app.popup.add('slideshow', this.popups.add);\n\n        // body\n        var $body = stack.getBody();\n\n        // box\n        this.$box = this.dom('<div>').addClass(this.prefix + '-slideshow-items');\n        $body.append(this.$box);\n\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.slideshow.upload, $body);\n\n        // select box\n        this.app.image.createSelectBox(this.opts.slideshow.select, $body, 'slideshow.insertFromSelect');\n\n        // open\n        stack.open();\n\n        // build upload\n        this._buildUpload(this.$upload, 'slideshow.insertByUpload');\n    },\n    edit: function(params, button) {\n        // create\n        var stack = this.app.popup.create('slideshow', this.popups.edit);\n\n        // body\n        var $body = stack.getBody();\n\n        // data\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        var $elms = $block.find('img');\n\n        // box\n        this.$box = this.dom('<div>').addClass(this.prefix + '-slideshow-items');\n        $body.append(this.$box);\n\n        // items\n        $elms.each(function($node) {\n            this._buildBoxItem($node.attr('src'));\n        }.bind(this));\n\n        // upload\n        this.$upload = this.app.image.createUploadBox(this.opts.slideshow.upload, $body);\n\n        // select box\n        this.app.image.createSelectBox(this.opts.slideshow.select, $body, 'slideshow.insertFromSelect');\n\n        // open\n        this.app.popup.open({ button: button });\n\n        // build upload\n        this._buildUpload(this.$upload, 'slideshow.insertByUpload');\n    },\n    insertByUpload: function(response) {\n        for (var key in response) {\n            this._buildBoxItem(response[key].url);\n        }\n    },\n    insertFromSelect: function(e) {\n        e.preventDefault();\n\n        var $target = this.dom(e.target);\n        this._buildBoxItem($target.attr('data-url'));\n    },\n    insert: function() {\n        // instance\n        var instance = this.app.create('block.uk-slideshow');\n        this.app.block.add({ instance: instance });\n\n        // save\n        this.save();\n    },\n    save: function() {\n        var current = this.app.block.get();\n        var $elms = this.$box.find('img');\n\n        if ($elms.length === 0) {\n            current.remove();\n              this.app.popup.close();\n            return;\n        }\n\n        var $block = current.getBlock();\n        var $inner = $block.find('.uk-slideshow-items');\n        $inner.html('');\n\n        $elms.each(function($node, i) {\n            var src = $node.attr('src');\n\n            var $item = this.dom('<li>');\n            var $img = this.dom('<img>').attr({ 'src': src, 'uk-cover': true });\n\n            $item.append($img);\n            $inner.append($item);\n\n        }.bind(this));\n\n        // close popup\n        this.app.popup.close();\n    },\n\n    // private\n    _removeItem: function(e) {\n        var $target = this.dom(e.target).closest('.' + this.prefix + '-slideshow-item');\n        $target.fadeOut(function($node) {\n            $node.remove();\n        }.bind(this));\n    },\n    _buildBoxItem: function(src) {\n        var $item = this.dom('<span>').addClass(this.prefix + '-slideshow-item');\n        var $remover = this.dom('<span>').addClass(this.prefix + '-upload-remove');\n        var $img = this.dom('<img>').attr('src', src);\n\n        $remover.one('click', this._removeItem.bind(this));\n\n        $item.append($img);\n        $item.append($remover);\n        this.$box.append($item);\n    },\n    _buildUpload: function($item, callback) {\n        if (!this.opts.slideshow.upload) return;\n\n        var params = {\n            box: true,\n            placeholder: this.lang.get('image.upload-new-placeholder'),\n            url: this.opts.slideshow.upload,\n            name: this.opts.slideshow.name,\n            data: this.opts.slideshow.data,\n            multiple: this.opts.slideshow.multiple,\n            success: callback,\n            error: 'image.error'\n        };\n\n        this.app.create('upload', $item, params);\n    }\n});","ArticleEditor.add('plugin', 'specialchars', {\n    translations: {\n        en: {\n            \"specialchars\": {\n                \"special-chars\": \"Special Characters\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m2 14v-1.8348348h2.38016529v-.0780781c-.99173554-.975976-2.10247934-2.67417419-2.10247934-4.99699701 0-3.57207207 2.28099174-6.09009009 5.73223141-6.09009009 3.43140494 0 5.71239664 2.51801802 5.71239664 6.09009009 0 2.32282282-1.1107438 4.02102101-2.1024793 4.99699701v.0780781h2.3801653v1.8348348h-4.95867769v-1.6396396c1.40826449-1.1906907 2.32066119-2.75225229 2.32066119-5.07507511 0-2.4984985-1.2495868-4.31381382-3.35206614-4.31381382s-3.37190083 1.81531532-3.37190083 4.31381382c0 2.32282282.91239669 3.88438441 2.32066116 5.07507511v1.6396396z\"/></svg>',\n        items: [\n            '&lsquo;', '&rsquo;', '&ldquo;', '&rdquo;', '&ndash;', '&mdash;', '&divide;', '&hellip;', '&trade;', '&bull;',\n            '&rarr;', '&asymp;', '$', '&euro;', '&cent;', '&pound;', '&yen;', '&iexcl;',\n            '&curren;', '&brvbar;', '&sect;', '&uml;', '&copy;', '&ordf;', '&laquo;', '&raquo;', '&not;', '&reg;', '&macr;',\n            '&deg;', '&sup1;', '&sup2;', '&sup3;', '&acute;', '&micro;', '&para;', '&middot;', '&cedil;',  '&ordm;',\n            '&frac14;', '&frac12;', '&frac34;', '&iquest;', '&Agrave;', '&Aacute;', '&Acirc;', '&Atilde;', '&Auml;', '&Aring;',\n            '&AElig;', '&Ccedil;', '&Egrave;', '&Eacute;', '&Ecirc;', '&Euml;', '&Igrave;', '&Iacute;', '&Icirc;', '&Iuml;',\n            '&ETH;', '&Ntilde;', '&Ograve;', '&Oacute;', '&Ocirc;', '&Otilde;', '&Ouml;', '&times;', '&Oslash;', '&Ugrave;',\n            '&Uacute;', '&Ucirc;', '&Uuml;', '&Yacute;', '&THORN;', '&szlig;', '&agrave;', '&aacute;', '&acirc;', '&atilde;',\n            '&auml;', '&aring;', '&aelig;', '&ccedil;', '&egrave;', '&eacute;', '&ecirc;', '&euml;', '&igrave;', '&iacute;',\n            '&icirc;', '&iuml;', '&eth;', '&ntilde;', '&ograve;', '&oacute;', '&ocirc;', '&otilde;', '&ouml;',\n            '&oslash;', '&ugrave;', '&uacute;', '&ucirc;', '&uuml;', '&yacute;', '&thorn;', '&yuml;', '&OElig;', '&oelig;',\n            '&#372;', '&#374', '&#373', '&#375;'\n        ]\n    },\n    start: function() {\n        this.app.toolbar.add('specialchars', {\n            title: '## specialchars.special-chars ##',\n            icon: this.opts.specialchars.icon,\n            command: 'specialchars.popup',\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        var chars = this.opts.specialchars.items;\n\n        for (var i = 0; i < chars.length; i++) {\n            items[i] = {\n                html: this.dom('<div>').addClass(this.prefix + '-popup-item').html(chars[i]),\n                command: 'specialchars.insert',\n                params: {\n                    character: chars[i]\n                }\n            };\n        }\n\n\n        this.app.popup.create('specialchars', {\n            type: 'grid',\n            width: '352px',\n            items: items\n        });\n        this.app.popup.open({ button: button });\n    },\n    insert: function(params) {\n        this.app.popup.close();\n        this.app.insertion.insertHtml(params.character, 'after');\n    }\n});","ArticleEditor.add('plugin', 'style', {\n    translations: {\n        en: {\n            \"style\": {\n                \"style\": \"Style\",\n                \"remove-style\": \"Remove Style\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m15 1c-3.5955345 2.88454776-5.25146525 9.6241453-7.87485347 9.6241453h-2.6253419l-2.62495116 4.3758547h-.87485347c1.75009768-5.25102559 6.33028189-14 14-14z\"/></svg>'\n    },\n    init: function() {},\n    start: function() {\n        if (typeof this.opts.styles === 'undefined') return;\n        var keys = Object.keys(this.opts.styles);\n        if (keys.length === 0) return;\n\n        this.app.toolbar.add('style', {\n            title: '## style.style ##',\n            icon: this.opts.style.icon,\n            position: {\n                after: 'format'\n            },\n            blocks: {\n                types: keys\n            },\n            command: 'style.popup'\n        });\n    },\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var type = instance.getType();\n        var classes = this._getClasses(type);\n        var items = this._buildItems(this.opts.styles[type], instance);\n\n        // popup\n        this.app.popup.create('style', { items: items });\n        this.app.popup.open({ button: button });\n    },\n    toggle: function(params) {\n        this._toggle(params, false);\n    },\n    remove: function() {\n        this._toggle();\n    },\n\n    // private\n    _toggle: function(params, remove) {\n        this.app.popup.close();\n\n        var instance = this.app.block.get();\n        var type = instance.getType();\n        var $block = instance.getBlock();\n\n        // remove\n        this._removeStyles(instance, type);\n\n        // set\n        if (remove === false) {\n            $block.addClass(params.classname);\n        }\n\n        // ui\n        this.app.control.updatePosition();\n    },\n    _buildItems: function(styles, instance) {\n        var items = {};\n        var active = false;\n        for (var key in styles) {\n            items[key] = {\n                title: styles[key].title,\n                command: 'style.toggle',\n                params: { classname: styles[key].classname }\n            }\n\n            if (this._hasClasses(instance, styles[key].classname)) {\n                active = key;\n            }\n        }\n\n        if (active) {\n            items[active].active = true;\n        }\n\n        items['remove'] = {\n            title: '## style.remove-style ##',\n            divider: 'top',\n            command: 'style.remove',\n            hidden: (active === false)\n        }\n\n        return items;\n    },\n    _hasClasses: function(instance, classname) {\n        var classes = classname.split(' ');\n        return instance.hasClass(classes);\n    },\n    _getClasses: function(type) {\n        var styles = this.opts.styles[type];\n        var classes = [];\n        for (var key in styles) {\n            classes.push(styles[key].classname);\n        }\n\n        return classes;\n    },\n    _removeStyles: function(instance, type) {\n        var classes = this._getClasses(type);\n        var $block = instance.getBlock();\n\n        $block.removeClass(classes.join(' '));\n    }\n});","// Icon\nArticleEditor.iconTags = '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m13.454 1c.853089 0 1.546.69366173 1.546 1.546v4.36371429c0 .56592472-.2790572 1.24002756-.6652017 1.62429902l-5.78655018 6.01223499c-.60256278.6050023-1.58507632.6050023-2.18621204.0014299l-4.90828435-4.90828722c-.60500231-.60256278-.60500231-1.58507632.01233983-2.19971875l5.98566032-5.75877764c.39921147-.40082772 1.07325621-.68089459 1.63853383-.68089459zm-.454 2h-3.90971429c-.0333803 0-.19751184.06819697-.23666299.10718491l-5.65962272 5.44381509 4.254 4.254 5.4606089-5.67296241c.0188278-.01875188.0660214-.12740905.0841458-.18802473l.0072453-.03429857zm-2 1c.553 0 1 .447 1 1s-.447 1-1 1-1-.447-1-1 .447-1 1-1z\"/></svg>';\n\n// Block\nArticleEditor.add('block', 'block.tags', {\n    mixins: ['block'],\n    type: 'tags',\n    parser: {\n        tag: 'div',\n        parse: function($el) {\n            return ($el.hasClass('tags')) ? 'tags' : false;\n        }\n    },\n    toolbar: {\n        add: { command: 'addbar.popup', title: '## buttons.add ##' },\n        tags: { command: 'tags.edit', title: '## buttons.settings ##', icon: ArticleEditor.iconTags }\n    },\n    control: {\n        trash: { command: 'block.remove', title: '## buttons.delete ##' },\n        duplicate: { command: 'block.duplicate', title: '## buttons.duplicate ##'  }\n    },\n    create: function() {\n        return this.dom('<div>').addClass('tags');\n    }\n});\n\n// Plugin\nArticleEditor.add('plugin', 'tags', {\n    translations: {\n        en: {\n            \"tags\": {\n                \"tags\": \"Tags\",\n                \"add\": \"Add\",\n                \"save\": \"Save\",\n                \"cancel\": \"Cancel\",\n                \"label\": \"Add comma-separated tags\"\n            },\n             \"blocks\": {\n                 \"tags\": \"Tags\"\n             }\n        }\n    },\n    popups: {\n        add: {\n            title: '## tags.tags ##',\n            width: '100%',\n            form: {\n                tags: { label: '## tags.label ##', type: 'textarea', rows: 4 }\n            },\n            footer: {\n                insert: { title: '## tags.add ##', command: 'tags.insert', type: 'primary' },\n                cancel: { title: '## tags.cancel ##', command: 'popup.close' }\n            }\n        },\n        edit: {\n            title: '## tags.tags ##',\n            width: '100%',\n            form: {\n                tags: { label: '## tags.label ##', type: 'textarea', rows: 4 }\n            },\n            footer: {\n                save: { title: '## tags.save ##', command: 'tags.save', type: 'primary' },\n                cancel: { title: '## tags.cancel ##', command: 'popup.close' }\n            }\n        }\n    },\n    defaults: {\n        classname: 'tag'\n    },\n    start: function() {\n        this.app.addbar.add('tags', {\n            title: '## blocks.tags ##',\n            icon: ArticleEditor.iconTags,\n            command: 'tags.popup'\n        });\n    },\n    popup: function() {\n        var stack = this.app.popup.add('tags', this.popups.add);\n        stack.open({ focus: 'tags' });\n    },\n    edit: function(params, button) {\n        var stack = this.app.popup.create('tags', this.popups.edit);\n\n        // data\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        var tags = [];\n        $block.find('.' + this.opts.tags.classname).each(function($node) {\n            tags.push($node.html());\n        });\n\n        // set\n        stack.setData({ tags: tags.join(', ') });\n\n        // open\n        this.app.popup.open({ button: button, focus: 'tags' });\n    },\n    save: function(stack) {\n        var current = this.app.block.get();\n        var $block = current.getBlock();\n        $block.html('');\n\n        var instance = this._buildInstance(stack, current);\n        if (!instance) {\n            current.remove();\n        }\n    },\n    insert: function(stack) {\n        var instance = this._buildInstance(stack);\n\n        // insert\n        if (instance) {\n            this.app.block.add({ instance: instance });\n        }\n    },\n\n    // private\n    _buildInstance: function(stack, instance) {\n        this.app.popup.close();\n\n        var data = stack.getData();\n        var str = data.tags.trim();\n\n        if (str === '') {\n            return;\n        }\n\n        // create\n        var instance = instance || this.app.create('block.tags');\n        var $block = instance.getBlock();\n\n        // build\n        var tags = str.split(',');\n        for (var i = 0; i < tags.length; i++) {\n            var tag = tags[i].trim();\n            var $tag = this.dom('<span>').addClass(this.opts.tags.classname).html(tag);\n\n            $block.append($tag);\n        }\n\n        return instance;\n    }\n});","ArticleEditor.add('plugin', 'textdirection', {\n    translations: {\n        en: {\n            \"textdirection\": {\n                \"title\": \"RTL-LTR\",\n                \"ltr\": \"Left to Right\",\n                \"rtl\": \"Right to Left\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m3.8 8.10002943c.12590292.09442719.2.24262134.2.4v1.49999997h9c.5522847 0 1 .4477153 1 1 0 .5128359-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-9v1.5c0 .2761424-.22385763.5-.5.5-.15737865 0-.30557281-.0740971-.4-.2l-1.875-2.5c-.13333333-.1777778-.13333333-.4222222 0-.6l1.875-2.49999997c.16568542-.2209139.4790861-.26568543.7-.1zm7.4-6c.2209139-.16568543.5343146-.1209139.7.1l1.875 2.5c.1333333.17777777.1333333.42222222 0 .6l-1.875 2.5c-.0944272.12590292-.2426213.2-.4.2-.2761424 0-.5-.22385763-.5-.5v-1.5h-9c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 8.999-.00002943.001-1.49997057c0-.12590293.0474221-.24592777.1308533-.33724831z\"/></svg>'\n    },\n    start: function() {\n        this.app.toolbar.add('textdirection', {\n            title: '## textdirection.title ##',\n            icon: this.opts.textdirection.icon,\n            blocks: {\n                all: 'all',\n                except: ['variable']\n            },\n            command: 'textdirection.toggle'\n        });\n    },\n    toggle: function(params, button) {\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var currentDir = $block.attr('dir');\n        var items = {\n            ltr: { title: '## textdirection.ltr ##', command: 'textdirection.set' },\n            rtl: { title: '## textdirection.rtl ##', command: 'textdirection.set' },\n        };\n        var dir = (currentDir) ? currentDir : this.opts.editor.direction;\n\n        items[dir].active = true;\n\n\n        this.app.popup.create('textdirection', { items: items });\n        this.app.popup.open({ button: button });\n    },\n    set: function(params, item, name) {\n        this.app.popup.close();\n\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n        var dir = this.opts.editor.direction;\n\n        if (dir === name) {\n            $block.removeAttr('dir');\n        }\n        else {\n            $block.attr('dir', name);\n        }\n    }\n});","ArticleEditor.add('plugin', 'underline', {\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m12.2307692 12c.5522848 0 1 .4477153 1 1 0 .5128358-.3860402.9355072-.8833788.9932723l-.1166212.0067277h-8.2307692c-.55228475 0-1-.4477153-1-1 0-.5128358.38604019-.9355072.88337887-.9932723l.11662113-.0067277zm-1.2307692-10c.5128358 0 .9355072.43429521.9932723.99380123l.0067277.13119877v3.51108871c0 2.42071645-1.7998593 4.36391129-4 4.36391129-2.13138633 0-3.8871179-1.82364282-3.99476969-4.13841284l-.00523031-.22549845v-3.51108871c0-.62132034.44771525-1.125 1-1.125.51283584 0 .93550716.43429521.99327227.99380123l.00672773.13119877v3.51108871c0 1.15688618.88643222 2.11391129 2 2.11391129 1.06054074 0 1.91506284-.86804999 1.99404104-1.95008319l.00595896-.1638281v-3.51108871c0-.62132034.4477153-1.125 1-1.125z\"/></svg>'\n    },\n    start: function() {\n        this.app.toolbar.add('underline', {\n            title: '## buttons.underline ##',\n            icon: this.opts.underline.icon,\n            command: 'inline.set',\n            position: {\n                after: 'italic'\n            },\n            active: {\n                tags: ['u']\n            },\n            params: {\n                tag: 'u'\n            },\n            blocks: {\n                all: 'editable',\n                except: ['code']\n            }\n        });\n    }\n});","ArticleEditor.add('plugin', 'variable', {\n    translations: {\n        en: {\n            \"blocks\": {\n                \"variable\": \"Variable\"\n            },\n            \"variable\": {\n                \"variable\": \"Variable\"\n            }\n        }\n    },\n    defaults: {\n        icon: '<svg height=\"16\" viewBox=\"0 0 16 16\" width=\"16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"m8 0c4.418278 0 8 3.581722 8 8s-3.581722 8-8 8-8-3.581722-8-8 3.581722-8 8-8zm0 2c-3.3137085 0-6 2.6862915-6 6s2.6862915 6 6 6 6-2.6862915 6-6-2.6862915-6-6-6zm-.04375592 2c1.59851929 0 2.78098562.82644628 2.84667822 2.45730028h-1.72990447c-.01094876-.52892562-.4051042-.90358127-1.11677375-.90358127-.67882327 0-1.02918366.30853994-1.02918366.71625344 0 1.36639119 4.07293958.12121212 4.07293958 3.23966942 0 1.43250693-1.08392747 2.49035813-3.01090964 2.49035813-1.86128959 0-2.99996087-1.0688705-2.98901211-2.65564738h1.65326311c.03284629.6060606.51459183 1.05785128 1.39049282 1.05785128.72261831 0 1.14962004-.2754821 1.14962004-.76033062 0-1.43250689-3.99629825-.15426997-3.99629825-3.32782369 0-1.2892562.99633737-2.31404959 2.75908811-2.31404959z\"/></svg>',\n        items: ['email', 'name', 'lastname'],\n        classname: 'arx-variable',\n        template: {\n            start: '[% ',\n            end: ' %]'\n        }\n    },\n    subscribe: {\n        'editor.parse': function(event) {\n            this._parse(event);\n        },\n        'editor.unparse': function(event) {\n            this._unparse(event);\n        }\n    },\n    start: function() {\n        this.app.toolbar.add('variable', {\n            title: '## variable.variable ##',\n            icon: this.opts.variable.icon,\n            command: 'variable.popup',\n            blocks: {\n                all: 'editable',\n                except: ['code'],\n                types: ['variable']\n            },\n            active: {\n                types: ['variable']\n            }\n        });\n    },\n    popup: function(params, button) {\n        var items = {};\n        var vars = this.opts.variable.items;\n        var instance = this.app.block.get();\n        var activeKey = (instance.getType('variable')) ? instance.getHtml() : false;\n\n        for (var i = 0; i < vars.length; i++) {\n            items[i] = {\n                title: vars[i],\n                command: 'variable.insert',\n                active: (activeKey === vars[i]),\n                params: {\n                    variable: vars[i]\n                }\n            };\n        }\n\n        this.app.popup.create('variable', { items: items });\n        this.app.popup.open({ button: button });\n    },\n    insert: function(params) {\n        this.app.popup.close();\n\n        var instance = this.app.create('block.variable');\n        instance.setHtml(params.variable);\n\n        // insert\n        this.app.block.add({\n            instance: instance,\n            caret: 'after'\n        });\n    },\n\n\n    // private\n    _parse: function(event) {\n        var html = event.get('html');\n        var start = this.opts.variable.template.start;\n        var end = this.opts.variable.template.end;\n        var htmlStart = '<span data-' + this.prefix + '-type=\"variable\">'\n        var htmlEnd = '</span>';\n        var storedLinks = [];\n        var re = new RegExp(this.app.utils.escapeRegExp(start) + '(.*?)' + this.app.utils.escapeRegExp(end), 'gi');\n        var match = html.match(re);\n        if (match != null) {\n            html = this._storeLinks(html, storedLinks);\n            var matched, replacer;\n            for (var i = 0; i < match.length; i++) {\n                matched =  match[i].replace(start, '').replace(end, '');\n                replacer = htmlStart + matched + htmlEnd;\n                html = html.replace(match[i], replacer);\n            }\n            html = this._restoreLinks(html, storedLinks);\n        }\n\n        event.set('html', html);\n    },\n    _unparse: function(event) {\n        var html = event.get('html');\n        var start = this.opts.variable.template.start;\n        var end = this.opts.variable.template.end;\n\n        // find\n        html = this.app.utils.wrap(html, function($w) {\n            $w.find('.' + this.opts.variable.classname).replaceWith(function(node) {\n                return start + node.innerHTML + end;\n            });\n        }.bind(this));\n\n        event.set('html', html);\n    },\n    _storeLinks: function(html, storedLinks) {\n        var links = html.match(new RegExp('<a[^>]*>', 'gi'));\n        if (links === null) return html;\n\n        for (var i = 0; i < links.length; i++) {\n            html = html.replace(links[i], '#####xstartvarlinkszz' + i + 'xendvarlinkstzz#####');\n            storedLinks.push(links[i]);\n        }\n\n        return html;\n    },\n    _restoreLinks: function(html, storedLinks) {\n        for (var i = 0; i < storedLinks.length; i++) {\n            html = html.replace('#####xstartvarlinkszz' + i + 'xendvarlinkstzz#####', storedLinks[i]);\n        }\n\n        return html;\n    }\n});","/* globals PShowBEBaseUri, PShowBEConfig, PShowEditorImageUploadControllerURL, PShowEditorImageListControllerURL, PShowThemeCssUri */\n\nimport './plugin-icons';\nimport './block-link';\nimport './product-block';\nimport './my-fontcolor';\n\nwindow.PShowBlockEditor = function (selector, settings) {\n    settings = settings || PShowBEConfig\n    if (typeof PShowBEBaseUri !== 'undefined') {\n        settings.css = PShowBEBaseUri + 'dist/';\n    }\n\n    function convertDivsToP(html) {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(html, 'text/html');\n        const divs = doc.querySelectorAll('div');\n        divs.forEach(div => {\n            if (\n                Array.from(div.childNodes).some(\n                    node => node.nodeType === Node.TEXT_NODE \n                    && node.textContent.trim() !== ''\n                ) \n                && !div.querySelector('div')\n            ) {\n                const p = doc.createElement('p');\n                p.innerHTML = div.innerHTML;\n                p.className = 'pse-p';\n                p.style.cssText = div.style.cssText;\n                if (div.getAttribute('data-target-url')) {\n                    p.setAttribute('data-target-url', div.getAttribute('data-target-url'));\n                }\n                div.parentNode.replaceChild(p, div);\n            }\n        });\n        return doc.body.innerHTML;\n    }\n\n    setTimeout(() => {\n        let toolbarTopOffset = document.getElementById('header_infos').offsetHeight;\n        toolbarTopOffset += document.getElementsByClassName('header-toolbar')[0]?.offsetHeight || 0;\n        toolbarTopOffset += document.getElementsByClassName('page-head')[0]?.offsetHeight || 0;\n\n        let tinyMceInterval = {};\n        const textarea = document.querySelectorAll(selector);\n        let editor = {};\n\n        const observer = new MutationObserver(function (mutations) {\n            mutations.forEach(function (mutation) {\n                if (mutation.type === \"attributes\") {\n                    if (mutation.target.disabled) {\n                        editor[mutation.target.id].disable();\n                        return;\n                    }\n                    editor[mutation.target.id].enable();\n                }\n            });\n        });\n\n        for (let i = 0; i < textarea.length; i++) {\n            const col = textarea[i].closest('.col-lg-9');\n\n            if (col) {\n                col.classList.add('col-lg-11');\n                col.classList.remove('col-lg-9');\n\n                const colLangSelector = col.nextElementSibling;\n                if (colLangSelector) {\n                    colLangSelector.classList.add('col-lg-1');\n                    colLangSelector.classList.remove('col-lg-2');\n                }\n            }\n\n            if (!textarea[i].id) {\n                textarea[i].id = 'pse-editor-' + (Math.random().toString(36).substring(2));\n            }\n\n            // remove tinymce\n            textarea[i].classList.remove('autoload_rte');\n\n            // MIGRATIONS\n            // .grid    ->  .pse-grid\n            textarea[i].value = textarea[i].value.replace(/([^-])grid/g, '$1pse-grid');\n            // <table>  ->  <table class=\"pse-table\">\n            textarea[i].value = textarea[i].value.replace(/<table>/g, '<table class=\"pse-table\">');\n            // .valign- ->  .pse-valign-\n            textarea[i].value = textarea[i].value.replace(/([^-])valign-([a-z]+)/g, '$1pse-valign-$2');\n            // .align-  ->  .pse-align-\n            textarea[i].value = textarea[i].value.replace(/([^-v])align-([a-z]+)/, '$1pse-align-$2');\n\n            const valueDOM = new DOMParser().parseFromString(textarea[i].value, \"text/html\");\n            const valueOnlyDOM = valueDOM?.body?.firstChild;\n            if (valueOnlyDOM && typeof valueOnlyDOM.querySelector === 'function') {\n                const contentDiv = valueOnlyDOM.querySelector('div[class=\"app__tabs__content__inner js__app__tabs__content pse-div\"]')\n                if (contentDiv && contentDiv?.innerHTML) {\n                    textarea[i].value = contentDiv.innerHTML;\n                }\n            }\n\n            // <div (...) class=\"pse-div\">(some text)</div> -> <p ... class=\"pse-p\">(some text)</p>\n            textarea[i].value = convertDivsToP(textarea[i].value);\n\n            editor[textarea[i].id] = ArticleEditor('#' + textarea[i].id, {\n                image: {\n                    width: true,\n                    types: ['image/png', 'image/jpeg'],\n                    upload: PShowEditorImageUploadControllerURL,\n                    select: PShowEditorImageListControllerURL,\n                },\n                topbar: {\n                    undoredo: true\n                },\n                toolbar: {\n                    stickyTopOffset: toolbarTopOffset,\n                },\n                snippets: PShowThemeCssUri + 'pshow-block-editor-snippets.json',\n                custom: {\n                    css: [\n                        PShowBEBaseUri + 'dist/front.css',\n                        'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css',\n                        PShowThemeCssUri + 'pshow-block-editor.css',\n                    ],\n                    js: [\n                        PShowBEBaseUri + 'dist/admin.js',\n                    ]\n                },\n                subscribe: {\n                    'editor.before.change': function(event) {\n                        $('form[name=\"product\"] .cancel-button').prop('disabled', false).removeClass('disabled');\n                        $('form[name=\"product\"] .product-form-save-button').prop('disabled', false).removeClass('disabled');\n                        \n                        // remove data-temp-block tags\n                        const dom = new DOMParser().parseFromString(event.params.html, 'text/html');\n                        const tempBlocks = dom.querySelectorAll('[data-temp-block=\"true\"]');\n                        if (tempBlocks) {\n                            tempBlocks.forEach(block => {\n                                block.remove();\n                            });\n                        }\n\n                        // restore cover images\n                        const replacedImages = dom.querySelectorAll('.replaced-cover-image');\n                        replacedImages.forEach(img => {\n                            img.src = '{{cover}}';\n                            img.classList.remove('replaced-cover-image');\n                        });\n\n                        event.params.html = dom.body.outerHTML;\n\n                        const iframe = editor[textarea[i].id].editor.$editor.nodes[0];\n                        if (iframe) {\n                            iframe.contentWindow.pinProductBlockIds();\n                            iframe.contentWindow.replaceCoverImages();\n                        }\n                    }\n                },\n                plugins: [\n                    'selector',\n                    'imageposition',\n                    'imageresize',\n                    'removeformat',\n                    'specialchars',\n                    'underline',\n                    // 'definedlinks',\n                    'counter',\n                    'blockcode',\n                    'reorder',\n                    'fontsize',\n                    'fontfamily',\n                    'my-fontcolor',\n                    'pshow-icons',\n                    'blocklink',\n                    'product-block',\n                ],\n                path: {\n                    title: 'Editor',\n                },\n                grid: {\n                    classname: 'pse-grid',\n                },\n                table: {\n                    template: '<table class=\"pse-table\"><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>'\n                },\n                align: {\n                    'left': 'pse-align-left',\n                    'center': 'pse-align-center',\n                    'right': 'pse-align-right',\n                    'justify': 'pse-align-justify'\n                },\n                valign: {\n                    top: 'pse-valign-top',\n                    middle: 'pse-valign-middle',\n                    bottom: 'pse-valign-bottom'\n                },\n                codemirror: {\n                    lineNumbers: true\n                },\n                classes: {\n                    'p': 'pse-p',\n                    'h1': 'pse-h1',\n                    'h2': 'pse-h2',\n                    'h3': 'pse-h3',\n                    'h4': 'pse-h4',\n                    'h5': 'pse-h5',\n                    'h6': 'pse-h6',\n                    'blockquote': 'pse-blockquote',\n                    'pre': 'pse-pre',\n                    'code': 'pse-code',\n                    'table': 'pse-table',\n                    'th': 'pse-th',\n                    'td': 'pse-td',\n                    'tr': 'pse-tr',\n                    'ul': 'pse-ul',\n                    'ol': 'pse-ol',\n                    'li': 'pse-li',\n                    'img': 'pse-img',\n                    'a': 'pse-a',\n                    'span': 'pse-span',\n                    'div': 'pse-div',\n                    'iframe': 'pse-iframe',\n                    'figure': 'pse-figure',\n                    'figcaption': 'pse-figcaption',\n                    'section': 'pse-section',\n                    'hr': 'pse-hr',\n                    'b': 'pse-b',\n                    'i': 'pse-i',\n                    'u': 'pse-u',\n                    's': 'pse-s',\n                    'del': 'pse-del',\n                    'sub': 'pse-sub',\n                    'sup': 'pse-sup',\n                    'em': 'pse-em',\n                    'strong': 'pse-strong',\n                    'small': 'pse-small',\n                    'abbr': 'pse-abbr'\n                },\n                // definedlinks: {\n                //     items: [\n                //         { \"name\": \"Select...\", \"url\": false },\n                //         { \"name\": \"Google\", \"url\": \"http://google.com\" },\n                //         { \"name\": \"Home\", \"url\": \"/\" },\n                //         { \"name\": \"About\", \"url\": \"/about/\" },\n                //         { \"name\": \"Contact\", \"url\": \"/contact/\" }\n                //     ]\n                // },\n                ...settings,\n            });\n\n            observer.observe(textarea[i], {\n                attributes: true,\n            });\n\n            // watch for changes made by jquery\n            let originalVal = $.fn.val;\n            $.fn.val = function (value) {\n                if (value !== undefined && this[0]?.id === textarea[i]?.id) {\n                    editor[textarea[i].id].editor.setContent({html: value});\n                }\n                return originalVal.apply(this, arguments);\n            };\n\n            // remove tinymce\n            if (typeof tinymce !== \"undefined\") {\n                tinymce.remove(`#${textarea[i].id}`);\n                textarea[i].style.display = 'none';\n            }\n            tinyMceInterval[textarea[i].id] = setInterval(() => {\n                if (typeof tinymce === \"undefined\") {\n                    return;\n                }\n                tinymce.remove(`#${textarea[i].id}`);\n                textarea[i].style.display = 'none';\n                clearInterval(tinyMceInterval[textarea[i].id]);\n            }, 2000);\n        }\n    }, 1);\n};\n\nwindow.addEventListener('load', function () {\n    PShowBlockEditor('[data-pshow-block-editor]');\n    if (PShowBEConfig?.editors_id) {\n        for (const id of PShowBEConfig.editors_id) {\n            PShowBlockEditor(id);\n        }\n    }\n\n    const head = document.head;\n    const link = document.createElement('link');\n    link.href = 'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css';\n    link.rel = 'stylesheet';\n    head.appendChild(link);\n});\n","ArticleEditor.add('plugin', 'pshow-icons', {\n    start: function() {\n        this.app.toolbar.add('pshow-icons', {\n            title: 'Icons',\n            icon: '<i class=\"fa fa-star\"></i>',\n            command: 'pshow-icons.popup'\n        });\n    },\n    popup: function(params, button) {\n        var icons = [\n            'fa-adjust', 'fa-adn', 'fa-align-center', 'fa-align-justify',\n            'fa-align-left', 'fa-align-right', 'fa-ambulance', 'fa-anchor',\n            'fa-android', 'fa-angellist', 'fa-angle-double-down', 'fa-angle-double-left',\n            'fa-angle-double-right', 'fa-angle-double-up', 'fa-angle-down', 'fa-angle-left',\n            'fa-angle-right', 'fa-angle-up', 'fa-apple', 'fa-archive',\n            'fa-area-chart', 'fa-arrow-circle-down', 'fa-arrow-circle-left', 'fa-arrow-circle-right',\n            'fa-arrow-circle-up', 'fa-arrow-down', 'fa-arrow-left', 'fa-arrow-right',\n            'fa-arrow-up', 'fa-arrows', 'fa-arrows-alt', 'fa-arrows-h',\n            'fa-arrows-v', 'fa-asterisk', 'fa-at', 'fa-backward',\n            'fa-ban', 'fa-bar-chart', 'fa-barcode', 'fa-bars',\n            'fa-bed', 'fa-beer', 'fa-behance', 'fa-behance-square',\n            'fa-bell', 'fa-bell-o', 'fa-bell-slash', 'fa-bell-slash-o',\n            'fa-bicycle', 'fa-binoculars', 'fa-birthday-cake', 'fa-bitbucket',\n            'fa-bitbucket-square', 'fa-bold', 'fa-bolt', 'fa-bomb',\n            'fa-book', 'fa-bookmark', 'fa-bookmark-o', 'fa-briefcase',\n            'fa-btc', 'fa-bug', 'fa-building', 'fa-building-o',\n            'fa-bullhorn', 'fa-bullseye', 'fa-bus', 'fa-calculator',\n            'fa-calendar', 'fa-calendar-o', 'fa-camera', 'fa-camera-retro',\n            'fa-car', 'fa-caret-down', 'fa-caret-left', 'fa-caret-right',\n            'fa-caret-up', 'fa-cart-arrow-down', 'fa-cart-plus', 'fa-cc',\n            'fa-cc-amex', 'fa-cc-discover', 'fa-cc-mastercard', 'fa-cc-paypal',\n            'fa-cc-stripe', 'fa-cc-visa', 'fa-certificate', 'fa-chain-broken',\n            'fa-check', 'fa-check-circle', 'fa-check-circle-o', 'fa-check-square',\n            'fa-check-square-o', 'fa-chevron-circle-down', 'fa-chevron-circle-left', 'fa-chevron-circle-right',\n            'fa-chevron-circle-up', 'fa-chevron-down', 'fa-chevron-left', 'fa-chevron-right',\n            'fa-chevron-up', 'fa-child', 'fa-circle', 'fa-circle-o',\n            'fa-circle-o-notch', 'fa-circle-thin', 'fa-clipboard', 'fa-clock-o',\n            'fa-cloud', 'fa-cloud-download', 'fa-cloud-upload', 'fa-code',\n            'fa-code-fork', 'fa-coffee', 'fa-cog', 'fa-cogs',\n            'fa-columns', 'fa-comment', 'fa-comment-o', 'fa-comments',\n            'fa-comments-o', 'fa-compass', 'fa-compress', 'fa-copy',\n            'fa-copyright', 'fa-credit-card', 'fa-crop', 'fa-crosshairs',\n            'fa-css3', 'fa-cube', 'fa-cubes', 'fa-cutlery',\n            'fa-database', 'fa-desktop', 'fa-diamond', 'fa-download',\n            'fa-dropbox', 'fa-edit', 'fa-eject', 'fa-ellipsis-h',\n            'fa-ellipsis-v', 'fa-envelope', 'fa-envelope-o', 'fa-envelope-square',\n            'fa-eraser', 'fa-exchange', 'fa-exclamation', 'fa-exclamation-circle',\n            'fa-exclamation-triangle', 'fa-expand', 'fa-external-link', 'fa-external-link-square',\n            'fa-eye', 'fa-eye-slash', 'fa-eyedropper', 'fa-facebook',\n            'fa-facebook-square', 'fa-fast-backward', 'fa-fast-forward', 'fa-fax',\n            'fa-female', 'fa-fighter-jet', 'fa-file', 'fa-file-archive-o',\n            'fa-file-audio-o', 'fa-file-code-o', 'fa-file-excel-o', 'fa-file-image-o',\n            'fa-file-o', 'fa-file-pdf-o', 'fa-file-powerpoint-o', 'fa-file-text',\n            'fa-file-text-o', 'fa-file-video-o', 'fa-file-word-o', 'fa-files-o',\n            'fa-film', 'fa-filter', 'fa-fire', 'fa-fire-extinguisher',\n            'fa-flag', 'fa-flag-checkered', 'fa-flag-o', 'fa-flask',\n            'fa-flickr', 'fa-floppy-o', 'fa-folder', 'fa-folder-o',\n            'fa-folder-open', 'fa-folder-open-o', 'fa-font', 'fa-forward',\n            'fa-foursquare', 'fa-frown-o', 'fa-futbol-o', 'fa-gamepad',\n            'fa-gavel', 'fa-gbp', 'fa-gift', 'fa-git',\n            'fa-git-square', 'fa-github', 'fa-github-alt', 'fa-github-square',\n            'fa-glass', 'fa-globe', 'fa-google', 'fa-google-plus',\n            'fa-google-plus-square', 'fa-graduation-cap', 'fa-gratipay', 'fa-h-square',\n            'fa-hand-o-down', 'fa-hand-o-left', 'fa-hand-o-right', 'fa-hand-o-up',\n            'fa-hdd-o', 'fa-header', 'fa-headphones', 'fa-heart',\n            'fa-heart-o', 'fa-history', 'fa-home', 'fa-hospital-o',\n            'fa-html5', 'fa-image', 'fa-inbox', 'fa-indent',\n            'fa-info', 'fa-info-circle', 'fa-inr', 'fa-instagram',\n            'fa-ioxhost', 'fa-italic', 'fa-joomla', 'fa-jpy',\n            'fa-jsfiddle', 'fa-key', 'fa-keyboard-o', 'fa-krw',\n            'fa-language', 'fa-laptop', 'fa-lastfm', 'fa-lastfm-square',\n            'fa-leaf', 'fa-lemon-o', 'fa-level-down', 'fa-level-up',\n            'fa-life-ring', 'fa-lightbulb-o', 'fa-line-chart', 'fa-link',\n            'fa-linkedin', 'fa-linkedin-square', 'fa-linux', 'fa-list',\n            'fa-list-alt', 'fa-list-ol', 'fa-list-ul', 'fa-location-arrow',\n            'fa-lock', 'fa-long-arrow-down', 'fa-long-arrow-left', 'fa-long-arrow-right',\n            'fa-long-arrow-up', 'fa-magic', 'fa-magnet', 'fa-male',\n            'fa-map-marker', 'fa-maxcdn', 'fa-meanpath', 'fa-medkit',\n            'fa-meh-o', 'fa-microphone', 'fa-microphone-slash', 'fa-minus',\n            'fa-minus-circle', 'fa-minus-square', 'fa-minus-square-o', 'fa-mobile',\n            'fa-money', 'fa-moon-o', 'fa-motorcycle', 'fa-music',\n            'fa-newspaper-o', 'fa-openid', 'fa-outdent', 'fa-pagelines',\n            'fa-paint-brush', 'fa-paper-plane', 'fa-paper-plane-o', 'fa-paperclip',\n            'fa-paragraph', 'fa-pause', 'fa-paw', 'fa-paypal',\n            'fa-pencil', 'fa-pencil-square', 'fa-pencil-square-o', 'fa-phone',\n            'fa-phone-square', 'fa-picture-o', 'fa-pie-chart', 'fa-pied-piper',\n            'fa-pied-piper-alt', 'fa-pinterest', 'fa-pinterest-square', 'fa-plane',\n            'fa-play', 'fa-play-circle', 'fa-play-circle-o', 'fa-plug',\n            'fa-plus', 'fa-plus-circle', 'fa-plus-square', 'fa-plus-square-o',\n            'fa-power-off', 'fa-print', 'fa-puzzle-piece', 'fa-qq',\n            'fa-qrcode', 'fa-question', 'fa-question-circle', 'fa-quote-left',\n            'fa-quote-right', 'fa-random', 'fa-rebel', 'fa-recycle',\n            'fa-reddit', 'fa-reddit-square', 'fa-refresh', 'fa-renren',\n            'fa-repeat', 'fa-reply', 'fa-reply-all', 'fa-retweet',\n            'fa-road', 'fa-rocket', 'fa-rss', 'fa-rss-square',\n            'fa-rub', 'fa-scissors', 'fa-search', 'fa-search-minus',\n            'fa-search-plus', 'fa-sellsy', 'fa-server', 'fa-share',\n            'fa-share-alt', 'fa-share-alt-square', 'fa-share-square', 'fa-share-square-o',\n            'fa-shield', 'fa-ship', 'fa-shirtsinbulk', 'fa-shopping-cart',\n            'fa-sign-in', 'fa-sign-out', 'fa-signal', 'fa-simplybuilt',\n            'fa-sitemap', 'fa-skyatlas', 'fa-skype', 'fa-slack',\n            'fa-sliders', 'fa-slideshare', 'fa-smile-o', 'fa-sort',\n            'fa-sort-alpha-asc', 'fa-sort-alpha-desc', 'fa-sort-amount-asc', 'fa-sort-amount-desc',\n            'fa-sort-asc', 'fa-sort-desc', 'fa-sort-numeric-asc', 'fa-sort-numeric-desc',\n            'fa-soundcloud', 'fa-space-shuttle', 'fa-spinner', 'fa-spoon',\n            'fa-spotify', 'fa-square', 'fa-square-o', 'fa-stack-exchange',\n            'fa-stack-overflow', 'fa-star', 'fa-star-half', 'fa-star-half-o',\n            'fa-star-o', 'fa-steam', 'fa-steam-square', 'fa-step-backward',\n            'fa-step-forward', 'fa-stethoscope', 'fa-stop', 'fa-street-view',\n            'fa-strikethrough', 'fa-stumbleupon', 'fa-stumbleupon-circle', 'fa-subscript',\n            'fa-subway', 'fa-suitcase', 'fa-sun-o', 'fa-superscript',\n            'fa-table', 'fa-tablet', 'fa-tachometer', 'fa-tag',\n            'fa-tags', 'fa-tasks', 'fa-taxi', 'fa-tencent-weibo',\n            'fa-terminal', 'fa-text-height', 'fa-text-width', 'fa-th',\n            'fa-th-large', 'fa-th-list', 'fa-thumbs-down', 'fa-thumbs-o-down',\n            'fa-thumbs-o-up', 'fa-thumbs-up', 'fa-ticket', 'fa-times',\n            'fa-times-circle', 'fa-times-circle-o', 'fa-tint', 'fa-toggle-off',\n            'fa-toggle-on', 'fa-train', 'fa-transgender', 'fa-transgender-alt',\n            'fa-trash', 'fa-trash-o', 'fa-tree', 'fa-trello',\n            'fa-trophy', 'fa-truck', 'fa-try', 'fa-tty',\n            'fa-tumblr', 'fa-tumblr-square', 'fa-twitch', 'fa-twitter',\n            'fa-twitter-square', 'fa-umbrella', 'fa-underline', 'fa-undo',\n            'fa-university', 'fa-unlock', 'fa-unlock-alt', 'fa-upload',\n            'fa-usd', 'fa-user', 'fa-user-md', 'fa-user-plus',\n            'fa-user-secret', 'fa-user-times', 'fa-users', 'fa-venus',\n            'fa-venus-double', 'fa-venus-mars', 'fa-viacoin', 'fa-video-camera',\n            'fa-vimeo-square', 'fa-vine', 'fa-vk', 'fa-volume-down',\n            'fa-volume-off', 'fa-volume-up', 'fa-weibo', 'fa-weixin',\n            'fa-whatsapp', 'fa-wheelchair', 'fa-wifi', 'fa-windows',\n            'fa-wordpress', 'fa-wrench', 'fa-xing', 'fa-xing-square',\n            'fa-yahoo', 'fa-yelp', 'fa-youtube', 'fa-youtube-play',\n            'fa-youtube-square'\n        ];\n\n        // Create popup\n        var popup = this.app.popup.create('pshow-icons', {\n            title: '',\n            width: '600px',\n            height: '400px'\n        });\n\n        var $body = popup.getBody();\n\n        $body.css('padding', '15px');\n        \n        // Create search input\n        var $search = this.dom('<input type=\"text\" placeholder=\"Search icons...\" style=\"width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;\">');\n        \n        // Create icons container\n        var $container = this.dom('<div style=\"display: flex; flex-wrap: wrap; gap: 10px; max-height: 300px; overflow-y: auto; \">');\n        \n        // Add icons\n        var iconElements = [];\n        icons.forEach(function(icon) {\n            var $icon = this.dom(`<div class=\"icon-item\" style=\"padding: 10px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; text-align: center; width: 80px;\">\n                <i class=\"fa ${icon}\" style=\"font-size: 20px;\"></i>\n                <div style=\"font-size: 10px; margin-top: 5px;\">${icon.substring(3).replace(/-/g, ' ')}</div>\n            </div>`);\n            \n            $icon.on('click', this.insert.bind(this, icon));\n            $container.append($icon);\n            iconElements.push({\n                element: $icon,\n                name: icon\n            });\n        }.bind(this));\n\n        // Search functionality\n        $search.on('input', function(e) {\n            var searchTerm = e.target.value.toLowerCase();\n            \n            iconElements.forEach(function(item) {\n                if (item.name.toLowerCase().includes(searchTerm)) {\n                    item.element.css('display', 'block');\n                } else {\n                    item.element.css('display', 'none');\n                }\n            });\n        }.bind(this));\n\n        // Append elements\n        $body.append($search);\n        $body.append($container);\n\n        // Open popup\n        this.app.popup.open({ button: button });\n    },\n    insert: function(icon, e) {\n        e.preventDefault();\n        \n        var $icon = this.dom(`<i class=\"fa ${icon}\"></i>`);\n        this.app.insertion.insertNode($icon);\n\n        this.app.popup.close();\n    }\n});\n","ArticleEditor.add('plugin', 'blocklink', {\n    start: function() {\n        this.app.toolbar.add('blocklink', {\n            title: 'Block link',\n            icon: '<i class=\"fa fa-link\"></i>',\n            command: 'blocklink.popup',\n            blocks: {\n                all: true,\n                except: ['variable', 'figure', 'paragraph', 'image']\n            }\n        });\n    },\n    popup: function(params, button) {\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        console.log($block.nodes[0].tagName);\n        if ($block.nodes[0].tagName != \"DIV\") {\n            console.log(\"DIV is only allowed\");\n            return;\n        }\n\n        // create\n        var popup = this.app.popup.create('blocklink', {\n            title: 'Block link',\n            width: '400px',\n            form: {\n                target_url: { type: 'input', label: 'Target URL' }\n            },\n            footer: {\n                save: { title: 'Save', command: 'blocklink.save', type: 'primary' },\n                cancel: { title: 'Cancel', command: 'popup.close' }\n\n            }\n        });\n\n        // data\n        var target_url = $block.attr('data-target-url');\n\n        // set form\n        popup.setData({\n            target_url: target_url\n        });\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    save: function(popup) {\n        this.app.popup.close();\n\n        var data = popup.getData();\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        if (data.target_url !== '') {\n            $block.attr('data-target-url', data.target_url);\n        }\n        else {\n            $block.removeAttr('data-target-url');\n        }\n    }\n});","ArticleEditor.add('plugin', 'product-block', {\n    start: function () {\n        this.app.toolbar.add('product-block', {\n            title: 'Product block',\n            icon: '<i class=\"fa fa-product-hunt\"></i>',\n            command: 'product-block.popup',\n            blocks: {\n                all: true,\n                except: ['variable', 'figure', 'paragraph', 'image']\n            }\n        });\n    },\n    popup: function (params, button) {\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        console.log($block.nodes[0].tagName);\n        if ($block.nodes[0].tagName != \"DIV\") {\n            console.log(\"DIV is only allowed\");\n            return;\n        }\n\n        // create\n        var popup = this.app.popup.create('product-block', {\n            title: 'Product block',\n            width: '400px',\n            form: {\n                product_id: { type: 'input', label: 'Product ID' }\n            },\n            footer: {\n                save: { title: 'Save', command: 'product-block.save', type: 'primary' },\n                cancel: { title: 'Cancel', command: 'popup.close' }\n\n            }\n        });\n\n        // data\n        var product_id = $block.attr('data-product-id');\n\n        // set form\n        popup.setData({\n            product_id: product_id\n        });\n\n        // open\n        this.app.popup.open({ button: button });\n    },\n    save: function (popup) {\n        this.app.popup.close();\n\n        var data = popup.getData();\n        var instance = this.app.block.get();\n        var $block = instance.getBlock();\n\n        if (data.product_id !== '') {\n            $block.attr('data-product-id', data.product_id);\n        }\n        else {\n            $block.removeAttr('data-product-id');\n        }\n    }\n});","// Extended FontColor Plugin with Custom Hex Color Input\n// This plugin extends the default fontcolor plugin by adding a custom hex color input field\n\n(function() {\n    // Create a new plugin with a different name (my-fontcolor)\n    ArticleEditor.add('plugin', 'my-fontcolor', {\n        // Define translations\n        translations: { \n            'en': {\n                \"fontcolor\": {\n                    \"title\": \"Text color\",\n                    \"remove\": \"Remove color\",\n                    \"text\": \"Text\",\n                    \"background\": \"Background\",\n                    \"custom\": \"Custom color\",\n                    \"customhex\": \"Enter hex color code\",\n                    \"apply\": \"Apply\"\n                }\n            }\n        },\n\n        // Initialize method\n        init() {\n            let colors = {\n                gray:   ['#212529', '#343a40', '#495057', '#868e96', '#adb5bd', '#ced4da', '#dee2e6', '#e9ecef', '#f1f3f5', '#f8f9fa'],\n                red:    [\"#c92a2a\", \"#e03131\", \"#f03e3e\", \"#fa5252\", \"#ff6b6b\", \"#ff8787\", \"#ffa8a8\", \"#ffc9c9\", \"#ffe3e3\", \"#fff5f5\"],\n                pink:   [\"#a61e4d\", \"#c2255c\", \"#d6336c\", \"#e64980\", \"#f06595\", \"#f783ac\", \"#faa2c1\", \"#fcc2d7\", \"#ffdeeb\", \"#fff0f6\"],\n                grape:  [\"#862e9c\", \"#9c36b5\", \"#ae3ec9\", \"#be4bdb\", \"#cc5de8\", \"#da77f2\", \"#e599f7\", \"#eebefa\", \"#f3d9fa\", \"#f8f0fc\"],\n                violet: [\"#5f3dc4\", \"#6741d9\", \"#7048e8\", \"#7950f2\", \"#845ef7\", \"#9775fa\", \"#b197fc\", \"#d0bfff\", \"#e5dbff\", \"#f3f0ff\"],\n                indigo: [\"#364fc7\", \"#3b5bdb\", \"#4263eb\", \"#4c6ef5\", \"#5c7cfa\", \"#748ffc\", \"#91a7ff\", \"#bac8ff\", \"#dbe4ff\", \"#edf2ff\"],\n                blue:   [\"#1864ab\", \"#1971c2\", \"#1c7ed6\", \"#228be6\", \"#339af0\", \"#4dabf7\", \"#74c0fc\", \"#a5d8ff\", \"#d0ebff\", \"#e7f5ff\"],\n                cyan:   [\"#0b7285\", \"#0c8599\", \"#1098ad\", \"#15aabf\", \"#22b8cf\", \"#3bc9db\", \"#66d9e8\", \"#99e9f2\", \"#c5f6fa\", \"#e3fafc\"],\n                teal:   [\"#087f5b\", \"#099268\", \"#0ca678\", \"#12b886\", \"#20c997\", \"#38d9a9\", \"#63e6be\", \"#96f2d7\", \"#c3fae8\", \"#e6fcf5\"],\n                green:  [\"#2b8a3e\", \"#2f9e44\", \"#37b24d\", \"#40c057\", \"#51cf66\", \"#69db7c\", \"#8ce99a\", \"#b2f2bb\", \"#d3f9d8\", \"#ebfbee\"],\n                lime:   [\"#5c940d\", \"#66a80f\", \"#74b816\", \"#82c91e\", \"#94d82d\", \"#a9e34b\", \"#c0eb75\", \"#d8f5a2\", \"#e9fac8\", \"#f4fce3\"],\n                yellow: [\"#e67700\", \"#f08c00\", \"#f59f00\", \"#fab005\", \"#fcc419\", \"#ffd43b\", \"#ffe066\", \"#ffec99\", \"#fff3bf\", \"#fff9db\"],\n                orange: [\"#d9480f\", \"#e8590c\", \"#f76707\", \"#fd7e14\", \"#ff922b\", \"#ffa94d\", \"#ffc078\", \"#ffd8a8\", \"#ffe8cc\", \"#fff4e6\"]\n            };\n\n            this.colors = (this.opts.fontcolor) ? this.opts.fontcolor : colors;\n        },\n\n        // Start method\n        start() {\n            let button = {\n                title: '## fontcolor.title ##',\n                color: true,\n                icon: '<svg width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.50002 4.16336C8.18972 4.16336 7.89213 4.28662 7.67271 4.50604C7.45329 4.72546 7.33002 5.02305 7.33002 5.33336V6.50336H9.67002V5.33336C9.67002 5.02305 9.54676 4.72546 9.32734 4.50604C9.10792 4.28662 8.81033 4.16336 8.50002 4.16336ZM11.33 5.33336C11.33 4.58279 11.0319 3.86297 10.5011 3.33224C9.97041 2.80152 9.25059 2.50336 8.50002 2.50336C7.74946 2.50336 7.02964 2.80152 6.49891 3.33224C5.96818 3.86297 5.67002 4.58279 5.67002 5.33336V10C5.67002 10.4584 6.04163 10.83 6.50002 10.83C6.95842 10.83 7.33002 10.4584 7.33002 10V8.16336H9.67002V10C9.67002 10.4584 10.0416 10.83 10.5 10.83C10.9584 10.83 11.33 10.4584 11.33 10V5.33336ZM3.00336 12.6667C3.00336 12.2083 3.37496 11.8367 3.83336 11.8367H13.1667C13.6251 11.8367 13.9967 12.2083 13.9967 12.6667C13.9967 13.1251 13.6251 13.4967 13.1667 13.4967H3.83336C3.37496 13.4967 3.00336 13.1251 3.00336 12.6667Z\"/></svg>',\n                blocks: {\n                    all: 'editable',\n                    except: ['code']\n                },\n                command: 'my-fontcolor.popup'\n            };\n\n            // Remove the original fontcolor button (if it exists)\n            if (this.app.toolbar.buttons && this.app.toolbar.buttons.fontcolor) {\n                this.app.toolbar.remove('fontcolor');\n            }\n\n            // Add our custom button\n            this.app.toolbar.add('fontcolor', button);\n        },\n\n        // Use the popup method but extend it to include our custom functionality\n        popup(e, button) {\n            let inlines = this.app.selection.getNodes({ type: 'inline' });\n\n            this.currentColor = false;\n            this.currentBackgroundColor = false;\n\n            if (inlines) {\n                let $inline = this.dom(inlines[0]);\n                let style = this.app.utils.cssToObject($inline.attr('style'));\n                this.currentColor = (style.color) ? style.color : this.currentColor;\n                this.currentBackgroundColor = (style.background) ? style.background : this.currentBackgroundColor;\n            }\n\n            let $dropdown = this.dom('<div class=\"' + this.prefix + '-dropdown-cells\">');\n\n            this.$selector = this._buildSelector();\n\n            this.$selectorText = this._buildSelectorItem('text', this.lang.get('fontcolor.text'));\n            this.$selectorText.addClass('active');\n\n            this.$selectorBack = this._buildSelectorItem('back', this.lang.get('fontcolor.background'));\n\n            this.$selector.append(this.$selectorText);\n            this.$selector.append(this.$selectorBack);\n\n            this.$pickerText = this._buildPicker('textcolor');\n            this.$pickerBack = this._buildPicker('backcolor');\n\n            let width = Math.max(260, Object.keys(this.colors).length * 20);\n\n            $dropdown.append(this.$selector);\n            $dropdown.append(this.$pickerText);\n            $dropdown.append(this.$pickerBack);\n            $dropdown.width(width);\n\n            this._buildSelectorEvents();\n\n            this.app.popup.create('fontcolor', {\n                width: width + 'px',\n                html: $dropdown\n            });\n            this.app.popup.open({ button: button });\n        },\n\n        // Private methods\n        _remove(type) {\n            this.app.popup.close();\n\n            let obj = (type === 'color') ? { style: 'color' } : { style: 'background' };\n            this.app.inline.remove(obj);\n        },\n        _buildSelector() {\n            let $selector = this.dom('<div>');\n            $selector.addClass(this.prefix + '-dropdown-selector');\n\n            return $selector;\n        },\n        _buildSelectorItem(name, title) {\n            let $item = this.dom('<span>');\n            $item.attr('rel', name).html(title);\n            $item.addClass(this.prefix + '-dropdown-not-close');\n\n            return $item;\n        },\n        _buildSelectorEvents() {\n            this.$selectorText.on('click', function(e) {\n                e.preventDefault();\n\n                this.$selectorBack.removeClass('active');\n                this.$selectorText.addClass('active');\n\n                this.$pickerBack.hide();\n                this.$pickerText.show();\n\n            }.bind(this));\n\n            this.$selectorBack.on('click', function(e) {\n                e.preventDefault();\n\n                this.$selectorText.removeClass('active');\n                this.$selectorBack.addClass('active');\n\n                this.$pickerText.hide();\n                this.$pickerBack.show();\n\n            }.bind(this));\n        },\n        _buildPicker(name) {\n            var $box = this.dom('<div class=\"' + this.prefix + '-dropdown-box-' + name + '\">');\n            var $colorBox = this.dom('<div class=\"' + this.prefix + '-form-colors-box\">');\n            var rule = (name == 'backcolor') ? 'background' : 'color';\n            var len = this.colors.length;\n            var self = this;\n\n            // Add preset colors\n            for (let [key, item] of Object.entries(this.colors)) {\n                var $div = this.dom('<div class=\"' + this.prefix + '-form-colors\">');\n\n                for (var i = 0; i < item.length; i++) {\n                    var color = item[i];\n                    var $swatch = this.dom('<a href=\"#\">');\n                    $swatch.attr({ 'rel': color, 'data-rule': rule });\n                    $swatch.css({ 'background-color': color, 'font-size': 0, 'width': '20px', 'height': '20px' });\n                    $swatch.on('click', function(e) {\n                        e.preventDefault();\n                        e.stopPropagation();\n\n                        var $el = this.dom(e.target);\n                        let color = $el.attr('rel');\n                        let style = ($el.data('rule') === 'color') ? { 'color': color } : { 'background': color };\n                        let params = { tag: 'span', style: style };\n\n                        this.app.event.trigger = false;\n                        this.app.inline.set(params);\n                        setTimeout(function() {\n                            this.app.event.trigger = true;\n                        }.bind(this), 100);\n                    }.bind(this));\n\n                    if (rule === 'color' && this.currentColor === color) {\n                        $swatch.addClass('active');\n                    }\n                    if (rule === 'background' && this.currentBackgroundColor === color) {\n                        $swatch.addClass('active');\n                    }\n\n                    $div.append($swatch);\n                }\n\n                $colorBox.append($div);\n            }\n\n            $box.append($colorBox);\n\n            // Add custom color input field\n            var $customColorBox = this.dom('<div class=\"' + this.prefix + '-form-custom-color-box\">');\n            \n            // Create label for custom color\n            // var $customColorLabel = this.dom('<div class=\"' + this.prefix + '-form-custom-color-label\">');\n            // $customColorLabel.html(this.lang.get('fontcolor.custom'));\n            // $customColorBox.append($customColorLabel);\n            \n            // Create input group\n            var $customColorGroup = this.dom('<div class=\"' + this.prefix + '-form-custom-color-group\">');\n            \n            // Create the hex input field\n            var $customColorInput = this.dom('<input type=\"text\" class=\"' + this.prefix + '-form-custom-color-input form-control\">');\n            $customColorInput.attr('placeholder', this.lang.get('fontcolor.customhex'));\n            \n            // Create preview box next to input\n            var $customColorPreview = this.dom('<div class=\"' + this.prefix + '-form-custom-color-preview\">');\n            \n            // Create the apply button\n            var $customColorApply = this.dom('<button class=\"' + this.prefix + '-form-custom-color-apply btn btn-secondary\">');\n            $customColorApply.html(this.lang.get('fontcolor.apply'));\n            \n            // Add event listeners\n            $customColorInput.on('input', function() {\n                var hexValue = $customColorInput.val();\n                // Add hashtag if missing\n                if (hexValue && hexValue.charAt(0) !== '#') {\n                    hexValue = '#' + hexValue;\n                }\n                // Validate hex color\n                if (/^#([0-9A-F]{3}){1,2}$/i.test(hexValue)) {\n                    $customColorPreview.css('background-color', hexValue);\n                }\n            });\n            \n            $customColorApply.on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                \n                var hexValue = $customColorInput.val();\n                // Add hashtag if missing\n                if (hexValue && hexValue.charAt(0) !== '#') {\n                    hexValue = '#' + hexValue;\n                }\n                \n                // Validate hex color\n                if (/^#([0-9A-F]{3}){1,2}$/i.test(hexValue)) {\n                    let style = (rule === 'color') ? { 'color': hexValue } : { 'background': hexValue };\n                    let params = { tag: 'span', style: style };\n                    \n                    this.app.event.trigger = false;\n                    this.app.inline.set(params);\n                    setTimeout(function() {\n                        this.app.event.trigger = true;\n                    }.bind(this), 100);\n                    this.app.popup.close();\n                } else {\n                    // Handle invalid hex color\n                    alert('Please enter a valid hex color code (e.g., #FF0000 or #F00)');\n                }\n            }.bind(this));\n            \n            // Assemble the custom color input group\n            $customColorGroup.append($customColorPreview);\n            $customColorGroup.append($customColorInput);\n            $customColorGroup.append($customColorApply);\n            $customColorBox.append($customColorGroup);\n            \n            // Add custom color box to main box\n            $box.append($customColorBox);\n\n            // Add remove color option\n            var $el = this.dom('<div>').addClass(this.prefix + '-dropdown-remove-item');\n            var $link = this.dom('<a>');\n            $link.attr({ 'href': '#' });\n            $link.html(this.lang.get('fontcolor.remove'));\n            $link.on('click', function(e) {\n                e.preventDefault();\n                self._remove(rule);\n            });\n\n            $el.append($link);\n            $box.append($el);\n\n            if (name == 'backcolor') $box.hide();\n\n            return $box;\n        }\n    });\n})(); "],"names":["$f9c0764c59596a86$var$CodeMirror","$f9c0764c59596a86$exports","Ajax","AjaxRequest","DomCache","DomExpando","Dom","arx_uuid","ArticleEditor","ArticleEditorInit","$ARX","App","settings","post","options","get","request","method","p","extend","url","before","success","error","data","async","headers","toUpperCase","prepareData","xhr","XMLHttpRequest","open","setHeaders","send","prototype","obj1","obj2","Object","keys","forEach","key","indexOf","isFormData","toParams","sign","search","setRequestHeader","bind","window","FormData","isComplete","status","onload","loaded","call","response","parseResponse","json","parseJson","str","o","JSON","parse","e","obj","map","k","encodeURIComponent","join","Date","getTime","selector","context","ready","fn","document","addEventListener","length","nodes","s","c","n","rehtml","test","create","nodeType","childNodes","_isWindowNode","_query","_slice","html","createElement","RegExp","$1","elmns","innerHTML","i","l","push","dataset","value","each","$node","dataindex","dataget","el","index","nextIndex","add","concat","_array","getAll","eq","first","last","contents","len","is","filter","undefined","node","Node","matches","msMatchesSelector","webkitMatchesSelector","not","find","$n","ns","children","parent","parentNode","parents","_context","closest","isNode","next","_sibling","nextElement","prev","prevElement","css","name","style","_getHeightOrWidth","getComputedStyle","attr","checked","_boolean","getAttribute","setAttribute","reDataAttr","attrs","attributes","replacer","g","nodeName","dataName","match","val","replace","_object","_number","parseFloat","type","removeAttr","split","removeAttribute","addClass","_eachClass","removeClass","toggleClass","hasClass","classes","classList","empty","append","text","textContent","after","_inject","frag","insertAdjacentHTML","reverse","insertBefore","nextSibling","elms","appendChild","prepend","firstChild","wrap","wrapper","unwrap","docFrag","createDocumentFragment","child","removeChild","replaceChild","replaceWith","result","remove","clone","events","copy","_clone","_cloneEvents","show","_hasDisplayNone","target","display","hide","scrollTop","isWindow","isDocument","scrollingElement","body","documentElement","parseInt","scrollTo","pageYOffset","offset","_getPos","position","width","_getSize","height","outerWidth","outerHeight","innerWidth","innerHeight","click","_trigger","focus","blur","on","names","handler","one","event","_getEventName","namespace","_getEventNamespace","_getOneHandler","_e","off","testEvent","testNamespace","testEventNamespace","testPositive","_offEvent","serialize","asObject","elements","disabled","z","opt","selected","_params","scroll","scrollIntoView","behavior","fadeIn","speed","anim","_anim","fadeOut","slideUp","slideDown","_queryContext","querySelectorAll","d","getElementById","slice","getElementsByClassName","getElementsByTagName","querySelector","sibling","NodeList","arr","matchedStr","substring","params","_encodeUri","isNaN","res","dom","cloneNode","_events","hasOwnProperty","cname","Math","round","_getDocSize","max","top","offsetTop","left","offsetLeft","rect","getBoundingClientRect","doc","ownerDocument","docElem","win","defaultView","clientTop","pageXOffset","clientLeft","charAt","mode","$targets","fixStyle","tmp","thisStyle","self","apply","arguments","condition","handlers","toString","removeEventListener","splice","currentStyle","speedDef","instance","$elms","$el","instances","ajax","prefix","version","lang","_mixins","_repository","_subscribe","keycodes","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","translations","defaults","localopts","opts","parser","nested","subscribe","trim","module","func","F","mixins","inherit","proto","extended","deep","merge","prop","exception","current","f","__lookupGetter__","__defineGetter__","super","addLang","plugins","content","placeholder","custom","js","editor","classname","sync","drop","addbar","https","padding","markup","mobile","enterKey","scrollTarget","direction","spellcheck","grammarly","notranslate","reloadmarker","minHeight","maxHeight","doctype","csscache","selection","multiple","control","source","image","states","upload","select","selectMethod","clipboard","types","tag","newtab","link","codemirrorSrc","codemirror","state","limit","path","title","sticky","stickyMinHeight","stickyTopOffset","autosave","paste","clean","autoparse","paragraphize","plaintext","linkTarget","images","links","keepStyle","keepClass","keepAttrs","formTags","blockTags","inlineTags","comments","enter","enterinline","tab","spaces","topbar","undoredo","shortcuts","toolbar","buttons","tags","icons","hidden","card","template","noneditable","embed","responsive","script","checkbox","code","line","layer","table","quote","snippets","templates","grid","overlay","right","columns","gutter","patterns","size","nofollow","addbarAdd","addbarHide","format","formatAdd","outset","none","both","align","center","justify","valign","middle","bottom","shortcutsRemove","shortcutsBase","command","disableMode","markerChar","containers","main","bars","denied","incode","form","inline","block","bsmodal","regex","youtube","vimeo","imageurl","aurl1","aurl2","addbarExtend","buttonsObj","observer","parserTags","formatObj","shortcut","div","h1","h2","h3","h4","h5","h6","ol","ul","dl","address","en","$element","uuid","maps","$win","$doc","$body","app","initialSettings","_initer","_priority","_plugins","started","start","isTextarea","isStarted","_initCore","setting","broadcast","_initModules","_initPlugins","_startPriority","_startModules","_startPlugins","_loadModulesAndPlugins","disable","tagName","stop","isStopped","_stopPlugins","_stopPriority","_stopModules","destroy","clearTimeout","typingTimer","unset","blocks","removeAllRanges","close","popup","disableSticky","getOverlay","enable","enableSticky","Event","callbacks","has","broadcastParams","broadcastHtml","args","_name","init","api","namespaces","pop","dump","_call","_iterate","priority","isIn","stopped","Array","isArray","set","id","getter","setter","$block","_build","_buildData","_render","isType","isBlock","isAllowedButton","getType","except","all","isEditable","isFirstLevel","isSecondLevel","editable","isInlineBlock","isAllSelected","isAll","isEmpty","isEmptiable","_cleanEmpty","_isEmpty","emptiable","isCaretStart","caret","getCurrent","$prev","$item","isCaretEnd","getData","getTag","toLowerCase","getTitle","titles","getOffset","getFrame","elOffset","getBlock","getHtml","getPlainText","getTextFromHtml","nl","getOuterHtml","outerHTML","getParent","getNext","getPrev","getChildFirst","getChildLast","getId","getAlign","getValign","getOutset","getCaption","$caption","setData","setEmpty","_addEmptyButton","setSelectAll","setHtml","_buildInstancesInside","setId","setAlign","_removeObjClasses","setValign","setOutset","updatePosition","setCaption","setClassFromObj","duplicate","$clone","duplicateEmpty","insertEmpty","insert","deleteContents","insertion","insertNode","detectPosition","element","build","observe","insertListToList","appendNext","nextType","$items","_appendListHtml","getTopInline","insertHtml","appendToPrev","prevType","change","newInstance","$newBlock","moveUp","_move","moveDown","$target","removeTags","save","$targetBlock","restore","_buildInstanceInside","_buildItems","_buildCaption","_getNameByTag","utils","capitalize","_renderEdit","_renderDraggable","_renderEditable","draggable","preventDefault","removeInvisibleChars","_buildObjClasses","removeEmptyAttrs","$plus","_observe","getElement","$tool","getInput","$input","getValue","setValue","setFocus","trigger","_buildTool","_buildLabel","_buildInputElement","_buildInput","_buildEvent","_has","_getInputParam","_catchSetter","$label","label","input","_get","which","langKey","vars","section","blurclass","focusclass","_buildMain","_buildContainers","$main","_buildBSModal","setBlur","isFocus","elName","_createContainer","_buildRole","getEditor","_createLabel","container","isMobile","createInvisibleChar","createTextNode","searchInvisibleChars","$w","extendArray","removeFromArrayByValue","sumOfArray","reduce","a","b","getObjectIndex","insertToObject","pos","ac","getRandomId","possible","floor","random","escapeRegExp","extendData","_extendDataElements","_setData","serializedData","cssToObject","props","exec","_normalizeValue","convertRgb2hex","getInvertedColor","hex","normalizeColor","r","_removeHexDiese","color","convertShorthex2long","replaceRgbToHex","capture","x","remStart","remEnd","stored","storedComments","_storeTags","storeComments","_trimLinks","_restoreTags","restoreComments","_replaceTag","replacement","_trimLink","_getNode","_isElement","_isInlineTag","hasAttribute","_isBlockTag","isTextNode","isEmptyOrImageInline","noeditattr","isInline","isTag","isVisible","offsetWidth","offsetHeight","getClientRects","isScrollVisible","$scrollTarget","getTarget","docViewBottom","docViewTop","elemTop","getFirstLevel","getDataBlock","getAllInlines","inlines","getClosest","getTypesSelector","getParents","getChildren","count","tolerance","setTimeout","replaceToTag","keepchildnodes","compareStyle","cssSize","entries","hasAttrs","hasStyle","fragment","extractHtmlFromCaret","$secondPart","cloneAttrs","$last","cloneEmpty","elFrom","elTo","$elTo","getAttrs","nodeValue","_isNumber","_getBooleanFromStr","getBlocks","parsertags","extendtags","finalNodes","hasBlocks","hasTextSiblings","hasPrev","previousSibling","hasNext","_isTag","scrolltop","isTarget","$container","_buildFromElement","setColor","stack","getName","setBackground","isButton","isAddbar","isControl","getParams","$button","getDimension","_background","resetBackground","$icon","invert","_buildTitle","_buildElement","_buildIcon","_buildTooltip","_buildBackground","_buildPosition","isIcon","span","_buildIconElement","icon","tooltip","background","_findPositionElement","_stop","stopPropagation","_catch","$btn","eventname","_cleanTitle","_getButton","isOpen","$tooltip","_create","_setPosition","_fixBSModal","sel","range","collapsed","startContainer","createContainer","$div","firstNode","lastNode","getContent","isPlainText","escapeHtml","setContent","clipboardData","unparse","cm","fromTextArea","setSize","toTextArea","box","cover","files","_buildParams","_send","complete","_complete","setImage","$image","$remove","$placeholder","_buildImage","_buildRemove","_buildByInput","_buildByBox","$box","_click","_removeImage","_buildBox","_buildPlaceholder","_buildAccept","_buildMultiple","_buildEvents","_getUploadParam","_change","_drop","_dragover","_dragleave","_setStatus","_removeStatus","dataTransfer","_sendData","progress","$progress","$progressBar","_sending","_getName","callback","update","_buildItem","$statusbar","clear","hotkeys","hotkeysShiftNums","_remove","button","meta","navigator","platform","items","_buildPopupItems","handle","triggered","ctrlKey","metaKey","shoftKey","altKey","$title","$kbd","_handler","special","keyCode","character","String","fromCharCode","modif","cmdKeys","specialKey","object","_getEl","getWinNode","getSelection","rangeCount","getRangeAt","contains","anchorNode","cloned","cloneRange","selectNodeContents","setEnd","startOffset","end","charIndex","getDocNode","createRange","nodeStack","foundStart","setStart","collapse","nextCharIndex","setRange","getLayout","$marker","setStartAfter","setEndBefore","_restoreInject","fix","setWinFocus","$editor","textNode","storage","passed","undoStorage","redoStorage","load","_isUndo","_isRedo","_createState","_setState","_addState","listen","undo","redo","_hasUndo","_getUndo","_setRedo","$parsed","_rebuild","_hasRedo","ctrl","shiftKey","_removeOverStorage","syncedHtml","_getHtml","_sync","invoke","$layout","handleClick","toggle","observerTimer","indent","item","isIndent","$prevChild","$list","listTag","$newList","outdent","isOutdent","nextItems","$listItem","$liItem","$next","_getAllNext","cleanHtml","exceptedTags","isPages","_isPages","isMsWord","_isHtmlMsWord","isEditor","_isEditor","store","removeDoctype","removeComments","removeTagsWithContent","_cleanPages","_cleanGDocs","_encodePhp","removeTagsExcept","_cleanMsWord","restored","pasteEvent","filterClass","filterAttrs","cacheStyle","removeStyleAttr","removeEmptyInlines","_placeListToItem","$li","_parseWordLists","lines","space","lastLevel","$listChild","level","txt","encodeAttrSings","t","ownLine","contOwnLine","lineBefore","lineAfter","newLevel","codeLength","point","out","cont","cleanlevel","substr","getTabs","placeTag","cleanTag","finish","j","decodeAttrSings","m","tagout","suffix","tidy","$source","_handleFocus","_handleChanges","handleTextareaTab","unselectAll","disableUI","setToggled","enableUI","unsetToggled","_selectors","paragraphizer","encodeEntities","decodeEntities","encodeCode","_encodeCode","decodeHref","sanitize","_sanitizeSrc","_sanitizeHref","_sanitizeEvents","storedIndex","selectors","matched","_getElementsFromHtml","_store","_cacheStyle","recacheStyle","_recacheStyle","cacheElementStyle","recacheElementStyle","fixListMargin","ml","pl","unfixListMargin","addNofollow","addHttps","addSpaceToBlocks","addBrToBlocks","addPredefinedTagClass","addPredefinedBlockClass","getPredefinedBlocks","getPredefinedTags","getText","rv","getPropertyValue","br","trimlines","$tmp","getRange","endContainer","endOffset","extractContents","isEmptyHtml","emptyparagraph","isLine","re","$0","removeMarkers","removeEmptySpans","_removeEmptySpan","_removeEmptyTag","removeBlockTags","removeBlockTagsInside","blockListTags","_removeBlockTagsInside","removeInlineStyles","src","_encodeNode","encoded","_encodeNodeHtml","singleTags","reTags","y","_formatLinks","imagesMatches","_splitBlock","_restoreReplaced","protocol","_subLinkText","decodeURIComponent","_isInPage","_isInline","_isNon","removeblocks","trimmed","isCollapsed","_getPosition","_setStart","_getInlineInside","_setStartInline","_insertInvisibleNode","_setEnd","lastChild","_setBefore","setStartBefore","_setAfter","inside","$cloned","_trimmed","caretRange","cloneContents","brEnd","savedSelection","savedMarker","savedPosition","savedRange","_getSelection","_getRange","_getCurrent","_getCollapsed","_getParent","getNodes","_filterNodes","_getElement","getInline","num","getPosition","addRange","collapseToStart","collapseToEnd","saveMarker","marker","restoreMarker","_getNextNode","_getRangeNodes","commonAncestor","commonAncestorContainer","isLayout","_getAllRangeNodes","_filterByTypes","_filterBySelected","_filterByType","_filterByTags","_isInNodesArray","isTagName","_containsNodeText","_isTextSelected","_isBackwards","backwards","anchorOffset","focusNode","focusOffset","detach","treeWalker","createTreeWalker","NodeFilter","SHOW_TEXT","acceptNode","FILTER_ACCEPT","nextNode","nodeRange","compareBoundaryPoints","Range","START_TO_START","END_TO_END","$nodes","_formatCollapsed","_formatUncollapsed","observeUI","_insertSplit","removeFormat","$inline","_getTags","hasSameTag","_isSameTag","_isParams","_hasAllSameParams","_hasSameClassname","_setStyle","_hasSameStyle","_setClassname","_setParams","_insertInline","_makeSplit","selectedAll","$blocks","partial","_convertTags","_convertToStrike","execCommand","_revertToInlines","_clearEmptyStyle","_applyParams","normalize","_revertTags","selectAll","$parent","parentObj","_applyParamsToNode","_clearSpanInside","group","optName","isEnd","extractedContent","hasSameArgs","convertable","_isFullySelected","_replaceToStrike","_convertInlineBlocks","_convertTag","_revertInlineBlocks","_revertTag","textDecorationLine","$strike","_clearEmptyStyleAttr","styles","stacks","supername","autoclose","saved","_buildDepth","_stopEvents","stopStack","$popup","opened","_reset","_createStack","setStack","setWidth","getButton","getStack","getBody","getItems","getFooter","getFooterPrimary","getTool","getFormItem","_open","openStack","removeStack","_isPopupTarget","_resetToolbarToggledButton","_closed","closeStacks","_buildHeight","resize","getWidth","w","_buildButton","_buildControl","_buildName","_buildHeader","header","targetHeight","cropHeight","_isButton","_isControl","_buildPositionControl","_buildPositionButton","_buildPositionModal","editorRect","getRect","dim","popupWidth","popupHeight","_isToolbarButton","_isTopbarButton","_setToolbarToggledButton","animation","_startEvents","isPopupSelection","_findActiveStack","_opened","renderFocus","attrname","isActive","active","divider","remover","_buildContainer","_buildShortcut","_buildActive","_buildHidden","_buildDivider","_buildCommand","_buildRemover","getPopup","getInstance","$shortcut","$trash","_catchRemover","builder","footer","defaultWidth","tools","formitems","setItemsData","$stack","getItemsData","$footer","tool","hasForm","hasFooter","footerbuttons","hasItems","direct","_renderItems","render","setActive","_renderWidth","_getPrev","_renderType","_renderHtml","_renderForm","_renderFooter","_renderEnv","_buildBody","_buildFooter","_renderItemPosition","$form","_renderTools","_renderData","_renderTool","$headerbox","_buildClose","$header","$close","_catchClose","isLink","_catchStack","invokeCommand","_invoke","mobileMode","customButtons","_buildFrame","_buildDisabled","_buildBlurClass","_buildOptions","_buildParserTags","_buildStartHtml","_buildLayout","_buildContent","observeStates","buildPredefinedClasses","insertContent","getWin","_setFocusCaret","_setFocusEvent","_enableToolbarButtons","isMobileView","_setSelectAllClass","setFirstLevel","unsetSelectAllClass","addButton","getButtons","getButtonsFromArr","_getContent","padLeft","padRight","getFrameRect","$overlay","getHead","getDoc","contentWindow","adjustHeight","toggleView","run","runEditableBlocks","pause","pauseEditableBlocks","isBlocksSelection","$e","autolink","_createDoctype","scripts","_createScripts","layout","_writeCode","_getContentValue","unparsed","_load","_buildVisibility","_buildEditorCss","_buildCssLink","_buildCustomCss","href","isMark","tstamp","mark","$css","_buildGridCssVar","setProperty","_buildDraggable","_loadImages","_loaded","_setFocusOnStart","_loadedImage","imageslen","$images","_loadImage","timerImg","setInterval","clearInterval","$img","img","_getCaretPosition","_getFocusTarget","getFirst","getLast","write","MutationObserver","subtree","childList","characterData","characterDataOldValue","disconnect","mutations","mutation","buildElement","findTags","findBlocks","datatype","createHtml","_clean","_parse","parseLine","_revertForms","_revertFrames","_unparseAllTags","_unparseDataType","_convertFrames","_convertForms","_parseHtml","_parseType","_parseNested","_isNoneditable","_parseTypeByTag","_isImageBlock","_hasChild","_isGridBlock","_isColumnBlock","_isTextBlock","_isCardBlock","parentTag","$pre","$quote","$script","_getPredefinedTags","_addPredefinedClass","_unparseByType","_convertFrame","_convertForm","_revertFrame","_revertForm","$figcaption","_buildFirstLevel","getSelected","unsetNotFirstLevel","_setFocus","_checkSelected","unsetHover","getEditableBlocks","getSelectedBlocks","getFirstSelected","getLastSelected","removeSelected","traverse","_removeSelectedBlock","$all","$selected","_isBlockActive","isParent","force","_getInstance","_setCaret","_isAction","currentremove","getSrc","observeCard","hasImage","_buildSegments","segments","_appendToEmptyBlock","emptyBlock","dragoverEvent","imageDrag","pressedCmd","isPopupMouseUp","isBlockMouseUp","frame","_runEvents","_pauseEvents","_buildTargets","_buildPreventLinks","onmouseover","_buildHover","oncontextmenu","_getBlock","onclick","_isEditorClick","_setByClick","onmouseup","onmousedown","_setBlock","_setCaretInline","ontouchstart","onkeydown","_buildEventKeysObj","_isCmdPressed","_isEsc","onkeyup","$first","onpaste","_paste","oncopy","_copy","oncut","_cut","ondrop","dt","$over","dropped","_removeDragPlaceholder","ondragstart","ondragover","$pl","ondragleave","oneditorclick","onwinfocus","_isRemoveRanges","ondockeydown","_isEnter","ondocmousedown","ondocclick","_isOutsideEditor","_preventLinks","arrowKeys","isAlphaKeys","_buildTargetEvents","coords","distances","heightIndex","coord","clientY","clientX","distance","hypot","closestIndex","min","targets","_isLinkClick","cleanDrop","insertPoint","insertFromClipboard","rtf","_findLocalImages","_replaceLocalImages","_extractImagesFromRtf","inserted","parseInserted","_action","isMultiple","_copyFromMultiple","_copyFromEditable","_copyFromNonEditable","_cutDeleteContent","parentInstance","reHeader","reImage","_convertHexToBase64","btoa","char","sources","_doSelectAll","handleShiftEnter","handleEnter","handleShiftSpace","handleSpace","handleTab","handleArrow","handleDelete","isBackspace","isDelete","_trimInvisibleChar","inlineEnd","blockEnd","_catchInlineBlock","_doArrow","insertBreakline","insertNewline","selectionStart","selectionEnd","_isNextBlock","_isPrevBlock","_isSiblingInlineBlock","_isInvisibleChar","isChar","charnode","pointer","_isAllSelected","_setEditorEmpty","insertEmptyBlock","activeClass","toggledClass","disableClass","aTags","aTypes","_isToolbar","_buildSticky","_buildActiveButtons","$toolbar","_buildButtons","editorButtons","unsetActive","_isObserveButtons","_getObservedTags","_setActiveKeys","_findButton","_findButtons","isSticky","mainTop","containerTop","_observeSticky","btns","_buildActiveButton","_getCurrentInstance","_createButtons","_isHidden","paddingTop","pathItemClass","_buildRoot","_clear","_buildMultipleItem","_getAll","$path","_selectItem","_createItem","$parents","_buildParentItem","root","_isTopbar","$btns","$topbar","eventName","$control","topOutlineFix","toolbarBottom","frameRect","targetBottom","getFirstInserted","getLastInserted","getInserted","_insert","doublenode","_insertFragment","caretPositionFromPoint","offsetNode","caretRangeFromPoint","_splitInline","splitinline","insertText","isStart","isStartItem","isEndItem","isEmptyItem","$childList","pastemarker","pasteitems","isParse","isClean","isCaret","isPosition","_setContent","_insertContent","_checkEmpty","_checkLine","_parseBuild","_buildParsedNodes","emptyLayer","positions","_isListToList","_cleanSpecial","_parseLine","_insertToEditable","_buildInserted","_buildEditor","_buildCaret","$part","_buildInstance","isSplit","cleaner","buildItems","tin","pin","customItems","_isActiveFormat","_checkSameFormat","_isListToText","_formatListToText","_isTextToList","_formatTextToList","_replaceTo","_buildDefaultFormat","dlist","_getDlistItems","_getListItems","_createItems","_setStyleAndClass","_replaceToBlock","popups","unlink","edit","cancel","$link","getLink","_encodeUrl","_save","_cleanUrl","_setUrl","_setText","_setTarget","rows","caption","_callScripts","_findScripts","_buildCodemirror","getEmbedCode","isResponsive","_getEmbedCode","_createInstance","_isNeedToChange","instgrm","Embeds","process","head","_removeScript","_isHtmlString","_parseUrl","$figure","figure","_isFigure","addResponsive","iframeStart","iframeEnd","yturl","pattern","_createPattern","$grid","$column","column","unit","alt","editcard","dataStates","_createImageByUrl","_createOrSection","_createUploadBox","_createSelectBox","_edit","editCard","_findImages","_addImageState","observeImageLink","observeImageCaption","observeImageWidth","pasteInsertedImages","resolved","fetchImages","blob","_dataURLtoFile","sendFile","responseType","file","File","interval","getAsFile","insertFromBlob","insertByDrop","insertByUpload","insertByUrl","$urlinput","insertFromSelect","insertFromInserted","changeClone","$imageclone","closepopup","imagescount","_createImageFromResponseItem","eventType","getStates","_setImageState","createUploadBox","$upload","createSelectBox","$selectbox","_createImagesBox","_parseList","getdata","_buildEditUpload","_checkImageLoad","_createFormItem","getImage","$imageitem","_buildUpload","$section","_createUrlInput","$urlbutton","_createUrlButton","thumb","dataurl","filename","mime","bstr","atob","u8arr","Uint8Array","charCodeAt","cell","nowrap","addhead","removehead","row","addrowbelow","addrowabove","removerow","addcolumnafter","addcolumnbefore","removecolumn","getFirstCell","addHead","removeHead","$head","$row","_buildRow","addRowBelow","_addRow","addRowAbove","addColumnBefore","_addColumn","addColumnAfter","removeRow","removeColumn","$table","$cell","cellSetting","getNowrap","setNowrap","$newCell","rowIndex","$td","$newRow","base","_buildPopup","$trigger","_buildPreviewContainer","_buildPreview","_buildPreviewName","$span","$segment","_catchSegment","$option","setSelectionRange","clonedInline","$lastPrev","getNextCell","nextRow","getNextRow","getPrevCell","prevRow","getPrevRow","_eachCell","keepbr","$newItem","currentItem","$currentItem","isItemEmpty","decodeURI","$responsive","_buildEmbedCode","$cloneFigcaption","removeResponsive","_getEmbedClass","encodeURI","getFigure","_buildOverlay","getAlt","getLinkUrl","percent","ratio","setAlt","setTarget","setLinkUrl","removeLink","isItemStart","list","isItemEnd","$listInside","getBlockquote","$blockquote","cellInstance","variable","trash","blockcode","_buildInputHandle","_getCode","buttonlink","make","unmake","_hasClass","carousel","_buildBoxItem","$inner","$indicators","blockId","$indicator","_removeItem","$remover","clips","_count","words","characters","arrWords","arrSpaces","statusbar","definedlinks","$select","$text","$url","choose","_is","filelink","choosetype","_buildPopupUpload","spopup","$sbox","insertBySelect","_findFiles","_addFileState","$files","_setFileState","$file","_createFileAndStore","$ul","stringify","$name","$size","_truncateUrl","sizes","fontsize","fonts","fontfamily","font","colors","fontcolor","gray","red","pink","grape","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","currentColor","currentBackgroundColor","$dropdown","$selector","_buildSelector","$selectorText","_buildSelectorItem","$selectorBack","$pickerText","_buildPicker","$pickerBack","_buildSelectorEvents","$colorBox","rule","$swatch","_listen","_handle","handleLen","_hide","ks","arrows","_emit","_isShown","_getActiveItem","_hideForce","_replace","_getFirstItem","_setActive","_setNextActive","_setPrevActive","_getItems","$panel","_getLastItem","itemHeight","itemTop","itemsScrollTop","itemsHeight","handleStr","handleStr2","currentText","hidable","imageposition","getFloat","setFloat","ifloat","minWidth","zIndex","_setResizerPosition","_unparse","$resizer","imageresize","_press","resizerWidth","resizerHeight","h","resizeHandle","pageX","pageY","_release","_getWidth","_getResizableBoxWidth","targetTouches","itemsObj","u","sup","sub","kbd","inlineformat","makebutton","_removeClasses","_getClasses","iconMath","mathjax","delimiters","_decodeSigns","_buildBlock","_renderDisplay","_renderTypeset","delim","_parseDelim","math","_getMathJax","typeset","_renderNode","_getKatex","displayMode","MathJax","katex","_getReplacer","datacode","_encodeSigns","rcont","print","removeformat","reorder","_sortable","$clickItem","$dragItem","oldY","dragging","_makeDragItem","_trashDragItem","framePos","deltaY","isScrollTarget","isFrameScroll","_isFrameScroll","docScrollTop","_moveItem","startStop","endWin","toolbarHeight","scrollPoint","_scroll","subItem","_isOver","_swapItems","step","scrollY","frameHeight","bodyHeight","arxclasses","slideshow","specialchars","chars","_toggle","_removeStyles","_hasClasses","iconTags","$tag","textdirection","currentDir","ltr","rtl","dir","underline","activeKey","htmlStart","storedLinks","_storeLinks","_restoreLinks","$search","iconElements","searchTerm","includes","console","log","target_url","product_id","$customColorBox","$customColorGroup","$customColorInput","$customColorPreview","$customColorApply","hexValue","alert","PShowBlockEditor","PShowBEConfig","PShowBEBaseUri","toolbarTopOffset","tinyMceInterval","textarea","col","colLangSelector","nextElementSibling","valueDOM","DOMParser","parseFromString","valueOnlyDOM","contentDiv","convertDivsToP","divs","from","some","TEXT_NODE","className","cssText","PShowEditorImageUploadControllerURL","PShowEditorImageListControllerURL","PShowThemeCssUri","$","tempBlocks","replacedImages","iframe","pinProductBlockIds","replaceCoverImages","lineNumbers","originalVal","tinymce","editors_id","rel"],"version":3,"file":"index.js.map"}