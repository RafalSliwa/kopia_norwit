var t,e,i,s,a,o,n,r,l,p,h,c;e={},(i={}).settings={},i.post=function(t){return new s("post",t)},i.get=function(t){return new s("get",t)},i.request=function(t,e){return new s(t,e)},(s=function(t,e){this.p=this.extend({method:t,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}},e),this.p=this.extend(this.p,i.settings),this.p.method=this.p.method.toUpperCase(),this.prepareData(),this.xhr=new XMLHttpRequest,this.xhr.open(this.p.method,this.p.url,this.p.async),this.setHeaders(),!1!==("function"!=typeof this.p.before||this.p.before(this.xhr))&&this.send()}).prototype={extend:function(t,e){return e&&Object.keys(e).forEach(function(i){t[i]=e[i]}),t},prepareData:function(){if(-1===["POST","PUT"].indexOf(this.p.method)||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded"),"object"!=typeof this.p.data||this.isFormData()||(this.p.data=this.toParams(this.p.data)),"GET"===this.p.method){var t=-1!==this.p.url.search(/\?/)?"&":"?";this.p.url=this.p.data?this.p.url+t+this.p.data:this.p.url}},setHeaders:function(){this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||"XMLHttpRequest"),Object.keys(this.p.headers).forEach((function(t){this.xhr.setRequestHeader(t,this.p.headers[t])}).bind(this))},isFormData:function(){return void 0!==window.FormData&&this.p.data instanceof window.FormData},isComplete:function(){return!(this.xhr.status<200||this.xhr.status>=300&&304!==this.xhr.status)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){var t;this.isComplete()?(t=this.parseResponse(),"function"==typeof this.p.success&&this.p.success(t,this.xhr)):(t=this.parseResponse(),"function"==typeof this.p.error&&this.p.error(t,this.xhr,this.xhr.status))},parseResponse:function(){var t=this.xhr.response;return this.parseJson(t)||t},parseJson:function(t){try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1},toParams:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}},a=[0],o="data"+new Date().getTime(),(n=function(t,e){return this.parse(t,e)}).ready=function(t){document.addEventListener("DOMContentLoaded",t)},n.prototype={get length(){return this.nodes.length},parse:function(t,e){var i;if(t){if(t instanceof n)return this.nodes=t.nodes,t;i=/^\s*<(\w+|!)[^>]*>/.test(t)?this.create(t):"string"!=typeof t?t.nodeType&&11===t.nodeType?t.childNodes:t.nodeType||this._isWindowNode(t)?[t]:t:this._query(t,e)}else i=[];this.nodes=this._slice(i)},create:function(t){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(t))return[document.createElement(RegExp.$1)];var e=[],i=document.createElement("div");i.innerHTML=t;for(var s=0,a=i.childNodes.length;s<a;s++)e.push(i.childNodes[s]);return e},dataset:function(t,e){return this.each(function(i){a[this.dataindex(i.get())][t]=e})},dataget:function(t){return a[this.dataindex(this.get())][t]},dataindex:function(t){var e=t[o],i=a.length;return e||(e=i,t&&(t[o]=i),a[e]={}),e},add:function(t){return this.nodes=this.nodes.concat(this._array(t)),this},get:function(t){return this.nodes[t||0]||!1},getAll:function(){return this.nodes},eq:function(t){return new n(this.nodes[t])},first:function(){return new n(this.nodes[0])},last:function(){return new n(this.nodes[this.nodes.length-1])},contents:function(){return this.get().childNodes},each:function(t){for(var e=this.nodes.length,i=0;i<e;i++)t.call(this,new n(this.nodes[i]),i);return this},is:function(t){return this.filter(t).length>0},filter:function(t){var e;return void 0===t?this:(e="function"==typeof t?function(e){return t(new n(e))}:function(e){return t&&t.nodeType||t instanceof Node?t===e:(e.matches=e.matches||e.msMatchesSelector||e.webkitMatchesSelector,1===e.nodeType&&e.matches(t||"*"))},new n(this.nodes.filter.call(this.nodes,e)))},not:function(t){return this.filter(function(e){return!new n(e).is(t||!0)})},find:function(t){var e=[];return this.each(function(i){for(var s=i.get(),a=this._query(t,s),o=0;o<a.length;o++)e.push(a[o])}),new n(e)},children:function(t){var e=[];return this.each(function(t){var i=t.get();if(i.children)for(var s=i.children,a=0;a<s.length;a++)e.push(s[a])}),new n(e).filter(t)},parent:function(t){var e=this.get(),i=!!e.parentNode&&e.parentNode;return i?new n(i).filter(t):new n},parents:function(t,e){e=this._context(e);var i=[];return this.each(function(s){for(var a=s.get().parentNode;a&&a!==e;)t?new n(a).is(t)&&i.push(a):i.push(a),a=a.parentNode}),new n(i)},closest:function(t,e){e=this._context(e);var i=[],s=t&&t.nodeType;return this.each(function(a){var o=a.get();do if(o&&(s&&o===t||new n(o).is(t)))return i.push(o);while((o=o.parentNode)&&o!==e)}),new n(i)},next:function(t){return this._sibling(t,"nextSibling")},nextElement:function(t){return this._sibling(t,"nextElementSibling")},prev:function(t){return this._sibling(t,"previousSibling")},prevElement:function(t){return this._sibling(t,"previousElementSibling")},css:function(t,e){if(void 0===e&&"object"!=typeof t){var i=this.get();return"width"===t||"height"===t?i.style?this._getHeightOrWidth(t)+"px":void 0:i.style?getComputedStyle(i,null)[t]:void 0}return this.each(function(i){var s=i.get(),a={};for(var o in"object"==typeof t?a=t:a[t]=e,a)s.style&&(s.style[o]=a[o])})},attr:function(t,e,i){if(i=i?"data-":"",void 0===e&&"object"!=typeof t){var s=this.get();return s&&3!==s.nodeType?"checked"===t?s.checked:this._boolean(s.getAttribute(i+t)):void 0}return this.each(function(s){var a=s.get(),o={};for(var n in"object"==typeof t?o=t:o[t]=e,o)3!==a.nodeType&&("checked"===n?a.checked=o[n]:a.setAttribute(i+n,o[n]))})},data:function(t,e){if(void 0===t||!0===t){var i=/^data-(.+)$/,s=this.get().attributes,a={},o=function(t){return t[1].toUpperCase()};for(var n in s)if(s[n]&&i.test(s[n].nodeName)){var r=s[n].nodeName.match(i)[1],l=s[n].value;!0!==t&&(r=r.replace(/-([a-z])/g,o)),l=-1!==l.search(/^{/)?this._object(l):this._number(l)?parseFloat(l):this._boolean(l),a[r]=l}return a}return this.attr(t,e,!0)},val:function(t){if(void 0===t){var e=this.get();return e.type&&"checkbox"===e.type?e.checked:e.value}return this.each(function(e){var i=e.get();i.type&&"checkbox"===i.type?i.checked=t:i.value=t})},removeAttr:function(t){return this.each(function(e){var i=e.get();t.split(" ").forEach(function(t){3!==i.nodeType&&i.removeAttribute(t)})})},addClass:function(t){return this._eachClass(t,"add")},removeClass:function(t){return this._eachClass(t,"remove")},toggleClass:function(t){return this._eachClass(t,"toggle")},hasClass:function(t){var e=this.get();if(!t)return!1;var i=t.split(" ");return!!e.classList&&e.matches("."+i.join("."))},empty:function(){return this.each(function(t){t.get().innerHTML=""})},html:function(t){return void 0===t?this.get().innerHTML||"":this.empty().append(t)},text:function(t){return void 0===t?this.get().textContent||"":this.each(function(e){e.get().textContent=t})},after:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("afterend",t);else if(null!==e.parentNode)for(var i=t instanceof Node?[t]:this._array(t).reverse(),s=0;s<i.length;s++)e.parentNode.insertBefore(i[s],e.nextSibling);return e})},before:function(t){return this._inject(t,function(t,e){if("string"==typeof t)e.insertAdjacentHTML("beforebegin",t);else for(var i=t instanceof Node?[t]:this._array(t),s=0;s<i.length;s++)e.parentNode.insertBefore(i[s],e);return e})},append:function(t){return this._inject(t,function(t,e){if("string"==typeof t||"number"==typeof t)e.insertAdjacentHTML("beforeend",t);else for(var i=t instanceof Node?[t]:this._array(t),s=0;s<i.length;s++)e.appendChild(i[s]);return e})},prepend:function(t){return this._inject(t,function(t,e){if("string"==typeof t||"number"==typeof t)e.insertAdjacentHTML("afterbegin",t);else for(var i=t instanceof Node?[t]:this._array(t).reverse(),s=0;s<i.length;s++)e.insertBefore(i[s],e.firstChild);return e})},wrap:function(t){return this._inject(t,function(t,e){var i="string"==typeof t||"number"==typeof t?this.create(t)[0]:t instanceof Node?t:this._array(t)[0];return e.parentNode&&e.parentNode.insertBefore(i,e),i.appendChild(e),i})},unwrap:function(){return this.each(function(t){for(var e=t.get(),i=document.createDocumentFragment();e.firstChild;){var s=e.removeChild(e.firstChild);i.appendChild(s)}e.parentNode.replaceChild(i,e)})},replaceWith:function(t){return this._inject(t,function(t,e){for(var i=document.createDocumentFragment(),s="string"==typeof t||"number"==typeof t?this.create(t):t instanceof Node?[t]:this._array(t),a=0;a<s.length;a++)i.appendChild(s[a]);var o=i.childNodes[0];return e.parentNode&&e.parentNode.replaceChild(i,e),o})},remove:function(){return this.each(function(t){var e=t.get();e.parentNode&&e.parentNode.removeChild(e)})},clone:function(t){var e=[];return this.each(function(i){var s=i.get(),a=this._clone(s);t&&(a=this._cloneEvents(s,a)),e.push(a)}),new n(e)},show:function(){return this.each((function(t){var e=t.get();if(e.style&&this._hasDisplayNone(e)){var i=e.getAttribute("domTargetShow");e.style.display=i||"block",e.removeAttribute("domTargetShow")}}).bind(this))},hide:function(){return this.each(function(t){var e=t.get();if(!(!e.style||this._hasDisplayNone(e))){var i=e.style.display;"block"!==i&&e.setAttribute("domTargetShow",i),e.style.display="none"}})},scrollTop:function(t){var e=this.get(),i=this._isWindowNode(e),s=9===e.nodeType?e.scrollingElement||e.body.parentNode||e.body||e.documentElement:e;if(void 0!==t){t=parseInt(t),i?e.scrollTo(0,t):s.scrollTop=t;return}return i?e.pageYOffset:s.scrollTop},offset:function(){return this._getPos("offset")},position:function(){return this._getPos("position")},width:function(t){return void 0!==t?this.css("width",parseInt(t)+"px"):this._getSize("width","Width")},height:function(t){return void 0!==t?this.css("height",parseInt(t)+"px"):this._getSize("height","Height")},outerWidth:function(){return this._getSize("width","Width","outer")},outerHeight:function(){return this._getSize("height","Height","outer")},innerWidth:function(){return this._getSize("width","Width","inner")},innerHeight:function(){return this._getSize("height","Height","inner")},click:function(){return this._trigger("click")},focus:function(){return this._trigger("focus")},blur:function(){return this._trigger("blur")},on:function(t,e,i){return this.each(function(s){for(var a=s.get(),o=t.split(" "),n=0;n<o.length;n++){var r=this._getEventName(o[n]),l=this._getEventNamespace(o[n]);e=i?this._getOneHandler(e,t):e,a.addEventListener(r,e),a._e=a._e||{},a._e[l]=a._e[l]||{},a._e[l][r]=a._e[l][r]||[],a._e[l][r].push(e)}})},one:function(t,e){return this.on(t,e,!0)},off:function(t,e){var i=function(t,e,i){return t===i},s=function(t,e,i,s){return e===s},a=function(t,e,i,s){return t===i&&e===s},o=function(){return!0};return void 0===t?this.each(function(t){this._offEvent(t.get(),!1,!1,e,o)}):this.each(function(o){for(var n=o.get(),r=t.split(" "),l=0;l<r.length;l++){var p=this._getEventName(r[l]),h=this._getEventNamespace(r[l]);"_events"===h?this._offEvent(n,p,h,e,i):p||"_events"===h?this._offEvent(n,p,h,e,a):this._offEvent(n,p,h,e,s)}})},serialize:function(t){for(var e={},i=this.get().elements,s=0;s<i.length;s++){var a=i[s];if((!/(checkbox|radio)/.test(a.type)||a.checked)&&a.name&&!a.disabled&&"file"!==a.type){if("select-multiple"===a.type)for(var o=0;o<a.options.length;o++){var n=a.options[o];n.selected&&(e[a.name]=n.value)}e[a.name]=this._number(a.value)?parseFloat(a.value):this._boolean(a.value)}}return t?e:this._params(e)},scroll:function(){this.get().scrollIntoView({behavior:"smooth"})},fadeIn:function(t,e){var i=this._anim(t,e,500);return this.each(function(t){t.css({display:"block",opacity:0,animation:"fadeIn "+i.speed+"s ease-in-out"}).removeClass("hidden"),t.one("animationend",function(){t.css({opacity:"",animation:""}),i.fn&&i.fn(t)})})},fadeOut:function(t,e){var i=this._anim(t,e,300);return this.each(function(t){t.css({opacity:1,animation:"fadeOut "+i.speed+"s ease-in-out"}),t.one("animationend",function(){t.css({display:"none",opacity:"",animation:""}),i.fn&&i.fn(t)})})},slideUp:function(t,e){var i=this._anim(t,e,300);return this.each(function(t){t.height(t.height()),t.css({overflow:"hidden",animation:"slideUp "+i.speed+"s ease-out"}),t.one("animationend",function(){t.css({display:"none",height:"",animation:""}),i.fn&&i.fn(t)})})},slideDown:function(t,e){var i=this._anim(t,e,400);return this.each(function(t){t.height(t.height()),t.css({display:"block",overflow:"hidden",animation:"slideDown "+i.speed+"s ease-in-out"}).removeClass("hidden"),t.one("animationend",function(){t.css({overflow:"",height:"",animation:""}),i.fn&&i.fn(t)})})},_queryContext:function(t,e){return 3!==(e=this._context(e)).nodeType&&"function"==typeof e.querySelectorAll?e.querySelectorAll(t):[]},_query:function(t,e){var i=document;if(e)return this._queryContext(t,e);if(/^[.#]?[\w-]*$/.test(t)){if("#"===t[0]){var s=i.getElementById(t.slice(1));return s?[s]:[]}return"."===t[0]?i.getElementsByClassName(t.slice(1)):i.getElementsByTagName(t)}return i.querySelectorAll(t)},_context:function(t){return t?"string"==typeof t?document.querySelector(t):t:document},_sibling:function(t,e){var i,s=t&&t.nodeType;return this.each(function(a){var o=a.get();do if((o=o[e])&&(s&&o===t||new n(o).is(t))){i=o;return}while(o)}),new n(i)},_slice:function(t){return t&&0!==t.length?t.length?[].slice.call(t.nodes||t):[t]:[]},_array:function(t){if(void 0===t)return[];if(t instanceof NodeList){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}return t instanceof n?t.nodes:t},_object:function(t){return JSON.parse(t.replace(/(\w+:)|(\w+ :)/g,function(t){return'"'+t.substring(0,t.length-1)+'":'}))},_params:function(t){var e="";return Object.keys(t).forEach((function(i){e+="&"+this._encodeUri(i)+"="+this._encodeUri(t[i])}).bind(this)),e.replace(/^&/,"")},_boolean:function(t){return"true"===t||"false"!==t&&t},_number:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))},_inject:function(t,e){for(var i=this.nodes.length,s=[];i--;){var a="function"==typeof t?t.call(this,this.nodes[i]):t,o=0===i?a:this._clone(a),r=e.call(this,o,this.nodes[i]);r&&(r.dom?s.push(r.get()):s.push(r))}return new n(s)},_clone:function(t){if(void 0!==t){if("string"==typeof t)return t;if(t instanceof Node||t.nodeType)return t.cloneNode(!0);if("length"in t)return[].map.call(this._array(t),function(t){return t.cloneNode(!0)})}},_cloneEvents:function(t,e){var i=t._e;if(i){for(var s in e._e=i,i._events)if(i._events.hasOwnProperty(s))for(var a=0;a<i._events[s].length;a++)e.addEventListener(s,i._events[s][a])}return e},_trigger:function(t){var e=this.get();return e&&3!==e.nodeType&&e[t](),this},_encodeUri:function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_getSize:function(t,e){var i=this.get();return Math.round(3===i.nodeType?0:9===i.nodeType?this._getDocSize(i,e):this._isWindowNode(i)?window["inner"+e]:this._getHeightOrWidth(t))},_getDocSize:function(t,e){var i=t.body,s=t.documentElement;return Math.max(i["scroll"+e],i["offset"+e],s["client"+e],s["scroll"+e],s["offset"+e])},_getPos:function(t){var e=this.get();if(3===e.nodeType||this._isWindowNode(e)||9===e.nodeType);else if("position"===t)return{top:e.offsetTop,left:e.offsetLeft};else if("offset"===t){var i=e.getBoundingClientRect(),s=e.ownerDocument,a=s.documentElement,o=s.defaultView;return{top:i.top+o.pageYOffset-a.clientTop,left:i.left+o.pageXOffset-a.clientLeft}}return{top:0,left:0}},_getHeightOrWidth:function(t,e){var i=t.charAt(0).toUpperCase()+t.slice(1),s=e||"offset",a=0,o=this.get(),n=getComputedStyle(o,null),r=this.parents().filter(function(t){var e=t.get();return 1===e.nodeType&&"none"===getComputedStyle(e,null).display&&e});if("none"===n.display&&r.add(o),0!==r.length){var l="visibility: hidden !important; display: block !important;",p=[];r.each(function(t){var e=t.attr("style");null!==e&&p.push(e),t.attr("style",null!==e?e+";"+l:l)}),a=o[s+i],r.each(function(t,e){void 0===p[e]?t.removeAttr("style"):t.attr("style",p[e])})}else a=o[s+i];return a},_eachClass:function(t,e){return this.each(function(i){if(t){var s=i.get();t.split(" ").forEach(function(t){s.classList&&s.classList[e](t)})}})},_getOneHandler:function(t,e){var i=this;return function(){t.apply(this,arguments),i.off(e)}},_getEventNamespace:function(t){var e=t.split("."),i=e[1]?e[1]:"_events";return e[2]?i+e[2]:i},_getEventName:function(t){return t.split(".")[0]},_offEvent:function(t,e,i,s,a){for(var o in t._e)if(t._e.hasOwnProperty(o)){for(var n in t._e[o])if(a(n,o,e,i))for(var r=t._e[o][n],l=0;l<r.length;l++)(void 0===s||r[l].toString()===s.toString())&&(t.removeEventListener(n,r[l]),t._e[o][n].splice(l,1),0===t._e[o][n].length&&delete t._e[o][n],0===Object.keys(t._e[o]).length&&delete t._e[o])}},_hasDisplayNone:function(t){return"none"===t.style.display||(t.currentStyle?t.currentStyle.display:getComputedStyle(t,null).display)==="none"},_anim:function(t,e,i){return"function"==typeof t?(e=t,t=i):t=t||i,{fn:e,speed:t/1e3}},_isWindowNode:function(t){return t===window||t.parent&&t.parent===window}},r=0,l=function(t,e){return p(t,e)},p=function(t,e){var i;return h.dom(t).each(function(t){!(i=t.dataget(h.namespace))&&(i=new c(t,e,r),t.dataset(h.namespace,i),h.instances[r]=i,r++)}),i},(h=l).dom=function(t,e){return new n(t,e)},h.ajax=i,h.instances=[],h.namespace="article-editor",h.prefix="arx",h.version="2.4.10",h.settings={},h.lang={},h._mixins={},h._repository={},h._subscribe={},h.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37},h.add=function(t,e,i){if(i.translations&&(h.lang=h.extend(!0,h.lang,i.translations)),i.defaults){var s={};s[e]=i.defaults,h.opts=h.extend(!0,h.opts,s)}if(i.parser){var a={};a[i.type]=i.parser,h.opts.parser=h.extend({},!0,h.opts.parser,a)}if(i.nested&&h.opts.nested.push(i.type),"mixin"===t)h._mixins[e]=i;else{if(i.subscribe){for(var o in i.subscribe)if(i.subscribe.hasOwnProperty(o))for(var n=o.split(","),r=0;r<n.length;r++){var l=n[r].trim();void 0===h._subscribe[l]&&(h._subscribe[l]=[]),h._subscribe[l].push({module:e,func:i.subscribe[o]})}}var p=function(){};if(p.prototype=i,i.mixins)for(var c=0;c<i.mixins.length;c++)h.inherit(p,h._mixins[i.mixins[c]]);h._repository[e]={type:t,proto:p,obj:i}}},h.extend=function(){var t={},e=!1,i=0,s=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);i<s;i++){var a=arguments[i];!function(i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e&&"[object Object]"===Object.prototype.toString.call(i[s])?t[s]=h.extend(!0,t[s],i[s]):t[s]=i[s])}(a)}return t},h.error=function(t){throw t},h.inherit=function(t,e){var i=function(){};i.prototype=e;var s=new i;for(var a in t.prototype)t.prototype.__lookupGetter__(a)?s.__defineGetter__(a,t.prototype.__lookupGetter__(a)):s[a]=t.prototype[a];return t.prototype=s,t.prototype.super=e,t},h.addLang=function(t,e){void 0===h.lang[t]&&(h.lang[t]={}),h.lang[t]=h.extend(!0,h.lang[t],e)},l.opts={plugins:[],content:!1,placeholder:!1,css:!1,custom:{css:!1,js:!1},editor:{classname:"entry",disabled:!1,focus:!1,sync:!0,drop:!0,lang:"en",add:"top",addbar:!1,https:!1,padding:!0,markup:"paragraph",mobile:400,enterKey:!0,scrollTarget:window,direction:"ltr",spellcheck:!0,grammarly:!0,notranslate:!1,reloadmarker:!0,minHeight:"100px",maxHeight:!1,doctype:"<!doctype html>",csscache:!1},selection:{multiple:!0},control:!0,source:!0,image:{states:!0,upload:!1,url:!0,select:!1,selectMethod:"get",name:"file",data:!1,drop:!0,multiple:!0,clipboard:!0,types:["image/*"],tag:"figure",newtab:!1,link:!0,width:!1},classes:!1,codemirrorSrc:!1,codemirror:!1,state:{limit:100},path:{title:"## editor.title ##",sticky:!0,stickyMinHeight:200,stickyTopOffset:0},autosave:{url:!1,name:!1,data:!1,method:"post"},paste:{clean:!0,autoparse:!0,paragraphize:!0,plaintext:!1,linkTarget:!1,images:!0,links:!0,keepStyle:[],keepClass:[],keepAttrs:["td","th"],formTags:["form","input","button","select","textarea","legend","fieldset"],blockTags:["pre","div","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","hr","figure","iframe","figcaption","address","section","header","footer","aside","article","audio","source"],inlineTags:["a","svg","img","br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i","abbr"]},clean:{comments:!1,enter:!0,enterinline:!1},tab:{key:!0,spaces:!1},topbar:{undoredo:!1,shortcuts:!0},toolbar:{hide:[],sticky:!0,stickyMinHeight:200,stickyTopOffset:0},buttons:{editor:["add","template","mobile","html"],topbar:["undo","redo","shortcut"],toolbar:!1,tags:{b:["bold"],strong:["bold"],i:["italic"],em:["italic"],del:["deleted"],u:["underline"],a:["link"]},types:!1,icons:!1,hidden:{}},card:{classname:"card",template:'<div class="card"><div class="card-head"><h3>Card title</h3></div><div class="card-body"><p>Card body</p></div></div>'},text:{classname:"arx-text"},noneditable:{classname:"noneditable"},embed:{responsive:"embed-responsive",script:!0,checkbox:!1},code:{template:"<pre></pre>",spaces:4},line:!0,layer:{template:"<div></div>"},table:{template:"<table><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>"},quote:{template:"<blockquote><p>Quote...</p><p><cite>Author Attribution</cite></p></blockquote>"},snippets:!1,templates:!1,grid:{classname:"grid",classes:"",overlay:!0,offset:{left:0,right:0},columns:12,gutter:"1.25rem",patterns:{"6|6":"column column-6|column column-6","4|4|4":"column column-4|column column-4|column column-4","3|3|3|3":"column column-3|column column-3|column column-3|column column-3","2|2|2|2|2|2":"column column-2|column column-2|column column-2|column column-2|column column-2|column column-2","3|6|3":"column column-3|column column-6|column column-3","2|8|2":"column column-2|column column-8|column column-2","5|7":"column column-5|column column-7","7|5":"column column-7|column column-5","4|8":"column column-4|column column-8","8|4":"column column-8|column column-4","3|9":"column column-3|column column-9","9|3":"column column-9|column column-3","2|10":"column column-2|column column-10","10|2":"column column-10|column column-2",12:"column column-12"}},link:{size:30,nofollow:!1,target:!1},addbar:["paragraph","image","embed","line","table","snippet","quote","code","grid","layer"],addbarAdd:[],addbarHide:[],format:["p","h1","h2","h3","ul","ol"],formatAdd:!1,outset:{none:"none",left:"outset-left",both:"outset-both",right:"outset-right"},align:{left:"align-left",center:"align-center",right:"align-right",justify:"align-justify"},valign:{none:"none",top:"valign-top",middle:"valign-middle",bottom:"valign-bottom"},shortcutsRemove:!1,shortcutsBase:{"meta+z":"## shortcuts.meta-z ##","meta+shift+z":"## shortcuts.meta-shift-z ##","meta+a":"## shortcuts.meta-a ##","meta+shift+a":"## shortcuts.meta-shift-a ##","meta+click":"## shortcuts.meta-click ##"},shortcuts:{"ctrl+shift+d, meta+shift+d":{title:"## shortcuts.meta-shift-d ##",name:"meta+shift+d",command:"block.duplicate"},"ctrl+shift+up, meta+shift+up":{title:"## shortcuts.meta-shift-up ##",name:"meta+shift+&uarr;",command:"block.moveUp"},"ctrl+shift+down, meta+shift+down":{title:"## shortcuts.meta-shift-down ##",name:"meta+shift+&darr;",command:"block.moveDown"},"ctrl+shift+m, meta+shift+m":{title:"## shortcuts.meta-shift-m ##",name:"meta+shift+m",command:"inline.removeFormat"},"ctrl+b, meta+b":{title:"## shortcuts.meta-b ##",name:"meta+b",command:"inline.set",params:{tag:"b"}},"ctrl+i, meta+i":{title:"## shortcuts.meta-i ##",name:"meta+i",command:"inline.set",params:{tag:"i"}},"ctrl+u, meta+u":{title:"## shortcuts.meta-u ##",name:"meta+u",command:"inline.set",params:{tag:"u"}},"ctrl+h, meta+h":{title:"## shortcuts.meta-h ##",name:"meta+h",command:"inline.set",params:{tag:"sup"}},"ctrl+l, meta+l":{title:"## shortcuts.meta-l ##",name:"meta+l",command:"inline.set",params:{tag:"sub"}},"ctrl+alt+0, meta+alt+0":{title:"## shortcuts.meta-alt-0 ##",name:"meta+alt+0",command:"block.format",params:{tag:"p"}},"ctrl+alt+1, meta+alt+1":{title:"## shortcuts.meta-alt-1 ##",name:"meta+alt+1",command:"block.format",params:{tag:"h1"}},"ctrl+alt+2, meta+alt+2":{title:"## shortcuts.meta-alt-2 ##",name:"meta+alt+2",command:"block.format",params:{tag:"h2"}},"ctrl+alt+3, meta+alt+3":{title:"## shortcuts.meta-alt-3 ##",name:"meta+alt+3",command:"block.format",params:{tag:"h3"}},"ctrl+alt+4, meta+alt+4":{title:"## shortcuts.meta-alt-4 ##",name:"meta+alt+4",command:"block.format",params:{tag:"h4"}},"ctrl+alt+5, meta+alt+5":{title:"## shortcuts.meta-alt-5 ##",name:"meta+alt+5",command:"block.format",params:{tag:"h5"}},"ctrl+alt+6, meta+alt+6":{title:"## shortcuts.meta-alt-6 ##",name:"meta+alt+6",command:"block.format",params:{tag:"h6"}},"ctrl+shift+7, meta+shift+7":{title:"## shortcuts.meta-shift-7 ##",name:"meta+shift+7",command:"block.format",params:{tag:"ol"}},"ctrl+shift+8, meta+shift+8":{title:"## shortcuts.meta-shift-8 ##",name:"meta+shift+8",command:"block.format",params:{tag:"ul"}},"ctrl+], meta+]":{title:"## shortcuts.meta-indent ##",name:"meta+]",command:"list.indent"},"ctrl+[, meta+[":{title:"## shortcuts.meta-outdent ##",name:"meta+[",command:"list.outdent"},"ctrl+k, meta+k":{title:"## shortcuts.meta-k ##",name:"meta+k",command:"link.format"}},disableMode:!1,markerChar:"\uFEFF",containers:{main:["bars","editor","source","statusbar"],bars:["pathbar","toolbar"]},tags:{denied:["font","html","head","link","title","body","meta","applet","marquee"],incode:["!DOCTYPE","!doctype","html","head","link","title","body","meta","textarea","style"],form:["form","input","button","select","textarea","legend","fieldset"],inline:["a","svg","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small","abbr"],block:["pre","hr","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","table","tbody","thead","tfoot","tr","th","td","blockquote","output","figcaption","figure","address","main","section","header","footer","aside","article","iframe","audio","source"],parser:["pre","hr","ul","ol","dl","p","h1","h2","h3","h4","h5","h6","div","table","address","blockquote","figure","main","section","header","footer","aside","article","iframe"]},bsmodal:!1,regex:{youtube:/^https?\:\/\/(?:www\.youtube(?:\-nocookie)?\.com\/|m\.youtube\.com\/|youtube\.com\/)?(?:ytscreeningroom\?vi?=|youtu\.be\/|vi?\/|user\/.+\/u\/\w{1,2}\/|embed\/|watch\?(?:.*\&)?vi?=|\&vi?=|\?(?:.*\&)?vi?=)([^#\&\?\n\/<>"']*)/gi,vimeo:/(http|https)?:\/\/(?:www.|player.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:\/[a-zA-Z0-9_-]+)?/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z\u00F0-\u02AF0-9()!@:%_+.~#?&//=]*)/gi,aurl1:/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,aurl2:/(^|[^\/])(www\.[\S]+(\b|$))/gim},addbarExtend:{},buttonsObj:{undo:{title:"## buttons.undo ##",command:"state.undo"},redo:{title:"## buttons.redo ##",command:"state.redo"},shortcut:{title:"## buttons.shortcuts ##",observer:"shortcut.observe",command:"shortcut.popup"},template:{title:"## buttons.templates ##",command:"template.popup",observer:"template.observe"},mobile:{title:"## buttons.mobile-view ##",command:"editor.toggleView"},html:{title:"## buttons.html ##",command:"source.toggle"},paragraph:{title:"## blocks.paragraph ##",command:"block.add"},image:{title:"## blocks.image ##",command:"image.popup",observer:"image.observe"},embed:{title:"## blocks.embed ##",command:"embed.popup",observer:"embed.observe"},line:{title:"## blocks.line ##",command:"block.add",observer:"block.observe"},table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe"},snippet:{title:"## blocks.snippet ##",command:"snippet.popup",observer:"snippet.observe"},quote:{title:"## blocks.quote ##",command:"block.add",observer:"block.observe"},text:{title:"## blocks.text ##",command:"block.add"},code:{title:"## blocks.code ##",command:"block.add",observer:"block.observe"},grid:{title:"## blocks.grid ##",command:"grid.popup",observer:"grid.observe"},layer:{title:"## blocks.layer ##",command:"block.add",observer:"block.observe"},card:{title:"## blocks.card ##",command:"block.add"},trash:{title:"## buttons.delete ##",command:"block.remove"}},nested:[],parser:{},parserTags:[],formatObj:{p:{title:"## blocks.paragraph ##",type:"paragraph",shortcut:"Ctrl+Alt+0"},div:{title:"## blocks.text ##",type:"text"},h1:{title:'<span style="font-size: 20px; font-weight: bold;">## headings.h1 ##</span>',type:"heading",shortcut:"Ctrl+Alt+1"},h2:{title:'<span style="font-size: 16px; font-weight: bold;">## headings.h2 ##</span>',type:"heading",shortcut:"Ctrl+Alt+2"},h3:{title:'<span style="font-weight: bold;">## headings.h3 ##</span>',type:"heading",shortcut:"Ctrl+Alt+3"},h4:{title:'<span style="font-weight: bold;">## headings.h4 ##</span>',type:"heading",shortcut:"Ctrl+Alt+4"},h5:{title:'<span style="font-weight: bold;">## headings.h5 ##</span>',type:"heading",shortcut:"Ctrl+Alt+5"},h6:{title:'<span style="font-weight: bold;">## headings.h6 ##</span>',type:"heading",shortcut:"Ctrl+Alt+6"},ol:{title:"1. ## list.ordered-list ##",type:"list",shortcut:"Ctrl+Shift+7"},ul:{title:"&bull; ## list.unordered-list ##",type:"list",shortcut:"Ctrl+Shift+8"},dl:{title:"## blocks.dlist ##",type:"dlist"},address:{title:"<em>## blocks.address ##</em>",type:"address"}}},l.lang.en={accessibility:{"help-label":"Rich text editor"},editor:{title:"Article",multiple:"Multiple"},placeholders:{figcaption:"Type caption (optional)",text:"Type something...",code:"Edit to add code...",layer:"Press enter to add a new text..."},popup:{link:"Link",add:"Add",grid:"Grid",back:"Back",image:"Image",snippets:"Snippets","add-image":"Add Image"},shortcuts:{"meta-a":"Select text in the block","meta-shift-a":"Select all blocks","meta-click":"Select multiple blocks","meta-z":"Undo","meta-shift-z":"Redo","meta-shift-m":"Remove inline format","meta-b":"Bold","meta-i":"Italic","meta-u":"Underline","meta-h":"Superscript","meta-l":"Subscript","meta-k":"Link","meta-alt-0":"Normal text","meta-alt-1":"Heading 1","meta-alt-2":"Heading 2","meta-alt-3":"Heading 3","meta-alt-4":"Heading 4","meta-alt-5":"Heading 5","meta-alt-6":"Heading 6","meta-shift-7":"Ordered List","meta-shift-8":"Unordered List","meta-indent":"Indent","meta-outdent":"Outdent","meta-shift-backspace":"Delete block","meta-shift-d":"Duplicate block","meta-shift-up":"Move line up","meta-shift-down":"Move line down"},headings:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},inline:{bold:"Bold",italic:"Italic",deleted:"Deleted"},list:{"unordered-list":"Unordered List","ordered-list":"Ordered List",indent:"Indent",outdent:"Outdent"},link:{link:"Link","edit-link":"Edit link",unlink:"Unlink","link-in-new-tab":"Open link in new tab",save:"Save",insert:"Insert",cancel:"Cancel",text:"Text",url:"URL"},table:{width:"Width",nowrap:"Nowrap",save:"Save",cancel:"Cancel","table-cell":"Table Cell","add-head":"Add head","remove-head":"Remove head","add-row-below":"Add row below","add-row-above":"Add row above","remove-row":"Remove row","add-column-after":"Add column after","add-column-before":"Add column before","remove-column":"Remove column"},image:{or:"or","alt-text":"Alt Text",save:"Save",link:"Link",width:"Width",delete:"Delete",cancel:"Cancel",insert:"Insert",caption:"Caption","link-in-new-tab":"Open link in new tab","url-placeholder":"Paste url of image...","upload-new-placeholder":"Drag to upload a new image<br>or click to select"},code:{code:"Code",insert:"Insert",save:"Save",cancel:"Cancel"},embed:{embed:"Embed",caption:"Caption",insert:"Insert",save:"Save",cancel:"Cancel",description:"Paste any embed/html code or enter the url (vimeo or youtube video only)","responsive-video":"Responsive video"},upload:{placeholder:"Drag to upload <br>or click to select"},templates:{templates:"Templates"},snippets:{snippets:"Snippets"},form:{link:"Link",url:"Url",text:"Text",name:"Name","alt-text":"Alt Text",image:"Image",upload:"Upload",alignment:"Alignment",outset:"Outset",valign:"Valign"},buttons:{"mobile-view":"Mobile View",cancel:"Cancel",insert:"Insert",unlink:"Unlink",save:"Save",add:"Add","transform-to-text":"Transform to text",align:"Alignment",valign:"Valign",outset:"Outset",indent:"Indent",outdent:"Outdent",head:"Head",row:"Row",cell:"Cell",html:"HTML",templates:"Templates",shortcuts:"Keyboard Shortcuts",format:"Format",bold:"Bold",italic:"Italic",deleted:"Deleted",underline:"Underline",table:"Table",link:"Link",undo:"Undo",redo:"Redo",style:"Style",config:"Config",settings:"Settings",text:"Text",embed:"Embed",grid:"Grid",image:"Image",list:"List",delete:"Delete",duplicate:"Duplicate",sort:"Sort",edit:"Edit",inline:"Inline"},blocks:{noneditable:"Noneditable",paragraph:"Paragraph",heading:"Heading",image:"Image",figcaption:"Figcaption",embed:"Embed",line:"Line",code:"Code",quote:"Quote",quoteitem:"Paragraph",snippet:"Snippet",column:"Column",grid:"Grid",list:"List",table:"Table",layer:"Layer",row:"Row",text:"Text",cell:"Cell",dlist:"Definition List",address:"Address",form:"Form",card:"Card"}},(c=function(t,e,i){for(var s=["keycodes","prefix","dom","ajax","_repository","_subscribe"],a=0;a<s.length;a++)this[s[a]]=h[s[a]];this.uuid=i,this.$win=this.dom(window),this.$doc=this.dom(document),this.$body=this.dom("body"),this.$element=t,this.app=this,this.initialSettings=e,this._initer=["setting","lang"],this._priority=["container","editor","accessibility","state"],this._plugins=[],this.started=!1,this.start()}).prototype={start:function(t){this.isTextarea()&&(this.isStarted()||(t&&(this.initialSettings=t),this._initCore(),this._plugins=this.setting.get("plugins"),this.broadcast("app.before.start"),this._initModules(),this._initPlugins(),this._startPriority(),this._startModules(),this._startPlugins(),this.started=!0,this.broadcast("app.start"),this._loadModulesAndPlugins(),!1!==this.opts.disableMode&&this.disable()))},isStarted:function(){return this.started},isTextarea:function(){return"TEXTAREA"===this.$element.get().tagName},stop:function(){this.isStopped()||(this.broadcast("app.before.stop"),this._stopPlugins(),this._stopPriority(),this._stopModules(),this.started=!1,this.broadcast("app.stop"))},isStopped:function(){return!this.started},destroy:function(){clearTimeout(this.app.sync.typingTimer),this.stop(),this.broadcast("app.destroy"),this.$element.dataset(h.namespace,!1);var t=h.instances.indexOf(this.uuid);t>-1&&h.instances.splice(t,1)},disable:function(){this.block.unset(),this.blocks.unset(),this.selection.removeAllRanges(),this.source.is()&&this.source.close(),this.popup.close(!1),this.toolbar.disableSticky(),this.toolbar.disable(),this.path.disable(),this.topbar.disable(),this.editor.getOverlay().addClass(this.prefix+"-editor-disabled"),this.opts.disableMode=!0},enable:function(){this.toolbar.enableSticky(),this.toolbar.enable(),this.path.enable(),this.topbar.enable(),this.editor.getOverlay().removeClass(this.prefix+"-editor-disabled"),this.opts.disableMode=!1},broadcast:function(t,e){var i=e instanceof c.Event?e:new c.Event(t,e);if(void 0!==this._subscribe[t])for(var s=this._subscribe[t],a=0;a<s.length;a++){var o=this[s[a].module];o&&s[a].func.call(o,i)}var n=this.setting.has("subscribe")?this.setting.get("subscribe"):{};return"function"==typeof n[t]&&n[t].call(this,i),i},broadcastParams:function(t,e){return this.broadcast(t,e).getAll()},broadcastHtml:function(t,e){return this.broadcast(t,{html:e}).get("html")},create:function(t){void 0===this._repository[t]&&h.error('The class "'+t+'" does not exist.');var e,i=[].slice.call(arguments,1),s=new this._repository[t].proto;s._name=t,s.app=this;for(var a=["uuid","prefix","dom","ajax"],o=0;o<a.length;o++)s[a[o]]=this[a[o]];return this.lang&&(s.lang=this.lang),this.opts&&(s.opts=this.opts),s.init&&(e=s.init.apply(s,i)),e||s},api:function(t){for(var e=[].slice.call(arguments,1),i=t.split("."),s=i.pop(),a=this,o=0;o<i.length;o++)a=a[i[o]];if(a&&"function"==typeof a[s])return a[s].apply(a,e)},_initCore:function(){for(var t=0;t<this._initer.length;t++)this[this._initer[t]]=this.create(this._initer[t]);this.setting&&(this.opts=this.setting.dump())},_initModules:function(){for(var t in this._repository)"module"===this._repository[t].type&&-1===this._initer.indexOf(t)&&(this[t]=this.create(t))},_initPlugins:function(){var t=this.setting.get("plugins");for(var e in this._repository)"plugin"===this._repository[e].type&&-1!==t.indexOf(e)&&(this[e]=this.create(e))},_startPriority:function(){for(var t=0;t<this._priority.length;t++)this._call(this[this._priority[t]],"start")},_startModules:function(){this._iterate("module","start")},_startPlugins:function(){this._iterate("plugin","start")},_stopPriority:function(){for(var t=this._priority.slice().reverse(),e=0;e<t.length;e++)this._call(this[t[e]],"stop")},_stopModules:function(){this._iterate("module","stop")},_stopPlugins:function(){this._iterate("plugin","stop")},_loadModulesAndPlugins:function(){this._iterate("module","load"),this._iterate("plugin","load")},_iterate:function(t,e){for(var i in this._repository)if(this._repository.hasOwnProperty(i)){var s="module"===t?"load"===e||-1===this._priority.indexOf(i):-1!==this._plugins.indexOf(i);this._repository[i].type===t&&s&&this._call(this[i],e)}},_call:function(t,e){"function"==typeof t[e]&&t[e].apply(t)}},c.Event=function(t,e){this.name=t,this.params=void 0===e?{}:e,this.stopped=!1},c.Event.prototype={is:function(t){if(!Array.isArray(t))return this.get(t);for(var e=0;e<t.length;e++)if(this.params[t[e]])return!0},has:function(t){return void 0!==this.params[t]},getAll:function(){return this.params},get:function(t){return this.params[t]},set:function(t,e){this.params[t]=e},stop:function(){this.stopped=!0},isStopped:function(){return this.stopped}},l.add("mixin","block",{defaults:{id:{getter:"getId",setter:"setId"},html:{getter:"getHtml",setter:"setHtml"},align:{getter:"getAlign",setter:"setAlign"},valign:{getter:"getValign",setter:"setValign"},outset:{getter:"getOutset",setter:"setOutset"}},init:function(t,e){this.$block=t?this.dom(t):this.create(e),this._build(e),this._buildData(),this._render()},isType:function(t){return -1!==(Array.isArray(t)?t:[t]).indexOf(this.type)},isBlock:function(){return!0},isAllowedButton:function(t,e){var i=this.getType();if(void 0!==this.opts.buttons.hidden[i]){var s=this.opts.buttons.hidden[i];if(Array.isArray(s)&&-1!==s.indexOf(t))return!1}if(void 0===e.blocks)return!0;var a=e.blocks;if(a.except&&-1!==a.except.indexOf(i))return!1;if(Array.isArray(a.types)&&-1!==a.types.indexOf(i))return!0;if(a.all){if(!0===a.all||"all"===a.all||"editable"===a.all&&this.isEditable())return!0;if("first-level"===a.all&&this.isFirstLevel())return!0;if("noneditable"===a.all&&!this.isEditable())return!0}return!1},isFirstLevel:function(){return this.$block.attr("data-"+this.prefix+"-first-level")},isSecondLevel:function(){return -1!==["quoteitem","row","cell"].indexOf(this.type)},isEditable:function(){return void 0!==this.editable&&!0===this.editable},isInlineBlock:function(){return void 0!==this.inline},isAllSelected:function(){return!this.isEditable()||this.app.selection.isAll(this.$block)},isEmpty:function(){if(this.isEmptiable()){if(this.$block.hasClass(this.prefix+"-empty-layer"))return!0;var t=this.$block.html();return t=t.trim(),""===(t=this._cleanEmpty(t))}if(this.isEditable())return this._isEmpty()},isEmptiable:function(){return void 0!==this.emptiable},isCaretStart:function(){if("code"===this.getType())return this.app.caret.is(this.$block,"start",!1,!1);if("list"===this.getType()){var t=this.app.selection.getCurrent();return 0===this.dom(t).closest("li").prev().length&&this.app.caret.is(this.$block,"start")}return!this.isEditable()||this.app.caret.is(this.$block,"start")},isCaretEnd:function(){return"code"===this.getType()?this.app.caret.is(this.$block,"end",!1,!1):"address"===this.getType()?this.app.caret.is(this.$block,"end",!1,!0,!1):!this.isEditable()||this.app.caret.is(this.$block,"end")},getData:function(t){var e={};return Object.keys(this.data).forEach((function(t){e[t]=this[this.data[t].getter].apply(this)}).bind(this)),t?e[t]:e},getType:function(){return this.type},getTag:function(){return!!this.$block&&this.$block.get().tagName.toLowerCase()},getTitle:function(){var t=this.getType(),e=this.lang.get("blocks"),i=this.$block.attr("data-title");return void 0!==e[t]?e[t]:i},getOffset:function(){var t=this.app.editor.getFrame().offset(),e=this.$block.offset();return{top:t.top+e.top,left:t.left+e.left}},getBlock:function(){return this.$block},getHtml:function(){return this.$block.html()},getPlainText:function(){var t=this.$block.html();return this.app.content.getTextFromHtml(t,{nl:!0})},getOuterHtml:function(){return this.$block.get().outerHTML},getParent:function(t){t=t?"="+t:"";var e=this.$block.parent().closest("[data-"+this.prefix+"-type"+t+"]");return 0!==e.length&&e.dataget("instance")},getNext:function(t){t=t?"="+t:"";var e=this.$block.nextElement();return!!(0!==e.length&&e.is("[data-"+this.prefix+"-type"+t+"]"))&&e.dataget("instance")},getPrev:function(t){t=t?"="+t:"";var e=this.$block.prevElement();return!!(0!==e.length&&e.is("[data-"+this.prefix+"-type"+t+"]"))&&e.dataget("instance")},getChildFirst:function(t){t=t?"="+t:"";var e=this.$block.find("[data-"+this.prefix+"-type"+t+"]").first();return 0!==e.length&&e.dataget("instance")},getChildLast:function(t){t=t?"="+t:"";var e=this.$block.find("[data-"+this.prefix+"-type"+t+"]").last();return 0!==e.length&&e.dataget("instance")},getId:function(){return this.$block.attr("id")},getAlign:function(){var t=this.opts.align;if(!t)return!1;var e="left";for(var i in t)this.$block.hasClass(t[i])&&(e=i);return e},getValign:function(){var t=this.opts.valign;if(!t)return!1;var e="none";for(var i in t)this.$block.hasClass(t[i])&&(e=i);return e},getOutset:function(){var t=this.opts.outset;if(!t)return!1;var e="none";for(var i in t)this.$block.hasClass(t[i])&&(e=i);return e},getCaption:function(){var t=this.$block.find("figcaption");return 0!==t.length?t.html().trim():""},setData:function(t){for(var e in t)this.data[e]&&this[this.data[e].setter].call(this,t[e])},setEmpty:function(){this.$block.html(""),this.isEmptiable()&&this._addEmptyButton(this.$block)},setSelectAll:function(){this.isEditable()&&this.app.selection.select(this.$block)},setHtml:function(t){this.$block.html(t),""!==t&&this._buildInstancesInside(this.$block)},setId:function(t){""===t?this.$block.removeAttr("id"):this.$block.attr("id",t)},setAlign:function(t){this._removeObjClasses(this.opts.align),this.$block.addClass(this.opts.align[t])},setValign:function(t){this._removeObjClasses(this.opts.valign),"none"!==t&&this.$block.addClass(this.opts.valign[t])},setOutset:function(t){this._removeObjClasses(this.opts.outset),"none"!==t&&this.$block.addClass(this.opts.outset[t]),this.app.control.updatePosition()},setCaption:function(t){if(""===t)this.$block.find("figcaption").remove();else{var e=this.$block.find("figcaption");0===e.length&&((e=this.dom("<figcaption>")).attr("data-placeholder",this.lang.get("placeholders.figcaption")),this.$block.append(e),this.app.create("block.figcaption",e)),e.html(t)}},setClassFromObj:function(t,e){this._removeObjClasses(t);var i=t[e];("none"!==i||!1!==i)&&this.$block.addClass(i)},hasClass:function(t){t="string"==typeof t?[t]:t;for(var e=0;e<t.length;e++)if(this.$block.hasClass(t[e]))return t[e];return!1},remove:function(t){var e=this.getParent(),i=this.getType();this.$block.remove(),e&&e.isEmptiable()&&e.isEmpty()&&e.setEmpty(),t&&this.app.broadcast("block.remove",{type:i,parent:e})},duplicate:function(t){var e=this.getType(),i=this.$block.clone();return i.removeClass(this.prefix+"-block-focus "+this.prefix+"-block-multiple-hover"),t&&i.html(""),this.app.create("block."+e,i)},duplicateEmpty:function(){return this.duplicate(!0)},insertEmpty:function(t){return(t=t||{}).instance=this.app.block.create(),this.insert(t)},insert:function(t){var e=h.extend({},{instance:!1,position:!1,caret:!1,remove:!0,type:"input"},t),i=e.instance.getBlock();if(this.isEditable()&&this.app.selection.deleteContents(),"list"!==e.instance.getType()||"list"!==this.getType())return e.instance.isInlineBlock()&&this.isInlineBlock()?(this.$block.after(i),this.$block.remove()):e.instance.isInlineBlock()&&this.isEditable()?this.app.insertion.insertNode(e.instance.getBlock(),!1,!0):this.isEditable()&&"card"!==this.getType()?(e.position=this.app.insertion.detectPosition(this.$block,e.position),"split"===e.position?this.app.element.split(this.$block).before(i):(this.$block[e.position](i),e.remove&&this.isEmpty()&&this.$block.remove())):(e.position=e.position||"after",this.$block[e.position](i)),this.app.editor.build(),e.caret&&this.app.block.set(e.instance,e.caret),this.app.toolbar.observe(),this.app.broadcast("block.add",{instance:e.instance,type:e.type}),e.instance;"duplicate"===e.type?(e.position=e.position||"after",this.$block[e.position](i),e.caret&&this.app.block.set(e.instance,e.caret)):this.app.insertion.insertListToList(i,this.$block,e.caret)},appendNext:function(){var t=this.getNext();if(t.isEmpty()){t.remove();return}if(this.isEmpty()){this.remove(),this.app.block.set(t,"start");return}var e=t.getHtml(),i=this.getType(),s=t.getType(),a=!0,o=!0;if("code"===i&&"code"!==s&&(e=t.getPlainText()),"dlist"===s){if("dlist"===i){var n=t.getBlock().children();this.$block.append(n),a=!1}else e=t.getPlainText(!0)}else if("list"===s){if("list"===i){var r=t.getBlock().children();this.$block.append(r),a=!1,o=!0}else e=this._appendListHtml(t.getBlock(),e),o=t.isEmpty()}if(a){var l=this.app.selection.getTopInline();l&&this.app.caret.set(l,"after"),this.app.insertion.insertHtml(e,"start"),this._buildInstancesInside(this.$block)}o&&t.remove()},appendToPrev:function(){var t=this.getPrev();if(this.isEmpty()){this.remove(),this.app.block.set(t,"end");return}if(t.isEmpty()){t.remove(),this.app.control.updatePosition();return}var e=t.getType(),i=this.getHtml(),s=this.getType(),a=!0,o=!0;if("code"!==s&&"code"===e&&(i=this.getPlainText()),"dlist"===s){if("dlist"===e){var n=this.getBlock().children();this.app.block.set(t,"end"),t.getBlock().append(n),a=!1}else i=this.getPlainText(!0)}else if("list"===s){if("list"===e){var r=this.getBlock().children();this.app.block.set(t,"end"),t.getBlock().append(r),a=!1,o=!0}else i=this._appendListHtml(this.getBlock(),i),o=this.isEmpty()}if(a){this.app.block.set(t,"end");var l=this.app.selection.getTopInline();l&&this.app.caret.set(l,"after"),this.app.insertion.insertHtml(i,"start"),this._buildInstancesInside(t.getBlock())}o&&this.remove()},append:function(t,e){this.isEmptiable()&&this.isEmpty()&&(this.$block.html(""),this.$block.removeClass(this.prefix+"-empty-layer")),this.$block.append(t.getBlock()),!1!==e&&this.app.block.set(t),this.app.broadcast("block.add",{instance:t})},change:function(t,e){var i=t.getBlock();this.$block.after(i),this.$block.remove(),this.app.editor.build(),this.app.toolbar.observe(),this.app.block.set(t),!1!==e&&this.app.broadcast("block.change",{instance:t})},moveUp:function(){var t=this.getPrev();t&&this._move(t,"before")},moveDown:function(t){var e=this.getNext();e&&this._move(e,"after")},_appendListHtml:function(t,e){var i=t.find("li").first();return e=(e=(e=i.html().trim()).replace(/<\/li>/gi,"</li><br>")).replace(/<(ul|ol)/gi,"<br><$1"),e=(e=(e=this.app.content.removeTags(e,["ul","ol","li"])).trim()).replace(/<br\s?\/?>$/gi,""),i.remove(),e},_move:function(t,e){this.isEditable()&&this.app.selection.save(this.$block),t.getBlock()[e](this.$block,!0),this.app.block.set(this.$block,!1,!0),this.isEditable()&&this.app.selection.restore(this.$block)},_build:function(t){this.isEmptiable()&&this.isEmpty()&&this._addEmptyButton(this.$block),this.build&&this.build(t),this._buildInstancesInside(this.$block)},_buildData:function(){this.data||(this.data={}),this.data=h.extend({},!0,this.defaults,this.data)},_buildInstancesInside:function(t){t.find("[data-"+this.prefix+"-type]").each(this._buildInstanceInside.bind(this))},_buildInstanceInside:function(t){if(!t.dataget("instance")){var e=t.attr("data-"+this.prefix+"-type");this.app.create("block."+e,t)}},_buildItems:function(t,e){var i=this.$block.find(t);0!==i.length&&i.each((function(t){this.app.create("block."+e,t)}).bind(this))},_buildCaption:function(){"figure"===this.getTag()&&this.$block.find("figcaption").attr("data-placeholder",this.lang.get("placeholders.figcaption"))},_isEmpty:function(){var t=this.$block.text();return""===(t=this._cleanEmpty(t))},_getNameByTag:function(){var t=this.getTag();return this.app.utils.capitalize(t)},_render:function(){this._renderEdit(),this._renderDraggable(),this._renderEditable()},_renderDraggable:function(){void 0!==this.draggable&&!1===this.draggable&&(this.$block.on("dragstart",function(t){return t.preventDefault(),!1}),this.$block.find("img").on("dragstart",function(t){return t.preventDefault(),!1}))},_renderEditable:function(){this.isEditable()?this.$block.attr("contenteditable",!0):void 0!==this.editable&&!1===this.editable&&this.$block.attr("contenteditable",!1),this.isEditable()&&!this.opts.editor.grammarly&&this.$block.attr("data-gramm_editor",!1)},_renderEdit:function(){this.$block.dataset("instance",this),this.$block.attr("data-"+this.prefix+"-type",this.getType())},_cleanEmpty:function(t){return t=(t=-1!==(t=this.app.utils.removeInvisibleChars(t)).search(/^<br\s?\/?>$/)?"":t).replace(/\n/g,"")},_removeObjClasses:function(t){var e=this._buildObjClasses(t);this.$block.removeClass(e.join(" ")),this.app.element.removeEmptyAttrs(this.$block,["class"])},_buildObjClasses:function(t){var e=[];for(var i in t)t[i]&&e.push(t[i]);return e},_addEmptyButton:function(t){if(!t.hasClass(this.prefix+"-empty-layer")){t.addClass(this.prefix+"-empty-layer");var e=this.dom("<span>").addClass(this.prefix+"-plus-button");this.app.create("button",{name:"plus",element:e},{command:"addbar.popup"}),t.append(e)}}}),l.add("mixin","tool",{init:function(t,e,i,s){this.name=t,this.setter=i.get("setter"),this.popup=i,this.data=s,this.obj=this._observe(e),this.obj&&this._build()},getElement:function(){return this.$tool},getInput:function(){return this.$input},getValue:function(){return this.$input.val().trim()},setValue:function(t){this.$input.val(t)},setFocus:function(){this.$input.focus()},trigger:function(t){this.setValue(t),this.setter&&this.app.api(this.setter,this.popup)},_build:function(){this._buildTool(),this._buildLabel(),this._buildInputElement(),this._buildInput(),this._buildEvent(),this._has("placeholder")&&this.$input.attr("placeholder",this.lang.parse(this.obj.placeholder)),this._has("width")&&this.$input.css("width",this.obj.width),this._has("classname")&&this.$input.addClass(this.obj.classname)},_buildInputElement:function(){this.$input=this.dom("<"+this._getInputParam("tag")+">").addClass(this.prefix+this._getInputParam("classname")),this.$input.attr({name:this.name,type:this._getInputParam("type"),"data-type":this.type}),this.$input.dataset("instance",this)},_buildInput:function(){},_buildEvent:function(){if(-1===["segment"].indexOf(this.type)&&this.setter){var t="checkbox"===this.type||"select"===this.type?"change":"keydown blur";t="number"===this.type?t+" change":t,this.$input.on(t,this._catchSetter.bind(this))}},_buildTool:function(){this.$tool=this.dom("<div>").addClass(this.prefix+"-form-item").dataset("instance",this)},_buildLabel:function(){"checkbox"!==this.type&&this._has("label")&&(this.$label=this.dom("<label>").addClass(this.prefix+"-form-label").html(this.lang.parse(this.obj.label)),this.$tool.append(this.$label))},_getInputParam:function(t){return this.input&&void 0!==this.input[t]?this.input[t]:""},_get:function(t){return this.obj[t]},_has:function(t){return Object.prototype.hasOwnProperty.call(this.obj,t)},_observe:function(t){return Object.prototype.hasOwnProperty.call(t,"observer")&&(t=this.app.api(t.observer,t,this.name)),t},_catchSetter:function(t){("keydown"!==t.type||13===t.which)&&("keydown"===t.type&&t.preventDefault(),this.app.api(this.setter,this.popup))}}),l.add("module","lang",{init:function(){this.langKey=this.app.setting.get("editor.lang"),this.vars=this._build()},get:function(t){var e=this._get(t,this.vars);return void 0===e&&"en"!==this.langKey&&(e=this._get(t,h.lang.en)),void 0===e?"":e},parse:function(t){if("string"!=typeof t)return t;var e=t.match(/## (.*?) ##/g);if(e)for(var i=0;i<e.length;i++){var s=e[i].replace(/^##\s/g,"").replace(/\s##$/g,"");t=t.replace(e[i],this.get(s))}return t},_get:function(t,e){var i=t.split(".");return 1===i.length?e[t]:void 0!==e[i[0]]?e[i[0]][i[1]]:void 0},_build:function(){var t=h.lang.en;return"en"!==this.langKey&&(t="undefined"!==h.lang[this.langKey]?h.lang[this.langKey]:t),t}}),l.add("module","setting",{init:function(){this.opts=this._build()},dump:function(){return this.opts},has:function(t){var e=t.split(".");return 1===e.length?void 0!==this.opts[t]:void 0!==this.opts[e[0]]&&void 0!==this.opts[e[1]]},set:function(t,e,i){void 0===this.opts[t]&&(this.opts[t]={}),void 0===i?this.opts[t]=e:this.opts[t][e]=i},get:function(t){var e=t.split(".");return 1===e.length?this.opts[t]:void 0!==this.opts[e[0]]?this.opts[e[0]][e[1]]:void 0},_build:function(){var t=h.extend(!0,{},h.opts,this.app.initialSettings);return h.extend(!0,t,h.settings)}}),l.add("module","container",{init:function(){this.blurclass=this.prefix+"-in-blur",this.focusclass=this.prefix+"-in-focus"},start:function(){this._buildMain(),this._buildContainers(this.$main,this.opts.containers.main),this._buildBSModal()},stop:function(){this.$main.remove()},get:function(t){return this["$"+t]},setFocus:function(){this.$main.removeClass(this.blurclass).addClass(this.focusclass)},setBlur:function(){this.$main.removeClass(this.focusclass).addClass(this.blurclass)},isFocus:function(){return this.$main.hasClass(this.focusclass)},_buildMain:function(){this.$main=this.dom("<div>").attr(this.prefix+"-uuid",this.uuid),this.$main.addClass(this.prefix+"-container "+this.prefix+"-container-"+this.uuid),this.app.$element.after(this.$main)},_buildContainers:function(t,e){for(var i=0;i<e.length;i++){var s=e[i],a="$"+s;this[a]=this._createContainer(s),void 0!==this.opts.containers[s]&&this._buildContainers(this[a],this.opts.containers[s]),t.append(this[a])}},_buildBSModal:function(){this.opts.bsmodal=0!==this.$main.closest(".modal-dialog").length},_createContainer:function(t){return this.dom("<div>").addClass(this.prefix+"-"+t+"-container")}}),l.add("module","accessibility",{start:function(){this._buildRole(),this._buildLabel()},_buildRole:function(){this.app.editor.getEditor().attr({"aria-labelledby":this.prefix+"-voice",role:"presentation"})},_buildLabel:function(){var t=this.lang.get("accessibility.help-label"),e=this._createLabel(t);this.app.container.get("main").prepend(e)},_createLabel:function(t){var e=this.dom("<span />").addClass(this.prefix+"-voice-label");return e.attr({id:this.prefix+"-voice-"+this.uuid,"aria-hidden":!1}),e.html(t),e}}),l.add("module","utils",{isMobile:function(){return"ontouchstart"in document.documentElement},createInvisibleChar:function(){return document.createTextNode(this.opts.markerChar)},searchInvisibleChars:function(t){return t.search(/^\uFEFF$/g)},removeInvisibleChars:function(t){return t.replace(/\uFEFF/g,"")},wrap:function(t,e){var i=this.dom("<div>").html(t);return e(i),t=i.html(),i.remove(),t},extendArray:function(t,e){if(t=t.concat(t),e)for(var i=0;i<e.length;i++)t.push(e[i]);return t},removeFromArrayByValue:function(t,e){e=Array.isArray(e)?e:[e];for(var i,s=0;s<e.length;s++)(i=t.indexOf(e[s]))>-1&&t.splice(i,1);return t},sumOfArray:function(t){return t.reduce(function(t,e){return parseInt(t)+parseInt(e)},0)},getObjectIndex:function(t,e){return Object.keys(t).indexOf(e)},insertToObject:function(t,e,i,s){return Object.keys(i).reduce(function(a,o,n){return n===s&&(a[t]=e),a[o]=i[o],a},{})},getRandomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<12;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},escapeRegExp:function(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")},capitalize:function(t){return(t=t.toLowerCase()).charAt(0).toUpperCase()+t.slice(1)},extendData:function(t,e){for(var i in e)t="elements"===i?this._extendDataElements(t,e[i]):this._setData(t,i,e[i]);return t},_extendDataElements:function(t,e){return this.dom(e).each((function(e){if("FORM"===e.get().tagName){var i=e.serialize(!0);Object.keys(i).forEach((function(e){t=this._setData(t,e,i[e])}).bind(this))}else{var s=e.attr("name")?e.attr("name"):e.attr("id");t=this._setData(t,s,e.val())}}).bind(this)),t},_setData:function(t,e,i){return t instanceof FormData?t.append(e,i):t[e]=i,t},cssToObject:function(t){let e=/([\w-]*)\s*:\s*([^;]*)/g,i,s={};do null!=(i=e.exec(t))&&(s[i[1]]=this._normalizeValue(i[1],i[2].trim()));while(i)return s},_normalizeValue:function(t,e){return e=(e="string"==typeof e?e.replace(/'/g,'"'):e).trim().replace(/;$/,""),-1!==t.search(/color|background/)&&(e=(e=this.convertRgb2hex(e)).toLowerCase()),-1!==t.search(/family/)&&(e=e.replace(/"/g,"")),e},getInvertedColor:function(t){return t=""===t||null==t?"#ffffff":t,t=this.normalizeColor(t),.299*parseInt((t=this._removeHexDiese(t)).slice(0,2),16)+.587*parseInt(t.slice(2,4),16)+.114*parseInt(t.slice(4,6),16)>186?"black":"white"},normalizeColor:function(t){return t=(t=t?this.convertRgb2hex(t):t)?this.convertShorthex2long(t):t},convertRgb2hex:function(t){if(-1===t.search(/^rgb/i))return t;var e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},convertShorthex2long:function(t){return 3===(t=this._removeHexDiese(t)).length?"#"+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:"#"+t},replaceRgbToHex:function(t){return t.replace(/rgb\((.*?)\)/g,function(t,e){return"#"+e.split(",").map(function(t){return 1===(t=parseInt(t).toString(16)).length?"0"+t:t}).join("")})}}),l.add("module","paragraphizer",{init:function(){this.remStart="#####replace",this.remEnd="#####",this.tags=this.opts.tags.parser.concat(["form","audio","figcaption","object","style","script","iframe","select","input","textarea","button","option","map","area","math","fieldset","legend","hgroup","nav","details","menu","summary"])},paragraphize:function(t){var e=[],i=[];t=this._storeTags(t,e),t=(t=this.app.content.storeComments(t,i)).trim(),t=(t=(t=(t=(t=(t=this._trimLinks(t)).replace(/xparagraphmarkerz(?:\r\n|\r|\n)$/g,"")).replace(/xparagraphmarkerz$/g,"")).replace(/xparagraphmarkerz(?:\r\n|\r|\n)/g,"\n")).replace(/xparagraphmarkerz/g,"\n")).replace(/[\n]+/g,"\n");for(var s="",a=t.split("\n"),o=0;o<a.length;o++)s+="<p>"+a[o].trim()+"</p>\n";return t=(t=(t=(t=s.replace(/\n$/,"")).replace(RegExp("<p>\\s+#####","gi"),"#####")).replace(RegExp("<p>#####","gi"),"#####")).replace(RegExp("#####</p>","gi"),"#####"),t=this._restoreTags(t,e),t=(t=(t=(t=(t=(t=this.app.content.restoreComments(t,i)).replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\s\n]*<\/\1>/gi,"<$1$2></$1>")).replace(/<p(.*?)><\/?br\s?\/?><\/p>/gi,"<p$1></p>")).replace(/<div(.*?)><\/?br\s?\/?><\/div>/gi,"<div$1></div>")).replace(/<\/?br\s?\/?><\/div>/gi,"</div>")).replace(/<\/?br\s?\/?><\/li>/gi,"</li>")},_storeTags:function(t,e){return this.app.utils.wrap(t,(function(t){t.find(this.tags.join(", ")).each((function(t,i){this._replaceTag(t,i,e)}).bind(this))}).bind(this))},_restoreTags:function(t,e){for(var i=0;i<e.length;i++){var s=e[i].replace(/\$/gi,"&#36;");t=t.replace(this.remStart+i+this.remEnd,s)}return t},_replaceTag:function(t,e,i){var s=t.get(),a=document.createTextNode(this.remStart+e+this.remEnd+"xparagraphmarkerz");i.push(s.outerHTML),s.parentNode.replaceChild(a,s)},_trimLinks:function(t){return this.app.utils.wrap(t,(function(t){t.find("a").each(this._trimLink.bind(this))}).bind(this))},_trimLink:function(t){t.html(t.html().trim())}}),l.add("module","element",{is:function(t,e,i){var s=!1,a="text"===e?t:this._getNode(t);return"inline"===e?s=this._isElement(a)&&this._isInlineTag(a.tagName,i):"blocks"===e?s=this._isElement(a)&&a.hasAttribute("data-"+this.prefix+"-type"):"blocks-first"===e?s=this._isElement(a)&&a.hasAttribute("data-"+this.prefix+"-first-level"):"block"===e?s=this._isElement(a)&&this._isBlockTag(a.tagName,i):"element"===e?s=this._isElement(a):"text"===e?s=!("string"!=typeof a||/^\s*<(\w+|!)[^>]*>/.test(a))||this.isTextNode(a):"list"===e?s=this._isElement(a)&&-1!==["ul","ol"].indexOf(a.tagName.toLowerCase()):"heading"===e&&(s=this._isElement(a)&&-1!==["h1","h2","h3","h4","h5","h6"].indexOf(a.tagName.toLowerCase())),s},isEmptyOrImageInline:function(t){var e=this.dom(t).get();if(!e||3===e.nodeType)return!1;var i=e.tagName.toLowerCase(),s="false"===e.getAttribute("contenteditable"),a=this.is(e,"inline");return!!(a&&this.isEmpty(e))||!!a&&!!s||-1!==["svg","img"].indexOf(i)},isEmpty:function(t){var e=this._getNode(t);return!!e&&(3===e.nodeType?""===e.textContent.trim().replace(/\n/,""):""===e.innerHTML)},isTag:function(t,e){return this._getNode(t).tagName.toLowerCase()===e},isTextNode:function(t){var e=this._getNode(t);return e&&e.nodeType&&3===e.nodeType},isVisible:function(t){var e=this._getNode(t);return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},isScrollVisible:function(t){var e=this.app.scroll.getTarget(),i=this.dom(t),s=e.scrollTop()+e.height();return i.offset().top<=s},getFirstLevel:function(t){return this.dom(t).closest("[data-"+this.prefix+"-first-level]")},getDataBlock:function(t){return this.dom(t).closest("[data-"+this.prefix+"-type]")},getType:function(t){return this.dom(t).attr("data-"+this.prefix+"-type")},getAllInlines:function(t){for(var e=[],i=t;i;)this.is(i,"inline")&&e.push(i),i=i.parentNode;return e},getClosest:function(t,e){return this.dom(t).closest(this.getTypesSelector(e))},getParents:function(t,e){return this.dom(t).parents(this.getTypesSelector(e))},getChildren:function(t,e){return this.dom(t).find(this.getTypesSelector(e))},getTypesSelector:function(t){return"[data-"+this.prefix+"-type="+t.join("],[data-"+this.prefix+"-type=")+"]"},hasClass:function(t,e){e="string"==typeof e?[e]:e;for(var i=this.dom(t),s=e.length,a=0,o=0;o<s;o++)i.hasClass(e[o])&&a++;return s===a},scrollTo:function(t,e){if(!this.isScrollVisible(t)){e=e||60;var i=t.offset(),s=this.app.scroll.getTarget(),a=i.top-e;s.scrollTop(a),setTimeout(function(){s.scrollTop(a)},1)}},replaceToTag:function(t,e,i){return this.dom(t).replaceWith((function(t){var s=this.dom("<"+e+">");if(i||s.append(t.innerHTML),t.attributes)for(var a=t.attributes,o=0;o<a.length;o++)s.attr(a[o].nodeName,a[o].value);if(i)for(;t.childNodes.length>0;)s.append(this.dom(t.firstChild));return s}).bind(this))},compareStyle:function(t,e){let i=Object.keys(e).length,s=this.dom(t),a=this.app.utils.cssToObject(s.attr("style")),o=Object.keys(a).length,n=0;if(o!==i)return!1;for(let[t,i]of Object.entries(a))if(e[t]){let s=e[t];(s=this._normalizeValue(t,s))===(i=this._normalizeValue(t,i))&&n++}return o===n},hasAttrs:function(t,e){let i=Object.keys(e).length,s=this.dom(t),a=0;for(let[t,i]of Object.entries(e))s.attr(t)===i&&a++;return i===a},hasStyle:function(t,e){if(!e)return!1;let i=this.dom(t),s=Object.keys(e).length,a=0;for(let[t,s]of Object.entries(e)){let e=i.css(t);(e=this._normalizeValue(t,e))===(s=this._normalizeValue(t,s))&&a++}return s===a},split:function(t){var e=this.dom(t),i=(t=e.get()).tagName.toLowerCase(),s=this.app.content.extractHtmlFromCaret(t);s.nodeType&&11===s.nodeType&&(s=this.dom(s.childNodes));var a=this.dom("<"+i+" />");(a=this.cloneAttrs(t,a)).append(s),e.after(a);var o=e.children().last();if(this.is(o,"inline")){var n=o.html();""===(n=this.app.utils.removeInvisibleChars(n))&&o.remove()}var r=this.getType(a);return r&&this.app.create("block."+r,a,!0),""===e.html()&&e.remove(),a},cloneEmpty:function(t){var e=this.dom(t).get().tagName.toLowerCase();return this.dom("<"+e+">")},cloneAttrs:function(t,e){for(var i=this.dom(e),s=this._getNode(t).attributes,a=s.length;a--;){var o=s[a];i.attr(o.name,o.value)}return i},getAttrs:function(t){var e=this._getNode(t),i={};if(null!=e.attributes&&e.attributes.length)for(var s=0;s<e.attributes.length;s++){var a=e.attributes[s].nodeValue;a=this._isNumber(a)?parseFloat(a):this._getBooleanFromStr(a),i[e.attributes[s].nodeName]=a}return i},removeEmptyAttrs:function(t,e){var i=this.dom(t),s=e.join(" "),a=!1;return void 0===i.attr(s)||null===i.attr(s)?a=!0:""===i.attr(s)&&(i.removeAttr(s),a=!0),a},getBlocks:function(t,e,i){var s=this._getNode(t).childNodes,a=[],o=e||this.opts.tags.parser;i&&(o=this.app.utils.extendArray(o,i));for(var n=0;n<s.length;n++)1===s[n].nodeType&&-1!==o.indexOf(s[n].tagName.toLowerCase())&&a.push(s[n]);return a},hasBlocks:function(t){return 0!==this.getBlocks(t).length},hasTextSiblings:function(t){var e=this._getNode(t),i=e.previousSibling&&3===e.previousSibling.nodeType&&!this.isEmpty(e.previousSibling),s=e.nextSibling&&3===e.nextSibling.nodeType&&!this.isEmpty(e.nextSibling);return i||s},_getNode:function(t){return this.dom(t).get()},_getBooleanFromStr:function(t){return"true"===t||"false"!==t&&t},_isBlockTag:function(t,e){return -1!==this.app.utils.extendArray(this.opts.tags.block,e).indexOf(t.toLowerCase())},_isInlineTag:function(t,e){return -1!==this.app.utils.extendArray(this.opts.tags.inline,e).indexOf(t.toLowerCase())},_isElement:function(t){return t&&t.nodeType&&1===t.nodeType},_isTag:function(t){return void 0!==t&&t},_isNumber:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))},_normalizeValue:function(t,e){return e=(e="string"==typeof e?e.replace(/'/g,'"'):e).trim().replace(/;$/,""),-1!==t.search(/color|background/)&&(e=(e=this.app.utils.convertRgb2hex(e)).toLowerCase()),-1!==t.search(/family/)&&(e=e.replace(/"/g,"")),e}}),l.add("module","scroll",{init:function(){this.scrolltop=!1},save:function(){this.scrolltop=this.getTarget().scrollTop()},restore:function(){!1!==this.scrolltop&&(this.getTarget().scrollTop(this.scrolltop),this.scrolltop=!1)},isTarget:function(){return this.opts.editor.scrollTarget!==window},getTarget:function(){return this.dom(this.opts.editor.scrollTarget)}}),l.add("module","button",{init:function(t,e,i,s){if("object"==typeof t)this.name=t.name,this.obj=e,this._buildFromElement(t.element);else if(t){this.type=s||!1,this.name=t;var a=this._observe(e);this.obj=void 0===a?e:a,this.obj&&this._build(t,i)}},setColor:function(t,e){var i=t.getName();("background"===i||"text-color"===i)&&this.setBackground(e["background"===i?"background-color":"color"])},isButton:function(){return!0},isAddbar:function(){return this._has("addbar")},isControl:function(){return this._has("control")},getName:function(){return this.name},getTitle:function(){return this.title},getParams:function(){return!!this._has("params")&&this.obj.params},getOffset:function(){return this.$button.offset()},getDimension:function(){return{width:this.$button.width(),height:this.$button.height()}},getElement:function(){return this.$button},setBackground:function(t){this._background("add",t)},resetBackground:function(){this._background("remove","")},_has:function(t){return Object.prototype.hasOwnProperty.call(this.obj,t)},_observe:function(t){return Object.prototype.hasOwnProperty.call(t,"observer")&&(t=this.app.api(t.observer,t,this.name)),t},_background:function(t,e){this.$icon["remove"===t?"removeClass":"addClass"](this.prefix+"-button-icon-color").css({"background-color":e,color:""!==e?this.app.color.invert(e):""})},_buildFromElement:function(t){this.$button=this.dom(t),this.$button.addClass(this.prefix+"-button-target"),this._buildData()},_build:function(t,e){this._buildTitle(),this._buildElement(),this._buildIcon(),this._buildData(e)},_buildData:function(t){this.$button.attr({tabindex:"-1","data-name":this.name,"data-command":this.obj.command||!1}),this.$button.dataset("instance",this);var e=this._has("command")?"_catch":"_stop";this.$button.on("click."+this.prefix+"-button",this[e].bind(this)),this.$button.on("dragstart."+this.prefix+"-button",function(t){t.preventDefault()}),t&&(this._buildTooltip(),this._buildBackground(),this._buildPosition(t))},_buildTitle:function(){this.title=void 0!==this.obj.title?this.lang.parse(this.obj.title):""},_buildElement:function(){this.$button=this.dom('<a href="#"></a>'),this.$button.addClass(this.prefix+"-button "+this.prefix+"-button-target"),this.type&&this.$button.addClass(this.prefix+"-button-"+this.type),this._has("classname")&&this.$button.addClass(this.obj.classname)},_buildIcon:function(){var t=this._has("icon"),e='<span class="'+this.prefix+"-icon-"+this.name+'"></span>';this.$icon=this._buildIconElement(),t&&!0!==this.obj.icon&&(e=-1!==this.obj.icon.search(/</)?this.obj.icon:'<span class="'+this.prefix+"-icon-"+this.obj.icon+'"></span>'),this.opts.buttons.icons&&void 0!==this.opts.buttons.icons[this.name]&&(e=this.opts.buttons.icons[this.name]),this.$icon.append(e),this.$button.append(this.$icon)},_buildIconElement:function(){return this.dom("<span>").addClass(this.prefix+"-button-icon")},_buildTooltip:function(){("toolbar"===this.type||"context"===this.type&&this.opts.tooltip.context)&&this.app.tooltip.build(this.$button,this.title)},_buildBackground:function(){this._has("background")&&this.setBackground(this.obj.background)},_buildPosition:function(t){if(this._has("position")){var e=this.obj.position;if("first"===e)t.prepend(this.$button);else if("object"==typeof e){var i=Object.prototype.hasOwnProperty.call(e,"after")?"after":"before",s=e[i],a=this._findPositionElement(s,t);a?a[i](this.$button):t.append(this.$button)}}else t.append(this.$button)},_findPositionElement:function(t,e){var i;if(Array.isArray(t))for(var s=0;s<t.length&&0===(i=e.find("[data-name="+t[s]+"]")).length;s++);else i=e.find("[data-name="+t+"]");return 0!==i.length?i:0},_stop:function(t){t.preventDefault(),t.stopPropagation()},_catch:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-button-target");if(!e.hasClass("disable")){this.app.editor.setFocus();var i=e.attr("data-command"),s=e.attr("data-name"),a=e.dataget("instance");this.app.api(i,this.getParams(),a,s,t),this.app.tooltip.close()}}}),l.add("module","tooltip",{init:function(){this.classname=this.prefix+"-tooltip",this.eventname=this.prefix+"-button-"+this.uuid},stop:function(){this.close()},build:function(t,e){(e=this._cleanTitle(e))&&(t.attr("data-tooltip",e),t.on("mouseover."+this.eventname,this.open.bind(this)),t.on("mouseout."+this.eventname,this.close.bind(this)))},open:function(t){var e=this._getButton(t);this.app.popup.isOpen()||e.hasClass("disable")||(this.$tooltip=this._create(e),this._setPosition(e),this._fixBSModal(),this.app.$body.append(this.$tooltip))},close:function(){this.app.$body.find("."+this.classname).remove()},_create:function(t){return this.dom("<span>").addClass(this.classname).html(t.attr("data-tooltip"))},_cleanTitle:function(t){return!!t&&t.replace(/(<([^>]+)>)/gi,"")},_setPosition:function(t){var e=t.offset(),i=t.height();this.$tooltip.css({top:e.top+i+"px",left:e.left+"px"})},_fixBSModal:function(){this.opts.bsmodal&&this.$tooltip.css("z-index",1060)},_getButton:function(t){return this.dom(t.target).closest("."+this.prefix+"-button-target")}}),l.add("module","fragment",{build:function(t){return this.is(t)?t:this.create(t)},insert:function(t){var e=this.app.selection.get();if(e.range){if(e.collapsed){var i=e.range.startContainer;3!==i.nodeType&&"BR"===i.tagName&&i.parentNode.removeChild(i)}else e.range.deleteContents();t.frag?e.range.insertNode(t.frag):e.range.insertNode(t)}},createContainer:function(t){var e=this.dom("<div>");return"string"==typeof t?e.html(t):e.append(this.dom(t).clone(!0)),e.get()},create:function(t){for(var e,i,s,a="string"==typeof t?this.createContainer(t):t,o=document.createDocumentFragment(),n=[],r=0;e=a.firstChild;){r++;var l=o.appendChild(e);1===r&&(i=l),n.push(l),s=l}return{frag:o,first:i,last:s,nodes:n}},is:function(t){return"object"==typeof t&&t.frag}}),l.add("module","clipboard",{getContent:function(t){var e=this.isPlainText(t)?"text/plain":"text/html",i=t.getData(e);return"text/plain"===e?this.app.content.escapeHtml(i):i},setContent:function(t,e,i){var s=t.clipboardData;e=this.app.parser.unparse(e),e='<meta type="'+this.prefix+'-editor"/>'+e,i=i||this.app.content.getTextFromHtml(e,{nl:!0}),s.setData("text/html",e),s.setData("text/plain",i)},isPlainText:function(t){var e=t.getData("text/plain"),i=t.getData("text/html");return(!i||""===i.trim())&&null!==e}}),l.add("module","codemirror",{init:function(){this.cm=!1},create:function(e){if(this.is()){var i="object"==typeof this.opts.codemirror?this.opts.codemirror:{},s=this.opts.codemirrorSrc?this.opts.codemirrorSrc:t;return this.cm=s.fromTextArea(this.dom(e.el).get(),i),e.height&&this.cm.setSize(null,e.height),e.focus&&this.cm.focus(),this.cm}},destroy:function(){this.cm&&(this.cm.toTextArea(),this.cm=!1)},is:function(){return this.opts.codemirror},val:function(t){return this.is()&&this.cm&&(t=this.cm.getValue()),t}}),l.add("class","upload",{defaults:{type:"image",box:!1,url:!1,cover:!0,name:"file",data:!1,multiple:!0,placeholder:!1,hidden:!0,target:!1,success:!1,error:!1,remove:!1,trigger:!1,input:!1},init:function(t,e,i){this.eventname=this.prefix+"-upload",t&&this._build(t,e,i)},send:function(t,e,i,s){this.p=this._buildParams(i,s),this._send(t,e)},complete:function(t,e){this._complete(t,e)},setImage:function(t){!this.p.input&&(this.$image&&this.$image.remove(),this.$remove&&this.$remove.remove(),""===t?this.$placeholder.show():(this.$placeholder.hide(),this._buildImage(t),this.p.remove&&this._buildRemove()))},_build:function(t,e,i){this.p=this._buildParams(e,i),this.$element=this.dom(t),"INPUT"===this.$element.get().tagName?this._buildByInput():this._buildByBox()},_buildImage:function(t){this.$image=this.dom("<img>"),this.$image.attr("src",t),this.$box.append(this.$image),!1===this.p.input&&(this.$box.off("click."+this.eventname),this.$image.on("click."+this.eventname,this._click.bind(this)))},_buildRemove:function(){this.$remove=this.dom("<span>"),this.$remove.addClass(this.prefix+"-upload-remove"),this.$remove.on("click",this._removeImage.bind(this)),this.$box.append(this.$remove)},_buildParams:function(t,e){return t=h.extend(!0,this.defaults,t),e&&(t.trigger=e),t},_buildByInput:function(){this.$input=this.$element,this.p.box?(this._buildBox(),this._buildPlaceholder()):this.p.input=!0,this._buildAccept(),this._buildMultiple(),this._buildEvents()},_buildByBox:function(){this._buildInput(),this._buildAccept(),this._buildMultiple(),this._buildBox(),this._buildPlaceholder(),this._buildEvents()},_buildBox:function(){this.$box=this.dom("<div>").addClass(this.prefix+"-form-upload-box"),this.$element.before(this.$box),!1===this.p.cover&&this.$box.addClass(this.prefix+"-form-upload-cover-off"),this.p.hidden&&this.$element.hide()},_buildPlaceholder:function(){this.p.placeholder&&(this.$placeholder=this.dom("<span>").addClass(this.prefix+"-form-upload-placeholder"),this.$placeholder.html(this.p.placeholder),this.$box.append(this.$placeholder))},_buildInput:function(){this.$input=this.dom("<input>"),this.$input.attr("type","file"),this.$input.attr("name",this._getUploadParam()),this.$input.hide(),this.$element.before(this.$input)},_buildAccept:function(){if("image"===this.p.type){var t=this.opts.image.types.join(",");this.$input.attr("accept",t)}},_buildMultiple:function(){"image"===this.p.type&&(this.p.multiple?this.$input.attr("multiple","multiple"):this.$input.removeAttr("multiple"))},_buildEvents:function(){this.$input.on("change."+this.eventname+"-"+this.uuid,this._change.bind(this)),!1===this.p.input&&(this.$box.on("click."+this.eventname,this._click.bind(this)),this.$box.on("drop."+this.eventname,this._drop.bind(this)),this.$box.on("dragover."+this.eventname,this._dragover.bind(this)),this.$box.on("dragleave."+this.eventname,this._dragleave.bind(this)))},_buildData:function(t,e,i){if("single"===this.p.multiple)i.append(t,e[0]);else if(this.p.multiple)for(var s=0;s<e.length;s++)i.append(t+"[]",e[s]);else i.append(t+"[]",e[0]);return i},_removeImage:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.$image&&this.$image.remove(),this.$remove&&this.$remove.remove(),this.$placeholder.show(),!1===this.p.input&&this.$box.on("click."+this.eventname,this._click.bind(this)),t&&this.app.api(this.p.remove,t)},_getUploadParam:function(){return this.p.name},_click:function(t){t.preventDefault(),this.$input.click()},_change:function(t){this._send(t,this.$input.get().files)},_drop:function(t){t.preventDefault(),this._send(t)},_dragover:function(t){return t.preventDefault(),this._setStatus("hover"),!1},_dragleave:function(t){return t.preventDefault(),this._removeStatus(),!1},_setStatus:function(t){!this.p.input&&this.p.box&&(this._removeStatus(),this.$box.addClass(this.prefix+"-form-upload-"+t))},_removeStatus:function(){if(!this.p.input&&this.p.box)for(var t=["hover","error"],e=0;e<t.length;e++)this.$box.removeClass(this.prefix+"-form-upload-"+t[e])},_send:function(t,e){e=e||t.dataTransfer.files;var i=new FormData,s=this._getUploadParam();i=this._buildData(s,e,i),i=this.app.utils.extendData(i,this.p.data),this._sendData(t,e,i)},_sendData:function(t,e,i){"function"==typeof this.p.url?this.p.url.call(this.app,this,{data:i,files:e,e:t}):(this.app.progress.show(),this.ajax.post({url:this.p.url,data:i,before:(function(s){if(this.app.broadcast("upload.before.send",{xhr:s,data:i,files:e,e:t}).isStopped())return this.app.progress.hide(),!1}).bind(this),success:(function(e){this._complete(e,t)}).bind(this),error:(function(e){this._complete(e,t)}).bind(this)}))},_complete:function(t,e){t&&t.error?(this._setStatus("error"),this.p.error&&(this.app.broadcast("upload.error",{response:t}),this.app.api(this.p.error,t,e))):(this._removeStatus(),this._trigger(t),this.p.success&&(this.app.broadcast("upload.complete",{response:t}),this.app.api(this.p.success,t,e))),setTimeout((function(){this.app.progress.hide()}).bind(this),500)},_trigger:function(t){if(this.p.trigger&&t&&t.url){var e=this.p.trigger.instance;e[this.p.trigger.method].call(e,t.url)}}}),l.add("module","progress",{stop:function(){this.hide()},show:function(){this.hide(),this.$progress=this.dom("<div>").addClass(this.prefix+"-editor-progress"),this.$progress.attr("id",this.prefix+"-progress"),this.$progressBar=this.dom("<span>"),this.$progress.append(this.$progressBar),this.app.$body.append(this.$progress)},hide:function(){this.app.$body.find("#"+this.prefix+"-progress").remove()}}),l.add("module","autosave",{send:function(){this.opts.autosave.url&&this._sending()},_getName:function(){return this.opts.autosave.name?this.opts.autosave.name:this.app.$element.attr("name")||"content"+this.uuid},_sending:function(){var t=this._getName(),e={};e[t]=this.app.$element.val(),e=this.app.utils.extendData(e,this.opts.autosave.data),this.ajax.request(this.opts.autosave.method,{url:this.opts.autosave.url,data:e,before:(function(i){if(this.app.broadcast("autosave.before.send",{xhr:i,name:t,data:e}).isStopped())return!1}).bind(this),success:(function(i){this._complete(i,t,e)}).bind(this)})},_complete:function(t,e,i){var s=t&&t.error?"autosave.error":"autosave.send";this.app.broadcast(s,{name:e,data:i,response:t})}}),l.add("module","statusbar",{init:function(){this.classname=this.prefix+"-statusbar"},start:function(){this._build()},add:function(t,e){return this.update(t,e)},update:function(t,e){var i=this.get(t);return 0===i.length&&(i=this._buildItem(t)),i.html(e)},get:function(t){return this.$statusbar.find(t?"[data-name="+t+"]":"[data-name]")},remove:function(t){this.get(t).remove()},clear:function(){this.$statusbar.html("")},_build:function(){this.$statusbar=this.dom("<div>").attr("dir",this.opts.editor.direction),this.$statusbar.addClass(this.classname+" "+this.classname+"-"+this.uuid),this.app.container.get("statusbar").append(this.$statusbar)},_buildItem:function(t){var e=this.dom("<span>").addClass(this.classname+"-item");return e.attr("data-name",t),this.$statusbar.append(e),e}}),l.add("module","shortcut",{init:function(){if(this.opts.shortcutsRemove)for(var t=this.opts.shortcutsRemove,e=0;e<t.length;e++)this.remove(t[e]);this.shortcuts=this.opts.shortcuts,this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},add:function(t,e){this.shortcuts[t]=e},remove:function(t){this.opts.shortcutsBase=this._remove(t,this.opts.shortcutsBase),this.opts.shortcuts=this._remove(t,this.opts.shortcuts)},popup:function(t,e){var i=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"<b>&#8984;</b>":"ctrl",s={},a=0;a=this._buildPopupItems(s,a,this.opts.shortcutsBase,i,"base"),this._buildPopupItems(s,a,this.opts.shortcuts,i),this.app.popup.create("shortcuts",{width:"360px",items:s}),this.app.popup.open({button:e})},handle:function(t){if(this.triggered=!1,!1===this.shortcuts)return(t.ctrlKey||t.metaKey)&&(66===t.which||73===t.which)&&t.preventDefault(),!0;if(t.ctrlKey||t.metaKey||t.shoftKey||t.altKey)for(var e in this.shortcuts)this.shortcuts.hasOwnProperty(e)&&this._build(t,e,this.shortcuts[e]);return this.triggered},_buildPopupItems:function(t,e,i,s,a){for(var o in i)if(i.hasOwnProperty(o)){for(var n=this.dom("<div>").addClass(this.prefix+"-popup-shortcut-item"),r="base"===a?i[o]:i[o].title,l=this.dom("<span>").addClass(this.prefix+"-popup-shortcut-title").html(this.lang.parse(r)),p=this.dom("<span>").addClass(this.prefix+"-popup-shortcut-kbd"),h=("base"===a?o.replace("meta",s):i[o].name.replace("meta",s)).split("+"),c=0;c<h.length;c++)h[c]="<span>"+h[c]+"</span>";p.html(h.join("+")),n.append(l),n.append(p),t[e]={html:n},e++}return e},_build:function(t,e,i){for(var s=e.split(","),a=s.length,o=0;o<a;o++)"string"!=typeof s[o]||Object.prototype.hasOwnProperty.call(i,"trigger")||this._handler(t,s[o].trim(),i)},_handler:function(t,e,i){e=e.toLowerCase().split(" ");for(var s=this.hotkeys[t.keyCode],a=91!==t.which&&String.fromCharCode(t.which).toLowerCase(),o="",n={},r=["meta","ctrl","alt","shift"],l=0;l<r.length;l++){var p=r[l];t[p+"Key"]&&s!==p&&(o+=p+"+")}93===t.keyCode&&(o+="meta+"),s&&(n[o+s]=!0),a&&(n[o+a]=!0,n[o+this.hotkeysShiftNums[a]]=!0,"shift+"===o&&(n[this.hotkeysShiftNums[a]]=!0));for(var h=e.length,c=0;c<h;c++)if(n[e[c]]){t.preventDefault(),this.triggered=!0,this.app.api(i.command,i.params,t);return}},_remove:function(t,e){return Object.keys(e).reduce(function(i,s){return s!==t&&(i[s]=e[s]),i},{})}}),l.add("module","offset",{get:function(t){t=this._getEl(t);var e=this.app.editor.getWinNode().getSelection(),i=!1;if(e&&e.rangeCount>0){var s=e.getRangeAt(0);if(t.contains(e.anchorNode)){var a=s.cloneRange();a.selectNodeContents(t),a.setEnd(s.startContainer,s.startOffset);var o=a.toString().length;i={start:o,end:o+s.toString().length}}}return i},set:function(t,e){!1===e&&(e={start:0,end:0}),t=this._getEl(t);var i,s=0,a=this.app.editor.getDocNode().createRange(),o=[t],n=!1,r=!1;for(a.setStart(t,0),a.collapse(!0);!r&&(i=o.pop());)if(3===i.nodeType){var l=s+i.length;!n&&e.start>=s&&e.start<=l&&(a.setStart(i,e.start-s),n=!0),n&&e.end>=s&&e.end<=l&&(a.setEnd(i,e.end-s),r=!0),s=l}else for(var p=i.childNodes.length;p--;)o.push(i.childNodes[p]);this.app.selection.setRange(a)},_getEl:function(t){return t?this.dom(t).get():this.app.editor.getLayout().get()}}),l.add("module","marker",{build:function(t){var e=this.dom("<span>").attr("id","selection-marker-"+t);return e.addClass(this.prefix+"-selection-marker"),e.html(this.opts.markerChar),e.get()},insert:function(){this.remove();var t=this.app.selection.get(),e=!t.collapsed;if(t.range){var i=this.build("start"),s=this.build("end"),a=t.range.cloneRange();e&&(a.collapse(!1),a.insertNode(s)),a.setStart(t.range.startContainer,t.range.startOffset),a.collapse(!0),a.insertNode(i),t.range.setStartAfter(i),e&&t.range.setEndBefore(s),this.app.selection.setRange(t.range)}},restore:function(){var t=this.find("start"),e=this.find("end"),i=this.app.selection.get(),s=i.range?i.range:this.app.editor.getDocNode().createRange();if(t){var a=!!e&&e.previousSibling,o=t.nextSibling;o=(!o||3!==o.nodeType||""!==o.textContent.replace(/[\n\t]/g,""))&&o,e?o&&"selection-marker-end"===o.id?this._restoreInject(s,t):a&&o?(s.selectNodeContents(a),s.collapse(!1),s.setStart(o,0)):a&&!o?(s.selectNodeContents(a),s.collapse(!1),s.setStartAfter(t)):(s.setStartAfter(t),s.setEndBefore(e)):o?(s.selectNodeContents(o),s.collapse(!0)):this._restoreInject(s,t),this.app.selection.setRange(s);var n=t&&e?2:1,r=this.app.offset.get();r={start:r.start-n,end:r.end-n},t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e),this.app.editor.setWinFocus(),this.app.offset.set(!1,r)}},find:function(t){var e=this.app.editor.getLayout().find("#selection-marker-"+t);return 0!==e.length&&e.get()},remove:function(){var t=this.find("start"),e=this.find("end");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)},_restoreInject:function(t,e){var i=this.app.utils.createInvisibleChar();this.dom(e).after(i),t.selectNodeContents(i),t.collapse(!1)}}),l.add("module","state",{init:function(){this.started=!1,this.storage=!1,this.state=!1,this.passed=!0,this.undoStorage=[],this.redoStorage=[]},load:function(){this.clear(),this.trigger(!0)},stop:function(){this.clear()},clear:function(){this.storage=!1,this.state=!1,this.passed=!0,this.undoStorage=[],this.redoStorage=[]},get:function(){return this.undoStorage},add:function(t){!(t&&(t.ctrlKey||t.metaKey||this._isUndo(t)||this._isRedo(t)))&&this.app.observer.trigger&&(this.state=this._createState(),!1===this.started&&(this._setState(this.state,0),this.started=!0))},trigger:function(t){if(this.passed){var e=this._createState();this.state?e=this.state:this.state||t||(e=this.storage,this.started=!0),this._addState(e),this.storage=this._createState(),this.state=!1}},listen:function(t){return this._isUndo(t)?(t.preventDefault(),this.undo(),!0):this._isRedo(t)?(t.preventDefault(),this.redo(),!0):void(this.passed=!0)},undo:function(){if(this._hasUndo()){this.passed=!1;var t=this._getUndo();this._setRedo();var e=this.app.parser.parse(t[0]);this.app.editor.getLayout().html(e.children()),this._rebuild(t,"undo");var i=this.app.block.get(),s=!!(i&&i.isEditable())&&i.getBlock();this.app.offset.set(s,t[1])}},redo:function(){if(this._hasRedo()){this.passed=!1;var t=this.redoStorage.pop();this._addState({html:t[0],offset:t[1]});var e=this.app.parser.parse(t[0]);this.app.editor.getLayout().html(e.children()),this._rebuild(t,"redo");var i=this.app.block.get(),s=!!(i&&i.isEditable())&&i.getBlock();this.app.offset.set(s,t[1])}},_rebuild:function(t,e){this.app.editor.build(),this.app.editor.getLayout().find("."+this.prefix+"-block-state").each((function(t){this.app.block.set(t)}).bind(this)),this.app.broadcast("state."+e,{html:t[0],offset:t[1]})},_isUndo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&90===e&&!t.shiftKey&&!t.altKey},_isRedo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&(90===e&&t.shiftKey||89===e&&!t.shiftKey)&&!t.altKey},_hasUndo:function(){return 0!==this.undoStorage.length},_hasRedo:function(){return 0!==this.redoStorage.length},_getUndo:function(){return 1===this.undoStorage.length?this.undoStorage[0]:this.undoStorage.pop()},_createState:function(){var t=this.app.editor.getLayout().html();t=this.app.utils.wrap(t,(function(t){t.find("."+this.prefix+"-block-focus").addClass(this.prefix+"-block-state")}).bind(this));var e=this.app.block.get(),i=!!(e&&e.isEditable())&&e.getBlock();return{html:this.app.parser.unparse(t,!0),offset:this.app.offset.get(i)}},_setState:function(t,e){this.undoStorage[e]=[t.html,t.offset]},_addState:function(t){var e=this.undoStorage[this.undoStorage.length-1];void 0===e||e[0]!==t.html?(this.undoStorage.push([t.html,t.offset]),this._removeOverStorage()):e[1]=t.offset},_setRedo:function(){var t=this._createState();this.redoStorage.push([t.html,t.offset]),this.redoStorage=this.redoStorage.slice(0,this.opts.state.limit)},_removeOverStorage:function(){this.undoStorage.length>this.opts.state.limit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-this.opts.state.limit))}}),l.add("module","sync",{build:function(){this.syncedHtml=this.app.$element.val()},trigger:function(){this.opts.editor.sync&&(this.typingTimer&&clearTimeout(this.typingTimer),this.typingTimer=setTimeout((function(){var t=this._getHtml();this.is(t)&&this._sync(t)}).bind(this),300))},invoke:function(){var t=this._getHtml();this.syncedHtml=t,this._sync(t)},is:function(t){var e=!1;return this.syncedHtml!==t&&(this.syncedHtml=t,e=!0),e},_getHtml:function(){var t=this.app.editor.getLayout().html();return this.app.parser.unparse(t)},_sync:function(t){var e=this.app.broadcast("editor.before.change",{html:t});e.isStopped()||(this.app.$element.val(e.get("html")),this.app.autosave.send(),this.app.state.trigger(),this.app.broadcast("editor.change",e))}}),l.add("module","placeholder",{start:function(){this.placeholder=!1,this.$layout=this.app.editor.getLayout(),this._build()},handleClick:function(t){this.dom(t.target).hasClass(this.prefix+"-placeholder")&&(t.preventDefault(),t.stopPropagation(),this.app.editor.setFocus("start"))},trigger:function(){this.placeholder&&this.app.editor.isEmpty(!0)?this.show():this.hide()},toggle:function(){this.observerTimer&&clearTimeout(this.observerTimer),this.observerTimer=setTimeout(this.trigger.bind(this),10)},show:function(){this.$layout.addClass(this.prefix+"-placeholder")},hide:function(){this.$layout.removeClass(this.prefix+"-placeholder")},change:function(t){this.opts.placeholder=t,this._rebuild(),this.app.editor.isEmpty(!0)&&this.app.editor.setEmpty()},_build:function(){this._rebuild(),this.toggle()},_rebuild:function(){var t=this.opts.placeholder,e=this.app.$element.attr("placeholder");(!1!==t||e)&&(this.$layout.attr("placeholder",!1!==t?t:e),this.placeholder=!0)}}),l.add("module","list",{indent:function(){var t=this.app.selection.get(),e=this.app.selection.getBlock(),i=this.dom(e),s=i.prevElement(),a=s.get(),o=t.collapsed&&e&&a&&"LI"===a.tagName;if(this.app.selection.save(e),o){var n=(s=this.dom(a)).children("ul, ol"),r=i.closest("ul, ol");if(0!==n.length)n.append(i);else{var l=r.get().tagName.toLowerCase(),p=this.dom("<"+l+">");p.append(i),s.append(p)}}return this.app.selection.restore(),o},outdent:function(){var t=this.app.selection.get(),e=this.app.selection.getBlock(),i=this.dom(e),s=!1;if(t.collapsed&&e){var a,o,n=i.parent(),r=n.closest("li"),l=i.prevElement(),p=i.nextElement(),h=l.get(),c=p.get();if(this.app.selection.save(e),0!==r.length){if(!1!==h&&!1!==c){a=this._getAllNext(i.get()),o=this.dom("<"+n.get().tagName.toLowerCase()+">");for(var d=0;d<a.length;d++)o.append(a[d]);r.after(i),i.append(o)}else r.after(i),0===n.children().length?n.remove():!1===h&&i.append(n);s=!0}this.app.selection.restore()}return s},_getAllNext:function(t){for(var e=[];t;)if(t=this.dom(t).nextElement().get())e.push(t);else break;return e}}),l.add("module","cleaner",{cleanHtml:function(t){t=this.app.broadcastHtml("editor.before.clean",t);var e={},i=this.opts.paste.blockTags.concat(this.opts.paste.inlineTags).concat(this.opts.paste.formTags),s=this._isPages(t),a=this._isHtmlMsWord(t),o=this._isEditor(t);t=this.app.content.store(t,"embed",e,0),t=this.app.content.removeDoctype(t),t=(t=this.app.content.removeTags(t,this.opts.tags.denied)).trim(),t=this.app.content.removeComments(t),t=this.app.content.removeTagsWithContent(t,["script","style"]),t=s?this._cleanPages(t):t,t=a?t:this._cleanGDocs(t),t=this._encodePhp(t),t=this.app.content.removeTagsExcept(t,i),t=a?this._cleanMsWord(t):t;var n=!1;if(!o&&this.app.event.pasteEvent&&(t=this.app.content.restore(t,"embed",e),n=!0),!o){var r=0!==this.opts.paste.keepClass.length?this.opts.paste.keepClass.join(","):"",l=0!==this.opts.paste.keepAttrs.length?this.opts.paste.keepAttrs.join(","):"";t=this.app.utils.wrap(t,function(t){var e=t.find("*");e.not(r).removeAttr("class"),e.not(l).each(function(t){for(var e=t.get(),i=e.attributes,s=i.length-1;s>=0;s--){var a=i[s].name;"class"!==a&&"dir"!==a&&-1===a.search(/^data-/)&&("IMG"!==e.tagName||"src"!==a&&"alt"!==a)&&("A"!==e.tagName||"href"!==a&&"target"!==a)&&e.removeAttribute(a)}})})}return n||(t=this.app.content.restore(t,"embed",e)),t=o?this.app.content.cacheStyle(t):this.app.content.removeStyleAttr(t),t=(t=(t=(t=(t=(t=this.app.content.removeEmptyInlines(t)).replace(/<figure[^>]*><\/figure>/gi,"")).replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>")).replace(/^<li/gi,"<ul><li")).replace(/<\/li>$/gi,"</li></ul>"),(a||s)&&(t=(t=t.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")),t=this.app.utils.wrap(t,(function(t){t.find(".Apple-converted-space").unwrap(),t.find("ul, ol").each(this._placeListToItem.bind(this)),t.find("li p").unwrap()}).bind(this)),this.app.broadcastHtml("editor.clean",t)},_encodePhp:function(t){return t=(t=(t=t.replace("<?php","&lt;?php")).replace("<?","&lt;?")).replace("?>","?&gt;")},_isEditor:function(t){return t.match(RegExp('meta\\stype="'+this.prefix+'-editor"',"i"))},_isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_isPages:function(t){return t.match(/name="Generator"\scontent="Cocoa\sHTML\sWriter"/i)},_placeListToItem:function(t){var e=t.get(),i=e.previousSibling;if(i&&"LI"===i.tagName){var s=this.dom(i);s.find("p").unwrap(),s.append(e)}},_cleanPages:function(t){return t=(t=t.replace(/\sclass="s[0-9]"/gi,"")).replace(/\sclass="p[0-9]"/gi,"")},_cleanGDocs:function(t){return -1!==t.search(/docs-internal-guid/i)&&(t=(t=this.app.utils.wrap(t,function(t){t.find("h1, h2, h3, h4, h5, h6").each(function(t){t.find("span").unwrap()})})).replace(/ dir="[^>]*"/gi,"")),t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?(bold|600|700)|font-weight:\s?(bold|600|700);\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$4</i></b>")).replace(/<span[^>]*font-style:\s?italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight:\s?(bold|600|700)[^>]*>([\w\W]*?)<\/span>/gi,"<b>$2</b>")},_cleanMsWord:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]+?-->/gi,"")).trim()).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|meta|link|style|\w:\w+)(?=[\s/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(t,e){return e.length>0?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join(""):""}),t=(t=(t=(t=(t=(t=this.app.utils.wrap(t,(function(t){t.find("p").each(function(t){var e=/mso-list:\w+ \w+([0-9]+)/.exec(t.attr("style"));e&&t.attr("data-listLevel",parseInt(e[1],10))}),this._parseWordLists(t),t.find("[align]").removeAttr("align"),t.find("[name]").removeAttr("name"),t.find("span").each(function(t){var e=t.attr("style");/mso-list:Ignore/.exec(e)?t.remove():t.unwrap()}),t.find("[style]").removeAttr("style"),t.find("[class^='Mso']").removeAttr("class"),t.find("a").filter(function(t){return!t.attr("href")}).unwrap()}).bind(this))).replace(/<p><img(.*?)>/gi,"<p><img$1></p><p>")).replace(/<p[^>]*><\/p>/gi,"")).replace(/<li>/gi,"<li>")).trim()).replace(/\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi,"/$1>\n<$2");for(var e="",i=t.split(/\n/),s=0;s<i.length;s++){var a=""!==i[s]&&-1===i[s].search(/>$/)?" ":"\n";e+=i[s]+a}return e.trim()},_parseWordLists:function(t){var e=0,i=null,s=null,a=null;t.find("p").each((function(t){var o=t.attr("data-listLevel");if(null===o&&t.hasClass("MsoListParagraphCxSpMiddle")&&(o=1),null!==o){var n=t.text(),r=/^\s*\w+\./.test(n)?"<ol></ol>":"<ul></ul>";if(t.hasClass("MsoListParagraphCxSpFirst")||t.hasClass("MsoNormal")?(s=this.dom(r),t.before(s)):o>e&&0!==e&&(a=this.dom(r),i.append(a),s=a),o<e)for(var l=e-o+1,p=0;p<l;p++)s=s.parent();t.find("span").first().unwrap(),i=this.dom("<li>"+t.html().trim()+"</li>"),null===s&&(t.before(r),s=t.prev()),s.append(i),t.remove(),e=o}else s=null,e=0}).bind(this))}}),l.add("module","tidy",{init:function(){},parse:function(t){t=this.app.content.encodeAttrSings(t);var e,i=["li"],s=["li"];this.lineBefore=RegExp("^<(/?"+i.join("|/?")+"|"+s.join("|")+")[ >]"),this.lineAfter=RegExp("^<(/?"+i.join("|/?")+"|/"+s.join("|/")+")[ >]"),this.newLevel=RegExp("^</?(p|ul|ol|li|div|h1|h2|h3|h4|h5|h6|blockquote|figure|figcaption|table|thead|tbody|tfoot|tr|td|th|dl|dt|dd)[ >]");var a=0,o=t.length,n=0,r=null,l=null,p="",h="",c="";for(this.cleanlevel=0;a<o;a++){if(n=a,-1===t.substr(a).indexOf("<")){h+=t.substr(a);break}for(;n<o&&"<"!==t.charAt(n);)n++;for(a===n||(c=t.substr(a,n-a)).match(/^\s{2,}$/g)||("\n"===h.charAt(h.length-1)?h+=this.getTabs():"\n"===c.charAt(0)&&(h+="\n"+this.getTabs(),c=c.replace(/^\s+/,"")),h+=c),r=n;n<o&&">"!==t.charAt(n);)n++;if(p=t.substr(r,n-r),a=n,"!--"===p.substr(1,3)){if(!p.match(/--$/)){for(;"-->"!==t.substr(n,3);)n++;n+=2,p=t.substr(r,n-r),a=n}"\n"!==h.charAt(h.length-1)&&(h+="\n"),h+=this.getTabs()+(p+">\n")}else"!"===p[1]?h=this.placeTag(p+">",h):"?"===p[1]?h+=p+">\n":e===p.match(/^<(script|style|pre)/i)?(e[1]=e[1].toLowerCase(),p=this.cleanTag(p),h=this.placeTag(p,h),(l=String(t.substr(a+1)).toLowerCase().indexOf("</"+e[1]))&&(c=t.substr(a+1,l),a+=l,h+=c)):(p=this.cleanTag(p),h=this.placeTag(p,h))}return this.finish(h)},getTabs:function(){for(var t="",e=0;e<this.cleanlevel;e++)t+="    ";return t},finish:function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/,"")).replace(/[\s\n]*$/,"")).replace(/<li(.*?)>[\s\n]*/gi,"<li$1>")).replace(/<(p|h1|h2|h3|h4|h5|h6|li|td|th)(.*?)>[\s\n]*<\/\1>/gi,"<$1$2></$1>")).replace(/[\s\n]*<\/li>/gi,"</li>")).replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),t=this.app.content.decodeAttrSings(t),this.cleanlevel=0,t},cleanTag:function(t){var e,i="";t=(t=(t=t.replace(/\n/g," ")).replace(/\s{2,}/g," ")).replace(/^\s+|\s+$/g," ");var s="";for(t.match(/\/$/)&&(s="/",t=t.replace(/\/+$/,""));e=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)e[2]?i+=e[1].toLowerCase()+"="+e[2]:e[1]&&(i+=e[1].toLowerCase()),i+=" ",t=t.substr(e[0].length);return i.replace(/\s*$/,"")+s+">"},placeTag:function(t,e){var i=t.match(this.newLevel);return(t.match(this.lineBefore)||i)&&(e=e.replace(/\s*$/,"")+"\n"),i&&"/"===t.charAt(1)&&this.cleanlevel--,"\n"===e.charAt(e.length-1)&&(e+=this.getTabs()),i&&"/"!==t.charAt(1)&&this.cleanlevel++,e+=t,(t.match(this.lineAfter)||t.match(this.newLevel))&&(e=e.replace(/ *$/,"")+"\n"),e}}),l.add("module","source",{start:function(){this.eventname=this.prefix+"-source-events",this._build()},toggle:function(){this.is()?this.close():this.open()},is:function(){return"none"!==this.app.container.get("source").css("display")},open:function(){this.app.broadcast("source.before.open");var t=this.app.editor.getContent();t=this.app.tidy.parse(t);var e=this.app.container.get("editor").height();this.$source.height(e),this.$source.val(t),this.$source.on("focus."+this.eventname,this._handleFocus.bind(this)),this.$source.on("input."+this.eventname,this._handleChanges.bind(this)),this.$source.on("keydown."+this.eventname,this.app.input.handleTextareaTab.bind(this)),this.app.editor.unselectAll(),this.app.container.get("editor").hide(),this.app.container.get("source").show();var i=this.app.codemirror.create({el:this.$source,height:e,focus:!0});i&&(i.on("change",this._handleChanges.bind(this)),i.on("focus",this._handleFocus.bind(this))),this.app.editor.disableUI(),this.app.toolbar.setToggled("html"),this.app.broadcast("source.open")},close:function(){this.app.broadcast("source.before.close");var t=this.getContent();this.app.codemirror.destroy(),this.$source.off("."+this.eventname),this.app.container.get("source").hide(),this.app.container.get("editor").show(),this.app.editor.setContent({html:t,caret:"start"}),this.app.editor.enableUI(),this.app.toolbar.unsetToggled("html"),this.app.broadcast("source.close")},update:function(t){var e=this.app.editor.isTextarea()?"val":"html";this.app.$element[e](t)},getContent:function(){var t=this.$source.val();return this.app.codemirror.val(t)},_build:function(){this.opts.source&&(this.$source=this.dom("<textarea>").addClass(this.prefix+"-source"),this.$source.attr("data-gramm_editor",!1),this.app.container.get("source").append(this.$source))},_handleFocus:function(){this.app.editor.setFocus()},_handleChanges:function(t){var e=this.getContent();this.update(e),this.app.broadcast("source.change",{e:t})}}),l.add("module","content",{init:function(){this._selectors={code:["pre","code"],embed:["figure"],noneditable:["."+this.opts.noneditable.classname],images:["img"],links:["a"]}},paragraphize:function(t){return this.app.paragraphizer.paragraphize(t)},encodeEntities:function(t){return this.decodeEntities(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodeCode:function(t){return t=(t=(t=(t=(t=(t=(t=(t=this.encodeAttrSings(t)).replace(/<\s/gi,"&lt; ")).replace(/<([^>]+)</gi,"&lt;$1<")).replace(/<(.*?)>/gi,"xtagstartz$1xtagendz")).replace(/xtagstartzpre(.*?)xtagendz/g,"<pre$1>")).replace(/xtagstartzcode(.*?)xtagendz/g,"<code$1>")).replace(/xtagstartz\/codextagendz/g,"</code>")).replace(/xtagstartz\/prextagendz/g,"</pre>"),t=(t=(t=this._encodeCode(t)).replace(/xtagstartz([\w\W]*?)xtagendz/g,"<$1>")).replace(/xtagstartz\/(.*?)xtagendz/g,"</$1>"),t=this.decodeAttrSings(t)},encodeAttrSings:function(t){var e=t.match(/="(.*?)"/g);if(null!==e){for(var i=0;i<e.length;i++)if(-1===e[i].search(/^"</)&&-1===e[i].search(/>"$/)){var s=e[i].replace(">","xmoresignz");s=s.replace("<","xlesssignz"),t=t.replace(e[i],s)}}return t},decodeAttrSings:function(t){return t=(t=t.replace(/xmoresignz/gi,">")).replace(/xlesssignz/gi,"<")},decodeEntities:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},decodeHref:function(t){var e=t.match(RegExp('(href=".*?)(&amp;)(.*?">)',"g"));if(null!==e)for(var i=0;i<e.length;i++)t=t.replace(e[i],e[i].replace(/&amp;/g,"&"));return t},sanitize:function(t){return t=this.app.utils.wrap(t,(function(t){t.find("[src]").each(this._sanitizeSrc),t.find("a").each(this._sanitizeHref),t.find("a,b,i,strong,em,svg,img,details,audio").each(this._sanitizeEvents)}).bind(this))},escapeHtml:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},store:function(t,e,i,s){for(var a=this._selectors[e],o=0;o<a.length;o++){var n=this._getElementsFromHtml(t,a[o]);t=this._store(t,e,n,i,s)}return t},restore:function(t,e,i){if(void 0===i[e])return t;for(var s=0;s<i[e].length;s++)t=t.replace("####_"+e+s+"_####",i[e][s]);return t},storeComments:function(t,e){var i=t.match(RegExp("<!--([\\w\\W]*?)-->","gi"));if(null===i)return t;for(var s=0;s<i.length;s++)t=t.replace(i[s],"#####xstarthtmlcommentzz"+s+"xendhtmlcommentzz#####"),e.push(i[s]);return t},restoreComments:function(t,e){for(var i=0;i<e.length;i++){var s=e[i].replace(/\$/gi,"&#36;");t=t.replace("#####xstarthtmlcommentzz"+i+"xendhtmlcommentzz#####",s)}return t},cacheStyle:function(t){var e=this.opts.tags.block.join(",")+",img,"+this.opts.tags.inline.join(",");return this.app.utils.wrap(t,(function(t){t.find(e).each(this._cacheStyle.bind(this))}).bind(this))},recacheStyle:function(t){return this.app.utils.wrap(t,(function(t){t.find("[data-"+this.prefix+"-style-cache]").each(this._recacheStyle.bind(this))}).bind(this))},cacheElementStyle:function(t){let e="data-"+this.prefix+"-style-cache",i=t.attr("style");i?(i=i.replace(/"/g,""),t.attr(e,i)):i&&""!==i||t.removeAttr(e)},recacheElementStyle:function(t){let e="data-"+this.prefix+"-style-cache",i=t.attr(e);t.attr("style",i).removeAttr(e)},fixListMargin:function(t){var e=parseInt(t.css("margin-left"));if(0!==e){var i=parseInt(t.css("padding-left"));t.css({"margin-left":0,"padding-left":i+e+"px"}),t.attr(this.prefix+"-list-left",e)}},unfixListMargin:function(t){t.attr(this.prefix+"-list-left")&&(t.css({"padding-left":"","margin-left":""}),t.removeAttr(this.prefix+"-list-left"))},addNofollow:function(t){return this.opts.link.nofollow?this.app.utils.wrap(t,function(t){t.find("a").attr("rel","nofollow")}):t},addHttps:function(t){return this.opts.editor.https?t=(t=(t=t.replace('href="http://','href="https://')).replace('src="http://','src="https://')).replace('srcset="http://','srcset="https://'):t},addSpaceToBlocks:function(t){return t.replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1> ")},addBrToBlocks:function(t){return t.replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1><br>")},addPredefinedTagClass:function(t){var e=t.get().tagName.toLowerCase(),i=void 0!==this.opts.classes.tags?this.opts.classes.tags:this.opts.classes;void 0!==i[e]&&t.addClass(i[e])},addPredefinedBlockClass:function(t){var e=t.attr("data-"+this.prefix+"-type"),i=this.opts.classes.blocks;void 0!==i[e]&&t.addClass(i[e])},getPredefinedBlocks:function(){var t=[];return Object.keys(this.opts.classes.blocks).forEach(function(e){t.push(e)}),t},getPredefinedTags:function(){var t=[];return Object.keys(void 0!==this.opts.classes.tags?this.opts.classes.tags:this.opts.classes).forEach(function(e){t.push(e)}),t},getText:function(t){var e="";if(3===t.nodeType)e=t.nodeValue;else{for(var i=0;i<t.childNodes.length;i++)e+=this.getText(t.childNodes[i]);var s=1===t.nodeType?getComputedStyle(t).getPropertyValue("display"):"";(s.match(/^block/)||s.match(/list/)||"BR"===t.tagName||"HR"===t.tagName)&&(e+="\n")}return e},getTextFromHtml:function(t,e){var i={};e=h.extend({},{br:!1,nl:!1,trimlines:!0,images:!1,links:!1},e),t=this.store(t,"code",i,0),t=e.links?this.store(t,"links",i,0):t,t=(t=(t=(t=(t=(t=(t=(t=(t=e.images?this.store(t,"images",i,0):t).replace(/<(ul|ol)>\s+<li>/gi,"<$1><li>")).replace(/<li[^>]*>\n/gi,"<li$1>")).replace(/<p[^>]*>(\s+|)<\/p>/gi,"xemptyz")).replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<script[\s\S]*?script>/gi,"")).replace(/<\/(div|li|dt|dd|td|p|H[1-6])>\n?/gi,"</$1>\n")).replace(/&(lt|gt);/gi,"x$1z");var s=this.dom("<div>").html(t);if(t=this.getText(s.get()),e.trimlines){for(var a="",o=t.split("\n"),n=0;n<o.length;n++)a+=o[n].trim()+"\n";t=a}return t=(t=(t=t.replace(/[\n]+/g,"\n")).replace("xemptyz","\n")).replace(/x(lt|gt)z/gi,"&$1;"),t=e.br?(t=t.replace(/\n/g,"<br>\n")).replace(/<br\s?\/?>\n?$/gi,""):e.nl?t:t.replace(/\n/gi," "),t=this.restore(t,"code",i),t=e.links?this.restore(t,"links",i):t,t=(t=(t=(t=(t=e.images?this.restore(t,"images",i):t).replace(/<pre[^>]*>/g,"")).replace(/<code[^>]*>/g,"")).replace(/<\/pre>\n?/g,"")).replace(/<\/code>/g,""),e.images||(t=(t=t.replace(/<img[\s\S]*?>/gi,"")).replace(/<a[^>]*>(\s+|)<\/a>/gi,"")),t.trim()},extractHtmlFromCaret:function(t){var e=this.dom(t).get(),i=this.app.selection.getRange();if(i){var s=i.cloneRange();return s.selectNodeContents(e),s.setStart(i.endContainer,i.endOffset),s.extractContents()}},isEmptyHtml:function(t,e){return t=t.trim(),t=(t=(t=(t=(t=(t=(t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/^&nbsp;$/gi,"1")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>\s\S<\/p>$/i,"")).replace(/<hr(.*?[^>])>$/i,"hr")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source"),t=this.removeComments(t),""===(t=(t=(t=(t=e?t.replace(/<p[^>]*><\/p>/gi,""):t).replace(/<[^/>]><\/[^>]+>/gi,"")).replace(/<[^/>]><\/[^>]+>/gi,"")).trim())},isLine:function(t){var e=document.createElement("div");return e.innerHTML=t,0===this.dom(e).find(this.opts.tags.block.join(",")+",img").length},removeDoctype:function(t){return t.replace(RegExp("<!doctype[^>]*>","gi"),"")},removeComments:function(t){return t.replace(/<!--[\s\S]*?-->\n?/g,"")},removeTags:function(t,e){var i=e?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,s=e?function(t,i){return -1===e.indexOf(i.toLowerCase())?t:""}:"";return t.replace(i,s)},removeTagsExcept:function(t,e){return void 0===e?t.replace(/(<([^>]+)>)/gi,""):t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,i){return -1===e.indexOf(i.toLowerCase())?"":t})},removeTagsWithContent:function(t,e){return this.app.utils.wrap(t,function(t){t.find(e.join(",")).remove()})},removeMarkers:function(t){return this.app.utils.wrap(t,(function(t){t.find("."+this.prefix+"-plus-button").remove(),t.find("."+this.prefix+"pastemarker").removeClass(this.prefix+"pastemarker"),t.find("."+this.prefix+"pasteitems").removeClass(this.prefix+"pasteitems"),t.find("."+this.prefix+"-selection-marker").remove()}).bind(this))},removeEmptySpans:function(t){return this.app.utils.wrap(t,(function(t){t.find("span").each(this._removeEmptySpan.bind(this))}).bind(this))},removeEmptyInlines:function(t){return this.app.utils.wrap(t,(function(t){t.find(this.opts.tags.inline.join(",")).each(this._removeEmptyTag.bind(this))}).bind(this))},removeEmptyAttrs:function(t,e){return this.app.utils.wrap(t,function(t){for(var i=0;i<e.length;i++)t.find("["+e[i]+'=""]').removeAttr(e[i])})},removeBlockTags:function(t,e,i){var s=this.opts.tags.block.concat();return i&&(s=this.app.utils.removeFromArrayByValue(s,i)),e&&(e=e?this.app.utils.extendArray(s,e):s),this.removeTags(t,e)},removeBlockTagsInside:function(t,e){return this.blockListTags=this.app.utils.removeFromArrayByValue(this.opts.tags.block.concat(),["ul","ol","li"]),this.app.utils.wrap(t,(function(t){t.find(e.join(",")).each(this._removeBlockTagsInside.bind(this))}).bind(this))},removeInlineStyles:function(t){var e=this.app.utils.removeFromArrayByValue(this.opts.tags.inline,"a");return this.app.utils.wrap(t,function(t){t.find(e.join(",")).removeAttr("style")})},removeStyleAttr:function(t,e){return e=e||"",this.app.utils.wrap(t,(function(t){t.find("*").not("[data-"+this.prefix+"-style-cache]"+e).removeAttr("style")}).bind(this))},_cacheStyle:function(t){var e="data-"+this.prefix+"-style-cache",i=t.attr("style");i?(i=i.replace(/"/g,""),t.attr(e,i)):i&&""!==i||t.removeAttr(e)},_recacheStyle:function(t){var e="data-"+this.prefix+"-style-cache",i=t.attr(e);t.attr("style",i).removeAttr(e)},_cleanEmpty:function(t){return t=t.trim(),t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")},_removeEmptySpan:function(t){0===t.get().attributes.length&&t.unwrap()},_removeEmptyTag:function(t){var e=t.html().trim();0===t.get().attributes.length&&""===e&&t.unwrap()},_removeBlockTagsInside:function(t){var e="LI"===t.get().tagName?this.blockListTags:this.opts.tags.block;t.find(e.join(",")).append("<br>").unwrap()},_store:function(t,e,i,s,a){if(!i)return t;void 0===s[e]&&(s[e]=[]);for(var o=0;o<i.length;o++)s[e][a]=i[o],t=t.replace(i[o],"####_"+e+a+"_####"),a++;return t},_getElementsFromHtml:function(t,e){var i=[];return this.dom("<div>").html(t).find(e).each(function(t){i.push(t.get().outerHTML)}),i},_sanitizeSrc:function(t){var e=t.get(),i=e.getAttribute("src");(-1!==i.search(/^javascript:/i)||"IMG"!==e.tagName&&-1!==i.search(/^data:/i))&&e.setAttribute("src","")},_sanitizeHref:function(t){var e=t.get(),i=e.getAttribute("href");i&&-1!==i.search(/^javascript:/i)&&e.setAttribute("href","")},_sanitizeEvents:function(t){t.removeAttr("onload onerror ontoggle onwheel onmouseover oncopy")},_encodeCode:function(t){return this.app.utils.wrap(t,(function(t){t.find("pre code, pre, code").each(this._encodeNode.bind(this))}).bind(this))},_encodeNode:function(t){var e=t.get(),i=e.firstChild,s=e.innerHTML;if("PRE"!==e.tagName||!i||"CODE"!==i.tagName){s=(s=s.replace(/xtagstartz/g,"<")).replace(/xtagendz/g,">");var a=this.decodeEntities(s);e.textContent=this._encodeNodeHtml(a)}},_encodeNodeHtml:function(t){return t=t.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,"\n"),t=this.opts.code.spaces?t.replace(/\t/g,Array(this.opts.code.spaces+1).join(" ")):t}}),l.add("module","autoparse",{parse:function(t){if(!this.opts.paste.autoparse)return t;var e,i=this.app.block.get(),s=[];t=this.app.content.storeComments(t,s),t=this.app.content.removeDoctype(t);var a=["figure","html","form","pre","div","span","video","object","iframe","code","a","img","link","script"],o=["div","img","html","span"],n=[],r=0;for(e=0;e<a.length;e++){var l=-1!==o.indexOf(a[e])?"<"+a[e]+"[^>]*>":"<"+a[e]+"[^>]*>([\\w\\W]*?)</"+a[e]+">",p=t.match(RegExp(l,"gi"));if(null!==p)for(var h=0;h<p.length;h++)t=t.replace(p[h],"#####replaceparse"+r+"#####"),n.push(p[h]),r++}if(((t=t.replace("&amp;","&")).match(this.opts.regex.aurl1)||t.match(this.opts.regex.aurl2))&&!t.match(this.opts.regex.imageurl)&&(t=this._formatLinks(t)),t.match(this.opts.regex.imageurl)){var c=t.match(this.opts.regex.imageurl);for(e=0;e<c.length;e++)t=t.replace(c[e],this._splitBlock(i,'<img src="'+c[e]+'">'))}return t=this._restoreReplaced(n,t),t=this.app.content.restoreComments(t,s),t=this._restoreReplaced(n,t)},_splitBlock:function(t,e){return t?e="\n"+e+"\n":e},_formatLinks:function(t){var e=!1!==this.opts.paste.linkTarget?' target="'+this.opts.paste.linkTarget+'"':"",i=this.opts.editor.https?"https":"http",s=this;return t=(t=t.replace(this.opts.regex.aurl1,function(t){return'<a href="'+t+'"'+e+">"+s._subLinkText(t)+"</a>"})).replace(this.opts.regex.aurl2,function(t,a,o){return a+'<a href="'+i+"://"+o+'"'+e+">"+s._subLinkText(o)+"</a>"})},_subLinkText:function(t){return t=-1===(t=t.length>this.opts.link.size?t.substring(0,this.opts.link.size)+"...":t).search("%")?decodeURIComponent(t):t},_restoreReplaced:function(t,e){for(var i=0;i<t.length;i++)e=e.replace("#####replaceparse"+i+"#####",t[i]);return e}}),l.add("module","caret",{set:function(t,e){var i=this.dom(t).get(),s=this.app.editor.getDocNode().createRange();i&&this._isInPage(i)&&(this.app.editor.setWinFocus(),this._isInline(i)&&this._isNon(i)&&("start"===e?e="before":"end"===e&&(e="after")),this[({start:"_setStart",end:"_setEnd",before:"_setBefore",after:"_setAfter"})[e]](s,i),this.app.selection.setRange(s))},is:function(t,e,i,s,a){var o=this.dom(t).get(),n=this.app.editor.getWinNode().getSelection(),r=!1;if(!o||!n.isCollapsed)return r;var l=this._getPosition(o,s,a),p=this._getSize(o,i,s);return"end"===e?r=l===p:"start"===e&&(r=0===l),r},_setStart:function(t,e){t.setStart(e,0),t.collapse(!0);var i=this._getInlineInside(e);i&&(t=this._setStartInline(t,i)),this._isInline(e)&&this._insertInvisibleNode(t)},_setStartInline:function(t,e){var i=this.app.element.getAllInlines(e)[0];t.selectNodeContents(i),t.collapse(!0)},_setEnd:function(t,e){var i=1===e.nodeType&&e.lastChild;i&&this._isInline(i)&&(e=i),t.selectNodeContents(e),t.collapse(!1)},_setBefore:function(t,e){t.setStartBefore(e),t.collapse(!0),this._isInline(e)&&this._insertInvisibleNode(t,e)},_setAfter:function(t,e){t.setStartAfter(e),t.collapse(!0);var i=3!==e.nodeType&&e.tagName.toLowerCase();(this._isInline(e)||"br"===i||"svg"===i)&&this._insertInvisibleNode(t)},_insertInvisibleNode:function(t,e){var i=this.app.utils.createInvisibleChar();return e?e.parentNode.insertBefore(i,e):t.insertNode(i),t.selectNodeContents(i),t.collapse(!1),i},_getInlineInside:function(t){var e=t.firstChild;if(this._isInline(e)){for(var i=e.firstChild;i;){if(this._isInline(i))return i;i=i.firstChild}return e}},_getSize:function(t,e,i){var s,a=3===t.nodeType;if(e&&0!==e.length){var o=this.dom(t).clone();o.find(e.join(",")).remove(),s=o.html().trim()}else s=a?t.textContent:t.innerHTML,s=a||!1===i?s:s.trim();return this._trimmed(s,a,i).length},_getPosition:function(t,e,i){var s=this.app.editor.getWinNode().getSelection().getRangeAt(0),a=s.cloneRange(),o=document.createElement("div"),n=3===t.nodeType;a.selectNodeContents(t),a.setEnd(s.endContainer,s.endOffset),o.appendChild(a.cloneContents());var r=n||!1===e?o.innerHTML:o.innerHTML.trim(),l=-1!==r.search(/<\/?br\s?\/?>$/g)?1:0;return!1===i&&(l=0),(r=this._trimmed(r,n,e)).length+l},_trimmed:function(t,e,i){return!1===i?t=t.replace(/\n$/g,""):(""===(t=(t=(t=this.app.utils.removeInvisibleChars(t)).replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,"")).replace(/\s+/g," "))||e||(t=t.replace(/\s$/,"")),t)},_isInline:function(t){return this.app.element.is(t,"inline")},_isInPage:function(t){var e=!1,i=this.app.editor.getDocNode();return t&&t.nodeType&&(e=t!==i.body&&i.body.contains(t)),e},_isNon:function(t){return"false"===t.getAttribute("contenteditable")}}),l.add("module","selection",{init:function(){this.savedSelection=!1,this.savedMarker=!1,this.savedPosition=!1,this.savedRange=!1},get:function(){var t=this._getSelection(),e=this._getRange(t),i=this._getCurrent(t);return{selection:t,range:e,collapsed:this._getCollapsed(t,e),current:i,parent:this._getParent(i)}},getRange:function(){return this._getRange(this.get().selection)},getNodes:function(t){var e=this.get(),i=t&&(t.type&&"inline"===t.type||t.tags&&-1!==t.tags.indexOf("a")),s=i?"_getAllRangeNodes":"_getRangeNodes",a=[];return(a=this.app.editor.isAllSelected()?this.app.editor.getLayout().children().getAll():e.selection&&e.range?this[s](e.range):a).length>0?this._filterNodes(a,e.range,i,t):a},getCurrent:function(){var t=this._getSelection();return this._getCurrent(t)},getParent:function(){var t=this.getCurrent();return this._getParent(t)},getElement:function(t){return this._getElement(t,"element")},getInline:function(t){return this._getElement(t,"inline")},getTopInline:function(t){for(var e=t?this.dom(t).get():this.getCurrent(),i=[];e&&this._getElement(e,"inline");)i.push(e),e=e.parentNode;return i[i.length-1]},getDataBlock:function(t){var e=this._getSelection(),i=t||this._getCurrent(e);if(i)for(i=this.dom(i).get();i;){if(1===i.nodeType&&i.getAttribute("data-"+this.prefix+"-type"))return this.dom(i);i=i.parentNode}return this.dom()},getBlock:function(t){return this._getElement(t,"block")},getText:function(t,e){var i=this.get(),s=!1;if(!i.selection)return!1;if(t&&i.range){e=void 0===e?1:e;var a=this.app.editor.getLayout().get(),o=i.range.cloneRange();"before"===t?(o.collapse(!0),o.setStart(a,0),s=o.toString().slice(-e)):"after"===t&&(o.selectNodeContents(a),o.setStart(i.range.endContainer,i.range.endOffset),s=o.toString().slice(0,e))}else s=i.selection?i.selection.toString():"";return s},getHtml:function(){var t="",e=this.get();if(e.selection){var i=e.range.cloneContents(),s=document.createElement("div");s.appendChild(i),t=(t=s.innerHTML).replace(/<p><\/p>$/i,"")}return t},getPosition:function(t){var e=this.getRange(),i={top:0,left:0,width:0,height:0};if(this.app.editor.getWinNode().getSelection&&e.getBoundingClientRect){if(e=e.cloneRange(),"end"==t)e.setStart(e.endContainer,e.endOffset);else{var s=e.startOffset-1;e.setStart(e.startContainer,s<0?0:s)}var a=e.getBoundingClientRect();i={top:a.top,bottom:a.bottom,left:a.left,width:a.right-a.left,height:a.bottom-a.top}}return i},set:function(t,e){t&&(t.removeAllRanges(),t.addRange(e))},setRange:function(t){this.set(this.app.editor.getWinNode().getSelection(),t)},is:function(t){if(void 0===t)return this.get().selection;for(var e=this.dom(t).get(),i=this.getNodes(),s=0;s<i.length;s++)if(i[s]===e)return!0;return!1},isCollapsed:function(){var t=this.get();return this._getCollapsed(t.selection,t.range)},isIn:function(t){var e=this.dom(t).get(),i=this.getCurrent();return!!i&&!!e&&e.contains(i)},isAll:function(t){var e=!t,i=t?this.dom(t).get():this.app.editor.getLayout().get(),s=this.app.editor.getWinNode().getSelection(),a=this._getRange(s),o=!!e||this.is(i);return!s.isCollapsed&&!!o&&void 0!==i.textContent&&i.textContent.trim().length===a.toString().trim().length},select:function(t){var e=t?this.dom(t).get():this.app.editor.getLayout().get(),i=this.app.editor.getDocNode().createRange();i.selectNodeContents(e),this.setRange(i)},removeAllRanges:function(){var t=this._getSelection();t&&t.removeAllRanges()},deleteContents:function(){var t=this.getRange();!this.isCollapsed()&&t&&t.deleteContents()},collapse:function(t){t=t||"start";var e=this.get();e.selection&&!e.collapsed&&("start"===t?e.selection.collapseToStart():e.selection.collapseToEnd())},save:function(t){if(!t){var e=this.app.block.get();t=e?e.getBlock():this.app.editor.getLayout()}this.savedSelection={el:t,offset:this.app.offset.get(t)}},restore:function(t){if(!this.savedMarker&&this.savedSelection){this.app.editor.setWinFocus();var e=this.savedSelection.el;this.dom(e).dataget("instance")&&!1!==t&&this.app.block.set(e),e&&(e.focus(),this.app.offset.set(e,this.savedSelection.offset)),this.savedSelection=!1}},saveMarker:function(){this.savedMarker=!0,this.app.marker.insert()},restoreMarker:function(){this.app.marker.restore(),this.savedMarker=!1,this.savedSelection=!1},_getSelection:function(){return this.app.editor.getSelection()},_getRange:function(t){return!!t&&t.rangeCount>0&&t.getRangeAt(0)},_getCurrent:function(t){return!!t&&t.anchorNode},_getParent:function(t){return!!t&&t.parentNode},_getElement:function(t,e){var i=this._getSelection();if(i){var s=t||this._getCurrent(i);for(s=this.dom(s).get();s;){if(this.app.element.is(s,e))return s;s=s.parentNode}}return!1},_getCollapsed:function(t,e){var i=!1;return t&&t.isCollapsed?i=!0:e&&0===e.toString().length&&(i=!0),i},_getNextNode:function(t){if(t.firstChild)return t.firstChild;for(;t;){if(t.nextSibling)return t.nextSibling;t=t.parentNode}},_getRangeNodes:function(t,e){var i,s=t.startContainer.childNodes[t.startOffset]||t.startContainer,a=t.endContainer.childNodes[t.endOffset]||t.endContainer,o=t.commonAncestorContainer,n=[];if(e){for(this.app.editor.isLayout(s)||n.push(s),i=s.parentNode;i&&!this.app.editor.isLayout(i)&&(n.push(i),i!==o);i=i.parentNode);for(n.reverse(),i=s;i&&(3===i.nodeType||0!==this.dom(i.parentNode).closest(o).length)&&(n.push(i),i!==a);i=this._getNextNode(i));}else for(3===s.nodeType&&n.push(this.getBlock(s)),i=s;i&&i!==o&&(3===i.nodeType||0!==this.dom(i.parentNode).closest(o).length)&&(n.push(i),i!==a);i=this._getNextNode(i));return n},_getAllRangeNodes:function(t){return this._getRangeNodes(t,!0)},_filterNodes:function(t,e,i,s){var a=this.getText();a=a?a.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&"):"";for(var o=[],n=0;n<t.length;n++){var r=!0;this.app.editor.isLayout(t[n])&&(r=!1),s&&(r=s.types?this._filterByTypes(r,s,t[n]):r,r=s.selected?this._filterBySelected(r,s,t[n],e,a):r,r=s.type?this._filterByType(r,s,t[n],i):r,r=s.tags?this._filterByTags(r,s,t[n]):r),r&&o.push(t[n])}var l=[];if(s&&("blocks"===s.type||"blocks-first"===s.type)){for(var p,h=0;h<o.length;h++)"blocks-first"===s.type?p=this.app.element.is(o[h],"blocks-first")?o[h]:this.app.element.getFirstLevel(o[h]).get():"blocks"===s.type&&(p=this.app.element.is(o[h],"blocks")?o[h]:this.app.element.getDataBlock(o[h]).get()),this._isInNodesArray(l,p)||l.push(p);o=l}return o},_filterByTypes:function(t,e,i){var s;return!0===e.types?(s=this.app.element.getType(i))||(t=!1):(s=this.app.element.getType(i),-1===e.types.indexOf(s)&&(t=!1)),t},_filterByType:function(t,e,i,s){var a=e.type;return("blocks"===a||"blocks-first"===a)&&(a="block"),s?e.links?this.app.element.is(i,a)||(t=!1):(1!==i.nodeType||"A"!==i.tagName)&&this.app.element.is(i,a)||(t=!1):this.app.element.is(i,a)||(t=!1),t},_filterByTags:function(t,e,i){var s=void 0!==i.tagName;return s?s&&-1===e.tags.indexOf(i.tagName.toLowerCase())&&(t=!1):t=!1,t},_filterBySelected:function(t,e,i,s,a){return!0!==e.selected||this._containsNodeText(s,i)?"inside"!==e.selected||(1===i.nodeType&&"A"===i.tagName?t=!0:this._isTextSelected(i,a)||(t=!1)):t=!1,t},_isTextSelected:function(t,e){var i=9!==t.nodeType?this.app.utils.removeInvisibleChars(t.textContent):"";return e===i||-1!==i.search(e)||-1!==e.search(RegExp("^"+this.app.utils.escapeRegExp(i)+"$"))},_isBackwards:function(){var t=!1,e=this.get();if(e&&!e.collapsed){var i=this.app.editor.getDocNode().createRange();i.setStart(e.selection.anchorNode,e.selection.anchorOffset),i.setEnd(e.selection.focusNode,e.selection.focusOffset),t=i.collapsed,i.detach()}return t},_containsNodeText:function(t,e){for(var i,s,a,o=this.app.editor.getDocNode().createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return NodeFilter.FILTER_ACCEPT}},!1);a=o.nextNode();)i||(i=a),s=a;var n=t.cloneRange();return i?(n.setStart(i,0),n.setEnd(s,s.length)):n.selectNodeContents(e),1>t.compareBoundaryPoints(Range.START_TO_START,n)&&t.compareBoundaryPoints(Range.END_TO_END,n)>-1},_isInNodesArray:function(t,e){return -1!==t.indexOf(e)}}),l.add("module","inline",{set(t){let e=this.dom([]);if(this.app.popup.close(),this.params=t||{},this.params.style){let t={};for(let[e,i]of Object.entries(this.params.style)){let s=e.replace(/([A-Z])/g," $1");t[s=s.split(" ").join("-").toLowerCase()]=i}this.params.style=t}if(this.app.selection.getRange())return e=this.app.selection.isCollapsed()?this._formatCollapsed():this._formatUncollapsed(),this.app.broadcast("inline.set",{$nodes:e}),this.app.sync.trigger(),this.app.editor.observeUI(),this.app.context&&this.app.context.updatePosition(),e},remove(t){let e=this.app.selection.getNodes({type:"inline"}),i=this.app.selection.getTopInline();if(this.app.selection.isCollapsed()&&i){let t=i.tagName.toLowerCase(),e=this._insertSplit(i,t);this.app.caret.set(e,"before");return}if(this.app.selection.save(),t.style){let i=Array.isArray(t.style)?t.style:[t.style];for(let t=0;t<e.length;t++){let s=this.dom(e[t]);s.removeAttr("data-"+this.prefix+"-style-cache");for(let t=0;t<i.length;t++)s.css(i[t],"");""===s.attr("style")&&s.removeAttr("style"),this.app.content.cacheElementStyle(s)}}else if(t.classname)for(let i=0;i<e.length;i++){let s=this.dom(e[i]);s.removeClass(t.classname),""===s.attr("class")&&s.removeAttr("class")}this.app.selection.restore(),this.app.context&&this.app.context.updatePosition()},removeFormat(){this.app.popup.close();let t=this.app.block.get(),e,i,s=0,a;if(t){for(e=t.getBlock(),this.app.selection.save(e),i=this.app.selection.getNodes({type:"inline"});s<i.length;s++)(a=this.dom(i[s])).attr("data"+this.prefix+"-type")||a.unwrap();this.app.selection.restore(),this.app.editor.observeUI(),this.app.context&&this.app.context.updatePosition()}},_formatCollapsed(){let t,e=this.app.selection.getInline(),i=this.dom(e),s=this._getTags(),a=this._isSameTag(e,s),o=!!this.params&&!!this.params.caret&&this.params.caret;return this.app.selection.save(),e?e&&this.app.utils.isEmptyHtml(e.innerHTML)?a?this._isParams()?this._hasAllSameParams(e)?(this.app.caret.set(e,o||"after"),i.remove()):this._hasSameClassname(e)?(this.app.selection.restore(),t=this._setStyle(e)):this._hasSameStyle(e)?(this.app.selection.restore(),t=this._setClassname(e)):(this.app.selection.restore(),t=this._setParams(e)):(this.app.caret.set(e,o||"after"),i.remove()):(t=this._insertInline(this.params.tag,o),t=this._setParams(t)):e&&(a?this._isParams()?this._hasAllSameParams(e)?this._makeSplit(e,o):this._hasSameClassname(e)?(t=this._insertInline(this.params.tag,o),t=this._setStyle(t)):this._hasSameStyle(e)?(t=this._insertInline(this.params.tag,o),t=this._setClassname(t)):(t=this._insertInline(this.params.tag,o),t=this._setParams(t)):this._makeSplit(e,o):(t=this._insertInline(this.params.tag,o),t=this._setParams(t))):(t=this._insertInline(this.params.tag,o),t=this._setParams(t)),this.dom(t)},_formatUncollapsed(){let t=!1,e=this.app.editor.isAllSelected(),i=this.dom(this.app.selection.getNodes({type:"blocks",partial:!0})),s=this.app.selection.getNodes({type:"inline"});if(this.app.selection.save(),this._convertTags(i,s),this.app.selection.restore(),this.app.selection.save(),this._convertToStrike(s),this.app.selection.restore(),this.app.editor.getDocNode().execCommand("strikethrough"),this.app.selection.save(),t=this._revertToInlines(i),this.app.selection.restore(),this._clearEmptyStyle(),this.app.selection.save(),t.each(this._applyParams.bind(this)),this.app.selection.restore(),i.each(function(t){t.get().normalize()}),this.app.selection.save(),this._revertTags(i),this.app.selection.restore(),this.params.caret){let e=t.last();this.app.caret.set(e,this.params.caret)}return e&&this.app.editor.selectAll(),t},_isParams(){return this.params.style||this.params.classname},_applyParams(t){let e=t.get().tagName.toLowerCase(),i=this._getTags(),s=t.parent();if(0!==s.length&&this._isSameTag(s.get(),i)&&s.text()===t.text()&&this.params.style){let i=this.params.style,a=this.app.utils.cssToObject(s.attr("style")),o=Object.keys(i).length,n=0;for(let t of Object.keys(i))a[t]&&n++;n===o?s.unwrap():(t.unwrap(),this._applyParamsToNode(s,e))}this._applyParamsToNode(t,e)},_applyParamsToNode(t,e){t.removeAttr("data-"+this.prefix+"-style-cache"),""===t.attr("class")&&t.removeAttr("class"),0===t.get().attributes.length?this._isParams()&&"span"===this.params.tag?(this._setParams(t),this._clearSpanInside(t)):"span"===e&&t.unwrap():this._isParams()&&(this._setParams(t),this._clearSpanInside(t))},_setParams(t){return t=this._setClassname(t),t=this._setStyle(t)},_setClassname(t){let e=this.dom(t);if(this.params.classname){if(this.params.group){let t="inlineGroups."+this.params.group,i=!!this.opts.is(t)&&this.opts.get(t);i&&e.removeClass(i.join(" "))}else e.removeAttr("class");e.addClass(this.params.classname)}return e.get()},_setStyle(t){let e=this.dom(t);return this.params.style&&(e.css(this.params.style),this.app.content.cacheElementStyle(e)),e.get()},_hasAllSameParams(t){return this._hasSameClassname(t)&&this._hasSameStyle(t)},_hasSameClassname(t){let e=this.dom(t);return!this.params.classname||e.hasClass(this.params.classname)},_hasSameStyle(t){let e=this.dom(t);return!this.params.style||this.app.element.compareStyle(e,this.params.style)},_makeSplit(t,e){let i=this.app.create("caret"),s=i.is(t,"end"),a=t;s?e="after":a=this._insertSplit(t),i.set(a,e||"before")},_insertSplit(t,e){let i=this.dom(t),s=this.app.content.extractHtmlFromCaret(t),a=this.dom("<"+(e||this.params.tag)+" />"),o=document.createElement("div");return o.appendChild(s),(a=this.app.element.cloneAttrs(t,a)).append(o.innerHTML),i.after(a),a},_insertInline(t,e){return this.app.create("insertion").insertNode(document.createElement(t),e||"start")},_isSameTag:(t,e)=>t&&-1!==e.indexOf(t.tagName.toLowerCase()),_getTags(){let t=[this.params.tag];return"b"===this.params.tag||"strong"===this.params.tag?t=["b","strong"]:("i"===this.params.tag||"em"===this.params.tag)&&(t=["i","em"]),t},_convertToStrike(t){let e=this.app.selection.getText().replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&"),i=this._getTags(),s,a,o,n,r=!1;for(let l=0;l<t.length;l++)s=t[l],a=this.dom(s),o=t[l].tagName.toLowerCase(),n=this._hasAllSameParams(s),-1===i.indexOf(o)||("span"===this.params.tag&&this._isFullySelected(s,e)?(a.addClass("rx-inline-convertable"),a.removeAttr("data-"+this.prefix+"-style-cache")):n&&"a"!==this.params.tag?this._replaceToStrike(a):"span"===this.params.tag?(this.params.style&&this._hasSameStyle(a)&&(r=!0),this.params.classname&&this._hasSameClassname(a)&&(r=!0),r?(a.addClass("rx-inline-convertable"),a.removeAttr("data-"+this.prefix+"-style-cache")):a.addClass("rx-inline-unconvertable")):n||(a.addClass("rx-inline-convertable"),a.removeAttr("data-"+this.prefix+"-style-cache")))},_convertInlineBlocks(t){t.find("[data-"+this.prefix+"-inline]").each(function(t){!0===t.attr("contenteditable")&&t.addClass("rx-inlineblock-editable").attr("contenteditable",!1)})},_convertTag(t,e){this.params.tag!==t?e.find(t).each((function(e){this.app.element.replaceToTag(e,"span").addClass("rx-convertable-"+t)}).bind(this)):"del"===this.params.tag&&e.find(t).each((function(t){this.app.element.replaceToTag(t,"strike")}).bind(this))},_convertTags(t,e){this._convertTag("del",t),this._convertTag("u",t),this._convertInlineBlocks(t)},_replaceToStrike(t){t.replaceWith((function(){return this.dom("<strike>").append(t.contents())}).bind(this))},_revertInlineBlocks(t){t.find(".rx-inlineblock-editable").removeClass("rx-inlineblock-editable").attr("contenteditable",!0)},_revertTag(t,e){e.find("span.rx-convertable-"+t).each((function(e){this.app.element.replaceToTag(e,t).removeAttr("class")}).bind(this))},_revertTags(t){this._revertTag("u",t),this._revertTag("del",t),this._revertInlineBlocks(t)},_revertToInlines(t){let e=this.dom([]);return"u"!==this.params.tag&&t.find("u").unwrap(),t.each(function(t){t.find("*").each(function(t){t.get().style.textDecorationLine&&(t.css("text-decoration-line",""),t.wrap("<u>"),""===t.attr("style")&&t.removeAttr("style"))})}),t.find(".rx-inline-convertable").each((function(t){t.find("strike").each(function(e){t.text()===e.text()&&e.unwrap()}),t.removeClass("rx-inline-convertable"),this.app.element.removeEmptyAttrs(t,["class"]),this._hasAllSameParams(t)?t.unwrap():e.add(t)}).bind(this)),t.find("span.rx-inline-unconvertable").each((function(t){t.removeClass("rx-inline-unconvertable"),this.app.element.removeEmptyAttrs(t,["class"])}).bind(this)),t.find("strike").each((function(t){t=this.app.element.replaceToTag(t,this.params.tag),e.add(t)}).bind(this)),e},_clearEmptyStyle(){let t=this.app.selection.getNodes({type:"inline"}),e=0,i=t.length,s,a=0;for(;e<i;e++)if(this._clearEmptyStyleAttr(t[e]),s=t[e].childNodes)for(;a<s.length;a++)this._clearEmptyStyleAttr(s[a])},_clearEmptyStyleAttr(t){3!==t.nodeType&&""===t.getAttribute("style")&&t.removeAttribute("style")},_clearSpanInside(t){t.find("span").each((function(t){if(this.params.classname&&t.removeAttr("class"),this.params.styles)for(let e of Object.keys(this.params.styles))t.css(e,"");""===t.attr("class")&&t.removeAttr("class"),""===t.attr("style")&&t.removeAttr("style"),0===t.get().attributes.length&&t.unwrap()}).bind(this))},_isFullySelected(t,e){let i=this.app.utils.removeInvisibleChars(t.textContent);return e===i||-1!==e.search(RegExp("^"+this.app.utils.escapeRegExp(i)+"$"))}}),l.add("module","popup",{init:function(){this.stack=!1,this.stacks=[],this.name=!1,this.supername=!1,this.autoclose=!0,this.control=!1,this.saved=!1},start:function(){this._build(),this._buildDepth()},stop:function(){this._stopEvents(),this._stop()},stopStack:function(){this._stopEvents(),this.app.toolbar.unsetToggled(),this.$popup.removeAttr("data-"+this.prefix+"-popup-name"),this.$popup.removeClass("open")},isOpen:function(t){var e=this.$popup.hasClass("open");return t?this._getName()===t&&e:e},create:function(t,e){return this.isOpen(t)||(this._reset(),this.name=t,this.supername=t,this.stack=this._createStack(t,e)),this.stack},add:function(t,e){return this._createStack(t,e,!0)},setStack:function(t){this.stack=t,this.name=t.getName()},setData:function(t){this.stack.setData(t)},setFocus:function(t){this.stack.setFocus(t)},setWidth:function(t){this.stack.setWidth(t)},getName:function(){return this.name},getElement:function(){return this.$popup},getButton:function(){return this.button},getStack:function(t){return t?this.stacks[t]:this.stack},getBody:function(){return this.stack.getBody()},getItems:function(){return this.stack.getItems()},getFooter:function(){return this.stack.getFooter()},getFooterPrimary:function(){return this.stack.getFooterPrimary()},getTool:function(t){return this.stack.getTool(t)},getInput:function(t){return this.stack.getInput(t)},getFormItem:function(t){return this.stack.getFormItem(t)},getData:function(t){return this.stack.getData(t)},open:function(t){this.isOpen()?this.isOpen(this.supername)?(this.saved=!0,this.close(!1)):(this.saved=!0,this.close(!1),this._open(t,!1)):(this.saved=!1,this._open(t))},openStack:function(t){var e=this.getStack(t),i={};this.stack&&this.stack.isCollapsed()&&(i={collapse:!0},this.removeStack(this.stack)),e.open(i)},close:function(t,e){if(!1===this.autoclose){if(!0===t);else if(!e)return}this.isOpen()&&(t&&this._isPopupTarget(t)||(this._stopEvents(),this._resetToolbarToggledButton(),!1!==t&&!1===this.saved&&(this.app.scroll.save(),this.app.selection.restore(),this.app.scroll.restore()),this.$popup.hide(),this._closed()))},closeStacks:function(){for(var t in this.stacks)"object"==typeof this.stacks[t]&&this.stacks[t].close()},removeStack:function(t){var e=t.getName();delete this.stacks[e],this.$popup.find("[data-"+this.prefix+"-stack-name="+e+"]").remove()},updatePosition:function(t){this._buildPosition(t),this._buildHeight()},resize:function(){var t=this.$popup.attr("data-width"),e=this.app.editor.getWidth();"100%"!==t&&parseInt(t)<e||this.$popup.css("width",e+"px")},_build:function(){this.$popup=this.dom("<div>").addClass(this.prefix+"-popup "+this.prefix+"-popup-"+this.uuid),this.$popup.hide(),this.$popup.attr("dir",this.opts.editor.direction),this.app.$body.append(this.$popup)},_buildDepth:function(){this.opts.bsmodal&&this.$popup.css("z-index",1061)},_buildButton:function(t){t&&(this.button=!!Object.prototype.hasOwnProperty.call(t,"button")&&t.button)},_buildControl:function(t){t&&(this.control=!!Object.prototype.hasOwnProperty.call(t,"control")&&t.control)},_buildName:function(){this.$popup.attr("data-"+this.prefix+"-popup-name",this.name),this.$popup.addClass(this.prefix+"-popup-"+this.name)},_buildHeader:function(){this.header=this.app.create("popup.header",this)},_buildHeight:function(){var t,e,i=this.app.scroll.getTarget(),s=this.$popup.offset();this.app.scroll.isTarget()?(e=s.top-i.offset().top,t=i.height()-parseInt(i.css("border-bottom-width"))):(e=s.top-i.scrollTop(),t=i.height());var a=t-e-10;this.$popup.css("max-height",a+"px")},_buildPosition:function(){var t;t=this._isButton()&&this.button.isControl()||this._isControl()?this._buildPositionControl():this._isButton()?this._buildPositionButton():this._buildPositionModal(),this.$popup.css({top:t.top-1+"px",left:t.left+"px"})},_buildPositionButton:function(){var t=this.app.editor.getRect(),e=this.button.getOffset(),i=this.button.getDimension(),s=this.$popup.width(),a=this.$popup.height(),o={};return this._isToolbarButton()||this._isTopbarButton()?(o={top:e.top+i.height,left:e.left}).left+s>t.right&&(o.left=e.left+i.width-s):((o={top:e.top+t.top+i.height,left:e.left+t.left+i.width/2-s/2}).left+s>t.right&&(o.left=t.left+t.width-s),o.top+a>this.app.$doc.height()&&(o.top=o.top-a-i.height)),(o.left<t.left||o.left<0)&&(o.left=t.left),o},_buildPositionControl:function(){var t=this.app.block.get();t.isSecondLevel()&&(t=t.getFirstLevel());var e=t.getBlock().offset();return{top:e.top,left:e.left}},_buildPositionModal:function(){var t,e,i;if(this.opts.toolbar){var s=this.app.container.get("toolbar"),a=s.height();e=(t=s.offset()).top+a,i=t.left}else{var o=this.app.block.get();o.isSecondLevel()&&(o=o.getFirstLevel()),e=(t=o.getBlock().offset()).top,i=t.left}return{top:e,left:i}},_getName:function(){return this.$popup.attr("data-"+this.prefix+"-popup-name")},_setToolbarToggledButton:function(){if(this.app.toolbar.unsetToggled(),this._isToolbarButton()){var t=this.button.getName();this.app.toolbar.setToggled(t)}},_createStack:function(t,e,i){Object.prototype.hasOwnProperty.call(e,"collapse")&&!1===e.collapse&&(i=!1),Object.prototype.hasOwnProperty.call(e,"autoclose")&&(this.autoclose=e.autoclose);var s=this.app.create("popup.stack",t,e,i,this);return this.stacks[t]=s,s},_open:function(t,e){if(this._buildButton(t),this._buildControl(t),this._buildName(),this._buildHeader(),this.app.broadcast("popup.before.open").isStopped()){this.stopStack();return}this._setToolbarToggledButton(),this._startEvents(),!1!==e&&this.app.editor.isPopupSelection()&&this.app.selection.save(),this.stack=this._findActiveStack(),this.stack.open(t,!1,!1),this._buildPosition(),!1===e?(this.$popup.show(),this._opened()):this.$popup.fadeIn(100,this._opened.bind(this))},_opened:function(){this._buildHeight(),this.$popup.addClass("open"),this.app.broadcast("popup.open"),this.stack.renderFocus()},_closed:function(){var t="data-"+this.prefix+"-popup-name",e=this.$popup.attr(t);this.$popup.removeAttr(t),this.$popup.removeClass("open "+this.prefix+"-popup-"+e),this.saved=!1,this.app.broadcast("popup.close")},_isPopupTarget:function(t){return 0!==this.dom(t.target).closest("."+this.prefix+"-popup").length},_isButton:function(){return this.button},_isControl:function(){return this.control},_isToolbarButton:function(){return this.button&&("toolbar"===this.button.type||"context"===this.button.type)},_isTopbarButton:function(){return this.button&&"topbar"===this.button.type},_findActiveStack:function(){for(var t in this.stacks)"object"==typeof this.stacks[t]&&this.stacks[t].isActive()&&(this.stack=this.stacks[t]);return this.stack},_reset:function(){this.button=!1,this.control=!1,this.autoclose=!0,this.stack=!1,this.stacks=[],this.$popup.html(""),this.$popup.removeClass("has-footer has-items has-form")},_resetToolbarToggledButton:function(){if(this.button){var t=this.button.getName();this.app.toolbar.unsetToggled(t)}},_startEvents:function(){var t=this.prefix+"-popup";this.app.scroll.getTarget().on("resize."+t,this.updatePosition.bind(this)),this.app.scroll.getTarget().on("scroll."+t,this._buildPosition.bind(this))},_stopEvents:function(){this.app.scroll.getTarget().off("."+this.prefix+"-popup")},_stop:function(){this.$popup&&this.$popup.remove()}}),l.add("class","popup.item",{defaults:{container:!1,title:!1,html:!1,toggle:!0,active:!1,divider:!1,remover:!1,classname:!1,params:!1,instance:!1,observer:!1,command:!1},init:function(t,e,i){this.popup=t,this.name=e,this.params=this._buildParams(i),this._build(),this._buildContainer(),this._buildIcon(),this._buildTitle(),this._buildImage(),this._buildShortcut(),this._buildActive(),this._buildHidden(),this._buildDivider(),this._buildCommand(),this._buildRemover()},getPopup:function(){return this.popup},getName:function(){return this.name},getParams:function(){return this.params.params},getElement:function(){return this.$item},getInstance:function(){return this.params.instance},isControl:function(){return this.params.control},_build:function(){this.$item=this.params.html?this.dom(this.params.html):this.dom("<div>"),this.$item.addClass(this.prefix+"-popup-item "+this.prefix+"-popup-stack-item"),this.$item.attr({"data-name":this.name})},_buildContainer:function(){this.params.container&&this.$item.addClass(this.prefix+"-popup-item-container")},_buildTitle:function(){this.params.title&&(this.$title=this.dom("<span>").addClass(this.prefix+"-popup-item-title"),this.$title.html(this.lang.parse(this.params.title)),this.$item.append(this.$title))},_buildImage:function(){this.params.image&&(this.$image=this.dom("<span>").addClass(this.prefix+"-popup-item-image"),this.$image.html(this.params.image),this.$item.append(this.$image))},_buildIcon:function(){this.params.icon&&(this.$icon=this.dom("<span>").addClass(this.prefix+"-popup-item-icon"),this.opts.buttons.icons&&void 0!==this.opts.buttons.icons[this.name]?this.$icon.html(this.opts.buttons.icons[this.name]):!0===this.params.icon?this.$icon.addClass(this.prefix+"-icon-"+this.name):-1!==this.params.icon.search(/</)?this.$icon.html(this.params.icon):this.$icon.addClass(this.prefix+"-icon-"+this.params.icon),this.$item.append(this.$icon))},_buildShortcut:function(){if(this.params.shortcut){var t=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?"<b>&#8984;</b>":"ctrl";t=this.params.shortcut.replace("Ctrl",t),this.$shortcut=this.dom("<span>").addClass(this.prefix+"-popup-item-shortcut"),this.$shortcut.html(t),this.$item.append(this.$shortcut)}},_buildParams:function(t){return h.extend({},!0,this.defaults,t)},_buildActive:function(){this.params.active&&this.$item.addClass("active")},_buildHidden:function(){this.params.hidden&&this.$item.addClass(this.prefix+"-popup-item-hidden")},_buildDivider:function(){this.params.divider&&this.$item.addClass(this.prefix+"-popup-item-divider-"+this.params.divider)},_buildCommand:function(){this.params.command&&(this.$item.on("click."+this.prefix+"-popup-item-"+this.uuid,this._catch.bind(this)),this.$item.attr("data-command",this.params.command))},_buildRemover:function(){if(this.params.title&&this.params.remover){var t=this.dom("<span>").addClass(this.prefix+"-popup-item-trash "+this.prefix+"-icon-trash");t.attr("data-command",this.params.remover),t.on("click."+this.prefix+"-popup-item-"+this.uuid,this._catchRemover.bind(this)),this.$item.append(t)}},_catchRemover:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-popup-stack-item"),i=this.dom(t.target).closest("."+this.prefix+"-popup-item-trash").attr("data-command"),s=e.attr("data-name");this.app.api(i,this,s),e.fadeOut(200,function(t){t.remove()})},_catch:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-popup-stack-item"),i=e.attr("data-name"),s=e.attr("data-command");this.popup.$items.find("."+this.prefix+"-popup-stack-item").removeClass("active"),this.params.toggle&&e.addClass("active"),this.app.api(s,this.getParams(),this,i,t)}}),l.add("class","popup.stack",{defaults:{active:!1,title:!1,type:!1,width:!1,setter:!1,getter:!1,builder:!1,observer:!1,instance:!1,collapse:!1,form:!1,items:!1,html:!1,focus:!1,footer:!1},init:function(t,e,i,s){this.defaultWidth="240px",this.popup=s,this.name=t,this.tools={},this.data=!1,this.items=!1,this.formitems=!1,this.params=h.extend({},!0,this.defaults,e),i&&(this.params.collapse=!0),this._build(),this._observe()},set:function(t,e){this.params[t]=e},setData:function(t){this.data=t},setFocus:function(t){void 0!==this.tools[t]&&this.tools[t].setFocus()},setWidth:function(t){var e=this.app.popup.getElement();e.attr("data-width",t),"100%"===t&&(t=this.app.editor.getWidth()+"px"),e.css("width",t),this.app.$win.on("resize."+this.prefix+"-popup-"+this.uuid,this.popup.resize.bind(this.popup)),this.popup.resize()},setItemsData:function(t){this.items=t},get:function(t){return this.params[t]},getElement:function(){return this.$stack},getName:function(){return this.name},getBody:function(){return this.$body},getInstance:function(){return this.get("instance")},getItemsData:function(){return this.items},getItems:function(){return this.$items},getFooter:function(){return this.$footer},getFooterPrimary:function(){return this.$footer.find("."+this.prefix+"-form-button-primary")},getTool:function(t){return void 0!==this.tools[t]&&this.tools[t]},getInput:function(t){var e=this.getTool(t);return e?e.getInput():this.dom()},getFormItem:function(t){var e=this.getTool(t);return e?e.getInput().closest("."+this.prefix+"-form-item"):this.dom()},getData:function(t){var e;return t?void 0!==this.tools[t]&&(e=this.tools[t].getValue()):(e={},Object.keys(this.tools).forEach((function(t){e[t]=this.tools[t].getValue()}).bind(this))),e},hasForm:function(){return this.formitems},hasFooter:function(){return 0!==this.footerbuttons},hasItems:function(){return!1!==this.items},isCollapsed:function(){return this.get("collapse")},isActive:function(){return this.get("active")},open:function(t,e,i){if(t&&t.focus&&this.set("focus",t.focus),this.popup.closeStacks(),this.app.popup.setStack(this),!1!==i&&this.app.broadcast("popup.before.open").isStopped()){this.popup.stopStack();return}t&&t.collapse?(this._buildItems(),this._renderItems()):this.render(),this.popup.header.render(this.popup.stacks),this.popup.header.setActive(this),this.$stack.show(),this._renderWidth(),this.popup._buildPosition(),!1!==e&&this.renderFocus(),!1!==i&&this.app.broadcast("popup.open")},close:function(){this.$stack.hide()},collapse:function(){var t=this._getPrev();this.isCollapsed()&&this.popup.removeStack(this),t.open({collapse:!0})},render:function(){this._renderType(),this.params.html?this._renderHtml():this._renderItems(),this._renderForm(),this._renderFooter(),this._renderEnv()},renderFocus:function(){this.get("focus")&&this.setFocus(this.get("focus"))},_observe:function(){this.params.observer&&this.app.api(this.params.observer,this)},_getPrev:function(){var t;for(var e in this.popup.stacks)if(this.popup.stacks.hasOwnProperty(e)){if(e===this.name)return t;t=this.popup.stacks[e]}},_build:function(){this._buildElement(),this._buildBody(),this._buildFooter(),this._buildParams()},_buildElement:function(){this.$stack=this.dom("<div>").addClass(this.prefix+"-popup-stack "+this.prefix+"-popup-stack-"+this.name),this.$stack.hide(),this.$stack.attr("data-"+this.prefix+"-stack-name",this.name),this.popup.getElement().append(this.$stack)},_buildBody:function(){this.$body=this.dom("<div>").addClass(this.prefix+"-popup-body"),this.$stack.append(this.$body)},_buildFooter:function(){this.$footer=this.dom("<div>").addClass(this.prefix+"-popup-footer"),this.$stack.append(this.$footer)},_buildParams:function(){this.params.width=this.params.width?this.params.width:this.defaultWidth,this.params.setter=!!this.params.setter&&this.params.setter,this.params.getter=!!this.params.getter&&this.params.getter,this.data=!!this.params.getter&&this.app.api(this.params.getter,this),this._buildItems()},_buildItems:function(){this.params.builder?this.items=this.app.api(this.params.builder,this):this.params.items&&(this.items=this.params.items)},_renderWidth:function(){this.setWidth(this.get("width"))},_renderType:function(){this.$stack.removeClass(this.prefix+"-popup-type-grid");var t=this.get("type");t&&this.$stack.addClass(this.prefix+"-popup-type-"+t)},_renderHtml:function(){this.$items?this.$items.html(""):(this.$items=this.dom("<div>").addClass(this.prefix+"-popup-html"),this.$body.append(this.$items)),this.$items.append(this.params.html)},_renderItems:function(){if(this.items){for(var t in this.$items?this.$items.html(""):(this.$items=this.dom("<div>").addClass(this.prefix+"-popup-items"),this.$body.append(this.$items)),this.items)if(this.items.hasOwnProperty(t)){if(Object.prototype.hasOwnProperty.call(this.items[t],"observer")&&this.items[t].observer){var e=this.app.api(this.items[t].observer,this.items[t],t,this);void 0!==e&&(this.items[t]=e)}if(!1===this.items[t])continue;var i=this.app.create("popup.item",this,t,this.items[t]).getElement();this._renderItemPosition(this.$items,i,this.items[t])}}},_renderItemPosition:function(t,e,i){if(i.position){var s=i.position;if("first"===s)t.prepend(e);else if("object"==typeof s){var a=Object.prototype.hasOwnProperty.call(s,"after")?"after":"before",o=s[a],n=this._findPositionElement(o,t);n?n[a](e):t.append(e)}}else t.append(e)},_renderEnv:function(){var t=this.popup.getElement();t.removeClass("has-footer has-items has-form"),this.hasForm()&&t.addClass("has-form"),this.hasFooter()&&t.addClass("has-footer"),this.hasItems()&&t.addClass("has-items")},_renderForm:function(){this.formitems=this.get("form"),this.formitems&&(this.$form?this.$form.html(""):(this.$form=this.dom("<form>").addClass(this.prefix+"-popup-form"),this.$body.append(this.$form)),this._renderTools(),this._renderData(),this.$form.find("input[type=text],input[type=url],input[type=email]").on("keydown."+this.prefix+"-popup",(function(t){if(13===t.which)return t.preventDefault(),!1}).bind(this)))},_renderTools:function(){Object.keys(this.formitems).forEach((function(t){this._renderTool(t,this.formitems[t])}).bind(this))},_renderTool:function(t,e){var i=this.app.create("tool."+e.type,t,e,this,this.data),s=i.getElement();s&&(this.tools[t]=i,this.$form.append(s))},_renderData:function(){if(this.data)for(var t in this.data)void 0!==this.tools[t]&&this.tools[t].setValue(this.data[t])},_renderFooter:function(){this.footerbuttons=0;var t=this.get("footer");if(t){for(var e in this.$footer.html(""),t)if(t.hasOwnProperty(e)){if(!1===t[e])continue;var i=this.app.create("popup.button",e,this,t[e]);this.$footer.append(i.getElement()),this.footerbuttons++}}},_findPositionElement:function(t,e){var i;if(Array.isArray(t))for(var s=0;s<t.length&&0===(i=e.find("[data-name="+t[s]+"]")).length;s++);else i=e.find("[data-name="+t+"]");return 0!==i.length?i:0}}),l.add("class","popup.header",{init:function(t){this.popup=t,this._build()},setActive:function(t){this.$headerbox.find("."+this.prefix+"-popup-header-item").removeClass("active"),this.$headerbox.find("[data-"+this.prefix+"-name="+t.getName()+"]").addClass("active")},render:function(t){this._reset(),this._buildItems(t)>0&&this._buildClose()},_build:function(){this.$header=this.dom("<div>").addClass(this.prefix+"-popup-header"),this.$headerbox=this.dom("<div>").addClass(this.prefix+"-popup-header-box"),this.$header.append(this.$headerbox),this.popup.getElement().prepend(this.$header)},_buildClose:function(){var t=this.dom("<span>").addClass(this.prefix+"-popup-close");t.one("click",this._catchClose.bind(this)),this.$header.append(t)},_buildItems:function(t){var e=Object.keys(t).length,i=0,s=0;for(var a in t)if(t.hasOwnProperty(a)){if("object"!=typeof t[a])continue;s++;var o=t[a].get("title");o?(i++,this._buildItem(t[a],o,e)):1===s&&e>1&&(i++,this._buildItem(t[a],"## popup.back ##",e))}return i},_buildItem:function(t,e,i){var s=i>1,a=s?this.dom("<a>").attr("href","#"):this.dom("<span>");s&&(a.dataset("stack",t),a.addClass(this.prefix+"-popup-header-item-link"),a.on("click",this._catchStack.bind(this))),a.attr("data-"+this.prefix+"-name",t.getName()),a.addClass(this.prefix+"-popup-header-item"),a.html(this.lang.parse(e)),this.$headerbox.append(a)},_reset:function(){this.$headerbox.html(""),this.$header.find("."+this.prefix+"-popup-close").remove()},_catchStack:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).dataget("stack"),i=this.app.popup.getStack();i.isCollapsed()&&this.app.popup.removeStack(i),e.open()},_catchClose:function(t){t.preventDefault(),t.stopPropagation(),this.popup.close()}}),l.add("class","popup.button",{init:function(t,e,i){this.name=t,this.obj=i,this.popup=e,this.$button=this.dom("<button>").addClass(this.prefix+"-form-button"),this.$button.attr("data-name",this.name),this.$button.html(this.lang.parse(this.obj.title)),this.$button.dataset("instance",this),this._has("type")&&this.$button.addClass(this.prefix+"-form-button-"+this.obj.type),this._has("classname")&&this.$button.addClass(this.obj.classname),this._has("fullwidth")&&this.$button.addClass(this.prefix+"-form-button-fullwidth"),this._has("right")&&this.$button.addClass(this.prefix+"-form-button-push-right"),this.$button.on("click."+this.prefix+"-popup-button"+this.uuid,this._catch.bind(this))},getName:function(){return this.name},getElement:function(){return this.$button},invokeCommand:function(){this._invoke()},_has:function(t){return Object.prototype.hasOwnProperty.call(this.obj,t)},_catch:function(t){t.preventDefault(),t.stopPropagation(),this._has("command")?this._invoke(t):this._has("close")&&this.app.popup.close()},_invoke:function(t){this.app.api(this.obj.command,this.popup,this.name,t)}}),l.add("module","editor",{init:function(){this.mobileMode=!1,this.customButtons={}},start:function(){this._buildFrame(),this._buildDisabled(),this._buildBlurClass(),this._buildOptions(),this._buildMultiple(),this._buildParserTags(),this._buildStartHtml(),this._buildLayout(),this._buildContent()},stop:function(){this.$editor=!1,this.customButtons={},this.app.$element.show()},build:function(){this.app.embed.build(),this.app.blocks.build(),this.app.image.observeStates(),this.app.parser.buildPredefinedClasses(),this.app.broadcast("editor.build")},insertContent:function(t){this.app.insertion.insertContent(t)},setContent:function(t){this.app.insertion.setContent(t)},setEmpty:function(){this.app.insertion.setContent({html:""})},setWinFocus:function(){this.getWin().focus()},setFocus:function(t){this.opts.disableMode||(t?this._setFocusCaret(t):this._setFocusEvent())},setBlur:function(){!this.opts.disableMode&&this.isFocus()&&this.$editor.get&&(this.app.container.setBlur(),this.app.source.is()||(this._enableToolbarButtons(),this.app.block.unset(),this.app.blocks.unset()),this.app.selection.removeAllRanges(),this.app.source.is()||this.isMobileView()||(this.app.path.build(),this.app.toolbar.build(),this.app.control.close()),this.app.popup.close(!1),this.app.broadcast("editor.blur"))},selectAll:function(t){this.isAllSelected()||(this._setSelectAllClass(),this.app.blocks.unset(),this.app.blocks.setFirstLevel(),this.app.selection.removeAllRanges(),this.app.path.build(),this.app.toolbar.build(),this.app.control.close())},unselectAll:function(){this.isAllSelected()&&(this.unsetSelectAllClass(),this.app.block.unset(),this.app.blocks.unset())},unsetSelectAllClass:function(){this.$editor.removeClass(this.prefix+"-select-all")},addButton:function(t,e){this.customButtons[t]=e},getButtons:function(){var t=this.getButtonsFromArr(this.opts.buttons.editor),e={};for(var i in t)if(t.hasOwnProperty(i)){if("html"===i&&!this.opts.source||"templates"===i&&!this.opts.templates.json)continue;e[i]=t[i]}return h.extend(!0,{},e,this.customButtons)},getContent:function(t){var e="";return this.app.source.is()?e=this.app.source.getContent():(e=this._getContent(),e=t?this.app.tidy.parse(e):e),e=this.app.content.decodeHref(e)},getWidth:function(){var t=this.getEditor(),e=parseInt(t.css("padding-left")),i=parseInt(t.css("padding-right"));return t.width()-e-i},getRect:function(){return this.getFrameRect()},getFrameRect:function(){var t=this.$editor.offset(),e=this.$editor.width(),i=this.$editor.height(),s=Math.round(t.top),a=Math.round(t.left);return{top:s,left:a,bottom:s+i,right:a+e,width:e,height:i}},getSelection:function(){var t=this.getWinNode().getSelection();return t.rangeCount>0&&t},getEditor:function(){return this.getFrame()},getFrame:function(){return this.$editor?this.$editor:this.dom()},getLayout:function(){return this.$layout},getOverlay:function(){return this.$overlay},getHead:function(){return this.getDoc().find("head")},getBody:function(){return this.$editor?this.getDoc().find("body"):this.dom()},getDoc:function(){return this.dom(this.getDocNode())},getDocNode:function(){return!1===this.$editor?null:this.$editor.get().contentWindow.document},getWin:function(){return this.dom(this.getWinNode())},getWinNode:function(){return this.$editor.get().contentWindow},getButtonsFromArr:function(t){var e={};if(!Array.isArray(t)&&"object"==typeof t)return t;if(t)for(var i=h.extend(!0,{},this.opts.buttonsObj),s=0;s<t.length;s++){var a=t[s];void 0!==i[a]&&(e[a]=i[a])}return e},adjustHeight:function(){!this.$editor||this.app.isStopped()||setTimeout((function(){this.$editor.height(this.getBody().height())}).bind(this),1)},toggleView:function(t){this.mobileMode?(this.$editor.css("width",""),this.enableUI(),this.app.toolbar.unsetToggled("mobile"),this.app.event.run(),this.app.blocks.runEditableBlocks(),this.app.observer.build(),this.mobileMode=!1):(this.$editor.css("width",this.opts.editor.mobile+"px"),this.disableUI(),this.app.toolbar.setToggled("mobile"),this.app.popup.close(),this.app.control.close(),this.app.event.pause(),this.app.blocks.pauseEditableBlocks(),this.app.observer.stop(),this.mobileMode=!0),this.adjustHeight()},observeUI:function(){this.app.toolbar.observe()},enableUI:function(){this.app.path.enable(),this.app.topbar.enable(),this.app.toolbar.enable(),this.app.toolbar.enableSticky()},disableUI:function(){this.app.path.disable(),this.app.topbar.disable(),this.app.toolbar.disable(),this.app.toolbar.disableSticky()},isEditor:function(t){return this.isLayout(t)},isLayout:function(t){return this.dom(t).get()===this.$layout.get()},isTextarea:function(){return!1===this.opts.content},isAllSelected:function(){return this.$editor.hasClass(this.prefix+"-select-all")},isFocus:function(){return this.app.container.isFocus()},isEmpty:function(t){return!(this.app.blocks.getFirstLevel().length>1)&&this.app.content.isEmptyHtml(this.$layout.html(),t)},isMobileView:function(){return this.mobileMode},isPopupSelection:function(){return!0},isBlocksSelection:function(){return!1},_buildFrame:function(){this.app.$element.hide(),this.$editor=this.dom("<iframe>").addClass(this.prefix+"-editor-frame"),this.app.container.get("editor").append(this.$editor),this.$overlay=this.dom("<div>").addClass(this.prefix+"-editor-overlay"),this.app.container.get("editor").append(this.$overlay)},_buildDisabled:function(){this.opts.disableMode=this.opts.editor.disabled||null!==this.app.$element.attr("disabled")},_buildBlurClass:function(){this.app.container.get("main").addClass(this.prefix+"-in-blur")},_buildMultiple:function(){!1===this.opts.selection.multiple&&this.app.shortcut.remove("meta+click")},_buildOptions:function(){var t=this.$editor,e=this.opts.editor,i=this.opts.paste;Object.prototype.hasOwnProperty.call(i,"autolink")&&(i.autoparse=i.autolink),t.attr("dir",e.direction),t.attr("scrolling","no"),t.css("visibility","hidden"),e.minHeight&&t.css("min-height",e.minHeight),e.maxHeight&&(t.css("max-height",e.maxHeight),t.attr("scrolling","yes")),e.notranslate&&t.addClass("notranslate"),e.spellcheck||t.attr("spellcheck",!1)},_buildStartHtml:function(){var t=this._createDoctype(),e=this._createScripts(),i='<div class="'+this.opts.editor.classname+'"></div>';this._writeCode(t+"<html><head></head><body>"+i+e+"</body></html>")},_buildLayout:function(){var t=this.getBody(),e=this.opts.editor.classname.split(" ").join(".");this.$layout=t.find("."+e).first(),this.$layout.attr("dir",this.opts.editor.direction),!1===this.opts.editor.padding&&this.$layout.css("padding",0),t.css("height","auto")},_buildContent:function(){var t=this._getContentValue();t=this.app.broadcastHtml("editor.before.load",t);var e=this.app.parser.parse(t,!0,!0);this.$layout.html(e.get().childNodes);var i=this.app.parser.unparse(this.$layout.html());this.app.$element.val(i),this._load()},_buildVisibility:function(){this.$editor.css("visibility","visible")},_buildEditorCss:function(){if(this.opts.css){t=Array.isArray(this.opts.css)?this.opts.css:[this.opts.css+"arx-frame.min.css",this.opts.css+"arx-content.min.css"];for(var t,e=0;e<t.length;e++)this._buildCssLink(t[e])}},_buildCustomCss:function(){if(this.opts.custom.css)for(var t=0;t<this.opts.custom.css.length;t++)this._buildCssLink(this.opts.custom.css[t])},_buildCssLink:function(t){var e="object"==typeof t?t:{href:t},i="string"==typeof t?t.search(/\?/g):t.href.search(/\?/g),s=this.opts.editor.csscache?"":(-1===i?"?":"&")+new Date().getTime();e.href=e.href+s;var a=this.dom("<link>").attr({class:this.prefix+"-css",rel:"stylesheet"});a.attr(e),this.getHead().append(a)},_buildGridCssVar:function(){if(this.opts.grid){var t=this.getDocNode().documentElement.style;t.setProperty("--"+this.prefix+"-grid-columns",this.opts.grid.columns),t.setProperty("--"+this.prefix+"-grid-gutter",this.opts.grid.gutter),t.setProperty("--"+this.prefix+"-grid-offset-left",this.opts.grid.offset.left),t.setProperty("--"+this.prefix+"-grid-offset-right",this.opts.grid.offset.right),this.app.initialSettings.grid&&this.app.initialSettings.grid.patterns&&(this.opts.grid.patterns=this.app.initialSettings.grid.patterns)}},_buildParserTags:function(){var t=this.opts.parser;for(var e in t)if(t[e].parse&&t[e].tag){var i=t[e].tag;void 0===this.opts.parserTags[i]&&(this.opts.parserTags[i]=[]),this.opts.parserTags[i].push(t[e].parse)}},_buildDraggable:function(){this.app.$body.find("[data-"+this.prefix+"-drop-id]").each((function(t){t.attr("draggable",!0),t.on("dragstart",(function(t){var e=this.dom(t.target).attr("data-"+this.prefix+"-drop-id");t.dataTransfer.setData("item",e)}).bind(this))}).bind(this))},_load:function(){try{this._loadImages(),this._loaded()}catch(t){h.error(t)}},_loaded:function(){this.app.sync.build(),this.app.event.build(),this.app.embed.build(),this.app.blocks.build(),this.app.image.observeStates(),this._buildVisibility(),this._buildEditorCss(),this._buildCustomCss(),this._buildGridCssVar(),this._buildDraggable(),this.getWin().on("resize."+this.prefix+"-editor-frame",this.adjustHeight.bind(this)),this.app.broadcast("editor.load"),this.adjustHeight(),setTimeout((function(){this.app.isStopped()||(this.adjustHeight(),this._setFocusOnStart(),this.app.observer.build(),this.app.broadcast("editor.ready"))}).bind(this),500),setTimeout(this.adjustHeight.bind(this),3e3)},_loadedImage:function(){this.imageslen--},_loadImages:function(){var t=this.getDoc().find("img");this.imageslen=t.length,t.each(this._loadImage.bind(this));var e=setInterval((function(){if(0===this.imageslen){this.adjustHeight(),clearInterval(e);return}}).bind(this),50)},_loadImage:function(t){var e=t.get();if(this.opts.editor.images){var i=e.src.split("/"),s=i[i.length-1];e.src=this.opts.editor.images+s}t.one("load",this._loadedImage.bind(this))},_setFocusOnStart:function(){this.opts.editor.focus&&(this.setFocus(),this.setFocus(this.opts.editor.focus))},_setSelectAllClass:function(){this.$editor.addClass(this.prefix+"-select-all")},_setFocusCaret:function(t){t=this._getCaretPosition(t);var e=this._getFocusTarget(t);this.app.block.set(e,t)},_setFocusEvent:function(){if(!this.isFocus()){for(var t=0;t<h.instances.length;t++)h.instances[t]!==this.app&&h.instances[t].editor.setBlur();this.app.container.setFocus(),this.app.broadcast("editor.focus")}},_getCaretPosition:function(t){return!0===t?"start":t},_getFocusTarget:function(t){return"start"===t?this.app.blocks.getFirst():this.app.blocks.getLast()},_getContent:function(){var t=this.$layout.html();return this.app.parser.unparse(t)},_getContentValue:function(){return this.opts.content?this.opts.content:this.app.$element.val()},_enableToolbarButtons:function(){this.app.source.is()||this.isMobileView()||this.app.toolbar.enable()},_writeCode:function(t){var e=this.getDocNode();e.open(),e.write(t),e.close()},_createDoctype:function(){return this.opts.editor.doctype+"\n"},_createScripts:function(){if(!this.opts.custom.js)return"";for(var t="",e=this.opts.custom.js,i=0;i<e.length;i++){var s="object"==typeof e[i]?e[i]:{src:e[i]};s.src=s.src+"?"+new Date().getTime(),t+=this.dom("<script>").addClass(this.prefix+"-js").attr(s).get().outerHTML}return t}}),l.add("module","observer",{init:function(){this.observer=!1,this.trigger=!0},build:function(){if(window.MutationObserver){var t=this.app.editor.getLayout().get();this.observer=this._build(t),this.observer.observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})}},stop:function(){this.observer&&this.observer.disconnect(),this.trigger=!0},_build:function(t){var e=this;return new MutationObserver(function(i){e._observe(i[i.length-1],t)})},_observe:function(t,e){("attributes"!==t.type||t.target!==e)&&this.trigger&&(this.app.editor.adjustHeight(),this.app.broadcast("observer.change"),this.app.placeholder.toggle(),this.app.sync.trigger())}}),l.add("module","parser",{build:function(t){return this.$layout=this.dom("<div>"),this.$layout.html(t),this.$layout.find("[data-"+this.prefix+"-type]").each(this._build.bind(this)),this.$layout},buildElement:function(t){t.find("[data-"+this.prefix+"-type]").each(this._build.bind(this))},buildPredefinedClasses:function(t){if(this.opts.classes){t=t||this.app.editor.getLayout();var e=this.app.content,i=!0,s=!1;if(void 0!==this.opts.classes.blocks&&(s=!0,void 0===this.opts.classes.tags&&(i=!1)),i&&t.find(e.getPredefinedTags().join(",")).each(e.addPredefinedTagClass.bind(this)),s){var a=e.getPredefinedBlocks(),o="data-"+this.prefix+"-type",n="["+o+"="+a.join("],["+o+"=")+"]";t.find(n).each(e.addPredefinedBlockClass.bind(this))}}},parse:function(t,e,i){return t=t.trim(),t=this.app.broadcastHtml("editor.before.parse",t),this.app.content.isEmptyHtml(t)?t=this.app.block.createHtml():(t=this._clean(t,i),t=this._parse(t)),t=this.app.broadcastHtml("editor.parse",t),!1!==e?this.build(t):t},parseLine:function(t,e){return" "===t?t="&nbsp;":(t=(t=this.app.broadcastHtml("editor.before.parse",t)).replace(/\r?\n/g,"<br>"),t=this.app.content.encodeCode(t),t=this.app.content.sanitize(t),t=this.app.content.removeEmptySpans(t),t=this.app.content.addHttps(t),t=this.app.broadcastHtml("editor.parse",t)),!1!==e?this.build(t):t},unparse:function(t,e){var i={};return(t=t.trim(),t=this.app.broadcastHtml("editor.before.unparse",t),this.app.content.isEmptyHtml(t))?"":(t=this._revertForms(t),t=this._revertFrames(t),t=this.app.content.store(t,"noneditable",i,0),t=this.app.content.store(t,"embed",i,0),t=this.app.content.addNofollow(t),t=this.app.content.removeMarkers(t),t=this.app.utils.removeInvisibleChars(t),t=this.app.content.recacheStyle(t),t=this.app.content.restore(t,"noneditable",i),t=this.app.content.restore(t,"embed",i),t=this.app.content.removeEmptyAttrs(t,["style","class","rel","alt","title"]),t=this._unparseAllTags(t),t=this._unparseDataType(t,e),t=(t=this.app.content.removeEmptyAttrs(t,["style","class","rel","alt","title"])).replace(/&quot;(.*?)&quot;/gi,"'$1'"),t=this.app.utils.replaceRgbToHex(t),this.opts.classes&&(t=this.app.utils.wrap(t,this.buildPredefinedClasses.bind(this))),"<p></p>"===t&&(t=""),this.app.broadcastHtml("editor.unparse",t))},_build:function(t){var e=t.attr("data-"+this.prefix+"-type");this.app.create("block."+e,t)},_clean:function(t,e){var i={},s=[];return t=(t=this.app.content.storeComments(t,s)).replace(/t/gi,"&current"),e&&this.app.editor.isTextarea()&&(t=this.app.content.encodeCode(t)),t=this.app.content.sanitize(t),t=this._convertFrames(t),t=this._convertForms(t),t=this.app.content.store(t,"noneditable",i,0),t=this.app.content.store(t,"embed",i,0),t=this.app.content.removeTags(t,this.opts.tags.denied),t=this.app.content.removeDoctype(t),t=this.app.content.removeTagsWithContent(t,["script","style"]),t=this.app.content.removeEmptySpans(t),t=this.app.content.addHttps(t),t=this.app.content.removeBlockTagsInside(t,["th","td","li","dt","dd","address"]),t=this.app.content.cacheStyle(t),t=this.app.content.restore(t,"noneditable",i),t=this.app.content.restore(t,"embed",i),t=this.app.content.restoreComments(t,s),this.opts.clean.comments&&(t=this.app.content.removeComments(t)),t=this.app.content.isEmptyHtml(t)?this.app.block.createHtml():this.app.content.paragraphize(t)},_parse:function(t){return this.app.utils.wrap(t,(function(t){for(var e=this.app.element.getBlocks(t),i=0;i<e.length;i++)this._parseHtml(e[i]);this.buildPredefinedClasses(t)}).bind(this))},_parseHtml:function(t){var e,i=t.tagName.toLowerCase(),s=this.dom(t),a=this.opts.parserTags;if(a[i])for(var o=0;o<a[i].length&&!(e=a[i][o].call(this.app,s));o++);e||(e=this._parseType(s,i)),e&&(s.attr("data-"+this.prefix+"-type",e),"image"===e&&i!==this.opts.image.tag&&(s=this.app.element.replaceToTag(s,this.opts.image.tag,!0)),-1!==this.opts.nested.indexOf(e)&&this._parseNested(s))},_parseType:function(t,e){return t.attr("data-"+this.prefix+"-type")?t.attr("data-"+this.prefix+"-type"):this._isNoneditable(t)?"noneditable":this._parseTypeByTag(t,e)},_parseNested:function(t){for(var e=this.app.element.getBlocks(t),i=0;i<e.length;i++)this._parseHtml(e[i])},_parseTypeByTag:function(t,e){var i;switch(e){case"p":i="paragraph",this._isImageBlock(t,"p")&&(i="image");break;case"figure":i="embed",this._isImageBlock(t,"figure")?i="image":this._hasChild(t,"pre")?i="code":this._hasChild(t,"blockquote")&&(i="quote");break;case"div":i="layer",t.attr("data-"+this.prefix+"-type")?i=!1:this._isGridBlock(t)?i="grid":this._isColumnBlock(t)?i="column":this._isTextBlock(t)?i="text":this._isCardBlock(t)?i="card":this._isImageBlock(t,"div")&&(i="image");break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":i="heading";break;case"blockquote":i="quote";break;case"table":i="table";break;case"pre":i="code";break;case"hr":i="line";break;case"dl":i="dlist";break;case"address":i="address";break;case"ul":case"ol":i="list";break;case"main":case"section":case"header":case"footer":case"aside":case"article":i="layer"}return i},_isNoneditable:function(t){return t.hasClass(this.opts.noneditable.classname)},_isColumnBlock:function(t){if(this.opts.grid){var e=t.parent();if(0!==e.length&&"grid"===e.attr("data-"+this.prefix+"-type"))return!0}},_isGridBlock:function(t){if(this.opts.grid)return t.hasClass(this.opts.grid.classname)},_isTextBlock:function(t){return this.opts.text&&t.hasClass(this.opts.text.classname)},_isCardBlock:function(t){return this.opts.card&&t.hasClass(this.opts.card.classname)},_isImageBlock:function(t,e){var i=t.find("img");if(0!==i.length&&("div"!==e||0===i.closest("figure").length)){var s=i,a=i.parent(),o=0!==a.length&&a.get().tagName;if(o&&("A"===o||"SPAN"===o))s=a;else if(o&&a.get()!==t.get())return;if(0===s.prevElement().length&&("figure"===e||0===s.nextElement().length))return!0}},_hasChild:function(t,e){if("pre"===e){if(0!==t.find("pre").length)return!0}else if("blockquote"===e){var i=t.find("blockquote");if(0===t.find("script").length&&0!==i.length)return!0}},_getPredefinedTags:function(){var t=[];return Object.keys(this.opts.classes).forEach(function(e){t.push(e)}),t},_addPredefinedClass:function(t){var e=t.get().tagName.toLowerCase();void 0!==this.opts.classes[e]&&t.addClass(this.opts.classes[e])},_unparseAllTags:function(t){return this.app.utils.wrap(t,(function(t){t.find("*").removeAttr("contenteditable data-gramm_editor"),this.opts.image.states||t.find("img").removeAttr("data-image")}).bind(this))},_unparseDataType:function(t,e){return this.app.utils.wrap(t,(function(t){var i=t.find("[data-"+this.prefix+"-type]");!0!==e&&i.removeClass(this.prefix+"-block-state"),i.removeAttr("data-"+this.prefix+"-first-level data-"+this.prefix+"-parsed"),i.removeClass(this.prefix+"-block-focus "+this.prefix+"-block-multiple-focus "+this.prefix+"-block-multiple-hover "+this.prefix+"-editable-pause"),i.removeClass(this.prefix+"-empty-layer"),i.each(this._unparseByType.bind(this)),i.removeAttr("data-"+this.prefix+"-type"),t.find("figcaption").removeAttr("data-"+this.prefix+"-type data-placeholder").each(this.app.content._removeEmptyTag.bind(this))}).bind(this))},_unparseByType:function(t){var e=t.attr("data-"+this.prefix+"-type");"list"===e&&this.app.content.unfixListMargin(t),this.opts.parser[e]&&this.opts.parser[e].unparse&&this.opts.parser[e].unparse.call(this.app,t)},_convertFrames:function(t){return this.app.utils.wrap(t,(function(t){t.find("iframe").each(this._convertFrame.bind(this))}).bind(this))},_convertForms:function(t){return this.app.utils.wrap(t,(function(t){t.find("form").each(this._convertForm.bind(this))}).bind(this))},_convertFrame:function(t){0===t.closest("figure").length&&(t.wrap("<figure>"),t.parent().addClass(this.prefix+"-figure-iframe"))},_convertForm:function(t){var e=this.app.element.replaceToTag(t,"figure");e.addClass(this.prefix+"-figure-form"),e.attr("data-"+this.prefix+"-type","form")},_revertFrames:function(t){return this.app.utils.wrap(t,(function(t){t.find("."+this.prefix+"-figure-iframe").each(this._revertFrame.bind(this))}).bind(this))},_revertForms:function(t){return this.app.utils.wrap(t,(function(t){t.find("."+this.prefix+"-figure-form").each(this._revertForm.bind(this))}).bind(this))},_revertFrame:function(t){0!==t.find("figcaption").length?t.removeClass(this.prefix+"-figure-iframe"):t.unwrap()},_revertForm:function(t){this.app.element.replaceToTag(t,"form").removeClass(this.prefix+"-figure-form")}}),l.add("module","blocks",{build:function(){this._buildFirstLevel()},is:function(){return this.getSelected().length>1},set:function(t){t=t.closest("[data-"+this.prefix+"-first-level]"),this.unsetNotFirstLevel(),this._setFocus(t),setTimeout((function(){this.app.selection.removeAllRanges()}).bind(this),0),this.app.path.build(),this.app.toolbar.build(),this.app.control.close(),this._checkSelected()},setFirstLevel:function(){this.app.blocks.getFirstLevel().addClass(this.prefix+"-block-focus")},unset:function(){this.getBlocks().removeClass(this.prefix+"-block-focus "+this.prefix+"-block-multiple-hover")},unsetNotFirstLevel:function(){this.getBlocks().not("[data-"+this.prefix+"-first-level]").removeClass(this.prefix+"-block-focus")},unsetHover:function(){this.getBlocks().removeClass(this.prefix+"-block-multiple-hover")},getBlocks:function(){return this.app.editor.getLayout().find("[data-"+this.prefix+"-type]")},getFirstLevel:function(){return this.app.editor.getLayout().find("[data-"+this.prefix+"-first-level]")},getEditableBlocks:function(){return this.app.editor.getLayout().find("[contenteditable=true]")},getSelected:function(){return this.app.editor.getLayout().find("."+this.prefix+"-block-focus")},getSelectedBlocks:function(){return this.getSelectedBlocks()},getFirst:function(){return this.getBlocks().first().dataget("instance")},getFirstSelected:function(){return this.getSelected().first().dataget("instance")},getLast:function(){return this.getBlocks().last().dataget("instance")},getLastSelected:function(){return this.getSelected().last().dataget("instance")},pauseEditableBlocks:function(){this.getEditableBlocks().attr("contenteditable",!1).addClass(this.prefix+"-editable-pause")},runEditableBlocks:function(){this.app.editor.getLayout().find("."+this.prefix+"-editable-pause").attr("contenteditable",!0).removeClass(this.prefix+"-editable-pause")},removeSelected:function(t){var e,i=this.getLastSelected();!1!==t&&i&&(e=i.getNext()),this.getSelected().each(this._removeSelectedBlock.bind(this)),e&&this.app.block.set(e,"start")},_buildFirstLevel:function(){var t="data-"+this.prefix+"-first-level",e=this.app.editor.getLayout();e.find("["+t+"]").removeAttr(t),e.children("[data-"+this.prefix+"-type]").attr(t,!0)},_checkSelected:function(){var t=this.getFirstLevel(),e=this.getSelected();0===e.length?(this.unsetHover(),this.app.block.unset()):1===e.length?(this.unsetHover(),this.app.block.set(e.eq(0),!1,!0)):t.length===e.length?(this.unsetHover(),this.app.editor.selectAll()):this.app.editor.unsetSelectAllClass()},_setFocus:function(t){var e=t.hasClass(this.prefix+"-block-focus")?"removeClass":"addClass";t[e](this.prefix+"-block-focus"),t.removeClass(this.prefix+"-block-multiple-hover")},_removeSelectedBlock:function(t){t.dataget("instance").remove({traverse:!1})}}),l.add("module","block",{init:function(){this.instance=!1,this.$block=!1},create:function(t){var e=this.app.create("block."+this.opts.editor.markup);return t&&e.getBlock().html(t),e},createHtml:function(t){return this.create(t).getOuterHtml()},is:function(t){return t?this._isBlockActive(t):this.get()},isType:function(t){if(this.is())return this.get().isType(t)},isParent:function(t){if(this.is()){var e=Array.isArray(t)?t:[t],i=this.get().getBlock();return 0!==this.app.element.getParents(i,e).length}},get:function(){return this.instance},set:function(t,e,i){t.isBlock&&(t=t.getBlock()),!0!==i&&this._isBlockActive(t)||(this.unset(),this.instance=this._getInstance(t),this.$block=this.instance.getBlock(),this.$block.addClass(this.prefix+"-block-focus"),this._setCaret(e),this.app.path.build(),this.app.toolbar.build(),this.app.control.build(),this.app.broadcast("block.set"))},unset:function(){this.instance&&(this.instance=!1,this.$block=!1,this.app.blocks.unset(),this.app.editor.unsetSelectAllClass(),this.app.path.build(),this.app.toolbar.build(),this.app.control.close(),this.app.broadcast("block.unset"))},duplicate:function(){if(this._isAction()){var t=this.get(),e=t.duplicate(),i=t.insert({instance:e,position:"after",caret:"start",type:"duplicate"});return this.app.broadcast("block.duplicate",{instance:i}),i}},moveUp:function(){this._isAction()&&this.get().moveUp()},moveDown:function(){this._isAction()&&this.get().moveDown()},change:function(t){if(this.is()){var e=this.get().getBlock(),i=t.getBlock();e.after(i),e.remove(),this.app.parser.buildElement(i),this.app.editor.build(),this.set(t),this.app.broadcast("block.change",{instance:t})}},add:function(t){this.app.popup.close();var e=this.get();t.type&&"image"===t.type&&e&&"cell"===e.getType()&&(e=e.getParent("table"));var i=!1,s=!1,a=t.instance?t.instance:this.app.create("block."+t.name,t.source);if(this.app.editor.isAllSelected())e=this.create(),this.app.editor.unsetSelectAllClass(),this.app.editor.getLayout().html("").append(e.getBlock()),s="after",i=!0;else if(this.app.blocks.is())e=this.app.blocks.getLastSelected(),s="after";else if(e){if(e.isInlineBlock()){if("variable"!==a.getType()){var o=e.getParent();this.app.caret.set(e.getBlock(),"after"),this.app.block.set(o),e=this.get()}}else if(e.isEmptiable()&&e.isEmpty()){var n=e.getBlock();n.removeClass(this.prefix+"-empty-layer"),n.html(""),s="append"}}else"top"===this.opts.editor.add?(e=this.app.blocks.getFirst(),s="before"):(e=this.app.blocks.getLast(),s="after");s=t.position?t.position:s;var r=!0;if(e){var l=e.getType();"paragraph"===t.name&&-1!==["paragraph","text","heading"].indexOf(l)&&(r=!1)}return e.insert({instance:a,position:s,caret:t.caret?t.caret:"end",remove:r,type:"add"}),i&&e.remove(),a},format:function(t){this.app.format.set(t)},remove:function(t){var e=this.get();if(e){var i=e.getType(),s=e.getParent();if(t&&void 0!==t.traverse&&!1===t.traverse)this.unset(),e.remove();else{var a=e.getNext(),o=e.getPrev();e.remove(),a?this.app.block.set(a,"start"):o?this.app.block.set(o,"end"):this.unset()}"image"===i&&this.app.broadcast("image.remove",{url:e.getSrc(),id:e.getId()}),this.app.broadcast("block.remove",{type:i,parent:s}),this.app.editor.isEmpty()&&this.app.editor.setEmpty()}},observe:function(t,e){if(-1!==["line","quote","layer","code"].indexOf(e)&&!this.opts[e]||"alignment"===e&&!this.opts.align||"valign"===e&&!this.opts.valign||"outset"===e&&!this.opts.outset)return!1},observeCard:function(t,e){if("image"===e&&!this.get().hasImage())return!1},popup:function(t,e,i){var s;"alignment"===i?s=this._buildSegments("align","alignment"):"valign"===i?s=this._buildSegments("valign"):"outset"===i&&(s=this._buildSegments("outset")),this.app.popup.create(i,{setter:"block.setData",getter:"block.getData",form:s}),this.app.popup.open({button:e})},css:function(t,e){if(this.is()){var i=this.get().getBlock();i.css(t,e),t="data-"+this.prefix+"-style-cache";var s=i.attr("style");s&&(s=s.replace(/"/g,""),i.attr(t,s))}},getData:function(){if(this.is())return this.get().getData()},setData:function(t){if(this.is()){var e=t.getData();this.get().setData(e)}},_isBlockActive:function(t){return!this.app.blocks.is()&&this.instance&&this.dom(t).get()===this.$block.get()},_isAction:function(){return!this.app.blocks.is()&&this.is()},_buildSegments:function(t,e){var i={},s={},a=this.opts[t];for(var o in a)a[o]&&(s[o]={name:a[o],prefix:t});return e=e||t,i[t]={type:"segment",label:"## form."+e+" ##",segments:s},i},_appendToEmptyBlock:function(t){var e=this.app.block.create();return e.append(t),e.getBlock()},_getInstance:function(t){return this.dom(t).dataget("instance")},_setCaret:function(t){if(this.instance.isEditable()){if(t){var e=this.$block;"list"===this.instance.getType()&&("start"===t||"end"===t)&&(e="start"===t?this.$block.find("li").first():this.$block.find("li").last()),this.app.caret.set(e,t)}}else this.app.scroll.save(),this.app.editor.getWin().focus(),this.$block.focus(),setTimeout((function(){this.app.selection.removeAllRanges()}).bind(this),0),this.app.scroll.restore()}}),l.add("module","event",{init:function(){this.dragoverEvent=!1,this.imageDrag=!1,this.pressedCmd=!1,this.isPopupMouseUp=!1,this.isBlockMouseUp=!1,this.pasteEvent=!1,this.events={frame:["click","contextmenu","touchstart","mouseover","mouseup","mousedown","keydown","keyup","paste","copy","cut","drop","dragstart","dragover","dragleave"],doc:["keydown","mousedown","click"],win:["focus"],editor:["click"]}},run:function(){this._runEvents()},pause:function(){this._pauseEvents()},build:function(){this._buildTargets(),this._buildPreventLinks(),this._buildEvents()},stop:function(){var t=this.prefix+"-events";this.$body.off("."+t),this.$win.off("."+t),this.app.$doc.off("."+t)},onmouseover:function(t){this._buildHover(t),this.app.broadcast("editor.mouseover",{e:t})},oncontextmenu:function(t){if(this.pressedCmd){t.preventDefault();var e=this._getBlock(t);this.app.blocks.set(e)}},onclick:function(t){this.app.broadcast("editor.click",{e:t}),this._isEditorClick(t)&&!this.isBlockMouseUp&&this._setByClick(t)},onmouseup:function(t){this.app.state.add(t),this.app.broadcast("editor.mouseup",{e:t}),this.app.toolbar.observe()},onmousedown:function(t){if(this.app.popup.isOpen()&&this.app.popup.close(),this._setBlock(t),this._setCaretInline(t),this.app.placeholder.handleClick(t),this._isEditorClick(t)){this.isBlockMouseUp=!1;return}this.isBlockMouseUp=!0,this.app.state.add(t),this.app.broadcast("editor.mousedown",{e:t})},ontouchstart:function(t){this.app.state.add(t)},onkeydown:function(t){var e=this.app.broadcast("editor.keydown",this._buildEventKeysObj(t));if(e.isStopped())return t.preventDefault();if(!1===this.opts.editor.enterKey&&13===t.which){t.preventDefault();return}if(this.app.state.listen(t)||(this.pressedCmd=this._isCmdPressed(t),this._isEsc(t)&&(this.app.block.unset(),this.app.selection.removeAllRanges()),this.app.shortcut.handle(t))){this.pressedCmd=!1;return}this.app.input.handle(e)},onkeyup:function(t){if(this.app.broadcast("editor.keyup",this._buildEventKeysObj(t)).isStopped())return t.preventDefault();if(t.which===this.app.keycodes.TAB&&!this.app.block.is()){if(t.target&&"BODY"===t.target.tagName){var e=this.app.blocks.getFirst();this.app.editor.setFocus(),this.app.block.set(e)}else this._setBlock(t)}this.pressedCmd=!1,this.app.blocks.unsetHover(),this.app.toolbar.observe()},onpaste:function(t){this._paste(t)},oncopy:function(t){this._copy(t)},oncut:function(t){this._cut(t)},ondrop:function(t){if(!this.opts.editor.drop||this.app.broadcast("editor.drop",{e:t}).isStopped())return t.preventDefault();var e,i=t.dataTransfer,s=i.getData("item");if(""!==s){if(t.preventDefault(),e=this.opts.draggable&&void 0!==this.opts.draggable[s]?this.opts.draggable[s]:(e=this.dom("[data-"+this.prefix+"-drop-item="+s+"]").html()).trim()){var a="after";0!==this.app.editor.getBody().find("."+this.prefix+"-draggable-over").length&&(a="append"),this._drop(t,e,a,!1)}}else if(this.opts.image&&this.opts.image.upload&&null!==i.files&&i.files.length>0)t.preventDefault(),this.app.image.drop(t,i);else{e=""===(e=i.getData("text/html")).trim()?i.getData("Text"):e;var o=this._drop(t,e);this.imageDrag&&0!==o.instances.length&&o.instances[0].change(this.imageDrag,!1)}this._removeDragPlaceholder(),this.imageDrag=!1,this.app.observer.trigger=!0},ondragstart:function(t){var e=this._getBlock(t.target);0!==e.length&&"image"===this.app.element.getType(e)&&(this.imageDrag=e.dataget("instance")),this.app.broadcast("editor.dragstart",{e:t})},ondragover:function(t){if(t.preventDefault(),this.dragoverEvent=!0,this.app.observer.trigger=!1,this._removeDragPlaceholder(),-1!==t.dataTransfer.types.indexOf("item")){var e=this._getBlock(t.target);if(0!==e.length){var i=e.dataget("instance");if(i.getType("layer")&&i.isEmpty())e.addClass(this.prefix+"-draggable-over");else{var s=this.dom("<div>").addClass(this.prefix+"-draggable-placeholder");e.after(s)}}}this.app.broadcast("editor.dragover",{e:t})},ondragleave:function(t){t.preventDefault(),this.dragoverEvent=!1,this._removeDragPlaceholder(),this.app.observer.trigger=!0,this.app.broadcast("editor.dragleave",{e:t})},oneditorclick:function(t){"HTML"===t.target.tagName&&this._setByClick(t)},onwinfocus:function(t){if(this._isRemoveRanges()){setTimeout((function(){this.app.selection.removeAllRanges()}).bind(this),0);return}},ondockeydown:function(t){if(this.app.popup.isOpen()){if(this._isEnter(t)){var e=this.app.popup.getStack();if(!1!==e.hasForm()&&"TEXTAREA"!==t.target.tagName){t.preventDefault(),e.getFooterPrimary().dataget("instance").invokeCommand();return}}this._isEsc(t)&&this.app.popup.close(!1)}},ondocmousedown:function(t){this.isPopupMouseUp=0!==this.dom(t.target).closest("."+this.prefix+"-popup-"+this.uuid).length},ondocclick:function(t){this._isOutsideEditor(t)&&(this.app.popup.isOpen()?!1===this.isPopupMouseUp&&this.app.popup.close(!1):this.app.editor.setBlur(),this.pressedCmd=!1)},_buildPreventLinks:function(){var t=this.prefix+"-prevent-events";this.$body.on("click."+t+" dblclick."+t,this._preventLinks.bind(this))},_buildTargets:function(){this.$body=this.app.editor.getBody(),this.$win=this.app.editor.getWin()},_buildEventKeysObj:function(t){var e=t.which,i=[this.app.keycodes.UP,this.app.keycodes.DOWN,this.app.keycodes.LEFT,this.app.keycodes.RIGHT],s=!t.ctrlKey&&!t.metaKey&&(e>=48&&e<=57||e>=65&&e<=90),a=this.app.keycodes;return{e:t,key:e,ctrl:t.ctrlKey||t.metaKey,shift:t.shiftKey,alt:t.altKey,select:(t.ctrlKey||t.metaKey)&&!t.altKey&&65===e,enter:e===a.ENTER,space:e===a.SPACE,esc:e===a.ESC,tab:e===a.TAB&&!t.shiftKey&&!t.altKey&&!t.ctrlKey&&!t.metaKey,delete:e===a.DELETE,backspace:e===a.BACKSPACE,alpha:s,arrow:-1!==i.indexOf(e),left:e===a.LEFT,right:e===a.RIGHT,up:e===a.UP,down:e===a.DOWN,"left-right":e===a.LEFT||e===a.RIGHT,"up-left":e===a.UP||e===a.LEFT,"down-right":e===a.DOWN||e===a.RIGHT}},_buildEvents:function(){var t=this.prefix+"-events";this._buildTargetEvents(this.$body,this.events.frame,t,""),this._buildTargetEvents(this.$win,this.events.win,t,"win"),this._buildTargetEvents(this.app.$doc,this.events.doc,t,"doc"),this._buildTargetEvents(this.app.editor.getDoc(),this.events.editor,t,"editor")},_buildTargetEvents:function(t,e,i,s){for(var a=0;a<e.length;a++)t.on(e[a]+"."+i,this["on"+s+e[a]].bind(this))},_buildHover:function(t){var e=this.app.block.get();if(this.pressedCmd&&e){var i=this.dom(t.target).closest("[data-"+this.prefix+"-first-level]");0===i.length||(this.app.blocks.unsetHover(),i.hasClass(this.prefix+"-block-focus")||i.addClass(this.prefix+"-block-multiple-hover"))}},_runEvents:function(){var t=this.prefix+"-events";this._buildTargetEvents(this.$body,this.events.frame,t,""),this._buildTargetEvents(this.$win,this.events.win,t,"win")},_pauseEvents:function(){var t=this.prefix+"-events";this.$body&&(this.$body.off("."+t),this.$win.off("."+t))},_getBlock:function(t){return this.dom(t).closest("[data-"+this.prefix+"-type]")},_setByClick:function(t){var e=this.app.blocks.getFirstLevel(),i=[];e.each(function(t){var e=t.get().getBoundingClientRect();i.push([e.x,e.y,e.y+e.height])});var s=[],a=!1;i.forEach(function(e,i){var o=parseInt(t.clientY),n=parseInt(t.clientX);if(e[1]<o&&o<e[2]){a=i;return}var r=Math.hypot(e[0]-n,e[1]-o);s.push(parseInt(r))});var o=!1!==a?a:s.indexOf(Math.min.apply(Math,s)),n=e.eq(o);this.app.block.set(n.dataget("instance"),"start"),this.app.editor.setFocus()},_setCaretInline:function(t){var e=this.app.block.get(),i=!1;e&&e.isEditable()&&(this.app.element.isEmptyOrImageInline(t.target)?this.app.caret.set(t.target,"after"):this.app.selection.isCollapsed()&&"CODE"===t.target.tagName&&(i=!0,setTimeout((function(){var e=this.app.selection.getElement();e&&i&&"CODE"!==e.tagName&&(this.app.caret.set(t.target,"start"),i=!1)}).bind(this),1)))},_setBlock:function(t){this.app.editor.setFocus();var e=t?this._getBlock(t.target):this.app.selection.getDataBlock();0!==e.length&&(!1===e.attr("contenteditable")&&t.preventDefault(),this.pressedCmd?(t&&t.preventDefault(),this.app.blocks.set(e)):this.app.block.set(e))},_isRemoveRanges:function(){var t=this.app.block.get();return this.app.blocks.is()||t&&t.isInlineBlock()},_isEsc:function(t){return t.which===this.app.keycodes.ESC},_isEnter:function(t){return t.which===this.app.keycodes.ENTER},_isEditorClick:function(t){if(this.app.editor.isEditor(t.target))return t.preventDefault(),!0},_isOutsideEditor:function(t){return 0===this.dom(t.target).closest("."+this.prefix+["-container-","-popup-","-control-"].join(this.uuid+",."+this.prefix)+this.uuid).length},_isCmdPressed:function(t){return!!this.opts.selection.multiple&&(t.ctrlKey||t.metaKey)&&!t.shiftKey&&!t.altKey},_isLinkClick:function(t){return 0!==this.dom(t.target).closest("a").length},_removeDragPlaceholder:function(){var t=this.app.editor.getBody();t.find("."+this.prefix+"-draggable-placeholder").remove(),t.find("."+this.prefix+"-draggable-over").removeClass(this.prefix+"-draggable-over")},_preventLinks:function(t){this._isLinkClick(t)&&t.preventDefault()},_drop:function(t,e,i,s){var a=this.app.element.getDataBlock(t.target);a=0===a.length?this.app.blocks.getFirst():a,this.app.block.set(a),i||this.app.insertion.insertPoint(t);var o=!0,n=!0,r=this.app.block.get(),l=this.app.editor.isAllSelected();if(r&&"code"===r.getType()&&!l&&(o=!1,n=!1,e=this.app.content.getTextFromHtml(e,{nl:!0,trimlines:!1})),!1===s&&(o=!1),""!==e)return e=o?this.app.autoparse.parse(e):e,this.app.insertion.insertContent({html:e,clean:o,parse:n,position:i})},_paste:function(t){t.preventDefault();var e,i=t.clipboardData;if(!this.app.image.insertFromClipboard(i)){var s=i.getData("URL"),a=this.app.clipboard.getContent(i);this.pasteEvent=!0;var o=this.app.broadcast("editor.before.paste",{e:t,html:a});if(o.isStopped()){this.pasteEvent=!1;return}a=o.get("html"),a=s&&""!==s?s:a;var n=this.app.block.get(),r=!0,l=!0,p=this.app.editor.isAllSelected();if(this.opts.paste.plaintext?(r=!1,l=!1,a=this.app.content.getTextFromHtml(a,{br:!0})):n&&"code"===n.getType()&&!p?(r=!1,l=!1,a=this.app.content.getTextFromHtml(a,{nl:!0,trimlines:!1})):this.opts.paste.clean||(r=!1),a=this.opts.paste.links?a:this.app.content.removeTags(a,["a"]),""===(a=this.opts.paste.images?a:this.app.content.removeTags(a,["img"]))){this.pasteEvent=!1;return}var h=i.getData("text/rtf");h&&(e=this._findLocalImages(a),a=this._replaceLocalImages(a,e,this._extractImagesFromRtf(h))),a=r?this.app.autoparse.parse(a):a;var c=this.app.insertion.insertContent({html:a,clean:r,parse:l});this.opts.image.upload&&this.app.image.parseInserted(c),this.app.placeholder.toggle(),this.app.broadcast("editor.paste",c),this.pasteEvent=!1}},_copy:function(t){this._action(t,"copy")},_cut:function(t){this._action(t,"cut")},_action:function(t,e){var i=this.app.block.get(),s=this.app.blocks.is(),a=!1,o={html:!1,remove:"content"};if(!(!s&&!i||!s&&i&&i.isEditable()&&this.app.selection.isCollapsed())){t.preventDefault(),this.app.editor.isAllSelected()?o={html:this.app.editor.getLayout().html(),remove:"all"}:s?o={html:this._copyFromMultiple(e),remove:"blocks"}:i&&i.isEditable()?o=this._copyFromEditable(e,i):i&&(o=this._copyFromNonEditable(e,i));var n=this.app.broadcast("editor.before."+e,{e:t,html:o.html});n.isStopped()||("cut"===e&&this._cutDeleteContent(o),a=n.get("html"),a=this.app.clipboard.setContent(t,a),this.app.broadcastHtml("editor."+e,a))}},_cutDeleteContent:function(t){if("instance"===t.remove)t.instance.remove(!0),this.app.control.close();else if("all"===t.remove)this.app.editor.setEmpty();else if("blocks"===t.remove)this.app.blocks.removeSelected(!1);else if("row"===t.remove)t.instance.getBlock().find("td, th").html("");else if("noneditable"===t.remove){var e=t.instance.getType(),i=t.instance.getParent("layer");"column"===e?t.instance.setEmpty():(t.instance.remove(!0),this.app.control.close()),"layer"===e&&i&&i.isEmpty()&&i.setEmpty()}else!1!==t.remove&&this.app.selection.deleteContents()},_copyFromMultiple:function(t){var e=this.app.blocks.getSelected(),i=this.dom("<div>");return e.each(function(t){i.append(t.clone())}),i.html()},_copyFromEditable:function(t,e){var i=e.getType(),s=this.app.selection.getHtml(),a="content";if("figcaption"===i||"cell"===i)a="content";else if(e.isAllSelected())s=e.getOuterHtml(),a="instance";else if("dlist"===i)-1===s.search(/<dl/gi)&&(s="<dl>"+s+"</dl>");else if("list"===i){var o=e.getTag();-1!==s.search(/<li/gi)&&(-1===s.search(/^<li/g)&&(s="<li>"+s+"</li>"),s="<"+o+">"+s+"</"+o+">")}return{html:s,remove:a,instance:e}},_copyFromNonEditable:function(t,e){var i=e.getBlock(),s=e.getType(),a="",o="noneditable";return"column"===s?a=i.html():"row"===s?(a="<table>"+(a=e.getOuterHtml())+"</table>",o="row"):a=e.getOuterHtml(),{html:a,remove:o,instance:e}},_findLocalImages:function(t){var e=[];return this.app.utils.wrap(t,function(t){t.find("img").each(function(t){-1!==t.attr("src").search(/^file:\/\//)&&e.push(t.attr("src"))})}),e},_extractImagesFromRtf:function(t){if(!t)return[];var e=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,i=RegExp("(?:("+e.source+"))([\\da-fA-F\\s]+)\\}","g"),s=t.match(i);if(!s)return[];for(var a=[],o=0;o<s.length;o++){var n=!1;-1!==s[o].indexOf("\\pngblip")?n="image/png":-1!==s[o].indexOf("\\jpegblip")&&(n="image/jpeg"),n&&a.push({hex:s[o].replace(e,"").replace(/[^\da-fA-F]/g,""),type:n})}return a},_convertHexToBase64:function(t){return btoa(t.match(/\w{2}/g).map(function(t){return String.fromCharCode(parseInt(t,16))}).join(""))},_replaceLocalImages:function(t,e,i){if(e.length===i.length)for(var s=0;s<e.length;s++){var a="data:"+i[s].type+";base64,"+this._convertHexToBase64(i[s].hex);t=t.replace(RegExp('src="'+e[s]+'"',"g"),'src="'+a+'"')}return t}}),l.add("module","input",{handle:function(t){var e=t.get("e"),i=t.get("key");if(!this._doSelectAll(e,t)){if(t.is("enter")&&t.is("shift"))this.handleShiftEnter(e,i,t);else if(t.is("enter"))this.handleEnter(e,i,t);else if(t.is("space")&&t.is("shift"))this.handleShiftSpace(e,i,t);else if(t.is("space"))this.handleSpace(e,i,t);else if(t.is("tab")&&this.opts.tab.key)this.handleTab(e,i,t);else if(t.is("arrow")){if(t.is(["shift","alt","ctrl"]))return;this.handleArrow(e,i,t)}else t.is(["delete","backspace"])&&this.handleDelete(e,i,t)}},handleDelete:function(t,e,i){var s=this.app.block.get(),a=i.is("backspace"),o=i.is("delete");if(this.app.blocks.is()){t.preventDefault(),this.app.blocks.removeSelected();return}if(!(s&&s.isEditable()&&this._trimInvisibleChar(t,i.is("backspace")?"left":"right",o))){var n=this.app.selection.getInline();if(n&&1===n.innerHTML.length){t.preventDefault(),n.innerHTML="";return}if(!(s.handleDelete&&s.handleDelete(t,e,i))){var r=s.getNext(),l=s.getPrev();if(s.isInlineBlock()){t.preventDefault();var p=s.getBlock(),h=s.getParent();this.app.caret.set(p,"after"),s.remove(!0),this.app.block.set(h)}else if(s.isEditable()){if(s.isEditable()){var c=s.getType();if(s.isAllSelected()){t.preventDefault(),"card"===c?this.app.block.remove():s.setEmpty();return}if(o&&r&&s.isCaretEnd()){if(t.preventDefault(),"card"!==r.getType()&&r.isEditable()){if("card"===c)return;s.appendNext()}else this.app.block.set(r)}else if(a&&l&&s.isCaretStart()){if(t.preventDefault(),"card"!==l.getType()&&l.isEditable()){if("card"===c||"cell"===c)return;s.appendToPrev()}else this.app.block.set(l),s.isEmpty()&&s.remove(!0)}}}else t.preventDefault(),s.remove(!0),r?this.app.block.set(r,"start"):l?this.app.block.set(l,"end"):this.app.editor.isEmpty()?this.app.editor.setEmpty():this.app.block.unset()}}},handleArrow:function(t,e,i){var s=this.app.block.get();if(!this.app.blocks.is()){if(s.isEditable()){var a=this.app.selection.getCurrent(),o=this.app.selection.getTopInline();if(i.is("right")&&o&&"CODE"===o.tagName){var n=this.app.caret.is(o,"end"),r=this.app.caret.is(s.getBlock(),"end");if(n&&r){t.preventDefault(),this.app.caret.set(o,"after");return}}if(o&&this._catchInlineBlock(t,i,o)||a&&this._catchInlineBlock(t,i,a))return}if(!(s.isEditable()&&this._trimInvisibleChar(t,i.is("left")?"left":"right"))&&!(s.handleArrow&&s.handleArrow(t,e,i))){if(s.isInlineBlock()){t.preventDefault();var l=s.getBlock(),p=s.getParent(),h=i.is("up-left")?"before":"after";this.app.caret.set(l,h),this.app.block.set(p)}else this._doArrow(t,i,s)}}},handleTab:function(t,e,i){var s=this.app.block.get();if(this.app.blocks.is()){t.preventDefault();return}if(!(s.handleTab&&s.handleTab(t,e,i))){if(this.opts.tab.spaces&&s.isEditable()){t.preventDefault();var a=this.opts.tab.spaces,o=document.createTextNode(Array(a+1).join(""));this.app.insertion.insertNode(o,"end");return}if(s.isInlineBlock()){t.preventDefault();var n=s.getBlock(),r=s.getParent();this.app.caret.set(n,"after"),this.app.block.set(r)}else{t.preventDefault();var l=s.getNext();l&&this.app.block.set(l,"start")}}},handleShiftSpace:function(t,e,i){var s=this.app.block.get();if(!this.app.blocks.is()){var a=s.getBlock();if(s.isEditable()){if(s.isAllSelected()){s.setEmpty();return}"code"!==s.getType()&&(t.preventDefault(),this.app.insertion.insertHtml("&nbsp;","end"))}else if(s.isInlineBlock()){t.preventDefault();var o=s.getParent();this.app.caret.set(a,"after"),s.remove(!0),this.app.block.set(o),this.app.insertion.insertHtml("&nbsp;","end")}else s.isEmptiable()&&s.isEmpty()&&(t.preventDefault(),a.removeClass(this.prefix+"-empty-layer"),a.html(""),s.insertEmpty({position:"append",caret:"start"}))}},handleSpace:function(t,e,i){var s=this.app.block.get();if(this.app.blocks.is()){t.preventDefault(),this.app.blocks.getLastSelected().insertEmpty({position:"after",caret:"start"}),this.app.blocks.removeSelected(!1);return}var a=s.getBlock(),o=s.getType();if(!(s.handleSpace&&s.handleSpace(t,e,i))){if("row"===o){t.preventDefault();return}if(s.isEditable()&&s.isAllSelected()){s.setEmpty();return}if(s.isInlineBlock()){t.preventDefault();var n=s.getParent();this.app.caret.set(a,"after"),s.remove(!0),this.app.block.set(n),this.app.insertion.insertHtml("&nbsp;","end")}else s.isEmptiable()&&s.isEmpty()?(t.preventDefault(),a.removeClass(this.prefix+"-empty-layer"),a.html(""),s.insertEmpty({position:"append",caret:"start"})):s.isEditable()||(t.preventDefault(),s.insertEmpty({position:"after",caret:"start"}),s.remove(!0),this.app.control.updatePosition())}},handleShiftEnter:function(t,e,i){var s=this.app.block.get(),a=s.getType(),o=s.getBlock();if(this.app.blocks.is()||"row"===a)t.preventDefault();else if(s.isInlineBlock()){t.preventDefault();var n=s.getParent();this.app.caret.set(o,"after"),s.remove(!0),this.app.block.set(n),this.app.insertion.insertBreakline()}else if(s.isEditable())t.preventDefault(),this.app.insertion.insertBreakline();else{t.preventDefault();var r="after";s.isEmptiable()&&s.isEmpty()&&(r="append",o.removeClass(this.prefix+"-empty-layer"),o.html("")),s.insertEmpty({position:r,caret:"start"})}},handleEnter:function(t,e,i){var s=this.app.block.get();if(this.app.blocks.is()){t.preventDefault(),this.app.blocks.getLastSelected().insertEmpty({position:"after",caret:"start"});return}var a=s.getBlock();if(s.isEditable()){if(s.isAllSelected()){t.preventDefault(),s.setEmpty();return}if(!this.app.selection.isCollapsed()){t.preventDefault(),"code"===s.getType()?this.app.insertion.insertNewline():this.app.insertion.insertBreakline();return}}if(s.isInlineBlock()){t.preventDefault();var o=s.getParent();this.app.caret.set(a,"after"),s.remove(!0),this.app.block.set(o)}else s.isEmptiable()&&s.isEmpty()?(t.preventDefault(),a.removeClass(this.prefix+"-empty-layer"),a.html(""),s.insertEmpty({position:"append",caret:"start"})):s.isEditable()||(t.preventDefault(),s.insertEmpty({position:"after",caret:"start"}));s.handleEnter&&s.handleEnter(t,e,i),this.app.control.updatePosition()},handleTextareaTab:function(t){if(9!==t.keyCode)return!0;t.preventDefault();var e=t.target,i=e.value,s=e.selectionStart;e.value=i.substring(0,s)+"    "+i.substring(e.selectionEnd),e.selectionStart=e.selectionEnd=s+4},_isNextBlock:function(t,e){return t.is("right")&&this.app.caret.is(e,"end")&&this.app.element.getType(e.nextSibling)},_isPrevBlock:function(t,e){return t.is("left")&&this.app.caret.is(e,"start")&&this.app.element.getType(e.previousSibling)},_isSiblingInlineBlock:function(t,e){var i=this.dom(e).dataget("instance");if(i&&i.isInlineBlock())return t.preventDefault(),this.app.block.set(i),!0},_isInvisibleChar:function(t){var e=this.app.selection.get(),i=this.app.selection.getText(t);return e.current&&3===e.current.nodeType&&0===this.app.utils.searchInvisibleChars(i)},_catchInlineBlock:function(t,e,i){if(e.is("left")&&3===i.nodeType){var s=i.textContent;if(-1!==this.app.utils.searchInvisibleChars(s)&&this._isSiblingInlineBlock(t,i.previousSibling))return i.parentNode.removeChild(i),!0}if(this._isPrevBlock(e,i)){if(this._isSiblingInlineBlock(t,i.previousSibling))return!0}else if(this._isNextBlock(e,i)&&this._isSiblingInlineBlock(t,i.nextSibling))return!0},_trimInvisibleChar:function(t,e,i){var s,a=this.app.selection.get(),o=this._isInvisibleChar("left"===e?"before":"after");if(o&&"left"===e){s=a.current;var n=this.app.offset.get();this.dom(s).replaceWith(s.textContent.replace(/\uFEFF/g,"")),this.app.offset.set(!1,{start:n.start-1,end:n.end-1})}else if(o&&i&&a.current&&a.current.nextSibling)s=a.current.nextSibling,this.dom(s).replaceWith(s.textContent.replace(/\uFEFF/g,""));else if(o&&"right"===e){t.preventDefault(),s=a.current;var n=this.app.offset.get();return this.app.offset.set(!1,{start:n.start+1,end:n.end+1}),!0}},_doSelectAll:function(t,e){var i=this.app.block.get();return this._isAllSelected(e)?(this._setEditorEmpty(t,e),!0):e.is("select")?(t.preventDefault(),!this.app.blocks.is()&&i?i.isAllSelected()||i.isEmpty()?this.app.editor.selectAll():i.setSelectAll():this.app.editor.selectAll(),!0):void 0},_doArrow:function(t,e,i){var s,a,o=i.getType(),n=["code","line","image","embed","layer","grid"];if(e.is("up-left")&&i.isCaretStart()){if(a="end",!(s=i.getPrev())&&-1!==n.indexOf(o)){this.app.insertion.insertEmptyBlock({position:"before",caret:"start"});return}}else if(e.is("down-right")&&i.isCaretEnd()&&(a="start",!(s=i.getNext())&&-1!==n.indexOf(o))){this.app.insertion.insertEmptyBlock({position:"after",caret:"start"});return}s&&(t.preventDefault(),this.app.block.set(s,a))},_isAllSelected:function(t){return this.app.editor.isAllSelected()&&t.is(["enter","delete","backspace","alpha","space"])},_setEditorEmpty:function(t,e){e.is(["alpha","space"])||t.preventDefault(),this.app.editor.setEmpty()}}),l.add("module","toolbar",{init:function(){this.eventname=this.prefix+"-toolbar",this.activeClass="active",this.toggledClass="toggled",this.disableClass="disable",this.customButtons={},this.aTags={},this.aTypes={}},start:function(){this.opts.toolbar?this.sticky=this.opts.toolbar:this.opts.path&&this.opts.path.sticky&&(this.sticky=this.opts.path),this._isToolbar()&&(this.$container=this.app.container.get("toolbar"),this._build()),this._buildSticky()},load:function(){this._buildActiveButtons(),this._isToolbar()&&(this.$toolbar.html(""),this._buildButtons())},stop:function(){this._isToolbar()&&(this.$toolbar.remove(),this.customButtons={},this.editorButtons={})},build:function(){this._isToolbar()&&(this.$toolbar.html(""),this._buildButtons())},observe:function(){if(this._isToolbar()&&(this.unsetActive(),!(this.app.blocks.is()||this.app.editor.isAllSelected())&&this._isObserveButtons())){for(var t,e=this.app.block.get(),i=!!e&&e.getType(),s=!!e&&e.getTag(),a=this.app.selection.getNodes({type:"inline",selected:"inside",links:!0}),o=this._getObservedTags(s,a),n=[],r=0;r<o.length;r++)(t=this.aTags[o[r]])&&(n=n.concat(t));i&&(t=this.aTypes[i])&&(n=n.concat(t)),this._setActiveKeys(n)}},getElement:function(){return this.$toolbar},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},setActive:function(t){this._isToolbar()&&(this._findButtons().removeClass(this.activeClass),this._findButton(t).removeClass(this.disableClass).addClass(this.activeClass))},setToggled:function(t){this._isToolbar()&&(this._findButtons().removeClass(this.toggledClass),this._findButton(t).removeClass(this.disableClass).addClass(this.toggledClass))},unsetActive:function(t){this._isToolbar()&&(t?this._findButton(t):this._findButtons()).removeClass(this.activeClass)},unsetToggled:function(t){this._isToolbar()&&(t?this._findButton(t):this._findButtons()).removeClass(this.toggledClass)},enable:function(){this._isToolbar()&&this._findButtons().removeClass(this.disableClass)},disable:function(t){this._isToolbar()&&this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass)},disableSticky:function(){if(this._isToolbar()){var t=this.app.container.get("bars");t.removeClass(this.prefix+"-bars-sticky"),t.css("top","")}},enableSticky:function(){if(this._isToolbar()&&this.opts.toolbar.sticky){var t=this.app.container.get("bars");t.addClass(this.prefix+"-bars-sticky"),t.css("top",this.opts.toolbar.stickyTopOffset+"px")}},isSticky:function(){var t=this.app.container.get("bars"),e=this.app.container.get("main"),i=e.offset().top+parseInt(e.css("border-top-width")),s=t.offset().top;return s>i||s<i},_build:function(){this.$toolbar=this.dom("<div>").addClass(this.prefix+"-toolbar"),this.$container.append(this.$toolbar),this.app.container.get("bars").addClass("has-toolbar")},_buildSticky:function(){if(this.sticky){var t=this.app.container.get("bars");t.addClass(this.prefix+"-bars-sticky"),t.css("top",this.sticky.stickyTopOffset+"px"),this.app.scroll.getTarget().on("scroll."+this.prefix+"-toolbar",this._observeSticky.bind(this))}},_buildActiveButtons:function(){this.aTags=this.opts.buttons.tags?this.opts.buttons.tags:{},this.aTypes=this.opts.buttons.types?this.opts.buttons.types:{};var t=this.customButtons;Object.keys(t).forEach((function(e){var i=t[e].active;i&&(this._buildActiveButton(e,i.tags,this.aTags),this._buildActiveButton(e,i.types,this.aTypes))}).bind(this))},_buildActiveButton:function(t,e,i){if(e)for(var s=0;s<e.length;s++){var a=e[s];i[a]?i[a].push(t):i[a]=[t]}},_buildButtons:function(){var t=this._getCurrentInstance(),e=t?this.app.editor.getButtonsFromArr(t.toolbar):this.app.editor.getButtons();this._createButtons(e,t),t&&this._createButtons(this.customButtons,t)},_createButtons:function(t,e){for(var i in t)if(t.hasOwnProperty(i)){if(e&&!e.isAllowedButton(i,t[i])||this._isHidden(i)||"add"===i&&!1===this.opts.addbar||"format"===i&&!1===this.opts.format)continue;this.app.create("button",i,t[i],this.$toolbar,"toolbar")}},_observeSticky:function(){if(this.app.source.is()){this.app.container.get("bars").css("top",0);return}var t=this.app.scroll.getTarget(),e=this.app.scroll.isTarget()?parseInt(t.css("padding-top")):0;this.app.container.get("bars").css("top",0-e+this.sticky.stickyTopOffset+"px"),this.isSticky()?this.app.broadcast("toolbar.sticky"):this.app.broadcast("toolbar.static")},_findButtons:function(){return this.$toolbar.find("."+this.prefix+"-button-toolbar")},_findButton:function(t){return this.$toolbar.find("[data-name="+t+"]")},_isHidden:function(t){return -1!==this.opts.toolbar.hide.indexOf(t)},_isToolbar:function(){return this.opts.toolbar},_isObserveButtons:function(){return!!this.opts.buttons.tags||!!this.opts.buttons.types},_setActiveKeys:function(t){for(var e=0;e<t.length;e++)this._findButton(t[e]).addClass(this.activeClass)},_getCurrentInstance:function(){var t=!!this.app.block.is()&&this.app.block.get();return!this.app.blocks.is()&&t},_getObservedTags:function(t,e){var i=[];if(t&&i.push(t),e.length>0)for(var s=0;s<e.length;s++)i.push(e[s].tagName.toLowerCase());return i}}),l.add("module","path",{init:function(){this.activeClass="active",this.disableClass="disable",this.pathItemClass=this.prefix+"-path-item"},start:function(){this.opts.path&&(this.$container=this.app.container.get("pathbar"),this._build(),this._buildRoot(),this._buildActive())},build:function(){this.opts.path&&(this._clear(),this._buildRoot(),this.app.blocks.is()?this._buildMultipleItem():(this._buildItems(),this._buildActive()))},disable:function(){this.opts.path&&this._getAll().addClass(this.disableClass)},enable:function(){this.opts.path&&this._getAll().removeClass(this.disableClass)},_clear:function(){this.$path.find("."+this.pathItemClass).off("."+this.prefix+"-path-"+this.uuid),this.$path.html("")},_getAll:function(){return this.$path.find("."+this.pathItemClass)},_selectItem:function(t){t.stopPropagation(),t.preventDefault();var e=this.dom(t.target).closest("."+this.pathItemClass);if(!e.hasClass(this.disableClass)){var i=e.dataget("instance");i?(this.app.popup.close(),this.app.block.set(i,"start")):(this._clear(),this._buildRoot(),this._buildActive(),this.app.block.unset())}},_createItem:function(){return this.dom('<a href="#"></a>').attr("tabindex","-1").addClass(this.pathItemClass)},_build:function(){this.$path=this.dom("<div>").addClass(this.prefix+"-path"),this.$container.append(this.$path)},_buildRoot:function(){this._buildItem(!1,this.lang.parse(this.opts.path.title))},_buildActive:function(){this.$path.find("a").removeClass(this.activeClass).last().addClass(this.activeClass)},_buildItems:function(){var t=this.app.block.get();if(t){var e=t.getBlock().parents("[data-"+this.prefix+"-type]");e.nodes.reverse(),e.each(this._buildParentItem.bind(this)),this._buildItem(t)}},_buildParentItem:function(t){var e=t.dataget("instance");this._buildItem(e)},_buildMultipleItem:function(){var t=this._createItem();t.addClass(this.activeClass),this._buildTitle(t,this.lang.get("editor.multiple")),this.$path.append(t)},_buildItem:function(t,e){var i=this._createItem();i.dataset("instance",t),i.on("click."+this.prefix+"-path-"+this.uuid,this._selectItem.bind(this)),this._buildTitle(i,e||t.getTitle()),this.$path.append(i)},_buildTitle:function(t,e){var i=this.dom("<span>").html(e);t.append(i)}}),l.add("module","topbar",{init:function(){this.activeClass="active",this.toggledClass="disable",this.disableClass="disable",this.customButtons={}},start:function(){this._isTopbar()&&this._build()},load:function(){this._buildButtons()},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},setToggled:function(t){this._isTopbar()&&(this._findButtons().removeClass(this.toggledClass),this._findButton(t).addClass(this.toggledClass))},unsetToggled:function(t){this._isTopbar()&&(t?this._findButton(t):this._findButtons()).removeClass(this.toggledClass)},enable:function(){this._isTopbar()&&this._findButtons().removeClass(this.disableClass)},disable:function(){this._isTopbar()&&this._findButtons().removeClass(this.toggledClass).removeClass(this.activeClass).addClass(this.disableClass)},_isTopbar:function(){return this.opts.path},_build:function(){this.$topbar=this.dom("<div>").addClass(this.prefix+"-topbar"),this.app.container.get("pathbar").append(this.$topbar)},_buildButtons:function(){var t=this.app.editor.getButtonsFromArr(this.opts.buttons.topbar);for(var e in t)if(t.hasOwnProperty(e)){if("undo"===e&&!this.opts.topbar.undoredo||"redo"===e&&!this.opts.topbar.undoredo||"shortcut"===e&&!this.opts.topbar.shortcuts)continue;this.app.create("button",e,t[e],this.$topbar,"topbar")}},_findButtons:function(){return this.$topbar.find("."+this.prefix+"-button-topbar")},_findButton:function(t){return this.$topbar.find("[data-name="+t+"]")}}),l.add("module","control",{init:function(){this.instance=!1,this.customButtons={},this.eventName=this.prefix+"-control"},start:function(){this.opts.control&&this._build()},stop:function(){this.opts.control&&this.$control.remove(),this.instance=!1,this.customButtons={}},isOpen:function(){return"none"!==this.$control.css("display")},getElement:function(){return this.$control},get:function(t){return this._findButton(t)},add:function(t,e){this.customButtons[t]=e},remove:function(t){this._findButton(t).remove()},build:function(){if(this.opts.control){var t=this.app.block.get();t?this.open(t):this.close()}},open:function(t){if(this.opts.control){if(this.$control.html(""),this.instance=t,this._buildButtons()>0){var e=this.app.scroll.getTarget();this.updatePosition(),e.on("resize."+this.eventName,this.updatePosition.bind(this)),e.on("scroll."+this.eventName,this.updatePosition.bind(this)),this.app.editor.getWin().on("scroll."+this.eventName,this.updatePosition.bind(this)),this.instance.getBlock().on("keyup."+this.eventName,this.updatePosition.bind(this))}else this.close()}},close:function(){if(this.opts.control){if(this.$control.hide(),this.instance){var t=this.instance.getBlock();this.app.content.unfixListMargin(t),t.off("."+this.eventName)}this.app.scroll.getTarget().off("."+this.eventName),this.app.editor.getDoc().off("."+this.eventName),this.instance=!1}},updatePosition:function(){if(this.opts.control){if(!this.instance){this.close();return}if("list"===this.instance.getType()){var t=this.instance.getBlock();this.app.content.fixListMargin(t)}var e=this.instance.isEditable(),i=this.instance.getOffset(),s=this.$control.width(),a=this.app.editor.getWin().scrollTop(),o=e?4:2,n=i.top-o-a,r=i.left-s-(e?6:4),l=this.app.container.get("toolbar"),p=l.offset().top+l.height()-o,h=this.app.editor.getFrameRect();if(n<p||h.bottom<n?this.$control.hide():this.$control.show(),this.app.scroll.isTarget()){var c=this.app.scroll.getTarget(),d=c.offset().top+c.height();n+this.$control.height()>d&&this.$control.hide()}!e&&r+s/2<h.left&&(r=h.left+3,n+=6),this.$control.css({top:n+"px",left:r+"px"})}},_buildButtons:function(){var t=this.app.editor.getButtonsFromArr(this.instance.control),e=0;return!1!==t&&(e=this._createButtons(t,e),e=this._createButtons(this.customButtons,e)),e},_build:function(){this.$control=this.dom("<div>").addClass(this.prefix+"-control "+this.prefix+"-control-"+this.uuid).hide(),this.opts.bsmodal&&this.$control.css("z-index",1060),this.app.$body.append(this.$control)},_createButtons:function(t,e){for(var i in t)this.instance.isAllowedButton(i,t[i])&&(this.app.create("button",i,t[i],this.$control,"control"),e++);return e},_findButton:function(t){return this.$control.find("[data-name="+t+"]")}}),l.add("module","insertion",{init:function(){this._clear()},start:function(){this.win=this.app.editor.getWinNode(),this.doc=this.app.editor.getDocNode()},getFirstInserted:function(){return this.inserted.instances[0]},getLastInserted:function(){var t=this.inserted.instances.length,e=this.inserted.instances[t-1];return e&&e.isInlineBlock()&&(e=e.getParent()),e},getInserted:function(){return this.inserted},setContent:function(t){this._insert(t,"set");var e=this.getInserted();return this.inserted=!1,e},insertContent:function(t){this._insert(t,"insert");var e=this.getInserted();return this.inserted=!1,e},insertEmptyBlock:function(t){t||(t={}),t.html=this.app.block.createHtml(),this._insert(t,"insert");var e=this.getInserted();return this.inserted=!1,this.app.broadcast("block.add",{instance:e.instances[0],type:"input"}),e},insertNewline:function(t,e){return this._insertFragment({node:document.createTextNode(e?"\n\n":"\n")},t||"after")},insertPoint:function(t){var e,i=this.app.utils.createInvisibleChar(),s=this.app.editor.getDocNode(),a=t.clientX,o=t.clientY;if(s.caretPositionFromPoint){var n=s.caretPositionFromPoint(a,o);(e=s.getSelection().getRangeAt(0)).setStart(n.offsetNode,n.offset),e.collapse(!0),e.insertNode(i)}else s.caretRangeFromPoint&&(e=s.caretRangeFromPoint(a,o)).insertNode(i);this.app.caret.set(i,"after")},insertBreakline:function(t){var e=this.app.selection.getNodes({type:"inline"});return this.app.selection.isCollapsed()&&0!==e.length?this._splitInline(e,document.createElement("br")):this._insertFragment({node:document.createElement("br")},t||"after")},insertNode:function(t,e,i){if(i){var s=this.app.selection.getNodes({type:"inline"});if(0!==s.length)return this._splitInline(s,t)}return this._insertFragment({node:this.dom(t).get()},e)},insertHtml:function(t,e){return this._insertFragment({html:t},e)},insertText:function(t,e){var i,s=this.app.block.get();if(s&&!s.isEditable()||this.app.blocks.is()){this.insertContent({html:t,caret:e});return}var a=this.win.getSelection();if(a.getRangeAt&&a.rangeCount){t=this.app.content.getTextFromHtml(t,{nl:!0}),i=document.createTextNode(t);var o=a.getRangeAt(0);o.deleteContents(),o.insertNode(i),e=e||"end",this.app.caret.set(i,e)}return i},insertListToList:function(t,e,i){var s=t.find("li"),a=s.last();s.addClass(this.prefix+"-pasteitems"),a.addClass(this.prefix+"-pastemarker");var o=t.children(),n=this.dom(this.app.selection.getBlock()),r=this.app.caret.is(e,"start"),l=this.app.caret.is(e,"end"),p=this.app.caret.is(n,"start"),h=this.app.caret.is(n,"end",["ul","ol"]),c=this.app.content.isEmptyHtml(n.html());if(r)c&&n.remove(),e.prepend(o);else if(l)c&&n.remove(),e.append(o);else if(c)n.after(o),n.remove();else if(p)n.before(o);else if(h){var d=n.find("ul, ol");0!==d.length?d.prepend(o):n.after(o)}else this.app.element.split(n).before(o);var u=this.prefix+"-pastemarker",f=this.prefix+"-pasteitems";return i&&(a=this.app.editor.getLayout().find("."+u).removeClass(u),this.app.caret.set(a,"end")),this.app.editor.getLayout().find("."+f).removeClass(f)},detectPosition:function(t,e){if(e)return e;var i=this.app.caret.is(t,"start");return e=this.app.caret.is(t,"end")?"after":i?"before":"split"},_insert:function(t,e){this.html=t.html,this.html=this.app.broadcastHtml("editor.before.insert",this.html),this.isParse=void 0===t.parse||t.parse,this.isClean=void 0!==t.clean&&t.clean,this.isCaret=void 0===t.caret||t.caret,this.isPosition=void 0!==t.position&&t.position,"set"===e||this.app.editor.isAllSelected()?this._setContent():this._insertContent(),this.app.broadcast("editor.insert",this.inserted)},_insertContent:function(){var t,e,i=this.app.block.get(),s=!1,a=!1;if(this._checkEmpty(),this._checkLine(),this.app.blocks.is()){if(this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild(),t=this._buildParsedNodes(),this.app.blocks.getLastSelected().getBlock().after(t),this.app.blocks.removeSelected(!1)}else if(!i||this.isPosition){if(this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild(),t=this._buildParsedNodes();var o=!1;"top"!==this.isPosition&&(this.isPosition||"top"!==this.opts.editor.add)?i&&-1!==["after","before","append"].indexOf(this.isPosition)?(s=this.isPosition,o=i.getType("layer")&&i.isEmpty()):(i=this.app.blocks.getLast(),s="after"):(i=this.app.blocks.getFirst(),s="before"),e=i.getBlock(),o&&(e.removeClass(this.prefix+"-empty-layer"),e.html("")),e[s](t)}else if(this._isListToList(i)){this.app.selection.deleteContents(),this._clean(),this._parse(),this._parseBuild(),e=i.getBlock();var n=this.$parsed.children().first();this.$nodes=this.insertListToList(n,e,"end"),this.isCaret=!1}else{if(!i)return;if(i.isInlineBlock()){var r=i.getParent();this.app.caret.set(i.getBlock(),"after"),i.remove(),this.app.block.set(r),i=r}if(i.isEditable()){if(this.isEmpty)return;this._clean(),this._cleanSpecial(),this.isLine?this._parseLine():this._parse(),this._parseBuild(),i.isEmpty()?(a=!0,s="after"):this.app.selection.deleteContents(),t=this._buildParsedNodes(),e=i.getBlock(),this._insertToEditable(i,e,t,s,a)}else{if(s="after",this.isEmpty)return;this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this.isLine?this._parseLine():this._parse(),this._parseBuild(),t=this._buildParsedNodes(),e=i.getBlock(),i.isEmptiable()&&i.isEmpty()&&(e.removeClass(this.prefix+"-empty-layer"),e.html(""),s="append"),e[s](t)}}this._buildInserted(),this._buildEditor(),this._buildCaret()},_insertToEditable:function(t,e,i,s,a){this.isLine?(this.$nodes=this._insertFragment({fragment:this.$parsed.get()},"end"),this.isCaret=!1):(this.app.content.isEmptyHtml(e.html())?(s="after",a=!0):s=this.detectPosition(e,s),"split"===s?this.app.element.split(e).before(i):e[s](i),a&&t.remove())},_insertFragment:function(t,e){var i;if(t.html||t.fragment?(i=this.app.fragment.build(t.html||t.fragment),this.app.fragment.insert(i)):this.app.fragment.insert(t.node),e){var s=t.node?t.node:"start"===e?i.first:i.last;this.app.caret.set(s,e)}return t.node?this.dom(t.node):this.dom(i.nodes)},_setContent:function(){this._checkEmpty(),this._checkLine(),this.isEmpty?this.html=this.app.block.createHtml():this.isLine&&(this.html=this.app.block.createHtml(this.html)),this._clean(),this._parse(),this._parseBuild();var t=this._buildParsedNodes();this.app.editor.unsetSelectAllClass(),this.app.editor.getLayout().html("").append(t),this.isEmpty&&this.app.broadcast("editor.empty"),this._buildInserted(),this._buildEditor(),this._buildCaret()},_splitInline:function(t,e){var i=this.app.element.split(t[0]);return i.before(e),""===i.html()&&i.remove(),this.dom(e)},_buildEditor:function(){this.app.placeholder.trigger(),this.app.editor.build(),this.app.editor.setFocus()},_buildCaret:function(){if(this.isCaret){var t,e="end";"start"===this.isCaret?(t=this.getFirstInserted(),e="start"):t=this.getLastInserted(),setTimeout((function(){t&&this.app.block.set(t,e),this.app.toolbar.observe()}).bind(this),0)}},_buildInserted:function(){this.inserted={$nodes:this.$nodes,instances:[]},this.inserted.$nodes.each(this._buildInstance.bind(this))},_buildInstance:function(t){var e=t.dataget("instance");e&&this.inserted.instances.push(e);var i=t.find("[data-"+this.prefix+"-type]");0!==i.length&&i.each(this._buildInstance.bind(this))},_buildParsedNodes:function(){return this.$parsed.get().childNodes},_clear:function(){this.html=!1,this.isLine=!1,this.isEmpty=!1,this.isSplit=!1,this.isClean=!1,this.isParse=!0,this.isCaret=!0,this.isPosition=!1},_clean:function(){this.isClean&&(this.html=this.app.cleaner.cleanHtml(this.html))},_cleanSpecial:function(t){var e,i,s;-1!==["cell","address","figcaption","quoteitem"].indexOf(t)?e=!0:"dlist"===t?(e=!0,s=["dt","dd"]):"list"===t&&(e=!0,s=["ul","ol","li"]),e&&(this.isLine=!0,this.html=this.app.content.addBrToBlocks(this.html),this.html=this.app.content.removeBlockTags(this.html,i,s),this.html=this.html.replace(/<br\s?\/?>\n?$/gi,""))},_parse:function(){this.isParse&&(this.html=this.app.parser.parse(this.html,!1))},_parseLine:function(){this.isParse&&(this.html=this.app.parser.parseLine(this.html,!1))},_parseBuild:function(){this.$parsed=this.app.parser.build(this.html),this.$nodes=this.$parsed.children()},_checkEmpty:function(){this.isEmpty=this.app.content.isEmptyHtml(this.html)},_checkLine:function(){this.isLine=this.app.content.isLine(this.html)},_isListToList:function(t){var e=t.getBlock().attr("data-"+this.prefix+"-type"),i=this.dom("<div>").html(this.html);return i.find("meta").remove(),i.find("b").unwrap(),i=i.children().first(),"list"===e&&0!==i.length&&-1!==["ul","ol"].indexOf(i.get().tagName.toLowerCase())}}),l.add("module","addbar",{init:function(){this.customButtons={}},popup:function(t,e){this.app.popup.create("addbar",{width:"476px",items:this.buildItems()}),"top"===this.opts.editor.addbar&&(e=!1),this.app.popup.open({button:e})},buildItems:function(){var t={},e=h.extend(!0,this.opts.buttonsObj),i=this.opts.addbar.concat(this.opts.addbarAdd);if(0!==this.opts.addbarAdd.length&&-1!==this.opts.addbarAdd.indexOf("text")){var s=i.indexOf("text"),a=i.indexOf("paragraph");i.splice(-1!==a?a+1:0,0,i.splice(s,1)[0])}for(var o=0;o<i.length;o++){var n=i[o];-1===this.opts.addbarHide.indexOf(n)&&(t[n]=e[n])}var r=h.extend(!0,this.customButtons),l=this.app.block.get();return Object.keys(r).forEach(function(e){t[e]=r[e]}),Object.keys(t).forEach((function(e){this._buildItem(l,t,t[e],e)}).bind(this)),t},add:function(t,e){this.customButtons[t]=e},_buildItem:function(t,e,i,s){if(i.blocks&&!t||t&&i.blocks&&!t.isAllowedButton(s,i)){e[s]=!1;return}e[s]={container:!0,addbar:!0,title:i.title,icon:i.icon||s,command:i.command,observer:i.observer||!1,params:{name:s}}}}),l.add("module","format",{popup:function(t,e){for(var i=this.app.block.get(),s=!!i&&i.getBlock(),a=i.getTag(),o=this.opts.format,n={},r=0;r<o.length;r++){var l=o[r];n[l]={title:this.opts.formatObj[l].title,params:{tag:l},command:"block.format",shortcut:this.opts.formatObj[l].shortcut}}if(this.opts.formatAdd){var p=this.opts.formatAdd;Object.keys(p).forEach(function(t){n[t]={title:p[t].title,params:p[t].params,command:"block.format"}})}var h=this._isActiveFormat(s,a,n);h&&(n[h].active=!0),this.app.popup.create("format",{width:"300px",items:n}),this.app.popup.open({button:e})},set:function(t){if(this.app.popup.isOpen()&&this.app.popup.close(),!this.app.blocks.is()){var e,i,s=this.app.block.get(),a=s.isEmpty(),o=!!a&&"start",n={type:this.opts.formatObj[t.tag].type,tag:t.tag,classname:t.classname||!1};this.tag=s.getTag(),this.type=s.getType(),this.$block=s.getBlock(),a||this.app.selection.saveMarker(),this._isSameTag(n)&&(n=this._checkSameFormat(this.$block,n)),n&&(this._isListToText(n,"list")?i=this._formatListToText(n):this._isListToText(n,"dlist")?e=this._formatListToText(n,!0):this._isTextToList(n,"list")?this._formatTextToList(n,!1,o):this._isTextToList(n,"dlist")?this._formatTextToList(n,!0,o):this._replaceTo(s,n,o)),a||this.app.selection.restoreMarker(),e&&(this.app.editor.build(),this.app.block.set(e.last(),o)),i&&(this.app.editor.build(),this.app.block.set(i,o)),s=this.app.block.get(),this.app.broadcast("block.format",{instance:s})}},_isSameTag:function(t){return this.tag===t.tag&&this.type===t.type},_checkSameFormat:function(t,e){var i=this.app.element.hasClass(t,e.classname);return!e.classname||i?this._buildDefaultFormat():e},_buildDefaultFormat:function(){var t=this.opts.editor.markup;return{type:t,tag:"paragraph"===t?"p":"div"}},_formatListToText:function(t,e){var i=e?this._getDlistItems():this._getListItems();return i=this._createItems(i,t),this.$block.remove(),i},_formatTextToList:function(t,e,i){var s=this.app.create("block."+t.type,"<"+t.tag+">").getBlock();if(e&&"list"===this.type){var a=0;this._getListItems().each((function(t){var e=0===a?"dt":"dd",i=this.dom("<"+e+">").html(t.html());a="dt"===e?1:0,s.append(i)}).bind(this))}else if(e||"dlist"!==this.type){var o=this.dom(e?"<dt>":"<li>").html(this.$block.html());s.append(o)}else this._getDlistItems().each((function(t){var e=this.dom("<li>").html(t.html());s.append(e)}).bind(this));this.app.create("block."+t.type,s),this.$block.after(s),this.$block.remove(),this._setStyleAndClass(s,t),this.app.editor.build(),this.app.block.set(s,i)},_replaceTo:function(t,e,i){var s=t.getBlock(),a=this._replaceToBlock(s,e);this.app.editor.build(),this.app.block.set(a,i)},_replaceToBlock:function(t,e){var i=this.app.element.replaceToTag(t,e.tag);return this._setStyleAndClass(i,e),this.app.create("block."+e.type,i)},_createItems:function(t,e){var i;return t.each((function(t){var s=this.dom("<"+e.tag+">");s.html(t.html()),t.remove(),i=this.app.create("block."+e.type,s),this.$block.before(s),this._setStyleAndClass(s,e)}).bind(this)),i},_isListToText:function(t,e){return this.type===e&&-1!==["heading","address","paragraph","text"].indexOf(t.type)},_isTextToList:function(t,e){return t.type===e&&-1!==["heading","address","paragraph","text","list"===e?"dlist":"list"].indexOf(this.type)},_isActiveFormat:function(t,e,i){if(t){for(var s in i)if(i.hasOwnProperty(s)){var a,o=i[s].params.classname||!1;e===i[s].params.tag&&(o?o&&this.app.element.hasClass(t,o)&&(a=s):a=s)}return a}},_setStyleAndClass:function(t,e){e.classname&&(t.removeAttr("style class data-"+this.prefix+"-style-cache"),t.addClass(e.classname))},_getListItems:function(){var t=this.$block.find("li");return t.find("ul, ol").each(function(t){t.parent().after(t)}),t.find("ul, ol").unwrap(),t},_getDlistItems:function(){return this.$block.find("dt, dd")}}),l.add("module","link",{popups:{format:{items:{format:{title:"## link.link ##",command:"link.format",shortcut:"Ctrl+k"},unlink:{title:"## link.unlink ##",command:"link.unlink"}}},change:{items:{edit:{title:"## link.edit-link ##",command:"link.edit",shortcut:"Ctrl+k"},unlink:{title:"## link.unlink ##",command:"link.unlink"}}},create:{title:"## popup.link ##",width:"600px",form:{text:{type:"input",label:"## link.text ##"},url:{type:"input",label:"## link.url ##"},target:{type:"checkbox",text:"## link.link-in-new-tab ##"}},footer:{insert:{title:"## link.insert ##",command:"link.insert",type:"primary"},cancel:{title:"## link.cancel ##",command:"popup.close"}}},edit:{title:"## popup.link ##",width:"600px",form:{text:{type:"input",label:"## link.text ##"},url:{type:"input",label:"## link.url ##"},target:{type:"checkbox",text:"## link.link-in-new-tab ##"}},footer:{save:{title:"## link.save ##",command:"link.save",type:"primary"},cancel:{title:"## link.cancel ##",command:"popup.close"}}}},popup:function(t,e){var i=0===this.getLink().length?"format":"change";this.app.popup.create("link",this.popups[i]),this.app.popup.open({button:e})},format:function(t){var e=this.app.selection.getText(),i=this.app.popup.create("link-create",this.popups.create),s={text:e,target:this.opts.link.target};i.setData(s),this.app.popup.open({focus:e?"url":"text"})},edit:function(){var t=this.getLink(),e=this.app.popup.create("link-edit",this.popups.edit),i={text:t.text(),url:t.attr("href"),target:t.attr("target")||this.opts.link.target};i=this._encodeUrl(i),e.setData(i),this.app.popup.open({focus:"url"})},insert:function(t){this.app.popup.close();var e=this.app.inline.set({tag:"a",caret:"after"}),i=this.dom(e);this._save(t,i,"add")},save:function(t){this.app.popup.close();var e=this.getLink();this._save(t,e,"change")},unlink:function(){this.app.popup.close();var t=this.app.selection.getNodes({tags:["a"]});if(0!==t.length){for(var e=0;e<t.length;e++){var i=this.dom(t[e]);this.app.broadcast("link.remove",{url:i.attr("href"),text:i.text()}),i.unwrap()}this.app.toolbar.observe()}},getLink:function(){var t=this.app.selection.getNodes({tags:["a"]});return 0!==t.length?this.dom(t[0]):this.dom([])},_save:function(t,e,i){var s=t.getData();s=this._cleanUrl(s),""!==(s=this._encodeUrl(s)).url&&(s=this._setUrl(e,s),1===e.length&&(s=this._setText(e,s)),(s=this._setTarget(e,s)).element=e,this.app.broadcast("link."+i,s))},_cleanUrl:function(t){return t.url=this.app.content.escapeHtml(t.url),t.url=-1!==t.url.search(/^javascript:/i)?"":t.url,t},_encodeUrl:function(t){return t.url=t.url?t.url.replace(/&amp;/g,"&"):"",t},_setUrl:function(t,e){return t.attr("href",e.url),e},_setText:function(t,e){return e.text=""===e.text?e.url:e.text,t.text(e.text),e},_setTarget:function(t,e){return e.target?t.attr("target","_blank"):t.removeAttr("target"),e}}),l.add("module","embed",{popups:{add:{title:"## embed.embed ##",width:"100%",form:{embed:{type:"textarea",label:"## embed.description ##",rows:6},caption:{type:"input",label:"## embed.caption ##"},responsive:{type:"checkbox",text:"## embed.responsive-video ##"}},footer:{insert:{title:"## buttons.insert ##",command:"embed.insert",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}},edit:{title:"## embed.embed ##",width:"100%",form:{embed:{type:"textarea",label:"## embed.description ##",rows:6},caption:{type:"input",label:"## embed.caption ##"},responsive:{type:"checkbox",text:"## embed.responsive-video ##"}},footer:{save:{title:"## buttons.save ##",command:"embed.save",type:"primary"},cancel:{title:"## buttons.cancel ##",command:"popup.close"}}}},build:function(t){t?this._callScripts(t):this._findScripts()},observe:function(t,e,i){if(!this.opts.embed)return!1;var s=this.app.block.get();return i&&"addbar"===i.getName()?t.command="embed.popup":s&&"embed"===s.getType()&&(t.command="embed.edit"),t},popup:function(){var t=this.app.popup.add("embed",this.popups.add);t.open({focus:"embed"}),this.opts.embed.checkbox&&t.getInput("responsive").attr("checked",!0),this._buildCodemirror(t)},edit:function(t,e){var i=this.app.block.get(),s={embed:i.getEmbedCode(),caption:i.getCaption(),responsive:i.isResponsive()},a=this.app.popup.create("embed",this.popups.edit);a.setData(s),this.app.popup.open({button:e,focus:"embed"}),this._buildCodemirror(a)},insert:function(t){this.app.popup.close();var e=t.getData(),i=this._getEmbedCode(e);if(""!==i){var s=this._createInstance(e,i);this.app.block.add({instance:s})}},save:function(t){this.app.popup.close();var e=this.app.block.get(),i=t.getData(),s=this._getEmbedCode(i);if(""===s){this.app.block.remove();return}var a=this._createInstance(i,s,e);this._isNeedToChange(i,a,e)&&this.app.block.change(a)},_buildCodemirror:function(t){var e=t.getInput("embed");this.app.codemirror.create({el:e,height:"200px",focus:!0}),this.app.popup.updatePosition()},_findScripts:function(){var t=this.app.editor.getLayout().find("[data-"+this.prefix+"-type=embed]").find("script").getAll();this.build.call(this,t)},_callScripts:function(t){for(var e=0;e<t.length;e++)if(""!==t[e].src){var i=t[e].src;this.app.editor.getDoc().find('head script[src="'+i+'"]').remove();var s=this.dom("<script>").attr({src:i,async:!0,defer:"true"});s.on("load",(function(){if(-1!==i.search("instagram")){var s=this.app.editor.getWinNode();s.instgrm&&s.instgrm.Embeds.process()}this.build(t.slice(e+1))}).bind(this));var a=this.app.editor.getDocNode().getElementsByTagName("head")[0];a&&a.appendChild(s.get())}},_getEmbedCode:function(t){var e=t.embed.trim();return e=this.app.codemirror.val(e),e=this._removeScript(e),e=this.app.content.sanitize(e),e=this._isHtmlString(e)||""===e?e:this._parseUrl(e)},_removeScript:function(t){return this.opts.embed.script||(t=this.app.content.removeTagsWithContent(t,["script"])),t},_createInstance:function(t,e,i){if(i){var s;(s=i.duplicateEmpty().getBlock()).html(e)}else s=this._isFigure(e)?e:"<figure>"+e+"</figure>";var a=this.app.create("block.embed",s);return a.setCaption(t.caption),t.responsive&&a.addResponsive(),a},_parseUrl:function(t){var e='<iframe width="560" height="315" src="',i='" frameborder="0" allowfullscreen></iframe>';if(t.match(this.opts.regex.youtube)){var s="//www.youtube.com";return -1!==t.search("youtube-nocookie.com")&&(s="//www.youtube-nocookie.com"),e+t.replace(this.opts.regex.youtube,s+"/embed/$1")+i}return t.match(this.opts.regex.vimeo)?e+t.replace(this.opts.regex.vimeo,"//player.vimeo.com/video/$2")+i:t},_isNeedToChange:function(t,e,i){if(i.getEmbedCode()!==e.getEmbedCode()||t.responsive!==i.isResponsive()||t.caption!==i.getCaption())return!0},_isHtmlString:function(t){return/^\s*<(\w+|!)[^>]*>/.test(t)},_isFigure:function(t){return/^<figure/.test(t)}}),l.add("module","grid",{popup:function(){this.app.popup.add("grid",{title:"## popup.grid ##",width:"320px",items:this.buildItems()}).open()},observe:function(){if(!this.opts.grid)return!1},buildItems:function(){var t={},e=0;for(var i in this.opts.grid.patterns)if(this.opts.grid.patterns.hasOwnProperty(i)){e++;var s=this._createPattern(i);t["column"+e]={html:s,command:"grid.add",params:{pattern:i,columns:this.opts.grid.patterns[i]}}}return t},add:function(t){this.app.popup.close();var e=""===t.columns,i=e?t.pattern.split("|"):t.columns.split("|"),s=this.dom("<div>").addClass(this.opts.grid.classname);""!==this.opts.grid.classes&&s.addClass(this.opts.grid.classes);for(var a=0;a<i.length;a++){var o=this.app.create("block.column").getBlock();e||o.addClass(i[a]),s.append(o)}var n=this.app.block.add({name:"grid",source:s,caret:!1});this.app.block.set(n)},_createPattern:function(t){for(var e=this.dom("<div>").addClass(this.prefix+"-popup-grid-box"),i=t.split("|"),s=100/this.app.utils.sumOfArray(i),a=0;a<i.length;a++){var o=this.dom("<span>");o.addClass(this.prefix+"-popup-grid-column"),o.css("width",i[a]*s+"%"),e.append(o)}return e}}),l.add("module","image",{popups:{add:{title:"## popup.add-image ##",width:"100%"},edit:{title:"## popup.image ##",width:"100%",getter:"block.getData",form:{width:{type:"input",width:"100px",label:"## image.width ##",observer:"image.observeImageWidth"},alt:{type:"input",label:"## image.alt-text ##"},caption:{type:"input",label:"## image.caption ##",observer:"image.observeImageCaption"},link:{type:"input",label:"## image.link ##",observer:"image.observeImageLink"},target:{type:"checkbox",text:"## image.link-in-new-tab ##",observer:"image.observeImageLink"}},footer:{save:{title:"## image.save ##",command:"image.save",type:"primary"},cancel:{title:"## image.cancel ##",command:"popup.close"}}},editcard:{title:"## popup.image ##",width:"100%",getter:"block.getData",setter:"block.setData",form:{alt:{type:"input",label:"## image.alt-text ##"}},footer:{save:{title:"## image.save ##",command:"image.save",type:"primary"},cancel:{title:"## image.cancel ##",command:"popup.close"}}}},init:function(){this.dataStates=[]},popup:function(){var t=this.app.popup.add("image",this.popups.add),e=t.getBody();this._createImageByUrl(e),this._createOrSection(e),this._createUploadBox(e),this._createSelectBox(e),t.open()},edit:function(t,e){this._edit("edit",e)},editCard:function(t,e){this._edit("editcard",e)},observe:function(t,e,i){if(!this.opts.image)return!1;var s=this.app.block.get();return i&&"addbar"===i.getName()?t.command="image.popup":s&&"image"===s.getType()&&(t.command="image.edit"),t},observeStates:function(){this._findImages().each(this._addImageState.bind(this))},observeImageLink:function(t){return!!this.opts.image.link&&t},observeImageCaption:function(t){var e=this.app.block.get();return!!e&&"figure"===e.getTag()&&t},observeImageWidth:function(t){return!!this.opts.image.width&&t},parseInserted:function(t){var e=[],i={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:!0,success:"image.insertFromInserted",error:"image.error"};this.pasteInsertedImages=[],this.resolved=[];for(var s=0,a=0;a<t.instances.length;a++){var o=t.instances[a];if("image"===o.getType()){var n=o.getSrc();if(-1!==n.search(/^data:/i)){var r=this._dataURLtoFile(n,"image"+a);e.push(r),this.pasteInsertedImages.push(o)}else if(-1!==n.search(/^blob:/i)){s++,this.pasteInsertedImages.push(o);var l=this;!function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=function(t){if(200==i.status){var s=new File([i.response],"image"+e,{type:"image/png"});l.resolved.push(s)}},i.send()}(n,a)}}}if(0!==s)var p=setInterval((function(){this.resolved.length===s&&(clearInterval(p),this.app.create("upload").send(!1,this.resolved,i))}).bind(this),100);0!==e.length&&this.app.create("upload").send(!1,e,i)},paste:function(t,e){var i={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:!1,success:"image.insertFromBlob",error:"image.error"};this.app.create("upload").send(e,[t],i)},drop:function(t,e){for(var i=[],s=0;s<e.files.length;s++){var a=e.files[s]||e.items[s].getAsFile();a&&i.push(a)}var o={url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:"image.insertByDrop",error:"image.error"};if(i.length>0){var n=this.dom(t.target).closest("[data-"+this.prefix+"-type]");0!==n.length&&this.app.block.set(n),this.app.create("upload").send(t,i,o)}},insertFromClipboard:function(t){var e=t.getData("text/plain")||t.getData("text/html");if(""===(e=e.trim())){for(var i=t.items,s=null,a=0;a<i.length;a++)0===i[a].type.indexOf("image")&&(s=i[a].getAsFile());if(null!==s)return this.paste(s),!0}},insertFromBlob:function(t){this.insert(t)},insertByDrop:function(t,e){if(this.app.block.is()){var i=this.app.block.get(),s=e.target,a=i.getType();if("card"===a&&s&&"IMG"===s.tagName&&i.hasImage()||"image"===a){this.change(t);return}e&&"card"!==a&&i.isEditable()&&this.app.insertion.insertPoint(e)}this.insert(t)},insertByUpload:function(t){this.insert(t)},insertByUrl:function(t){t.preventDefault();var e=this.$urlinput.val();if(""!==e.trim()){var i={file:{url:e,id:this.app.utils.getRandomId()}};this.insert(i)}},insertFromSelect:function(t){t.preventDefault();for(var e=this.dom(t.target),i={url:e.attr("data-url")},s=["id","alt","caption","link","width","height"],a=0;a<s.length;a++){var o=e.attr("data-"+s[a]);null!==o&&(i[s[a]]=o)}this.insert({file:i},!0)},insertFromInserted:function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&(this.pasteInsertedImages[e].setImage(t[i]),e++)},changeClone:function(t){for(var e in t)if(t.hasOwnProperty(e)){this.$imageclone.attr("src",t[e].url);break}this.change(t,!1)},change:function(t,e){!1!==e&&this.app.popup.close();var i=this.app.block.get();for(var s in t)if(t.hasOwnProperty(s)){i.setImage(t[s]),this.app.broadcast("image.change",t[s]),this.app.broadcast("image.upload",{instance:i,data:t[s]});return}},save:function(t){this.app.popup.close(),this.app.block.setData(t)},insert:function(t,e){this.app.popup.close(),this.imageslen=0,this.imagescount=0;var i=this.opts.image.tag;for(var s in t)if(t.hasOwnProperty(s)){var a=this.dom("<"+i+">"),o=this._createImageFromResponseItem(t[s]);a.append(o);var n=this.app.create("block.image",a);if(this.app.block.add({instance:n,type:"image"}),Object.prototype.hasOwnProperty.call(t[s],"caption")){var r=this.dom("<figcaption>").html(t[s].caption);n.$block.append(r),this.app.create("block.figcaption",r)}var l=e?"select":"upload";this.app.broadcast("image."+l,{instance:n,data:t[s]}),this.$last=n.getBlock(),this.imageslen++}},error:function(t){this.app.broadcast("image.upload.error",{response:t})},getStates:function(){var t=this._findImages();for(var e in this.dataStates)if(this.dataStates.hasOwnProperty(e)){var i=this.dataStates[e],s=t.is('[data-image="'+i.id+'"]');this._setImageState(i.id,s)}return this.dataStates},createUploadBox:function(t,e){if(t){var i=this.dom("<div>");return e.append(i),i}},createSelectBox:function(t,e,i){if(t){if(this.$selectbox=this._createImagesBox(e),"object"==typeof t)this._parseList(t,i);else{var s=this.opts.editor.reloadmarker?{d:new Date().getTime()}:{};this.ajax.request(this.opts.image.selectMethod,{url:t,data:s,success:(function(t){this._parseList(t,i)}).bind(this)})}}},_edit:function(t,e){this.app.popup.create("image-edit",this.popups[t]),this._buildEditUpload(),this.app.popup.open({button:e})},_findImages:function(){return this.app.editor.getLayout().find("[data-image]")},_addImageState:function(t){var e=t.attr("data-image");this.dataStates[e]={type:"image",status:!0,url:t.attr("src"),$img:t,$el:t,id:e}},_setImageState:function(t,e){this.dataStates[t].status=e},_checkImageLoad:function(){this.imagescount++,this.imagescount===this.imageslen&&(this.app.block.unset(),this.app.block.set(this.$last),this.app.editor.adjustHeight())},_buildEditUpload:function(){if(this.opts.image.upload){var t=this.app.block.get(),e=this.app.popup.getStack().getBody(),i=this._createFormItem();i.addClass(this.prefix+"-form-item-edit-image-box"),this.$imageclone=t.getImage().clone(),this.$imageclone.removeAttr("width height style");var s=this.dom("<div>").addClass(this.prefix+"-form-item-image");s.append(this.$imageclone),i.append(s),this.$upload=this.dom("<div>"),i.append(this.$upload),e.prepend(i),this._buildUpload(this.$upload,"image.changeClone")}},_buildUpload:function(t,e){if(this.opts.image.upload){var i={box:!0,placeholder:this.lang.get("image.upload-new-placeholder"),url:this.opts.image.upload,name:this.opts.image.name,data:this.opts.image.data,multiple:this.opts.image.multiple,success:e,error:"image.error"};this.app.create("upload",t,i)}},_createSelectBox:function(t){this.createSelectBox(this.opts.image.select,t,"image.insertFromSelect")},_createUploadBox:function(t){this.$upload=this.createUploadBox(this.opts.image.upload,t),this._buildUpload(this.$upload,"image.insertByUpload")},_createImageFromResponseItem:function(t){for(var e=this.dom("<img>").attr("src",t.url).one("load",this._checkImageLoad.bind(this)),i=e,s=["id","alt","width","height"],a=0;a<s.length;a++)Object.prototype.hasOwnProperty.call(t,s[a])&&i.attr(s[a],t[s[a]]);if(Object.prototype.hasOwnProperty.call(t,"id")&&i.attr("data-image",t.id),Object.prototype.hasOwnProperty.call(t,"2x")&&i.attr("srcset",t["2x"]+" 2x"),Object.prototype.hasOwnProperty.call(t,"link")){var o=this.dom("<a>");o.attr("href",t.link),e.wrap(o),i=o}return i},_createImagesBox:function(t){var e=this.dom("<div>").addClass(this.prefix+"-popup-images-box");return t.append(e),e},_createOrSection:function(t){if(this.opts.image.url&&(this.opts.image.upload||this.opts.image.select)){var e=this.dom("<div>").addClass(this.prefix+"-popup-image-section-or");e.html(this.lang.get("image.or")),t.append(e)}},_createImageByUrl:function(t){if(this.opts.image.url){var e=this._createFormItem();this.$urlinput=this._createUrlInput(),this.$urlbutton=this._createUrlButton(),e.append(this.$urlinput),e.append(this.$urlbutton),t.append(e)}},_createFormItem:function(){return this.dom("<div>").addClass(this.prefix+"-form-container-flex")},_createUrlInput:function(){var t=this.dom("<input>").addClass(this.prefix+"-form-input");return t.attr("placeholder",this.lang.get("image.url-placeholder")),t},_createUrlButton:function(){var t=this.dom("<button>").addClass(this.prefix+"-form-button "+this.prefix+"-form-button-primary");return t.html(this.lang.get("image.insert")),t.one("click",this.insertByUrl.bind(this)),t},_parseList:function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];if("object"!=typeof s)continue;var a=this.dom("<img>"),o=s.thumb?s.thumb:s.url;a.addClass(this.prefix+"-popup-event"),a.attr("src",o),a.attr("data-url",s.url),a.attr("data-callback",e);for(var n=["id","alt","caption","link","width","height"],r=0;r<n.length;r++)Object.prototype.hasOwnProperty.call(s,n[r])&&a.attr("data-"+n[r],s[n[r]]);a.on("click."+this.prefix+"-popup-event-"+this.uuid,(function(t){var e=this.dom(t.target).attr("data-callback");this.app.api(e,t)}).bind(this)),this.$selectbox.append(a)}},_dataURLtoFile:function(t,e){for(var i=t.split(","),s=i[0].match(/:(.*?);/)[1],a=atob(i[1]),o=a.length,n=new Uint8Array(o);o--;)n[o]=a.charCodeAt(o);return new File([n],e,{type:s})}}),l.add("module","table",{popups:{cell:{title:"## table.table-cell ##",width:"300px",form:{width:{type:"input",label:"## table.width ##"},nowrap:{type:"checkbox",text:"## table.nowrap ##"}},footer:{insert:{title:"## table.save ##",command:"table.save",type:"primary"},cancel:{title:"## table.cancel ##",command:"popup.close"}}}},items:{table:{addhead:{title:"## table.add-head ##",command:"table.addHead"},removehead:{title:"## table.remove-head ##",command:"table.removeHead"}},row:{addrowbelow:{title:"## table.add-row-below ##",command:"table.addRowBelow"},addrowabove:{title:"## table.add-row-above ##",command:"table.addRowAbove"},removerow:{title:"## table.remove-row ##",command:"table.removeRow"}},cell:{addcolumnafter:{title:"## table.add-column-after ##",command:"table.addColumnAfter"},addcolumnbefore:{title:"## table.add-column-before ##",command:"table.addColumnBefore"},addrowbelow:{title:"## table.add-row-below ##",command:"table.addRowBelow"},addrowabove:{title:"## table.add-row-above ##",command:"table.addRowAbove"},removecolumn:{title:"## table.remove-column ##",command:"table.removeColumn"},removerow:{title:"## table.remove-row ##",command:"table.removeRow"}}},add:function(){var t=this.app.block.add({name:"table",source:this.opts.table.template,caret:!1}).getFirstCell();t&&this.app.block.set(t,"start")},observe:function(t,e,i){if(!this.opts.table)return!1;var s=this.app.block.get();return i&&"addbar"===i.getName()?t.command="table.add":s&&s.isType(["table","row","cell"])&&(t.command="table.popup"),t},popup:function(t,e){var i=this.app.block.get().getType();this.app.popup.create("table",{items:this.items[i]}),this.app.popup.open({button:e})},addHead:function(){this.removeHead();var t=this.app.block.get().getBlock(),e=t.find("tr").first().children("td, th").length,i=this.dom("<thead>"),s=this._buildRow(e,"<th>");i.append(s),t.prepend(i),this.app.block.set(s.children("td, th").first(),"start")},addRowBelow:function(){this._addRow("below")},addRowAbove:function(){this._addRow("above")},addColumnBefore:function(){this._addColumn("before")},addColumnAfter:function(){this._addColumn("after")},removeHead:function(){this.app.popup.close();var t=this.app.block.get().getBlock().find("thead");0!==t.length&&t.remove()},removeRow:function(){this.app.popup.close(),this.app.control.close();var t=this.app.block.get();"cell"===t.getType()&&(t=t.getParent(["row"])),t.remove(!0)},removeColumn:function(){this.app.popup.close(),this.app.control.close();var t=this.app.block.get().getBlock(),e=t.closest("table"),i=t.closest("tr"),s=0;i.find("td, th").each(function(e,i){e.get()===t.get()&&(s=i)}),e.find("tr").each((function(t){var e=t.find("td, th").get(s);this.dom(e).remove()}).bind(this))},cellSetting:function(t,e){var i=this.app.block.get();this.app.popup.create("cell",this.popups.cell).setData({width:i.getWidth(),nowrap:i.getNowrap()}),this.app.popup.open({button:e,focus:"width"})},save:function(t){this.app.popup.close();var e=t.getData(),i=this.app.block.get();""!==e.width&&i.setWidth(e.width),i.setNowrap(e.nowrap)},_addColumn:function(t){this.app.popup.close();var e,i=this.app.block.get().getBlock(),s=i.closest("table"),a=i.closest("tr"),o=0;a.find("td, th").each(function(t,e){t.get()===i.get()&&(o=e)});var n=0;s.find("tr").each(function(t,e){t.get()===a.get()&&(n=e)}),s.find("tr").each((function(i,s){var a=i.find("td, th").get(o),r=this.dom(a),l=r.clone();l.html(""),this.app.create("block.cell",l),n===s&&(e=l),r[t](l)}).bind(this)),e&&this.app.block.set(e,"start")},_addRow:function(t){this.app.popup.close();var e=this.app.block.get().getBlock(),i=e.closest("tr"),s=e.closest("thead"),a=i.children("td, th").length,o=this._buildRow(a,"<td>");0!==s.length?s.after(o):i["below"===t?"after":"before"](o),this.app.block.set(o.find("td, th").first(),"start")},_buildRow:function(t,e){var i=this.dom("<tr>");this.app.create("block.row",i);for(var s=0;s<t;s++){var a=this.dom(e);this.app.create("block.cell",a),i.append(a)}return i}}),l.add("module","snippet",{popups:{base:{title:"## popup.snippets ##",width:"100%"}},init:function(){this.json={}},observe:function(){if(!this.opts.snippets)return!1},popup:function(){var t=this.app.popup.add("snippets",this.popups.base),e=t.getBody();if("string"==typeof this.opts.snippets){var i=this.opts.editor.reloadmarker?{d:new Date().getTime()}:{};this.ajax.get({url:this.opts.snippets,data:i,success:(function(t){this._buildPopup(t,e)}).bind(this)})}else this._buildPopup(this.opts.snippets,e);t.open()},insert:function(t){var e=this.dom(t.target).closest("."+this.prefix+"-snippet-container").attr("data-snippet-key");if(Object.prototype.hasOwnProperty.call(this.json,e)){this.app.popup.close();var i=this.json[e].html;this.app.editor.insertContent({html:i,caret:"start"})}},_buildPopup:function(t,e){this.json=t,"string"==typeof t&&(this.json=JSON.parse(t)),Object.keys(this.json).forEach((function(t){var i=this._buildPreviewContainer(e,t);this._buildPreview(i,t),this._buildPreviewName(i,t)}).bind(this))},_buildPreviewContainer:function(t,e){var i=this.dom("<div>").addClass(this.prefix+"-snippet-container");return i.attr("data-snippet-key",e),i.one("click",this.insert.bind(this)),t.append(i),i},_buildPreview:function(t,e){var i=this.dom("<div>");if(Object.prototype.hasOwnProperty.call(this.json[e],"image")){i.addClass(this.prefix+"-snippet-image");var s=this.dom("<img>").attr("src",this.json[e].image);i.html(s)}else i.addClass(this.prefix+"-snippet-preview"),i.html(this.json[e].html);t.append(i)},_buildPreviewName:function(t,e){if(Object.prototype.hasOwnProperty.call(this.json[e],"name")){var i=this.dom("<div>").addClass(this.prefix+"-snippet-name");i.text(this.json[e].name),t.append(i)}}}),l.add("module","template",{popups:{base:{title:"## templates.templates ##",width:"100%"}},init:function(){this.json={}},observe:function(){if(!this.opts.templates)return!1},popup:function(t,e){if("string"==typeof this.opts.templates){var i=this.opts.editor.reloadmarker?{d:new Date().getTime()}:{};this.ajax.get({url:this.opts.templates,data:i,success:(function(t){this._buildPopup(e,t)}).bind(this)})}else this._buildPopup(e,this.opts.templates)},insert:function(t){var e=this.dom(t.target).closest("."+this.prefix+"-template-container").attr("data-template-key");if(Object.prototype.hasOwnProperty.call(this.json,e)){this.app.popup.close();var i=this.json[e].html;this.app.editor.setContent({html:i,caret:!1})}},_buildPopup:function(t,e){var i=this.app.popup.create("templates",this.popups.base).getBody();this.json="string"==typeof e?JSON.parse(e):e,Object.keys(this.json).forEach((function(t){var e=this._buildPreviewContainer(i,t);this._buildPreview(e,t),this._buildPreviewName(e,t)}).bind(this)),this.app.popup.open({button:t})},_buildPreviewContainer:function(t,e){var i=this.dom("<div>").addClass(this.prefix+"-template-container");return i.attr("data-template-key",e),i.one("click",this.insert.bind(this)),t.append(i),i},_buildPreview:function(t,e){var i=this.dom("<div>");if(Object.prototype.hasOwnProperty.call(this.json[e],"image")){i.addClass(this.prefix+"-template-image");var s=this.dom("<img>").attr("src",this.json[e].image);i.html(s)}else i.addClass(this.prefix+"-template-preview"),i.html(this.json[e].html);t.append(i)},_buildPreviewName:function(t,e){if(Object.prototype.hasOwnProperty.call(this.json[e],"name")){var i=this.dom("<div>").addClass(this.prefix+"-template-name");i.text(this.json[e].name),t.append(i)}}}),l.add("class","tool.checkbox",{mixins:["tool"],type:"checkbox",input:{tag:"input",type:"checkbox",classname:"-form-checkbox"},getValue:function(){return this.$input.val()},_buildInput:function(){if(this.$box=this.dom("<label>").addClass(this.prefix+"-form-checkbox-item"),this.$box.append(this.$input),this._has("text")){var t=this.dom("<span>").html(this.lang.parse(this.obj.text));this.$box.append(t)}this.$tool.append(this.$box)}}),l.add("class","tool.input",{mixins:["tool"],type:"input",input:{tag:"input",type:"text",classname:"-form-input"},_buildInput:function(){this.$tool.append(this.$input)}}),l.add("class","tool.number",{mixins:["tool"],type:"number",input:{tag:"input",type:"number",classname:"-form-input"},_buildInput:function(){this.$input.attr("min",0).css("max-width","65px"),this.$tool.append(this.$input)}}),l.add("class","tool.segment",{mixins:["tool"],type:"segment",input:{tag:"input",type:"hidden",classname:"-form-input"},setValue:function(t){this.$segment.find("."+this.prefix+"-form-segment-item").removeClass("active"),this.$segment.find("[data-segment="+t+"]").addClass("active"),this.$input.val(t)},_buildInput:function(){this.$segment=this.dom("<div>").addClass(this.prefix+"-form-segment");var t=this.obj.segments;for(var e in t)if(t.hasOwnProperty(e)){var i=this.dom("<span>").addClass(this.prefix+"-form-segment-item");i.attr("data-segment",e).on("click",this._catchSegment.bind(this)),Object.prototype.hasOwnProperty.call(t[e],"icon")?i.html(t[e].icon):i.addClass(this.prefix+"-icon-"+t[e].prefix+"-"+e),this.$segment.append(i)}this.$segment.append(this.$input),this.$tool.append(this.$segment)},_catchSegment:function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target).closest("."+this.prefix+"-form-segment-item"),i=e.attr("data-segment");this.$segment.find("."+this.prefix+"-form-segment-item").removeClass("active"),e.addClass("active"),this.$input.val(i),this.app.api(this.setter,this.popup)}}),l.add("class","tool.select",{mixins:["tool"],type:"select",input:{tag:"select",classname:"-form-select"},_buildInput:function(){for(var t in this.obj.options)if(this.obj.options.hasOwnProperty(t)){var e=this.dom("<option>");e.val(t),e.html(this.lang.parse(this.obj.options[t])),this.$input.append(e)}this.$tool.append(this.$input)}}),l.add("class","tool.textarea",{mixins:["tool"],type:"textarea",input:{tag:"textarea",classname:"-form-textarea"},setFocus:function(){this.$input.focus(),this.$input.get().setSelectionRange(0,0),this.$input.scrollTop(0)},_buildInput:function(){this._has("rows")&&this.$input.attr("rows",this._get("rows")),this.$input.attr("data-gramm_editor",!1),this.$tool.append(this.$input)}}),l.add("class","tool.upload",{mixins:["tool"],type:"upload",input:{tag:"input",type:"hidden",classname:"-form-input"},setValue:function(t){t=t||"",this.upload&&this.upload.setImage(t),this.$input.val(t)},_buildInput:function(){this.$tool.append(this.$input),this._buildUpload()},_buildUpload:function(){this.$upload=this.dom("<input>").attr("type","file"),this.$tool.append(this.$upload);var t={};this._has("trigger")&&this._get("trigger")&&(t={instance:this,method:"trigger"}),this.upload=this.app.create("upload",this.$upload,this.obj.upload,t)}}),l.add("block","block.paragraph",{mixins:["block"],type:"paragraph",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<p>")},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var s=this.app.block.create();if(this.opts.clean.enter||(s=this.duplicateEmpty()).getBlock().removeAttr("id"),!this.opts.clean.enterinline){var a=this.app.selection.getInline();if(a){for(var o,n=this.app.element.getAllInlines(a),r=0;r<n.length;r++)if("A"!==n[r].tagName){if(0===r)(o=n[r].cloneNode()).removeAttribute("id"),o.innerHTML="";else{var l=n[r].cloneNode();l.removeAttribute("id"),l.innerHTML="",o.appendChild(l)}}o&&(s=this.app.block.create(o.outerHTML))}}s.isEmpty()&&s.getBlock().html(this.app.utils.createInvisibleChar()),this.insert({instance:s,position:"after",caret:"start",remove:!1})}else if(this.isCaretStart())this.insert({instance:this.duplicateEmpty(),position:"before"});else{var p=this.getBlock(),h=this.app.element.split(p);this.app.block.set(h,"start")}return!0}}),l.add("block","block.text",{mixins:["block"],type:"text",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<div>").addClass(this.opts.text.classname)},handleEnter:function(t,e,i){return t.preventDefault(),this.app.insertion.insertBreakline(),!0}}),l.add("block","block.address",{mixins:["block"],type:"address",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<address>")},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var s=this.getBlock(),a=s.children(),o=a.length,n=a.eq(o-1),r=a.eq(o-2),l=s.html().trim();if(-1!==(l=this.app.utils.removeInvisibleChars(l)).search(/<br\s?\/?>$/)){r.remove(),n.remove(),this.insertEmpty({position:"after",caret:"start"});return}}return this.app.insertion.insertBreakline(),!0}}),l.add("block","block.cell",{mixins:["block"],type:"cell",editable:!0,toolbar:{table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"},tune:{command:"table.cellSetting",title:"## buttons.settings ##"}},create:function(){return this.dom("<td>")},getNextCell:function(){var t=this.getNext();if(!t){var e=this.getParent("row");if(e){var i=e.getNextRow();i&&(t=i.getChildFirst("cell"))}}return t},getPrevCell:function(){var t=this.getPrev();if(!t){var e=this.getParent("row");if(e){var i=e.getPrevRow();i&&(t=i.getChildLast("cell"))}}return t},getWidth:function(){return this.$block.attr("width")||""},getNowrap:function(){return"nowrap"===this.$block.css("white-space")},setWidth:function(t){this._eachCell(function(e){""===t?e.removeAttr("width"):(t=-1!==t.search("%")?t:t.replace("px",""),e.attr("width",t))})},setNowrap:function(t){this._eachCell(function(e){t=t?"nowrap":"",e.css("white-space",t)})},handleArrow:function(t,e,i){var s;if(i.is("up-left")&&this.isCaretStart()){t.preventDefault();var a=this.getPrevCell();return a?this.app.block.set(a,"end"):(s=this.getParent("table"),this.app.block.set(s)),!0}if(i.is("down-right")&&this.isCaretEnd()){t.preventDefault();var o=this.getNextCell();return o?this.app.block.set(o,"start"):(s=this.getParent("table"),this.app.block.set(s)),!0}},handleTab:function(t,e,i){t.preventDefault();var s=this.getNextCell();if(s)this.app.block.set(s,"start");else{var a=this.getParent("table");this.app.block.set(a)}return!0},handleEnter:function(t,e,i){return t.preventDefault(),this.app.insertion.insertBreakline(),!0},_eachCell:function(t){var e=0,i=this.$block.closest("table");this.$block.closest("tr").find("td, th").each((function(t,i){t.get()===this.$block.get()&&(e=i)}).bind(this)),i.find("tr").each((function(i){var s=i.find("td, th").get(e);t(this.dom(s))}).bind(this))}}),l.add("block","block.code",{mixins:["block"],type:"code",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom(this.opts.code.template)},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption")},handleArrow:function(t,e,i){if(i.is("down-right")&&this.isCaretEnd()){var s=this.getNext();return s?this.app.block.set(s,"start"):this.app.insertion.insertEmptyBlock({position:"after",caret:"start"}),!0}},handleTab:function(t,e,i){t.preventDefault();var s=this.opts.code.spaces,a=document.createTextNode(Array(s+1).join(" "));return this.app.insertion.insertNode(a,"end"),!0},handleEnter:function(t,e,i){t.preventDefault();var s=this.$block.html().search(/\n$/);return this.isCaretEnd()&&-1===s?this.app.insertion.insertNewline("after",!0):this.app.insertion.insertNewline(),!0}}),l.add("block","block.column",{mixins:["block"],type:"column",nested:!0,emptiable:!0,toolbar:{alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"}},create:function(){return this.dom("<div>")}}),l.add("block","block.dlist",{mixins:["block"],type:"dlist",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<dl>")},getPlainText:function(t){var e="",i=this.$block.find("dt, dd"),s=i.length;return i.each(function(i,a){var o=t?"<br>":"";a===s&&(o=""),e+=i.html()+o}),e},setEmpty:function(){this.$block.html("");var t=this.dom("<dt>");this.$block.append(t),this.app.caret.set(t,"start")},isEmpty:function(){var t=this.$block.html();t=this._cleanEmpty(t);var e=this.$block.find("dt, dd");return 0===e.length?""===(t=t.trim()):1===e.length&&(t=e.eq(0).html(),""===(t=this._cleanEmpty(t)))},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){var s,a=this.app.selection.getBlock(),o=this.dom(a),n=a.tagName.toLowerCase(),r=this.app.content.isEmptyHtml(a.innerHTML);if("dt"===n&&r)return o.remove(),this.insertEmpty({position:"after",caret:"start"}),!0;s="dt"===n?this.dom("<dd>"):this.dom("<dt>"),this.dom(a).after(s),this.app.caret.set(s,"start")}else{if(this.isCaretStart())return!0;this.app.insertion.insertBreakline()}return!0}}),l.add("block","block.embed",{mixins:["block"],type:"embed",parser:{unparse:function(t){var e,i=decodeURI(t.attr("data-embed-code")),s=this.opts.embed.responsive.split(" ").join("."),a=t.find("."+s),o=t.find("figcaption");0!==o.length&&(e=o.clone(),o.remove()),0===a.length?t.html(i):a.html(i),e&&t.append(e),t.removeAttr("data-embed-code data-arx-type"),0===t.get().attributes.length&&0===t.find("figcaption").length&&0===t.find("div").length&&t.unwrap()}},toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},outset:{title:"## buttons.outset ##",command:"block.popup",observer:"block.observe"},embed:{title:"## blocks.embed ##",command:"embed.popup",observer:"embed.observe"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<figure>")},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption"),this._buildEmbedCode()},addResponsive:function(){var t=this.dom("<div>").addClass(this.opts.embed.responsive),e=this.$block.find("figcaption"),i=e.clone(),s=this.getEmbedCode();e.remove(),t.html(s),this.$block.html("").append(t),0!==i.length&&(this.app.create("block.figcaption",i),this.$block.append(i)),this._buildEmbedCode()},removeResponsive:function(){this.$block.find(this._getEmbedClass()).unwrap()},getEmbedCode:function(){return decodeURI(this.$block.attr("data-embed-code"))},isResponsive:function(){return 0!==this.$block.find(this._getEmbedClass()).length},_buildEmbedCode:function(){var t=this.$block.clone();t.find(this._getEmbedClass()).unwrap(),t.find("figcaption").remove();var e=t.html().trim();this.$block.attr("data-embed-code",encodeURI(e))},_getEmbedClass:function(){return"."+this.opts.embed.responsive.replace(/ +/g,".")}}),l.add("block","block.figcaption",{mixins:["block"],type:"figcaption",editable:!0,toolbar:{alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},create:function(){return this.dom("<figcaption>")},getFigure:function(){return this.$block.closest("figure").dataget("instance")},handleArrow:function(t,e,i){if(i.is("up-left")&&this.isCaretStart()||i.is("down-right")&&this.isCaretEnd()){t.preventDefault();var s=this.getFigure();return this.app.block.set(s),!0}},handleTab:function(t,e,i){t.preventDefault();var s=this.getFigure();return this.app.block.set(s),!0},handleEnter:function(t,e,i){return t.preventDefault(),this.isEmpty()||this.isCaretEnd()||this.isCaretStart()||this.app.insertion.insertBreakline(),!0}}),l.add("block","block.grid",{mixins:["block"],type:"grid",nested:!0,parser:{unparse:function(t){t.removeClass(this.prefix+"-grid-overlay")}},toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},valign:{title:"## buttons.valign ##",command:"block.popup",observer:"block.observe"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){var t=this.dom("<div>").addClass(this.opts.grid.classname);return""!==this.opts.grid.classes&&t.addClass(this.opts.grid.classes),t},build:function(){this._buildOverlay()},_buildOverlay:function(){this.opts.grid&&this.opts.grid.overlay&&this.$block.addClass(this.prefix+"-grid-overlay")}}),l.add("block","block.heading",{mixins:["block"],type:"heading",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<h2>")},getTitle:function(){var t=this.lang.get("headings"),e=this.getTag(),i=this.$block.attr("data-title");return void 0!==t[e]?t[e]:i},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd())this.insertEmpty({position:"after",caret:"start",remove:!1});else if(this.isCaretStart())this.insert({instance:this.duplicateEmpty(),position:"before"});else{var s=this.getBlock(),a=this.app.element.split(s);this.app.block.set(a,"start")}return!0}}),l.add("block","block.image",{mixins:["block"],type:"image",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},outset:{title:"## buttons.outset ##",command:"block.popup",observer:"block.observe"},image:{title:"## blocks.image ##",command:"image.popup",observer:"image.observe"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<"+this.opts.image.tag+">")},build:function(){this._buildCaption(),this._buildItems("figcaption","figcaption"),this.data={alt:{getter:"getAlt",setter:"setAlt"},width:{getter:"getWidth",setter:"setWidth"},link:{getter:"getLinkUrl",setter:"setLinkUrl"},target:{getter:"getTarget",setter:"setTarget"},caption:{getter:"getCaption",setter:"setCaption"}}},getImage:function(){return this.$block.find("img").eq(0)},getSrc:function(){return this.getImage().attr("src")},getId:function(){return this.getImage().attr("data-image")},getLink:function(){var t=this.getImage().parent();return"A"===t.get().tagName&&t},getWidth:function(){var t=this.getImage(),e=t.css("width"),i=t.attr("width");return i&&-1!==i.search(/%/)&&(e=i),e},getAlt:function(){return this.getImage().attr("alt")||""},getLinkUrl:function(){var t=this.getLink();return t?t.attr("href"):""},getTarget:function(){var t=this.getLink();return t?t.attr("target"):this.opts.image.newtab},setWidth:function(t){var e=this.getImage();if(""===(t=t.trim()))e.removeAttr("width");else{var i=-1!==t.search(/%/),s=i?t:parseInt(t),a=e.width()/e.height();if(i)e.removeAttr("height"),e.attr({width:s});else{var o=Math.round(s/a);e.attr({width:s,height:o})}}e.css({width:t,"max-width":t}),this.app.broadcast("image.width",{image:e,width:t})},setAlt:function(t){var e=this.getImage();t=t.replace(/"/g,"'"),e.attr("alt",t)},setTarget:function(t){var e=this.getLink();e&&(t?e.attr("target","_blank"):e.removeAttr("target"))},setLinkUrl:function(t){var e=this.getLink();if(e){if(""!==t)e.attr("href",t);else{this.removeLink(),this.app.broadcast("image.unlink",{instance:this});return}}else if(!e){if(""===t)return;var i=this.getImage();e=this.dom("<a>"),i.wrap(e),e.attr("href",t)}this.app.broadcast("image.link",{instance:this,link:e})},setImage:function(t){var e=this.getImage();e.attr("src",t.url),Object.prototype.hasOwnProperty.call(t,"id")&&e.attr("data-image",t.id),Object.prototype.hasOwnProperty.call(t,"2x")&&e.attr("srcset",t["2x"]+" 2x"),e.one("load",this.app.editor.adjustHeight.bind(this.app.editor))},removeLink:function(){var t=this.getLink();t&&t.unwrap()}}),l.add("block","block.layer",{mixins:["block"],type:"layer",nested:!0,emptiable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom(this.opts.layer.template)},getTitle:function(){return this.$block.attr("data-title")||this._getNameByTag()}}),l.add("block","block.line",{mixins:["block"],type:"line",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<hr>")}}),l.add("block","block.list",{mixins:["block"],type:"list",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},format:{title:"## buttons.format ##",command:"format.popup"},alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},outdent:{title:"## buttons.outdent ##",command:"list.outdent"},indent:{title:"## buttons.indent ##",command:"list.indent"},link:{title:"## buttons.link ##",command:"link.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<ul>")},unparse:function(t){this.app.content.unfixListMargin(t)},setEmpty:function(){this.$block.html("");var t=this.dom("<li>");this.$block.append(t),this.app.caret.set(t,"start")},isEmpty:function(){var t=this.$block.html();t=this._cleanEmpty(t);var e=this.$block.find("li");return 0===e.length?""===(t=t.trim()):1===e.length&&(t=e.eq(0).html(),""===(t=this._cleanEmpty(t)))},handleTab:function(t,e,i){var s=this.app.selection.getBlock(),a=this.app.caret.is(s,"start");if(this.isCaretStart()||this.isCaretEnd()){var o=this.getNext();if(o)return t.preventDefault(),this.app.block.set(o,"start"),!0}else{if(this.opts.tab.spaces&&!a)return;return t.preventDefault(),this.app.list.indent(),!0}},handleEnter:function(t,e,i){if(t.preventDefault(),this.isEmpty()||this.isCaretEnd()){if(o=this.app.selection.getBlock(),a=this.dom(o),n=this.app.content.isEmptyHtml(o.innerHTML))return a.remove(),this.insertEmpty({position:"after",caret:"start"}),!0;s=this.dom("<li>"),this.app.element.cloneAttrs(o,s),this.dom(o).after(s),this.app.caret.set(s,"start")}else if(this.isCaretStart())s=this.dom("<li>"),o=this.app.selection.getBlock(),this.app.element.cloneAttrs(o,s),this.dom(o).before(s);else{o=this.app.selection.getBlock(),a=this.dom(o),n=this.app.content.isEmptyHtml(o.innerHTML);var s,a,o,n,r=this.app.caret.is(o,"start"),l=this.app.caret.is(o,"end",["ul","ol"]);if(s=this.dom("<li>"),this.app.element.cloneAttrs(o,s),n)a.after(s),this.app.caret.set(s,"start");else if(r)a.before(s);else if(l){var p=a.find("ul, ol").first();0!==p.length&&(s.append(this.app.utils.createInvisibleChar()),s.append(p)),a.after(s),this.app.caret.set(s,"start")}else{var h=this.app.element.split(o);s=h,this.app.caret.set(h,"start")}}return this.app.broadcast("list.item",{element:s}),!0}}),l.add("block","block.noneditable",{mixins:["block"],type:"noneditable",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom("<div>").addClass(this.opts.noneditable.classname)}}),l.add("block","block.quote",{mixins:["block"],type:"quote",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom(this.opts.quote.template)},build:function(){this._buildCaption(),this._buildItems("p","quoteitem"),this._buildItems("figcaption","figcaption")}}),l.add("block","block.quoteitem",{mixins:["block"],type:"quoteitem",editable:!0,toolbar:{alignment:{title:"## buttons.align ##",command:"block.popup",observer:"block.observe"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"}},create:function(){return this.dom("<p>")},getBlockquote:function(){return this.$block.closest("blockquote")},handleArrow:function(t,e,i){var s=this.getBlockquote();if(0!==s.length){var a=this.app.caret.is(s,"start"),o=this.app.caret.is(s,"end");if(i.is("up-left")&&a||i.is("down-right")&&o){t.preventDefault();var n=this.getParent("quote");return this.app.block.set(n),!0}}},handleTab:function(t,e,i){t.preventDefault();var s=this.getNext();if(s)return this.app.block.set(s,"start"),!0;var a=this.getParent("quote");return this.app.block.set(a),!0},handleEnter:function(t,e,i){t.preventDefault();var s=this.app.create("block.quoteitem");if(this.isEmpty()||this.isCaretEnd())this.insert({instance:s,position:"after",caret:"start"});else if(this.isCaretStart())this.insert({instance:s,position:"before"});else{var a=this.getBlock(),o=this.app.element.split(a);this.app.block.set(o,"start")}return!0}}),l.add("block","block.row",{mixins:["block"],type:"row",toolbar:{table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe"}},create:function(){return this.dom("<tr>")},getNextRow:function(){var t=this.getNext(),e=this.$block.parent();return t||"TABLE"===e.get().tagName||(t=e.nextElement().find("tr").first().dataget("instance")),t},getPrevRow:function(){var t=this.getPrev(),e=this.$block.parent();return t||"TABLE"===e.get().tagName||(t=e.prevElement().find("tr").last().dataget("instance")),t},handleDelete:function(t,e,i){return t.preventDefault(),!0},handleArrow:function(t,e,i){if(t.preventDefault(),i.is("up-left")){var s=this.getParent("table");this.app.block.set(s)}else{var a=this.getChildFirst("cell");this.app.block.set(a,"start")}return!0},handleTab:function(t,e,i){t.preventDefault();var s=this.getNextRow();if(s)this.app.block.set(s);else{var a=this.getParent("table");this.app.block.set(a)}return!0},handleEnter:function(t,e,i){return t.preventDefault(),!0}}),l.add("block","block.table",{mixins:["block"],type:"table",toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},table:{title:"## blocks.table ##",command:"table.add",observer:"table.observe"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom(this.opts.table.template)},build:function(){this._buildItems("tr","row"),this._buildItems("td, th","cell")},getFirstCell:function(){var t=this.$block.find("th, td").first();if(0!==t.length)return t.dataget("instance")}}),l.add("block","block.variable",{mixins:["block"],type:"variable",editable:!1,inline:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},create:function(){return this.dom("<span>").addClass(this.opts.variable.classname)},build:function(){this.$block.addClass(this.opts.variable.classname)}}),l.add("block","block.form",{mixins:["block"],type:"form",create:function(){return this.dom("<form>")},toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"}},control:{trash:{command:"block.remove",title:"## buttons.delete ##"},duplicate:{command:"block.duplicate",title:"## buttons.duplicate ##"}}}),l.add("block","block.card",{mixins:["block"],type:"card",editable:!0,toolbar:{add:{title:"## buttons.add ##",command:"addbar.popup"},bold:{title:"## buttons.bold ##",command:"inline.set",params:{tag:"b"}},italic:{title:"## buttons.italic ##",command:"inline.set",params:{tag:"i"}},deleted:{title:"## buttons.deleted ##",command:"inline.set",params:{tag:"del"}},link:{title:"## buttons.link ##",command:"link.popup"},image:{title:"## buttons.settings ##",command:"image.editCard",observer:"block.observeCard"}},control:{trash:{title:"## buttons.delete ##",command:"block.remove"},duplicate:{title:"## buttons.duplicate ##",command:"block.duplicate"}},create:function(){return this.dom(this.opts.card.template)},build:function(){this.data={alt:{getter:"getAlt",setter:"setAlt"}}},hasImage:function(){return 0!==this.$block.find("img").length},getImage:function(){return this.$block.find("img").eq(0)},getAlt:function(){return this.getImage().attr("alt")||""},setAlt:function(t){this.getImage().attr("alt",t)},setImage:function(t){var e=this.getImage();e.attr("src",t.url),Object.prototype.hasOwnProperty.call(t,"id")&&e.attr("data-image",t.id),e.one("load",this.app.editor.adjustHeight.bind(this.app.editor))},handleEnter:function(t,e,i){return t.preventDefault(),this.app.insertion.insertBreakline(),!0}}),window.ArticleEditor=l,window.addEventListener("load",function(){l("[data-article-editor]")}),e&&((e=l).ArticleEditor=l),ArticleEditor.add("plugin","blockcode",{translations:{en:{blockcode:{save:"Save",cancel:"Cancel","edit-code":"Edit Code"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m10.6128994 3.20970461.0942074.08318861 4 4c.3604839.36048396.3882135.92771502.0831886 1.32000622l-.0831886.09420734-4 4.00000002c-.3905243.3905243-1.02368929.3905243-1.41421358 0-.36048396-.360484-.3882135-.927715-.08318861-1.3200062l.08318861-.0942074 3.29210678-3.2928932-3.29210678-3.29289322c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734c.36048396-.36048396.92771498-.3882135 1.32000618-.08318861zm-3.90579262.08318861c.36048396.36048396.3882135.92771502.08318861 1.32000622l-.08318861.09420734-3.29210678 3.29289322 3.29210678 3.2928932c.36048396.360484.3882135.927715.08318861 1.3200062l-.08318861.0942074c-.36048396.3604839-.92771502.3882135-1.32000622.0831886l-.09420734-.0831886-4-4.00000002c-.36048396-.36048396-.3882135-.92771502-.08318861-1.32000622l.08318861-.09420734 4-4c.39052429-.39052429 1.02368927-.39052429 1.41421356 0z"/></svg>',popup:{width:"100%",title:"## blockcode.edit-code ##",form:{code:{type:"textarea",rows:"8"}},footer:{save:{title:"## blockcode.save ##",command:"blockcode.save",type:"primary"},cancel:{title:"## blockcode.cancel ##",close:!0}}}},init:function(){this.offset=!1},start:function(){this.app.control.add("blockcode",{icon:this.opts.blockcode.icon,command:"blockcode.edit",title:"## blockcode.edit-code ##",blocks:{all:!0,except:["variable"]}})},edit:function(){var t=this.app.block.get(),e=t.getOuterHtml();e=this.app.parser.unparse(e),t.isEditable()&&(this.offset=this.app.offset.get(t.getBlock()));var i=this.app.popup.create("code",this.opts.blockcode.popup);i.setData({code:e}),this.app.popup.open({focus:"code"}),this._buildInputHandle(i),this._buildCodemirror(i)},save:function(t){this.app.popup.close();var e=this.app.block.get(),i=this._getCode(t);if(""!==i){i=this.app.parser.parse(i,!1);var s=this.dom(i),a=this.app.create("block."+e.getType(),s);this.app.block.change(a),this.offset&&a.isEditable()&&this.app.offset.set(a.getBlock(),this.offset),this.offset=!1}},_getCode:function(t){var e=t.getData().code.trim();return this.app.codemirror.val(e)},_buildInputHandle:function(t){t.getInput("code").on("keydown",this.app.input.handleTextareaTab.bind(this))},_buildCodemirror:function(t){var e=t.getInput("code");this.app.codemirror.create({el:e,height:"200px",focus:!0}),this.app.popup.updatePosition()}}),ArticleEditor.add("plugin","buttonlink",{translations:{en:{buttonlink:{button:"Button"}}},defaults:{classname:!1},subscribe:{"popup.before.open":function(){if(!1!==this.opts.buttonlink.classname){var t=this.app.popup.getStack();"link"===t.getName()&&this._build(t)}}},make:function(){this.app.popup.close(),this.app.link.getLink().addClass(this.opts.buttonlink.classname)},unmake:function(){this.app.popup.close(),this.app.link.getLink().removeClass(this.opts.buttonlink.classname)},_build:function(t){var e=this.app.link.getLink();if(0!==e.length){var i=t.getItemsData(),s={title:"## buttonlink.button ##",command:"buttonlink.make"},a=this.app.utils.getObjectIndex(i,"unlink");this._hasClass(e)&&(s={title:"## buttonlink.button ##",command:"buttonlink.unmake",active:!0}),i=this.app.utils.insertToObject("buttonlink",s,i,a),t.setItemsData(i)}},_hasClass:function(t){for(var e=this.opts.buttonlink.classname.split(" "),i=0,s=0;s<e.length;s++)t.hasClass(e[s])&&i++;return i===e.length}}),ArticleEditor.add("plugin","carousel",{translations:{en:{carousel:{carousel:"Carousel",save:"Save",cancel:"Cancel",insert:"Insert"}}},defaults:{upload:!1,select:!1,name:"file",data:!1,multiple:!0},popups:{add:{title:"## carousel.carousel ##",width:"100%",footer:{insert:{title:"## carousel.insert ##",command:"carousel.insert",type:"primary"},cancel:{title:"## carousel.cancel ##",command:"popup.close"}}},edit:{title:"## carousel.carousel ##",width:"100%",footer:{save:{title:"## carousel.save ##",command:"carousel.save",type:"primary"},cancel:{title:"## carousel.cancel ##",command:"popup.close"}}}},start:function(){this.app.addbar.add("carousel",{title:"## carousel.carousel ##",icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z"/></svg>',command:"carousel.popup"})},popup:function(){var t=this.app.popup.add("slideshow",this.popups.add),e=t.getBody();this.$box=this.dom("<div>").addClass(this.prefix+"-slideshow-items"),e.append(this.$box),this.$upload=this.app.image.createUploadBox(this.opts.carousel.upload,e),this.app.image.createSelectBox(this.opts.carousel.select,e,"carousel.insertFromSelect"),t.open(),this._buildUpload(this.$upload,"carousel.insertByUpload")},edit:function(t,e){var i=this.app.popup.create("slideshow",this.popups.edit).getBody(),s=this.app.block.get().getBlock().find("img");this.$box=this.dom("<div>").addClass(this.prefix+"-slideshow-items"),i.append(this.$box),s.each((function(t){this._buildBoxItem(t.attr("src"))}).bind(this)),this.$upload=this.app.image.createUploadBox(this.opts.carousel.upload,i),this.app.image.createSelectBox(this.opts.carousel.select,i,"carousel.insertFromSelect"),this.app.popup.open({button:e}),this._buildUpload(this.$upload,"carousel.insertByUpload")},insertByUpload:function(t){for(var e in t)this._buildBoxItem(t[e].url)},insertFromSelect:function(t){t.preventDefault();var e=this.dom(t.target);this._buildBoxItem(e.attr("data-url"))},insert:function(){var t=this.app.create("block.bs-carousel");this.app.block.add({instance:t}),this.save()},save:function(){var t=this.app.block.get(),e=this.$box.find("img");if(0===e.length){t.remove(),this.app.popup.close();return}var i=t.getBlock(),s=i.find(".carousel-inner"),a=i.find(".carousel-indicators"),o=t.getId();a.html(""),s.html(""),e.each((function(t,e){var i=t.attr("src"),n=this.dom("<div>").addClass("carousel-item"),r=this.dom("<img>").addClass("d-block w-100").attr("src",i),l=this.dom("<li>").attr({"data-slide-to":e,"data-target":"#"+o});n.append(r),s.append(n),a.append(l)}).bind(this)),s.find(".carousel-item").first().addClass("active"),a.find("li").first().addClass("active"),this.app.popup.close()},_removeItem:function(t){this.dom(t.target).closest("."+this.prefix+"-slideshow-item").fadeOut((function(t){t.remove()}).bind(this))},_buildBoxItem:function(t){var e=this.dom("<span>").addClass(this.prefix+"-slideshow-item"),i=this.dom("<span>").addClass(this.prefix+"-upload-remove"),s=this.dom("<img>").attr("src",t);i.one("click",this._removeItem.bind(this)),e.append(s),e.append(i),this.$box.append(e)},_buildUpload:function(t,e){if(this.opts.carousel.upload){var i={box:!0,placeholder:this.lang.get("image.upload-new-placeholder"),url:this.opts.carousel.upload,name:this.opts.carousel.name,data:this.opts.carousel.data,multiple:this.opts.carousel.multiple,success:e,error:"image.error"};this.app.create("upload",t,i)}}}),ArticleEditor.add("plugin","clips",{translations:{en:{clips:{clips:"Clips"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m12.1666667 1c1.0193924 0 1.8333333.83777495 1.8333333 1.85714286v10.28571424c0 1.0193679-.8139409 1.8571429-1.8333333 1.8571429h-8.33333337c-1.01868744 0-1.83333333-.8379215-1.83333333-1.8571429v-10.28571424c0-1.01922137.81464589-1.85714286 1.83333333-1.85714286zm-.1666667 2h-8v10h8zm-2 7c.5522847 0 1 .4477153 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-4c-.55228475 0-1-.4477153-1-1 0-.5128358.38604019-.9355072.88337887-.9932723l.11662113-.0067277zm0-3c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773zm0-3c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z"/></svg>',items:!1},start:function(){this.opts.clips.items&&this.app.toolbar.add("clips",{title:"## clips.clips ##",icon:this.opts.clips.icon,command:"clips.popup",blocks:{all:"editable"}})},popup:function(t,e){var i={};for(var s in this.opts.clips.items)i[s]={title:this.opts.clips.items[s].title,command:"clips.insert"};this.app.popup.create("clips",{items:i}),this.app.popup.open({button:e})},insert:function(t,e,i){this.app.popup.close();var s=this.opts.clips.items[i].html;this.app.editor.insertContent({html:s})}}),ArticleEditor.add("plugin","counter",{translations:{en:{counter:{words:"words",chars:"chars"}}},subscribe:{"editor.change":function(){this._count()}},start:function(){this._count()},_count:function(){var t=0,e=0,i=0,s=this.app.$element.val();if(""!==(s=this._clean(s))){var a=s.split(/\s+/),o=s.match(/\s/g);t=a?a.length:0,i=o?o.length:0,e=s.replace(/\s+/g," ").length}var n={words:t,characters:e,spaces:i};this.app.broadcast("counter.count",n),this.app.statusbar.add("words",this.lang.get("counter.words")+": "+n.words),this.app.statusbar.add("chars",this.lang.get("counter.chars")+": "+n.characters)},_clean:function(t){return t=(t=(t=(t=(t=(t=t.replace(/<\/(.*?)>/gi," ")).replace(/<(.*?)>/gi,"")).replace(/\t/gi,"")).replace(/\n|\r/gi," ")).replace(/&nbsp;/g,"1")).trim(),t=this.app.utils.removeInvisibleChars(t)}}),ArticleEditor.add("plugin","definedlinks",{defaults:{items:!1},subscribe:{"popup.open":function(){if(!1!==this.opts.definedlinks.items){var t=this.app.popup.getStack();-1!==["link-create","link-edit"].indexOf(t.getName())&&this._build(t)}}},_build:function(t){this.stack=t;var e=t.getFormItem("text"),i=this.dom("<div>").addClass(this.prefix+"-form-item");this.$select=this._create(),i.append(this.$select),e.before(i)},_change:function(t){var e=this.dom(t.target).val(),i=this.opts.definedlinks.items[e],s=this.stack.getInput("text"),a=this.stack.getInput("url"),o=i.name,n=i.url;!1===i.url&&(n="",o=""),s.val(o),a.val(n)},_create:function(){var t=this.opts.definedlinks.items,e=this.dom("<select>").addClass(this.prefix+"-form-select");e.on("change",this._change.bind(this));for(var i=0;i<t.length;i++){var s=t[i],a=this.dom("<option>");a.val(i),a.html(s.name),e.append(a)}return e}}),ArticleEditor.add("plugin","filelink",{translations:{en:{filelink:{file:"File",upload:"Upload",title:"Title",choose:"Choose",placeholder:"Drag to upload a file<br>or click to select"}}},defaults:{states:!0,classname:!1,upload:!1,select:!1,name:"file",data:!1,icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m14 9c.5128358 0 .9355072.38604019.9932723.88337887l.0067277.11662113v3.2c0 .9600523-.7638671 1.7205052-1.7068479 1.7941504l-.150295.0058496h-10.28571424c-.96021508 0-1.77209294-.7124503-1.85088019-1.6501425l-.00626267-.1498575v-3.2c0-.55228475.44771525-1 1-1 .51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v3h10v-3c0-.51283584.3860402-.93550716.8833789-.99327227zm-6-8c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6h1.5c.1573787 0 .3055728.07409708.4.2.1656854.2209139.1209139.53431458-.1.7l-2.5 1.875c-.17777778.1333333-.42222222.1333333-.6 0l-2.5-1.875c-.12590292-.09442719-.2-.24262135-.2-.4 0-.27614237.22385763-.5.5-.5h1.5v-6c0-.55228475.44771525-1 1-1z"/></svg>'},subscribe:{"editor.load, editor.build":function(){this.observeStates()}},popups:{create:{title:"## filelink.upload ##",width:"400px",form:{title:{type:"input",label:"## filelink.title ##"},file:{}}},choose:{collapse:!1,title:"## filelink.choose ##",width:"400px"}},init:function(){this.dataStates=[]},start:function(){this._is()&&this.app.toolbar.add("file",{title:"## filelink.file ##",icon:this.opts.filelink.icon,command:"filelink.popup",blocks:{all:"editable",except:["code"]},position:{after:"link"}})},popup:function(t,e){var i="create";if(this.opts.filelink.upload){i="add";var s=this.app.selection.getText();this.app.popup.create("file",this._buildPopupUpload(this.popups.create)).setData({title:s})}if(this.opts.filelink.select){var a=this.app.popup[i]("file-select",this.popups.choose);this.$sbox=a.getBody(),"string"==typeof this.opts.filelink.select?this.ajax.get({url:this.opts.filelink.select,success:this._parseList.bind(this)}):this._parseList.apply(this,[this.opts.filelink.select])}this.app.popup.open({button:e})},insertByUpload:function(t){this.app.popup.close();var e=this.app.popup.getData();this._insert(t,e.title)},insertBySelect:function(t){t.preventDefault(),this.app.popup.close();var e=this.app.selection.getText(),i=JSON.parse(decodeURI(this.dom(t.target).closest("."+this.prefix+"-popup-list-item").attr("data-params")));this._insert({file:i},e,!0)},error:function(t){this.app.broadcast("file.upload.error",{response:t})},observeStates:function(){this._findFiles().each(this._addFileState.bind(this))},getStates:function(){var t=this._findFiles();for(var e in this.dataStates){var i=this.dataStates[e],s=t.is('[data-file="'+i.id+'"]');this._setFileState(i.id,s)}return this.dataStates},_is:function(){return this.opts.filelink.upload||this.opts.filelink.select},_insert:function(t,e,i){for(var s in t){var a=this._createFileAndStore(t[s],e),o=i?"select":"upload";this.app.broadcast("file."+o,{response:t,$el:a});break}},_buildPopupUpload:function(t){return t.form.file={type:"upload",upload:{type:"file",box:!0,placeholder:this.lang.get("filelink.placeholder"),url:this.opts.filelink.upload,name:this.opts.filelink.name,data:this.opts.filelink.data,multiple:!1,success:"filelink.insertByUpload",error:"filelink.error"}},t},_findFiles:function(){return this.app.editor.getLayout().find("[data-file]")},_addFileState:function(t){var e=t.attr("data-file");this.dataStates[e]={type:"file",status:!0,url:t.attr("src"),$el:t,id:e}},_setFileState:function(t,e){this.dataStates[t].status=e},_parseList:function(t){var e=this.dom("<ul>");for(var i in e.addClass(this.prefix+"-popup-list"),t){var s=t[i];if("object"==typeof s){var a=this.dom("<li>"),o=this.dom("<span>");a.append(o),o.addClass(this.prefix+"-popup-list-item"),o.attr("data-params",encodeURI(JSON.stringify(s))),o.text(s.title||s.name);var n=this.dom("<span>");n.addClass(this.prefix+"-popup-list-aside"),n.text(s.name),a.append(n);var r=this.dom("<span>");r.addClass(this.prefix+"-popup-list-aside"),r.text("("+s.size+")"),a.append(r),a.on("click",this.insertBySelect.bind(this)),e.append(a)}}this.$sbox.append(e)},_createFileAndStore:function(t,e){var i=this.app.inline.set({tag:"a",caret:"after"}),s=this.dom(i);return s.attr("href",t.url),s.attr("data-file",t.id?t.id:this.app.utils.getRandomId()),s.attr("data-name",t.name),this.opts.filelink.classname&&s.addClass(this.opts.filelink.classname),e=e&&""!==e?e:this._truncateUrl(t.name),s.html(e),s},_truncateUrl:function(t){return -1!==t.search(/^http/)&&t.length>20?t.substring(0,20)+"...":t}}),ArticleEditor.add("plugin","fontsize",{translations:{en:{fontsize:{title:"Text size",remove:"Remove text size"}}},init(){this.sizes=this.opts.fontsize?this.opts.fontsize:["10px","11px","12px","14px","16px","18px","20px","24px","28px","30px"]},start(){this.app.toolbar.add("fontsize",{title:"## fontsize.title ##",icon:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.33667 3.33336C1.33667 2.87496 1.70827 2.50336 2.16667 2.50336H10.8333C11.2917 2.50336 11.6633 2.87496 11.6633 3.33336V4.66669C11.6633 5.12509 11.2917 5.49669 10.8333 5.49669C10.3749 5.49669 10.0033 5.12509 10.0033 4.66669V4.16336H7.66334V11.8367H8.16667C8.62507 11.8367 8.99667 12.2083 8.99667 12.6667C8.99667 13.1251 8.62507 13.4967 8.16667 13.4967H5.5C5.04161 13.4967 4.67 13.1251 4.67 12.6667C4.67 12.2083 5.04161 11.8367 5.5 11.8367H6.00334V4.16336H2.99667V4.66669C2.99667 5.12509 2.62507 5.49669 2.16667 5.49669C1.70827 5.49669 1.33667 5.12509 1.33667 4.66669V3.33336ZM9.33667 8.00002C9.33667 7.54163 9.70827 7.17002 10.1667 7.17002H14.1667C14.6251 7.17002 14.9967 7.54163 14.9967 8.00002V8.66669C14.9967 9.12509 14.6251 9.49669 14.1667 9.49669C13.7642 9.49669 13.4286 9.2102 13.3527 8.83002H12.9967V11.8528C13.3768 11.9286 13.6633 12.2642 13.6633 12.6667C13.6633 13.1251 13.2917 13.4967 12.8333 13.4967H11.5C11.0416 13.4967 10.67 13.1251 10.67 12.6667C10.67 12.2642 10.9565 11.9286 11.3367 11.8528V8.83002H10.9806C10.9047 9.2102 10.5692 9.49669 10.1667 9.49669C9.70827 9.49669 9.33667 9.12509 9.33667 8.66669V8.00002Z"/></svg>',blocks:{all:"editable",except:["code"]},command:"fontsize.popup"})},popup(t,e){let i={};for(let t=0;t<this.sizes.length;t++){let e=this.sizes[t],s={tag:"span",style:{"font-size":e}},a={title:e,command:"inline.set",params:s};i[t]=a}i.remove={title:"## fontsize.remove ##",divider:"top",command:"fontsize.remove"},this.app.popup.create("fontsize",{items:i}),this.app.popup.open({button:e})},remove(){this.app.popup.close(),this.app.inline.remove({style:"font-size"})}}),ArticleEditor.add("plugin","fontfamily",{translations:{en:{fontfamily:{title:"Font",remove:"Remove font family"}}},init(){this.fonts=this.opts.fontfamily?this.opts.fontfamily:["Arial","Helvetica","Georgia","Times New Roman","Monospace"]},start(){this.app.toolbar.add("fontfamily",{title:"## fontfamily.title ##",icon:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.05618 2.37524C7.17767 2.05129 7.48736 1.83667 7.83334 1.83667H9.16667C9.49643 1.83667 9.79491 2.03188 9.92708 2.33399L14.3762 12.5033H14.5C14.9584 12.5033 15.33 12.8749 15.33 13.3333C15.33 13.7917 14.9584 14.1633 14.5 14.1633H13.8524C13.8399 14.1636 13.8275 14.1636 13.8152 14.1633H11.1855C11.1732 14.1636 11.1609 14.1636 11.1486 14.1633H9.83334C9.37494 14.1633 9.00334 13.7917 9.00334 13.3333C9.00334 12.8749 9.37494 12.5033 9.83334 12.5033H9.91398L9.20556 10.83H5.65853L5.03103 12.5033H5.16667C5.62507 12.5033 5.99667 12.8749 5.99667 13.3333C5.99667 13.7917 5.62507 14.1633 5.16667 14.1633H3.85246C3.83966 14.1636 3.82682 14.1636 3.81397 14.1633H3.16667C2.70827 14.1633 2.33667 13.7917 2.33667 13.3333C2.33667 12.8749 2.70827 12.5033 3.16667 12.5033H3.25815L7.05618 2.37524ZM6.28103 9.17H8.50278L7.32462 6.38709L6.28103 9.17ZM8.17134 4.12916L11.7166 12.5033H12.5643L8.62384 3.49667H8.40853L8.17134 4.12916Z"/></svg>',blocks:{all:"editable",except:["code"]},command:"fontfamily.popup"})},popup(t,e){let i={};for(let t=0;t<this.fonts.length;t++){let e=this.fonts[t],s={title:e.replace(/'/g,""),command:"inline.set",params:{tag:"span",style:{"font-family":e}}};i[t]=s}i.remove={title:"## fontfamily.remove ##",divider:"top",command:"fontfamily.remove"},this.app.popup.create("fontfamily",{items:i}),this.app.popup.open({button:e})},remove(){this.app.popup.close(),this.app.inline.remove({style:"font-family"})}}),ArticleEditor.add("plugin","fontcolor",{translations:{en:{fontcolor:{title:"Text color",remove:"Remove color",text:"Text",background:"Background"}}},init(){this.colors=this.opts.fontcolor?this.opts.fontcolor:{gray:["#212529","#343a40","#495057","#868e96","#adb5bd","#ced4da","#dee2e6","#e9ecef","#f1f3f5","#f8f9fa"],red:["#c92a2a","#e03131","#f03e3e","#fa5252","#ff6b6b","#ff8787","#ffa8a8","#ffc9c9","#ffe3e3","#fff5f5"],pink:["#a61e4d","#c2255c","#d6336c","#e64980","#f06595","#f783ac","#faa2c1","#fcc2d7","#ffdeeb","#fff0f6"],grape:["#862e9c","#9c36b5","#ae3ec9","#be4bdb","#cc5de8","#da77f2","#e599f7","#eebefa","#f3d9fa","#f8f0fc"],violet:["#5f3dc4","#6741d9","#7048e8","#7950f2","#845ef7","#9775fa","#b197fc","#d0bfff","#e5dbff","#f3f0ff"],indigo:["#364fc7","#3b5bdb","#4263eb","#4c6ef5","#5c7cfa","#748ffc","#91a7ff","#bac8ff","#dbe4ff","#edf2ff"],blue:["#1864ab","#1971c2","#1c7ed6","#228be6","#339af0","#4dabf7","#74c0fc","#a5d8ff","#d0ebff","#e7f5ff"],cyan:["#0b7285","#0c8599","#1098ad","#15aabf","#22b8cf","#3bc9db","#66d9e8","#99e9f2","#c5f6fa","#e3fafc"],teal:["#087f5b","#099268","#0ca678","#12b886","#20c997","#38d9a9","#63e6be","#96f2d7","#c3fae8","#e6fcf5"],green:["#2b8a3e","#2f9e44","#37b24d","#40c057","#51cf66","#69db7c","#8ce99a","#b2f2bb","#d3f9d8","#ebfbee"],lime:["#5c940d","#66a80f","#74b816","#82c91e","#94d82d","#a9e34b","#c0eb75","#d8f5a2","#e9fac8","#f4fce3"],yellow:["#e67700","#f08c00","#f59f00","#fab005","#fcc419","#ffd43b","#ffe066","#ffec99","#fff3bf","#fff9db"],orange:["#d9480f","#e8590c","#f76707","#fd7e14","#ff922b","#ffa94d","#ffc078","#ffd8a8","#ffe8cc","#fff4e6"]}},start(){this.app.toolbar.add("fontcolor",{title:"## fontcolor.title ##",color:!0,icon:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.50002 4.16336C8.18972 4.16336 7.89213 4.28662 7.67271 4.50604C7.45329 4.72546 7.33002 5.02305 7.33002 5.33336V6.50336H9.67002V5.33336C9.67002 5.02305 9.54676 4.72546 9.32734 4.50604C9.10792 4.28662 8.81033 4.16336 8.50002 4.16336ZM11.33 5.33336C11.33 4.58279 11.0319 3.86297 10.5011 3.33224C9.97041 2.80152 9.25059 2.50336 8.50002 2.50336C7.74946 2.50336 7.02964 2.80152 6.49891 3.33224C5.96818 3.86297 5.67002 4.58279 5.67002 5.33336V10C5.67002 10.4584 6.04163 10.83 6.50002 10.83C6.95842 10.83 7.33002 10.4584 7.33002 10V8.16336H9.67002V10C9.67002 10.4584 10.0416 10.83 10.5 10.83C10.9584 10.83 11.33 10.4584 11.33 10V5.33336ZM3.00336 12.6667C3.00336 12.2083 3.37496 11.8367 3.83336 11.8367H13.1667C13.6251 11.8367 13.9967 12.2083 13.9967 12.6667C13.9967 13.1251 13.6251 13.4967 13.1667 13.4967H3.83336C3.37496 13.4967 3.00336 13.1251 3.00336 12.6667Z"/></svg>',blocks:{all:"editable",except:["code"]},command:"fontcolor.popup"})},popup(t,e){let i=this.app.selection.getNodes({type:"inline"});if(this.currentColor=!1,this.currentBackgroundColor=!1,i){let t=this.dom(i[0]),e=this.app.utils.cssToObject(t.attr("style"));this.currentColor=e.color?e.color:this.currentColor,this.currentBackgroundColor=e.background?e.background:this.currentBackgroundColor}let s=this.dom('<div class="'+this.prefix+'-dropdown-cells">');this.$selector=this._buildSelector(),this.$selectorText=this._buildSelectorItem("text",this.lang.get("fontcolor.text")),this.$selectorText.addClass("active"),this.$selectorBack=this._buildSelectorItem("back",this.lang.get("fontcolor.background")),this.$selector.append(this.$selectorText),this.$selector.append(this.$selectorBack),this.$pickerText=this._buildPicker("textcolor"),this.$pickerBack=this._buildPicker("backcolor");let a=20*Object.keys(this.colors).length;s.append(this.$selector),s.append(this.$pickerText),s.append(this.$pickerBack),s.width(a),this._buildSelectorEvents(),this.app.popup.create("fontcolor",{width:a+"px",html:s}),this.app.popup.open({button:e})},_remove(t){this.app.popup.close(),this.app.inline.remove("color"===t?{style:"color"}:{style:"background"})},_buildSelector(){let t=this.dom("<div>");return t.addClass(this.prefix+"-dropdown-selector"),t},_buildSelectorItem(t,e){let i=this.dom("<span>");return i.attr("rel",t).html(e),i.addClass(this.prefix+"-dropdown-not-close"),i},_buildSelectorEvents(){this.$selectorText.on("click",(function(t){t.preventDefault(),this.$selector.find("span").removeClass("active"),this.$pickerBack.hide(),this.$pickerText.show(),this.$selectorText.addClass("active")}).bind(this)),this.$selectorBack.on("click",(function(t){t.preventDefault(),this.$selector.find("span").removeClass("active"),this.$pickerText.hide(),this.$pickerBack.show(),this.$selectorBack.addClass("active")}).bind(this))},_buildPicker(t){var e=this.dom('<div class="'+this.prefix+"-dropdown-box-"+t+'">'),i=this.dom('<div class="'+this.prefix+'-form-colors-box">'),s="backcolor"==t?"background":"color";this.colors.length;var a=this;for(let[t,e]of Object.entries(this.colors)){for(var o=this.dom('<div class="'+this.prefix+'-form-colors">'),n=0;n<e.length;n++){var r=e[n],l=this.dom('<a href="#">');l.attr({rel:r,"data-rule":s}),l.css({"background-color":r,"font-size":0,width:"20px",height:"20px"}),l.on("click",(function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target);let i=e.attr("rel"),s={tag:"span",style:"color"===e.data("rule")?{color:i}:{background:i}};this.app.event.trigger=!1,this.app.inline.set(s),setTimeout((function(){this.app.event.trigger=!0}).bind(this),100)}).bind(this)),"color"===s&&this.currentColor===r&&l.addClass("active"),"background"===s&&this.currentBackgroundColor===r&&l.addClass("active"),o.append(l)}i.append(o)}e.append(i);var p=this.dom("<div>").addClass(this.prefix+"-dropdown-remove-item"),h=this.dom("<a>");return h.attr({href:"#"}),h.html(this.lang.get("fontcolor.remove")),h.on("click",function(t){t.preventDefault(),a._remove(s)}),p.append(h),e.append(p),"backcolor"==t&&e.hide(),e}}),ArticleEditor.add("plugin","handle",{translations:{en:{handle:{handle:"Handle"}}},defaults:{url:!1,start:1,trigger:"@"},subscribe:{"editor.keydown":function(t){this._listen(t)},"editor.keyup":function(t){!1!==this.opts.handle.url&&this._handle(t)}},start:function(){this.handleLen=this.opts.handle.start},stop:function(){this._hide()},_handle:function(t){var e=t.get("e"),i=e.which,s=e.ctrlKey||e.metaKey,a=this.app.keycodes;if(i===a.ESC){this.app.selection.restore();return}i===a.DELETE||i===a.SPACE||i===a.SHIFT||s||-1!==[37,38,39,40].indexOf(i)||(i===a.BACKSPACE&&(this.handleLen=this.handleLen-2,this.handleLen<=this.opts.handle.start&&this._hide()),this._emit())},_listen:function(t){var e=t.get("e"),i=e.which,s=this.app.keycodes;if(this._isShown()&&i===s.ENTER){var a=this._getActiveItem();if(0===a.length){this._hideForce();return}e.preventDefault(),t.stop(),this._replace(e,a);return}if(this._isShown()&&(40===i||38===i)){e.preventDefault(),t.stop();var a=this._getActiveItem();if(0===a.length){var o=this._getFirstItem();this._setActive(o)}else 40===i?this._setNextActive(a):38===i&&this._setPrevActive(a)}},_getItems:function(){return this.$panel.find("."+this.prefix+"-panel-item")},_getActiveItem:function(){return this._getItems().filter(function(t){return t.hasClass("active")})},_getFirstItem:function(){return this._getItems().first()},_getLastItem:function(){return this._getItems().last()},_setActive:function(t){this._getItems().removeClass("active"),t.addClass("active");var e=t.outerHeight(),i=t.position().top,s=this.$panel.scrollTop(),a=i+2*e,o=this.$panel.outerHeight();this.$panel.scrollTop(a>s+o?a-o:i-e<s?i-e:s)},_setNextActive:function(t){var e=t.next();if(0!==e.length)this._setActive(e);else{var i=this._getFirstItem();this._setActive(i)}},_setPrevActive:function(t){var e=t.prev();if(0!==e.length)this._setActive(e);else{var i=this._getLastItem();this._setActive(i)}},_emit:function(){var t=RegExp("^"+this.opts.handle.trigger);this.handleStr=this.app.selection.getText("before",this.handleLen),this.handleStr2=this.app.selection.getText("before",this.handleLen+1),t.test(this.handleStr)&&(this.handleStr2&&" "===this.handleStr2[0]||""===this.handleStr2[0])&&(this.handleStr=this.handleStr.replace(this.opts.handle.trigger,""),this.handleLen++,this.handleLen-1>this.opts.handle.start&&this._load())},_isShown:function(){return this.$panel&&this.$panel.hasClass("open")},_load:function(){this.ajax.post({url:this.opts.handle.url,data:"handle="+this.handleStr,success:this._parse.bind(this)})},_parse:function(t){if(""===t||Array.isArray(t)&&0===t.length){this.$panel&&this.$panel.remove();return}var e="object"==typeof t?t:JSON.parse(t);this._build(e)},_build:function(t){for(var e in this.data=t,this.$panel=this.app.$body.find("."+this.prefix+"-panel"),0===this.$panel.length?(this.$panel=this.dom("<div>").addClass(this.prefix+"-panel"),this.app.$body.append(this.$panel)):this.$panel.html(""),this._stopEvents(),this._startEvents(),t){var i=this.dom("<div>").addClass(this.prefix+"-panel-item"),s=this.dom("<a>").attr("href","#");s.html(t[e].item),s.attr("data-key",e),s.on("click",this._replace.bind(this)),i.append(s),this.$panel.append(i)}var a=this.app.editor.getFrameRect(),o=this.app.selection.getPosition();this.$panel.addClass("open"),this.$panel.css({top:o.top+o.height+a.top+"px",left:o.left+a.left+"px"}),this.app.selection.save()},_replace:function(t,e){t.preventDefault(),t.stopPropagation();var i=(e?e.find("a"):this.dom(t.target)).attr("data-key"),s=this.data[i].replacement;this.app.marker.insert("start");var a=this.app.marker.find("start");if(!1!==a){var o=this.dom(a),n=a.previousSibling,r=n.textContent,l=RegExp(this.opts.handle.trigger+this.handleStr+"$");r=r.replace(l,""),n.textContent=r,o.before(s),this.app.selection.restoreMarker(),this._hide()}},_reset:function(){this.handleStr=!1,this.handleLen=this.opts.handle.start,this.$panel=!1},_hide:function(t){var e=!1,i=t&&t.which,s=this.app.keycodes;t?("click"===t.type||i===s.ESC||i===s.SPACE)&&(e=!0):e=!0,e&&this._hideForce()},_hideForce:function(){this.$panel&&this.$panel.remove(),this._reset(),this._stopEvents()},_startEvents:function(){var t="click."+this.prefix+"-plugin-handle keydown."+this.prefix+"-plugin-handle";this.app.$doc.on(t,this._hide.bind(this)),this.app.editor.getBody().on(t,this._hide.bind(this))},_stopEvents:function(){var t="."+this.prefix+"-plugin-handle";this.app.$doc.off(t),this.app.editor.getBody().off(t)}}),ArticleEditor.add("plugin","icons",{translations:{en:{icons:{icons:"Icons"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m4.83610557 5.032-3.97464639.56135882-.11503066.02273502c-.74344369.19074743-1.01211485 1.14559722-.43257233 1.69388798l2.85824938 2.70401818-.67299733 3.8119764-.01354998.1096265c-.05329246.7582459.7508858 1.3132977 1.45280081.9551391l3.5617465-1.818742 3.56345043 1.8187308.1008624.0450315c.7094575.2728097 1.4755032-.3337453 1.3384209-1.1097256l-.6737337-3.8120367 2.8592493-2.70401818.0806168-.08514687c.4956567-.58602276.1617639-1.52007291-.6282281-1.63147731l-3.976638-.56135764-1.7716142-3.48521534c-.37065902-.72902616-1.41208515-.72905169-1.78277991-.0000437zm2.664-.826 1.11796025 2.19736628.06151847.10474119c.15723483.23391009.4074375.39236473.69024457.43224609l2.43527674.34264644-1.741257 1.6488901-.08529699.09144393c-.18419657.22405591-.26337869.51926707-.2122058.80894091l.41775979 2.36372506-2.22848404-1.1365651-.1252676-.0535184c-.25574273-.0891979-.53905484-.0713624-.78377298.0535073l-2.22947541 1.1365762.4187491-2.36366475.01403221-.12426844c.0144621-.28970819-.09782698-.57400297-.31152431-.77617671l-1.742257-1.6488901 2.43601084-.34264762c.3231876-.04557858.60379519-.24600908.75173246-.53694239z"/></svg>',items:['<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m5.5 7.98901099c0-1.34799209.21516178-2.34981357.6454918-3.00549451.43033002-.65568093 1.04849324-.98351648 1.8545082-.98351648.86066004 0 1.49248432.32417258 1.8954918.97252747.4030075.64835489.6045082 1.65383934.6045082 3.01648352 0 1.35531813-.2168694 2.36263411-.65061475 3.02197801-.43374534.659344-1.05361619.989011-1.85963115.989011-.85382941 0-1.48223842-.3461504-1.8852459-1.0384615-.40300748-.6923112-.6045082-1.68314377-.6045082-2.97252751zm1.33196721 0c0 .89377736.09050456 1.58424665.2715164 2.07142861.18101183.4871819.47984764.7307692.89651639.7307692.40300748 0 .69842802-.223441.88627049-.6703297.18784247-.44688866.2817623-1.15750426.2817623-2.13186811 0-.88645132-.08879693-1.57142615-.26639345-2.05494506-.17759651-.4835189-.48155522-.72527472-.91188524-.72527472-.40983812 0-.70525866.22710395-.88627049.68131868-.18101184.45421473-.2715164 1.15384143-.2715164 2.0989011z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m5.93478261 10.7640449h1.59038901v-4.4382022l.17162472-.76404495-.54919909.66292135-1.01830663.68539326-.62929062-.84269663 2.60869565-2.06741573h.83524028v6.7640449h1.55606407v1.2359551h-4.56521739z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m10.3218527 6.07282913c0 .38095429-.0732376.76563765-.2197149 1.15406163-.14647741.38842397-.33254047.76937255-.55819481 1.14285714-.22565433.37348459-.47505801.73389182-.74821852 1.08123249-.27316052.34734067-.54037875.66666521-.80166271.95798321l-.62945368.4593837v.0560224l.85510688-.1568627h2.28028504v1.232493h-5v-.7507003c.1900247-.1867423.40379929-.4052275.64133017-.6554622.23753088-.2502346.47703759-.5154047.71852731-.79551817.24148973-.28011345.47703765-.56955967.70665083-.86834734.22961319-.29878768.43547019-.59943826.6175772-.90196079.18210701-.30252252.32660279-.59570352.43349169-.87955182.10688889-.28384829.16033254-.55275316.16033254-.80672269 0-.30625736-.09303153-.55835568-.27909739-.75630252-.18606585-.19794683-.4809956-.29691876-.8847981-.29691876-.25336627 0-.51266692.05041966-.77790974.1512605-.26524281.10084084-.48891437.22969109-.67102137.38655462l-.6175772-1.03081232c.30879014-.23903014.65914293-.43137182 1.05106888-.57703082.39192595-.14565899.85312482-.21848739 1.38361045-.21848739.34046093 0 .65320523.04481748.93824228.13445378.28503706.0896363.53048195.22035395.73634205.39215686.20586009.17180292.3681704.38655334.4869359.64425771.1187654.25770437.1781472.55835496.1781472.90196078z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m7.44047619 10.767507c.49206595 0 .8670622-.1232481 1.125-.3697479s.38690476-.54528302.38690476-.89635854c0-.42577244-.13491928-.73949479-.4047619-.94117647s-.69444155-.30252101-1.27380953-.30252101h-.85714285v-.77310924l1.44047619-1.8487395.67857143-.50420168-.94047619.10084034h-2v-1.232493h4.547619v.79551821l-1.67857139 2.11764706-.52380952.302521v.05602241l.5-.06722689c.27777917.02240908.54166542.08216572.79166667.17927171.25000125.097106.46825303.23716062.6547619.42016807.18650884.18300745.33531694.40896224.44642854.67787115.1111117.2689089.1666667.57889647.1666667.92997199 0 .44071182-.0773802.82166039-.2321429 1.14285709-.1547626.3211968-.36904621.5901017-.6428571.8067227-.27381089.2166211-.59325214.3772171-.95833333.4817928-.36508119.1045756-.75793441.1568627-1.17857143.1568627-.3492081 0-.7103156-.0298783-1.08333334-.0896359-.37301773-.0597575-.67460202-.1456577-.9047619-.257703l.41666667-1.2100841c.20635023.097106.43452256.1755366.68452381.2352941.25000125.0597576.52976035.0896359.83928571.0896359z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m10.5 9.78723404h-1.23595506v2.21276596h-1.35955056v-2.21276596h-3.40449438v-.83971631l3.56179775-4.94751773h1.20224719v4.6070922h1.23595506zm-2.59550562-2.91631205.1011236-.95319149h-.04494382l-.38202247.81702127-1.16853933 1.5319149-.56179775.43120567.71910112-.09078014h1.33707865z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m7.31818182 10.7114846c.52631842 0 .92902572-.1195133 1.20813397-.3585434.27910825-.2390302.41866029-.56769168.41866029-.98599442 0-.44818151-.16347524-.77684303-.49043063-.9859944-.32695538-.20915137-.79345789-.31372549-1.39952153-.31372549l-.94497607.03361345v-4.10084034h4.11483255v1.36694678h-2.77511963v1.51260504l.49043062-.04481793c.39075155.01493939.74361884.08216561 1.05861244.20168068s.58412966.28571322.80741627.49859944c.2232866.21288621.3947362.47058672.5143541.77310924.1196178.30252252.1794258.64052101.1794258 1.0140056 0 .44071182-.079744.82912995-.2392344 1.16526615-.1594905.3361361-.38078013.6162453-.66387565.8403361-.28309551.2240907-.61602679.3921563-.99880383.5042017-.38277703.1120454-.80143313.1680672-1.25598086.1680672-.35885347 0-.69975915-.0280109-1.02272727-.0840336s-.59609139-.1325859-.81937799-.2296919l.41866029-1.210084c.18341399.0746969.38476764.1325861.60406698.1736694s.48444821.0616247.79545455.0616247z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m10.5 9.46153846c0 .35897616-.0587601.69230614-.1762821 1.00000004-.1175219.3076938-.2831185.5750904-.49679482.8021978-.21367629.2271073-.47186459.4065927-.77457265.5384615-.30270807.1318688-.63568195.1978022-.99893163.1978022-.37037222 0-.71046853-.060439-1.02029914-.1813187s-.57870257-.3021966-.80662393-.543956c-.22792137-.2417595-.40598227-.5457857-.53418804-.9120879-.12820577-.36630224-.19230769-.79120641-.19230769-1.27472531 0-.72527835.10149471-1.38094945.30448718-1.96703297s.47720625-1.09706742.82264957-1.53296703c.34544332-.43589962.74786095-.78754445 1.20726496-1.05494506.45940401-.2674006.94551026-.4450545 1.45833333-.53296703l.30982906 1.13186813c-.35612713.05860835-.68375919.17216033-.98290598.34065934-.2991468.16849901-.56445753.3699622-.79594017.60439561-.23148264.2344334-.42734963.49633555-.58760684.78571428-.16025721.28937874-.27243558.58791055-.33653846.8956044.14245085-.1831511.32763419-.3388272.55555556-.46703297.22792136-.12820577.5128188-.19230769.85470085-.19230769.32051442 0 .61609551.05128154.88675214.15384615.27065662.10256462.50213579.25457775.69444444.45604396.19230866.20146621.34187976.44871648.44871796.74175824.1068381.29304176.1602564.63003473.1602564 1.01098901zm-1.34615385.07692308c0-.82051692-.39173397-1.23076923-1.17521367-1.23076923-.28490171 0-.52528392.0659334-.72115385.1978022-.19586992.13186879-.33297681.2857134-.41132478.46153846-.01424509.08058648-.02136753.15018285-.02136753.20879121v.17582417c0 .17582506.02492853.34981599.07478633.52197802s.12286277.32600663.21901709.46153843c.09615433.1355318.21901635.2454209.36858975.3296704.14957339.0842495.32763429.1263736.53418803.1263736.33475951 0 .60719268-.117215.81730769-.3516484s.31517094-.53479666.31517094-.90109886z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m5.98780488 12 2.53880266-6.16.48780488-.56-.66518847.11428571h-2.84922395v-1.39428571h5v.43428571l-3.10421286 7.56571429z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m5.5 9.96703297c0-.25641154.03363195-.48534698.10089686-.68681319s.16255544-.38461456.28587444-.54945055.26905746-.31318615.43721973-.44505494c.16816228-.1318688.34940112-.25274671.54372197-.36263737-.36622006-.22710736-.65396009-.4890095-.8632287-.78571428-.2092686-.29670478-.31390134-.66483297-.31390134-1.10439561 0-.28571571.05418481-.5531123.16255605-.8021978.10837125-.24908549.26532035-.46520055.47085202-.64835165s.45403442-.32600681.7455157-.42857143c.29148127-.10256461.62032701-.15384615.98654708-.15384615.33632455 0 .64274899.0439556.91928251.13186813s.51382562.21245341.71188341.37362638c.19805779.16117296.35126997.3571417.45964127.58791208.1083712.23077039.162556.4853466.162556.76373627 0 .43223659-.0990274.79853329-.2970852 1.0989011-.19805775.3003678-.48766622.57509033-.86883404.82417582.44843273.25641154.78662068.53846 1.01457394.84615385.2279534.30769384.3419283.70329428.3419283 1.18681318 0 .32967199-.0616586.62820379-.1849776.89560439s-.2970841.4963361-.52130043.6868132c-.22421636.1904771-.49327197.3388273-.80717488.4450549-.31390292.1062277-.65769619.1593407-1.03139014.1593407s-.71188189-.0494501-1.01457399-.1483516c-.3026921-.0989016-.56053705-.2362629-.7735426-.412088-.21300555-.175825-.37742842-.3882771-.49327354-.6373626-.11584513-.2490855-.17376682-.527471-.17376682-.83516483zm3.60986547-.14285715c0-.16849901-.04110572-.32234362-.12331838-.46153846-.08221267-.13919483-.18871385-.2655672-.31950673-.37912088s-.27653134-.21794824-.43721973-.31318681c-.1606884-.09523857-.32324283-.18681275-.48766816-.27472527-.35127231.19780318-.59230129.41208675-.72309417.64285714-.13079289.23077038-.19618834.45970582-.19618834.68681319 0 .29304177.10276429.54395497.30829596.75274727.20553167.2087922.49140325.3131868.85762332.3131868.33632455 0 .6072486-.0805853.81278027-.2417583.20553167-.1611729.30829596-.4029287.30829596-.72527468zm-2.02914798-3.76923077c0 .17582506.03363195.32966968.10089686.46153847s.15881855.24725225.27466368.34615384c.11584512.0989016.24663604.19047577.39237668.27472528.14574064.0842495.29708442.16300329.45403587.23626373.44843274-.37362824.67264574-.78388055.67264574-1.23076923 0-.30769384-.09155364-.54029225-.27466367-.69780219-.18311004-.15750995-.4054546-.23626374-.66704036-.23626374-.32885068 0-.56987966.08424824-.72309417.25274725-.15321452.16849901-.22982063.36629923-.22982063.59340659z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m8 14c3.3137085 0 6-2.6862915 6-6s-2.6862915-6-6-6-6 2.6862915-6 6 2.6862915 6 6 6zm0 2c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8z"/><path d="m5.5 6.56043956c0-.37362824.05473109-.71794714.16419492-1.03296703.10946382-.31501989.26836054-.58424797.47669491-.80769231.20833438-.22344434.46256912-.39926676.76271186-.52747253.30014275-.12820577.64441897-.19230769 1.03283899-.19230769.79802659 0 1.42478586.24725027 1.88029661.74175824.45551071.49450797.68326271 1.21428099.68326271 2.15934066 0 .8498211-.1041656 1.58424599-.3125 2.2032967-.20833437.61905072-.48728639 1.1355291-.83686441 1.5494506-.34957802.4139214-.75388188.7307681-1.21292373.9505494-.45904184.2197813-.94279406.3516481-1.45127118.3956044l-.29661017-1.1208791c.38842002-.0512823.73446176-.1501824 1.03813559-.2967033.30367384-.1465209.56497066-.3278378.78389831-.5439561.21892765-.21611826.39724507-.46153705.53495762-.7362637.13771256-.27472665.23481611-.56959549.29131356-.88461538-.16949237.19047714-.35134083.32234395-.54555084.39560439s-.45374132.10989011-.7786017.10989011c-.26836292 0-.5349563-.04761857-.79978813-.14285714-.26483184-.09523857-.50141139-.23992577-.70974577-.43406593-.20833437-.19414017-.3778242-.43955896-.50847457-.73626374s-.19597458-.64651813-.19597458-1.04945055zm1.33474576-.07692308c0 .41758451.11299322.73259967.33898305.94505495.22598983.21245527.50847288.31868132.84745763.31868132.28954947 0 .52612903-.04761857.70974576-.14285715.18361674-.09523857.32485827-.21245351.42372882-.35164835.02118654-.15384692.03177966-.3003656.03177966-.43956044 0-.20512923-.02471727-.40659241-.07415254-.6043956-.04943528-.19780319-.1253526-.37362561-.22775424-.52747253s-.23305005-.27655632-.39194915-.36813187-.34780964-.13736263-.56673729-.13736263c-.34604693 0-.61440583.11538346-.80508475.34615384-.19067892.23077039-.28601695.55128-.28601695.96153846z"/></g></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-8.01098901c0 1.28938374.20150072 2.28021631.6045082 2.97252751.40300748.6923111 1.03141649 1.0384615 1.8852459 1.0384615.80601496 0 1.42588581-.329667 1.85963115-.989011.43374535-.6593439.65061475-1.66665988.65061475-3.02197801 0-1.36264418-.2015007-2.36812863-.6045082-3.01648352-.40300748-.64835489-1.03483176-.97252747-1.8954918-.97252747-.80601496 0-1.42417818.32783555-1.8545082.98351648-.43033002.65568094-.6454918 1.65750242-.6454918 3.00549451zm1.33196721 0c0-.94505967.09050456-1.64468637.2715164-2.0989011.18101183-.45421473.47643237-.68131868.88627049-.68131868.43033002 0 .73428873.24175582.91188524.72527472.17759652.48351891.26639345 1.16849374.26639345 2.05494506 0 .97436385-.09391983 1.68497945-.2817623 2.13186811-.18784247.4468887-.48326301.6703297-.88627049.6703297-.41666875 0-.71550456-.2435873-.89651639-.7307692-.18101184-.48718196-.2715164-1.17765125-.2715164-2.07142861z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.06521739-5.2359551v1.2359551h4.56521739v-1.2359551h-1.55606407v-6.7640449h-.83524028l-2.60869565 2.06741573.62929062.84269663 1.01830663-.68539326.54919909-.66292135-.17162472.76404495v4.4382022z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.3218527-9.92717087c0-.34360582-.0593818-.64425641-.1781472-.90196078-.1187655-.25770437-.28107581-.47245479-.4869359-.64425771-.2058601-.17180291-.45130499-.30252056-.73634205-.39215686-.28503705-.0896363-.59778135-.13445378-.93824228-.13445378-.53048563 0-.9916845.0728284-1.38361045.21848739-.39192595.145659-.74227874.33800068-1.05106888.57703082l.6175772 1.03081232c.182107-.15686353.40577856-.28571378.67102137-.38655462.26524282-.10084084.52454347-.1512605.77790974-.1512605.4038025 0 .69873225.09897193.8847981.29691876.18606586.19794684.27909739.45004516.27909739.75630252 0 .25396953-.05344365.5228744-.16033254.80672269-.1068889.2838483-.25138468.5770293-.43349169.87955182-.18210701.30252253-.38796401.60317311-.6175772.90196079-.22961318.29878767-.4651611.58823389-.70665083.86834734-.24148972.28011347-.48099643.54528357-.71852731.79551817-.23753088.2502347-.45130547.4687199-.64133017.6554622v.7507003h5v-1.232493h-2.28028504l-.85510688.1568627v-.0560224l.62945368-.4593837c.26128396-.291318.52850219-.61064254.80166271-.95798321.27316051-.34734067.52256419-.7077479.74821852-1.08123249.22565434-.37348459.4117174-.75443317.55819481-1.14285714.1464773-.38842398.2197149-.77310734.2197149-1.15406163z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-.55952381-5.232493c-.30952536 0-.58928446-.0298783-.83928571-.0896359-.25000125-.0597575-.47817358-.1381881-.68452381-.2352941l-.41666667 1.2100841c.23015988.1120453.53174417.1979455.9047619.257703.37301774.0597576.73412524.0896359 1.08333334.0896359.42063702 0 .81349024-.0522871 1.17857143-.1568627.36508119-.1045757.68452244-.2651717.95833333-.4817928.27381089-.216621.4880945-.4855259.6428571-.8067227.1547627-.3211967.2321429-.70214527.2321429-1.14285709 0-.35107552-.055555-.66106309-.1666667-.92997199-.1111116-.26890891-.2599197-.4948637-.44642854-.67787115-.18650887-.18300745-.40476065-.32306207-.6547619-.42016807-.25000125-.09710599-.5138875-.15686263-.79166667-.17927171l-.5.06722689v-.05602241l.52380952-.302521 1.67857139-2.11764706v-.79551821h-4.547619v1.232493h2l.94047619-.10084034-.67857143.50420168-1.44047619 1.8487395v.77310924h.85714285c.57936798 0 1.00396691.10083933 1.27380953.30252101s.4047619.51540403.4047619.94117647c0 .35107552-.12896696.64985874-.38690476.89635854s-.63293405.3697479-1.125.3697479z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.5-6.21276596v-1.18014184h-1.23595506v-4.6070922h-1.20224719l-3.56179775 4.94751773v.83971631h3.40449438v2.21276596h1.35955056v-2.21276596zm-2.59550562-2.91631205v1.73617021h-1.33707865l-.71910112.09078014.56179775-.43120567 1.16853933-1.5319149.38202247-.81702127h.04494382z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-.68181818-5.2885154c-.31100634 0-.57615521-.0205414-.79545455-.0616247s-.42065299-.0989725-.60406698-.1736694l-.41866029 1.210084c.2232866.097106.49640987.1736692.81937799.2296919s.6638738.0840336 1.02272727.0840336c.45454773 0 .87320383-.0560218 1.25598086-.1680672.38277704-.1120454.71570832-.280111.99880383-.5042017.28309552-.2240908.50438515-.5042.66387565-.8403361.1594904-.3361362.2392344-.72455433.2392344-1.16526615 0-.37348459-.059808-.71148308-.1794258-1.0140056-.1196179-.30252252-.2910675-.56022303-.5143541-.77310924-.22328661-.21288622-.49242267-.37908437-.80741627-.49859944s-.66786089-.18674129-1.05861244-.20168068l-.49043062.04481793v-1.51260504h2.77511963v-1.36694678h-4.11483255v4.10084034l.94497607-.03361345c.60606364 0 1.07256615.10457412 1.39952153.31372549.32695539.20915137.49043063.53781289.49043063.9859944 0 .41830274-.13955204.74696422-.41866029.98599442-.27910825.2390301-.68181555.3585434-1.20813397.3585434z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm2.5-6.53846154c0-.38095428-.0534183-.71794725-.1602564-1.01098901-.1068382-.29304176-.2564093-.54029203-.44871796-.74175824-.19230865-.20146621-.42378782-.35347934-.69444444-.45604396-.27065663-.10256461-.56623772-.15384615-.88675214-.15384615-.34188205 0-.62677949.06410192-.85470085.19230769-.22792137.12820577-.41310471.28388187-.55555556.46703297.06410288-.30769385.17628125-.60622566.33653846-.8956044.16025721-.28937873.3561242-.55128088.58760684-.78571428.23148264-.23443341.49679337-.4358966.79594017-.60439561.29914679-.16849901.62677885-.28205099.98290598-.34065934l-.30982906-1.13186813c-.51282307.08791253-.99892932.26556643-1.45833333.53296703-.45940401.26740061-.86182164.61904544-1.20726496 1.05494506-.34544332.43589961-.6196571.94688351-.82264957 1.53296703s-.30448718 1.24175462-.30448718 1.96703297c0 .4835189.06410192.90842307.19230769 1.27472531.12820577.3663022.30626667.6703284.53418804.9120879.22792136.2417594.49679332.4230763.80662393.543956s.64992692.1813187 1.02029914.1813187c.36324968 0 .69622356-.0659334.99893163-.1978022.30270806-.1318688.56089636-.3113542.77457265-.5384615.21367632-.2271074.37927292-.494504.49679482-.8021978.117522-.3076939.1762821-.64102388.1762821-1.00000004zm-1.34615385.07692308c0 .3663022-.10505593.66666546-.31517094.90109886s-.48254818.3516484-.81730769.3516484c-.20655374 0-.38461464-.0421241-.53418803-.1263736-.1495734-.0842495-.27243542-.1941386-.36858975-.3296704-.09615432-.1355318-.16915929-.2893764-.21901709-.46153843s-.07478633-.34615296-.07478633-.52197802c0-.05860835 0-.11721582 0-.17582417 0-.05860836.00712244-.12820473.02136753-.20879121.07834797-.17582506.21545486-.32966967.41132478-.46153846.19586993-.1318688.43625214-.1978022.72115385-.1978022.7834797 0 1.17521367.41025231 1.17521367 1.23076923z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.01219512-4h1.40798226l3.10421286-7.56571429v-.43428571h-5v1.39428571h2.84922395l.66518847-.11428571-.48780488.56z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-6.03296703c0 .30769383.05792169.58607933.17376682.83516483.11584512.2490855.28026799.4615376.49327354.6373626.21300555.1758251.4708505.3131864.7735426.412088.3026921.0989015.64088004.1483516 1.01457399.1483516s.71748722-.053113 1.03139014-.1593407c.31390291-.1062276.58295852-.2545778.80717488-.4450549.22421633-.1904771.39798143-.4194126.52130043-.6868132s.1849776-.5659324.1849776-.89560439c0-.4835189-.1139749-.87911934-.3419283-1.18681318-.22795326-.30769385-.56614121-.58974231-1.01457394-.84615385.38116782-.24908549.67077629-.52380802.86883404-.82417582.1980578-.30036781.2970852-.66666451.2970852-1.0989011 0-.27838967-.0541848-.53296588-.162556-.76373627-.1083713-.23077038-.26158348-.42673912-.45964127-.58791208-.19805779-.16117297-.43534989-.28571385-.71188341-.37362638s-.58295796-.13186813-.91928251-.13186813c-.36622007 0-.69506581.05128154-.98654708.15384615-.29148128.10256462-.53998403.24542033-.7455157.42857143s-.36248077.39926616-.47085202.64835165c-.10837124.2490855-.16255605.51648209-.16255605.8021978 0 .43956264.10463274.80769083.31390134 1.10439561.20926861.29670478.49700864.55860692.8632287.78571428-.19432085.10989066-.37555969.23076857-.54372197.36263737-.16816227.13186879-.31390073.28021895-.43721973.44505494s-.21860953.34798434-.28587444.54945055-.10089686.43040165-.10089686.68681319zm3.60986547-.14285715c0 .32234598-.10276429.56410178-.30829596.72527468-.20553167.161173-.47645572.2417583-.81278027.2417583-.36622007 0-.65209165-.1043946-.85762332-.3131868-.20553167-.2087923-.30829596-.4597055-.30829596-.75274727 0-.22710737.06539545-.45604281.19618834-.68681319.13079288-.23077039.37182186-.44505396.72309417-.64285714.16442533.08791252.32697976.1794867.48766816.27472527.16068839.09523857.30642685.19963313.43721973.31318681s.23729406.23992605.31950673.37912088c.08221266.13919484.12331838.29303945.12331838.46153846zm-2.02914798-3.76923077c0-.22710736.07660611-.42490758.22982063-.59340659.15321451-.16849901.39424349-.25274725.72309417-.25274725.26158576 0 .48393032.07875379.66704036.23626374.18311003.15750994.27466367.39010835.27466367.69780219 0 .44688868-.224213.85714099-.67264574 1.23076923-.15695145-.07326044-.30829523-.15201423-.45403587-.23626373-.14574064-.08424951-.27653156-.17582368-.39237668-.27472528-.11584513-.09890159-.20739877-.21428505-.27466368-.34615384s-.10089686-.28571341-.10089686-.46153847z"/></svg>','<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 16c-4.418278 0-8-3.581722-8-8s3.581722-8 8-8 8 3.581722 8 8-3.581722 8-8 8zm-2.5-9.43956044c0 .40293242.06532421.75274577.19597458 1.04945055s.3001402.54212357.50847457.73626374c.20833438.19414016.44491393.33882736.70974577.43406593.26483183.09523857.53142521.14285714.79978813.14285714.32486038 0 .58439169-.03662967.7786017-.10989011s.37605847-.20512725.54555084-.39560439c-.05649745.31501989-.153601.60988873-.29131356.88461538-.13771255.27472665-.31602997.52014544-.53495762.7362637-.21892765.2161183-.48022447.3974352-.78389831.5439561-.30367383.1465209-.64971557.245421-1.03813559.2967033l.29661017 1.1208791c.50847712-.0439563.99222934-.1758231 1.45127118-.3956044.45904185-.2197813.86334571-.536628 1.21292373-.9505494.34957802-.4139215.62853004-.93039988.83686441-1.5494506.2083344-.61905071.3125-1.3534756.3125-2.2032967 0-.94505967-.227752-1.66483269-.68326271-2.15934066-.45551075-.49450797-1.08227002-.74175824-1.88029661-.74175824-.38842002 0-.73269624.06410192-1.03283899.19230769-.30014274.12820577-.55437748.30402819-.76271186.52747253-.20833437.22344434-.36723109.49267242-.47669491.80769231-.10946383.31501989-.16419492.65933879-.16419492 1.03296703zm1.33474576-.07692308c0-.41025846.09533803-.73076807.28601695-.96153846.19067892-.23077038.45903782-.34615384.80508475-.34615384.21892765 0 .40783819.04578708.56673729.13736263s.28954751.21428495.39194915.36813187.17831896.32966934.22775424.52747253c.04943527.19780319.07415254.39926637.07415254.6043956 0 .13919484-.01059312.28571352-.03177966.43956044-.09887055.13919484-.24011208.25640978-.42372882.35164835-.18361673.09523858-.42019629.14285715-.70974576.14285715-.33898475 0-.6214678-.10622605-.84745763-.31868132-.22598983-.21245528-.33898305-.52747044-.33898305-.94505495z"/></svg>']},start:function(){this.app.toolbar.add("icons",{title:"## icons.icons ##",icon:this.opts.icons.icon,command:"icons.popup",blocks:{all:"editable",except:["code"]}})},popup:function(t,e){for(var i={},s=this.opts.icons.items,a=0;a<s.length;a++)i[a]={html:this.dom("<div>").addClass(this.prefix+"-popup-item").html(s[a]),command:"icons.insert",params:{icon:s[a]}};this.app.popup.create("icons",{type:"grid",width:"160px",items:i}),this.app.popup.open({button:e})},insert:function(t){this.app.popup.close(),this.app.insertion.insertHtml(t.icon,"after")}}),ArticleEditor.add("plugin","imageposition",{translations:{en:{imageposition:{"image-position":"Image position"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m15 13c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-13c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm-5-12c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .44771525 1 1 0 .5522847-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1 0-.55228475.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z"/></svg>',items:{none:"none",left:"float-left",center:"align-center",right:"float-right"},icons:{none:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-5 7-1 1h2zm4-5h-6v5l2-2 3 3h1zm-2 1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z"/></svg>',left:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m10 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm5 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.4477153-1-1s.4477153-1 1-1zm-10-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm6 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1zm-8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-2c-.5522847 0-1-.44771525-1-1s.4477153-1 1-1z"/></svg>',center:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m12 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm3 8c.5522847 0 1 .4477153 1 1s-.4477153 1-1 1-1-.4477153-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1-1-.4477153-1-1 .44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm4 2c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm8-1c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1zm6-3c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-14 0c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1-1-.44771525-1-1 .44771525-1 1-1z"/></svg>',right:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m14 3c.5522847 0 1 .44771525 1 1v8c0 .5522847-.4477153 1-1 1h-8c-.55228475 0-1-.4477153-1-1v-8c0-.55228475.44771525-1 1-1zm-11 8c.55228475 0 1 .4477153 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.4477153-1-1s.44771525-1 1-1zm6-1-1 1h2zm4-5h-6v5l2-2 3 3h1zm-10 2c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1zm8-1c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1-1-.44771525-1-1 .4477153-1 1-1zm-8-3c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-2c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z"/></svg>'}},start:function(){this.app.toolbar.add("imageposition",{title:"## imageposition.image-position ##",command:"imageposition.popup",icon:this.opts.imageposition.icon,blocks:{types:["image"]}})},popup:function(t,e){var i={},s=this.opts.imageposition.items;for(var a in s)s[a]&&(i[a]={name:s[a],icon:this.opts.imageposition.icons[a]});this.app.popup.create("imageposition",{setter:"imageposition.setFloat",getter:"imageposition.getFloat",form:{ifloat:{type:"segment",label:"## imageposition.image-position ##",segments:i}}}),this.app.popup.open({button:e})},getFloat:function(){var t=this.opts.imageposition.items;if(!t)return!1;var e=this.app.block.get().getBlock(),i="none";for(var s in t)e.hasClass(t[s])&&(i=s);return{ifloat:i}},setFloat:function(t){this.app.popup.close();var e=t.getData();this.app.block.get().setClassFromObj(this.opts.imageposition.items,e.ifloat)}}),ArticleEditor.add("plugin","imageresize",{translations:{en:{imageresize:{"image-resize":"Image resize"}}},defaults:{minHeight:20,minWidth:100,zIndex:97},subscribe:{"editor.blur, editor.select":function(){this.stop()},"image.position":function(){this._setResizerPosition()},"editor.unparse, editor.before.cut, editor.before.copy":function(t){this._unparse(t)},"block.set":function(t){this._load()}},stop:function(){this._remove(),this._stopEvents()},_load:function(){var t=this.app.block.get();this._remove(),t.isType("image")&&this._build(t)},_build:function(t){this.$block=t.getBlock(),this.$image=t.getImage(),this.$resizer=this.dom("<span>"),this.$resizer.attr("id",this.prefix+"-image-resizer"),this.$resizer.css({position:"absolute","z-index":this.opts.imageresize.zIndex,"background-color":"#007dff",width:"15px",height:"15px","border-radius":"8px","font-size":"0",border:"2px solid #fff",cursor:"ew-resize"}),this.$image.after(this.$resizer),this._setResizerPosition(),setTimeout(this._setResizerPosition.bind(this),30),this.$resizer.on("mousedown touchstart",this._press.bind(this))},_setResizerPosition:function(){var t=this.$image.position(),e=this.$image.width(),i=this.$image.height(),s=this.$resizer.width(),a=this.$resizer.height();this.$resizer.css({top:Math.round(t.top+i/2-a+9)+"px",left:Math.round(t.left+e-s+9)+"px"})},_press:function(t){t.preventDefault();var e=this.$image.height(),i=this.$image.width();this.resizeHandle={x:t.pageX,y:t.pageY,el:this.$image,$figure:this.$image.closest("figure"),ratio:i/e,h:e,w:i},this.app.editor.getDoc().on("mousemove."+this.prefix+".image-resize touchmove."+this.prefix+".image-resize",this._move.bind(this)),this.app.editor.getDoc().on("mouseup."+this.prefix+".image-resize touchend."+this.prefix+".image-resize",this._release.bind(this)),this.app.$doc.on("mouseup."+this.prefix+".image-resize touchend."+this.prefix+".image-resize",this._release.bind(this)),this.app.broadcast("image.resize.start",{e:t,block:this.$block,image:this.$image})},_move:function(t){t.preventDefault();var e=this._getWidth(t),i=e/this.resizeHandle.ratio,s=this.resizeHandle.el,a=this.opts.imageresize;i=Math.round(i),e=Math.round(e),i<a.minHeight||e<a.minWidth||this._getResizableBoxWidth()<=e||(0!==this.resizeHandle.$figure.length&&""!==this.resizeHandle.$figure.css("max-width")&&this.resizeHandle.$figure.css("max-width",e+"px"),s.attr({width:e,height:i}),this._setResizerPosition(),this.app.broadcast("image.resize.move",{e:t,block:this.$block,image:this.$image}))},_release:function(t){this._stopEvents(),this.app.broadcast("image.resize.stop",{e:t,block:this.$block,image:this.$image})},_stopEvents:function(){this.app.editor.getDoc().off("."+this.prefix+".image-resize"),this.app.$doc.off("."+this.prefix+".image-resize")},_remove:function(){this.app.editor.getLayout().find("#"+this.prefix+"-image-resizer").remove()},_getWidth:function(t){var e=this.resizeHandle.w;return t.targetTouches?e+=t.targetTouches[0].pageX-this.resizeHandle.x:e+=t.pageX-this.resizeHandle.x,e},_getResizableBoxWidth:function(){var t=this.app.editor.getLayout();return t.width()-parseInt(t.css("padding-left"))-parseInt(t.css("padding-right"))},_unparse:function(t){var e=t.get("html");e=this.app.utils.wrap(e,(function(t){t.find("#"+this.prefix+"-image-resizer").remove()}).bind(this)),t.set("html",e)}}),ArticleEditor.add("plugin","inlineformat",{translations:{en:{inlineformat:{"inline-format":"Inline Format",underline:"Underline",superscript:"Superscript",subscript:"Subscript",mark:"Mark",code:"Code",shortcut:"Shortcut","remove-format":"Remove Format"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m7.39849577 1.20113038c-3.5610278 2.68125517-5.39849577 5.14152807-5.39849577 7.49360646 0 3.50902886 2.59345039 6.30526316 6 6.30526316 3.4065496 0 6-2.7962343 6-6.30526316 0-2.35207839-1.837468-4.81235129-5.39849577-7.49360646-.35616697-.26817384-.84684149-.26817384-1.20300846 0zm.60150423 2.06186962.28200813.22720401c2.50634097 2.04313256 3.71799187 3.80538426 3.71799187 5.20453283 0 2.43669386-1.73306 4.30526316-4 4.30526316-2.26694005 0-4-1.8685693-4-4.30526316 0-1.39914857 1.21165095-3.16140027 3.71799187-5.20453283z"/></svg>',items:["u","sup","sub","mark","code","kbd"],itemsObj:{u:{title:'<span style="text-decoration: underline;">## inlineformat.underline ##</span>',params:{tag:"u"},shortcut:"Ctrl+u"},sup:{title:"## inlineformat.superscript ##<sup>x</sup>",params:{tag:"sup"},shortcut:"Ctrl+h"},sub:{title:"## inlineformat.subscript ##<sub>x</sub>",params:{tag:"sub"},shortcut:"Ctrl+l"},mark:{title:'<span style="background: yellow;">## inlineformat.mark ##</span>',params:{tag:"mark"}},code:{title:'<span style="font-family: monospace; background: #f0f1f2; padding: 4px;">## inlineformat.code ##</span>',params:{tag:"code"}},kbd:{title:"## inlineformat.shortcut ##",params:{tag:"kbd"}}}},start:function(){this.app.toolbar.add("inlineformat",{title:"## inlineformat.inline-format ##",icon:this.opts.inlineformat.icon,position:{after:"deleted"},blocks:{all:"editable",except:["code"]},command:"inlineformat.popup"})},popup:function(t,e){for(var i=this.opts.inlineformat.items,s=this.app.selection.getNodes({type:"inline"}),a={},o=0;o<i.length;o++){var n=i[o];a[n]=this.opts.inlineformat.itemsObj[n],a[n].command="inline.set"}0!==s.length&&(a.remove={title:"## inlineformat.remove-format ##",divider:"top",command:"inline.removeFormat"}),this.app.popup.create("inlineformat",{width:"300px",items:a}),this.app.popup.open({button:e})}}),ArticleEditor.add("plugin","makebutton",{translations:{en:{makebutton:{"make-a-button":"Make a Button","remove-button":"Remove button",button:"Button"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m13 3c1.6568542 0 3 1.34314575 3 3v4c0 1.6568542-1.3431458 3-3 3h-10c-1.65685425 0-3-1.3431458-3-3v-4c0-1.65685425 1.34314575-3 3-3zm0 2h-10c-.55228475 0-1 .44771525-1 1v4c0 .5522847.44771525 1 1 1h10c.5522847 0 1-.4477153 1-1v-4c0-.55228475-.4477153-1-1-1zm-8 2h6c.5522847 0 1 .44771525 1 1s-.4477153 1-1 1h-6c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z"/></svg>',items:!1},start:function(){!1!==this.opts.makebutton.items&&this.app.toolbar.add("makebutton",{title:"## makebutton.make-a-button ##",icon:this.opts.makebutton.icon,command:"makebutton.toggle",blocks:{all:"editable",except:["code"]},active:{tags:["a"]},position:{after:"link"}})},toggle:function(t,e){var i=this.opts.makebutton.items,s={};for(var a in i)s[a]=i[a],s[a].command="makebutton.set";s.remove={title:"## makebutton.remove-button ##",divider:"top",command:"makebutton.remove"},this.app.popup.create("makebutton",{items:s}),this.app.popup.open({button:e})},set:function(t,e,i){this.app.popup.close();var s=this.opts.makebutton.items[i],a=this.app.link.getLink();if(0===a.length){var o=this.app.inline.set({tag:"a",caret:"after"});(a=this.dom(o[0])).attr("href","#"),a.text(this.lang.get("makebutton.button"))}this._removeClasses(a),a.addClass(s.params.classname)},remove:function(){this.app.popup.close();var t=this.app.link.getLink();this._removeClasses(t)},_getClasses:function(){var t=[],e=this.opts.makebutton.items;for(var i in e)t.push(e[i].params.classname);return t},_removeClasses:function(t){for(var e=this._getClasses(),i=0;i<e.length;i++)t.removeClass(e[i])}}),ArticleEditor.iconMath='<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m11 2c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-3.92l2.70086881 3.37530495c.26561359.33201696.28976029.79108692.07244006 1.14620443l-.07244006.10318567-2.70186881 3.37530495h3.921c.5128358 0 .9355072.3860402.9932723.8833789l.0067277.1166211c0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-6c-.80039229 0-1.26153081-.8837601-.84621928-1.5335763l.06535047-.0911187 3.49986881-4.375305-3.49986881-4.37530495c-.5000011-.62500138-.09797137-1.53717061.66889291-1.61880377l.1119759-.00589128z"/></svg>',ArticleEditor.add("block","block.math",{mixins:["block"],type:"math",inline:!0,editable:!1,control:!1,toolbar:{add:{command:"addbar.popup",title:"## buttons.add ##"},tags:{command:"math.edit",title:"## math.math ##",icon:ArticleEditor.iconMath}},create:function(){return this.dom("<span>").addClass("math")}}),ArticleEditor.add("plugin","math",{translations:{en:{math:{math:"Math",label:"Type an expression",add:"Add",save:"Save",cancel:"Cancel"},blocks:{math:"Math"}}},defaults:{classname:"math",mathjax:!1,delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]},popups:{add:{title:"## math.math ##",width:"100%",form:{text:{label:"## math.label ##",type:"textarea",rows:6}},footer:{insert:{title:"## math.add ##",command:"math.insert",type:"primary"},cancel:{title:"## math.cancel ##",command:"popup.close"}}},edit:{title:"## math.math ##",width:"100%",form:{text:{label:"## math.label ##",type:"textarea",rows:6}},footer:{save:{title:"## math.save ##",command:"math.save",type:"primary"},cancel:{title:"## math.cancel ##",command:"popup.close"}}}},subscribe:{"editor.parse":function(t){this._parse(t)},"editor.unparse, editor.before.cut, editor.before.copy":function(t){this._unparse(t)},"editor.ready, source.close, state.undo, state.redo, editor.paste":function(){this._render()}},start:function(){this.app.addbar.add("math",{title:"## blocks.math ##",icon:ArticleEditor.iconMath,command:"math.popup"})},popup:function(){this.app.popup.add("math",this.popups.add).open({focus:"text"})},edit:function(t,e){var i=this.app.popup.create("math",this.popups.edit),s=decodeURI(this.app.block.get().getBlock().attr("data-math-code"));s=this._decodeSigns(s),i.setData({text:s}),this.app.popup.open({button:e,focus:"text"})},save:function(t){this.app.popup.close();var e=this.app.block.get().getBlock(),i=this._buildBlock(e,t);!1!==i&&(this._renderDisplay(e),this._renderTypeset(e,i))},insert:function(t){this.app.popup.close();var e=this.app.create("block.math"),i=e.getBlock(),s=this._buildBlock(i,t);!1!==s&&(this.app.block.add({instance:e}),this._renderDisplay(i),this._renderTypeset(i,s))},_buildBlock:function(t,e){var i=e.getData().text.trim(),s=this._parseDelim(i);return!!s&&(t.attr("data-math-display",s.display),t.attr("data-math-code",encodeURI(i)),this.opts.math.mathjax||(i=i.replace(s.left,"").replace(s.right,"")),t.html(i),i)},_renderTypeset:function(t,e){this.opts.math.mathjax?this._getMathJax().typeset():this._renderNode(t,e)},_renderDisplay:function(t){var e=t.attr("data-math-display"),i={display:"inline-block","text-align":""};e?(i={display:"block","text-align":"center"},t.addClass("math-display")):t.removeClass("math-display"),t.css(i)},_renderNode:function(t,e){this._getKatex().render(e,t.get(),{displayMode:t.attr("data-math-display")})},_render:function(){this.opts.math.mathjax&&this._getMathJax().typeset(),this.app.editor.getBody().find("."+this.opts.math.classname).each((function(t){this._renderDisplay(t),this.opts.math.mathjax||t.attr("data-math-render")||(this._renderNode(t,t.text()),t.attr("data-math-render",!0))}).bind(this))},_parseDelim:function(t){for(var e=this.opts.math.delimiters,i=0;i<e.length;i++){var s=RegExp("^"+this.app.utils.escapeRegExp(e[i].left));if(-1!==t.search(s))return e[i]}},_getMathJax:function(){return this.app.editor.getWinNode().MathJax},_getKatex:function(){return this.app.editor.getWinNode().katex},_getReplacer:function(t,e,i){return"<span class="+this.opts.math.classname+" data-"+this.prefix+'-type="math" data-math-code="'+e+'" data-math-display="'+i+'">'+t+"</span>"},_encodeSigns:function(t){return t=(t=t.replace(/\$\$/g,"xdoubledollarsignz")).replace(/\$/g,"xsingledollarsignz")},_decodeSigns:function(t){return t=(t=t.replace(/xdoubledollarsignz/g,"$$$")).replace(/xsingledollarsignz/g,"$")},_parse:function(t){for(var e=t.get("html"),i=this.opts.math.delimiters,s=0;s<i.length;s++){var a=i[s].display?"([\\w\\W]*?)":"(.*?)",o=RegExp(this.app.utils.escapeRegExp(i[s].left)+a+this.app.utils.escapeRegExp(i[s].right),"g"),n=e.match(o);if(null!=n)for(var r=0;r<n.length;r++){var l=n[r].trim(),p=this._encodeSigns(l);p=encodeURI(p),this.opts.math.mathjax||(l=l.replace(i[s].left,"").replace(i[s].right,"")),e=e.replace(n[r],this._getReplacer(l,p,i[s].display))}}t.set("html",e)},_unparse:function(t){var e=t.get("html");e=(e=this.app.utils.wrap(e,(function(t){t.find("."+this.opts.math.classname).each((function(t){var e=decodeURI(t.attr("data-math-code"));e=(e=this._decodeSigns(e)).replace(/&/g,"xampsignmathz"),t.text(e),t.unwrap()}).bind(this))}).bind(this))).replace(/xampsignmathz/g,"&"),t.set("html",e)},_copy:function(t){var e=t.get("html");t.set("html",e)}}),ArticleEditor.add("plugin","print",{translations:{en:{print:{print:"Print"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m10.125 1c.9760221 0 1.7936348.73390752 1.8692894 1.6885462l.0057106.14478713v3.16666667h1.0714286c.9927325 0 1.8438171.72087115 1.9226216 1.68668386l.0059498.14664947v3.33333337c0 .989117-.8038115 1.757089-1.7808027 1.8279863l-.1477687.005347h-1.0714286v.25c0 .9538999-.7859079 1.674765-1.7254643 1.7444667l-.1495357.0055333h-5.25c-1.00418792 0-1.875-.7458949-1.875-1.75v-.25h-1.07142857c-.99273257 0-1.8438171-.7208712-1.92262167-1.6866839l-.00594976-.1466494v-3.33333337c0-.98911703.80381155-1.757089 1.78080273-1.82798629l.1477687-.00534704h1.07142857v-3.16666667c0-.97542885.77113545-1.75578536 1.7298577-1.82789317l.1451423-.00544016zm-.125 11h-5v1h5zm3-4h-11v3l1.17735638-.0000851c.30466973-.6036661.96572942-.9999149 1.69764362-.9999149h5.25c.7319142 0 1.3929739.3962488 1.6976436.9999149l1.1773564.0000851zm-3-5h-5v3h5z"/></svg>'},start:function(){this.app.editor.addButton("print",{title:"## print.print ##",icon:this.opts.print.icon,command:"print.toggle",position:{before:"html"}})},toggle:function(){this.app.editor.getWinNode().print()}}),ArticleEditor.add("plugin","removeformat",{translations:{en:{removeformat:{removeformat:"Remove Format"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 11c.51283584 0 .93550716.3860402.99327227.8833789l.00672773.1166211v1c0 .5522847-.44771525 1-1 1-.51283584 0-.93550716-.3860402-.99327227-.8833789l-.00672773-.1166211v-1c0-.5522847.44771525-1 1-1zm-4.60436072-5.91850958.10436072.05248418 9.5262794 5.5c.4782927.2761424.6421678.8877328.3660254 1.3660254-.2564179.4441289-.8020741.6171529-1.2616646.4185096l-.1043608-.0524842-9.5262794-5.5c-.47829262-.27614237-.64216778-.88773278-.3660254-1.3660254.25641792-.44412886.80207419-.61715287 1.26166468-.41850958zm9.60436072-3.08149042c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-4.00016698l.00016698 2c0 .55228475-.44771525 1-1 1-.51283584 0-.93550716-.38604019-.99327227-.88337887l-.00672773-.11662113-.00016698-2h-3.99983302c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z"/></svg>'},start:function(){var t={title:"## removeformat.removeformat ##",icon:this.opts.removeformat.icon,command:"inline.removeFormat",position:{after:["deleted","italic"]},blocks:{all:"editable"}};this.app.toolbar.add("removeformat",t)}}),ArticleEditor.add("plugin","reorder",{defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="m13 5c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773h-10c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z"/><path d="m13 9c.5522847 0 1 .44771525 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-10c-.55228475 0-1-.4477153-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773z"/></g></svg>'},subscribe:{"block.set":function(){this._observe()}},init:function(){},start:function(){this.app.control.add("reorder",{icon:this.opts.reorder.icon,position:"first",blocks:{all:"first-level"}})},stop:function(){this._stopEvents()},_observe:function(){this.$btn=this.app.control.get("reorder"),0!==this.$btn.length&&(this.$btn.addClass(this.prefix+"-handle"),this._sortable())},_sortable:function(){this.instance=this.app.block.get(),this.$win=this.app.editor.getWin(),this.tolerance=this.$btn.width(),this.$clickItem=null,this.$dragItem=null,this.oldY=0,this.dragging=!1,this.$btn.on("mousedown."+this.prefix+"-reorder touchstart."+this.prefix+"-reorder",this._press.bind(this))},_press:function(t){var e=this.dom(t.target).closest("."+this.prefix+"-button");if(t&&t.target&&e.hasClass(this.prefix+"-handle")){t.preventDefault(),this.app.observer.trigger=!1,this.$win.on("mouseup."+this.prefix+"-reorder touchend."+this.prefix+"-reorder",this._release.bind(this)),this.$win.on("mousemove."+this.prefix+"-reorder touchmove."+this.prefix+"-reorder",this._move.bind(this));var i=this.instance.getBlock().get();this.app.block.unset(),this.dragging=!0,this.$dragItem=this._makeDragItem(i,t.target)}},_release:function(t){this._stopEvents(),this.app.observer.trigger=!0,this.oldY=0,this.dragging=!1,this._trashDragItem(),this.app.block.set(this.instance)},_move:function(t){if(this.$dragItem||this.dragging){t.preventDefault();var e=this.app.editor.getFrameRect(),i=!1,s=0===this.oldY?0:this.oldY-t.pageY;s>0?i="up":s<0&&(i="down");var a=this.app.scroll.isTarget(),o=this._isFrameScroll(),n=this.app.$doc.scrollTop(),r=a?this.app.scroll.getTarget():this.app.$doc,l=o?this.app.editor.getDoc().scrollTop():r.scrollTop();this._moveItem(this.$dragItem,s),this.oldY=t.pageY;var p,h=!1;a?p=r.height()+r.offset().top-40:o?(p=e.bottom-40,(endWin=this.app.$win.height()+n-40)<p&&(p=endWin)):(h=!this.app.toolbar.isSticky(),p=this.app.$win.height()+l-40);var c=this.app.container.get("bars"),d=c.height(),u=o?t.pageY+e.top-l:t.pageY+e.top,f=c.offset().top+d+40;"up"===i&&l>0&&u<f&&!1===h?this._scroll(-10):"down"===i&&u>p&&this._scroll(10);for(var m=this.app.editor.getLayout().children(),g=m.length,b=0;b<g;b++){var v=m.eq(b).get();v!==this.$clickItem.get()&&this._isOver(this.dom(v))&&this._swapItems(v)}}},_scroll:function(t){var e=this.app.scroll.isTarget()?this.app.scroll.getTarget():this.app.$win;this._isFrameScroll()&&(e=this.app.editor.getWin());var i=e.scrollTop();e.scrollTop(i+t)},_swapItems:function(t){var e=this.$dragItem.offset().top,i=this.$clickItem,s=this.dom(t),a=s.offset(),o=s.height()/2+a.top>e?"before":"after";s[o](i)},_stopEvents:function(){this.$win&&(this.$btn.off("."+this.prefix+"-reorder"),this.$win.off("."+this.prefix+"-reorder"))},_isFrameScroll:function(){var t=this.app.editor.getFrame().height();return this.app.editor.getBody().height()>t},_isOver:function(t){var e=this.$dragItem.offset().top,i=t.offset(),s=t.height();return e>i.top&&e<i.top+s},_moveItem:function(t,e){var i=t.offset().top;i-=e,t.css("top",i+"px")},_makeDragItem:function(t){this._trashDragItem();var e=this.dom(t),i=e.offset();this.$clickItem=e,this.$clickItem.addClass(this.prefix+"-drag-active");var s=e.clone();s.removeClass(this.prefix+"-drag-active "+this.prefix+"-element-active");var a=this.dom("<div>").addClass(this.prefix+"-dragging");return a.append(s),a.css({opacity:.95,position:"absolute","z-index":999,left:i.left+"px",top:i.top+"px",width:e.width()+"px"}),this.app.editor.getBody().append(a),a},_trashDragItem:function(){this.$dragItem&&this.$clickItem&&(this.$clickItem.removeClass(this.prefix+"-drag-active"),this.$clickItem=null,this.$dragItem.remove(),this.$dragItem=null)}}),ArticleEditor.add("plugin","selector",{translations:{en:{selector:{selector:"Selector",save:"Save",cancel:"Cancel"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m10.6663083 2.14369002c.5071647.07664087.8669828.53941479.8491564 1.06286535l-.0109223.12172524-.2435424 1.67154209 1.239.0001773c.5522847 0 1 .44771525 1 1 0 .51283584-.3860402.93550716-.8833789.99327227l-.1166211.00672773-1.531-.0001773-.291 2 1.322.0001773c.5522847 0 1 .44771525 1 1 0 .5128358-.3860402.9355072-.8833789.9932723l-.1166211.0067277-1.613-.0001773-.3121956 2.1487091c-.08323349.571695-.59347185.9682364-1.13964926.8857001-.50716474-.0766409-.86698283-.5394148-.84915642-1.0628653l.01092235-.1217253.26807893-1.8498186h-1.978l-.31219557 2.1487091c-.08323352.571695-.59347188.9682364-1.13964929.8857001-.50716474-.0766409-.86698283-.5394148-.84915642-1.0628653l.01092235-.1217253.26807893-1.8498186-1.365.0001773c-.55228475 0-1-.4477153-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 1.656-.0001773.292-2-1.448.0001773c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 1.739-.0001773.28765901-1.97043255c.08323352-.571695.59347189-.96823646 1.1396493-.88570013.50716473.07664087.86698282.53941479.84915642 1.06286535l-.01092236.12172524-.24354237 1.67154209h1.978l.28765901-1.97043255c.08323352-.571695.59347189-.96823646 1.13964929-.88570013zm-2.0103083 6.85613268.292-2h-1.979l-.291 2z"/></svg>',popup:{title:"## selector.selector ##",width:"100%",form:{id:{type:"input",label:"ID"},classname:{type:"input",label:"Class"}},footer:{insert:{title:"## selector.save ##",command:"selector.save",type:"primary"},cancel:{title:"## selector.cancel ##",command:"popup.close"}}}},init:function(){this.arxclasses=[]},start:function(){this.app.toolbar.add("selector",{title:"## selector.selector ##",icon:this.opts.selector.icon,blocks:{all:"all",except:["variable"]},command:"selector.popup"})},popup:function(t,e){for(var i=this.app.popup.create("selector",this.opts.selector.popup),s=this.app.block.get().getBlock(),a=s.attr("class"),o=s.attr("id"),n=a.split(" "),a="",r=0;r<n.length;r++)-1===n[r].search(this.prefix+"-")?a+=n[r]+" ":this.arxclasses.push(n[r]);i.setData({id:o,classname:a.trim()}),this.app.popup.open({button:e,focus:"id"})},save:function(t){this.app.popup.close();var e=this.app.block.get().getBlock(),i=t.getData();""===i.id?e.removeAttr("id"):e.attr("id",i.id),this.arxclasses.length>0&&(i.classname=i.classname+" "+this.arxclasses.join(" ")),e.attr("class",i.classname),this.arxclasses=[]}}),ArticleEditor.add("plugin","slideshow",{translations:{en:{slideshow:{slideshow:"Slideshow",save:"Save",cancel:"Cancel",insert:"Insert"}}},defaults:{upload:!1,select:!1,name:"file",data:!1,multiple:!0},popups:{add:{title:"## slideshow.slideshow ##",width:"100%",footer:{insert:{title:"## slideshow.insert ##",command:"slideshow.insert",type:"primary"},cancel:{title:"## slideshow.cancel ##",command:"popup.close"}}},edit:{title:"## slideshow.slideshow ##",width:"100%",footer:{save:{title:"## slideshow.save ##",command:"slideshow.save",type:"primary"},cancel:{title:"## slideshow.cancel ##",command:"popup.close"}}}},start:function(){this.app.addbar.add("slideshow",{title:"## slideshow.slideshow ##",icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m1 6c.51283584 0 .93550716.38604019.99327227.88337887l.00672773.11662113v6c0 .4964612.44481521.9373059 1.049825.9938787l.13199318.0061213h5.81818182c.55228475 0 1 .4477153 1 1 0 .5128358-.38604019.9355072-.88337887.9932723l-.11662113.0067277h-5.81818182c-1.67882337 0-3.08194674-1.2331302-3.17671765-2.8277989l-.00510053-.1722011v-6c0-.55228475.44771525-1 1-1zm12.6-6c1.3254834 0 2.4 1.0745166 2.4 2.4v8.2c0 .0812991-.0040424.161654-.0119371.2408747.04537.286293-.0350323.5849432-.229131.8106316-.3901386.7980655-1.2102555 1.3484937-2.1589319 1.3484937h-8.2c-.0093721 0-.01873166-.0000537-.02807838-.0001609l-.37192162.0001604c-.26521649 0-.5195704-.1053563-.70710678-.2928927l.05843073.052268c-.4838201-.2353989-.8766931-.6286113-1.11166129-1.1126794-.19291421-.2239005-.27189946-.5180346-.2277519-.8010756-.00769603-.0805757-.01191076-.1626056-.01191076-.2456198v-8.2c0-1.3254834 1.0745166-2.4 2.4-2.4zm-1.596 8.632-.76.937.839 1.431h1.517c.0486011 0 .0951777-.0086678.1382683-.0245418zm-4.582-1.631-2.176 3.83.169.169h4.349l-.436-.744-.04995732-.0453903c-.12825052-.1334488-.2131256-.2958557-.25256531-.46760617zm6.178-5.001h-8.2c-.2209139 0-.4.1790861-.4.4v4.814l1.53963435-2.70800941c.35805102-.6301698 1.23187816-.67285287 1.65793101-.12170559l.07440231.11030062 1.89203233 3.23141438 1.0987033-1.35538405c.384092-.47423473 1.0895396-.491008 1.4981306-.06381668l.0827862.09833145 1.1563799 1.56386928v-5.569c0-.19329966-.1371128-.35457492-.319386-.39187342z"/></svg>',command:"slideshow.popup"})},popup:function(){var t=this.app.popup.add("slideshow",this.popups.add),e=t.getBody();this.$box=this.dom("<div>").addClass(this.prefix+"-slideshow-items"),e.append(this.$box),this.$upload=this.app.image.createUploadBox(this.opts.slideshow.upload,e),this.app.image.createSelectBox(this.opts.slideshow.select,e,"slideshow.insertFromSelect"),t.open(),this._buildUpload(this.$upload,"slideshow.insertByUpload")},edit:function(t,e){var i=this.app.popup.create("slideshow",this.popups.edit).getBody(),s=this.app.block.get().getBlock().find("img");this.$box=this.dom("<div>").addClass(this.prefix+"-slideshow-items"),i.append(this.$box),s.each((function(t){this._buildBoxItem(t.attr("src"))}).bind(this)),this.$upload=this.app.image.createUploadBox(this.opts.slideshow.upload,i),this.app.image.createSelectBox(this.opts.slideshow.select,i,"slideshow.insertFromSelect"),this.app.popup.open({button:e}),this._buildUpload(this.$upload,"slideshow.insertByUpload")},insertByUpload:function(t){for(var e in t)this._buildBoxItem(t[e].url)},insertFromSelect:function(t){t.preventDefault();var e=this.dom(t.target);this._buildBoxItem(e.attr("data-url"))},insert:function(){var t=this.app.create("block.uk-slideshow");this.app.block.add({instance:t}),this.save()},save:function(){var t=this.app.block.get(),e=this.$box.find("img");if(0===e.length){t.remove(),this.app.popup.close();return}var i=t.getBlock().find(".uk-slideshow-items");i.html(""),e.each((function(t,e){var s=t.attr("src"),a=this.dom("<li>"),o=this.dom("<img>").attr({src:s,"uk-cover":!0});a.append(o),i.append(a)}).bind(this)),this.app.popup.close()},_removeItem:function(t){this.dom(t.target).closest("."+this.prefix+"-slideshow-item").fadeOut((function(t){t.remove()}).bind(this))},_buildBoxItem:function(t){var e=this.dom("<span>").addClass(this.prefix+"-slideshow-item"),i=this.dom("<span>").addClass(this.prefix+"-upload-remove"),s=this.dom("<img>").attr("src",t);i.one("click",this._removeItem.bind(this)),e.append(s),e.append(i),this.$box.append(e)},_buildUpload:function(t,e){if(this.opts.slideshow.upload){var i={box:!0,placeholder:this.lang.get("image.upload-new-placeholder"),url:this.opts.slideshow.upload,name:this.opts.slideshow.name,data:this.opts.slideshow.data,multiple:this.opts.slideshow.multiple,success:e,error:"image.error"};this.app.create("upload",t,i)}}}),ArticleEditor.add("plugin","specialchars",{translations:{en:{specialchars:{"special-chars":"Special Characters"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m2 14v-1.8348348h2.38016529v-.0780781c-.99173554-.975976-2.10247934-2.67417419-2.10247934-4.99699701 0-3.57207207 2.28099174-6.09009009 5.73223141-6.09009009 3.43140494 0 5.71239664 2.51801802 5.71239664 6.09009009 0 2.32282282-1.1107438 4.02102101-2.1024793 4.99699701v.0780781h2.3801653v1.8348348h-4.95867769v-1.6396396c1.40826449-1.1906907 2.32066119-2.75225229 2.32066119-5.07507511 0-2.4984985-1.2495868-4.31381382-3.35206614-4.31381382s-3.37190083 1.81531532-3.37190083 4.31381382c0 2.32282282.91239669 3.88438441 2.32066116 5.07507511v1.6396396z"/></svg>',items:["&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&divide;","&hellip;","&trade;","&bull;","&rarr;","&asymp;","$","&euro;","&cent;","&pound;","&yen;","&iexcl;","&curren;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&raquo;","&not;","&reg;","&macr;","&deg;","&sup1;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&ordm;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;"]},start:function(){this.app.toolbar.add("specialchars",{title:"## specialchars.special-chars ##",icon:this.opts.specialchars.icon,command:"specialchars.popup",blocks:{all:"editable",except:["code"]}})},popup:function(t,e){for(var i={},s=this.opts.specialchars.items,a=0;a<s.length;a++)i[a]={html:this.dom("<div>").addClass(this.prefix+"-popup-item").html(s[a]),command:"specialchars.insert",params:{character:s[a]}};this.app.popup.create("specialchars",{type:"grid",width:"352px",items:i}),this.app.popup.open({button:e})},insert:function(t){this.app.popup.close(),this.app.insertion.insertHtml(t.character,"after")}}),ArticleEditor.add("plugin","style",{translations:{en:{style:{style:"Style","remove-style":"Remove Style"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m15 1c-3.5955345 2.88454776-5.25146525 9.6241453-7.87485347 9.6241453h-2.6253419l-2.62495116 4.3758547h-.87485347c1.75009768-5.25102559 6.33028189-14 14-14z"/></svg>'},init:function(){},start:function(){if(void 0!==this.opts.styles){var t=Object.keys(this.opts.styles);0!==t.length&&this.app.toolbar.add("style",{title:"## style.style ##",icon:this.opts.style.icon,position:{after:"format"},blocks:{types:t},command:"style.popup"})}},popup:function(t,e){var i=this.app.block.get(),s=i.getType();this._getClasses(s);var a=this._buildItems(this.opts.styles[s],i);this.app.popup.create("style",{items:a}),this.app.popup.open({button:e})},toggle:function(t){this._toggle(t,!1)},remove:function(){this._toggle()},_toggle:function(t,e){this.app.popup.close();var i=this.app.block.get(),s=i.getType(),a=i.getBlock();this._removeStyles(i,s),!1===e&&a.addClass(t.classname),this.app.control.updatePosition()},_buildItems:function(t,e){var i={},s=!1;for(var a in t)i[a]={title:t[a].title,command:"style.toggle",params:{classname:t[a].classname}},this._hasClasses(e,t[a].classname)&&(s=a);return s&&(i[s].active=!0),i.remove={title:"## style.remove-style ##",divider:"top",command:"style.remove",hidden:!1===s},i},_hasClasses:function(t,e){var i=e.split(" ");return t.hasClass(i)},_getClasses:function(t){var e=this.opts.styles[t],i=[];for(var s in e)i.push(e[s].classname);return i},_removeStyles:function(t,e){var i=this._getClasses(e);t.getBlock().removeClass(i.join(" "))}}),ArticleEditor.iconTags='<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m13.454 1c.853089 0 1.546.69366173 1.546 1.546v4.36371429c0 .56592472-.2790572 1.24002756-.6652017 1.62429902l-5.78655018 6.01223499c-.60256278.6050023-1.58507632.6050023-2.18621204.0014299l-4.90828435-4.90828722c-.60500231-.60256278-.60500231-1.58507632.01233983-2.19971875l5.98566032-5.75877764c.39921147-.40082772 1.07325621-.68089459 1.63853383-.68089459zm-.454 2h-3.90971429c-.0333803 0-.19751184.06819697-.23666299.10718491l-5.65962272 5.44381509 4.254 4.254 5.4606089-5.67296241c.0188278-.01875188.0660214-.12740905.0841458-.18802473l.0072453-.03429857zm-2 1c.553 0 1 .447 1 1s-.447 1-1 1-1-.447-1-1 .447-1 1-1z"/></svg>',ArticleEditor.add("block","block.tags",{mixins:["block"],type:"tags",parser:{tag:"div",parse:function(t){return!!t.hasClass("tags")&&"tags"}},toolbar:{add:{command:"addbar.popup",title:"## buttons.add ##"},tags:{command:"tags.edit",title:"## buttons.settings ##",icon:ArticleEditor.iconTags}},control:{trash:{command:"block.remove",title:"## buttons.delete ##"},duplicate:{command:"block.duplicate",title:"## buttons.duplicate ##"}},create:function(){return this.dom("<div>").addClass("tags")}}),ArticleEditor.add("plugin","tags",{translations:{en:{tags:{tags:"Tags",add:"Add",save:"Save",cancel:"Cancel",label:"Add comma-separated tags"},blocks:{tags:"Tags"}}},popups:{add:{title:"## tags.tags ##",width:"100%",form:{tags:{label:"## tags.label ##",type:"textarea",rows:4}},footer:{insert:{title:"## tags.add ##",command:"tags.insert",type:"primary"},cancel:{title:"## tags.cancel ##",command:"popup.close"}}},edit:{title:"## tags.tags ##",width:"100%",form:{tags:{label:"## tags.label ##",type:"textarea",rows:4}},footer:{save:{title:"## tags.save ##",command:"tags.save",type:"primary"},cancel:{title:"## tags.cancel ##",command:"popup.close"}}}},defaults:{classname:"tag"},start:function(){this.app.addbar.add("tags",{title:"## blocks.tags ##",icon:ArticleEditor.iconTags,command:"tags.popup"})},popup:function(){this.app.popup.add("tags",this.popups.add).open({focus:"tags"})},edit:function(t,e){var i=this.app.popup.create("tags",this.popups.edit),s=this.app.block.get().getBlock(),a=[];s.find("."+this.opts.tags.classname).each(function(t){a.push(t.html())}),i.setData({tags:a.join(", ")}),this.app.popup.open({button:e,focus:"tags"})},save:function(t){var e=this.app.block.get();e.getBlock().html(""),this._buildInstance(t,e)||e.remove()},insert:function(t){var e=this._buildInstance(t);e&&this.app.block.add({instance:e})},_buildInstance:function(t,e){this.app.popup.close();var i=t.getData().tags.trim();if(""!==i){for(var e=e||this.app.create("block.tags"),s=e.getBlock(),a=i.split(","),o=0;o<a.length;o++){var n=a[o].trim(),r=this.dom("<span>").addClass(this.opts.tags.classname).html(n);s.append(r)}return e}}}),ArticleEditor.add("plugin","textdirection",{translations:{en:{textdirection:{title:"RTL-LTR",ltr:"Left to Right",rtl:"Right to Left"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m3.8 8.10002943c.12590292.09442719.2.24262134.2.4v1.49999997h9c.5522847 0 1 .4477153 1 1 0 .5128359-.3860402.9355072-.8833789.9932723l-.1166211.0067277h-9v1.5c0 .2761424-.22385763.5-.5.5-.15737865 0-.30557281-.0740971-.4-.2l-1.875-2.5c-.13333333-.1777778-.13333333-.4222222 0-.6l1.875-2.49999997c.16568542-.2209139.4790861-.26568543.7-.1zm7.4-6c.2209139-.16568543.5343146-.1209139.7.1l1.875 2.5c.1333333.17777777.1333333.42222222 0 .6l-1.875 2.5c-.0944272.12590292-.2426213.2-.4.2-.2761424 0-.5-.22385763-.5-.5v-1.5h-9c-.55228475 0-1-.44771525-1-1 0-.51283584.38604019-.93550716.88337887-.99327227l.11662113-.00672773 8.999-.00002943.001-1.49997057c0-.12590293.0474221-.24592777.1308533-.33724831z"/></svg>'},start:function(){this.app.toolbar.add("textdirection",{title:"## textdirection.title ##",icon:this.opts.textdirection.icon,blocks:{all:"all",except:["variable"]},command:"textdirection.toggle"})},toggle:function(t,e){var i=this.app.block.get().getBlock().attr("dir"),s={ltr:{title:"## textdirection.ltr ##",command:"textdirection.set"},rtl:{title:"## textdirection.rtl ##",command:"textdirection.set"}};s[i||this.opts.editor.direction].active=!0,this.app.popup.create("textdirection",{items:s}),this.app.popup.open({button:e})},set:function(t,e,i){this.app.popup.close();var s=this.app.block.get().getBlock();this.opts.editor.direction===i?s.removeAttr("dir"):s.attr("dir",i)}}),ArticleEditor.add("plugin","underline",{defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m12.2307692 12c.5522848 0 1 .4477153 1 1 0 .5128358-.3860402.9355072-.8833788.9932723l-.1166212.0067277h-8.2307692c-.55228475 0-1-.4477153-1-1 0-.5128358.38604019-.9355072.88337887-.9932723l.11662113-.0067277zm-1.2307692-10c.5128358 0 .9355072.43429521.9932723.99380123l.0067277.13119877v3.51108871c0 2.42071645-1.7998593 4.36391129-4 4.36391129-2.13138633 0-3.8871179-1.82364282-3.99476969-4.13841284l-.00523031-.22549845v-3.51108871c0-.62132034.44771525-1.125 1-1.125.51283584 0 .93550716.43429521.99327227.99380123l.00672773.13119877v3.51108871c0 1.15688618.88643222 2.11391129 2 2.11391129 1.06054074 0 1.91506284-.86804999 1.99404104-1.95008319l.00595896-.1638281v-3.51108871c0-.62132034.4477153-1.125 1-1.125z"/></svg>'},start:function(){this.app.toolbar.add("underline",{title:"## buttons.underline ##",icon:this.opts.underline.icon,command:"inline.set",position:{after:"italic"},active:{tags:["u"]},params:{tag:"u"},blocks:{all:"editable",except:["code"]}})}}),ArticleEditor.add("plugin","variable",{translations:{en:{blocks:{variable:"Variable"},variable:{variable:"Variable"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 0c4.418278 0 8 3.581722 8 8s-3.581722 8-8 8-8-3.581722-8-8 3.581722-8 8-8zm0 2c-3.3137085 0-6 2.6862915-6 6s2.6862915 6 6 6 6-2.6862915 6-6-2.6862915-6-6-6zm-.04375592 2c1.59851929 0 2.78098562.82644628 2.84667822 2.45730028h-1.72990447c-.01094876-.52892562-.4051042-.90358127-1.11677375-.90358127-.67882327 0-1.02918366.30853994-1.02918366.71625344 0 1.36639119 4.07293958.12121212 4.07293958 3.23966942 0 1.43250693-1.08392747 2.49035813-3.01090964 2.49035813-1.86128959 0-2.99996087-1.0688705-2.98901211-2.65564738h1.65326311c.03284629.6060606.51459183 1.05785128 1.39049282 1.05785128.72261831 0 1.14962004-.2754821 1.14962004-.76033062 0-1.43250689-3.99629825-.15426997-3.99629825-3.32782369 0-1.2892562.99633737-2.31404959 2.75908811-2.31404959z"/></svg>',items:["email","name","lastname"],classname:"arx-variable",template:{start:"[% ",end:" %]"}},subscribe:{"editor.parse":function(t){this._parse(t)},"editor.unparse":function(t){this._unparse(t)}},start:function(){this.app.toolbar.add("variable",{title:"## variable.variable ##",icon:this.opts.variable.icon,command:"variable.popup",blocks:{all:"editable",except:["code"],types:["variable"]},active:{types:["variable"]}})},popup:function(t,e){for(var i={},s=this.opts.variable.items,a=this.app.block.get(),o=!!a.getType("variable")&&a.getHtml(),n=0;n<s.length;n++)i[n]={title:s[n],command:"variable.insert",active:o===s[n],params:{variable:s[n]}};this.app.popup.create("variable",{items:i}),this.app.popup.open({button:e})},insert:function(t){this.app.popup.close();var e=this.app.create("block.variable");e.setHtml(t.variable),this.app.block.add({instance:e,caret:"after"})},_parse:function(t){var e=t.get("html"),i=this.opts.variable.template.start,s=this.opts.variable.template.end,a="<span data-"+this.prefix+'-type="variable">',o=[],n=RegExp(this.app.utils.escapeRegExp(i)+"(.*?)"+this.app.utils.escapeRegExp(s),"gi"),r=e.match(n);if(null!=r){e=this._storeLinks(e,o);for(var l,p=0;p<r.length;p++)l=a+r[p].replace(i,"").replace(s,"")+"</span>",e=e.replace(r[p],l);e=this._restoreLinks(e,o)}t.set("html",e)},_unparse:function(t){var e=t.get("html"),i=this.opts.variable.template.start,s=this.opts.variable.template.end;e=this.app.utils.wrap(e,(function(t){t.find("."+this.opts.variable.classname).replaceWith(function(t){return i+t.innerHTML+s})}).bind(this)),t.set("html",e)},_storeLinks:function(t,e){var i=t.match(RegExp("<a[^>]*>","gi"));if(null===i)return t;for(var s=0;s<i.length;s++)t=t.replace(i[s],"#####xstartvarlinkszz"+s+"xendvarlinkstzz#####"),e.push(i[s]);return t},_restoreLinks:function(t,e){for(var i=0;i<e.length;i++)t=t.replace("#####xstartvarlinkszz"+i+"xendvarlinkstzz#####",e[i]);return t}}),ArticleEditor.add("plugin","pshow-icons",{start:function(){this.app.toolbar.add("pshow-icons",{title:"Icons",icon:'<i class="fa fa-star"></i>',command:"pshow-icons.popup"})},popup:function(t,e){var i=this.app.popup.create("pshow-icons",{title:"",width:"600px",height:"400px"}).getBody();i.css("padding","15px");var s=this.dom('<input type="text" placeholder="Search icons..." style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;">'),a=this.dom('<div style="display: flex; flex-wrap: wrap; gap: 10px; max-height: 300px; overflow-y: auto; ">'),o=[];["fa-adjust","fa-adn","fa-align-center","fa-align-justify","fa-align-left","fa-align-right","fa-ambulance","fa-anchor","fa-android","fa-angellist","fa-angle-double-down","fa-angle-double-left","fa-angle-double-right","fa-angle-double-up","fa-angle-down","fa-angle-left","fa-angle-right","fa-angle-up","fa-apple","fa-archive","fa-area-chart","fa-arrow-circle-down","fa-arrow-circle-left","fa-arrow-circle-right","fa-arrow-circle-up","fa-arrow-down","fa-arrow-left","fa-arrow-right","fa-arrow-up","fa-arrows","fa-arrows-alt","fa-arrows-h","fa-arrows-v","fa-asterisk","fa-at","fa-backward","fa-ban","fa-bar-chart","fa-barcode","fa-bars","fa-bed","fa-beer","fa-behance","fa-behance-square","fa-bell","fa-bell-o","fa-bell-slash","fa-bell-slash-o","fa-bicycle","fa-binoculars","fa-birthday-cake","fa-bitbucket","fa-bitbucket-square","fa-bold","fa-bolt","fa-bomb","fa-book","fa-bookmark","fa-bookmark-o","fa-briefcase","fa-btc","fa-bug","fa-building","fa-building-o","fa-bullhorn","fa-bullseye","fa-bus","fa-calculator","fa-calendar","fa-calendar-o","fa-camera","fa-camera-retro","fa-car","fa-caret-down","fa-caret-left","fa-caret-right","fa-caret-up","fa-cart-arrow-down","fa-cart-plus","fa-cc","fa-cc-amex","fa-cc-discover","fa-cc-mastercard","fa-cc-paypal","fa-cc-stripe","fa-cc-visa","fa-certificate","fa-chain-broken","fa-check","fa-check-circle","fa-check-circle-o","fa-check-square","fa-check-square-o","fa-chevron-circle-down","fa-chevron-circle-left","fa-chevron-circle-right","fa-chevron-circle-up","fa-chevron-down","fa-chevron-left","fa-chevron-right","fa-chevron-up","fa-child","fa-circle","fa-circle-o","fa-circle-o-notch","fa-circle-thin","fa-clipboard","fa-clock-o","fa-cloud","fa-cloud-download","fa-cloud-upload","fa-code","fa-code-fork","fa-coffee","fa-cog","fa-cogs","fa-columns","fa-comment","fa-comment-o","fa-comments","fa-comments-o","fa-compass","fa-compress","fa-copy","fa-copyright","fa-credit-card","fa-crop","fa-crosshairs","fa-css3","fa-cube","fa-cubes","fa-cutlery","fa-database","fa-desktop","fa-diamond","fa-download","fa-dropbox","fa-edit","fa-eject","fa-ellipsis-h","fa-ellipsis-v","fa-envelope","fa-envelope-o","fa-envelope-square","fa-eraser","fa-exchange","fa-exclamation","fa-exclamation-circle","fa-exclamation-triangle","fa-expand","fa-external-link","fa-external-link-square","fa-eye","fa-eye-slash","fa-eyedropper","fa-facebook","fa-facebook-square","fa-fast-backward","fa-fast-forward","fa-fax","fa-female","fa-fighter-jet","fa-file","fa-file-archive-o","fa-file-audio-o","fa-file-code-o","fa-file-excel-o","fa-file-image-o","fa-file-o","fa-file-pdf-o","fa-file-powerpoint-o","fa-file-text","fa-file-text-o","fa-file-video-o","fa-file-word-o","fa-files-o","fa-film","fa-filter","fa-fire","fa-fire-extinguisher","fa-flag","fa-flag-checkered","fa-flag-o","fa-flask","fa-flickr","fa-floppy-o","fa-folder","fa-folder-o","fa-folder-open","fa-folder-open-o","fa-font","fa-forward","fa-foursquare","fa-frown-o","fa-futbol-o","fa-gamepad","fa-gavel","fa-gbp","fa-gift","fa-git","fa-git-square","fa-github","fa-github-alt","fa-github-square","fa-glass","fa-globe","fa-google","fa-google-plus","fa-google-plus-square","fa-graduation-cap","fa-gratipay","fa-h-square","fa-hand-o-down","fa-hand-o-left","fa-hand-o-right","fa-hand-o-up","fa-hdd-o","fa-header","fa-headphones","fa-heart","fa-heart-o","fa-history","fa-home","fa-hospital-o","fa-html5","fa-image","fa-inbox","fa-indent","fa-info","fa-info-circle","fa-inr","fa-instagram","fa-ioxhost","fa-italic","fa-joomla","fa-jpy","fa-jsfiddle","fa-key","fa-keyboard-o","fa-krw","fa-language","fa-laptop","fa-lastfm","fa-lastfm-square","fa-leaf","fa-lemon-o","fa-level-down","fa-level-up","fa-life-ring","fa-lightbulb-o","fa-line-chart","fa-link","fa-linkedin","fa-linkedin-square","fa-linux","fa-list","fa-list-alt","fa-list-ol","fa-list-ul","fa-location-arrow","fa-lock","fa-long-arrow-down","fa-long-arrow-left","fa-long-arrow-right","fa-long-arrow-up","fa-magic","fa-magnet","fa-male","fa-map-marker","fa-maxcdn","fa-meanpath","fa-medkit","fa-meh-o","fa-microphone","fa-microphone-slash","fa-minus","fa-minus-circle","fa-minus-square","fa-minus-square-o","fa-mobile","fa-money","fa-moon-o","fa-motorcycle","fa-music","fa-newspaper-o","fa-openid","fa-outdent","fa-pagelines","fa-paint-brush","fa-paper-plane","fa-paper-plane-o","fa-paperclip","fa-paragraph","fa-pause","fa-paw","fa-paypal","fa-pencil","fa-pencil-square","fa-pencil-square-o","fa-phone","fa-phone-square","fa-picture-o","fa-pie-chart","fa-pied-piper","fa-pied-piper-alt","fa-pinterest","fa-pinterest-square","fa-plane","fa-play","fa-play-circle","fa-play-circle-o","fa-plug","fa-plus","fa-plus-circle","fa-plus-square","fa-plus-square-o","fa-power-off","fa-print","fa-puzzle-piece","fa-qq","fa-qrcode","fa-question","fa-question-circle","fa-quote-left","fa-quote-right","fa-random","fa-rebel","fa-recycle","fa-reddit","fa-reddit-square","fa-refresh","fa-renren","fa-repeat","fa-reply","fa-reply-all","fa-retweet","fa-road","fa-rocket","fa-rss","fa-rss-square","fa-rub","fa-scissors","fa-search","fa-search-minus","fa-search-plus","fa-sellsy","fa-server","fa-share","fa-share-alt","fa-share-alt-square","fa-share-square","fa-share-square-o","fa-shield","fa-ship","fa-shirtsinbulk","fa-shopping-cart","fa-sign-in","fa-sign-out","fa-signal","fa-simplybuilt","fa-sitemap","fa-skyatlas","fa-skype","fa-slack","fa-sliders","fa-slideshare","fa-smile-o","fa-sort","fa-sort-alpha-asc","fa-sort-alpha-desc","fa-sort-amount-asc","fa-sort-amount-desc","fa-sort-asc","fa-sort-desc","fa-sort-numeric-asc","fa-sort-numeric-desc","fa-soundcloud","fa-space-shuttle","fa-spinner","fa-spoon","fa-spotify","fa-square","fa-square-o","fa-stack-exchange","fa-stack-overflow","fa-star","fa-star-half","fa-star-half-o","fa-star-o","fa-steam","fa-steam-square","fa-step-backward","fa-step-forward","fa-stethoscope","fa-stop","fa-street-view","fa-strikethrough","fa-stumbleupon","fa-stumbleupon-circle","fa-subscript","fa-subway","fa-suitcase","fa-sun-o","fa-superscript","fa-table","fa-tablet","fa-tachometer","fa-tag","fa-tags","fa-tasks","fa-taxi","fa-tencent-weibo","fa-terminal","fa-text-height","fa-text-width","fa-th","fa-th-large","fa-th-list","fa-thumbs-down","fa-thumbs-o-down","fa-thumbs-o-up","fa-thumbs-up","fa-ticket","fa-times","fa-times-circle","fa-times-circle-o","fa-tint","fa-toggle-off","fa-toggle-on","fa-train","fa-transgender","fa-transgender-alt","fa-trash","fa-trash-o","fa-tree","fa-trello","fa-trophy","fa-truck","fa-try","fa-tty","fa-tumblr","fa-tumblr-square","fa-twitch","fa-twitter","fa-twitter-square","fa-umbrella","fa-underline","fa-undo","fa-university","fa-unlock","fa-unlock-alt","fa-upload","fa-usd","fa-user","fa-user-md","fa-user-plus","fa-user-secret","fa-user-times","fa-users","fa-venus","fa-venus-double","fa-venus-mars","fa-viacoin","fa-video-camera","fa-vimeo-square","fa-vine","fa-vk","fa-volume-down","fa-volume-off","fa-volume-up","fa-weibo","fa-weixin","fa-whatsapp","fa-wheelchair","fa-wifi","fa-windows","fa-wordpress","fa-wrench","fa-xing","fa-xing-square","fa-yahoo","fa-yelp","fa-youtube","fa-youtube-play","fa-youtube-square"].forEach((function(t){var e=this.dom(`<div class="icon-item" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; text-align: center; width: 80px;">
                <i class="fa ${t}" style="font-size: 20px;"></i>
                <div style="font-size: 10px; margin-top: 5px;">${t.substring(3).replace(/-/g," ")}</div>
            </div>`);e.on("click",this.insert.bind(this,t)),a.append(e),o.push({element:e,name:t})}).bind(this)),s.on("input",(function(t){var e=t.target.value.toLowerCase();o.forEach(function(t){t.name.toLowerCase().includes(e)?t.element.css("display","block"):t.element.css("display","none")})}).bind(this)),i.append(s),i.append(a),this.app.popup.open({button:e})},insert:function(t,e){e.preventDefault();var i=this.dom(`<i class="fa ${t}"></i>`);this.app.insertion.insertNode(i),this.app.popup.close()}}),ArticleEditor.add("plugin","blocklink",{start:function(){this.app.toolbar.add("blocklink",{title:"Block link",icon:'<i class="fa fa-link"></i>',command:"blocklink.popup",blocks:{all:!0,except:["variable","figure","paragraph","image"]}})},popup:function(t,e){var i=this.app.block.get().getBlock();if(console.log(i.nodes[0].tagName),"DIV"!=i.nodes[0].tagName){console.log("DIV is only allowed");return}var s=this.app.popup.create("blocklink",{title:"Block link",width:"400px",form:{target_url:{type:"input",label:"Target URL"}},footer:{save:{title:"Save",command:"blocklink.save",type:"primary"},cancel:{title:"Cancel",command:"popup.close"}}}),a=i.attr("data-target-url");s.setData({target_url:a}),this.app.popup.open({button:e})},save:function(t){this.app.popup.close();var e=t.getData(),i=this.app.block.get().getBlock();""!==e.target_url?i.attr("data-target-url",e.target_url):i.removeAttr("data-target-url")}}),ArticleEditor.add("plugin","product-block",{start:function(){this.app.toolbar.add("product-block",{title:"Product block",icon:'<i class="fa fa-product-hunt"></i>',command:"product-block.popup",blocks:{all:!0,except:["variable","figure","paragraph","image"]}})},popup:function(t,e){var i=this.app.block.get().getBlock();if(console.log(i.nodes[0].tagName),"DIV"!=i.nodes[0].tagName){console.log("DIV is only allowed");return}var s=this.app.popup.create("product-block",{title:"Product block",width:"400px",form:{product_id:{type:"input",label:"Product ID"}},footer:{save:{title:"Save",command:"product-block.save",type:"primary"},cancel:{title:"Cancel",command:"popup.close"}}}),a=i.attr("data-product-id");s.setData({product_id:a}),this.app.popup.open({button:e})},save:function(t){this.app.popup.close();var e=t.getData(),i=this.app.block.get().getBlock();""!==e.product_id?i.attr("data-product-id",e.product_id):i.removeAttr("data-product-id")}}),ArticleEditor.add("plugin","my-fontcolor",{translations:{en:{fontcolor:{title:"Text color",remove:"Remove color",text:"Text",background:"Background",custom:"Custom color",customhex:"Enter hex color code",apply:"Apply"}}},init(){this.colors=this.opts.fontcolor?this.opts.fontcolor:{gray:["#212529","#343a40","#495057","#868e96","#adb5bd","#ced4da","#dee2e6","#e9ecef","#f1f3f5","#f8f9fa"],red:["#c92a2a","#e03131","#f03e3e","#fa5252","#ff6b6b","#ff8787","#ffa8a8","#ffc9c9","#ffe3e3","#fff5f5"],pink:["#a61e4d","#c2255c","#d6336c","#e64980","#f06595","#f783ac","#faa2c1","#fcc2d7","#ffdeeb","#fff0f6"],grape:["#862e9c","#9c36b5","#ae3ec9","#be4bdb","#cc5de8","#da77f2","#e599f7","#eebefa","#f3d9fa","#f8f0fc"],violet:["#5f3dc4","#6741d9","#7048e8","#7950f2","#845ef7","#9775fa","#b197fc","#d0bfff","#e5dbff","#f3f0ff"],indigo:["#364fc7","#3b5bdb","#4263eb","#4c6ef5","#5c7cfa","#748ffc","#91a7ff","#bac8ff","#dbe4ff","#edf2ff"],blue:["#1864ab","#1971c2","#1c7ed6","#228be6","#339af0","#4dabf7","#74c0fc","#a5d8ff","#d0ebff","#e7f5ff"],cyan:["#0b7285","#0c8599","#1098ad","#15aabf","#22b8cf","#3bc9db","#66d9e8","#99e9f2","#c5f6fa","#e3fafc"],teal:["#087f5b","#099268","#0ca678","#12b886","#20c997","#38d9a9","#63e6be","#96f2d7","#c3fae8","#e6fcf5"],green:["#2b8a3e","#2f9e44","#37b24d","#40c057","#51cf66","#69db7c","#8ce99a","#b2f2bb","#d3f9d8","#ebfbee"],lime:["#5c940d","#66a80f","#74b816","#82c91e","#94d82d","#a9e34b","#c0eb75","#d8f5a2","#e9fac8","#f4fce3"],yellow:["#e67700","#f08c00","#f59f00","#fab005","#fcc419","#ffd43b","#ffe066","#ffec99","#fff3bf","#fff9db"],orange:["#d9480f","#e8590c","#f76707","#fd7e14","#ff922b","#ffa94d","#ffc078","#ffd8a8","#ffe8cc","#fff4e6"]}},start(){this.app.toolbar.buttons&&this.app.toolbar.buttons.fontcolor&&this.app.toolbar.remove("fontcolor"),this.app.toolbar.add("fontcolor",{title:"## fontcolor.title ##",color:!0,icon:'<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.50002 4.16336C8.18972 4.16336 7.89213 4.28662 7.67271 4.50604C7.45329 4.72546 7.33002 5.02305 7.33002 5.33336V6.50336H9.67002V5.33336C9.67002 5.02305 9.54676 4.72546 9.32734 4.50604C9.10792 4.28662 8.81033 4.16336 8.50002 4.16336ZM11.33 5.33336C11.33 4.58279 11.0319 3.86297 10.5011 3.33224C9.97041 2.80152 9.25059 2.50336 8.50002 2.50336C7.74946 2.50336 7.02964 2.80152 6.49891 3.33224C5.96818 3.86297 5.67002 4.58279 5.67002 5.33336V10C5.67002 10.4584 6.04163 10.83 6.50002 10.83C6.95842 10.83 7.33002 10.4584 7.33002 10V8.16336H9.67002V10C9.67002 10.4584 10.0416 10.83 10.5 10.83C10.9584 10.83 11.33 10.4584 11.33 10V5.33336ZM3.00336 12.6667C3.00336 12.2083 3.37496 11.8367 3.83336 11.8367H13.1667C13.6251 11.8367 13.9967 12.2083 13.9967 12.6667C13.9967 13.1251 13.6251 13.4967 13.1667 13.4967H3.83336C3.37496 13.4967 3.00336 13.1251 3.00336 12.6667Z"/></svg>',blocks:{all:"editable",except:["code"]},command:"my-fontcolor.popup"})},popup(t,e){let i=this.app.selection.getNodes({type:"inline"});if(this.currentColor=!1,this.currentBackgroundColor=!1,i){let t=this.dom(i[0]),e=this.app.utils.cssToObject(t.attr("style"));this.currentColor=e.color?e.color:this.currentColor,this.currentBackgroundColor=e.background?e.background:this.currentBackgroundColor}let s=this.dom('<div class="'+this.prefix+'-dropdown-cells">');this.$selector=this._buildSelector(),this.$selectorText=this._buildSelectorItem("text",this.lang.get("fontcolor.text")),this.$selectorText.addClass("active"),this.$selectorBack=this._buildSelectorItem("back",this.lang.get("fontcolor.background")),this.$selector.append(this.$selectorText),this.$selector.append(this.$selectorBack),this.$pickerText=this._buildPicker("textcolor"),this.$pickerBack=this._buildPicker("backcolor");let a=Math.max(260,20*Object.keys(this.colors).length);s.append(this.$selector),s.append(this.$pickerText),s.append(this.$pickerBack),s.width(a),this._buildSelectorEvents(),this.app.popup.create("fontcolor",{width:a+"px",html:s}),this.app.popup.open({button:e})},_remove(t){this.app.popup.close(),this.app.inline.remove("color"===t?{style:"color"}:{style:"background"})},_buildSelector(){let t=this.dom("<div>");return t.addClass(this.prefix+"-dropdown-selector"),t},_buildSelectorItem(t,e){let i=this.dom("<span>");return i.attr("rel",t).html(e),i.addClass(this.prefix+"-dropdown-not-close"),i},_buildSelectorEvents(){this.$selectorText.on("click",(function(t){t.preventDefault(),this.$selectorBack.removeClass("active"),this.$selectorText.addClass("active"),this.$pickerBack.hide(),this.$pickerText.show()}).bind(this)),this.$selectorBack.on("click",(function(t){t.preventDefault(),this.$selectorText.removeClass("active"),this.$selectorBack.addClass("active"),this.$pickerText.hide(),this.$pickerBack.show()}).bind(this))},_buildPicker(t){var e=this.dom('<div class="'+this.prefix+"-dropdown-box-"+t+'">'),i=this.dom('<div class="'+this.prefix+'-form-colors-box">'),s="backcolor"==t?"background":"color";this.colors.length;var a=this;for(let[t,e]of Object.entries(this.colors)){for(var o=this.dom('<div class="'+this.prefix+'-form-colors">'),n=0;n<e.length;n++){var r=e[n],l=this.dom('<a href="#">');l.attr({rel:r,"data-rule":s}),l.css({"background-color":r,"font-size":0,width:"20px",height:"20px"}),l.on("click",(function(t){t.preventDefault(),t.stopPropagation();var e=this.dom(t.target);let i=e.attr("rel"),s={tag:"span",style:"color"===e.data("rule")?{color:i}:{background:i}};this.app.event.trigger=!1,this.app.inline.set(s),setTimeout((function(){this.app.event.trigger=!0}).bind(this),100)}).bind(this)),"color"===s&&this.currentColor===r&&l.addClass("active"),"background"===s&&this.currentBackgroundColor===r&&l.addClass("active"),o.append(l)}i.append(o)}e.append(i);var p=this.dom('<div class="'+this.prefix+'-form-custom-color-box">'),h=this.dom('<div class="'+this.prefix+'-form-custom-color-group">'),c=this.dom('<input type="text" class="'+this.prefix+'-form-custom-color-input form-control">');c.attr("placeholder",this.lang.get("fontcolor.customhex"));var d=this.dom('<div class="'+this.prefix+'-form-custom-color-preview">'),u=this.dom('<button class="'+this.prefix+'-form-custom-color-apply btn btn-secondary">');u.html(this.lang.get("fontcolor.apply")),c.on("input",function(){var t=c.val();t&&"#"!==t.charAt(0)&&(t="#"+t),/^#([0-9A-F]{3}){1,2}$/i.test(t)&&d.css("background-color",t)}),u.on("click",(function(t){t.preventDefault(),t.stopPropagation();var e=c.val();if(e&&"#"!==e.charAt(0)&&(e="#"+e),/^#([0-9A-F]{3}){1,2}$/i.test(e)){let t="color"===s?{color:e}:{background:e};this.app.event.trigger=!1,this.app.inline.set({tag:"span",style:t}),setTimeout((function(){this.app.event.trigger=!0}).bind(this),100),this.app.popup.close()}else alert("Please enter a valid hex color code (e.g., #FF0000 or #F00)")}).bind(this)),h.append(d),h.append(c),h.append(u),p.append(h),e.append(p);var f=this.dom("<div>").addClass(this.prefix+"-dropdown-remove-item"),m=this.dom("<a>");return m.attr({href:"#"}),m.html(this.lang.get("fontcolor.remove")),m.on("click",function(t){t.preventDefault(),a._remove(s)}),f.append(m),e.append(f),"backcolor"==t&&e.hide(),e}}),window.PShowBlockEditor=function(t,e){e=e||PShowBEConfig,"undefined"!=typeof PShowBEBaseUri&&(e.css=PShowBEBaseUri+"dist/"),setTimeout(()=>{let i=document.getElementById("header_infos").offsetHeight;i+=(document.getElementsByClassName("header-toolbar")[0]?.offsetHeight||0)+(document.getElementsByClassName("page-head")[0]?.offsetHeight||0);let s={},a=document.querySelectorAll(t),o={},n=new MutationObserver(function(t){t.forEach(function(t){if("attributes"===t.type){if(t.target.disabled){o[t.target.id].disable();return}o[t.target.id].enable()}})});for(let t=0;t<a.length;t++){let r=a[t].closest(".col-lg-9");if(r){r.classList.add("col-lg-11"),r.classList.remove("col-lg-9");let t=r.nextElementSibling;t&&(t.classList.add("col-lg-1"),t.classList.remove("col-lg-2"))}a[t].id||(a[t].id="pse-editor-"+Math.random().toString(36).substring(2)),a[t].classList.remove("autoload_rte"),a[t].value=a[t].value.replace(/([^-])grid/g,"$1pse-grid"),a[t].value=a[t].value.replace(/<table>/g,'<table class="pse-table">'),a[t].value=a[t].value.replace(/([^-])valign-([a-z]+)/g,"$1pse-valign-$2"),a[t].value=a[t].value.replace(/([^-v])align-([a-z]+)/,"$1pse-align-$2");let l=new DOMParser().parseFromString(a[t].value,"text/html"),p=l?.body?.firstChild;if(p&&"function"==typeof p.querySelector){let e=p.querySelector('div[class="app__tabs__content__inner js__app__tabs__content pse-div"]');e&&e?.innerHTML&&(a[t].value=e.innerHTML)}a[t].value=function(t){let e=new DOMParser().parseFromString(t,"text/html");return e.querySelectorAll("div").forEach(t=>{if(Array.from(t.childNodes).some(t=>t.nodeType===Node.TEXT_NODE&&""!==t.textContent.trim())&&!t.querySelector("div")){let i=e.createElement("p");i.innerHTML=t.innerHTML,i.className="pse-p",i.style.cssText=t.style.cssText,t.getAttribute("data-target-url")&&i.setAttribute("data-target-url",t.getAttribute("data-target-url")),t.parentNode.replaceChild(i,t)}}),e.body.innerHTML}(a[t].value),o[a[t].id]=ArticleEditor("#"+a[t].id,{image:{width:!0,types:["image/png","image/jpeg"],upload:PShowEditorImageUploadControllerURL,select:PShowEditorImageListControllerURL},topbar:{undoredo:!0},toolbar:{stickyTopOffset:i},snippets:PShowThemeCssUri+"pshow-block-editor-snippets.json",custom:{css:[PShowBEBaseUri+"dist/front.css","https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css",PShowThemeCssUri+"pshow-block-editor.css"],js:[PShowBEBaseUri+"dist/admin.js"]},subscribe:{"editor.before.change":function(e){$('form[name="product"] .cancel-button').prop("disabled",!1).removeClass("disabled"),$('form[name="product"] .product-form-save-button').prop("disabled",!1).removeClass("disabled");let i=new DOMParser().parseFromString(e.params.html,"text/html"),s=i.querySelectorAll('[data-temp-block="true"]');s&&s.forEach(t=>{t.remove()}),i.querySelectorAll(".replaced-cover-image").forEach(t=>{t.src="{{cover}}",t.classList.remove("replaced-cover-image")}),e.params.html=i.body.outerHTML;let n=o[a[t].id].editor.$editor.nodes[0];n&&(n.contentWindow.pinProductBlockIds(),n.contentWindow.replaceCoverImages())}},plugins:["selector","imageposition","imageresize","removeformat","specialchars","underline","counter","blockcode","reorder","fontsize","fontfamily","my-fontcolor","pshow-icons","blocklink","product-block"],path:{title:"Editor"},grid:{classname:"pse-grid"},table:{template:'<table class="pse-table"><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>'},align:{left:"pse-align-left",center:"pse-align-center",right:"pse-align-right",justify:"pse-align-justify"},valign:{top:"pse-valign-top",middle:"pse-valign-middle",bottom:"pse-valign-bottom"},codemirror:{lineNumbers:!0},classes:{p:"pse-p",h1:"pse-h1",h2:"pse-h2",h3:"pse-h3",h4:"pse-h4",h5:"pse-h5",h6:"pse-h6",blockquote:"pse-blockquote",pre:"pse-pre",code:"pse-code",table:"pse-table",th:"pse-th",td:"pse-td",tr:"pse-tr",ul:"pse-ul",ol:"pse-ol",li:"pse-li",img:"pse-img",a:"pse-a",span:"pse-span",div:"pse-div",iframe:"pse-iframe",figure:"pse-figure",figcaption:"pse-figcaption",section:"pse-section",hr:"pse-hr",b:"pse-b",i:"pse-i",u:"pse-u",s:"pse-s",del:"pse-del",sub:"pse-sub",sup:"pse-sup",em:"pse-em",strong:"pse-strong",small:"pse-small",abbr:"pse-abbr"},...e}),n.observe(a[t],{attributes:!0});let h=$.fn.val;$.fn.val=function(e){return void 0!==e&&this[0]?.id===a[t]?.id&&o[a[t].id].editor.setContent({html:e}),h.apply(this,arguments)},"undefined"!=typeof tinymce&&(tinymce.remove(`#${a[t].id}`),a[t].style.display="none"),s[a[t].id]=setInterval(()=>{"undefined"!=typeof tinymce&&(tinymce.remove(`#${a[t].id}`),a[t].style.display="none",clearInterval(s[a[t].id]))},2e3)}},1)},window.addEventListener("load",function(){if(PShowBlockEditor("[data-pshow-block-editor]"),PShowBEConfig?.editors_id)for(let t of PShowBEConfig.editors_id)PShowBlockEditor(t);let t=document.head,e=document.createElement("link");e.href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css",e.rel="stylesheet",t.appendChild(e)});
//# sourceMappingURL=index.js.map
