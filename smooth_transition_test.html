<!DOCTYPE html>
<html>
<head>
    <title>Test p≈Çynnego ≈Çadowania ceny wysy≈Çki</title>
    <style>
        .test-container {
            border: 2px solid #ddd;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .dynamic-shipping-price {
            font-weight: bold;
            color: #2196F3;
            transition: opacity 0.3s ease, color 0.2s ease;
        }
        .loading {
            opacity: 0.6 !important;
            color: #999 !important;
        }
        .loaded {
            opacity: 1 !important;
            color: #4CAF50 !important;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-test { background: #2196F3; color: white; }
        .btn-reset { background: #f44336; color: white; }
        .btn-cache { background: #FF9800; color: white; }
    </style>
</head>
<body>
    <h1>Test p≈Çynnego ≈Çadowania ceny wysy≈Çki</h1>
    
    <div class="test-container">
        <h3>Symulacja modal.tpl (produkt 2681):</h3>
        <p>
            <span class="delivery-text">Dostawa 
                <span class="dynamic-shipping-price" data-product-id="2681" id="price1">
                    od 30,75 z≈Ç
                </span>
            </span>
        </p>
    </div>
    
    <div class="test-container">
        <h3>Test r√≥≈ºnych stan√≥w:</h3>
        <p>Stan poczƒÖtkowy: <span class="dynamic-shipping-price" id="price2">od 30,75 z≈Ç</span></p>
        <p>Z cache: <span class="dynamic-shipping-price" id="price3">od 30,75 z≈Ç</span></p>
        <p>Po AJAX: <span class="dynamic-shipping-price" id="price4">od 30,75 z≈Ç</span></p>
    </div>
    
    <div>
        <button class="btn-test" onclick="simulateAjaxLoad()">üîÑ Symuluj ≈Çadowanie AJAX</button>
        <button class="btn-cache" onclick="simulateCache()">üíæ Symuluj cache (67,65 z≈Ç)</button>
        <button class="btn-test" onclick="testRealAjax()">üåê Test prawdziwego AJAX</button>
        <button class="btn-reset" onclick="resetPrices()">üîÑ Reset</button>
    </div>
    
    <div id="log" style="background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; max-height: 300px; overflow-y: auto;">
        <strong>Log test√≥w:</strong><br>
    </div>

    <script>
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function simulateAjaxLoad() {
            log('üîÑ Symulacja ≈Çadowania AJAX...');
            const elements = document.querySelectorAll('.dynamic-shipping-price');
            
            elements.forEach((el, index) => {
                // Faza 1: Stan ≈Çadowania
                el.style.opacity = '0.6';
                el.style.color = '#999';
                log(`  ‚Ä¢ Element ${index + 1}: Ustawiono stan ≈Çadowania`);
                
                // Faza 2: Po 150ms - aktualizacja ceny
                setTimeout(() => {
                    el.textContent = 'od 67,65 z≈Ç';
                    el.style.opacity = '1';
                    el.style.color = '#4CAF50';
                    log(`  ‚Ä¢ Element ${index + 1}: Zaktualizowano na 67,65 z≈Ç`);
                }, 150 + (index * 50)); // Stopniowo dla ka≈ºdego elementu
            });
            
            log('‚úÖ Symulacja zako≈Ñczona');
        }
        
        function simulateCache() {
            log('üíæ Symulacja u≈ºycia cache...');
            const elements = document.querySelectorAll('.dynamic-shipping-price');
            
            // Symuluj ustawienie cache
            window.currentMaxShippingCost = 67.65;
            log('üíæ Ustawiono cache: 67.65');
            
            elements.forEach((el, index) => {
                // Natychmiastowa aktualizacja z cache
                const formattedCost = window.currentMaxShippingCost.toFixed(2).replace('.', ',');
                el.textContent = `od ${formattedCost} z≈Ç`;
                el.style.opacity = '1';
                el.style.color = '#4CAF50';
                log(`  ‚Ä¢ Element ${index + 1}: Natychmiast z cache: ${formattedCost} z≈Ç`);
            });
            
            log('‚úÖ Cache zastosowany - brak migania!');
        }
        
        function testRealAjax() {
            log('üåê Test prawdziwego AJAX...');
            const element = document.getElementById('price1');
            
            element.style.opacity = '0.6';
            element.style.color = '#999';
            log('üîÑ Rozpoczynam prawdziwe zapytanie AJAX...');
            
            fetch('/kopia_norwit/modules/relatedproducts/ajax.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'action=getShippingInfo&id_product=2681'
            })
            .then(response => response.json())
            .then(data => {
                log(`üì¶ Otrzymano odpowied≈∫: ${data.formatted_price}`);
                
                setTimeout(() => {
                    element.textContent = data.formatted_price;
                    element.style.opacity = '1';
                    element.style.color = '#4CAF50';
                    log(`‚úÖ Zaktualizowano: ${data.formatted_price}`);
                }, 150);
            })
            .catch(error => {
                log(`‚ùå B≈ÇƒÖd AJAX: ${error.message}`);
                element.style.opacity = '1';
                element.style.color = '#f44336';
            });
        }
        
        function resetPrices() {
            log('üîÑ Reset wszystkich cen...');
            const elements = document.querySelectorAll('.dynamic-shipping-price');
            
            elements.forEach((el, index) => {
                el.textContent = 'od 30,75 z≈Ç';
                el.style.opacity = '1';
                el.style.color = '#2196F3';
            });
            
            // Wyczy≈õƒá cache
            window.currentMaxShippingCost = 0;
            log('üóëÔ∏è Wyczyszczono cache');
            log('‚úÖ Reset zako≈Ñczony');
        }
        
        // Auto-demo po za≈Çadowaniu
        window.onload = function() {
            log('üöÄ Strona za≈Çadowana');
            log('‚ÑπÔ∏è Kliknij przyciski aby przetestowaƒá r√≥≈ºne scenariusze');
            
            // Pokaz demo po 2 sekundach
            setTimeout(() => {
                log('üé¨ Automatyczne demo...');
                simulateAjaxLoad();
            }, 2000);
        };
    </script>
</body>
</html>